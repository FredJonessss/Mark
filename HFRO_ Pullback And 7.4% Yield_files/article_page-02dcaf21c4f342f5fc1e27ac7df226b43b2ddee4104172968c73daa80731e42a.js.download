// should be very first script in pkg;
// sets up script execution start performance mark (https://developer.mozilla.org/en-US/docs/Web/API/Performance/mark)
// been used and analyzed in SpeedCurve https://speedcurve.com/

SA.require(['SA.mark'], function(m) {

  'use strict';

  m('sa-boot-common-footer-start');

}, 'common-footer-start');
if (!Array.prototype.filter)
  Array.prototype.filter = function(func, thisArg) {
    'use strict';

    if ( ! ((typeof func === 'Function' || typeof func === 'function') && this) ) {
      throw new TypeError();
    }

    var len = this.length >>> 0, res = new Array(len), t = this, c = 0, i = -1;
    if (thisArg === undefined) {
      while (++i !== len) {
        if (i in this) {
          if (func(t[i], i, t)) {
            res[c++] = t[i];
          } else {
            while (++i !== len) {
              if(i in this) {
                if(func.call(thisArg, t[i], i, t)) {
                  res[c++] = t[i];
                }
              }
            }
          }
        }
      }
    }

    res.length = c; // shrink down array to proper size
    return res;
  };
Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(c,e){if(null==this)throw new TypeError('"this" is null or not defined');var b=Object(this),f=b.length>>>0;if("function"!==typeof c)throw new TypeError("predicate must be a function");for(var a=0;a<f;){var d=b[a];if(c.call(e,d,a,b))return d;a++}},configurable:!0,writable:!0});
Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(b,f){if(null==this)throw new TypeError('"this" is null or not defined');var e=Object(this),c=e.length>>>0;if(0===c)return!1;var a=f|0;for(a=Math.max(0<=a?a:c-Math.abs(a),0);a<c;){var d=e[a];if(d===b||"number"===typeof d&&"number"===typeof b&&isNaN(d)&&isNaN(b))return!0;a++}return!1}});
SA.require([], function() {

  'use strict';

  var w = window, f = function() { return undefined; };

  w.console = w.console || {};

  ['assert', 'clear', 'count', 'debug', 'dir', 'error', 'exception', 'info', 'log', 'profile', 'table', 'time', 'warn'].forEach(function(fn) {
    if (!w.console[fn]) {
      w.console[fn] = f;
    }
  });

}, 'console');
SA.require([], function() {

  'use strict';

  if (typeof Object.assign !== 'function') {

    Object.defineProperty(Object, 'assign', {
      value: function assign(target, varArgs) {

        if (target == null) {
          throw new TypeError('Cannot convert undefined or null to object');
        }

        var to = Object(target);

        for (var index = 1; index < arguments.length; index++) {
          var nextSource = arguments[index];

          if (nextSource !== null) {
            for (var nextKey in nextSource) {
              if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {
                to[nextKey] = nextSource[nextKey];
              }
            }
          }
        }
        return to;
      },
      writable: true,
      configurable: true
    });
  }

}, 'Object.assign');

if (!String.prototype.includes) {
  String.prototype.includes = function (search, start) {
    'use strict';
    if (typeof start !== 'number') {
      start = 0;
    }

    if (start + search.length > this.length) {
      return false;
    } else {
      return this.indexOf(search, start) !== -1;
    }
  };
}
;
/*! jQuery v2.2.4 | (c) jQuery Foundation | jquery.org/license */

!function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("jQuery requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a,b){var c=[],d=a.document,e=c.slice,f=c.concat,g=c.push,h=c.indexOf,i={},j=i.toString,k=i.hasOwnProperty,l={},m="2.2.4",n=function(a,b){return new n.fn.init(a,b)},o=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,p=/^-ms-/,q=/-([\da-z])/gi,r=function(a,b){return b.toUpperCase()};n.fn=n.prototype={jquery:m,constructor:n,selector:"",length:0,toArray:function(){return e.call(this)},get:function(a){return null!=a?0>a?this[a+this.length]:this[a]:e.call(this)},pushStack:function(a){var b=n.merge(this.constructor(),a);return b.prevObject=this,b.context=this.context,b},each:function(a){return n.each(this,a)},map:function(a){return this.pushStack(n.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return this.pushStack(e.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(0>a?b:0);return this.pushStack(c>=0&&b>c?[this[c]]:[])},end:function(){return this.prevObject||this.constructor()},push:g,sort:c.sort,splice:c.splice},n.extend=n.fn.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"==typeof g||n.isFunction(g)||(g={}),h===i&&(g=this,h--);i>h;h++)if(null!=(a=arguments[h]))for(b in a)c=g[b],d=a[b],g!==d&&(j&&d&&(n.isPlainObject(d)||(e=n.isArray(d)))?(e?(e=!1,f=c&&n.isArray(c)?c:[]):f=c&&n.isPlainObject(c)?c:{},g[b]=n.extend(j,f,d)):void 0!==d&&(g[b]=d));return g},n.extend({expando:"jQuery"+(m+Math.random()).replace(/\D/g,""),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isFunction:function(a){return"function"===n.type(a)},isArray:Array.isArray,isWindow:function(a){return null!=a&&a===a.window},isNumeric:function(a){var b=a&&a.toString();return!n.isArray(a)&&b-parseFloat(b)+1>=0},isPlainObject:function(a){var b;if("object"!==n.type(a)||a.nodeType||n.isWindow(a))return!1;if(a.constructor&&!k.call(a,"constructor")&&!k.call(a.constructor.prototype||{},"isPrototypeOf"))return!1;for(b in a);return void 0===b||k.call(a,b)},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},type:function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?i[j.call(a)]||"object":typeof a},globalEval:function(a){var b,c=eval;a=n.trim(a),a&&(1===a.indexOf("use strict")?(b=d.createElement("script"),b.text=a,d.head.appendChild(b).parentNode.removeChild(b)):c(a))},camelCase:function(a){return a.replace(p,"ms-").replace(q,r)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b){var c,d=0;if(s(a)){for(c=a.length;c>d;d++)if(b.call(a[d],d,a[d])===!1)break}else for(d in a)if(b.call(a[d],d,a[d])===!1)break;return a},trim:function(a){return null==a?"":(a+"").replace(o,"")},makeArray:function(a,b){var c=b||[];return null!=a&&(s(Object(a))?n.merge(c,"string"==typeof a?[a]:a):g.call(c,a)),c},inArray:function(a,b,c){return null==b?-1:h.call(b,a,c)},merge:function(a,b){for(var c=+b.length,d=0,e=a.length;c>d;d++)a[e++]=b[d];return a.length=e,a},grep:function(a,b,c){for(var d,e=[],f=0,g=a.length,h=!c;g>f;f++)d=!b(a[f],f),d!==h&&e.push(a[f]);return e},map:function(a,b,c){var d,e,g=0,h=[];if(s(a))for(d=a.length;d>g;g++)e=b(a[g],g,c),null!=e&&h.push(e);else for(g in a)e=b(a[g],g,c),null!=e&&h.push(e);return f.apply([],h)},guid:1,proxy:function(a,b){var c,d,f;return"string"==typeof b&&(c=a[b],b=a,a=c),n.isFunction(a)?(d=e.call(arguments,2),f=function(){return a.apply(b||this,d.concat(e.call(arguments)))},f.guid=a.guid=a.guid||n.guid++,f):void 0},now:Date.now,support:l}),"function"==typeof Symbol&&(n.fn[Symbol.iterator]=c[Symbol.iterator]),n.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(a,b){i["[object "+b+"]"]=b.toLowerCase()});function s(a){var b=!!a&&"length"in a&&a.length,c=n.type(a);return"function"===c||n.isWindow(a)?!1:"array"===c||0===b||"number"==typeof b&&b>0&&b-1 in a}var t=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u="sizzle"+1*new Date,v=a.document,w=0,x=0,y=ga(),z=ga(),A=ga(),B=function(a,b){return a===b&&(l=!0),0},C=1<<31,D={}.hasOwnProperty,E=[],F=E.pop,G=E.push,H=E.push,I=E.slice,J=function(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1},K="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",L="[\\x20\\t\\r\\n\\f]",M="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",N="\\["+L+"*("+M+")(?:"+L+"*([*^$|!~]?=)"+L+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+M+"))|)"+L+"*\\]",O=":("+M+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+N+")*)|.*)\\)|)",P=new RegExp(L+"+","g"),Q=new RegExp("^"+L+"+|((?:^|[^\\\\])(?:\\\\.)*)"+L+"+$","g"),R=new RegExp("^"+L+"*,"+L+"*"),S=new RegExp("^"+L+"*([>+~]|"+L+")"+L+"*"),T=new RegExp("="+L+"*([^\\]'\"]*?)"+L+"*\\]","g"),U=new RegExp(O),V=new RegExp("^"+M+"$"),W={ID:new RegExp("^#("+M+")"),CLASS:new RegExp("^\\.("+M+")"),TAG:new RegExp("^("+M+"|[*])"),ATTR:new RegExp("^"+N),PSEUDO:new RegExp("^"+O),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+L+"*(even|odd|(([+-]|)(\\d*)n|)"+L+"*(?:([+-]|)"+L+"*(\\d+)|))"+L+"*\\)|)","i"),bool:new RegExp("^(?:"+K+")$","i"),needsContext:new RegExp("^"+L+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+L+"*((?:-\\d)?\\d*)"+L+"*\\)|)(?=[^-]|$)","i")},X=/^(?:input|select|textarea|button)$/i,Y=/^h\d$/i,Z=/^[^{]+\{\s*\[native \w/,$=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,_=/[+~]/,aa=/'|\\/g,ba=new RegExp("\\\\([\\da-f]{1,6}"+L+"?|("+L+")|.)","ig"),ca=function(a,b,c){var d="0x"+b-65536;return d!==d||c?b:0>d?String.fromCharCode(d+65536):String.fromCharCode(d>>10|55296,1023&d|56320)},da=function(){m()};try{H.apply(E=I.call(v.childNodes),v.childNodes),E[v.childNodes.length].nodeType}catch(ea){H={apply:E.length?function(a,b){G.apply(a,I.call(b))}:function(a,b){var c=a.length,d=0;while(a[c++]=b[d++]);a.length=c-1}}}function fa(a,b,d,e){var f,h,j,k,l,o,r,s,w=b&&b.ownerDocument,x=b?b.nodeType:9;if(d=d||[],"string"!=typeof a||!a||1!==x&&9!==x&&11!==x)return d;if(!e&&((b?b.ownerDocument||b:v)!==n&&m(b),b=b||n,p)){if(11!==x&&(o=$.exec(a)))if(f=o[1]){if(9===x){if(!(j=b.getElementById(f)))return d;if(j.id===f)return d.push(j),d}else if(w&&(j=w.getElementById(f))&&t(b,j)&&j.id===f)return d.push(j),d}else{if(o[2])return H.apply(d,b.getElementsByTagName(a)),d;if((f=o[3])&&c.getElementsByClassName&&b.getElementsByClassName)return H.apply(d,b.getElementsByClassName(f)),d}if(c.qsa&&!A[a+" "]&&(!q||!q.test(a))){if(1!==x)w=b,s=a;else if("object"!==b.nodeName.toLowerCase()){(k=b.getAttribute("id"))?k=k.replace(aa,"\\$&"):b.setAttribute("id",k=u),r=g(a),h=r.length,l=V.test(k)?"#"+k:"[id='"+k+"']";while(h--)r[h]=l+" "+qa(r[h]);s=r.join(","),w=_.test(a)&&oa(b.parentNode)||b}if(s)try{return H.apply(d,w.querySelectorAll(s)),d}catch(y){}finally{k===u&&b.removeAttribute("id")}}}return i(a.replace(Q,"$1"),b,d,e)}function ga(){var a=[];function b(c,e){return a.push(c+" ")>d.cacheLength&&delete b[a.shift()],b[c+" "]=e}return b}function ha(a){return a[u]=!0,a}function ia(a){var b=n.createElement("div");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function ja(a,b){var c=a.split("|"),e=c.length;while(e--)d.attrHandle[c[e]]=b}function ka(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||C)-(~a.sourceIndex||C);if(d)return d;if(c)while(c=c.nextSibling)if(c===b)return-1;return a?1:-1}function la(a){return function(b){var c=b.nodeName.toLowerCase();return"input"===c&&b.type===a}}function ma(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function na(a){return ha(function(b){return b=+b,ha(function(c,d){var e,f=a([],c.length,b),g=f.length;while(g--)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function oa(a){return a&&"undefined"!=typeof a.getElementsByTagName&&a}c=fa.support={},f=fa.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return b?"HTML"!==b.nodeName:!1},m=fa.setDocument=function(a){var b,e,g=a?a.ownerDocument||a:v;return g!==n&&9===g.nodeType&&g.documentElement?(n=g,o=n.documentElement,p=!f(n),(e=n.defaultView)&&e.top!==e&&(e.addEventListener?e.addEventListener("unload",da,!1):e.attachEvent&&e.attachEvent("onunload",da)),c.attributes=ia(function(a){return a.className="i",!a.getAttribute("className")}),c.getElementsByTagName=ia(function(a){return a.appendChild(n.createComment("")),!a.getElementsByTagName("*").length}),c.getElementsByClassName=Z.test(n.getElementsByClassName),c.getById=ia(function(a){return o.appendChild(a).id=u,!n.getElementsByName||!n.getElementsByName(u).length}),c.getById?(d.find.ID=function(a,b){if("undefined"!=typeof b.getElementById&&p){var c=b.getElementById(a);return c?[c]:[]}},d.filter.ID=function(a){var b=a.replace(ba,ca);return function(a){return a.getAttribute("id")===b}}):(delete d.find.ID,d.filter.ID=function(a){var b=a.replace(ba,ca);return function(a){var c="undefined"!=typeof a.getAttributeNode&&a.getAttributeNode("id");return c&&c.value===b}}),d.find.TAG=c.getElementsByTagName?function(a,b){return"undefined"!=typeof b.getElementsByTagName?b.getElementsByTagName(a):c.qsa?b.querySelectorAll(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){while(c=f[e++])1===c.nodeType&&d.push(c);return d}return f},d.find.CLASS=c.getElementsByClassName&&function(a,b){return"undefined"!=typeof b.getElementsByClassName&&p?b.getElementsByClassName(a):void 0},r=[],q=[],(c.qsa=Z.test(n.querySelectorAll))&&(ia(function(a){o.appendChild(a).innerHTML="<a id='"+u+"'></a><select id='"+u+"-\r\\' msallowcapture=''><option selected=''></option></select>",a.querySelectorAll("[msallowcapture^='']").length&&q.push("[*^$]="+L+"*(?:''|\"\")"),a.querySelectorAll("[selected]").length||q.push("\\["+L+"*(?:value|"+K+")"),a.querySelectorAll("[id~="+u+"-]").length||q.push("~="),a.querySelectorAll(":checked").length||q.push(":checked"),a.querySelectorAll("a#"+u+"+*").length||q.push(".#.+[+~]")}),ia(function(a){var b=n.createElement("input");b.setAttribute("type","hidden"),a.appendChild(b).setAttribute("name","D"),a.querySelectorAll("[name=d]").length&&q.push("name"+L+"*[*^$|!~]?="),a.querySelectorAll(":enabled").length||q.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),q.push(",.*:")})),(c.matchesSelector=Z.test(s=o.matches||o.webkitMatchesSelector||o.mozMatchesSelector||o.oMatchesSelector||o.msMatchesSelector))&&ia(function(a){c.disconnectedMatch=s.call(a,"div"),s.call(a,"[s!='']:x"),r.push("!=",O)}),q=q.length&&new RegExp(q.join("|")),r=r.length&&new RegExp(r.join("|")),b=Z.test(o.compareDocumentPosition),t=b||Z.test(o.contains)?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)while(b=b.parentNode)if(b===a)return!0;return!1},B=b?function(a,b){if(a===b)return l=!0,0;var d=!a.compareDocumentPosition-!b.compareDocumentPosition;return d?d:(d=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1,1&d||!c.sortDetached&&b.compareDocumentPosition(a)===d?a===n||a.ownerDocument===v&&t(v,a)?-1:b===n||b.ownerDocument===v&&t(v,b)?1:k?J(k,a)-J(k,b):0:4&d?-1:1)}:function(a,b){if(a===b)return l=!0,0;var c,d=0,e=a.parentNode,f=b.parentNode,g=[a],h=[b];if(!e||!f)return a===n?-1:b===n?1:e?-1:f?1:k?J(k,a)-J(k,b):0;if(e===f)return ka(a,b);c=a;while(c=c.parentNode)g.unshift(c);c=b;while(c=c.parentNode)h.unshift(c);while(g[d]===h[d])d++;return d?ka(g[d],h[d]):g[d]===v?-1:h[d]===v?1:0},n):n},fa.matches=function(a,b){return fa(a,null,null,b)},fa.matchesSelector=function(a,b){if((a.ownerDocument||a)!==n&&m(a),b=b.replace(T,"='$1']"),c.matchesSelector&&p&&!A[b+" "]&&(!r||!r.test(b))&&(!q||!q.test(b)))try{var d=s.call(a,b);if(d||c.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(e){}return fa(b,n,null,[a]).length>0},fa.contains=function(a,b){return(a.ownerDocument||a)!==n&&m(a),t(a,b)},fa.attr=function(a,b){(a.ownerDocument||a)!==n&&m(a);var e=d.attrHandle[b.toLowerCase()],f=e&&D.call(d.attrHandle,b.toLowerCase())?e(a,b,!p):void 0;return void 0!==f?f:c.attributes||!p?a.getAttribute(b):(f=a.getAttributeNode(b))&&f.specified?f.value:null},fa.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},fa.uniqueSort=function(a){var b,d=[],e=0,f=0;if(l=!c.detectDuplicates,k=!c.sortStable&&a.slice(0),a.sort(B),l){while(b=a[f++])b===a[f]&&(e=d.push(f));while(e--)a.splice(d[e],1)}return k=null,a},e=fa.getText=function(a){var b,c="",d=0,f=a.nodeType;if(f){if(1===f||9===f||11===f){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=e(a)}else if(3===f||4===f)return a.nodeValue}else while(b=a[d++])c+=e(b);return c},d=fa.selectors={cacheLength:50,createPseudo:ha,match:W,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(ba,ca),a[3]=(a[3]||a[4]||a[5]||"").replace(ba,ca),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||fa.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&fa.error(a[0]),a},PSEUDO:function(a){var b,c=!a[6]&&a[2];return W.CHILD.test(a[0])?null:(a[3]?a[2]=a[4]||a[5]||"":c&&U.test(c)&&(b=g(c,!0))&&(b=c.indexOf(")",c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(ba,ca).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=y[a+" "];return b||(b=new RegExp("(^|"+L+")"+a+"("+L+"|$)"))&&y(a,function(a){return b.test("string"==typeof a.className&&a.className||"undefined"!=typeof a.getAttribute&&a.getAttribute("class")||"")})},ATTR:function(a,b,c){return function(d){var e=fa.attr(d,a);return null==e?"!="===b:b?(e+="","="===b?e===c:"!="===b?e!==c:"^="===b?c&&0===e.indexOf(c):"*="===b?c&&e.indexOf(c)>-1:"$="===b?c&&e.slice(-c.length)===c:"~="===b?(" "+e.replace(P," ")+" ").indexOf(c)>-1:"|="===b?e===c||e.slice(0,c.length+1)===c+"-":!1):!0}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),s=!i&&!h,t=!1;if(q){if(f){while(p){m=b;while(m=m[p])if(h?m.nodeName.toLowerCase()===r:1===m.nodeType)return!1;o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&s){m=q,l=m[u]||(m[u]={}),k=l[m.uniqueID]||(l[m.uniqueID]={}),j=k[a]||[],n=j[0]===w&&j[1],t=n&&j[2],m=n&&q.childNodes[n];while(m=++n&&m&&m[p]||(t=n=0)||o.pop())if(1===m.nodeType&&++t&&m===b){k[a]=[w,n,t];break}}else if(s&&(m=b,l=m[u]||(m[u]={}),k=l[m.uniqueID]||(l[m.uniqueID]={}),j=k[a]||[],n=j[0]===w&&j[1],t=n),t===!1)while(m=++n&&m&&m[p]||(t=n=0)||o.pop())if((h?m.nodeName.toLowerCase()===r:1===m.nodeType)&&++t&&(s&&(l=m[u]||(m[u]={}),k=l[m.uniqueID]||(l[m.uniqueID]={}),k[a]=[w,t]),m===b))break;return t-=e,t===d||t%d===0&&t/d>=0}}},PSEUDO:function(a,b){var c,e=d.pseudos[a]||d.setFilters[a.toLowerCase()]||fa.error("unsupported pseudo: "+a);return e[u]?e(b):e.length>1?(c=[a,a,"",b],d.setFilters.hasOwnProperty(a.toLowerCase())?ha(function(a,c){var d,f=e(a,b),g=f.length;while(g--)d=J(a,f[g]),a[d]=!(c[d]=f[g])}):function(a){return e(a,0,c)}):e}},pseudos:{not:ha(function(a){var b=[],c=[],d=h(a.replace(Q,"$1"));return d[u]?ha(function(a,b,c,e){var f,g=d(a,null,e,[]),h=a.length;while(h--)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,e,f){return b[0]=a,d(b,null,f,c),b[0]=null,!c.pop()}}),has:ha(function(a){return function(b){return fa(a,b).length>0}}),contains:ha(function(a){return a=a.replace(ba,ca),function(b){return(b.textContent||b.innerText||e(b)).indexOf(a)>-1}}),lang:ha(function(a){return V.test(a||"")||fa.error("unsupported lang: "+a),a=a.replace(ba,ca).toLowerCase(),function(b){var c;do if(c=p?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return c=c.toLowerCase(),c===a||0===c.indexOf(a+"-");while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===o},focus:function(a){return a===n.activeElement&&(!n.hasFocus||n.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:function(a){return a.disabled===!1},disabled:function(a){return a.disabled===!0},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType<6)return!1;return!0},parent:function(a){return!d.pseudos.empty(a)},header:function(a){return Y.test(a.nodeName)},input:function(a){return X.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||"text"===b.toLowerCase())},first:na(function(){return[0]}),last:na(function(a,b){return[b-1]}),eq:na(function(a,b,c){return[0>c?c+b:c]}),even:na(function(a,b){for(var c=0;b>c;c+=2)a.push(c);return a}),odd:na(function(a,b){for(var c=1;b>c;c+=2)a.push(c);return a}),lt:na(function(a,b,c){for(var d=0>c?c+b:c;--d>=0;)a.push(d);return a}),gt:na(function(a,b,c){for(var d=0>c?c+b:c;++d<b;)a.push(d);return a})}},d.pseudos.nth=d.pseudos.eq;for(b in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})d.pseudos[b]=la(b);for(b in{submit:!0,reset:!0})d.pseudos[b]=ma(b);function pa(){}pa.prototype=d.filters=d.pseudos,d.setFilters=new pa,g=fa.tokenize=function(a,b){var c,e,f,g,h,i,j,k=z[a+" "];if(k)return b?0:k.slice(0);h=a,i=[],j=d.preFilter;while(h){c&&!(e=R.exec(h))||(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),c=!1,(e=S.exec(h))&&(c=e.shift(),f.push({value:c,type:e[0].replace(Q," ")}),h=h.slice(c.length));for(g in d.filter)!(e=W[g].exec(h))||j[g]&&!(e=j[g](e))||(c=e.shift(),f.push({value:c,type:g,matches:e}),h=h.slice(c.length));if(!c)break}return b?h.length:h?fa.error(a):z(a,i).slice(0)};function qa(a){for(var b=0,c=a.length,d="";c>b;b++)d+=a[b].value;return d}function ra(a,b,c){var d=b.dir,e=c&&"parentNode"===d,f=x++;return b.first?function(b,c,f){while(b=b[d])if(1===b.nodeType||e)return a(b,c,f)}:function(b,c,g){var h,i,j,k=[w,f];if(g){while(b=b[d])if((1===b.nodeType||e)&&a(b,c,g))return!0}else while(b=b[d])if(1===b.nodeType||e){if(j=b[u]||(b[u]={}),i=j[b.uniqueID]||(j[b.uniqueID]={}),(h=i[d])&&h[0]===w&&h[1]===f)return k[2]=h[2];if(i[d]=k,k[2]=a(b,c,g))return!0}}}function sa(a){return a.length>1?function(b,c,d){var e=a.length;while(e--)if(!a[e](b,c,d))return!1;return!0}:a[0]}function ta(a,b,c){for(var d=0,e=b.length;e>d;d++)fa(a,b[d],c);return c}function ua(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;i>h;h++)(f=a[h])&&(c&&!c(f,d,e)||(g.push(f),j&&b.push(h)));return g}function va(a,b,c,d,e,f){return d&&!d[u]&&(d=va(d)),e&&!e[u]&&(e=va(e,f)),ha(function(f,g,h,i){var j,k,l,m=[],n=[],o=g.length,p=f||ta(b||"*",h.nodeType?[h]:h,[]),q=!a||!f&&b?p:ua(p,m,a,h,i),r=c?e||(f?a:o||d)?[]:g:q;if(c&&c(q,r,h,i),d){j=ua(r,n),d(j,[],h,i),k=j.length;while(k--)(l=j[k])&&(r[n[k]]=!(q[n[k]]=l))}if(f){if(e||a){if(e){j=[],k=r.length;while(k--)(l=r[k])&&j.push(q[k]=l);e(null,r=[],j,i)}k=r.length;while(k--)(l=r[k])&&(j=e?J(f,l):m[k])>-1&&(f[j]=!(g[j]=l))}}else r=ua(r===g?r.splice(o,r.length):r),e?e(null,g,r,i):H.apply(g,r)})}function wa(a){for(var b,c,e,f=a.length,g=d.relative[a[0].type],h=g||d.relative[" "],i=g?1:0,k=ra(function(a){return a===b},h,!0),l=ra(function(a){return J(b,a)>-1},h,!0),m=[function(a,c,d){var e=!g&&(d||c!==j)||((b=c).nodeType?k(a,c,d):l(a,c,d));return b=null,e}];f>i;i++)if(c=d.relative[a[i].type])m=[ra(sa(m),c)];else{if(c=d.filter[a[i].type].apply(null,a[i].matches),c[u]){for(e=++i;f>e;e++)if(d.relative[a[e].type])break;return va(i>1&&sa(m),i>1&&qa(a.slice(0,i-1).concat({value:" "===a[i-2].type?"*":""})).replace(Q,"$1"),c,e>i&&wa(a.slice(i,e)),f>e&&wa(a=a.slice(e)),f>e&&qa(a))}m.push(c)}return sa(m)}function xa(a,b){var c=b.length>0,e=a.length>0,f=function(f,g,h,i,k){var l,o,q,r=0,s="0",t=f&&[],u=[],v=j,x=f||e&&d.find.TAG("*",k),y=w+=null==v?1:Math.random()||.1,z=x.length;for(k&&(j=g===n||g||k);s!==z&&null!=(l=x[s]);s++){if(e&&l){o=0,g||l.ownerDocument===n||(m(l),h=!p);while(q=a[o++])if(q(l,g||n,h)){i.push(l);break}k&&(w=y)}c&&((l=!q&&l)&&r--,f&&t.push(l))}if(r+=s,c&&s!==r){o=0;while(q=b[o++])q(t,u,g,h);if(f){if(r>0)while(s--)t[s]||u[s]||(u[s]=F.call(i));u=ua(u)}H.apply(i,u),k&&!f&&u.length>0&&r+b.length>1&&fa.uniqueSort(i)}return k&&(w=y,j=v),t};return c?ha(f):f}return h=fa.compile=function(a,b){var c,d=[],e=[],f=A[a+" "];if(!f){b||(b=g(a)),c=b.length;while(c--)f=wa(b[c]),f[u]?d.push(f):e.push(f);f=A(a,xa(e,d)),f.selector=a}return f},i=fa.select=function(a,b,e,f){var i,j,k,l,m,n="function"==typeof a&&a,o=!f&&g(a=n.selector||a);if(e=e||[],1===o.length){if(j=o[0]=o[0].slice(0),j.length>2&&"ID"===(k=j[0]).type&&c.getById&&9===b.nodeType&&p&&d.relative[j[1].type]){if(b=(d.find.ID(k.matches[0].replace(ba,ca),b)||[])[0],!b)return e;n&&(b=b.parentNode),a=a.slice(j.shift().value.length)}i=W.needsContext.test(a)?0:j.length;while(i--){if(k=j[i],d.relative[l=k.type])break;if((m=d.find[l])&&(f=m(k.matches[0].replace(ba,ca),_.test(j[0].type)&&oa(b.parentNode)||b))){if(j.splice(i,1),a=f.length&&qa(j),!a)return H.apply(e,f),e;break}}}return(n||h(a,o))(f,b,!p,e,!b||_.test(a)&&oa(b.parentNode)||b),e},c.sortStable=u.split("").sort(B).join("")===u,c.detectDuplicates=!!l,m(),c.sortDetached=ia(function(a){return 1&a.compareDocumentPosition(n.createElement("div"))}),ia(function(a){return a.innerHTML="<a href='#'></a>","#"===a.firstChild.getAttribute("href")})||ja("type|href|height|width",function(a,b,c){return c?void 0:a.getAttribute(b,"type"===b.toLowerCase()?1:2)}),c.attributes&&ia(function(a){return a.innerHTML="<input/>",a.firstChild.setAttribute("value",""),""===a.firstChild.getAttribute("value")})||ja("value",function(a,b,c){return c||"input"!==a.nodeName.toLowerCase()?void 0:a.defaultValue}),ia(function(a){return null==a.getAttribute("disabled")})||ja(K,function(a,b,c){var d;return c?void 0:a[b]===!0?b.toLowerCase():(d=a.getAttributeNode(b))&&d.specified?d.value:null}),fa}(a);n.find=t,n.expr=t.selectors,n.expr[":"]=n.expr.pseudos,n.uniqueSort=n.unique=t.uniqueSort,n.text=t.getText,n.isXMLDoc=t.isXML,n.contains=t.contains;var u=function(a,b,c){var d=[],e=void 0!==c;while((a=a[b])&&9!==a.nodeType)if(1===a.nodeType){if(e&&n(a).is(c))break;d.push(a)}return d},v=function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c},w=n.expr.match.needsContext,x=/^<([\w-]+)\s*\/?>(?:<\/\1>|)$/,y=/^.[^:#\[\.,]*$/;function z(a,b,c){if(n.isFunction(b))return n.grep(a,function(a,d){return!!b.call(a,d,a)!==c});if(b.nodeType)return n.grep(a,function(a){return a===b!==c});if("string"==typeof b){if(y.test(b))return n.filter(b,a,c);b=n.filter(b,a)}return n.grep(a,function(a){return h.call(b,a)>-1!==c})}n.filter=function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?n.find.matchesSelector(d,a)?[d]:[]:n.find.matches(a,n.grep(b,function(a){return 1===a.nodeType}))},n.fn.extend({find:function(a){var b,c=this.length,d=[],e=this;if("string"!=typeof a)return this.pushStack(n(a).filter(function(){for(b=0;c>b;b++)if(n.contains(e[b],this))return!0}));for(b=0;c>b;b++)n.find(a,e[b],d);return d=this.pushStack(c>1?n.unique(d):d),d.selector=this.selector?this.selector+" "+a:a,d},filter:function(a){return this.pushStack(z(this,a||[],!1))},not:function(a){return this.pushStack(z(this,a||[],!0))},is:function(a){return!!z(this,"string"==typeof a&&w.test(a)?n(a):a||[],!1).length}});var A,B=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,C=n.fn.init=function(a,b,c){var e,f;if(!a)return this;if(c=c||A,"string"==typeof a){if(e="<"===a[0]&&">"===a[a.length-1]&&a.length>=3?[null,a,null]:B.exec(a),!e||!e[1]&&b)return!b||b.jquery?(b||c).find(a):this.constructor(b).find(a);if(e[1]){if(b=b instanceof n?b[0]:b,n.merge(this,n.parseHTML(e[1],b&&b.nodeType?b.ownerDocument||b:d,!0)),x.test(e[1])&&n.isPlainObject(b))for(e in b)n.isFunction(this[e])?this[e](b[e]):this.attr(e,b[e]);return this}return f=d.getElementById(e[2]),f&&f.parentNode&&(this.length=1,this[0]=f),this.context=d,this.selector=a,this}return a.nodeType?(this.context=this[0]=a,this.length=1,this):n.isFunction(a)?void 0!==c.ready?c.ready(a):a(n):(void 0!==a.selector&&(this.selector=a.selector,this.context=a.context),n.makeArray(a,this))};C.prototype=n.fn,A=n(d);var D=/^(?:parents|prev(?:Until|All))/,E={children:!0,contents:!0,next:!0,prev:!0};n.fn.extend({has:function(a){var b=n(a,this),c=b.length;return this.filter(function(){for(var a=0;c>a;a++)if(n.contains(this,b[a]))return!0})},closest:function(a,b){for(var c,d=0,e=this.length,f=[],g=w.test(a)||"string"!=typeof a?n(a,b||this.context):0;e>d;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(c.nodeType<11&&(g?g.index(c)>-1:1===c.nodeType&&n.find.matchesSelector(c,a))){f.push(c);break}return this.pushStack(f.length>1?n.uniqueSort(f):f)},index:function(a){return a?"string"==typeof a?h.call(n(a),this[0]):h.call(this,a.jquery?a[0]:a):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){return this.pushStack(n.uniqueSort(n.merge(this.get(),n(a,b))))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}});function F(a,b){while((a=a[b])&&1!==a.nodeType);return a}n.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return u(a,"parentNode")},parentsUntil:function(a,b,c){return u(a,"parentNode",c)},next:function(a){return F(a,"nextSibling")},prev:function(a){return F(a,"previousSibling")},nextAll:function(a){return u(a,"nextSibling")},prevAll:function(a){return u(a,"previousSibling")},nextUntil:function(a,b,c){return u(a,"nextSibling",c)},prevUntil:function(a,b,c){return u(a,"previousSibling",c)},siblings:function(a){return v((a.parentNode||{}).firstChild,a)},children:function(a){return v(a.firstChild)},contents:function(a){return a.contentDocument||n.merge([],a.childNodes)}},function(a,b){n.fn[a]=function(c,d){var e=n.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=n.filter(d,e)),this.length>1&&(E[a]||n.uniqueSort(e),D.test(a)&&e.reverse()),this.pushStack(e)}});var G=/\S+/g;function H(a){var b={};return n.each(a.match(G)||[],function(a,c){b[c]=!0}),b}n.Callbacks=function(a){a="string"==typeof a?H(a):n.extend({},a);var b,c,d,e,f=[],g=[],h=-1,i=function(){for(e=a.once,d=b=!0;g.length;h=-1){c=g.shift();while(++h<f.length)f[h].apply(c[0],c[1])===!1&&a.stopOnFalse&&(h=f.length,c=!1)}a.memory||(c=!1),b=!1,e&&(f=c?[]:"")},j={add:function(){return f&&(c&&!b&&(h=f.length-1,g.push(c)),function d(b){n.each(b,function(b,c){n.isFunction(c)?a.unique&&j.has(c)||f.push(c):c&&c.length&&"string"!==n.type(c)&&d(c)})}(arguments),c&&!b&&i()),this},remove:function(){return n.each(arguments,function(a,b){var c;while((c=n.inArray(b,f,c))>-1)f.splice(c,1),h>=c&&h--}),this},has:function(a){return a?n.inArray(a,f)>-1:f.length>0},empty:function(){return f&&(f=[]),this},disable:function(){return e=g=[],f=c="",this},disabled:function(){return!f},lock:function(){return e=g=[],c||(f=c=""),this},locked:function(){return!!e},fireWith:function(a,c){return e||(c=c||[],c=[a,c.slice?c.slice():c],g.push(c),b||i()),this},fire:function(){return j.fireWith(this,arguments),this},fired:function(){return!!d}};return j},n.extend({Deferred:function(a){var b=[["resolve","done",n.Callbacks("once memory"),"resolved"],["reject","fail",n.Callbacks("once memory"),"rejected"],["notify","progress",n.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return n.Deferred(function(c){n.each(b,function(b,f){var g=n.isFunction(a[b])&&a[b];e[f[1]](function(){var a=g&&g.apply(this,arguments);a&&n.isFunction(a.promise)?a.promise().progress(c.notify).done(c.resolve).fail(c.reject):c[f[0]+"With"](this===d?c.promise():this,g?[a]:arguments)})}),a=null}).promise()},promise:function(a){return null!=a?n.extend(a,d):d}},e={};return d.pipe=d.then,n.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[1^a][2].disable,b[2][2].lock),e[f[0]]=function(){return e[f[0]+"With"](this===e?d:this,arguments),this},e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b=0,c=e.call(arguments),d=c.length,f=1!==d||a&&n.isFunction(a.promise)?d:0,g=1===f?a:n.Deferred(),h=function(a,b,c){return function(d){b[a]=this,c[a]=arguments.length>1?e.call(arguments):d,c===i?g.notifyWith(b,c):--f||g.resolveWith(b,c)}},i,j,k;if(d>1)for(i=new Array(d),j=new Array(d),k=new Array(d);d>b;b++)c[b]&&n.isFunction(c[b].promise)?c[b].promise().progress(h(b,j,i)).done(h(b,k,c)).fail(g.reject):--f;return f||g.resolveWith(k,c),g.promise()}});var I;n.fn.ready=function(a){return n.ready.promise().done(a),this},n.extend({isReady:!1,readyWait:1,holdReady:function(a){a?n.readyWait++:n.ready(!0)},ready:function(a){(a===!0?--n.readyWait:n.isReady)||(n.isReady=!0,a!==!0&&--n.readyWait>0||(I.resolveWith(d,[n]),n.fn.triggerHandler&&(n(d).triggerHandler("ready"),n(d).off("ready"))))}});function J(){d.removeEventListener("DOMContentLoaded",J),a.removeEventListener("load",J),n.ready()}n.ready.promise=function(b){return I||(I=n.Deferred(),"complete"===d.readyState||"loading"!==d.readyState&&!d.documentElement.doScroll?a.setTimeout(n.ready):(d.addEventListener("DOMContentLoaded",J),a.addEventListener("load",J))),I.promise(b)},n.ready.promise();var K=function(a,b,c,d,e,f,g){var h=0,i=a.length,j=null==c;if("object"===n.type(c)){e=!0;for(h in c)K(a,b,h,c[h],!0,f,g)}else if(void 0!==d&&(e=!0,n.isFunction(d)||(g=!0),j&&(g?(b.call(a,d),b=null):(j=b,b=function(a,b,c){return j.call(n(a),c)})),b))for(;i>h;h++)b(a[h],c,g?d:d.call(a[h],h,b(a[h],c)));return e?a:j?b.call(a):i?b(a[0],c):f},L=function(a){return 1===a.nodeType||9===a.nodeType||!+a.nodeType};function M(){this.expando=n.expando+M.uid++}M.uid=1,M.prototype={register:function(a,b){var c=b||{};return a.nodeType?a[this.expando]=c:Object.defineProperty(a,this.expando,{value:c,writable:!0,configurable:!0}),a[this.expando]},cache:function(a){if(!L(a))return{};var b=a[this.expando];return b||(b={},L(a)&&(a.nodeType?a[this.expando]=b:Object.defineProperty(a,this.expando,{value:b,configurable:!0}))),b},set:function(a,b,c){var d,e=this.cache(a);if("string"==typeof b)e[b]=c;else for(d in b)e[d]=b[d];return e},get:function(a,b){return void 0===b?this.cache(a):a[this.expando]&&a[this.expando][b]},access:function(a,b,c){var d;return void 0===b||b&&"string"==typeof b&&void 0===c?(d=this.get(a,b),void 0!==d?d:this.get(a,n.camelCase(b))):(this.set(a,b,c),void 0!==c?c:b)},remove:function(a,b){var c,d,e,f=a[this.expando];if(void 0!==f){if(void 0===b)this.register(a);else{n.isArray(b)?d=b.concat(b.map(n.camelCase)):(e=n.camelCase(b),b in f?d=[b,e]:(d=e,d=d in f?[d]:d.match(G)||[])),c=d.length;while(c--)delete f[d[c]]}(void 0===b||n.isEmptyObject(f))&&(a.nodeType?a[this.expando]=void 0:delete a[this.expando])}},hasData:function(a){var b=a[this.expando];return void 0!==b&&!n.isEmptyObject(b)}};var N=new M,O=new M,P=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Q=/[A-Z]/g;function R(a,b,c){var d;if(void 0===c&&1===a.nodeType)if(d="data-"+b.replace(Q,"-$&").toLowerCase(),c=a.getAttribute(d),"string"==typeof c){try{c="true"===c?!0:"false"===c?!1:"null"===c?null:+c+""===c?+c:P.test(c)?n.parseJSON(c):c;
}catch(e){}O.set(a,b,c)}else c=void 0;return c}n.extend({hasData:function(a){return O.hasData(a)||N.hasData(a)},data:function(a,b,c){return O.access(a,b,c)},removeData:function(a,b){O.remove(a,b)},_data:function(a,b,c){return N.access(a,b,c)},_removeData:function(a,b){N.remove(a,b)}}),n.fn.extend({data:function(a,b){var c,d,e,f=this[0],g=f&&f.attributes;if(void 0===a){if(this.length&&(e=O.get(f),1===f.nodeType&&!N.get(f,"hasDataAttrs"))){c=g.length;while(c--)g[c]&&(d=g[c].name,0===d.indexOf("data-")&&(d=n.camelCase(d.slice(5)),R(f,d,e[d])));N.set(f,"hasDataAttrs",!0)}return e}return"object"==typeof a?this.each(function(){O.set(this,a)}):K(this,function(b){var c,d;if(f&&void 0===b){if(c=O.get(f,a)||O.get(f,a.replace(Q,"-$&").toLowerCase()),void 0!==c)return c;if(d=n.camelCase(a),c=O.get(f,d),void 0!==c)return c;if(c=R(f,d,void 0),void 0!==c)return c}else d=n.camelCase(a),this.each(function(){var c=O.get(this,d);O.set(this,d,b),a.indexOf("-")>-1&&void 0!==c&&O.set(this,a,b)})},null,b,arguments.length>1,null,!0)},removeData:function(a){return this.each(function(){O.remove(this,a)})}}),n.extend({queue:function(a,b,c){var d;return a?(b=(b||"fx")+"queue",d=N.get(a,b),c&&(!d||n.isArray(c)?d=N.access(a,b,n.makeArray(c)):d.push(c)),d||[]):void 0},dequeue:function(a,b){b=b||"fx";var c=n.queue(a,b),d=c.length,e=c.shift(),f=n._queueHooks(a,b),g=function(){n.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--),e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return N.get(a,c)||N.access(a,c,{empty:n.Callbacks("once memory").add(function(){N.remove(a,[b+"queue",c])})})}}),n.fn.extend({queue:function(a,b){var c=2;return"string"!=typeof a&&(b=a,a="fx",c--),arguments.length<c?n.queue(this[0],a):void 0===b?this:this.each(function(){var c=n.queue(this,a,b);n._queueHooks(this,a),"fx"===a&&"inprogress"!==c[0]&&n.dequeue(this,a)})},dequeue:function(a){return this.each(function(){n.dequeue(this,a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,b){var c,d=1,e=n.Deferred(),f=this,g=this.length,h=function(){--d||e.resolveWith(f,[f])};"string"!=typeof a&&(b=a,a=void 0),a=a||"fx";while(g--)c=N.get(f[g],a+"queueHooks"),c&&c.empty&&(d++,c.empty.add(h));return h(),e.promise(b)}});var S=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,T=new RegExp("^(?:([+-])=|)("+S+")([a-z%]*)$","i"),U=["Top","Right","Bottom","Left"],V=function(a,b){return a=b||a,"none"===n.css(a,"display")||!n.contains(a.ownerDocument,a)};function W(a,b,c,d){var e,f=1,g=20,h=d?function(){return d.cur()}:function(){return n.css(a,b,"")},i=h(),j=c&&c[3]||(n.cssNumber[b]?"":"px"),k=(n.cssNumber[b]||"px"!==j&&+i)&&T.exec(n.css(a,b));if(k&&k[3]!==j){j=j||k[3],c=c||[],k=+i||1;do f=f||".5",k/=f,n.style(a,b,k+j);while(f!==(f=h()/i)&&1!==f&&--g)}return c&&(k=+k||+i||0,e=c[1]?k+(c[1]+1)*c[2]:+c[2],d&&(d.unit=j,d.start=k,d.end=e)),e}var X=/^(?:checkbox|radio)$/i,Y=/<([\w:-]+)/,Z=/^$|\/(?:java|ecma)script/i,$={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};$.optgroup=$.option,$.tbody=$.tfoot=$.colgroup=$.caption=$.thead,$.th=$.td;function _(a,b){var c="undefined"!=typeof a.getElementsByTagName?a.getElementsByTagName(b||"*"):"undefined"!=typeof a.querySelectorAll?a.querySelectorAll(b||"*"):[];return void 0===b||b&&n.nodeName(a,b)?n.merge([a],c):c}function aa(a,b){for(var c=0,d=a.length;d>c;c++)N.set(a[c],"globalEval",!b||N.get(b[c],"globalEval"))}var ba=/<|&#?\w+;/;function ca(a,b,c,d,e){for(var f,g,h,i,j,k,l=b.createDocumentFragment(),m=[],o=0,p=a.length;p>o;o++)if(f=a[o],f||0===f)if("object"===n.type(f))n.merge(m,f.nodeType?[f]:f);else if(ba.test(f)){g=g||l.appendChild(b.createElement("div")),h=(Y.exec(f)||["",""])[1].toLowerCase(),i=$[h]||$._default,g.innerHTML=i[1]+n.htmlPrefilter(f)+i[2],k=i[0];while(k--)g=g.lastChild;n.merge(m,g.childNodes),g=l.firstChild,g.textContent=""}else m.push(b.createTextNode(f));l.textContent="",o=0;while(f=m[o++])if(d&&n.inArray(f,d)>-1)e&&e.push(f);else if(j=n.contains(f.ownerDocument,f),g=_(l.appendChild(f),"script"),j&&aa(g),c){k=0;while(f=g[k++])Z.test(f.type||"")&&c.push(f)}return l}!function(){var a=d.createDocumentFragment(),b=a.appendChild(d.createElement("div")),c=d.createElement("input");c.setAttribute("type","radio"),c.setAttribute("checked","checked"),c.setAttribute("name","t"),b.appendChild(c),l.checkClone=b.cloneNode(!0).cloneNode(!0).lastChild.checked,b.innerHTML="<textarea>x</textarea>",l.noCloneChecked=!!b.cloneNode(!0).lastChild.defaultValue}();var da=/^key/,ea=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,fa=/^([^.]*)(?:\.(.+)|)/;function ga(){return!0}function ha(){return!1}function ia(){try{return d.activeElement}catch(a){}}function ja(a,b,c,d,e,f){var g,h;if("object"==typeof b){"string"!=typeof c&&(d=d||c,c=void 0);for(h in b)ja(a,h,c,d,b[h],f);return a}if(null==d&&null==e?(e=c,d=c=void 0):null==e&&("string"==typeof c?(e=d,d=void 0):(e=d,d=c,c=void 0)),e===!1)e=ha;else if(!e)return a;return 1===f&&(g=e,e=function(a){return n().off(a),g.apply(this,arguments)},e.guid=g.guid||(g.guid=n.guid++)),a.each(function(){n.event.add(this,b,e,d,c)})}n.event={global:{},add:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,o,p,q,r=N.get(a);if(r){c.handler&&(f=c,c=f.handler,e=f.selector),c.guid||(c.guid=n.guid++),(i=r.events)||(i=r.events={}),(g=r.handle)||(g=r.handle=function(b){return"undefined"!=typeof n&&n.event.triggered!==b.type?n.event.dispatch.apply(a,arguments):void 0}),b=(b||"").match(G)||[""],j=b.length;while(j--)h=fa.exec(b[j])||[],o=q=h[1],p=(h[2]||"").split(".").sort(),o&&(l=n.event.special[o]||{},o=(e?l.delegateType:l.bindType)||o,l=n.event.special[o]||{},k=n.extend({type:o,origType:q,data:d,handler:c,guid:c.guid,selector:e,needsContext:e&&n.expr.match.needsContext.test(e),namespace:p.join(".")},f),(m=i[o])||(m=i[o]=[],m.delegateCount=0,l.setup&&l.setup.call(a,d,p,g)!==!1||a.addEventListener&&a.addEventListener(o,g)),l.add&&(l.add.call(a,k),k.handler.guid||(k.handler.guid=c.guid)),e?m.splice(m.delegateCount++,0,k):m.push(k),n.event.global[o]=!0)}},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,o,p,q,r=N.hasData(a)&&N.get(a);if(r&&(i=r.events)){b=(b||"").match(G)||[""],j=b.length;while(j--)if(h=fa.exec(b[j])||[],o=q=h[1],p=(h[2]||"").split(".").sort(),o){l=n.event.special[o]||{},o=(d?l.delegateType:l.bindType)||o,m=i[o]||[],h=h[2]&&new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),g=f=m.length;while(f--)k=m[f],!e&&q!==k.origType||c&&c.guid!==k.guid||h&&!h.test(k.namespace)||d&&d!==k.selector&&("**"!==d||!k.selector)||(m.splice(f,1),k.selector&&m.delegateCount--,l.remove&&l.remove.call(a,k));g&&!m.length&&(l.teardown&&l.teardown.call(a,p,r.handle)!==!1||n.removeEvent(a,o,r.handle),delete i[o])}else for(o in i)n.event.remove(a,o+b[j],c,d,!0);n.isEmptyObject(i)&&N.remove(a,"handle events")}},dispatch:function(a){a=n.event.fix(a);var b,c,d,f,g,h=[],i=e.call(arguments),j=(N.get(this,"events")||{})[a.type]||[],k=n.event.special[a.type]||{};if(i[0]=a,a.delegateTarget=this,!k.preDispatch||k.preDispatch.call(this,a)!==!1){h=n.event.handlers.call(this,a,j),b=0;while((f=h[b++])&&!a.isPropagationStopped()){a.currentTarget=f.elem,c=0;while((g=f.handlers[c++])&&!a.isImmediatePropagationStopped())a.rnamespace&&!a.rnamespace.test(g.namespace)||(a.handleObj=g,a.data=g.data,d=((n.event.special[g.origType]||{}).handle||g.handler).apply(f.elem,i),void 0!==d&&(a.result=d)===!1&&(a.preventDefault(),a.stopPropagation()))}return k.postDispatch&&k.postDispatch.call(this,a),a.result}},handlers:function(a,b){var c,d,e,f,g=[],h=b.delegateCount,i=a.target;if(h&&i.nodeType&&("click"!==a.type||isNaN(a.button)||a.button<1))for(;i!==this;i=i.parentNode||this)if(1===i.nodeType&&(i.disabled!==!0||"click"!==a.type)){for(d=[],c=0;h>c;c++)f=b[c],e=f.selector+" ",void 0===d[e]&&(d[e]=f.needsContext?n(e,this).index(i)>-1:n.find(e,this,null,[i]).length),d[e]&&d.push(f);d.length&&g.push({elem:i,handlers:d})}return h<b.length&&g.push({elem:this,handlers:b.slice(h)}),g},props:"altKey bubbles cancelable ctrlKey currentTarget detail eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,b){var c,e,f,g=b.button;return null==a.pageX&&null!=b.clientX&&(c=a.target.ownerDocument||d,e=c.documentElement,f=c.body,a.pageX=b.clientX+(e&&e.scrollLeft||f&&f.scrollLeft||0)-(e&&e.clientLeft||f&&f.clientLeft||0),a.pageY=b.clientY+(e&&e.scrollTop||f&&f.scrollTop||0)-(e&&e.clientTop||f&&f.clientTop||0)),a.which||void 0===g||(a.which=1&g?1:2&g?3:4&g?2:0),a}},fix:function(a){if(a[n.expando])return a;var b,c,e,f=a.type,g=a,h=this.fixHooks[f];h||(this.fixHooks[f]=h=ea.test(f)?this.mouseHooks:da.test(f)?this.keyHooks:{}),e=h.props?this.props.concat(h.props):this.props,a=new n.Event(g),b=e.length;while(b--)c=e[b],a[c]=g[c];return a.target||(a.target=d),3===a.target.nodeType&&(a.target=a.target.parentNode),h.filter?h.filter(a,g):a},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==ia()&&this.focus?(this.focus(),!1):void 0},delegateType:"focusin"},blur:{trigger:function(){return this===ia()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&n.nodeName(this,"input")?(this.click(),!1):void 0},_default:function(a){return n.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){void 0!==a.result&&a.originalEvent&&(a.originalEvent.returnValue=a.result)}}}},n.removeEvent=function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c)},n.Event=function(a,b){return this instanceof n.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&a.returnValue===!1?ga:ha):this.type=a,b&&n.extend(this,b),this.timeStamp=a&&a.timeStamp||n.now(),void(this[n.expando]=!0)):new n.Event(a,b)},n.Event.prototype={constructor:n.Event,isDefaultPrevented:ha,isPropagationStopped:ha,isImmediatePropagationStopped:ha,isSimulated:!1,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=ga,a&&!this.isSimulated&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=ga,a&&!this.isSimulated&&a.stopPropagation()},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=ga,a&&!this.isSimulated&&a.stopImmediatePropagation(),this.stopPropagation()}},n.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(a,b){n.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return e&&(e===d||n.contains(d,e))||(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),n.fn.extend({on:function(a,b,c,d){return ja(this,a,b,c,d)},one:function(a,b,c,d){return ja(this,a,b,c,d,1)},off:function(a,b,c){var d,e;if(a&&a.preventDefault&&a.handleObj)return d=a.handleObj,n(a.delegateTarget).off(d.namespace?d.origType+"."+d.namespace:d.origType,d.selector,d.handler),this;if("object"==typeof a){for(e in a)this.off(e,b,a[e]);return this}return b!==!1&&"function"!=typeof b||(c=b,b=void 0),c===!1&&(c=ha),this.each(function(){n.event.remove(this,a,c,b)})}});var ka=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:-]+)[^>]*)\/>/gi,la=/<script|<style|<link/i,ma=/checked\s*(?:[^=]|=\s*.checked.)/i,na=/^true\/(.*)/,oa=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function pa(a,b){return n.nodeName(a,"table")&&n.nodeName(11!==b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function qa(a){return a.type=(null!==a.getAttribute("type"))+"/"+a.type,a}function ra(a){var b=na.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function sa(a,b){var c,d,e,f,g,h,i,j;if(1===b.nodeType){if(N.hasData(a)&&(f=N.access(a),g=N.set(b,f),j=f.events)){delete g.handle,g.events={};for(e in j)for(c=0,d=j[e].length;d>c;c++)n.event.add(b,e,j[e][c])}O.hasData(a)&&(h=O.access(a),i=n.extend({},h),O.set(b,i))}}function ta(a,b){var c=b.nodeName.toLowerCase();"input"===c&&X.test(a.type)?b.checked=a.checked:"input"!==c&&"textarea"!==c||(b.defaultValue=a.defaultValue)}function ua(a,b,c,d){b=f.apply([],b);var e,g,h,i,j,k,m=0,o=a.length,p=o-1,q=b[0],r=n.isFunction(q);if(r||o>1&&"string"==typeof q&&!l.checkClone&&ma.test(q))return a.each(function(e){var f=a.eq(e);r&&(b[0]=q.call(this,e,f.html())),ua(f,b,c,d)});if(o&&(e=ca(b,a[0].ownerDocument,!1,a,d),g=e.firstChild,1===e.childNodes.length&&(e=g),g||d)){for(h=n.map(_(e,"script"),qa),i=h.length;o>m;m++)j=e,m!==p&&(j=n.clone(j,!0,!0),i&&n.merge(h,_(j,"script"))),c.call(a[m],j,m);if(i)for(k=h[h.length-1].ownerDocument,n.map(h,ra),m=0;i>m;m++)j=h[m],Z.test(j.type||"")&&!N.access(j,"globalEval")&&n.contains(k,j)&&(j.src?n._evalUrl&&n._evalUrl(j.src):n.globalEval(j.textContent.replace(oa,"")))}return a}function va(a,b,c){for(var d,e=b?n.filter(b,a):a,f=0;null!=(d=e[f]);f++)c||1!==d.nodeType||n.cleanData(_(d)),d.parentNode&&(c&&n.contains(d.ownerDocument,d)&&aa(_(d,"script")),d.parentNode.removeChild(d));return a}n.extend({htmlPrefilter:function(a){return a.replace(ka,"<$1></$2>")},clone:function(a,b,c){var d,e,f,g,h=a.cloneNode(!0),i=n.contains(a.ownerDocument,a);if(!(l.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||n.isXMLDoc(a)))for(g=_(h),f=_(a),d=0,e=f.length;e>d;d++)ta(f[d],g[d]);if(b)if(c)for(f=f||_(a),g=g||_(h),d=0,e=f.length;e>d;d++)sa(f[d],g[d]);else sa(a,h);return g=_(h,"script"),g.length>0&&aa(g,!i&&_(a,"script")),h},cleanData:function(a){for(var b,c,d,e=n.event.special,f=0;void 0!==(c=a[f]);f++)if(L(c)){if(b=c[N.expando]){if(b.events)for(d in b.events)e[d]?n.event.remove(c,d):n.removeEvent(c,d,b.handle);c[N.expando]=void 0}c[O.expando]&&(c[O.expando]=void 0)}}}),n.fn.extend({domManip:ua,detach:function(a){return va(this,a,!0)},remove:function(a){return va(this,a)},text:function(a){return K(this,function(a){return void 0===a?n.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=a)})},null,a,arguments.length)},append:function(){return ua(this,arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=pa(this,a);b.appendChild(a)}})},prepend:function(){return ua(this,arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=pa(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return ua(this,arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return ua(this,arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},empty:function(){for(var a,b=0;null!=(a=this[b]);b++)1===a.nodeType&&(n.cleanData(_(a,!1)),a.textContent="");return this},clone:function(a,b){return a=null==a?!1:a,b=null==b?a:b,this.map(function(){return n.clone(this,a,b)})},html:function(a){return K(this,function(a){var b=this[0]||{},c=0,d=this.length;if(void 0===a&&1===b.nodeType)return b.innerHTML;if("string"==typeof a&&!la.test(a)&&!$[(Y.exec(a)||["",""])[1].toLowerCase()]){a=n.htmlPrefilter(a);try{for(;d>c;c++)b=this[c]||{},1===b.nodeType&&(n.cleanData(_(b,!1)),b.innerHTML=a);b=0}catch(e){}}b&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=[];return ua(this,arguments,function(b){var c=this.parentNode;n.inArray(this,a)<0&&(n.cleanData(_(this)),c&&c.replaceChild(b,this))},a)}}),n.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){n.fn[a]=function(a){for(var c,d=[],e=n(a),f=e.length-1,h=0;f>=h;h++)c=h===f?this:this.clone(!0),n(e[h])[b](c),g.apply(d,c.get());return this.pushStack(d)}});var wa,xa={HTML:"block",BODY:"block"};function ya(a,b){var c=n(b.createElement(a)).appendTo(b.body),d=n.css(c[0],"display");return c.detach(),d}function za(a){var b=d,c=xa[a];return c||(c=ya(a,b),"none"!==c&&c||(wa=(wa||n("<iframe frameborder='0' width='0' height='0'/>")).appendTo(b.documentElement),b=wa[0].contentDocument,b.write(),b.close(),c=ya(a,b),wa.detach()),xa[a]=c),c}var Aa=/^margin/,Ba=new RegExp("^("+S+")(?!px)[a-z%]+$","i"),Ca=function(b){var c=b.ownerDocument.defaultView;return c&&c.opener||(c=a),c.getComputedStyle(b)},Da=function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e},Ea=d.documentElement;!function(){var b,c,e,f,g=d.createElement("div"),h=d.createElement("div");if(h.style){h.style.backgroundClip="content-box",h.cloneNode(!0).style.backgroundClip="",l.clearCloneStyle="content-box"===h.style.backgroundClip,g.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",g.appendChild(h);function i(){h.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",h.innerHTML="",Ea.appendChild(g);var d=a.getComputedStyle(h);b="1%"!==d.top,f="2px"===d.marginLeft,c="4px"===d.width,h.style.marginRight="50%",e="4px"===d.marginRight,Ea.removeChild(g)}n.extend(l,{pixelPosition:function(){return i(),b},boxSizingReliable:function(){return null==c&&i(),c},pixelMarginRight:function(){return null==c&&i(),e},reliableMarginLeft:function(){return null==c&&i(),f},reliableMarginRight:function(){var b,c=h.appendChild(d.createElement("div"));return c.style.cssText=h.style.cssText="-webkit-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",c.style.marginRight=c.style.width="0",h.style.width="1px",Ea.appendChild(g),b=!parseFloat(a.getComputedStyle(c).marginRight),Ea.removeChild(g),h.removeChild(c),b}})}}();function Fa(a,b,c){var d,e,f,g,h=a.style;return c=c||Ca(a),g=c?c.getPropertyValue(b)||c[b]:void 0,""!==g&&void 0!==g||n.contains(a.ownerDocument,a)||(g=n.style(a,b)),c&&!l.pixelMarginRight()&&Ba.test(g)&&Aa.test(b)&&(d=h.width,e=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=g,g=c.width,h.width=d,h.minWidth=e,h.maxWidth=f),void 0!==g?g+"":g}function Ga(a,b){return{get:function(){return a()?void delete this.get:(this.get=b).apply(this,arguments)}}}var Ha=/^(none|table(?!-c[ea]).+)/,Ia={position:"absolute",visibility:"hidden",display:"block"},Ja={letterSpacing:"0",fontWeight:"400"},Ka=["Webkit","O","Moz","ms"],La=d.createElement("div").style;function Ma(a){if(a in La)return a;var b=a[0].toUpperCase()+a.slice(1),c=Ka.length;while(c--)if(a=Ka[c]+b,a in La)return a}function Na(a,b,c){var d=T.exec(b);return d?Math.max(0,d[2]-(c||0))+(d[3]||"px"):b}function Oa(a,b,c,d,e){for(var f=c===(d?"border":"content")?4:"width"===b?1:0,g=0;4>f;f+=2)"margin"===c&&(g+=n.css(a,c+U[f],!0,e)),d?("content"===c&&(g-=n.css(a,"padding"+U[f],!0,e)),"margin"!==c&&(g-=n.css(a,"border"+U[f]+"Width",!0,e))):(g+=n.css(a,"padding"+U[f],!0,e),"padding"!==c&&(g+=n.css(a,"border"+U[f]+"Width",!0,e)));return g}function Pa(a,b,c){var d=!0,e="width"===b?a.offsetWidth:a.offsetHeight,f=Ca(a),g="border-box"===n.css(a,"boxSizing",!1,f);if(0>=e||null==e){if(e=Fa(a,b,f),(0>e||null==e)&&(e=a.style[b]),Ba.test(e))return e;d=g&&(l.boxSizingReliable()||e===a.style[b]),e=parseFloat(e)||0}return e+Oa(a,b,c||(g?"border":"content"),d,f)+"px"}function Qa(a,b){for(var c,d,e,f=[],g=0,h=a.length;h>g;g++)d=a[g],d.style&&(f[g]=N.get(d,"olddisplay"),c=d.style.display,b?(f[g]||"none"!==c||(d.style.display=""),""===d.style.display&&V(d)&&(f[g]=N.access(d,"olddisplay",za(d.nodeName)))):(e=V(d),"none"===c&&e||N.set(d,"olddisplay",e?c:n.css(d,"display"))));for(g=0;h>g;g++)d=a[g],d.style&&(b&&"none"!==d.style.display&&""!==d.style.display||(d.style.display=b?f[g]||"":"none"));return a}n.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=Fa(a,"opacity");return""===c?"1":c}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(a,b,c,d){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var e,f,g,h=n.camelCase(b),i=a.style;return b=n.cssProps[h]||(n.cssProps[h]=Ma(h)||h),g=n.cssHooks[b]||n.cssHooks[h],void 0===c?g&&"get"in g&&void 0!==(e=g.get(a,!1,d))?e:i[b]:(f=typeof c,"string"===f&&(e=T.exec(c))&&e[1]&&(c=W(a,b,e),f="number"),null!=c&&c===c&&("number"===f&&(c+=e&&e[3]||(n.cssNumber[h]?"":"px")),l.clearCloneStyle||""!==c||0!==b.indexOf("background")||(i[b]="inherit"),g&&"set"in g&&void 0===(c=g.set(a,c,d))||(i[b]=c)),void 0)}},css:function(a,b,c,d){var e,f,g,h=n.camelCase(b);return b=n.cssProps[h]||(n.cssProps[h]=Ma(h)||h),g=n.cssHooks[b]||n.cssHooks[h],g&&"get"in g&&(e=g.get(a,!0,c)),void 0===e&&(e=Fa(a,b,d)),"normal"===e&&b in Ja&&(e=Ja[b]),""===c||c?(f=parseFloat(e),c===!0||isFinite(f)?f||0:e):e}}),n.each(["height","width"],function(a,b){n.cssHooks[b]={get:function(a,c,d){return c?Ha.test(n.css(a,"display"))&&0===a.offsetWidth?Da(a,Ia,function(){return Pa(a,b,d)}):Pa(a,b,d):void 0},set:function(a,c,d){var e,f=d&&Ca(a),g=d&&Oa(a,b,d,"border-box"===n.css(a,"boxSizing",!1,f),f);return g&&(e=T.exec(c))&&"px"!==(e[3]||"px")&&(a.style[b]=c,c=n.css(a,b)),Na(a,c,g)}}}),n.cssHooks.marginLeft=Ga(l.reliableMarginLeft,function(a,b){return b?(parseFloat(Fa(a,"marginLeft"))||a.getBoundingClientRect().left-Da(a,{marginLeft:0},function(){return a.getBoundingClientRect().left}))+"px":void 0}),n.cssHooks.marginRight=Ga(l.reliableMarginRight,function(a,b){return b?Da(a,{display:"inline-block"},Fa,[a,"marginRight"]):void 0}),n.each({margin:"",padding:"",border:"Width"},function(a,b){n.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];4>d;d++)e[a+U[d]+b]=f[d]||f[d-2]||f[0];return e}},Aa.test(a)||(n.cssHooks[a+b].set=Na)}),n.fn.extend({css:function(a,b){return K(this,function(a,b,c){var d,e,f={},g=0;if(n.isArray(b)){for(d=Ca(a),e=b.length;e>g;g++)f[b[g]]=n.css(a,b[g],!1,d);return f}return void 0!==c?n.style(a,b,c):n.css(a,b)},a,b,arguments.length>1)},show:function(){return Qa(this,!0)},hide:function(){return Qa(this)},toggle:function(a){return"boolean"==typeof a?a?this.show():this.hide():this.each(function(){V(this)?n(this).show():n(this).hide()})}});function Ra(a,b,c,d,e){return new Ra.prototype.init(a,b,c,d,e)}n.Tween=Ra,Ra.prototype={constructor:Ra,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||n.easing._default,this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(n.cssNumber[c]?"":"px")},cur:function(){var a=Ra.propHooks[this.prop];return a&&a.get?a.get(this):Ra.propHooks._default.get(this)},run:function(a){var b,c=Ra.propHooks[this.prop];return this.options.duration?this.pos=b=n.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):this.pos=b=a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):Ra.propHooks._default.set(this),this}},Ra.prototype.init.prototype=Ra.prototype,Ra.propHooks={_default:{get:function(a){var b;return 1!==a.elem.nodeType||null!=a.elem[a.prop]&&null==a.elem.style[a.prop]?a.elem[a.prop]:(b=n.css(a.elem,a.prop,""),b&&"auto"!==b?b:0)},set:function(a){n.fx.step[a.prop]?n.fx.step[a.prop](a):1!==a.elem.nodeType||null==a.elem.style[n.cssProps[a.prop]]&&!n.cssHooks[a.prop]?a.elem[a.prop]=a.now:n.style(a.elem,a.prop,a.now+a.unit)}}},Ra.propHooks.scrollTop=Ra.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},n.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2},_default:"swing"},n.fx=Ra.prototype.init,n.fx.step={};var Sa,Ta,Ua=/^(?:toggle|show|hide)$/,Va=/queueHooks$/;function Wa(){return a.setTimeout(function(){Sa=void 0}),Sa=n.now()}function Xa(a,b){var c,d=0,e={height:a};for(b=b?1:0;4>d;d+=2-b)c=U[d],e["margin"+c]=e["padding"+c]=a;return b&&(e.opacity=e.width=a),e}function Ya(a,b,c){for(var d,e=(_a.tweeners[b]||[]).concat(_a.tweeners["*"]),f=0,g=e.length;g>f;f++)if(d=e[f].call(c,b,a))return d}function Za(a,b,c){var d,e,f,g,h,i,j,k,l=this,m={},o=a.style,p=a.nodeType&&V(a),q=N.get(a,"fxshow");c.queue||(h=n._queueHooks(a,"fx"),null==h.unqueued&&(h.unqueued=0,i=h.empty.fire,h.empty.fire=function(){h.unqueued||i()}),h.unqueued++,l.always(function(){l.always(function(){h.unqueued--,n.queue(a,"fx").length||h.empty.fire()})})),1===a.nodeType&&("height"in b||"width"in b)&&(c.overflow=[o.overflow,o.overflowX,o.overflowY],j=n.css(a,"display"),k="none"===j?N.get(a,"olddisplay")||za(a.nodeName):j,"inline"===k&&"none"===n.css(a,"float")&&(o.display="inline-block")),c.overflow&&(o.overflow="hidden",l.always(function(){o.overflow=c.overflow[0],o.overflowX=c.overflow[1],o.overflowY=c.overflow[2]}));for(d in b)if(e=b[d],Ua.exec(e)){if(delete b[d],f=f||"toggle"===e,e===(p?"hide":"show")){if("show"!==e||!q||void 0===q[d])continue;p=!0}m[d]=q&&q[d]||n.style(a,d)}else j=void 0;if(n.isEmptyObject(m))"inline"===("none"===j?za(a.nodeName):j)&&(o.display=j);else{q?"hidden"in q&&(p=q.hidden):q=N.access(a,"fxshow",{}),f&&(q.hidden=!p),p?n(a).show():l.done(function(){n(a).hide()}),l.done(function(){var b;N.remove(a,"fxshow");for(b in m)n.style(a,b,m[b])});for(d in m)g=Ya(p?q[d]:0,d,l),d in q||(q[d]=g.start,p&&(g.end=g.start,g.start="width"===d||"height"===d?1:0))}}function $a(a,b){var c,d,e,f,g;for(c in a)if(d=n.camelCase(c),e=b[d],f=a[c],n.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=n.cssHooks[d],g&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}function _a(a,b,c){var d,e,f=0,g=_a.prefilters.length,h=n.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=Sa||Wa(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,f=1-d,g=0,i=j.tweens.length;i>g;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),1>f&&i?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:n.extend({},b),opts:n.extend(!0,{specialEasing:{},easing:n.easing._default},c),originalProperties:b,originalOptions:c,startTime:Sa||Wa(),duration:c.duration,tweens:[],createTween:function(b,c){var d=n.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;d>c;c++)j.tweens[c].run(1);return b?(h.notifyWith(a,[j,1,0]),h.resolveWith(a,[j,b])):h.rejectWith(a,[j,b]),this}}),k=j.props;for($a(k,j.opts.specialEasing);g>f;f++)if(d=_a.prefilters[f].call(j,a,k,j.opts))return n.isFunction(d.stop)&&(n._queueHooks(j.elem,j.opts.queue).stop=n.proxy(d.stop,d)),d;return n.map(k,Ya,j),n.isFunction(j.opts.start)&&j.opts.start.call(a,j),n.fx.timer(n.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}n.Animation=n.extend(_a,{tweeners:{"*":[function(a,b){var c=this.createTween(a,b);return W(c.elem,a,T.exec(b),c),c}]},tweener:function(a,b){n.isFunction(a)?(b=a,a=["*"]):a=a.match(G);for(var c,d=0,e=a.length;e>d;d++)c=a[d],_a.tweeners[c]=_a.tweeners[c]||[],_a.tweeners[c].unshift(b)},prefilters:[Za],prefilter:function(a,b){b?_a.prefilters.unshift(a):_a.prefilters.push(a)}}),n.speed=function(a,b,c){var d=a&&"object"==typeof a?n.extend({},a):{complete:c||!c&&b||n.isFunction(a)&&a,duration:a,easing:c&&b||b&&!n.isFunction(b)&&b};return d.duration=n.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in n.fx.speeds?n.fx.speeds[d.duration]:n.fx.speeds._default,null!=d.queue&&d.queue!==!0||(d.queue="fx"),d.old=d.complete,d.complete=function(){n.isFunction(d.old)&&d.old.call(this),d.queue&&n.dequeue(this,d.queue)},d},n.fn.extend({fadeTo:function(a,b,c,d){return this.filter(V).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=n.isEmptyObject(a),f=n.speed(b,c,d),g=function(){var b=_a(this,n.extend({},a),f);(e||N.get(this,"finish"))&&b.stop(!0)};return g.finish=g,e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,b,c){var d=function(a){var b=a.stop;delete a.stop,b(c)};return"string"!=typeof a&&(c=b,b=a,a=void 0),b&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,e=null!=a&&a+"queueHooks",f=n.timers,g=N.get(this);if(e)g[e]&&g[e].stop&&d(g[e]);else for(e in g)g[e]&&g[e].stop&&Va.test(e)&&d(g[e]);for(e=f.length;e--;)f[e].elem!==this||null!=a&&f[e].queue!==a||(f[e].anim.stop(c),b=!1,f.splice(e,1));!b&&c||n.dequeue(this,a)})},finish:function(a){return a!==!1&&(a=a||"fx"),this.each(function(){var b,c=N.get(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=n.timers,g=d?d.length:0;for(c.finish=!0,n.queue(this,a,[]),e&&e.stop&&e.stop.call(this,!0),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;g>b;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),n.each(["toggle","show","hide"],function(a,b){var c=n.fn[b];n.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(Xa(b,!0),a,d,e)}}),n.each({slideDown:Xa("show"),slideUp:Xa("hide"),slideToggle:Xa("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){n.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),n.timers=[],n.fx.tick=function(){var a,b=0,c=n.timers;for(Sa=n.now();b<c.length;b++)a=c[b],a()||c[b]!==a||c.splice(b--,1);c.length||n.fx.stop(),Sa=void 0},n.fx.timer=function(a){n.timers.push(a),a()?n.fx.start():n.timers.pop()},n.fx.interval=13,n.fx.start=function(){Ta||(Ta=a.setInterval(n.fx.tick,n.fx.interval))},n.fx.stop=function(){a.clearInterval(Ta),Ta=null},n.fx.speeds={slow:600,fast:200,_default:400},n.fn.delay=function(b,c){return b=n.fx?n.fx.speeds[b]||b:b,c=c||"fx",this.queue(c,function(c,d){var e=a.setTimeout(c,b);d.stop=function(){a.clearTimeout(e)}})},function(){var a=d.createElement("input"),b=d.createElement("select"),c=b.appendChild(d.createElement("option"));a.type="checkbox",l.checkOn=""!==a.value,l.optSelected=c.selected,b.disabled=!0,l.optDisabled=!c.disabled,a=d.createElement("input"),a.value="t",a.type="radio",l.radioValue="t"===a.value}();var ab,bb=n.expr.attrHandle;n.fn.extend({attr:function(a,b){return K(this,n.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){n.removeAttr(this,a)})}}),n.extend({attr:function(a,b,c){var d,e,f=a.nodeType;if(3!==f&&8!==f&&2!==f)return"undefined"==typeof a.getAttribute?n.prop(a,b,c):(1===f&&n.isXMLDoc(a)||(b=b.toLowerCase(),e=n.attrHooks[b]||(n.expr.match.bool.test(b)?ab:void 0)),void 0!==c?null===c?void n.removeAttr(a,b):e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:(a.setAttribute(b,c+""),c):e&&"get"in e&&null!==(d=e.get(a,b))?d:(d=n.find.attr(a,b),null==d?void 0:d))},attrHooks:{type:{set:function(a,b){if(!l.radioValue&&"radio"===b&&n.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}},removeAttr:function(a,b){var c,d,e=0,f=b&&b.match(G);if(f&&1===a.nodeType)while(c=f[e++])d=n.propFix[c]||c,n.expr.match.bool.test(c)&&(a[d]=!1),a.removeAttribute(c)}}),ab={set:function(a,b,c){return b===!1?n.removeAttr(a,c):a.setAttribute(c,c),c}},n.each(n.expr.match.bool.source.match(/\w+/g),function(a,b){var c=bb[b]||n.find.attr;bb[b]=function(a,b,d){var e,f;return d||(f=bb[b],bb[b]=e,e=null!=c(a,b,d)?b.toLowerCase():null,bb[b]=f),e}});var cb=/^(?:input|select|textarea|button)$/i,db=/^(?:a|area)$/i;n.fn.extend({prop:function(a,b){return K(this,n.prop,a,b,arguments.length>1)},removeProp:function(a){return this.each(function(){delete this[n.propFix[a]||a]})}}),n.extend({prop:function(a,b,c){var d,e,f=a.nodeType;if(3!==f&&8!==f&&2!==f)return 1===f&&n.isXMLDoc(a)||(b=n.propFix[b]||b,e=n.propHooks[b]),
  void 0!==c?e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:a[b]=c:e&&"get"in e&&null!==(d=e.get(a,b))?d:a[b]},propHooks:{tabIndex:{get:function(a){var b=n.find.attr(a,"tabindex");return b?parseInt(b,10):cb.test(a.nodeName)||db.test(a.nodeName)&&a.href?0:-1}}},propFix:{"for":"htmlFor","class":"className"}}),l.optSelected||(n.propHooks.selected={get:function(a){var b=a.parentNode;return b&&b.parentNode&&b.parentNode.selectedIndex,null},set:function(a){var b=a.parentNode;b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex)}}),n.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){n.propFix[this.toLowerCase()]=this});var eb=/[\t\r\n\f]/g;function fb(a){return a.getAttribute&&a.getAttribute("class")||""}n.fn.extend({addClass:function(a){var b,c,d,e,f,g,h,i=0;if(n.isFunction(a))return this.each(function(b){n(this).addClass(a.call(this,b,fb(this)))});if("string"==typeof a&&a){b=a.match(G)||[];while(c=this[i++])if(e=fb(c),d=1===c.nodeType&&(" "+e+" ").replace(eb," ")){g=0;while(f=b[g++])d.indexOf(" "+f+" ")<0&&(d+=f+" ");h=n.trim(d),e!==h&&c.setAttribute("class",h)}}return this},removeClass:function(a){var b,c,d,e,f,g,h,i=0;if(n.isFunction(a))return this.each(function(b){n(this).removeClass(a.call(this,b,fb(this)))});if(!arguments.length)return this.attr("class","");if("string"==typeof a&&a){b=a.match(G)||[];while(c=this[i++])if(e=fb(c),d=1===c.nodeType&&(" "+e+" ").replace(eb," ")){g=0;while(f=b[g++])while(d.indexOf(" "+f+" ")>-1)d=d.replace(" "+f+" "," ");h=n.trim(d),e!==h&&c.setAttribute("class",h)}}return this},toggleClass:function(a,b){var c=typeof a;return"boolean"==typeof b&&"string"===c?b?this.addClass(a):this.removeClass(a):n.isFunction(a)?this.each(function(c){n(this).toggleClass(a.call(this,c,fb(this),b),b)}):this.each(function(){var b,d,e,f;if("string"===c){d=0,e=n(this),f=a.match(G)||[];while(b=f[d++])e.hasClass(b)?e.removeClass(b):e.addClass(b)}else void 0!==a&&"boolean"!==c||(b=fb(this),b&&N.set(this,"__className__",b),this.setAttribute&&this.setAttribute("class",b||a===!1?"":N.get(this,"__className__")||""))})},hasClass:function(a){var b,c,d=0;b=" "+a+" ";while(c=this[d++])if(1===c.nodeType&&(" "+fb(c)+" ").replace(eb," ").indexOf(b)>-1)return!0;return!1}});var gb=/\r/g,hb=/[\x20\t\r\n\f]+/g;n.fn.extend({val:function(a){var b,c,d,e=this[0];{if(arguments.length)return d=n.isFunction(a),this.each(function(c){var e;1===this.nodeType&&(e=d?a.call(this,c,n(this).val()):a,null==e?e="":"number"==typeof e?e+="":n.isArray(e)&&(e=n.map(e,function(a){return null==a?"":a+""})),b=n.valHooks[this.type]||n.valHooks[this.nodeName.toLowerCase()],b&&"set"in b&&void 0!==b.set(this,e,"value")||(this.value=e))});if(e)return b=n.valHooks[e.type]||n.valHooks[e.nodeName.toLowerCase()],b&&"get"in b&&void 0!==(c=b.get(e,"value"))?c:(c=e.value,"string"==typeof c?c.replace(gb,""):null==c?"":c)}}}),n.extend({valHooks:{option:{get:function(a){var b=n.find.attr(a,"value");return null!=b?b:n.trim(n.text(a)).replace(hb," ")}},select:{get:function(a){for(var b,c,d=a.options,e=a.selectedIndex,f="select-one"===a.type||0>e,g=f?null:[],h=f?e+1:d.length,i=0>e?h:f?e:0;h>i;i++)if(c=d[i],(c.selected||i===e)&&(l.optDisabled?!c.disabled:null===c.getAttribute("disabled"))&&(!c.parentNode.disabled||!n.nodeName(c.parentNode,"optgroup"))){if(b=n(c).val(),f)return b;g.push(b)}return g},set:function(a,b){var c,d,e=a.options,f=n.makeArray(b),g=e.length;while(g--)d=e[g],(d.selected=n.inArray(n.valHooks.option.get(d),f)>-1)&&(c=!0);return c||(a.selectedIndex=-1),f}}}}),n.each(["radio","checkbox"],function(){n.valHooks[this]={set:function(a,b){return n.isArray(b)?a.checked=n.inArray(n(a).val(),b)>-1:void 0}},l.checkOn||(n.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})});var ib=/^(?:focusinfocus|focusoutblur)$/;n.extend(n.event,{trigger:function(b,c,e,f){var g,h,i,j,l,m,o,p=[e||d],q=k.call(b,"type")?b.type:b,r=k.call(b,"namespace")?b.namespace.split("."):[];if(h=i=e=e||d,3!==e.nodeType&&8!==e.nodeType&&!ib.test(q+n.event.triggered)&&(q.indexOf(".")>-1&&(r=q.split("."),q=r.shift(),r.sort()),l=q.indexOf(":")<0&&"on"+q,b=b[n.expando]?b:new n.Event(q,"object"==typeof b&&b),b.isTrigger=f?2:3,b.namespace=r.join("."),b.rnamespace=b.namespace?new RegExp("(^|\\.)"+r.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,b.result=void 0,b.target||(b.target=e),c=null==c?[b]:n.makeArray(c,[b]),o=n.event.special[q]||{},f||!o.trigger||o.trigger.apply(e,c)!==!1)){if(!f&&!o.noBubble&&!n.isWindow(e)){for(j=o.delegateType||q,ib.test(j+q)||(h=h.parentNode);h;h=h.parentNode)p.push(h),i=h;i===(e.ownerDocument||d)&&p.push(i.defaultView||i.parentWindow||a)}g=0;while((h=p[g++])&&!b.isPropagationStopped())b.type=g>1?j:o.bindType||q,m=(N.get(h,"events")||{})[b.type]&&N.get(h,"handle"),m&&m.apply(h,c),m=l&&h[l],m&&m.apply&&L(h)&&(b.result=m.apply(h,c),b.result===!1&&b.preventDefault());return b.type=q,f||b.isDefaultPrevented()||o._default&&o._default.apply(p.pop(),c)!==!1||!L(e)||l&&n.isFunction(e[q])&&!n.isWindow(e)&&(i=e[l],i&&(e[l]=null),n.event.triggered=q,e[q](),n.event.triggered=void 0,i&&(e[l]=i)),b.result}},simulate:function(a,b,c){var d=n.extend(new n.Event,c,{type:a,isSimulated:!0});n.event.trigger(d,null,b)}}),n.fn.extend({trigger:function(a,b){return this.each(function(){n.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];return c?n.event.trigger(a,b,c,!0):void 0}}),n.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){n.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),n.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}}),l.focusin="onfocusin"in a,l.focusin||n.each({focus:"focusin",blur:"focusout"},function(a,b){var c=function(a){n.event.simulate(b,a.target,n.event.fix(a))};n.event.special[b]={setup:function(){var d=this.ownerDocument||this,e=N.access(d,b);e||d.addEventListener(a,c,!0),N.access(d,b,(e||0)+1)},teardown:function(){var d=this.ownerDocument||this,e=N.access(d,b)-1;e?N.access(d,b,e):(d.removeEventListener(a,c,!0),N.remove(d,b))}}});var jb=a.location,kb=n.now(),lb=/\?/;n.parseJSON=function(a){return JSON.parse(a+"")},n.parseXML=function(b){var c;if(!b||"string"!=typeof b)return null;try{c=(new a.DOMParser).parseFromString(b,"text/xml")}catch(d){c=void 0}return c&&!c.getElementsByTagName("parsererror").length||n.error("Invalid XML: "+b),c};var mb=/#.*$/,nb=/([?&])_=[^&]*/,ob=/^(.*?):[ \t]*([^\r\n]*)$/gm,pb=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,qb=/^(?:GET|HEAD)$/,rb=/^\/\//,sb={},tb={},ub="*/".concat("*"),vb=d.createElement("a");vb.href=jb.href;function wb(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(G)||[];if(n.isFunction(c))while(d=f[e++])"+"===d[0]?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function xb(a,b,c,d){var e={},f=a===tb;function g(h){var i;return e[h]=!0,n.each(a[h]||[],function(a,h){var j=h(b,c,d);return"string"!=typeof j||f||e[j]?f?!(i=j):void 0:(b.dataTypes.unshift(j),g(j),!1)}),i}return g(b.dataTypes[0])||!e["*"]&&g("*")}function yb(a,b){var c,d,e=n.ajaxSettings.flatOptions||{};for(c in b)void 0!==b[c]&&((e[c]?a:d||(d={}))[c]=b[c]);return d&&n.extend(!0,a,d),a}function zb(a,b,c){var d,e,f,g,h=a.contents,i=a.dataTypes;while("*"===i[0])i.shift(),void 0===d&&(d=a.mimeType||b.getResponseHeader("Content-Type"));if(d)for(e in h)if(h[e]&&h[e].test(d)){i.unshift(e);break}if(i[0]in c)f=i[0];else{for(e in c){if(!i[0]||a.converters[e+" "+i[0]]){f=e;break}g||(g=e)}f=f||g}return f?(f!==i[0]&&i.unshift(f),c[f]):void 0}function Ab(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];f=k.shift();while(f)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if("*"===f)f=i;else if("*"!==i&&i!==f){if(g=j[i+" "+f]||j["* "+f],!g)for(e in j)if(h=e.split(" "),h[1]===f&&(g=j[i+" "+h[0]]||j["* "+h[0]])){g===!0?g=j[e]:j[e]!==!0&&(f=h[0],k.unshift(h[1]));break}if(g!==!0)if(g&&a["throws"])b=g(b);else try{b=g(b)}catch(l){return{state:"parsererror",error:g?l:"No conversion from "+i+" to "+f}}}return{state:"success",data:b}}n.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:jb.href,type:"GET",isLocal:pb.test(jb.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":ub,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":n.parseJSON,"text xml":n.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?yb(yb(a,n.ajaxSettings),b):yb(n.ajaxSettings,a)},ajaxPrefilter:wb(sb),ajaxTransport:wb(tb),ajax:function(b,c){"object"==typeof b&&(c=b,b=void 0),c=c||{};var e,f,g,h,i,j,k,l,m=n.ajaxSetup({},c),o=m.context||m,p=m.context&&(o.nodeType||o.jquery)?n(o):n.event,q=n.Deferred(),r=n.Callbacks("once memory"),s=m.statusCode||{},t={},u={},v=0,w="canceled",x={readyState:0,getResponseHeader:function(a){var b;if(2===v){if(!h){h={};while(b=ob.exec(g))h[b[1].toLowerCase()]=b[2]}b=h[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return 2===v?g:null},setRequestHeader:function(a,b){var c=a.toLowerCase();return v||(a=u[c]=u[c]||a,t[a]=b),this},overrideMimeType:function(a){return v||(m.mimeType=a),this},statusCode:function(a){var b;if(a)if(2>v)for(b in a)s[b]=[s[b],a[b]];else x.always(a[x.status]);return this},abort:function(a){var b=a||w;return e&&e.abort(b),z(0,b),this}};if(q.promise(x).complete=r.add,x.success=x.done,x.error=x.fail,m.url=((b||m.url||jb.href)+"").replace(mb,"").replace(rb,jb.protocol+"//"),m.type=c.method||c.type||m.method||m.type,m.dataTypes=n.trim(m.dataType||"*").toLowerCase().match(G)||[""],null==m.crossDomain){j=d.createElement("a");try{j.href=m.url,j.href=j.href,m.crossDomain=vb.protocol+"//"+vb.host!=j.protocol+"//"+j.host}catch(y){m.crossDomain=!0}}if(m.data&&m.processData&&"string"!=typeof m.data&&(m.data=n.param(m.data,m.traditional)),xb(sb,m,c,x),2===v)return x;k=n.event&&m.global,k&&0===n.active++&&n.event.trigger("ajaxStart"),m.type=m.type.toUpperCase(),m.hasContent=!qb.test(m.type),f=m.url,m.hasContent||(m.data&&(f=m.url+=(lb.test(f)?"&":"?")+m.data,delete m.data),m.cache===!1&&(m.url=nb.test(f)?f.replace(nb,"$1_="+kb++):f+(lb.test(f)?"&":"?")+"_="+kb++)),m.ifModified&&(n.lastModified[f]&&x.setRequestHeader("If-Modified-Since",n.lastModified[f]),n.etag[f]&&x.setRequestHeader("If-None-Match",n.etag[f])),(m.data&&m.hasContent&&m.contentType!==!1||c.contentType)&&x.setRequestHeader("Content-Type",m.contentType),x.setRequestHeader("Accept",m.dataTypes[0]&&m.accepts[m.dataTypes[0]]?m.accepts[m.dataTypes[0]]+("*"!==m.dataTypes[0]?", "+ub+"; q=0.01":""):m.accepts["*"]);for(l in m.headers)x.setRequestHeader(l,m.headers[l]);if(m.beforeSend&&(m.beforeSend.call(o,x,m)===!1||2===v))return x.abort();w="abort";for(l in{success:1,error:1,complete:1})x[l](m[l]);if(e=xb(tb,m,c,x)){if(x.readyState=1,k&&p.trigger("ajaxSend",[x,m]),2===v)return x;m.async&&m.timeout>0&&(i=a.setTimeout(function(){x.abort("timeout")},m.timeout));try{v=1,e.send(t,z)}catch(y){if(!(2>v))throw y;z(-1,y)}}else z(-1,"No Transport");function z(b,c,d,h){var j,l,t,u,w,y=c;2!==v&&(v=2,i&&a.clearTimeout(i),e=void 0,g=h||"",x.readyState=b>0?4:0,j=b>=200&&300>b||304===b,d&&(u=zb(m,x,d)),u=Ab(m,u,x,j),j?(m.ifModified&&(w=x.getResponseHeader("Last-Modified"),w&&(n.lastModified[f]=w),w=x.getResponseHeader("etag"),w&&(n.etag[f]=w)),204===b||"HEAD"===m.type?y="nocontent":304===b?y="notmodified":(y=u.state,l=u.data,t=u.error,j=!t)):(t=y,!b&&y||(y="error",0>b&&(b=0))),x.status=b,x.statusText=(c||y)+"",j?q.resolveWith(o,[l,y,x]):q.rejectWith(o,[x,y,t]),x.statusCode(s),s=void 0,k&&p.trigger(j?"ajaxSuccess":"ajaxError",[x,m,j?l:t]),r.fireWith(o,[x,y]),k&&(p.trigger("ajaxComplete",[x,m]),--n.active||n.event.trigger("ajaxStop")))}return x},getJSON:function(a,b,c){return n.get(a,b,c,"json")},getScript:function(a,b){return n.get(a,void 0,b,"script")}}),n.each(["get","post"],function(a,b){n[b]=function(a,c,d,e){return n.isFunction(c)&&(e=e||d,d=c,c=void 0),n.ajax(n.extend({url:a,type:b,dataType:e,data:c,success:d},n.isPlainObject(a)&&a))}}),n._evalUrl=function(a){return n.ajax({url:a,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},n.fn.extend({wrapAll:function(a){var b;return n.isFunction(a)?this.each(function(b){n(this).wrapAll(a.call(this,b))}):(this[0]&&(b=n(a,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstElementChild)a=a.firstElementChild;return a}).append(this)),this)},wrapInner:function(a){return n.isFunction(a)?this.each(function(b){n(this).wrapInner(a.call(this,b))}):this.each(function(){var b=n(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=n.isFunction(a);return this.each(function(c){n(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){n.nodeName(this,"body")||n(this).replaceWith(this.childNodes)}).end()}}),n.expr.filters.hidden=function(a){return!n.expr.filters.visible(a)},n.expr.filters.visible=function(a){return a.offsetWidth>0||a.offsetHeight>0||a.getClientRects().length>0};var Bb=/%20/g,Cb=/\[\]$/,Db=/\r?\n/g,Eb=/^(?:submit|button|image|reset|file)$/i,Fb=/^(?:input|select|textarea|keygen)/i;function Gb(a,b,c,d){var e;if(n.isArray(b))n.each(b,function(b,e){c||Cb.test(a)?d(a,e):Gb(a+"["+("object"==typeof e&&null!=e?b:"")+"]",e,c,d)});else if(c||"object"!==n.type(b))d(a,b);else for(e in b)Gb(a+"["+e+"]",b[e],c,d)}n.param=function(a,b){var c,d=[],e=function(a,b){b=n.isFunction(b)?b():null==b?"":b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(void 0===b&&(b=n.ajaxSettings&&n.ajaxSettings.traditional),n.isArray(a)||a.jquery&&!n.isPlainObject(a))n.each(a,function(){e(this.name,this.value)});else for(c in a)Gb(c,a[c],b,e);return d.join("&").replace(Bb,"+")},n.fn.extend({serialize:function(){return n.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=n.prop(this,"elements");return a?n.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!n(this).is(":disabled")&&Fb.test(this.nodeName)&&!Eb.test(a)&&(this.checked||!X.test(a))}).map(function(a,b){var c=n(this).val();return null==c?null:n.isArray(c)?n.map(c,function(a){return{name:b.name,value:a.replace(Db,"\r\n")}}):{name:b.name,value:c.replace(Db,"\r\n")}}).get()}}),n.ajaxSettings.xhr=function(){try{return new a.XMLHttpRequest}catch(b){}};var Hb={0:200,1223:204},Ib=n.ajaxSettings.xhr();l.cors=!!Ib&&"withCredentials"in Ib,l.ajax=Ib=!!Ib,n.ajaxTransport(function(b){var c,d;return l.cors||Ib&&!b.crossDomain?{send:function(e,f){var g,h=b.xhr();if(h.open(b.type,b.url,b.async,b.username,b.password),b.xhrFields)for(g in b.xhrFields)h[g]=b.xhrFields[g];b.mimeType&&h.overrideMimeType&&h.overrideMimeType(b.mimeType),b.crossDomain||e["X-Requested-With"]||(e["X-Requested-With"]="XMLHttpRequest");for(g in e)h.setRequestHeader(g,e[g]);c=function(a){return function(){c&&(c=d=h.onload=h.onerror=h.onabort=h.onreadystatechange=null,"abort"===a?h.abort():"error"===a?"number"!=typeof h.status?f(0,"error"):f(h.status,h.statusText):f(Hb[h.status]||h.status,h.statusText,"text"!==(h.responseType||"text")||"string"!=typeof h.responseText?{binary:h.response}:{text:h.responseText},h.getAllResponseHeaders()))}},h.onload=c(),d=h.onerror=c("error"),void 0!==h.onabort?h.onabort=d:h.onreadystatechange=function(){4===h.readyState&&a.setTimeout(function(){c&&d()})},c=c("abort");try{h.send(b.hasContent&&b.data||null)}catch(i){if(c)throw i}},abort:function(){c&&c()}}:void 0}),n.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(a){return n.globalEval(a),a}}}),n.ajaxPrefilter("script",function(a){void 0===a.cache&&(a.cache=!1),a.crossDomain&&(a.type="GET")}),n.ajaxTransport("script",function(a){if(a.crossDomain){var b,c;return{send:function(e,f){b=n("<script>").prop({charset:a.scriptCharset,src:a.url}).on("load error",c=function(a){b.remove(),c=null,a&&f("error"===a.type?404:200,a.type)}),d.head.appendChild(b[0])},abort:function(){c&&c()}}}});var Jb=[],Kb=/(=)\?(?=&|$)|\?\?/;n.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=Jb.pop()||n.expando+"_"+kb++;return this[a]=!0,a}}),n.ajaxPrefilter("json jsonp",function(b,c,d){var e,f,g,h=b.jsonp!==!1&&(Kb.test(b.url)?"url":"string"==typeof b.data&&0===(b.contentType||"").indexOf("application/x-www-form-urlencoded")&&Kb.test(b.data)&&"data");return h||"jsonp"===b.dataTypes[0]?(e=b.jsonpCallback=n.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,h?b[h]=b[h].replace(Kb,"$1"+e):b.jsonp!==!1&&(b.url+=(lb.test(b.url)?"&":"?")+b.jsonp+"="+e),b.converters["script json"]=function(){return g||n.error(e+" was not called"),g[0]},b.dataTypes[0]="json",f=a[e],a[e]=function(){g=arguments},d.always(function(){void 0===f?n(a).removeProp(e):a[e]=f,b[e]&&(b.jsonpCallback=c.jsonpCallback,Jb.push(e)),g&&n.isFunction(f)&&f(g[0]),g=f=void 0}),"script"):void 0}),n.parseHTML=function(a,b,c){if(!a||"string"!=typeof a)return null;"boolean"==typeof b&&(c=b,b=!1),b=b||d;var e=x.exec(a),f=!c&&[];return e?[b.createElement(e[1])]:(e=ca([a],b,f),f&&f.length&&n(f).remove(),n.merge([],e.childNodes))};var Lb=n.fn.load;n.fn.load=function(a,b,c){if("string"!=typeof a&&Lb)return Lb.apply(this,arguments);var d,e,f,g=this,h=a.indexOf(" ");return h>-1&&(d=n.trim(a.slice(h)),a=a.slice(0,h)),n.isFunction(b)?(c=b,b=void 0):b&&"object"==typeof b&&(e="POST"),g.length>0&&n.ajax({url:a,type:e||"GET",dataType:"html",data:b}).done(function(a){f=arguments,g.html(d?n("<div>").append(n.parseHTML(a)).find(d):a)}).always(c&&function(a,b){g.each(function(){c.apply(this,f||[a.responseText,b,a])})}),this},n.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){n.fn[b]=function(a){return this.on(b,a)}}),n.expr.filters.animated=function(a){return n.grep(n.timers,function(b){return a===b.elem}).length};function Mb(a){return n.isWindow(a)?a:9===a.nodeType&&a.defaultView}n.offset={setOffset:function(a,b,c){var d,e,f,g,h,i,j,k=n.css(a,"position"),l=n(a),m={};"static"===k&&(a.style.position="relative"),h=l.offset(),f=n.css(a,"top"),i=n.css(a,"left"),j=("absolute"===k||"fixed"===k)&&(f+i).indexOf("auto")>-1,j?(d=l.position(),g=d.top,e=d.left):(g=parseFloat(f)||0,e=parseFloat(i)||0),n.isFunction(b)&&(b=b.call(a,c,n.extend({},h))),null!=b.top&&(m.top=b.top-h.top+g),null!=b.left&&(m.left=b.left-h.left+e),"using"in b?b.using.call(a,m):l.css(m)}},n.fn.extend({offset:function(a){if(arguments.length)return void 0===a?this:this.each(function(b){n.offset.setOffset(this,a,b)});var b,c,d=this[0],e={top:0,left:0},f=d&&d.ownerDocument;if(f)return b=f.documentElement,n.contains(b,d)?(e=d.getBoundingClientRect(),c=Mb(f),{top:e.top+c.pageYOffset-b.clientTop,left:e.left+c.pageXOffset-b.clientLeft}):e},position:function(){if(this[0]){var a,b,c=this[0],d={top:0,left:0};return"fixed"===n.css(c,"position")?b=c.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),n.nodeName(a[0],"html")||(d=a.offset()),d.top+=n.css(a[0],"borderTopWidth",!0),d.left+=n.css(a[0],"borderLeftWidth",!0)),{top:b.top-d.top-n.css(c,"marginTop",!0),left:b.left-d.left-n.css(c,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var a=this.offsetParent;while(a&&"static"===n.css(a,"position"))a=a.offsetParent;return a||Ea})}}),n.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,b){var c="pageYOffset"===b;n.fn[a]=function(d){return K(this,function(a,d,e){var f=Mb(a);return void 0===e?f?f[b]:a[d]:void(f?f.scrollTo(c?f.pageXOffset:e,c?e:f.pageYOffset):a[d]=e)},a,d,arguments.length)}}),n.each(["top","left"],function(a,b){n.cssHooks[b]=Ga(l.pixelPosition,function(a,c){return c?(c=Fa(a,b),Ba.test(c)?n(a).position()[b]+"px":c):void 0})}),n.each({Height:"height",Width:"width"},function(a,b){n.each({padding:"inner"+a,content:b,"":"outer"+a},function(c,d){n.fn[d]=function(d,e){var f=arguments.length&&(c||"boolean"!=typeof d),g=c||(d===!0||e===!0?"margin":"border");return K(this,function(b,c,d){var e;return n.isWindow(b)?b.document.documentElement["client"+a]:9===b.nodeType?(e=b.documentElement,Math.max(b.body["scroll"+a],e["scroll"+a],b.body["offset"+a],e["offset"+a],e["client"+a])):void 0===d?n.css(b,c,g):n.style(b,c,d,g)},b,f?d:void 0,f,null)}})}),n.fn.extend({bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)},size:function(){return this.length}}),n.fn.andSelf=n.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return n});var Nb=a.jQuery,Ob=a.$;return n.noConflict=function(b){return a.$===n&&(a.$=Ob),b&&a.jQuery===n&&(a.jQuery=Nb),n},b||(a.jQuery=a.$=n),n});
!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){function b(){c&&(window.requestAnimationFrame(b),a.fx.tick())}if(Number(a.fn.jquery.split(".")[0])>=3)return void(window.console&&window.console.warn&&window.console.warn("The jquery.requestanimationframe plugin is not needed in jQuery 3.0 or newer as they handle it natively."));var c;window.requestAnimationFrame&&(a.fx.timer=function(d){d()&&a.timers.push(d)&&!c&&(c=!0,b())},a.fx.stop=function(){c=!1})});
(function(a){if(typeof define==='function'&&define.amd){define(['jquery'],a)}else if(typeof exports==='object'){module.exports=a(require('jquery'))}else{a(jQuery)}}(function($){if($.support.cors||!$.ajaxTransport||!window.XDomainRequest){return}var n=/^https?:\/\//i;var o=/^get|post$/i;var p=new RegExp('^'+location.protocol,'i');$.ajaxTransport('* text html xml json',function(j,k,l){if(!j.crossDomain||!j.async||!o.test(j.type)||!n.test(j.url)||!p.test(j.url)){return}var m=null;return{send:function(f,g){var h='';var i=(k.dataType||'').toLowerCase();m=new XDomainRequest();if(/^\d+$/.test(k.timeout)){m.timeout=k.timeout}m.ontimeout=function(){g(500,'timeout')};m.onload=function(){var a='Content-Length: '+m.responseText.length+'\r\nContent-Type: '+m.contentType;var b={code:200,message:'success'};var c={text:m.responseText};try{if(i==='html'||/text\/html/i.test(m.contentType)){c.html=m.responseText}else if(i==='json'||(i!=='text'&&/\/json/i.test(m.contentType))){try{c.json=$.parseJSON(m.responseText)}catch(e){b.code=500;b.message='parseerror'}}else if(i==='xml'||(i!=='text'&&/\/xml/i.test(m.contentType))){var d=new ActiveXObject('Microsoft.XMLDOM');d.async=false;try{d.loadXML(m.responseText)}catch(e){d=undefined}if(!d||!d.documentElement||d.getElementsByTagName('parsererror').length){b.code=500;b.message='parseerror';throw'Invalid XML: '+m.responseText;}c.xml=d}}catch(parseMessage){throw parseMessage;}finally{g(b.code,b.message,c,a)}};m.onprogress=function(){};m.onerror=function(){g(500,'error',{text:m.responseText})};if(k.data){h=($.type(k.data)==='string')?k.data:$.param(k.data)}m.open(j.type,j.url);m.send(h)},abort:function(){if(m){m.abort()}}}})}));



if("undefined"==typeof jQuery)throw new Error("Bootstrap's JavaScript requires jQuery");+function(t){"use strict";var e=t.fn.jquery.split(" ")[0].split(".");if(e[0]<2&&e[1]<9||1==e[0]&&9==e[1]&&e[2]<1)throw new Error("Bootstrap's JavaScript requires jQuery version 1.9.1 or higher")}(jQuery),+function(t){"use strict";function e(e){return this.each(function(){var i=t(this),n=i.data("bs.alert");n||i.data("bs.alert",n=new o(this)),"string"==typeof e&&n[e].call(i)})}var i='[data-dismiss="alert"]',o=function(e){t(e).on("click",i,this.close)};o.VERSION="3.3.5",o.TRANSITION_DURATION=150,o.prototype.close=function(e){function i(){a.detach().trigger("closed.bs.alert").remove()}var n=t(this),s=n.attr("data-target");s||(s=n.attr("href"),s=s&&s.replace(/.*(?=#[^\s]*$)/,""));var a=t(s);e&&e.preventDefault(),a.length||(a=n.closest(".alert")),a.trigger(e=t.Event("close.bs.alert")),e.isDefaultPrevented()||(a.removeClass("in"),t.support.transition&&a.hasClass("fade")?a.one("bsTransitionEnd",i).emulateTransitionEnd(o.TRANSITION_DURATION):i())};var n=t.fn.alert;t.fn.alert=e,t.fn.alert.Constructor=o,t.fn.alert.noConflict=function(){return t.fn.alert=n,this},t(document).on("click.bs.alert.data-api",i,o.prototype.close)}(jQuery),+function(t){"use strict";function e(e){return this.each(function(){var o=t(this),n=o.data("bs.button"),s="object"==typeof e&&e;n||o.data("bs.button",n=new i(this,s)),"toggle"==e?n.toggle():e&&n.setState(e)})}var i=function(e,o){this.$element=t(e),this.options=t.extend({},i.DEFAULTS,o),this.isLoading=!1};i.VERSION="3.3.5",i.DEFAULTS={loadingText:"loading..."},i.prototype.setState=function(e){var i="disabled",o=this.$element,n=o.is("input")?"val":"html",s=o.data();e+="Text",null==s.resetText&&o.data("resetText",o[n]()),setTimeout(t.proxy(function(){o[n](null==s[e]?this.options[e]:s[e]),"loadingText"==e?(this.isLoading=!0,o.addClass(i).attr(i,i)):this.isLoading&&(this.isLoading=!1,o.removeClass(i).removeAttr(i))},this),0)},i.prototype.toggle=function(){var t=!0,e=this.$element.closest('[data-toggle="buttons"]');if(e.length){var i=this.$element.find("input");"radio"==i.prop("type")?(i.prop("checked")&&(t=!1),e.find(".active").removeClass("active"),this.$element.addClass("active")):"checkbox"==i.prop("type")&&(i.prop("checked")!==this.$element.hasClass("active")&&(t=!1),this.$element.toggleClass("active")),i.prop("checked",this.$element.hasClass("active")),t&&i.trigger("change")}else this.$element.attr("aria-pressed",!this.$element.hasClass("active")),this.$element.toggleClass("active")};var o=t.fn.button;t.fn.button=e,t.fn.button.Constructor=i,t.fn.button.noConflict=function(){return t.fn.button=o,this},t(document).on("click.bs.button.data-api",'[data-toggle^="button"]',function(i){var o=t(i.target);o.hasClass("btn")||(o=o.closest(".btn")),e.call(o,"toggle"),t(i.target).is('input[type="radio"]')||t(i.target).is('input[type="checkbox"]')||i.preventDefault()}).on("focus.bs.button.data-api blur.bs.button.data-api",'[data-toggle^="button"]',function(e){t(e.target).closest(".btn").toggleClass("focus",/^focus(in)?$/.test(e.type))})}(jQuery),+function(t){"use strict";function e(e){return this.each(function(){var o=t(this),n=o.data("bs.carousel"),s=t.extend({},i.DEFAULTS,o.data(),"object"==typeof e&&e),a="string"==typeof e?e:s.slide;n||o.data("bs.carousel",n=new i(this,s)),"number"==typeof e?n.to(e):a?n[a]():s.interval&&n.pause().cycle()})}var i=function(e,i){this.$element=t(e),this.$indicators=this.$element.find(".carousel-indicators"),this.options=i,this.paused=null,this.sliding=null,this.interval=null,this.$active=null,this.$items=null,this.options.keyboard&&this.$element.on("keydown.bs.carousel",t.proxy(this.keydown,this)),"hover"==this.options.pause&&!("ontouchstart"in document.documentElement)&&this.$element.on("mouseenter.bs.carousel",t.proxy(this.pause,this)).on("mouseleave.bs.carousel",t.proxy(this.cycle,this))};i.VERSION="3.3.5",i.TRANSITION_DURATION=600,i.DEFAULTS={interval:5e3,pause:"hover",wrap:!0,keyboard:!0},i.prototype.keydown=function(t){if(!/input|textarea/i.test(t.target.tagName)){switch(t.which){case 37:this.prev();break;case 39:this.next();break;default:return}t.preventDefault()}},i.prototype.cycle=function(e){return e||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(t.proxy(this.next,this),this.options.interval)),this},i.prototype.getItemIndex=function(t){return this.$items=t.parent().children(".item"),this.$items.index(t||this.$active)},i.prototype.getItemForDirection=function(t,e){var i=this.getItemIndex(e),o="prev"==t&&0===i||"next"==t&&i==this.$items.length-1;if(o&&!this.options.wrap)return e;var n="prev"==t?-1:1,s=(i+n)%this.$items.length;return this.$items.eq(s)},i.prototype.to=function(t){var e=this,i=this.getItemIndex(this.$active=this.$element.find(".item.active"));return t>this.$items.length-1||0>t?void 0:this.sliding?this.$element.one("slid.bs.carousel",function(){e.to(t)}):i==t?this.pause().cycle():this.slide(t>i?"next":"prev",this.$items.eq(t))},i.prototype.pause=function(e){return e||(this.paused=!0),this.$element.find(".next, .prev").length&&t.support.transition&&(this.$element.trigger(t.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},i.prototype.next=function(){return this.sliding?void 0:this.slide("next")},i.prototype.prev=function(){return this.sliding?void 0:this.slide("prev")},i.prototype.slide=function(e,o){var n=this.$element.find(".item.active"),s=o||this.getItemForDirection(e,n),a=this.interval,r="next"==e?"left":"right",l=this;if(s.hasClass("active"))return this.sliding=!1;var h=s[0],d=t.Event("slide.bs.carousel",{relatedTarget:h,direction:r});if(this.$element.trigger(d),!d.isDefaultPrevented()){if(this.sliding=!0,a&&this.pause(),this.$indicators.length){this.$indicators.find(".active").removeClass("active");var p=t(this.$indicators.children()[this.getItemIndex(s)]);p&&p.addClass("active")}var c=t.Event("slid.bs.carousel",{relatedTarget:h,direction:r});return t.support.transition&&this.$element.hasClass("slide")?(s.addClass(e),s[0].offsetWidth,n.addClass(r),s.addClass(r),n.one("bsTransitionEnd",function(){s.removeClass([e,r].join(" ")).addClass("active"),n.removeClass(["active",r].join(" ")),l.sliding=!1,setTimeout(function(){l.$element.trigger(c)},0)}).emulateTransitionEnd(i.TRANSITION_DURATION)):(n.removeClass("active"),s.addClass("active"),this.sliding=!1,this.$element.trigger(c)),a&&this.cycle(),this}};var o=t.fn.carousel;t.fn.carousel=e,t.fn.carousel.Constructor=i,t.fn.carousel.noConflict=function(){return t.fn.carousel=o,this};var n=function(i){var o,n=t(this),s=t(n.attr("data-target")||(o=n.attr("href"))&&o.replace(/.*(?=#[^\s]+$)/,""));if(s.hasClass("carousel")){var a=t.extend({},s.data(),n.data()),r=n.attr("data-slide-to");r&&(a.interval=!1),e.call(s,a),r&&s.data("bs.carousel").to(r),i.preventDefault()}};t(document).on("click.bs.carousel.data-api","[data-slide]",n).on("click.bs.carousel.data-api","[data-slide-to]",n),t(window).on("load",function(){t('[data-ride="carousel"]').each(function(){var i=t(this);e.call(i,i.data())})})}(jQuery),+function(t){"use strict";function e(e){var i=e.attr("data-target");i||(i=e.attr("href"),i=i&&/#[A-Za-z]/.test(i)&&i.replace(/.*(?=#[^\s]*$)/,""));var o=i&&t(i);return o&&o.length?o:e.parent()}function i(i){i&&3===i.which||(t(n).remove(),t(s).each(function(){var o=t(this),n=e(o),s={relatedTarget:this};n.hasClass("open")&&(i&&"click"==i.type&&/input|textarea/i.test(i.target.tagName)&&t.contains(n[0],i.target)||(n.trigger(i=t.Event("hide.bs.dropdown",s)),i.isDefaultPrevented()||(o.attr("aria-expanded","false"),n.removeClass("open").trigger("hidden.bs.dropdown",s))))}))}function o(e){return this.each(function(){var i=t(this),o=i.data("bs.dropdown");o||i.data("bs.dropdown",o=new a(this)),"string"==typeof e&&o[e].call(i)})}var n=".dropdown-backdrop",s='[data-toggle="dropdown"]',a=function(e){t(e).on("click.bs.dropdown",this.toggle)};a.VERSION="3.3.5",a.prototype.toggle=function(o){var n=t(this);if(!n.is(".disabled, :disabled")){var s=e(n),a=s.hasClass("open");if(i(),!a){"ontouchstart"in document.documentElement&&!s.closest(".navbar-nav").length&&t(document.createElement("div")).addClass("dropdown-backdrop").insertAfter(t(this)).on("click",i);var r={relatedTarget:this};if(s.trigger(o=t.Event("show.bs.dropdown",r)),o.isDefaultPrevented())return;n.trigger("focus").attr("aria-expanded","true"),s.toggleClass("open").trigger("shown.bs.dropdown",r)}return!1}},a.prototype.keydown=function(i){if(/(38|40|27|32)/.test(i.which)&&!/input|textarea/i.test(i.target.tagName)){var o=t(this);if(i.preventDefault(),i.stopPropagation(),!o.is(".disabled, :disabled")){var n=e(o),a=n.hasClass("open");if(!a&&27!=i.which||a&&27==i.which)return 27==i.which&&n.find(s).trigger("focus"),o.trigger("click");var r=" li:not(.disabled):visible a",l=n.find(".dropdown-menu"+r);if(l.length){var h=l.index(i.target);38==i.which&&h>0&&h--,40==i.which&&h<l.length-1&&h++,~h||(h=0),l.eq(h).trigger("focus")}}}};var r=t.fn.dropdown;t.fn.dropdown=o,t.fn.dropdown.Constructor=a,t.fn.dropdown.noConflict=function(){return t.fn.dropdown=r,this},t(document).on("click.bs.dropdown.data-api",i).on("click.bs.dropdown.data-api",".dropdown form",function(t){t.stopPropagation()}).on("click.bs.dropdown.data-api",s,a.prototype.toggle).on("keydown.bs.dropdown.data-api",s,a.prototype.keydown).on("keydown.bs.dropdown.data-api",".dropdown-menu",a.prototype.keydown)}(jQuery),+function(t){"use strict";function e(e,o){return this.each(function(){var n=t(this),s=n.data("bs.modal"),a=t.extend({},i.DEFAULTS,n.data(),"object"==typeof e&&e);s||n.data("bs.modal",s=new i(this,a)),"string"==typeof e?s[e](o):a.show&&s.show(o)})}var i=function(e,i){this.options=i,this.$body=t(document.body),this.$element=t(e),this.$dialog=this.$element.find(".modal-dialog"),this.$backdrop=null,this.isShown=null,this.originalBodyPad=null,this.scrollbarWidth=0,this.ignoreBackdropClick=!1,this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,t.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))};i.VERSION="3.3.5",i.TRANSITION_DURATION=300,i.BACKDROP_TRANSITION_DURATION=150,i.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},i.prototype.toggle=function(t){return this.isShown?this.hide():this.show(t)},i.prototype.show=function(e){var o=this,n=t.Event("show.bs.modal",{relatedTarget:e});this.$element.trigger(n),this.isShown||n.isDefaultPrevented()||(this.isShown=!0,this.checkScrollbar(),this.setScrollbar(),this.$body.addClass("modal-open"),this.escape(),this.resize(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',t.proxy(this.hide,this)),this.$dialog.on("mousedown.dismiss.bs.modal",function(){o.$element.one("mouseup.dismiss.bs.modal",function(e){t(e.target).is(o.$element)&&(o.ignoreBackdropClick=!0)})}),this.backdrop(function(){var n=t.support.transition&&o.$element.hasClass("fade");o.$element.parent().length||o.$element.appendTo(o.$body),o.$element.show().scrollTop(0),o.adjustDialog(),n&&o.$element[0].offsetWidth,o.$element.addClass("in"),o.enforceFocus();var s=t.Event("shown.bs.modal",{relatedTarget:e});n?o.$dialog.one("bsTransitionEnd",function(){o.$element.trigger("focus").trigger(s)}).emulateTransitionEnd(i.TRANSITION_DURATION):o.$element.trigger("focus").trigger(s)}))},i.prototype.hide=function(e){e&&e.preventDefault(),e=t.Event("hide.bs.modal"),this.$element.trigger(e),this.isShown&&!e.isDefaultPrevented()&&(this.isShown=!1,this.escape(),this.resize(),t(document).off("focusin.bs.modal"),this.$element.removeClass("in").off("click.dismiss.bs.modal").off("mouseup.dismiss.bs.modal"),this.$dialog.off("mousedown.dismiss.bs.modal"),t.support.transition&&this.$element.hasClass("fade")?this.$element.one("bsTransitionEnd",t.proxy(this.hideModal,this)).emulateTransitionEnd(i.TRANSITION_DURATION):this.hideModal())},i.prototype.enforceFocus=function(){t(document).off("focusin.bs.modal").on("focusin.bs.modal",t.proxy(function(t){this.$element[0]===t.target||this.$element.has(t.target).length||this.$element.trigger("focus")},this))},i.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keydown.dismiss.bs.modal",t.proxy(function(t){27==t.which&&this.hide()},this)):this.isShown||this.$element.off("keydown.dismiss.bs.modal")},i.prototype.resize=function(){this.isShown?t(window).on("resize.bs.modal",t.proxy(this.handleUpdate,this)):t(window).off("resize.bs.modal")},i.prototype.hideModal=function(){var t=this;this.$element.hide(),this.backdrop(function(){t.$body.removeClass("modal-open"),t.resetAdjustments(),t.resetScrollbar(),t.$element.trigger("hidden.bs.modal")})},i.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},i.prototype.backdrop=function(e){var o=this,n=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var s=t.support.transition&&n;if(this.$backdrop=t(document.createElement("div")).addClass("modal-backdrop "+n).appendTo(this.$body),this.$element.on("click.dismiss.bs.modal",t.proxy(function(t){return this.ignoreBackdropClick?void(this.ignoreBackdropClick=!1):void(t.target===t.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus():this.hide()))},this)),s&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!e)return;s?this.$backdrop.one("bsTransitionEnd",e).emulateTransitionEnd(i.BACKDROP_TRANSITION_DURATION):e()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");var a=function(){o.removeBackdrop(),e&&e()};t.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one("bsTransitionEnd",a).emulateTransitionEnd(i.BACKDROP_TRANSITION_DURATION):a()}else e&&e()},i.prototype.handleUpdate=function(){this.adjustDialog()},i.prototype.adjustDialog=function(){var t=this.$element[0].scrollHeight>document.documentElement.clientHeight;this.$element.css({paddingLeft:!this.bodyIsOverflowing&&t?this.scrollbarWidth:"",paddingRight:this.bodyIsOverflowing&&!t?this.scrollbarWidth:""})},i.prototype.resetAdjustments=function(){this.$element.css({paddingLeft:"",paddingRight:""})},i.prototype.checkScrollbar=function(){var t=window.innerWidth;if(!t){var e=document.documentElement.getBoundingClientRect();t=e.right-Math.abs(e.left)}this.bodyIsOverflowing=document.body.clientWidth<t,this.scrollbarWidth=this.measureScrollbar()},i.prototype.setScrollbar=function(){var t=parseInt(this.$body.css("padding-right")||0,10);this.originalBodyPad=document.body.style.paddingRight||"",this.bodyIsOverflowing&&this.$body.css("padding-right",t+this.scrollbarWidth)},i.prototype.resetScrollbar=function(){this.$body.css("padding-right",this.originalBodyPad)},i.prototype.measureScrollbar=function(){var t=document.createElement("div");t.className="modal-scrollbar-measure",this.$body.append(t);var e=t.offsetWidth-t.clientWidth;return this.$body[0].removeChild(t),e};var o=t.fn.modal;t.fn.modal=e,t.fn.modal.Constructor=i,t.fn.modal.noConflict=function(){return t.fn.modal=o,this},t(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(i){var o=t(this),n=o.attr("href"),s=t(o.attr("data-target")||n&&n.replace(/.*(?=#[^\s]+$)/,"")),a=s.data("bs.modal")?"toggle":t.extend({remote:!/#/.test(n)&&n},s.data(),o.data());o.is("a")&&i.preventDefault(),s.one("show.bs.modal",function(t){t.isDefaultPrevented()||s.one("hidden.bs.modal",function(){o.is(":visible")&&o.trigger("focus")})}),e.call(s,a,this)})}(jQuery),+function(t){"use strict";function e(e){return this.each(function(){var o=t(this),n=o.data("bs.tooltip"),s="object"==typeof e&&e;(n||!/destroy|hide/.test(e))&&(n||o.data("bs.tooltip",n=new i(this,s)),"string"==typeof e&&n[e]())})}var i=function(t,e){this.type=null,this.options=null,this.enabled=null,this.timeout=null,this.hoverState=null,this.$element=null,this.inState=null,this.init("tooltip",t,e)};i.VERSION="3.3.5",i.TRANSITION_DURATION=150,i.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1,viewport:{selector:"body",padding:0}},i.prototype.init=function(e,i,o){if(this.enabled=!0,this.type=e,this.$element=t(i),this.options=this.getOptions(o),this.$viewport=this.options.viewport&&t(t.isFunction(this.options.viewport)?this.options.viewport.call(this,this.$element):this.options.viewport.selector||this.options.viewport),this.inState={click:!1,hover:!1,focus:!1},this.$element[0]instanceof document.constructor&&!this.options.selector)throw new Error("`selector` option must be specified when initializing "+this.type+" on the window.document object!");for(var n=this.options.trigger.split(" "),s=n.length;s--;){var a=n[s];if("click"==a)this.$element.on("click."+this.type,this.options.selector,t.proxy(this.toggle,this));else if("manual"!=a){var r="hover"==a?"mouseenter":"focusin",l="hover"==a?"mouseleave":"focusout";this.$element.on(r+"."+this.type,this.options.selector,t.proxy(this.enter,this)),this.$element.on(l+"."+this.type,this.options.selector,t.proxy(this.leave,this))}}this.options.selector?this._options=t.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},i.prototype.getDefaults=function(){return i.DEFAULTS},i.prototype.getOptions=function(e){return e=t.extend({},this.getDefaults(),this.$element.data(),e),e.delay&&"number"==typeof e.delay&&(e.delay={show:e.delay,hide:e.delay}),e},i.prototype.getDelegateOptions=function(){var e={},i=this.getDefaults();return this._options&&t.each(this._options,function(t,o){i[t]!=o&&(e[t]=o)}),e},i.prototype.enter=function(e){var i=e instanceof this.constructor?e:t(e.currentTarget).data("bs."+this.type);return i||(i=new this.constructor(e.currentTarget,this.getDelegateOptions()),t(e.currentTarget).data("bs."+this.type,i)),e instanceof t.Event&&(i.inState["focusin"==e.type?"focus":"hover"]=!0),i.tip().hasClass("in")||"in"==i.hoverState?void(i.hoverState="in"):(clearTimeout(i.timeout),i.hoverState="in",i.options.delay&&i.options.delay.show?void(i.timeout=setTimeout(function(){"in"==i.hoverState&&i.show()},i.options.delay.show)):i.show())},i.prototype.isInStateTrue=function(){for(var t in this.inState)if(this.inState[t])return!0;return!1},i.prototype.leave=function(e){var i=e instanceof this.constructor?e:t(e.currentTarget).data("bs."+this.type);return i||(i=new this.constructor(e.currentTarget,this.getDelegateOptions()),t(e.currentTarget).data("bs."+this.type,i)),e instanceof t.Event&&(i.inState["focusout"==e.type?"focus":"hover"]=!1),i.isInStateTrue()?void 0:(clearTimeout(i.timeout),i.hoverState="out",i.options.delay&&i.options.delay.hide?void(i.timeout=setTimeout(function(){"out"==i.hoverState&&i.hide()},i.options.delay.hide)):i.hide())},i.prototype.show=function(){var e=t.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(e);var o=t.contains(this.$element[0].ownerDocument.documentElement,this.$element[0]);if(e.isDefaultPrevented()||!o)return;var n=this,s=this.tip(),a=this.getUID(this.type);this.setContent(),s.attr("id",a),this.$element.attr("aria-describedby",a),this.options.animation&&s.addClass("fade");var r="function"==typeof this.options.placement?this.options.placement.call(this,s[0],this.$element[0]):this.options.placement,l=/\s?auto?\s?/i,h=l.test(r);h&&(r=r.replace(l,"")||"top"),s.detach().css({top:0,left:0,display:"block"}).addClass(r).data("bs."+this.type,this),this.options.container?s.appendTo(this.options.container):s.insertAfter(this.$element),this.$element.trigger("inserted.bs."+this.type);var d=this.getPosition(),p=s[0].offsetWidth,c=s[0].offsetHeight;if(h){var f=r,u=this.getPosition(this.$viewport);r="bottom"==r&&d.bottom+c>u.bottom?"top":"top"==r&&d.top-c<u.top?"bottom":"right"==r&&d.right+p>u.width?"left":"left"==r&&d.left-p<u.left?"right":r,s.removeClass(f).addClass(r)}var g=this.getCalculatedOffset(r,d,p,c);this.applyPlacement(g,r);var m=function(){var t=n.hoverState;n.$element.trigger("shown.bs."+n.type),n.hoverState=null,"out"==t&&n.leave(n)};t.support.transition&&this.$tip.hasClass("fade")?s.one("bsTransitionEnd",m).emulateTransitionEnd(i.TRANSITION_DURATION):m()}},i.prototype.applyPlacement=function(e,i){var o=this.tip(),n=o[0].offsetWidth,s=o[0].offsetHeight,a=parseInt(o.css("margin-top"),10),r=parseInt(o.css("margin-left"),10);isNaN(a)&&(a=0),isNaN(r)&&(r=0),e.top+=a,e.left+=r,t.offset.setOffset(o[0],t.extend({using:function(t){o.css({top:Math.round(t.top),left:Math.round(t.left)})}},e),0),o.addClass("in");var l=o[0].offsetWidth,h=o[0].offsetHeight;"top"==i&&h!=s&&(e.top=e.top+s-h);var d=this.getViewportAdjustedDelta(i,e,l,h);d.left?e.left+=d.left:e.top+=d.top;var p=/top|bottom/.test(i),c=p?2*d.left-n+l:2*d.top-s+h,f=p?"offsetWidth":"offsetHeight";o.offset(e),this.replaceArrow(c,o[0][f],p)},i.prototype.replaceArrow=function(t,e,i){this.arrow().css(i?"left":"top",50*(1-t/e)+"%").css(i?"top":"left","")},i.prototype.setContent=function(){var t=this.tip(),e=this.getTitle();t.find(".tooltip-inner")[this.options.html?"html":"text"](e),t.removeClass("fade in top bottom left right")},i.prototype.hide=function(e){function o(){"in"!=n.hoverState&&s.detach(),n.$element.removeAttr("aria-describedby").trigger("hidden.bs."+n.type),e&&e()}var n=this,s=t(this.$tip),a=t.Event("hide.bs."+this.type);return this.$element.trigger(a),a.isDefaultPrevented()?void 0:(s.removeClass("in"),t.support.transition&&s.hasClass("fade")?s.one("bsTransitionEnd",o).emulateTransitionEnd(i.TRANSITION_DURATION):o(),this.hoverState=null,this)},i.prototype.fixTitle=function(){var t=this.$element;(t.attr("title")||"string"!=typeof t.attr("data-original-title"))&&t.attr("data-original-title",t.attr("title")||"").attr("title","")},i.prototype.hasContent=function(){return this.getTitle()},i.prototype.getPosition=function(e){e=e||this.$element;var i=e[0],o="BODY"==i.tagName,n=i.getBoundingClientRect();null==n.width&&(n=t.extend({},n,{width:n.right-n.left,height:n.bottom-n.top}));var s=o?{top:0,left:0}:e.offset(),a={scroll:o?document.documentElement.scrollTop||document.body.scrollTop:e.scrollTop()},r=o?{width:t(window).width(),height:t(window).height()}:null;return t.extend({},n,a,r,s)},i.prototype.getCalculatedOffset=function(t,e,i,o){return"bottom"==t?{top:e.top+e.height,left:e.left+e.width/2-i/2}:"top"==t?{top:e.top-o,left:e.left+e.width/2-i/2}:"left"==t?{top:e.top+e.height/2-o/2,left:e.left-i}:{top:e.top+e.height/2-o/2,left:e.left+e.width}},i.prototype.getViewportAdjustedDelta=function(t,e,i,o){var n={top:0,left:0};if(!this.$viewport)return n;var s=this.options.viewport&&this.options.viewport.padding||0,a=this.getPosition(this.$viewport);if(/right|left/.test(t)){var r=e.top-s-a.scroll,l=e.top+s-a.scroll+o;r<a.top?n.top=a.top-r:l>a.top+a.height&&(n.top=a.top+a.height-l)}else{var h=e.left-s,d=e.left+s+i;h<a.left?n.left=a.left-h:d>a.right&&(n.left=a.left+a.width-d)}return n},i.prototype.getTitle=function(){var t,e=this.$element,i=this.options;return t=e.attr("data-original-title")||("function"==typeof i.title?i.title.call(e[0]):i.title)},i.prototype.getUID=function(t){do t+=~~(1e6*Math.random());while(document.getElementById(t));return t},i.prototype.tip=function(){if(!this.$tip&&(this.$tip=t(this.options.template),1!=this.$tip.length))throw new Error(this.type+" `template` option must consist of exactly 1 top-level element!");return this.$tip},i.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},i.prototype.enable=function(){this.enabled=!0},i.prototype.disable=function(){this.enabled=!1},i.prototype.toggleEnabled=function(){this.enabled=!this.enabled},i.prototype.toggle=function(e){var i=this;e&&(i=t(e.currentTarget).data("bs."+this.type),i||(i=new this.constructor(e.currentTarget,this.getDelegateOptions()),t(e.currentTarget).data("bs."+this.type,i))),e?(i.inState.click=!i.inState.click,i.isInStateTrue()?i.enter(i):i.leave(i)):i.tip().hasClass("in")?i.leave(i):i.enter(i)},i.prototype.destroy=function(){var t=this;clearTimeout(this.timeout),this.hide(function(){t.$element.off("."+t.type).removeData("bs."+t.type),t.$tip&&t.$tip.detach(),t.$tip=null,t.$arrow=null,t.$viewport=null})};var o=t.fn.tooltip;t.fn.tooltip=e,t.fn.tooltip.Constructor=i,t.fn.tooltip.noConflict=function(){return t.fn.tooltip=o,this}}(jQuery),+function(t){"use strict";function e(e){return this.each(function(){var o=t(this),n=o.data("bs.popover"),s="object"==typeof e&&e;(n||!/destroy|hide/.test(e))&&(n||o.data("bs.popover",n=new i(this,s)),"string"==typeof e&&n[e]())})}var i=function(t,e){this.init("popover",t,e)};if(!t.fn.tooltip)throw new Error("Popover requires tooltip.js");i.VERSION="3.3.5",i.DEFAULTS=t.extend({},t.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),i.prototype=t.extend({},t.fn.tooltip.Constructor.prototype),i.prototype.constructor=i,i.prototype.getDefaults=function(){return i.DEFAULTS},i.prototype.setContent=function(){var t=this.tip(),e=this.getTitle(),i=this.getContent();t.find(".popover-title")[this.options.html?"html":"text"](e),t.find(".popover-content").children().detach().end()[this.options.html?"string"==typeof i?"html":"append":"text"](i),t.removeClass("fade top bottom left right in"),t.find(".popover-title").html()||t.find(".popover-title").hide()},i.prototype.hasContent=function(){return this.getTitle()||this.getContent()},i.prototype.getContent=function(){var t=this.$element,e=this.options;return t.attr("data-content")||("function"==typeof e.content?e.content.call(t[0]):e.content)},i.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")};var o=t.fn.popover;t.fn.popover=e,t.fn.popover.Constructor=i,t.fn.popover.noConflict=function(){return t.fn.popover=o,this}}(jQuery),+function(t){"use strict";function e(e){return this.each(function(){var o=t(this),n=o.data("bs.tab");n||o.data("bs.tab",n=new i(this)),"string"==typeof e&&n[e]()})}var i=function(e){this.element=t(e)};i.VERSION="3.3.5",i.TRANSITION_DURATION=150,i.prototype.show=function(){var e=this.element,i=e.closest("ul:not(.dropdown-menu)"),o=e.data("target");if(o||(o=e.attr("href"),o=o&&o.replace(/.*(?=#[^\s]*$)/,"")),!e.parent("li").hasClass("active")){var n=i.find(".active:last a"),s=t.Event("hide.bs.tab",{relatedTarget:e[0]}),a=t.Event("show.bs.tab",{relatedTarget:n[0]});if(n.trigger(s),e.trigger(a),!a.isDefaultPrevented()&&!s.isDefaultPrevented()){var r=t(o);this.activate(e.closest("li"),i),this.activate(r,r.parent(),function(){n.trigger({type:"hidden.bs.tab",relatedTarget:e[0]}),e.trigger({type:"shown.bs.tab",relatedTarget:n[0]})})}}},i.prototype.activate=function(e,o,n){function s(){a.removeClass("active").find("> .dropdown-menu > .active").removeClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!1),e.addClass("active").find('[data-toggle="tab"]').attr("aria-expanded",!0),r?(e[0].offsetWidth,e.addClass("in")):e.removeClass("fade"),e.parent(".dropdown-menu").length&&e.closest("li.dropdown").addClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!0),n&&n()}var a=o.find("> .active"),r=n&&t.support.transition&&(a.length&&a.hasClass("fade")||!!o.find("> .fade").length);a.length&&r?a.one("bsTransitionEnd",s).emulateTransitionEnd(i.TRANSITION_DURATION):s(),a.removeClass("in")};var o=t.fn.tab;t.fn.tab=e,t.fn.tab.Constructor=i,t.fn.tab.noConflict=function(){return t.fn.tab=o,this};var n=function(i){i.preventDefault(),e.call(t(this),"show")};t(document).on("click.bs.tab.data-api",'[data-toggle="tab"]',n).on("click.bs.tab.data-api",'[data-toggle="pill"]',n)}(jQuery),+function(t){"use strict";function e(e){return this.each(function(){var o=t(this),n=o.data("bs.affix"),s="object"==typeof e&&e;n||o.data("bs.affix",n=new i(this,s)),"string"==typeof e&&n[e]()})}var i=function(e,o){this.options=t.extend({},i.DEFAULTS,o),this.$target=t(this.options.target).on("scroll.bs.affix.data-api",t.proxy(this.checkPosition,this)).on("click.bs.affix.data-api",t.proxy(this.checkPositionWithEventLoop,this)),this.$element=t(e),this.affixed=null,this.unpin=null,this.pinnedOffset=null,this.checkPosition()};i.VERSION="3.3.5",i.RESET="affix affix-top affix-bottom",i.DEFAULTS={offset:0,target:window},i.prototype.getState=function(t,e,i,o){var n=this.$target.scrollTop(),s=this.$element.offset(),a=this.$target.height();if(null!=i&&"top"==this.affixed)return i>n?"top":!1;if("bottom"==this.affixed)return null!=i?n+this.unpin<=s.top?!1:"bottom":t-o>=n+a?!1:"bottom";var r=null==this.affixed,l=r?n:s.top,h=r?a:e;return null!=i&&i>=n?"top":null!=o&&l+h>=t-o?"bottom":!1},i.prototype.getPinnedOffset=function(){if(this.pinnedOffset)return this.pinnedOffset;this.$element.removeClass(i.RESET).addClass("affix");var t=this.$target.scrollTop(),e=this.$element.offset();return this.pinnedOffset=e.top-t},i.prototype.checkPositionWithEventLoop=function(){setTimeout(t.proxy(this.checkPosition,this),1)},i.prototype.checkPosition=function(){if(this.$element.is(":visible")){var e=this.$element.height(),o=this.options.offset,n=o.top,s=o.bottom,a=Math.max(t(document).height(),t(document.body).height());"object"!=typeof o&&(s=n=o),"function"==typeof n&&(n=o.top(this.$element)),"function"==typeof s&&(s=o.bottom(this.$element));var r=this.getState(a,e,n,s);if(this.affixed!=r){null!=this.unpin&&this.$element.css("top","");var l="affix"+(r?"-"+r:""),h=t.Event(l+".bs.affix");if(this.$element.trigger(h),h.isDefaultPrevented())return;this.affixed=r,this.unpin="bottom"==r?this.getPinnedOffset():null,this.$element.removeClass(i.RESET).addClass(l).trigger(l.replace("affix","affixed")+".bs.affix")}"bottom"==r&&this.$element.offset({top:a-e-s})}};var o=t.fn.affix;t.fn.affix=e,t.fn.affix.Constructor=i,t.fn.affix.noConflict=function(){return t.fn.affix=o,this},t(window).on("load",function(){t('[data-spy="affix"]').each(function(){var i=t(this),o=i.data();o.offset=o.offset||{},null!=o.offsetBottom&&(o.offset.bottom=o.offsetBottom),null!=o.offsetTop&&(o.offset.top=o.offsetTop),e.call(i,o)})})}(jQuery),+function(t){"use strict";function e(e){var i,o=e.attr("data-target")||(i=e.attr("href"))&&i.replace(/.*(?=#[^\s]+$)/,"");return t(o)}function i(e){return this.each(function(){var i=t(this),n=i.data("bs.collapse"),s=t.extend({},o.DEFAULTS,i.data(),"object"==typeof e&&e);!n&&s.toggle&&/show|hide/.test(e)&&(s.toggle=!1),n||i.data("bs.collapse",n=new o(this,s)),"string"==typeof e&&n[e]()})}var o=function(e,i){this.$element=t(e),this.options=t.extend({},o.DEFAULTS,i),this.$trigger=t('[data-toggle="collapse"][href="#'+e.id+'"],[data-toggle="collapse"][data-target="#'+e.id+'"]'),this.transitioning=null,this.options.parent?this.$parent=this.getParent():this.addAriaAndCollapsedClass(this.$element,this.$trigger),this.options.toggle&&this.toggle()};o.VERSION="3.3.5",o.TRANSITION_DURATION=350,o.DEFAULTS={toggle:!0},o.prototype.dimension=function(){var t=this.$element.hasClass("width");return t?"width":"height"},o.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var e,n=this.$parent&&this.$parent.children(".panel").children(".in, .collapsing");if(!(n&&n.length&&(e=n.data("bs.collapse"),e&&e.transitioning))){var s=t.Event("show.bs.collapse");if(this.$element.trigger(s),!s.isDefaultPrevented()){n&&n.length&&(i.call(n,"hide"),e||n.data("bs.collapse",null));var a=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[a](0).attr("aria-expanded",!0),this.$trigger.removeClass("collapsed").attr("aria-expanded",!0),this.transitioning=1;var r=function(){this.$element.removeClass("collapsing").addClass("collapse in")[a](""),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!t.support.transition)return r.call(this);var l=t.camelCase(["scroll",a].join("-"));this.$element.one("bsTransitionEnd",t.proxy(r,this)).emulateTransitionEnd(o.TRANSITION_DURATION)[a](this.$element[0][l]);
}}}},o.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var e=t.Event("hide.bs.collapse");if(this.$element.trigger(e),!e.isDefaultPrevented()){var i=this.dimension();this.$element[i](this.$element[i]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse in").attr("aria-expanded",!1),this.$trigger.addClass("collapsed").attr("aria-expanded",!1),this.transitioning=1;var n=function(){this.transitioning=0,this.$element.removeClass("collapsing").addClass("collapse").trigger("hidden.bs.collapse")};return t.support.transition?void this.$element[i](0).one("bsTransitionEnd",t.proxy(n,this)).emulateTransitionEnd(o.TRANSITION_DURATION):n.call(this)}}},o.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()},o.prototype.getParent=function(){return t(this.options.parent).find('[data-toggle="collapse"][data-parent="'+this.options.parent+'"]').each(t.proxy(function(i,o){var n=t(o);this.addAriaAndCollapsedClass(e(n),n)},this)).end()},o.prototype.addAriaAndCollapsedClass=function(t,e){var i=t.hasClass("in");t.attr("aria-expanded",i),e.toggleClass("collapsed",!i).attr("aria-expanded",i)};var n=t.fn.collapse;t.fn.collapse=i,t.fn.collapse.Constructor=o,t.fn.collapse.noConflict=function(){return t.fn.collapse=n,this},t(document).on("click.bs.collapse.data-api",'[data-toggle="collapse"]',function(o){var n=t(this);n.attr("data-target")||o.preventDefault();var s=e(n),a=s.data("bs.collapse"),r=a?"toggle":n.data();i.call(s,r)})}(jQuery),+function(t){"use strict";function e(i,o){this.$body=t(document.body),this.$scrollElement=t(t(i).is(document.body)?window:i),this.options=t.extend({},e.DEFAULTS,o),this.selector=(this.options.target||"")+" .nav li > a",this.offsets=[],this.targets=[],this.activeTarget=null,this.scrollHeight=0,this.$scrollElement.on("scroll.bs.scrollspy",t.proxy(this.process,this)),this.refresh(),this.process()}function i(i){return this.each(function(){var o=t(this),n=o.data("bs.scrollspy"),s="object"==typeof i&&i;n||o.data("bs.scrollspy",n=new e(this,s)),"string"==typeof i&&n[i]()})}e.VERSION="3.3.5",e.DEFAULTS={offset:10},e.prototype.getScrollHeight=function(){return this.$scrollElement[0].scrollHeight||Math.max(this.$body[0].scrollHeight,document.documentElement.scrollHeight)},e.prototype.refresh=function(){var e=this,i="offset",o=0;this.offsets=[],this.targets=[],this.scrollHeight=this.getScrollHeight(),t.isWindow(this.$scrollElement[0])||(i="position",o=this.$scrollElement.scrollTop()),this.$body.find(this.selector).map(function(){var e=t(this),n=e.data("target")||e.attr("href"),s=/^#./.test(n)&&t(n);return s&&s.length&&s.is(":visible")&&[[s[i]().top+o,n]]||null}).sort(function(t,e){return t[0]-e[0]}).each(function(){e.offsets.push(this[0]),e.targets.push(this[1])})},e.prototype.process=function(){var t,e=this.$scrollElement.scrollTop()+this.options.offset,i=this.getScrollHeight(),o=this.options.offset+i-this.$scrollElement.height(),n=this.offsets,s=this.targets,a=this.activeTarget;if(this.scrollHeight!=i&&this.refresh(),e>=o)return a!=(t=s[s.length-1])&&this.activate(t);if(a&&e<n[0])return this.activeTarget=null,this.clear();for(t=n.length;t--;)a!=s[t]&&e>=n[t]&&(void 0===n[t+1]||e<n[t+1])&&this.activate(s[t])},e.prototype.activate=function(e){this.activeTarget=e,this.clear();var i=this.selector+'[data-target="'+e+'"],'+this.selector+'[href="'+e+'"]',o=t(i).parents("li").addClass("active");o.parent(".dropdown-menu").length&&(o=o.closest("li.dropdown").addClass("active")),o.trigger("activate.bs.scrollspy")},e.prototype.clear=function(){t(this.selector).parentsUntil(this.options.target,".active").removeClass("active")};var o=t.fn.scrollspy;t.fn.scrollspy=i,t.fn.scrollspy.Constructor=e,t.fn.scrollspy.noConflict=function(){return t.fn.scrollspy=o,this},t(window).on("load.bs.scrollspy.data-api",function(){t('[data-spy="scroll"]').each(function(){var e=t(this);i.call(e,e.data())})})}(jQuery),+function(t){"use strict";function e(){var t=document.createElement("bootstrap"),e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var i in e)if(void 0!==t.style[i])return{end:e[i]};return!1}t.fn.emulateTransitionEnd=function(e){var i=!1,o=this;t(this).one("bsTransitionEnd",function(){i=!0});var n=function(){i||t(o).trigger(t.support.transition.end)};return setTimeout(n,e),this},t(function(){t.support.transition=e(),t.support.transition&&(t.event.special.bsTransitionEnd={bindType:t.support.transition.end,delegateType:t.support.transition.end,handle:function(e){return t(e.target).is(this)?e.handleObj.handler.apply(this,arguments):void 0}})})}(jQuery);
(function($){

  'use strict';

  var fixedCls = '.navbar-fixed-top,.navbar-fixed-bottom,.sa-fixed-elem',
      oldSSB = $.fn.modal.Constructor.prototype.setScrollbar, oldRSB = $.fn.modal.Constructor.prototype.resetScrollbar;

  $.fn.modal.Constructor.prototype.setScrollbar = function () {
    oldSSB.apply(this);
    if (this.bodyIsOverflowing && this.scrollbarWidth){
      $(fixedCls).css('padding-right', this.scrollbarWidth);
    }
  };

  $.fn.modal.Constructor.prototype.resetScrollbar = function () {
    oldRSB.apply(this);
    $(fixedCls).css('padding-right', '');
  };

}(window.jQuery));
(function(w, SA) {

  'use strict';

  var env = SA.App.env,
      ua = navigator.userAgent,
      isIE = /msie|trident/i.test(ua),
      // in case page was opened from offline FS
      isSA = new RegExp(SA.App.host).test(location.href),
      isCrawler = /bot|googlebot|crawler|spider|robot|crawling|PhantomJS/i.test(ua),
      rc = SA.readCookie;

  function getFirstMatch(reg, ua) {
    var m = ua.match(reg);
    return (m && m.length > 1 && m[1]) || '';
  }

  function isIframe() {
    var f = false;
    try {
      f = w.self !== w.top;
    } catch (ignore) {}
    return f;
  }

  function isMone(args) {
    var i = false;
    try {
      i = (args[3].url === '/mone');
    } catch(ignore) {}
    return i;
  }

  function scriptError(payload) {
    var ign= false, p = payload || {}, t, rgx = /script\serror/ig;
    //ignore exception if we don't have any data about it
    if(!p.body) {
      return true;
    }
    // script error we unable to track
    t = p.body.trace || {};
    t.exception = t.exception || {};
    t.frames = t.frames || [];
    if(rgx.test(t.exception.message) && (t.frames.length && t.frames.length <= 1 && !t.frames[0].colno)) {
      ign = true;
    }
    return ign;
  }

  function saDomains() {
    var h = SA.App.assetHosts || [], res = [];
    h.push(SA.App.host);
    SA.App.assetHosts.forEach(function(h) {
      res.push(h.replace(/https?:\/\//, ''));
    });
    return res;
  }

  function checkIgnore(i, args, payload) {
    var IEver = isIE ? parseInt(getFirstMatch(/(?:msie|rv:)(\d+(\.\d+)?)/i, ua), 10) : 0;
    var extra = ((payload.body || {}).message || {}).extra;
    var serverStatus = (extra || {}).status;
    var responseText = (extra || {}).jqXHR_responseText;
    var isUnsupportedStatus = false,
        isPerimeterXignored = false;
    if (serverStatus) {
        isUnsupportedStatus = [12017].indexOf(serverStatus) >= 0;    // 12017: ERROR_INTERNET_OPERATION_CANCELLED
        isPerimeterXignored = serverStatus === 403 && (/PerimeterX/).test(responseText);
    }
    return (!isSA || (isIE && IEver <= 8) || isCrawler || isIframe() || isMone(args) || scriptError(payload) || isUnsupportedStatus || isPerimeterXignored);
  }

  // Define which telemetry fields' values will be filtered
  function telemetryScrubber(el) {
    if (el.id && el.id.match(/credit(\W|_){0,2}card/i)) {
      return true;
    } else {
      el.classes.forEach(function(elClass) {
        if (elClass.match(/credit(\W|_){0,2}card|payment-input/i)) { return true; }
      });
    }
    return false;
  }

  w._rollbarConfig = {
    accessToken: SA.App.rollbarToken,
    enabled: env.production || env.staging,
    verbose: !env.production,
    captureUncaught: true,
    ignoredMessages: ["Can't execute code from a freed script", 'Unexpected end of JSON input'],
    checkIgnore: checkIgnore,
    hostWhiteList: saDomains(),
    telemetryScrubber: telemetryScrubber,
    payload: {
      environment: env.production ? 'production' : 'staging',
      person: {
        id: rc('user_id')
      },
      client: {
        javascript: {
          guess_uncaught_frames: true
        }
      }
    },
    // prevent Rollbar reporting ajax errors
    plugins: {
      jquery: {
        ignoreAjaxErrors: true
      }
    }
  };

}(window, window.SA));

try{!function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";var r=n(1),o=window&&window._rollbarConfig,i=o&&o.globalAlias||"Rollbar",a=window&&window[i]&&"function"==typeof window[i].shimId&&void 0!==window[i].shimId();if(window&&!window._rollbarStartTime&&(window._rollbarStartTime=(new Date).getTime()),!a&&o){var s=new r(o);window[i]=s}else window.rollbar=r,window._rollbarDidLoad=!0;t.exports=r},function(t,e,n){"use strict";function r(t,e){this.options=c.extend(!0,_,t);var n=new l(this.options,f,d);this.client=e||new u(this.options,n,p,"browser"),i(this.client.notifier),a(this.client.queue),(this.options.captureUncaught||this.options.handleUncaughtExceptions)&&(h.captureUncaughtExceptions(window,this),h.wrapGlobals(window,this)),(this.options.captureUnhandledRejections||this.options.handleUnhandledRejections)&&h.captureUnhandledRejections(window,this),this.instrumenter=new b(this.options,this.client.telemeter,this,window,document),this.instrumenter.instrument()}function o(t){var e="Rollbar is not initialized";p.error(e),t&&t(new Error(e))}function i(t){t.addTransform(m.handleItemWithError).addTransform(m.ensureItemHasSomethingToSay).addTransform(m.addBaseInfo).addTransform(m.addRequestInfo(window)).addTransform(m.addClientInfo(window)).addTransform(m.addPluginInfo(window)).addTransform(m.addBody).addTransform(g.addMessageWithError).addTransform(g.addTelemetryData).addTransform(m.scrubPayload).addTransform(m.userTransform).addTransform(g.itemToPayload)}function a(t){t.addPredicate(v.checkIgnore).addPredicate(v.userCheckIgnore).addPredicate(v.urlIsNotBlacklisted).addPredicate(v.urlIsWhitelisted).addPredicate(v.messageIsIgnored)}function s(t){for(var e=0,n=t.length;e<n;++e)if(c.isFunction(t[e]))return t[e]}var u=n(2),c=n(5),l=n(10),p=n(12),h=n(15),f=n(16),d=n(17),m=n(18),g=n(22),v=n(23),y=n(19),b=n(24),w=null;r.init=function(t,e){return w?w.global(t).configure(t):w=new r(t,e)},r.prototype.global=function(t){return this.client.global(t),this},r.global=function(t){return w?w.global(t):void o()},r.prototype.configure=function(t,e){var n=this.options,r={};return e&&(r={payload:e}),this.options=c.extend(!0,{},n,t,r),this.client.configure(t,e),this.instrumenter.configure(t),this},r.configure=function(t,e){return w?w.configure(t,e):void o()},r.prototype.lastError=function(){return this.client.lastError},r.lastError=function(){return w?w.lastError():void o()},r.prototype.log=function(){var t=this._createItem(arguments),e=t.uuid;return this.client.log(t),{uuid:e}},r.log=function(){if(w)return w.log.apply(w,arguments);var t=s(arguments);o(t)},r.prototype.debug=function(){var t=this._createItem(arguments),e=t.uuid;return this.client.debug(t),{uuid:e}},r.debug=function(){if(w)return w.debug.apply(w,arguments);var t=s(arguments);o(t)},r.prototype.info=function(){var t=this._createItem(arguments),e=t.uuid;return this.client.info(t),{uuid:e}},r.info=function(){if(w)return w.info.apply(w,arguments);var t=s(arguments);o(t)},r.prototype.warn=function(){var t=this._createItem(arguments),e=t.uuid;return this.client.warn(t),{uuid:e}},r.warn=function(){if(w)return w.warn.apply(w,arguments);var t=s(arguments);o(t)},r.prototype.warning=function(){var t=this._createItem(arguments),e=t.uuid;return this.client.warning(t),{uuid:e}},r.warning=function(){if(w)return w.warning.apply(w,arguments);var t=s(arguments);o(t)},r.prototype.error=function(){var t=this._createItem(arguments),e=t.uuid;return this.client.error(t),{uuid:e}},r.error=function(){if(w)return w.error.apply(w,arguments);var t=s(arguments);o(t)},r.prototype.critical=function(){var t=this._createItem(arguments),e=t.uuid;return this.client.critical(t),{uuid:e}},r.critical=function(){if(w)return w.critical.apply(w,arguments);var t=s(arguments);o(t)},r.prototype.handleUncaughtException=function(t,e,n,r,o,i){var a,s=c.makeUnhandledStackInfo(t,e,n,r,o,"onerror","uncaught exception",y);c.isError(o)?(a=this._createItem([t,o,i]),a._unhandledStackInfo=s):c.isError(e)?(a=this._createItem([t,e,i]),a._unhandledStackInfo=s):(a=this._createItem([t,i]),a.stackInfo=s),a.level=this.options.uncaughtErrorLevel,a._isUncaught=!0,this.client.log(a)},r.prototype.handleUnhandledRejection=function(t,e){var n="unhandled rejection was null or undefined!";n=t?t.message||String(t):n;var r,o=t&&t._rollbarContext||e&&e._rollbarContext;c.isError(t)?r=this._createItem([n,t,o]):(r=this._createItem([n,t,o]),r.stackInfo=c.makeUnhandledStackInfo(n,"",0,0,null,"unhandledrejection","",y)),r.level=this.options.uncaughtErrorLevel,r._isUncaught=!0,r._originalArgs=r._originalArgs||[],r._originalArgs.push(e),this.client.log(r)},r.prototype.wrap=function(t,e,n){try{var r;if(r=c.isFunction(e)?e:function(){return e||{}},!c.isFunction(t))return t;if(t._isWrap)return t;if(!t._rollbar_wrapped&&(t._rollbar_wrapped=function(){n&&c.isFunction(n)&&n.apply(this,arguments);try{return t.apply(this,arguments)}catch(n){var e=n;throw c.isType(e,"string")&&(e=new String(e)),e._rollbarContext=r()||{},e._rollbarContext._wrappedSource=t.toString(),window._rollbarWrappedError=e,e}},t._rollbar_wrapped._isWrap=!0,t.hasOwnProperty))for(var o in t)t.hasOwnProperty(o)&&(t._rollbar_wrapped[o]=t[o]);return t._rollbar_wrapped}catch(e){return t}},r.wrap=function(t,e){return w?w.wrap(t,e):void o()},r.prototype.captureEvent=function(t,e){return this.client.captureEvent(t,e)},r.captureEvent=function(t,e){return w?w.captureEvent(t,e):void o()},r.prototype.captureDomContentLoaded=function(t,e){return e||(e=new Date),this.client.captureDomContentLoaded(e)},r.prototype.captureLoad=function(t,e){return e||(e=new Date),this.client.captureLoad(e)},r.prototype._createItem=function(t){return c.createItem(t,p,this)};var _={version:"2.3.1",scrubFields:["pw","pass","passwd","password","secret","confirm_password","confirmPassword","password_confirmation","passwordConfirmation","access_token","accessToken","secret_key","secretKey","secretToken"],logLevel:"debug",reportLevel:"debug",uncaughtErrorLevel:"error",endpoint:"api.rollbar.com/api/1/item/",verbose:!1,enabled:!0};t.exports=r},function(t,e,n){"use strict";function r(t,e,n,o){this.options=u.extend(!0,{},t),this.logger=n,r.rateLimiter.configureGlobal(this.options),r.rateLimiter.setPlatformOptions(o,this.options),this.queue=new i(r.rateLimiter,e,n,this.options),this.notifier=new a(this.queue,this.options),this.telemeter=new s(this.options),this.lastError=null}var o=n(3),i=n(4),a=n(8),s=n(9),u=n(5),c={maxItems:0,itemsPerMinute:60};r.rateLimiter=new o(c),r.prototype.global=function(t){return r.rateLimiter.configureGlobal(t),this},r.prototype.configure=function(t,e){this.notifier&&this.notifier.configure(t),this.telemeter&&this.telemeter.configure(t);var n=this.options,r={};return e&&(r={payload:e}),this.options=u.extend(!0,{},n,t,r),this.global(this.options),this},r.prototype.log=function(t){var e=this._defaultLogLevel();return this._log(e,t)},r.prototype.debug=function(t){this._log("debug",t)},r.prototype.info=function(t){this._log("info",t)},r.prototype.warn=function(t){this._log("warning",t)},r.prototype.warning=function(t){this._log("warning",t)},r.prototype.error=function(t){this._log("error",t)},r.prototype.critical=function(t){this._log("critical",t)},r.prototype.wait=function(t){this.queue.wait(t)},r.prototype.captureEvent=function(t,e){return this.telemeter.captureEvent(t,e)},r.prototype.captureDomContentLoaded=function(t){return this.telemeter.captureDomContentLoaded(t)},r.prototype.captureLoad=function(t){return this.telemeter.captureLoad(t)},r.prototype._log=function(t,e){if(!this._sameAsLastError(e))try{var n=null;e.callback&&(n=e.callback,delete e.callback),e.level=e.level||t,e.telemetryEvents=this.telemeter.copyEvents(),this.telemeter._captureRollbarItem(e),this.notifier.log(e,n)}catch(t){this.logger.error(t)}},r.prototype._defaultLogLevel=function(){return this.options.logLevel||"debug"},r.prototype._sameAsLastError=function(t){return!(!this.lastError||this.lastError!==t.err)||(this.lastError=t.err,!1)},t.exports=r},function(t,e){"use strict";function n(t){this.startTime=(new Date).getTime(),this.counter=0,this.perMinCounter=0,this.platform=null,this.platformOptions={},this.configureGlobal(t)}function r(t,e,n){return!t.ignoreRateLimit&&e>=1&&n>e}function o(t,e,n,r,o){var a=null;return n&&(n=new Error(n)),n||r||(a=i(t,e,o)),{error:n,shouldSend:r,payload:a}}function i(t,e,n){var r=e.environment||e.payload&&e.payload.environment,o={body:{message:{body:"maxItems has been hit. Ignoring errors until reset.",extra:{maxItems:n}}},language:"javascript",environment:r,notifier:{version:e.notifier&&e.notifier.version||e.version}};return"browser"===t?(o.platform="browser",o.framework="browser-js",o.notifier.name="rollbar-browser-js"):"server"===t?(o.framework=e.framework||"node-js",o.notifier.name=e.notifier.name):"react-native"===t&&(o.framework=e.framework||"react-native",o.notifier.name=e.notifier.name),o}n.globalSettings={startTime:(new Date).getTime(),maxItems:void 0,itemsPerMinute:void 0},n.prototype.configureGlobal=function(t){void 0!==t.startTime&&(n.globalSettings.startTime=t.startTime),void 0!==t.maxItems&&(n.globalSettings.maxItems=t.maxItems),void 0!==t.itemsPerMinute&&(n.globalSettings.itemsPerMinute=t.itemsPerMinute)},n.prototype.shouldSend=function(t,e){e=e||(new Date).getTime(),e-this.startTime>=6e4&&(this.startTime=e,this.perMinCounter=0);var i=n.globalSettings.maxItems,a=n.globalSettings.itemsPerMinute;if(r(t,i,this.counter))return o(this.platform,this.platformOptions,i+" max items reached",!1);if(r(t,a,this.perMinCounter))return o(this.platform,this.platformOptions,a+" items per minute reached",!1);this.counter++,this.perMinCounter++;var s=!r(t,i,this.counter);return s=s&&!r(t,a,this.perMinCounter),o(this.platform,this.platformOptions,null,s,i)},n.prototype.setPlatformOptions=function(t,e){this.platform=t,this.platformOptions=e},t.exports=n},function(t,e,n){"use strict";function r(t,e,n,r){this.rateLimiter=t,this.api=e,this.logger=n,this.options=r,this.predicates=[],this.pendingItems=[],this.pendingRequests=[],this.retryQueue=[],this.retryHandle=null,this.waitCallback=null,this.waitIntervalID=null}var o=n(5);r.prototype.configure=function(t){this.api&&this.api.configure(t);var e=this.options;return this.options=o.extend(!0,{},e,t),this},r.prototype.addPredicate=function(t){return o.isFunction(t)&&this.predicates.push(t),this},r.prototype.addPendingItem=function(t){this.pendingItems.push(t)},r.prototype.removePendingItem=function(t){var e=this.pendingItems.indexOf(t);e!==-1&&this.pendingItems.splice(e,1)},r.prototype.addItem=function(t,e,n,r){e&&o.isFunction(e)||(e=function(){});var i=this._applyPredicates(t);if(i.stop)return this.removePendingItem(r),void e(i.err);this._maybeLog(t,n),this.removePendingItem(r),this.pendingRequests.push(t);try{this._makeApiRequest(t,function(n,r){this._dequeuePendingRequest(t),e(n,r)}.bind(this))}catch(n){this._dequeuePendingRequest(t),e(n)}},r.prototype.wait=function(t){o.isFunction(t)&&(this.waitCallback=t,this._maybeCallWait()||(this.waitIntervalID&&(this.waitIntervalID=clearInterval(this.waitIntervalID)),this.waitIntervalID=setInterval(function(){this._maybeCallWait()}.bind(this),500)))},r.prototype._applyPredicates=function(t){for(var e=null,n=0,r=this.predicates.length;n<r;n++)if(e=this.predicates[n](t,this.options),!e||void 0!==e.err)return{stop:!0,err:e.err};return{stop:!1,err:null}},r.prototype._makeApiRequest=function(t,e){var n=this.rateLimiter.shouldSend(t);n.shouldSend?this.api.postItem(t,function(n,r){n?this._maybeRetry(n,t,e):e(n,r)}.bind(this)):n.error?e(n.error):this.api.postItem(n.payload,e)};var i=["ECONNRESET","ENOTFOUND","ESOCKETTIMEDOUT","ETIMEDOUT","ECONNREFUSED","EHOSTUNREACH","EPIPE","EAI_AGAIN"];r.prototype._maybeRetry=function(t,e,n){var r=!1;if(this.options.retryInterval)for(var o=0,a=i.length;o<a;o++)if(t.code===i[o]){r=!0;break}r?this._retryApiRequest(e,n):n(t)},r.prototype._retryApiRequest=function(t,e){this.retryQueue.push({item:t,callback:e}),this.retryHandle||(this.retryHandle=setInterval(function(){for(;this.retryQueue.length;){var t=this.retryQueue.shift();this._makeApiRequest(t.item,t.callback)}}.bind(this),this.options.retryInterval))},r.prototype._dequeuePendingRequest=function(t){var e=this.pendingRequests.indexOf(t);e!==-1&&(this.pendingRequests.splice(e,1),this._maybeCallWait())},r.prototype._maybeLog=function(t,e){if(this.logger&&this.options.verbose){var n=e;if(n=n||o.get(t,"body.trace.exception.message"),n=n||o.get(t,"body.trace_chain.0.exception.message"))return void this.logger.error(n);n=o.get(t,"body.message.body"),n&&this.logger.log(n)}},r.prototype._maybeCallWait=function(){return!(!o.isFunction(this.waitCallback)||0!==this.pendingItems.length||0!==this.pendingRequests.length)&&(this.waitIntervalID&&(this.waitIntervalID=clearInterval(this.waitIntervalID)),this.waitCallback(),!0)},t.exports=r},function(t,e,n){"use strict";function r(){if(!j&&(j=!0,c(JSON)&&(s(JSON.stringify)&&(A.stringify=JSON.stringify),s(JSON.parse)&&(A.parse=JSON.parse)),!a(A.stringify)||!a(A.parse))){var t=n(7);t(A)}}function o(t,e){return e===i(t)}function i(t){var e=typeof t;return"object"!==e?e:t?t instanceof Error?"error":{}.toString.call(t).match(/\s([a-zA-Z]+)/)[1].toLowerCase():"null"}function a(t){return o(t,"function")}function s(t){var e=/[\\^$.*+?()[\]{}|]/g,n=Function.prototype.toString.call(Object.prototype.hasOwnProperty).replace(e,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?"),r=RegExp("^"+n+"$");return u(t)&&r.test(t)}function u(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function c(t){return!o(t,"undefined")}function l(t){var e=i(t);return"object"===e||"array"===e}function p(t){return o(t,"error")}function h(t,e,n){var r,i,a,s=o(t,"object"),u=o(t,"array"),c=[];if(s&&n.indexOf(t)!==-1)return t;if(n.push(t),s)for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&c.push(r);else if(u)for(a=0;a<t.length;++a)c.push(a);for(a=0;a<c.length;++a)r=c[a],i=t[r],t[r]=e(r,i,n);return t}function f(){return"********"}function d(){var t=N(),e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"===e?n:7&n|8).toString(16)});return e}function m(t){var e=g(t);return""===e.anchor&&(e.source=e.source.replace("#","")),t=e.source.replace("?"+e.query,"")}function g(t){if(!o(t,"string"))throw new Error("received invalid input");for(var e=D,n=e.parser[e.strictMode?"strict":"loose"].exec(t),r={},i=e.key.length;i--;)r[e.key[i]]=n[i]||"";return r[e.q.name]={},r[e.key[12]].replace(e.q.parser,function(t,n,o){n&&(r[e.q.name][n]=o)}),r}function v(t,e,n){n=n||{},n.access_token=t;var r,o=[];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&o.push([r,n[r]].join("="));var i="?"+o.sort().join("&");e=e||{},e.path=e.path||"";var a,s=e.path.indexOf("?"),u=e.path.indexOf("#");s!==-1&&(u===-1||u>s)?(a=e.path,e.path=a.substring(0,s)+i+"&"+a.substring(s+1)):u!==-1?(a=e.path,e.path=a.substring(0,u)+i+a.substring(u)):e.path=e.path+i}function y(t,e){if(e=e||t.protocol,!e&&t.port&&(80===t.port?e="http:":443===t.port&&(e="https:")),e=e||"https:",!t.hostname)return null;var n=e+"//"+t.hostname;return t.port&&(n=n+":"+t.port),t.path&&(n+=t.path),n}function b(t,e){var n,r;try{n=A.stringify(t)}catch(o){if(e&&a(e))try{n=e(t)}catch(t){r=t}else r=o}return{error:r,value:n}}function w(t){var e,n;try{e=A.parse(t)}catch(t){n=t}return{error:n,value:e}}function _(t,e,n,r,o,i,a,s){var u={url:e||"",line:n,column:r};u.func=s.guessFunctionName(u.url,u.line),u.context=s.gatherContext(u.url,u.line);var c=document&&document.location&&document.location.href,l=window&&window.navigator&&window.navigator.userAgent;return{mode:i,message:o?String(o):t||a,url:c,stack:[u],useragent:l}}function x(t,e){return function(n,r){try{e(n,r)}catch(e){t.error(e)}}}function E(t,e,n,r,o){for(var a,s,u,c,l,p,h=[],f=0,m=t.length;f<m;++f){p=t[f];var g=i(p);switch(g){case"undefined":break;case"string":a?h.push(p):a=p;break;case"function":c=x(e,p);break;case"date":h.push(p);break;case"error":case"domexception":s?h.push(p):s=p;break;case"object":case"array":if(p instanceof Error||"undefined"!=typeof DOMException&&p instanceof DOMException){s?h.push(p):s=p;break}if(r&&"object"===g&&!l){for(var v=0,y=r.length;v<y;++v)if(void 0!==p[r[v]]){l=p;break}if(l)break}u?h.push(p):u=p;break;default:if(p instanceof Error||"undefined"!=typeof DOMException&&p instanceof DOMException){s?h.push(p):s=p;break}h.push(p)}}h.length>0&&(u=C(!0,{},u),u.extraArgs=h);var b={message:a,err:s,custom:u,timestamp:N(),callback:c,uuid:d()};return u&&void 0!==u.level&&(b.level=u.level,delete u.level),r&&l&&(b.request=l),o&&(b.lambdaContext=o),b._originalArgs=t,b}function k(t,e){if(t){var n=e.split("."),r=t;try{for(var o=0,i=n.length;o<i;++o)r=r[n[o]]}catch(t){r=void 0}return r}}function I(t,e,n){if(t){var r=e.split("."),o=r.length;if(!(o<1)){if(1===o)return void(t[r[0]]=n);try{for(var i=t[r[0]]||{},a=i,s=1;s<o-1;s++)i[r[s]]=i[r[s]]||{},i=i[r[s]];i[r[o-1]]=n,t[r[0]]=a}catch(t){return}}}}function T(t,e){function n(t,e,n,r,o,i){return e+f(i)}function r(t){var e;if(o(t,"string"))for(e=0;e<u.length;++e)t=t.replace(u[e],n);return t}function i(t,e){var n;for(n=0;n<s.length;++n)if(s[n].test(t)){e=f(e);break}return e}function a(t,e,n){var s=i(t,e);return s===e?o(e,"object")||o(e,"array")?h(e,a,n):r(s):s}e=e||[];var s=S(e),u=O(e);return h(t,a,[]),t}function S(t){for(var e,n=[],r=0;r<t.length;++r)e="\\[?(%5[bB])?"+t[r]+"\\[?(%5[bB])?\\]?(%5[dD])?",n.push(new RegExp(e,"i"));return n}function O(t){for(var e,n=[],r=0;r<t.length;++r)e="\\[?(%5[bB])?"+t[r]+"\\[?(%5[bB])?\\]?(%5[dD])?",n.push(new RegExp("("+e+"=)([^&\\n]+)","igm"));return n}function L(t){var e,n,r,o=[];for(e=0,n=t.length;e<n;e++)r=t[e],"object"==typeof r?(r=b(r),r=r.error||r.value,r.length>500&&(r=r.substr(0,500)+"...")):"undefined"==typeof r&&(r="undefined"),o.push(r);return o.join(" ")}function N(){return Date.now?+Date.now():+new Date}var C=n(6),A={},j=!1;r();var R={debug:0,info:1,warning:2,error:3,critical:4},D={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};t.exports={isType:o,typeName:i,isFunction:a,isNativeFunction:s,isIterable:l,isError:p,extend:C,traverse:h,redact:f,uuid4:d,LEVELS:R,sanitizeUrl:m,addParamsAndAccessTokenToPath:v,formatUrl:y,stringify:b,jsonParse:w,makeUnhandledStackInfo:_,createItem:E,get:k,set:I,scrub:T,formatArgsAsString:L,now:N}},function(t,e){"use strict";var n=Object.prototype.hasOwnProperty,r=Object.prototype.toString,o=function(t){return"function"==typeof Array.isArray?Array.isArray(t):"[object Array]"===r.call(t)},i=function(t){if(!t||"[object Object]"!==r.call(t))return!1;var e=n.call(t,"constructor"),o=t.constructor&&t.constructor.prototype&&n.call(t.constructor.prototype,"isPrototypeOf");if(t.constructor&&!e&&!o)return!1;var i;for(i in t);return"undefined"==typeof i||n.call(t,i)};t.exports=function t(){var e,n,r,a,s,u,c=arguments[0],l=1,p=arguments.length,h=!1;for("boolean"==typeof c?(h=c,c=arguments[1]||{},l=2):("object"!=typeof c&&"function"!=typeof c||null==c)&&(c={});l<p;++l)if(e=arguments[l],null!=e)for(n in e)r=c[n],a=e[n],c!==a&&(h&&a&&(i(a)||(s=o(a)))?(s?(s=!1,u=r&&o(r)?r:[]):u=r&&i(r)?r:{},c[n]=t(h,u,a)):"undefined"!=typeof a&&(c[n]=a));return c}},function(t,e){var n=function(t){function e(t){return t<10?"0"+t:t}function n(){return this.valueOf()}function r(t){return i.lastIndex=0,i.test(t)?'"'+t.replace(i,function(t){var e=u[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'}function o(t,e){var n,i,u,l,p,h=a,f=e[t];switch(f&&"object"==typeof f&&"function"==typeof f.toJSON&&(f=f.toJSON(t)),"function"==typeof c&&(f=c.call(e,t,f)),typeof f){case"string":return r(f);case"number":return isFinite(f)?String(f):"null";case"boolean":case"null":return String(f);case"object":if(!f)return"null";if(a+=s,p=[],"[object Array]"===Object.prototype.toString.apply(f)){for(l=f.length,n=0;n<l;n+=1)p[n]=o(n,f)||"null";return u=0===p.length?"[]":a?"[\n"+a+p.join(",\n"+a)+"\n"+h+"]":"["+p.join(",")+"]",a=h,u}if(c&&"object"==typeof c)for(l=c.length,n=0;n<l;n+=1)"string"==typeof c[n]&&(i=c[n],u=o(i,f),u&&p.push(r(i)+(a?": ":":")+u));else for(i in f)Object.prototype.hasOwnProperty.call(f,i)&&(u=o(i,f),u&&p.push(r(i)+(a?": ":":")+u));return u=0===p.length?"{}":a?"{\n"+a+p.join(",\n"+a)+"\n"+h+"}":"{"+p.join(",")+"}",a=h,u}}var i=/[\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"Z":null},Boolean.prototype.toJSON=n,Number.prototype.toJSON=n,String.prototype.toJSON=n);var a,s,u,c;"function"!=typeof t.stringify&&(u={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},t.stringify=function(t,e,n){var r;if(a="",s="","number"==typeof n)for(r=0;r<n;r+=1)s+=" ";else"string"==typeof n&&(s=n);if(c=e,e&&"function"!=typeof e&&("object"!=typeof e||"number"!=typeof e.length))throw new Error("JSON.stringify");return o("",{"":t})}),"function"!=typeof t.parse&&(t.parse=function(){function t(t){return t.replace(/\\(?:u(.{4})|([^u]))/g,function(t,e,n){return e?String.fromCharCode(parseInt(e,16)):a[n]})}var e,n,r,o,i,a={"\\":"\\",'"':'"',"/":"/",t:"\t",n:"\n",r:"\r",f:"\f",b:"\b"},s={go:function(){e="ok"},firstokey:function(){o=i,e="colon"},okey:function(){o=i,e="colon"},ovalue:function(){e="ocomma"},firstavalue:function(){e="acomma"},avalue:function(){e="acomma"}},u={go:function(){e="ok"},ovalue:function(){e="ocomma"},firstavalue:function(){e="acomma"},avalue:function(){e="acomma"}},c={"{":{go:function(){n.push({state:"ok"}),r={},e="firstokey"},ovalue:function(){n.push({container:r,state:"ocomma",key:o}),r={},e="firstokey"},firstavalue:function(){n.push({container:r,state:"acomma"}),r={},e="firstokey"},avalue:function(){n.push({container:r,state:"acomma"}),r={},e="firstokey"}},"}":{firstokey:function(){var t=n.pop();i=r,r=t.container,o=t.key,e=t.state},ocomma:function(){var t=n.pop();r[o]=i,i=r,r=t.container,o=t.key,e=t.state}},"[":{go:function(){n.push({state:"ok"}),r=[],e="firstavalue"},ovalue:function(){n.push({container:r,state:"ocomma",key:o}),r=[],e="firstavalue"},firstavalue:function(){n.push({container:r,state:"acomma"}),r=[],e="firstavalue"},avalue:function(){n.push({container:r,state:"acomma"}),r=[],e="firstavalue"}},"]":{firstavalue:function(){var t=n.pop();i=r,r=t.container,o=t.key,e=t.state},acomma:function(){var t=n.pop();r.push(i),i=r,r=t.container,o=t.key,e=t.state}},":":{colon:function(){if(Object.hasOwnProperty.call(r,o))throw new SyntaxError("Duplicate key '"+o+'"');e="ovalue"}},",":{ocomma:function(){r[o]=i,e="okey"},acomma:function(){r.push(i),e="avalue"}},true:{go:function(){i=!0,e="ok"},ovalue:function(){i=!0,e="ocomma"},firstavalue:function(){i=!0,e="acomma"},avalue:function(){i=!0,e="acomma"}},false:{go:function(){i=!1,e="ok"},ovalue:function(){i=!1,e="ocomma"},firstavalue:function(){i=!1,e="acomma"},avalue:function(){i=!1,e="acomma"}},null:{go:function(){i=null,e="ok"},ovalue:function(){i=null,e="ocomma"},firstavalue:function(){i=null,e="acomma"},avalue:function(){i=null,e="acomma"}}};return function(r,o){var a,l=/^[\u0020\t\n\r]*(?:([,:\[\]{}]|true|false|null)|(-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)|"((?:[^\r\n\t\\\"]|\\(?:["\\\/trnfb]|u[0-9a-fA-F]{4}))*)")/;e="go",n=[];try{for(;;){if(a=l.exec(r),!a)break;a[1]?c[a[1]][e]():a[2]?(i=+a[2],u[e]()):(i=t(a[3]),s[e]()),r=r.slice(a[0].length)}}catch(t){e=t}if("ok"!==e||/[^\u0020\t\n\r]/.test(r))throw e instanceof SyntaxError?e:new SyntaxError("JSON");return"function"==typeof o?function t(e,n){var r,a,s=e[n];if(s&&"object"==typeof s)for(r in i)Object.prototype.hasOwnProperty.call(s,r)&&(a=t(s,r),void 0!==a?s[r]=a:delete s[r]);return o.call(e,n,s)}({"":i},""):i}}())};t.exports=n},function(t,e,n){"use strict";function r(t,e){this.queue=t,this.options=e,this.transforms=[]}var o=n(5);r.prototype.configure=function(t){this.queue&&this.queue.configure(t);var e=this.options;return this.options=o.extend(!0,{},e,t),this},r.prototype.addTransform=function(t){return o.isFunction(t)&&this.transforms.push(t),this},r.prototype.log=function(t,e){if(e&&o.isFunction(e)||(e=function(){}),!this.options.enabled)return e(new Error("Rollbar is not enabled"));this.queue.addPendingItem(t);var n=t.err;this._applyTransforms(t,function(r,o){return r?(this.queue.removePendingItem(t),e(r,null)):void this.queue.addItem(o,e,n,t)}.bind(this))},r.prototype._applyTransforms=function(t,e){var n=-1,r=this.transforms.length,o=this.transforms,i=this.options,a=function(t,s){return t?void e(t,null):(n++,n===r?void e(null,s):void o[n](s,i,a))};a(null,t)},t.exports=r},function(t,e,n){"use strict";function r(t){this.queue=[],this.options=i.extend(!0,{},t);var e=this.options.maxTelemetryEvents||a;this.maxQueueSize=Math.max(0,Math.min(e,a))}function o(t,e){if(e)return e;var n={error:"error",manual:"info"};return n[t]||"info"}var i=n(5),a=100;r.prototype.configure=function(t){var e=this.options;this.options=i.extend(!0,{},e,t);var n=this.options.maxTelemetryEvents||a,r=Math.max(0,Math.min(n,a)),o=0;this.maxQueueSize>r&&(o=this.maxQueueSize-r),this.maxQueueSize=r,this.queue.splice(0,o)},r.prototype.copyEvents=function(){return Array.prototype.slice.call(this.queue,0)},r.prototype.capture=function(t,e,n,r,a){var s={level:o(t,n),type:t,timestamp_ms:a||i.now(),body:e,source:"client"};return r&&(s.uuid=r),this.push(s),s},r.prototype.captureEvent=function(t,e,n){return this.capture("manual",t,e,n)},r.prototype.captureError=function(t,e,n,r){var o={message:t.message||String(t)};return t.stack&&(o.stack=t.stack),this.capture("error",o,e,n,r)},r.prototype.captureLog=function(t,e,n,r){return this.capture("log",{message:t},e,n,r)},r.prototype.captureNetwork=function(t,e,n){e=e||"xhr",t.subtype=t.subtype||e;var r=this.levelFromStatus(t.status_code);return this.capture("network",t,r,n)},r.prototype.levelFromStatus=function(t){return t>=200&&t<400?"info":0===t||t>=400?"error":"info"},r.prototype.captureDom=function(t,e,n,r,o){var i={subtype:t,element:e};return void 0!==n&&(i.value=n),void 0!==r&&(i.checked=r),this.capture("dom",i,"info",o)},r.prototype.captureNavigation=function(t,e,n){return this.capture("navigation",{from:t,to:e},"info",n)},r.prototype.captureDomContentLoaded=function(t){return this.capture("navigation",{subtype:"DOMContentLoaded"},"info",void 0,t&&t.getTime())},r.prototype.captureLoad=function(t){return this.capture("navigation",{subtype:"load"},"info",void 0,t&&t.getTime())},r.prototype.captureConnectivityChange=function(t,e){return this.captureNetwork({change:t},"connectivity",e)},r.prototype._captureRollbarItem=function(t){return t.err?this.captureError(t.err,t.level,t.uuid,t.timestamp):t.message?this.captureLog(t.message,t.level,t.uuid,t.timestamp):t.custom?this.capture("log",t.custom,t.level,t.uuid,t.timestamp):void 0},r.prototype.push=function(t){this.queue.push(t),this.queue.length>this.maxQueueSize&&this.queue.shift()},t.exports=r},function(t,e,n){"use strict";function r(t,e,n,r){this.options=t,this.transport=e,this.url=n,this.jsonBackup=r,this.accessToken=t.accessToken,this.transportOptions=o(t,n)}function o(t,e){return a.getTransportFromOptions(t,s,e)}var i=n(5),a=n(11),s={hostname:"api.rollbar.com",path:"/api/1/item/",search:null,version:"1",protocol:"https:",port:443};r.prototype.postItem=function(t,e){var n=a.transportOptions(this.transportOptions,"POST"),r=a.buildPayload(this.accessToken,t,this.jsonBackup);this.transport.post(this.accessToken,n,r,e)},r.prototype.configure=function(t){var e=this.oldOptions;return this.options=i.extend(!0,{},e,t),this.transportOptions=o(this.options,this.url),void 0!==this.options.accessToken&&(this.accessToken=this.options.accessToken),this},t.exports=r},function(t,e,n){"use strict";function r(t,e,n){if(s.isType(e.context,"object")){var r=s.stringify(e.context,n);r.error?e.context="Error: could not serialize 'context'":e.context=r.value||"",e.context.length>255&&(e.context=e.context.substr(0,255))}return{access_token:t,data:e}}function o(t,e,n){var r=e.hostname,o=e.protocol,i=e.port,a=e.path,s=e.search,u=t.proxy;if(t.endpoint){var c=n.parse(t.endpoint);r=c.hostname,o=c.protocol,i=c.port,a=c.pathname,s=c.search}return{hostname:r,protocol:o,port:i,path:a,search:s,proxy:u}}function i(t,e){var n=t.protocol||"https:",r=t.port||("http:"===n?80:"https:"===n?443:void 0),o=t.hostname,i=t.path;return t.search&&(i+=t.search),t.proxy&&(i=n+"//"+o+i,o=t.proxy.host||t.proxy.hostname,r=t.proxy.port,n=t.proxy.protocol||n),{protocol:n,hostname:o,path:i,port:r,method:e}}function a(t,e){var n=/\/$/.test(t),r=/^\//.test(e);return n&&r?e=e.substring(1):n||r||(e="/"+e),t+e}var s=n(5);t.exports={buildPayload:r,getTransportFromOptions:o,transportOptions:i,appendPathToPath:a}},function(t,e,n){"use strict";function r(){var t=Array.prototype.slice.call(arguments,0);t.unshift("Rollbar:"),a.ieVersion()<=8?console.error(s.formatArgsAsString(t)):console.error.apply(console,t)}function o(){var t=Array.prototype.slice.call(arguments,0);t.unshift("Rollbar:"),a.ieVersion()<=8?console.info(s.formatArgsAsString(t)):console.info.apply(console,t)}function i(){var t=Array.prototype.slice.call(arguments,0);t.unshift("Rollbar:"),a.ieVersion()<=8?console.log(s.formatArgsAsString(t)):console.log.apply(console,t)}n(13);var a=n(14),s=n(5);t.exports={error:r,info:o,log:i}},function(t,e){!function(t){"use strict";t.console||(t.console={});for(var e,n,r=t.console,o=function(){},i=["memory"],a="assert,clear,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profiles,profileEnd,show,table,time,timeEnd,timeline,timelineEnd,timeStamp,trace,warn".split(",");e=i.pop();)r[e]||(r[e]={});for(;n=a.pop();)r[n]||(r[n]=o)}("undefined"==typeof window?this:window)},function(t,e){"use strict";function n(){var t;if(!document)return t;for(var e=3,n=document.createElement("div"),r=n.getElementsByTagName("i");n.innerHTML="<!--[if gt IE "+ ++e+"]><i></i><![endif]-->",r[0];);return e>4?e:t}var r={ieVersion:n};t.exports=r},function(t,e){"use strict";function n(t,e,n){if(t){var o;"function"==typeof e._rollbarOldOnError?o=e._rollbarOldOnError:t.onerror&&!t.onerror.belongsToShim&&(o=t.onerror,e._rollbarOldOnError=o);var i=function(){var n=Array.prototype.slice.call(arguments,0);r(t,e,o,n)};i.belongsToShim=n,t.onerror=i}}function r(t,e,n,r){t._rollbarWrappedError&&(r[4]||(r[4]=t._rollbarWrappedError),r[5]||(r[5]=t._rollbarWrappedError._rollbarContext),t._rollbarWrappedError=null),e.handleUncaughtException.apply(e,r),n&&n.apply(t,r)}function o(t,e,n){if(t){"function"==typeof t._rollbarURH&&t._rollbarURH.belongsToShim&&t.removeEventListener("unhandledrejection",t._rollbarURH);var r=function(t){var n=t.reason,r=t.promise,o=t.detail;!n&&o&&(n=o.reason,r=o.promise),e&&e.handleUnhandledRejection&&e.handleUnhandledRejection(n,r)};r.belongsToShim=n,t._rollbarURH=r,t.addEventListener("unhandledrejection",r)}}function i(t,e,n){if(t){var r,o,i="EventTarget,Window,Node,ApplicationCache,AudioTrackList,ChannelMergerNode,CryptoOperation,EventSource,FileReader,HTMLUnknownElement,IDBDatabase,IDBRequest,IDBTransaction,KeyOperation,MediaController,MessagePort,ModalWindow,Notification,SVGElementInstance,Screen,TextTrack,TextTrackCue,TextTrackList,WebSocket,WebSocketWorker,Worker,XMLHttpRequest,XMLHttpRequestEventTarget,XMLHttpRequestUpload".split(",");
  for(r=0;r<i.length;++r)o=i[r],t[o]&&t[o].prototype&&a(e,t[o].prototype,n)}}function a(t,e,n){if(e.hasOwnProperty&&e.hasOwnProperty("addEventListener")){for(var r=e.addEventListener;r._rollbarOldAdd&&r.belongsToShim;)r=r._rollbarOldAdd;var o=function(e,n,o){r.call(this,e,t.wrap(n),o)};o._rollbarOldAdd=r,o.belongsToShim=n,e.addEventListener=o;for(var i=e.removeEventListener;i._rollbarOldRemove&&i.belongsToShim;)i=i._rollbarOldRemove;var a=function(t,e,n){i.call(this,t,e&&e._rollbar_wrapped||e,n)};a._rollbarOldRemove=i,a.belongsToShim=n,e.removeEventListener=a}}t.exports={captureUncaughtExceptions:n,captureUnhandledRejections:o,wrapGlobals:i}},function(t,e,n){"use strict";function r(t,e,n,r,o){r&&l.isFunction(r)||(r=function(){}),l.addParamsAndAccessTokenToPath(t,e,n);var a="GET",s=l.formatUrl(e);i(t,s,a,null,r,o)}function o(t,e,n,r,o){if(r&&l.isFunction(r)||(r=function(){}),!n)return r(new Error("Cannot send empty request"));var a=l.stringify(n);if(a.error)return r(a.error);var s=a.value,u="POST",c=l.formatUrl(e);i(t,c,u,s,r,o)}function i(t,e,n,r,o,i){var h;if(h=i?i():a(),!h)return o(new Error("No way to send a request"));try{try{var f=function(){try{if(f&&4===h.readyState){f=void 0;var t=l.jsonParse(h.responseText);if(s(h))return void o(t.error,t.value);if(u(h)){if(403===h.status){var e=t.value&&t.value.message;p.error(e)}o(new Error(String(h.status)))}else{var n="XHR response had no status code (likely connection failure)";o(c(n))}}}catch(t){var r;r=t&&t.stack?t:new Error(t),o(r)}};h.open(n,e,!0),h.setRequestHeader&&(h.setRequestHeader("Content-Type","application/json"),h.setRequestHeader("X-Rollbar-Access-Token",t)),h.onreadystatechange=f,h.send(r)}catch(t){if("undefined"!=typeof XDomainRequest){if(!window||!window.location)return o(new Error("No window available during request, unknown environment"));"http:"===window.location.href.substring(0,5)&&"https"===e.substring(0,5)&&(e="http"+e.substring(5));var d=new XDomainRequest;d.onprogress=function(){},d.ontimeout=function(){var t="Request timed out",e="ETIMEDOUT";o(c(t,e))},d.onerror=function(){o(new Error("Error during request"))},d.onload=function(){var t=l.jsonParse(d.responseText);o(t.error,t.value)},d.open(n,e,!0),d.send(r)}else o(new Error("Cannot find a method to transport a request"))}}catch(t){o(t)}}function a(){var t,e,n=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],r=n.length;for(e=0;e<r;e++)try{t=n[e]();break}catch(t){}return t}function s(t){return t&&t.status&&200===t.status}function u(t){return t&&l.isType(t.status,"number")&&t.status>=400&&t.status<600}function c(t,e){var n=new Error(t);return n.code=e||"ENOTFOUND",n}var l=n(5),p=n(12);t.exports={get:r,post:o}},function(t,e){"use strict";function n(t){var e,n,r={protocol:null,auth:null,host:null,path:null,hash:null,href:t,hostname:null,port:null,pathname:null,search:null,query:null};if(e=t.indexOf("//"),e!==-1?(r.protocol=t.substring(0,e),n=e+2):n=0,e=t.indexOf("@",n),e!==-1&&(r.auth=t.substring(n,e),n=e+1),e=t.indexOf("/",n),e===-1){if(e=t.indexOf("?",n),e===-1)return e=t.indexOf("#",n),e===-1?r.host=t.substring(n):(r.host=t.substring(n,e),r.hash=t.substring(e)),r.hostname=r.host.split(":")[0],r.port=r.host.split(":")[1],r.port&&(r.port=parseInt(r.port,10)),r;r.host=t.substring(n,e),r.hostname=r.host.split(":")[0],r.port=r.host.split(":")[1],r.port&&(r.port=parseInt(r.port,10)),n=e}else r.host=t.substring(n,e),r.hostname=r.host.split(":")[0],r.port=r.host.split(":")[1],r.port&&(r.port=parseInt(r.port,10)),n=e;if(e=t.indexOf("#",n),e===-1?r.path=t.substring(n):(r.path=t.substring(n,e),r.hash=t.substring(e)),r.path){var o=r.path.split("?");r.pathname=o[0],r.query=o[1],r.search=r.query?"?"+r.query:null}return r}t.exports={parse:n}},function(t,e,n){"use strict";function r(t,e,n){if(t.data=t.data||{},t.err)try{t.stackInfo=t.err._savedStackTrace||m.parse(t.err)}catch(e){g.error("Error while parsing the error object.",e),t.message=t.err.message||t.err.description||t.message||String(t.err),delete t.err}n(null,t)}function o(t,e,n){t.message||t.stackInfo||t.custom||n(new Error("No message, stack info, or custom data"),null),n(null,t)}function i(t,e,n){var r=e.payload&&e.payload.environment||e.environment;t.data=d.extend(!0,{},t.data,{environment:r,level:t.level,endpoint:e.endpoint,platform:"browser",framework:"browser-js",language:"javascript",server:{},uuid:t.uuid,notifier:{name:"rollbar-browser-js",version:e.version}}),n(null,t)}function a(t){return function(e,n,r){return t&&t.location?(d.set(e,"data.request",{url:t.location.href,query_string:t.location.search,user_ip:"$remote_ip"}),void r(null,e)):r(null,e)}}function s(t){return function(e,n,r){return t?(d.set(e,"data.client",{runtime_ms:e.timestamp-t._rollbarStartTime,timestamp:Math.round(e.timestamp/1e3),javascript:{browser:t.navigator.userAgent,language:t.navigator.language,cookie_enabled:t.navigator.cookieEnabled,screen:{width:t.screen.width,height:t.screen.height}}}),void r(null,e)):r(null,e)}}function u(t){return function(e,n,r){if(!t||!t.navigator)return r(null,e);for(var o,i=[],a=t.navigator.plugins||[],s=0,u=a.length;s<u;++s)o=a[s],i.push({name:o.name,description:o.description});d.set(e,"data.client.javascript.plugins",i),r(null,e)}}function c(t,e,n){t.stackInfo?p(t,e,n):l(t,e,n)}function l(t,e,n){var r=t.message,o=t.custom;if(!r)if(o){var i=e.scrubFields,a=d.stringify(d.scrub(o,i));r=a.error||a.value||""}else r="";var s={body:r};o&&(s.extra=d.extend(!0,{},o)),d.set(t,"data.body",{message:s}),n(null,t)}function p(t,e,n){var r=t.data.description,o=t.stackInfo,i=t.custom,a=m.guessErrorClass(o.message),s=o.name||a[0],u=a[1],c={exception:{class:s,message:u}};r&&(c.exception.description=r);var p=o.stack;if(p&&0===p.length&&t._unhandledStackInfo&&t._unhandledStackInfo.stack&&(p=t._unhandledStackInfo.stack),p){var h,f,g,v,y,b,w,_;for(c.frames=[],w=0;w<p.length;++w)h=p[w],f={filename:h.url?d.sanitizeUrl(h.url):"(unknown)",lineno:h.line||null,method:h.func&&"?"!==h.func?h.func:"[anonymous]",colno:h.column},f.method&&f.method.endsWith&&f.method.endsWith("_rollbar_wrapped")||(g=v=y=null,b=h.context?h.context.length:0,b&&(_=Math.floor(b/2),v=h.context.slice(0,_),g=h.context[_],y=h.context.slice(_)),g&&(f.code=g),(v||y)&&(f.context={},v&&v.length&&(f.context.pre=v),y&&y.length&&(f.context.post=y)),h.args&&(f.args=h.args),c.frames.push(f));c.frames.reverse(),i&&(c.extra=d.extend(!0,{},i)),d.set(t,"data.body",{trace:c}),n(null,t)}else t.message=s+": "+u,l(t,e,n)}function h(t,e,n){var r=e.scrubFields;d.scrub(t.data,r),n(null,t)}function f(t,e,n){var r=d.extend(!0,{},t);try{d.isFunction(e.transform)&&e.transform(r.data)}catch(r){return e.transform=null,g.error("Error while calling custom transform() function. Removing custom transform().",r),void n(null,t)}n(null,r)}var d=n(5),m=n(19),g=n(12);t.exports={handleItemWithError:r,ensureItemHasSomethingToSay:o,addBaseInfo:i,addRequestInfo:a,addClientInfo:s,addPluginInfo:u,addBody:c,scrubPayload:h,userTransform:f}},function(t,e,n){"use strict";function r(){return l}function o(){return null}function i(t){var e={};return e._stackFrame=t,e.url=t.fileName,e.line=t.lineNumber,e.func=t.functionName,e.column=t.columnNumber,e.args=t.args,e.context=o(e.url,e.line),e}function a(t){function e(){var e=[];try{e=c.parse(t)}catch(t){e=[]}for(var n=[],r=0;r<e.length;r++)n.push(new i(e[r]));return n}return{stack:e(),message:t.message,name:t.name}}function s(t){return new a(t)}function u(t){if(!t)return["Unknown error. There was no error message to display.",""];var e=t.match(p),n="(unknown)";return e&&(n=e[e.length-1],t=t.replace((e[e.length-2]||"")+n+":",""),t=t.replace(/(^[\s]+|[\s]+$)/g,"")),[n,t]}var c=n(20),l="?",p=new RegExp("^(([a-zA-Z0-9-_$ ]*): *)?(Uncaught )?([a-zA-Z0-9-_$ ]*): ");t.exports={guessFunctionName:r,guessErrorClass:u,gatherContext:o,parse:s,Stack:a,Frame:i}},function(t,e,n){var r,o,i;!function(a,s){"use strict";o=[n(21)],r=s,i="function"==typeof r?r.apply(e,o):r,!(void 0!==i&&(t.exports=i))}(this,function(t){"use strict";function e(t,e,n){if("function"==typeof Array.prototype.map)return t.map(e,n);for(var r=new Array(t.length),o=0;o<t.length;o++)r[o]=e.call(n,t[o]);return r}function n(t,e,n){if("function"==typeof Array.prototype.filter)return t.filter(e,n);for(var r=[],o=0;o<t.length;o++)e.call(n,t[o])&&r.push(t[o]);return r}var r=/(^|@)\S+\:\d+/,o=/^\s*at .*(\S+\:\d+|\(native\))/m,i=/^(eval@)?(\[native code\])?$/;return{parse:function(t){if("undefined"!=typeof t.stacktrace||"undefined"!=typeof t["opera#sourceloc"])return this.parseOpera(t);if(t.stack&&t.stack.match(o))return this.parseV8OrIE(t);if(t.stack)return this.parseFFOrSafari(t);throw new Error("Cannot parse given Error object")},extractLocation:function(t){if(t.indexOf(":")===-1)return[t];var e=t.replace(/[\(\)\s]/g,"").split(":"),n=e.pop(),r=e[e.length-1];if(!isNaN(parseFloat(r))&&isFinite(r)){var o=e.pop();return[e.join(":"),o,n]}return[e.join(":"),n,void 0]},parseV8OrIE:function(r){var i=n(r.stack.split("\n"),function(t){return!!t.match(o)},this);return e(i,function(e){e.indexOf("(eval ")>-1&&(e=e.replace(/eval code/g,"eval").replace(/(\(eval at [^\()]*)|(\)\,.*$)/g,""));var n=e.replace(/^\s+/,"").replace(/\(eval code/g,"(").split(/\s+/).slice(1),r=this.extractLocation(n.pop()),o=n.join(" ")||void 0,i="eval"===r[0]?void 0:r[0];return new t(o,void 0,i,r[1],r[2],e)},this)},parseFFOrSafari:function(r){var o=n(r.stack.split("\n"),function(t){return!t.match(i)},this);return e(o,function(e){if(e.indexOf(" > eval")>-1&&(e=e.replace(/ line (\d+)(?: > eval line \d+)* > eval\:\d+\:\d+/g,":$1")),e.indexOf("@")===-1&&e.indexOf(":")===-1)return new t(e);var n=e.split("@"),r=this.extractLocation(n.pop()),o=n.shift()||void 0;return new t(o,void 0,r[0],r[1],r[2],e)},this)},parseOpera:function(t){return!t.stacktrace||t.message.indexOf("\n")>-1&&t.message.split("\n").length>t.stacktrace.split("\n").length?this.parseOpera9(t):t.stack?this.parseOpera11(t):this.parseOpera10(t)},parseOpera9:function(e){for(var n=/Line (\d+).*script (?:in )?(\S+)/i,r=e.message.split("\n"),o=[],i=2,a=r.length;i<a;i+=2){var s=n.exec(r[i]);s&&o.push(new t(void 0,void 0,s[2],s[1],void 0,r[i]))}return o},parseOpera10:function(e){for(var n=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,r=e.stacktrace.split("\n"),o=[],i=0,a=r.length;i<a;i+=2){var s=n.exec(r[i]);s&&o.push(new t(s[3]||void 0,void 0,s[2],s[1],void 0,r[i]))}return o},parseOpera11:function(o){var i=n(o.stack.split("\n"),function(t){return!!t.match(r)&&!t.match(/^Error created at/)},this);return e(i,function(e){var n,r=e.split("@"),o=this.extractLocation(r.pop()),i=r.shift()||"",a=i.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^\)]*\)/g,"")||void 0;i.match(/\(([^\)]*)\)/)&&(n=i.replace(/^[^\(]+\(([^\)]*)\)$/,"$1"));var s=void 0===n||"[arguments not available]"===n?void 0:n.split(",");return new t(a,s,o[0],o[1],o[2],e)},this)}}})},function(t,e,n){var r,o,i;!function(n,a){"use strict";o=[],r=a,i="function"==typeof r?r.apply(e,o):r,!(void 0!==i&&(t.exports=i))}(this,function(){"use strict";function t(t){return!isNaN(parseFloat(t))&&isFinite(t)}function e(t,e,n,r,o,i){void 0!==t&&this.setFunctionName(t),void 0!==e&&this.setArgs(e),void 0!==n&&this.setFileName(n),void 0!==r&&this.setLineNumber(r),void 0!==o&&this.setColumnNumber(o),void 0!==i&&this.setSource(i)}return e.prototype={getFunctionName:function(){return this.functionName},setFunctionName:function(t){this.functionName=String(t)},getArgs:function(){return this.args},setArgs:function(t){if("[object Array]"!==Object.prototype.toString.call(t))throw new TypeError("Args must be an Array");this.args=t},getFileName:function(){return this.fileName},setFileName:function(t){this.fileName=String(t)},getLineNumber:function(){return this.lineNumber},setLineNumber:function(e){if(!t(e))throw new TypeError("Line Number must be a Number");this.lineNumber=Number(e)},getColumnNumber:function(){return this.columnNumber},setColumnNumber:function(e){if(!t(e))throw new TypeError("Column Number must be a Number");this.columnNumber=Number(e)},getSource:function(){return this.source},setSource:function(t){this.source=String(t)},toString:function(){var e=this.getFunctionName()||"{anonymous}",n="("+(this.getArgs()||[]).join(",")+")",r=this.getFileName()?"@"+this.getFileName():"",o=t(this.getLineNumber())?":"+this.getLineNumber():"",i=t(this.getColumnNumber())?":"+this.getColumnNumber():"";return e+n+r+o+i}},e})},function(t,e,n){"use strict";function r(t,e,n){var r=e.payload||{};r.body&&delete r.body;var o=a.extend(!0,{},t.data,r);t._isUncaught&&(o._isUncaught=!0),t._originalArgs&&(o._originalArgs=t._originalArgs),n(null,o)}function o(t,e,n){t.telemetryEvents&&a.set(t,"data.body.telemetry",t.telemetryEvents),n(null,t)}function i(t,e,n){if(!t.message)return void n(null,t);var r="data.body.trace_chain.0",o=a.get(t,r);if(o||(r="data.body.trace",o=a.get(t,r)),o){if(!o.exception||!o.exception.description)return a.set(t,r+".exception.description",t.message),void n(null,t);var i=a.get(t,r+".extra")||{},s=a.extend(!0,{},i,{message:t.message});a.set(t,r+".extra",s)}n(null,t)}var a=n(5);t.exports={itemToPayload:r,addTelemetryData:o,addMessageWithError:i}},function(t,e,n){"use strict";function r(t,e){var n=t.level,r=c.LEVELS[n]||0,o=c.LEVELS[e.reportLevel]||0;return!(r<o)&&(!c.get(e,"plugins.jquery.ignoreAjaxErrors")||!c.get(t,"body.message.extra.isAjax"))}function o(t,e){var n=!!t._isUncaught;delete t._isUncaught;var r=t._originalArgs;delete t._originalArgs;try{if(c.isFunction(e.checkIgnore)&&e.checkIgnore(n,r,t))return!1}catch(t){e.checkIgnore=null,l.error("Error while calling custom checkIgnore(), removing",t)}return!0}function i(t,e){return!s(t,e,"blacklist")}function a(t,e){return s(t,e,"whitelist")}function s(t,e,n){var r=!1;"blacklist"===n&&(r=!0);var o,i,a,s,u,p,h,f,d,m;try{if(o=r?e.hostBlackList:e.hostWhiteList,h=o&&o.length,i=c.get(t,"body.trace"),!o||0===h)return!r;if(!i||!i.frames)return!r;for(u=i.frames.length,d=0;d<u;d++){if(a=i.frames[d],s=a.filename,!c.isType(s,"string"))return!r;for(m=0;m<h;m++)if(p=o[m],f=new RegExp(p),f.test(s))return!0}}catch(t){r?e.hostBlackList=null:e.hostWhiteList=null;var g=r?"hostBlackList":"hostWhiteList";return l.error("Error while reading your configuration's "+g+" option. Removing custom "+g+".",t),!r}return!1}function u(t,e){var n,r,o,i,a,s,u,p,h;try{if(a=!1,o=e.ignoredMessages,!o||0===o.length)return!0;if(u=t.body,p=c.get(u,"trace.exception.message"),h=c.get(u,"message.body"),n=p||h,!n)return!0;for(i=o.length,r=0;r<i&&(s=new RegExp(o[r],"gi"),!(a=s.test(n)));r++);}catch(t){e.ignoredMessages=null,l.error("Error while reading your configuration's ignoredMessages option. Removing custom ignoredMessages.")}return!a}var c=n(5),l=n(12);t.exports={checkIgnore:r,userCheckIgnore:o,urlIsNotBlacklisted:i,urlIsWhitelisted:a,messageIsIgnored:u}},function(t,e,n){"use strict";function r(t,e,n,r,o){var i=t[e];t[e]=n(i),r&&r[o].push([t,e,i])}function o(t,e){for(var n;t[e].length;)n=t[e].shift(),n[0][n[1]]=n[2]}function i(t,e,n,r,o){var i=t.autoInstrument;t.enabled===!1||i===!1?this.autoInstrument={}:(a.isType(i,"object")||(i=c),this.autoInstrument=a.extend(!0,{},c,i)),this.scrubTelemetryInputs=!!t.scrubTelemetryInputs,this.telemetryScrubber=t.telemetryScrubber,this.telemeter=e,this.rollbar=n,this._window=r||{},this._document=o||{},this.replacements={network:[],log:[],navigation:[],connectivity:[]},this.eventRemovers={dom:[],connectivity:[]},this._location=this._window.location,this._lastHref=this._location&&this._location.href}var a=n(5),s=n(17),u=n(25),c={network:!0,log:!0,dom:!0,navigation:!0,connectivity:!0};i.prototype.configure=function(t){var e=t.autoInstrument,n=a.extend(!0,{},this.autoInstrument);t.enabled===!1||e===!1?this.autoInstrument={}:(a.isType(e,"object")||(e=c),this.autoInstrument=a.extend(!0,{},c,e)),this.instrument(n),void 0!==t.scrubTelemetryInputs&&(this.scrubTelemetryInputs=!!t.scrubTelemetryInputs),void 0!==t.telemetryScrubber&&(this.telemetryScrubber=t.telemetryScrubber)},i.prototype.instrument=function(t){!this.autoInstrument.network||t&&t.network?!this.autoInstrument.network&&t&&t.network&&this.deinstrumentNetwork():this.instrumentNetwork(),!this.autoInstrument.log||t&&t.log?!this.autoInstrument.log&&t&&t.log&&this.deinstrumentConsole():this.instrumentConsole(),!this.autoInstrument.dom||t&&t.dom?!this.autoInstrument.dom&&t&&t.dom&&this.deinstrumentDom():this.instrumentDom(),!this.autoInstrument.navigation||t&&t.navigation?!this.autoInstrument.navigation&&t&&t.navigation&&this.deinstrumentNavigation():this.instrumentNavigation(),!this.autoInstrument.connectivity||t&&t.connectivity?!this.autoInstrument.connectivity&&t&&t.connectivity&&this.deinstrumentConnectivity():this.instrumentConnectivity()},i.prototype.deinstrumentNetwork=function(){o(this.replacements,"network")},i.prototype.instrumentNetwork=function(){function t(t,n){t in n&&a.isFunction(n[t])&&r(n,t,function(t){return e.rollbar.wrap(t)})}var e=this;if("XMLHttpRequest"in this._window){var n=this._window.XMLHttpRequest.prototype;r(n,"open",function(t){return function(e,n){return a.isType(n,"string")&&(this.__rollbar_xhr={method:e,url:n,status_code:null,start_time_ms:a.now(),end_time_ms:null}),t.apply(this,arguments)}},this.replacements,"network"),r(n,"send",function(n){return function(o){function i(){if(s.__rollbar_xhr&&(1===s.readyState||4===s.readyState)){null===s.__rollbar_xhr.status_code&&(s.__rollbar_xhr.status_code=0,s.__rollbar_event=e.telemeter.captureNetwork(s.__rollbar_xhr,"xhr")),1===s.readyState?s.__rollbar_xhr.start_time_ms=a.now():s.__rollbar_xhr.end_time_ms=a.now();try{var t=s.status;t=1223===t?204:t,s.__rollbar_xhr.status_code=t,s.__rollbar_event.level=e.telemeter.levelFromStatus(t)}catch(t){}}}var s=this;return t("onload",s),t("onerror",s),t("onprogress",s),"onreadystatechange"in s&&a.isFunction(s.onreadystatechange)?r(s,"onreadystatechange",function(t){return e.rollbar.wrap(t,void 0,i)}):s.onreadystatechange=i,n.apply(this,arguments)}},this.replacements,"network")}"fetch"in this._window&&r(this._window,"fetch",function(t){return function(n,r){for(var o=new Array(arguments.length),i=0,s=o.length;i<s;i++)o[i]=arguments[i];var u,c=o[0],l="GET";a.isType(c,"string")?u=c:(u=c.url,c.method&&(l=c.method)),o[1]&&o[1].method&&(l=o[1].method);var p={method:l,url:u,status_code:null,start_time_ms:a.now(),end_time_ms:null};return e.telemeter.captureNetwork(p,"fetch"),t.apply(this,o).then(function(t){return p.end_time_ms=a.now(),p.status_code=t.status,t})}},this.replacements,"network")},i.prototype.deinstrumentConsole=function(){if("console"in this._window&&this._window.console.log)for(var t;this.replacements.log.length;)t=this.replacements.log.shift(),this._window.console[t[0]]=t[1]},i.prototype.instrumentConsole=function(){function t(t){var r=n[t],o=n,i="warn"===t?"warning":t;n[t]=function(){var t=Array.prototype.slice.call(arguments),n=a.formatArgsAsString(t);e.telemeter.captureLog(n,i),r&&Function.prototype.apply.call(r,o,t)},e.replacements.log.push([t,r])}if("console"in this._window&&this._window.console.log)for(var e=this,n=this._window.console,r=["debug","info","warn","error","log"],o=0,i=r.length;o<i;o++)t(r[o])},i.prototype.deinstrumentDom=function(){("addEventListener"in this._window||"attachEvent"in this._window)&&this.removeListeners("dom")},i.prototype.instrumentDom=function(){if("addEventListener"in this._window||"attachEvent"in this._window){var t=this.handleClick.bind(this),e=this.handleBlur.bind(this);this.addListener("dom",this._window,"click","onclick",t,!0),this.addListener("dom",this._window,"blur","onfocusout",e,!0)}},i.prototype.handleClick=function(t){try{var e=u.getElementFromEvent(t,this._document),n=e&&e.tagName,r=u.isDescribedElement(e,"a")||u.isDescribedElement(e,"button");n&&(r||u.isDescribedElement(e,"input",["button","submit"]))?this.captureDomEvent("click",e):u.isDescribedElement(e,"input",["checkbox","radio"])&&this.captureDomEvent("input",e,e.value,e.checked)}catch(t){}},i.prototype.handleBlur=function(t){try{var e=u.getElementFromEvent(t,this._document);e&&e.tagName&&(u.isDescribedElement(e,"textarea")?this.captureDomEvent("input",e,e.value):u.isDescribedElement(e,"select")&&e.options&&e.options.length?this.handleSelectInputChanged(e):u.isDescribedElement(e,"input")&&!u.isDescribedElement(e,"input",["button","submit","hidden","checkbox","radio"])&&this.captureDomEvent("input",e,e.value))}catch(t){}},i.prototype.handleSelectInputChanged=function(t){if(t.multiple)for(var e=0;e<t.options.length;e++)t.options[e].selected&&this.captureDomEvent("input",t,t.options[e].value);else t.selectedIndex>=0&&t.options[t.selectedIndex]&&this.captureDomEvent("input",t,t.options[t.selectedIndex].value)},i.prototype.captureDomEvent=function(t,e,n,r){if(void 0!==n)if(this.scrubTelemetryInputs||"password"===u.getElementType(e))n="[scrubbed]";else if(this.telemetryScrubber){var o=u.describeElement(e);this.telemetryScrubber(o)&&(n="[scrubbed]")}var i=u.elementArrayToString(u.treeToArray(e));this.telemeter.captureDom(t,i,n,r)},i.prototype.deinstrumentNavigation=function(){var t=this._window.chrome,e=t&&t.app&&t.app.runtime,n=!e&&this._window.history&&this._window.history.pushState;n&&o(this.replacements,"navigation")},i.prototype.instrumentNavigation=function(){var t=this._window.chrome,e=t&&t.app&&t.app.runtime,n=!e&&this._window.history&&this._window.history.pushState;if(n){var o=this;r(this._window,"onpopstate",function(t){return function(){var e=o._location.href;o.handleUrlChange(o._lastHref,e),t&&t.apply(this,arguments)}},this.replacements,"navigation"),r(this._window.history,"pushState",function(t){return function(){var e=arguments.length>2?arguments[2]:void 0;return e&&o.handleUrlChange(o._lastHref,e+""),t.apply(this,arguments)}},this.replacements,"navigation")}},i.prototype.handleUrlChange=function(t,e){var n=s.parse(this._location.href),r=s.parse(e),o=s.parse(t);this._lastHref=e,n.protocol===r.protocol&&n.host===r.host&&(e=r.path+(r.hash||"")),n.protocol===o.protocol&&n.host===o.host&&(t=o.path+(o.hash||"")),this.telemeter.captureNavigation(t,e)},i.prototype.deinstrumentConnectivity=function(){("addEventListener"in this._window||"body"in this._document)&&(this._window.addEventListener?this.removeListeners("connectivity"):o(this.replacements,"connectivity"))},i.prototype.instrumentConnectivity=function(){if("addEventListener"in this._window||"body"in this._document)if(this._window.addEventListener)this.addListener("connectivity",this._window,"online",void 0,function(){this.telemeter.captureConnectivityChange("online")}.bind(this),!0),this.addListener("connectivity",this._window,"offline",void 0,function(){this.telemeter.captureConnectivityChange("offline")}.bind(this),!0);else{var t=this;r(this._document.body,"ononline",function(e){return function(){t.telemeter.captureConnectivityChange("online"),e&&e.apply(this,arguments)}},this.replacements,"connectivity"),r(this._document.body,"onoffline",function(e){return function(){t.telemeter.captureConnectivityChange("offline"),e&&e.apply(this,arguments)}},this.replacements,"connectivity")}},i.prototype.addListener=function(t,e,n,r,o,i){e.addEventListener?(e.addEventListener(n,o,i),this.eventRemovers[t].push(function(){e.removeEventListener(n,o,i)})):r&&(e.attachEvent(r,o),this.eventRemovers[t].push(function(){e.detachEvent(r,o)}))},i.prototype.removeListeners=function(t){for(var e;this.eventRemovers[t].length;)(e=this.eventRemovers[t].shift())()},t.exports=i},function(t,e){"use strict";function n(t){return(t.getAttribute("type")||"").toLowerCase()}function r(t,e,r){if(t.tagName.toLowerCase()!==e.toLowerCase())return!1;if(!r)return!0;t=n(t);for(var o=0;o<r.length;o++)if(r[o]===t)return!0;return!1}function o(t,e){return t.target?t.target:e&&e.elementFromPoint?e.elementFromPoint(t.clientX,t.clientY):void 0}function i(t){for(var e,n=5,r=[],o=0;t&&o<n&&(e=u(t),"html"!==e.tagName);o++)r.unshift(e),t=t.parentNode;return r}function a(t){for(var e,n,r=80,o=" > ",i=o.length,a=[],u=0,c=t.length-1;c>=0;c--){if(e=s(t[c]),n=u+a.length*i+e.length,c<t.length-1&&n>=r+3){a.unshift("...");break}a.unshift(e),u+=e.length}return a.join(o)}function s(t){if(!t||!t.tagName)return"";var e=[t.tagName];t.id&&e.push("#"+t.id),t.classes&&e.push("."+t.classes.join("."));for(var n=0;n<t.attributes.length;n++)e.push("["+t.attributes[n].key+'="'+t.attributes[n].value+'"]');return e.join("")}function u(t){if(!t||!t.tagName)return null;var e,n,r,o,i={};i.tagName=t.tagName.toLowerCase(),t.id&&(i.id=t.id),e=t.className,e&&"string"==typeof e&&(i.classes=e.split(/\s+/));var a=["type","name","title","alt"];for(i.attributes=[],o=0;o<a.length;o++)n=a[o],r=t.getAttribute(n),r&&i.attributes.push({key:n,value:r});return i}t.exports={describeElement:u,descriptionToString:s,elementArrayToString:a,treeToArray:i,getElementFromEvent:o,isDescribedElement:r,getElementType:n}}]);}catch(ignore){}

;
!function(r){function t(n){if(e[n])return e[n].exports;var a=e[n]={exports:{},id:n,loaded:!1};return r[n].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var e={};return t.m=r,t.c=e,t.p="",t(0)}([function(r,t,e){"use strict";!function(r,t,e){var n=t.Rollbar;if(n){var a="0.0.8";n.configure({payload:{notifier:{plugins:{jquery:{version:a}}}}});var o=function(r){if(n.error(r),t.console){var e="[reported to Rollbar]";n.options&&!n.options.enabled&&(e="[Rollbar not enabled]"),t.console.log(r.message+" "+e)}};r(e).ajaxError(function(r,t,e,a){var o=t.status,u=e.url,i=e.type;if(o){var s={status:o,url:u,type:i,isAjax:!0,data:e.data,jqXHR_responseText:t.responseText,jqXHR_statusText:t.statusText},d=a?a:"jQuery ajax error for "+i;n.warning(d,s)}});var u=r.fn.ready;r.fn.ready=function(r){return u.call(this,function(t){try{r(t)}catch(r){o(r)}})};var i=r.event.add;r.event.add=function(t,e,n,a,u){var s,d=function(r){return function(){try{return r.apply(this,arguments)}catch(r){o(r)}}};return n.handler?(s=n.handler,n.handler=d(n.handler)):(s=n,n=d(n)),s.guid?n.guid=s.guid:n.guid=s.guid=r.guid++,i.call(this,t,e,n,a,u)}}}(jQuery,window,document)}]);




SA.define('SA.Rollbar', [], function() {

  'use strict';

  return window.Rollbar;

});
// jQuery extension
// Prevents a function call from happening EVERY time an event is fired from the browser.

// Usage:
//  See http://api.jquery.com/bind/
//  .bindWithDelay( eventType, [ eventData ], handler(eventObject), timeout, throttle )

//Examples:
//  $("#foo").bindWithDelay('click', function(e) { }, 100);
//  $(window).bindWithDelay('resize', { optional: 'eventData' }, callback, 1000);
//  $(window).bindWithDelay('resize', callback, 1000, true);

(function($) {

  'use strict';

  // Binds delayed event to jQuery object.
  // @param {string} type - standard browser/jQuery event name (click, resize, scroll).
  // @param {anything} data - an object containing data that will be passed to the event handler. (optional)
  // @param {function} fn - function to execute each time the event is triggered.
  // @param {number} timeout - execution timeout in ms.
  // @param {bool} throttle - indicates if throttle function should be applied. (optional)

  // @return {jQuery} - jquery object with event connected event.
  $.fn.bindWithDelay = function(type, data, fn, timeout, throttle) {

    if ($.isFunction(data)) {
      throttle = timeout;
      timeout = fn;
      fn = data;
      data = undefined;
    }

    // Allow delayed function to be removed with fn in unbind function
    fn.guid = fn.guid || ($.guid && $.guid++);

    // Bind each separately so that each element has its own delay
    return this.each(function() {

      var wait = null;

      function cb() {
        var e = $.extend(true, {}, arguments[0]);
        var ctx = this;
        var throttler = function() {
          wait = null;
          fn.apply(ctx, [e]);
        };

        if (!throttle) {
          clearTimeout(wait);
          wait = null;
        }

        if (!wait) {
          wait = setTimeout(throttler, timeout);
        }
      }

      cb.guid = fn.guid;

      $(this).bind(type, data, cb);
    });
  };

}(window.jQuery));
// Simple exceptions handling module designed to pass exceptions to Rollbar, 100% async
// https://rollbar.com/docs/notifier/rollbar.js/#usage

// Usage:
// try {
//   uid = SA.Data.User.id
// } catch(e) {
//   SA.exception.push(['user module was not defined', e, {authorId: 123}])
// }

SA.require(['SA.Rollbar'], function(r) {

  'use strict';

  var q = SA.exceptions || [];

  function send(arr) {
    // in case Rollbar failed on execution (happen to old browsers)
    if(r && r.critical) {
      return SA.App.env.dev ? console.error.apply(window, arr) : r.critical.apply(r, arr);
    }
  }

  // Public function
  // 'critical' is sent to Rollbar
  // @param [m, e, c]
  // @param {string} m - custom message sent to Rollbar.
  // @param {object} e - exception cought by try - catch handler.
  // @param {object} c - custom data to be sent to Rollbar

  SA.exceptions = {
    push: function() {
      var len = arguments.length, i = 0;
      for(i; i < len; i += 1) {
        send(arguments[i]);
      }
    }
  };

  SA.exceptions.push.apply(this, q);

}, 'sa-exception');
SA.define('SA.Rx.email', [], function() {

  'use strict';

  return /\w[\w#$\%^&*'\/=?_`{|}~+-]*(\.[\w#$\%^&*'\/=?_`{|}~+-]+)*@(\w[\w-]*\.)+[a-z]{2,63}/i;

});
// Implementation of localStorage using general store adapter
// https://developer.mozilla.org/en/docs/Web/API/Window/localStorage

// Usage:
//   SA.Data.Cache.set('key', 'val') - set value with key provided. No expiration
//   SA.Data.Cache.set('key', 'val', 20 * 1000) - set value with key provided. Expires in 20 sec.
//   SA.Data.Cache.get('key', true) - get value with given key. Item was set with expiration param
//   SA.Data.Cache.del('key') - remove item with given key from localStorage.

SA.define('SA.Data.Cache', [], function() {

  'use strict';

  var w = window, full = false, enabled, ls, st = {},
      deletedKeys = ['articles_read','news_read'];

  function getKeysSizes() {
    var h = {total: 0}, v;
    Object.keys(ls).forEach(function(k) {
      h.total += 1;
      v = ls.getItem(k) || '';
      h[k] = v.length;
    });
    return h;
  }

  function isQuotaExceeded(e) {
    if ((
        // everything except Firefox
        e.code === 22 ||
        // Firefox
        e.code === 1014 ||
        // test name field too, because code might not be present
        // everything except Firefox
        e.name === 'QuotaExceededError' ||
        // Firefox
        e.name === 'NS_ERROR_DOM_QUOTA_REACHED' ||
        // old IE
        e.number === -2147024882
      ) &&
      // acknowledge QuotaExceededError only if there's something already stored
      ls.length !== 0) {
      full = true;
      SA.exceptions.push(['localStorage Quote Data Exceeded', e, {items: getKeysSizes()}]);
    }
  }

  function storageAvailable() {
    var res = false, k = 'SA';
    try {
      // even direct call to window.localStorage can coz security exception
      ls = w.localStorage;
      ls.setItem(k, k);
      res = k === ls.getItem(k);
      ls.removeItem(k);
    }
    catch(e) {
      res = false;
      isQuotaExceeded(e);
    }
    return res;
  }


  function expired(v) {
    return v !== null && typeof v === 'object' && v.expires && new Date() > new Date(v.expires);
  }

  function del(k) {
    if(enabled) {
      ls.removeItem(k);
    }
  }

  function getVal(key, canExpire) {
    var obj = ls.getItem(key);
    canExpire = canExpire || false;
    if (obj && canExpire) {
      SA.exec(function () {
        obj = JSON.parse(obj);
        if (expired(obj)) {
          // expired
          ls.removeItem(key);
          obj = {value: null};
        }
        obj = obj.value;
      });
    }
    return obj;
  }

  function expireOld() {
    var v;
    Object.keys(ls).forEach(function(k) {
      try {
        v = JSON.parse(ls[k]);
      } catch (ignore) {}
      if (expired(v)) {
        del(k);
      }
    });

    deletedKeys.forEach(function(k) {
      del(k);
    });
  }

  function setup() {
    enabled = storageAvailable();
    if(enabled) {
      w.setTimeout(expireOld, 20000);
    }
  }

  setup();

  // Public methods

  st.enabled = enabled && !full;

  // method of the localStorage interface, when passed a key name, will return that key's value.
  // https://developer.mozilla.org/en-US/docs/Web/API/Storage/getItem
  // @param {string} key - string containing the name of the key you want to retrieve the value of.
  // @param {bool} key - bool indicator that function was set with expire param.
  st.get = function(key, canExpire) {
    return enabled ? getVal(key, canExpire) : null;
  };

  st.getJson = function(key) {
    return SA.exec(function() {
      return JSON.parse(st.get(key));
    }) || {};
  };

  // method of the localStorage interface, when passed a key name and value, will add that key to the storage, or update that key's value if it already exists.
  // https://developer.mozilla.org/en-US/docs/Web/API/Storage/setItem
  // @param {string} key - string containing the name of the key you want to create/update.
  // @param {string} value - string containing the value you want to give the key you are creating/updating.
  // @param {number} expires - time after which item in localStorage will be considered expired. (optional)
  // If @param expires was not provided - item will stay in localStorage unless removed manually
  // If item was set with expires param - it must be retrieved with canExpire set to true
  st.set = function(key, val, expires) {
    if (enabled && !full) {
      try {
        val = expires ? JSON.stringify({value: val, expires: Date.now() + (parseInt(expires, 10) || 0)}) : val;
        ls.setItem(key, val);
      } catch (e) {
        isQuotaExceeded(e);
      }
    }
  };

  st.setJson = function(key, obj) {
    SA.exec(function() {
      st.set(key, JSON.stringify(obj));
    });
  };

  // method of the Storage interface, when passed a key name, will remove that key from the storage.
  // @param {string} key - string containing the name of the key you want to remove.
  st.del = function (k) {
    del(k);
  };

  // get direct reference to browsers localStorage object if it is enabled
  st.getStore = function () {
    return enabled ? ls : null;
  };

  return st;

});
// Implementation of Cookies Adapter
// On initialization module parses document.cookie and caches it in cookieCache object
// After updating/removing the item, cookieCache object transformed back to string and document.cookie replaced
// https://developer.mozilla.org/en-US/Add-ons/WebExtensions/API/cookies/Cookie

// Usage
//   SA.Data.Cookies.set('key', 'val') - create/update cookie with provided value
//   SA.Data.Cookies.get('key') - get cookie value by key

SA.define('SA.Data.Cookies', [], function() {

  'use strict';

  var d = window.document, cookieCache, cachedDocCookie, cs = {};

  function extendOpt(opt) {
    opt = opt || {};
    return {
      path: opt.path || '/',
      expires: opt.expires || Infinity,
      secure: opt.secure || false
    };
  }

  function getExpiresDate(exp) {
    var now = new Date();
    return exp === Infinity ? new Date(now.getTime() + 3600 * 1000 * 24 * 365 * 10) : new Date(now.getTime() + exp * 1000);
  }

  function generateCookieString(k, v, opt) {
    var c;
    k = encodeURIComponent(k);
    v = encodeURIComponent(v);
    opt = opt || {};
    c = k + '=' + v;
    c += opt.path ? ';path=' + opt.path : '';
    c += opt.expires ? ';expires=' + opt.expires.toUTCString() : '';
    c += ';secure';

    return c;
  }

  function safeDecode(val) {
    return SA.exec(function() {
      return decodeURIComponent(val);
    });
  }

  function getKVPair(str) {
    // Server encodes space as '+', so I'm replacing it to '%20' so that decodeURIComponent will decode it
    var ar = str.replace(/\+/g, '%20').split('=');
    return {
      key: safeDecode(ar.shift()),
      value: safeDecode(ar.join('='))
    };
  }

  function getCacheFromString(str) {
    var temp = {}, cookiesArray = str ? str.split(/;\s*/) : [], cookieKvp;

    cookiesArray.forEach(function(i) {
      cookieKvp = getKVPair(i);
      if (temp[cookieKvp.key] === undefined) {
        temp[cookieKvp.key] = cookieKvp.value;
      }
    });

    return temp;
  }

  function renewCache() {
    cookieCache = getCacheFromString(d.cookie);
    cachedDocCookie = d.cookie;
    return cookieCache;
  }

  // PUBLIC FUNCTIONS


  // method of the cookie interface, when passed a key name, will return that key's cookie value.
  // @param {string} key - string containing the name of the key you want to retrieve the value of.
  cs.get = function(key) {
    if (cachedDocCookie !== d.cookie) {
      renewCache();
    }
    return cookieCache[key] || null;
  };

  // method of the cookie interface, when passed a key name and value, will generate new cookie string, or update that key's value if it already exists.
  // @param {string} k - string containing the name of the cookie key you want to create/update.
  // @param {string} v - string containing the value you want to give the key you are creating/updating.
  // @param {object} opt - options object (optional)
  // opt.path - indicates a URL path that must exist in the requested resource before sending the Cookie header. Default - '/'
  // opt.expires - indicates when the cookie should no longer be sent to the server and therefore may be deleted by the browser. Default - 'Infinity'
  // opt.secure - secure cookie will only be sent to the server when a request is made using SSL and the HTTPS protocol. Default - false
  cs.set = function(k, v, opt) {
    opt = extendOpt(opt);
    opt.expires = getExpiresDate(v === undefined ? -1 : opt.expires);
    d.cookie = generateCookieString(k, v, opt);
    return cs;
  };

  // method of the cookie interface, when passed a key name, will remove cookie string with given key.
  // @param {string} k - string containing the name of the key you want to remove.
  cs.expire = function(k, opt) {
    return cs.set(k, undefined, opt);
  };

  // Legacy wrapper function
  cs.del = function(k, opt) {
    cs.expire(k, opt);
  };

  // method of the cookie interface, when passed a prefix will remove all keys with given prefix.
  // @param {string} pref - string containing the prefix of keys you want to remove.
  cs.expireByPrefix = function(pref) {
    var rx = new RegExp('^' + pref);
    Object.keys(cookieCache).forEach(function(k) {
      if(rx.test(pref)) {
        cs.expire(k);
      }
    });
    return cs;
  };


  return cs;

});
// Module collects user data and stores it in localStorage with __sa_data__ key
// Resets some cookies on every initialization since older browsers allow limited amount of cookies to be set.

(function(w, SA, $) {

  'use strict';

  var dKey = '__sa_data__', ref = w.document.referrer || '', cp, lStore, machineCookie;
  var timeNow = Date.now(), sessionExpiresIn = 30 * 60 * 1000;

  function updateSSID(ssId) {
    var c = ssId.split('.');
    return c[0] + '.' + (parseInt(c[1], 10) + 1);
  }

  function generateSSID() {
    var id = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
      var r = (Math.random() * 16) | 0, v = c === 'x' ? r : (r & 0x3|0x8);
      return v.toString(16);
    });
    return id + '.0';
  }

  function getSessionData(data) {
    data.sessionExpiration = data.sessionExpiration || 0;
    var isSessionExpired = data.sessionExpiration - timeNow < 0;
    if (!data.sessionExpiration || !data.sessionID || isSessionExpired) {
      if (isSessionExpired) {
        data.lastSessionId = data.sessionID;
      }
      data.sessionID = generateSSID();
    } else {
      data.sessionID = updateSSID(data.sessionID);
      if (!data.lastSessionId) {
        data.lastSessionId = data.sessionID;
      }
    }
    data.sessionExpiration = timeNow + sessionExpiresIn;
    return data;
  }

  function populate(d) {
    d.sessionReferrer = d.sessionID ? (d.sessionReferrer || '') : ref;
    return getSessionData(d);
  }

  function getData() {
    var d = {};
    // just to be safe
    SA.exec(function() {
      d = JSON.parse(lStore.get(dKey)) || JSON.parse(cp.get(dKey)) || {};
    });
    // just in case data was corrupted
    if(typeof d !== 'object') {
      d = {};
    }
    return populate(d);
  }

  function storeData(data) {
    SA.exec(function() {
      return lStore.enabled ? lStore.set(dKey, JSON.stringify(data)) : cp.set(dKey, JSON.stringify(data));
    });
  }

  function setSapuCookie() {
    var sapu = cp.get('sapu');
    if(cp.get('user_id') && !sapu) {
      if (SA.App.proPlus) {
        return cp.set('sapu', 12)
      } else if (SA.App.pro) {
        return cp.set('sapu', 212)
      } else {
        return cp.set('sapu', 101)
      }
    }
  }

  function getMachineCookie() {
    var m = cp.get('machine_cookie') || (Math.round((Date.now()) + Math.random() * 1000000003366)).toString();
    cp.set('machine_cookie', m);
    return m;
  }

  function extendConfig(data) {
    SA.pageConfig = $.extend(SA.pageConfig, data);
    SA.pageConfig = $.extend(SA.pageConfig, {
      referrer: ref,
      machineID: machineCookie
    });
  }

  function resetCookies() {
    var v;
    ['user_id', 'user_nick', 'user_remember_token', 'user_cookie_key'].forEach(function(k) {
      v = cp.get(k);
      if(v) {
        cp.set(k, v);
      }
    });
  }

  function collectData() {
    var data = getData();
    extendConfig(data);
    storeData(data);
  }

  function initialize() {
    cp = SA.Data.Cookies;
    lStore = SA.Data.Cache;
    machineCookie = getMachineCookie();

    collectData();
    setSapuCookie();

    // IE has 50 cookies per domain rule. Need every time to rewrite main cookies just not to lose them
    resetCookies();
  }

  function init() {
    SA.pageConfig = SA.pageConfig || {};
    initialize();
  }

  SA.run(init, 'sa-config');

}(window, window.SA, window.jQuery));
// Adapter for user_cookie object. All the requests to user_cookie should go here.
// Will be refactored to deliver user_cookie object and work with promises
(function(w, SA){

  'use strict';

  var s = SA.UsingNamespace('SA.Data.MonsterCookie'), mc = w.user_cookie || {};

  s.get = function(key){
    return mc[key] || null;
  };

}(window, window.SA));
// Module for delivering symbol data from Xignite service.

(function(SA, $){

  'use strict';

  var scope = SA.UsingNamespace('SA.Data.Xignite'), tokenAjax;

  // public functions

  // method to request symbol data from Xignite service. Will run jsonp callback with retrieved data passed with _callback param by query string
  // @param {string} url - url for retrieving the data.
  // @param {bool} noToken - indicates if SA token should be used
  scope.getData = function(url, noToken){
    if(noToken){
      $.ajax({
        url: url,
        dataType: 'script',
        cache: true
      });
    }
    else {
      if (!tokenAjax) tokenAjax = $.get('/market_data/xignite_token');
      tokenAjax.done(function(res){
        $.each(res, function(k,v){
          url = url + '&' + k + '=' + v;
        });
        $.ajax({
          url: url,
          dataType: 'script'
        });
      });
    }
  };

}(window.SA, window.jQuery));
(function (SA, $) {

  'use strict';

  // pre-cache some vars for short names and faster lookup

  var User = SA.UsingNamespace('SA.Data.User'), app = SA.App, d = SA.Data, cp = d.Cookies, mc = d.MonsterCookie,
    lc = d.Cache,
    id = parseInt(cp.get('user_id'), 10) || 0,
    nick = cp.get('user_nick') || ('User ' + id),
    loggedIn = !!id, userEmail;


  String.prototype.rjust = function (n, c) {
    var result = this;
    while (result.length < n) {
      result = c + result;
    }
    return result;
  };

  function extractedIdFromAuth() {
    var authKey, idAsString;
    authKey = SA.Fn.param('auth_param') || cp.get('auth_param');
    if (authKey) {
      idAsString = authKey.split(':')[0];
      return parseInt(idAsString, 32);
    }
    return null;
  }

  function getUserImageTimestamp() {
    var retUserImageTimeStamp = 0;
    var userImageTimestamp = parseInt(lc.get('user_image_timestamp'), 10) || 0;

    if (userImageTimestamp) {
      var dtTimestamp = new Date(userImageTimestamp);
      if (dtTimestamp.getTime() <= new Date().getTime()) {
        lc.del('user_image_timestamp');
      } else {
        retUserImageTimeStamp = dtTimestamp.getTime();
      }
    }
    return retUserImageTimeStamp;
  }

  function email(cb) {
    $.ajax({
      method: 'GET',
      url: SA.App.host + '/users/auth_email'
    }).always(function (res) {
      res = res || {};
      if (res.email) {
        userEmail = res.email;
      }
      cb(res.email);
    });
  }

  function getUserUri() {
    var userUri = null;
    if (User.loggedIn()) {
      var authorSlug = cp.get('author_slug');
      if (authorSlug) {
        userUri = '/author/' + authorSlug;
      } else {
        userUri = '/user/' + id;
      }
    }
    return userUri;
  }

  // Public functions

  User.id = function () {
    return id;
  };

  User.loggedIn = function () {
    return loggedIn;
  };

  User.createdAt = function () {
    return mc.get('created_at');
  };

  User.nick = function (opt) {
    opt = opt || {};
    if (loggedIn) {
      return cp.get('user_nick') || nick || opt.fallback || '';
    }
    return null;
  };

  User.hasNick = function () {
    return !!cp.get('user_nick');
  };

  User.hasProfilePicture = function () {
    return !!mc.get('has_picture');
  };

  User.perms = function () {
    return cp.get('user_perm');
  };

  User.isLimited = function () {
    return cp.get('user_limited') === '1';
  };

  //returns picture url for user by his id. type can be: small, big, medium, book, company
  User.pictureUrlFor = function (userID, type) {
    type = type || 'small';
    var stId = userID.toString().rjust(9, '0');
    var ts = Math.floor(new Date().getTime() / 600000); //10 minutes TTL
    if (userID === SA.Data.User.id()) {
      ts += getUserImageTimestamp();
    }
    return [app.assetHosts[0], 'images/users_profile', stId.substr(0, 3),
      stId.substr(3, 3), stId.substr(6, 3), (type + '_pic.png?t=' + ts)].join('/');
  };

  //returns picture url for current user. type can be: small, big, medium, book, company
  User.pictureUrl = function (type) {
    return loggedIn ? User.pictureUrlFor(id, type) : null;
  };

  User.isPro = function () {
    return !!app.pro;
  };

  User.isProPlus = function () {
    return !!app.proPlus;
  };

  User.isCommonPro = function () {
    return SA.Data.User.isPro() || SA.Data.User.isProPlus();
  };

  User.isMp = function () {
    return app.mp;
  };

  User.setHref = function (aElement, dest) {
    if (aElement) {
      // get <a> and set the right href that include user/XXXX/ or author/AUTHOR_SLUG/ before of dest
      var userUri = getUserUri();
      if (userUri) {
        aElement.href = userUri + '/' + dest;
      }
    }
  };

  User.followedUsers = function () {
    var f = mc.get('user_following_users');
    return f ? $.map(f.split(','), function (id) {
      return parseInt(id, 10);
    }) : [];
  };

  User.followedAuthors = function () {
    var w = mc.get('user_watchlist_authors');
    return (w && w.split) ? w.split(',') : [];
  };

  User.getRtaAuthorsIds = function () {
    return mc.get('user_following_authors') || [];
  };

  User.isFollowingAuthor = function (authorSlug) {
    return SA.Data.User.followedAuthors().indexOf(authorSlug) !== -1;
  };

  User.isFollowingUser = function (id) {
    return SA.Data.User.followedUsers().indexOf(id) !== -1;
  };

  User.isGettingRtaFromAuthor = function (authorTagId) {
    return SA.Data.User.getRtaAuthorsIds().indexOf(authorTagId) !== -1;
  };

  User.hasBlogPosts = function () {
    return !!mc.get('is_instablogger');
  };

  User.isPaidUser = function () {
    return SA.Data.User.isMp() || SA.Data.User.isCommonPro() || SA.Data.User.isAdFree();
  };

  User.hasPaidSubscription = function () {
    return !!mc.get('has_paid_subscription');
  };

  User.isAuthor = function () {
    return !!this.authorSlug();
  };

  User.isMPAuthor = function () {
    return !!mc.get('is_marketplace_author') || !!mc.get('is_contributing_author') || !!mc.get('is_promoting_author');
  };

  User.MPModeratorForAuthorId = function () {
    return mc.get('moderator_for_author_id');
  };

  User.MPModeratorForService = function () {
    return mc.get('moderator_service_name');
  };

  User.profileLink = function () {
    if (loggedIn) {
      var s = this.authorSlug();
      return s ? '/author/' + s : '/user/' + id + '/profile';
    }
    return null;
  };

  User.authorResearch = function () {
    var s = mc.get('author_research_subscriptions');
    return s ? s.split(',') : [];
  };

  User.mpAuthors = function () {
    var authors = mc.get('mp_author_names_slugs');
    return authors ? JSON.parse(authors) : {};
  };

  User.isMarketplaceGuestUser = function (aSlug) {
    var s = mc.get('marketplace_guest_slugs');
    s = s ? s.split(',') : [];
    return s.indexOf(aSlug) !== -1;
  };

  User.isMarketplaceAdmin = function () {
    return !!mc.get('is_marketplace_admin');
  };

  User.authorSlug = function () {
    return mc.get('user_author_slug');
  };

  User.shouldSeeAuthorResearch = function (aSlug) {
    return User.authorSlug() === aSlug || User.authorResearch().indexOf(aSlug) !== -1 || User.isMarketplaceAdmin();
  };

  User.isInactivePartOfBundle = function (author_slug) {

    return User.inactiveBundleResearches().indexOf(author_slug) > -1;
  };

  User.hasInactiveBundleResearch = function () {
    return User.inactiveBundleResearches().length > 0;
  };

  User.inactiveBundleResearches = function () {
    var s = mc.get('researches_availiable_for_select_in_bundle');
    return s ? s.split(',') : [];
  };

  User.hasAuthorResearch = function () {
    return this.authorResearch().length > 0;
  };

  User.shouldUpdatePosition = function (authorSlug) {
    return User.authorSlug() === authorSlug || mc.get('is_positions_admin');
  };

  User.hasContributorDetails = function () {
    return !!mc.get('has_contributor_details');
  };

  User.getRTASymbolsOnMC = function () {
    var m = mc.get('rta_market_currents');
    return m ? m.split(',') : [];
  };

  User.getRTASymbolsOnArticles = function () {
    var s = mc.get('rta_articles');
    return s ? s.split(',') : [];
  };

  User.getNewsletterSubscriptions = function () {
    var s = mc.get('user_non_watchlist_slugs');
    return s ? s.split(',') : [];
  };

  User.getRTASymbols = function () {
    return $.unique(this.getRTASymbolsOnMC().concat(this.getRTASymbolsOnArticles()));
  };

  User.countRTASymbols = function () {
    return this.getRTASymbols().length;
  };

  User.hasPortfolio = function () {
    return !$.isEmptyObject(mc.get('user_portfolios'));
  };

  User.getPortfolios = function () {
    return mc.get('user_portfolios') || [];
  };

  User.getAddedModelPortfoliosIds = function () {
    return mc.get('added_model_portfolios_ids') || [];
  };

  User.getPortfolioTickers = function () {
    return mc.get('user_watchlist_slugs') || '';
  };

  User.hasTicker = function (slug) {
    return User.portfolioTickers().indexOf(slug) > -1;
  };

  User.portfolioTickers = function () {
    return this.getPortfolioTickers().trim().split(',');
  };

  User.isSATeam = function () {
    return !!mc.get('sa_team');
  };

  User.portfolioCount = function () {
    var portfolios = mc.get('user_portfolios');
    return portfolios ? portfolios.length : 0;
  };

  User.isAdFree = function () {
    return !!mc.get('ad_free_user');
  };

  User.adblockScore = function () {
    return mc.get('adblock_score');
  };

  User.inBetaGroup = function () {
    return !!mc.get('in_beta_group');
  };

  User.getIdFromAuthParam = function () {
    return extractedIdFromAuth();
  };

  User.saEmail = function (cb) {
    return userEmail ? cb(userEmail) : email(cb);
  };

  User.passedModeration = function () {
    return mc.get('passed_moderation');
  };

  User.everPremium = function () {
    return !!SA.Data.Cookies.get('ever_pro');
  };

  User.isSubscribedToAuthorResearch = function (authorSlug) {
    var authorResearchSubscriptionsStr = mc.get('author_research_subscriptions'),
      authorsSlugs = authorResearchSubscriptionsStr ? authorResearchSubscriptionsStr.split(',') : [];

    return ($.inArray((authorSlug || ''), authorsSlugs) > -1);
  };

  User.mutedUsers = function () {
    var m = mc.get('muted_users');
    return m ? $.map(m.split(','), function (id) {
        return parseInt(id, 10);
      })
      : [];
  };

  User.isFp = function () {
    return mc.get('is_fp');
  };

  User.isPremiumFreeTrialEligible = function () {
    return !window.user_cookie ||
      (!Object.keys(window.user_cookie).length ||
        !('is_premium_free_trial_eligible' in window.user_cookie) ||
        window.user_cookie.is_premium_free_trial_eligible);
  };

  User.isNewEssentialTour = function() {
    var endOfFreeTrial = mc.get('premium_trial_ends'),
      nowTs = new Date().getTime();
    return nowTs < endOfFreeTrial;
  };

  User.isShowLauncher = function() {
    return mc.get('is_product_launcher');
  };

  User.introductionTours = function () {
    var tours = mc.get('introduction_tours');
    if (tours) {
      var userTours = JSON.parse(tours);
      return Object.keys(userTours).reduce(function (obj, key) {
        obj[userTours[key]] = key;
        return obj;
      }, {});
    }
    return {};
  };

}(window.SA, window.jQuery));
(function (SA, $) {
  var lStore = SA.Data.Cache,
    storageUtcOffset = lStore.get('utc_offset'),
    currentOffset = new Date().getTimezoneOffset() / (-60);

  if ((!isNaN(currentOffset) && SA.Data.User.loggedIn()) && (!storageUtcOffset || storageUtcOffset != currentOffset)) {
    $.post('/users/save_user_offset', { utc_offset: currentOffset }, function (res) {
      if (res.status === 'success') {
        lStore.set('utc_offset', currentOffset);
      }
    });
  }
}(window.SA, window.jQuery));
// module for detection various browser features

(function(w, SA, $){

  'use strict';

  var scope = SA.UsingNamespace('SA.Utils.Detect'),
      // cache addBlock detection
      adBlockDetected, touchDetected = null;

  function createAd() {
    var ad = $('<div></div>').attr('id', 'ad_unit').css({'position': 'absolute', 'left': '-9999px', 'height': '5px', 'width': '5px', 'visibility': 'visible', 'display': 'block', 'opacity': '1'});
    $('body').append(ad);
    return ad;
  }

  // public functions

  // method to detect if AdBlock enabled on the page
  scope.adBlock = function() {
    var $ad;
    if(!adBlockDetected) {
      $ad = createAd();
      adBlockDetected = !$ad.is(':visible') || $ad.css('position') !== 'absolute' || $ad.css('left') !== '-9999px' || $ad.css('height') !== '5px' || $ad.css('width') !== '5px' || $ad.css('display') !== 'block' || $ad.css('opacity') !== '1';
      $ad.remove();
    }
    return adBlockDetected;
  };

  // method to detect if browser has support of SVG
  scope.svg = function() {
    var $d = $('<div>'), $c;
    $d.append('<svg>');
    $c = $d.children();
    return ((w.SVGRect && $c.length && $c.get(0).namespaceURI) === 'http://www.w3.org/2000/svg');
  };

  // method to detect if running on touch screen
  scope.touch = function() {
    if(touchDetected === null) {
      try{
        var hasTouchStart = window.hasOwnProperty('ontouchstart'),
            hasPosMaxTouchPoints = (!!navigator &&
            ((navigator.hasOwnProperty('maxTouchPoints') &&
            navigator.maxTouchPoints > 0) ||
            (navigator.hasOwnProperty('msMaxTouchPoints') &&
            navigator.msMaxTouchPoints > 0))),
            isTouchDocument = !!(window.hasOwnProperty('DocumentTouch') && document instanceof DocumentTouch);

        touchDetected = (hasTouchStart || hasPosMaxTouchPoints || isTouchDocument);
      } catch(ignore){
        touchDetected = false;
      }
    }
    return touchDetected;
  };

}(window, window.SA, window.jQuery));
(function (SA) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Utils.Validate');

  function isExternalUrlAllowed(url) {
    var allowedExternalUrls = scope.getAllowedExternalUrls();
    for (var i = 0, len = allowedExternalUrls.length; i < len; i++) {
      var domain_name = allowedExternalUrls[i],
        regex = new RegExp(domain_name),
        isAllowed = regex.test(url);

      if (isAllowed) {
        return true;
      }
    }
    return false;
  }

  scope.getAllowedExternalUrls = function (){
    return ['youtube', 'facebook', 'twitter', 'vimeo', 'linkedin', 'docs.google'].map(function (name) {
      return name + '.com';
    });
  };

  scope.isNumeric = function (val) {
    return (/^[0-9]+$/).test(val);
  };

  scope.between = function (val, min, max) {
    var len = val.length;
    return (len >= min && len <= max);
  };

  scope.email = function (val) {
    return (/^\w[\w#$\%^&*'\/=?_`{|}~+-]*(\.[\w#$\%^&*'\/=?_`{|}~+-]+)*@(\w[\w-]*\.)+[a-z]{2,63}$/i).test(val);
  };

  scope.password = function (val) {
    return val && val.length >= 4 && val.length <= 40;
  };

  scope.phone = function (val) {
    return ((/^\(?[0-9]{3}(\-|\)) ?[0-9]{3}-[0-9]{4}$/).test(val));
  };

  scope.fullName = function (field) {
    return (/^[a-z\-\.\s]+$/i).test(field.val().trim());
  };

  scope.isUserNick = function(nick) {
    return nick.indexOf('@') < 0;
  };

  scope.required = function (field) {
    var value = field.val().trim();
    if ((field.type === 'checkbox') || (field.type === 'radio')) {
      return field.prop('checked');
    }
    return (value !== null && value !== '');
  };

  scope.htmlRequired = function (field) {
    var value = field.html().trim();
    return (value !== null && value !== '');
  };

  scope.isUrl = function (url) {
    return (/((?:https?:\/\/)?[a-z0-9]+(?:[-.]{1}[a-z0-9]+)*\.[a-z]{2,5}(?:(?:[0-9]{1,5})?\/.*)?)/gi).test(url.trim());
  };

  scope.isSpecificWebUrl = function (url, webName) {
    return scope.isUrl(url.trim()) && url.indexOf(webName) !== -1;
  };

  scope.isInternalUrl = function(url){
    return url.charAt(0) === '/' || /^https?:\/\/(\w+\.)?seekingalpha.com([\/?#]|$)/gi.test(url);
  };

  scope.isExternalLink = function(href, allowFromWhiteList){
    var isExternal = scope.isUrl(href) && !scope.isInternalUrl(href);
    if (isExternal) {
      return allowFromWhiteList ? !isExternalUrlAllowed(href) : true;
    }
    return false;
  };

  scope.containsExternalLinks = function($el, allowFromWhiteList){
    var links= $el.find('a').not('[rel="lightbox"]');
    for (var i = 0, len = links.length; i < len; i++) {
      if (scope.isExternalLink(links[i].href, allowFromWhiteList)) {
        return true;
      }
    }
    return scope.containsLinkString($el.clone());
  };

  scope.containsLinkString = function($clone){
    $clone.find('a,figure,img').remove();
    var html = $clone.html();
    var urlStrings = [
      /http:\/\/(?!seekingalpha)/,
      /https:\/\/(?!seekingalpha)/,
      /www.(?!seekingalpha)/];
    for(var i=0; i<urlStrings.length;i++){
      if (new RegExp(urlStrings[i]).test(html)){
        return true;
      }
    }
    return false;
  };

  scope.containMinimumWords = function(obj, minWords){
    var wordCount = obj.replace(/<p\s*\/?>/gi, ' ').replace(/<\/p>/gm, '').replace(/<br\s*\/?>/gi, ' ').trim().split(/\s+/).length;
    return wordCount >= minWords;
  };

}(window.SA));


//jQuery implementation of pub-sub observer pattern
// for more info https://github.com/shichuan/javascript-patterns/blob/master/jquery-patterns/pubsub-custom-events.html

(function(SA, $){

  'use strict';

  var s = SA.UsingNamespace('SA.Utils.Observer'), $ch = $({});

  s.subscribe = function(ch, callback) {
    $ch.on(ch, callback);
  };

  s.unsubscribe = function(ch) {
    $ch.off(ch);
  };

  s.publish = function(ch, data) {
    $ch.trigger(ch, [data]);
  };

}(window.SA, window.jQuery));

// Module to retrieve sasource.
// sasource - custom param stored in cookies or passed with query param to track from which page/link/even user got to current page
// sasource lookup priority = cookies(_sasource) || query param(source) || ''
// sasource can be also set using custom html attribute. Ex: <a href="http..." sasoure="header-tab">Click Me</a>. In this case, if user clicks the link, next page's sasource will be set to header-tab
// After SA source retrieved, it is stored in private variable saSource, _sasource cookie expired and source param removed using history.replaceState

(function(SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Utils.SASource'),
    cp = SA.Data.Cookies,
    notAllowAttributes = ['source', 'user_email', 'go', 'new_email', 'email', 'email_id', 'pu', 'bill_period', 'dt', 'update_payment_method_succ', 'update_address_succ', 'restore_sub_succ', 'aconf'],
    safeUrl;

  // enable refresh on model portfolio to keep the content
  if (((SA.pageConfig || {}).Data || {}).isModelPortfolio) {
    notAllowAttributes.splice(notAllowAttributes.indexOf('pu'), 1);
  }

  function replaceUnsafeParam(search, param) {
    return search.replace(new RegExp('([?&])' + param + '=([^&]+)(&)?', 'i'), function(found, sep1, value, sep2){
      return sep2 ? sep1 : '';
    });
  }

  // clean push state from unwanted values
  function filterSearch(s) {
    safeUrl = location.pathname + s + (SA.pageConfig.saSource ? (s ? '&' : '?') + 'source=' + encodeURIComponent(SA.pageConfig.saSource) : '');

    if (s !== location.search && window.history && history.replaceState){
      history.replaceState(null, '', location.pathname + s + location.hash);
    }
  }

  function replaceQueryString() {
    var search = location.search;
    if(search) {
      notAllowAttributes.forEach(function(name) {
        search = replaceUnsafeParam(search, name);
      });
    }
    filterSearch(search);
  }

  function unifiedPath(){
    var path = location.pathname;
    //replace known letters dynamic rules
    var m = path.match(/^\/(author|user|symbol)\/(?:[^\/]+\/([^\/]+))?/);
    if (m){
      path = m[2] ? '/' + m[1] + '/*/' + m[2] : '/' + m[1];
    }

    //replace any numeric path
    return path.replace(/\/\d[^\/]*/g,'/*').replace(/\/\*$/,'');
  }

  function initSourceListeners() {
    $(document).on('click', 'a', function() {
      var $link = $(this), s = $link.attr('sasource') || '', href = this.href;
      var m = href.match(/^https?:\/\/([^\/]+)/), domain = m ? m[1] : null;
      var f = SA.App.userEchoHost.match(/^https?:\/\/([^\/]+)/), feedbackDomain = f ? f[1] : null;
      if (domain && (!domain.match(/seekingalpha.com/) || domain.match(feedbackDomain))) {
        SA.Logger.Mone.event('external_content', 'link', 'click', {
          data: {
            url: href,
            partner_link: true
          }
        });
      } else if (s) {
        cp.set('_sasource', s, {expires: 60}); // 1 minute - will be cleaned by next init
      }
    });
  }

  function init() {
    SA.pageConfig = SA.pageConfig || {};

    // finding saSource from cookies and url params
    // keep saSource in pageConfig as only true value
    SA.pageConfig.saSource = SA.pageConfig.saSource || cp.get('_sasource') || SA.Fn.param('source') || '';

    // Keep approved confirmation event for later usage
    SA.pageConfig.aconf = SA.Fn.param('aconf');

    cp.expire('_sasource');

    initSourceListeners();
    replaceQueryString();
  }

  SA.run(init, 'saSource-init');

  // Public methods
  scope.setReferrer = function(ref){
    if(SA.Data.Cache.enabled) {
      sessionStorage.setItem('_referrer', ref);
    }
  };

  // Legacy variable storing document referrer
  scope.referrer = function(ajaxReferrer){
    ajaxReferrer = ajaxReferrer || false;
    var ref;
    if(document.referrer === '' && !ajaxReferrer){
      ref = '';
    }else{
      ref = SA.Data.Cache.enabled ? sessionStorage.getItem('_referrer') || document.referrer || '' : document.referrer || '';
    }
    if(SA.Data.Cache.enabled) {
      sessionStorage.removeItem('_referrer');
    }
    return ref;
  };

  // Retrieve saSource
  scope.get = function() {
    return SA.pageConfig.saSource;
  };

  // Replace current saSource. Used for ajax pages
  scope.set = function(val) {
    SA.pageConfig.saSource = val || null;
  };

  // Indicates that user got to the page not by manual action (link click or redirect), but page was refreshed automatically after some idle time
  scope.isAutoRefreshed = function() {
    return SA.pageConfig.saSource === 'refreshed';
  };

  scope.safeUrl = function() {
    return safeUrl;
  };


}(window.SA, window.jQuery));

(function(w, SA){

  'use strict';

  var scope = SA.UsingNamespace('SA.Utils.Env'),
      ua = w.navigator.userAgent || '';

  function match(regex, ua) {
    return regex.test(ua);
  }

  function getFirstMatch(regex) {
    var m = ua.match(regex);
    return (m && m.length > 1 && m[1]) || '';
  }

  // Mobile Devices

  scope.isApplePhone = function(){
    return match(/iPhone/i, ua) || match(/iPod/i, ua);
  };

  scope.isAppleIpad = function(){
    return match(/iPad/i, ua);
  };

  scope.isAppleDevice = function() {
    return this.isApplePhone() || this.isAppleIpad();
  };

  scope.isAndroidDevice = function(){
    return match(/(?=.*\bAndroid\b)(?=.*\bMobile\b)/i, ua) || match(/Android/i, ua);
  };

  scope.isAndroidPhone = function(){
    return match(/(?=.*\bAndroid\b)(?=.*\bMobile\b)/i, ua);
  };

  scope.isAndroidTablet = function(){
    return match(/Android/i, ua);
  };

  scope.isWindowsDevice = function(){
    return match(/IEMobile/i, ua) || match(/(?=.*\bWindows\b)(?=.*\bARM\b)/i, ua);
  };

  scope.isOtherDevice = function(){
    return match(/BlackBerry/i, ua) || match(/BB10/i, ua) || match(/Opera Mini/i, ua) || match(/(?=.*\bFirefox\b)(?=.*\bMobile\b)/i, ua);
  };

  scope.isMobile = function(){
    return this.isApplePhone() || this.isAndroidPhone() || this.isWindowsDevice() || this.isOtherDevice();
  };

  // Browsers

  scope.isIE = function() {
    return (/msie|trident/i).test(ua);
  };

  scope.IEver = function(){
    return this.isIE() ? parseInt(getFirstMatch(/(?:msie |rv:)(\d+(\.\d+)?)/i), 10) : 0;
  };

  scope.isFirefox = function(){
    return (/firefox|iceweasel/i).test(ua);
  };

  scope.isOpera = function(){
    return (/opera|opr/i).test(ua);
  };

  scope.isEdge = function() {
    return (/Edge/i).test(ua);
  };

  scope.isChrome = function() {
    return (/chrome|crios|crmo/i).test(ua) && !this.isOpera() && !this.isEdge();
  };

  scope.isSafari = function(){
    return ((/safari/i).test(ua) && !this.isChrome() && !this.isEdge()) && !(/PhantomJS/i).test(ua);
  };

}(window, window.SA));

// SA internal pageView/event tracker
// Sends Data using Ajax calls

// pageView is sent as ;;; separated string and has following structure:
//   version ;;; referrer ;;; event_name ;;; location_path;;; href_params ;;; machine_cookie  ;;; session_cookie ;;;
//   (user_id;;;user_nick;;;{used to be user email, but now it's just empty string};;;u_voc;;;author_slug;;;user_mywebsite_url;;;gigya_notified_login;;;user_gigya_settings;;;
//   user_watchlist_slugs;;;user_non_watchlist_slugs;;;user_watchlist_authors;;;user_following_users;;;{symbols};;;{sectors};;;{themes};;;{authors}
//   ;;; other

// pageView automatically sent on every page

//NOTE!
//In this version all the ex Mone extra data must be stored under SA.App.moneData instead of Mone object

SA.define('SA.Logger.Mone', [], function() {

  'use strict';

  var scope = {};

  var isPreview = (SA.App.isCms || SA.App.isSharkPreview), config = SA.pageConfig || {},
      ls = SA.Data.Cache, cs = SA.Data.Cookies, mc = SA.Data.MonsterCookie;

  var KEY, PAGE_DATA_VER = 1, VERSION = 2, prevPageData, lastPageUrl;

  scope.Types = {
    REGULAR: 'regular',
    MOBILE: 'mobile',
    IPHONE: 'iphone'
  };

  var notWanted = /^__|^(user_(?:cookie_key|perm|remember_token|id|nick|email|mywebsite_url|gigya_settings|notifications)|author_slug|machine_cookie|gigya_(?:notified_login|post_object)|u_voc|last_comment_date|last_comment|mc_ids|portfolio_popuped|login_popuped|first_page)=/;

  var SOURCES = {
    msn: ['messages.finance.yahoo.com'],
    yahoo: ['messages.finance.yahoo.com'],
    nasdaq: ['www.wallstreet-online.de'],
    motleyfool: ['messages.finance.yahoo.com', 'boards.fool.com'],
    etrade: ['messages.finance.yahoo.com'],
    reuters: [],
    cnbc: [],
    thestreet: ['stockpickr.com'],
    bloomberg: [],
    themarkets: [],
    intbrokers_pro: [],
    marketwatch: []
  };

  var sourceDomains = ['google.com', 'yahoo.com', 'bing.com', 'aol.com', 'msn.com', 'ask.com', 'baidu.com'],
      noSourceDomains = ['news.google.com', 'google.com/finance'];

  function quickURLHash(url, bytes) {
    var res = 0, hashIndex = url.indexOf('#'), i = 0, len;
    bytes = bytes || 2;
    if (hashIndex !== -1) {
      url = url.substr(0, hashIndex);
    }

    len = url.length;
    for (i; i < len; i += 1) {
      res^=url.charCodeAt(i)<<((i%bytes)*8);
    }

    return res;
  }

  function getKeysData() {
    var d = null;
    SA.exec(function() {
      d = JSON.parse(ls.get('mone_keys'));
    }, 'mone_keys');
    return d;
  }

  function saveKeysData(keys) {
    SA.exec(function() {
      ls.set('mone_keys', JSON.stringify({
        ver: PAGE_DATA_VER,
        keys: keys
      }));
    });
  }

  function getPrevPageData(referrer) {
    var keys = {}, since = new Date().getTime() / 1000 -24 * 3600, deleted = 0, data = getKeysData();

    if(data && data.ver === PAGE_DATA_VER) {
      keys = data.keys;
    } else {
      data = null;
    }

    //clean old
    $.each(keys, function(i) {
      if(keys[i].at < since){
        delete keys[i];
        deleted += 1;
      }
    });

    if(!data || deleted > 0) {
      saveKeysData(keys);
    }

    return keys[quickURLHash(referrer)];
  }

  function addPageData(url, pageKey) {
    var keys = {}, data = getKeysData(), key, keyUrl;

    if(data && data.ver === PAGE_DATA_VER) {
      keys = data.keys;
    }

    lastPageUrl = location.protocol + '//' + location.host + url
    key = {
      at: new Date().getTime() / 1000,
      url: lastPageUrl,
      key: pageKey
    };

    keys[quickURLHash(lastPageUrl)] = key;

    saveKeysData(keys);
    SA.Utils.SASource.setReferrer(lastPageUrl);
  }

  function getRef(ajaxReferrer) {
    var ref = SA.Utils.SASource.referrer(ajaxReferrer),
        emailSession = cs.get('email_session');
    if(emailSession && (!ref || !/seekingalpha\.com/.test(ref))) {
      ref = SA.App.emailHost + '/?type=click&emailid=' + emailSession;
    }
    return ref;
  }

  function addParam(str, params) {
    str += (str ? '&' : '?') + params;
    return str;
  }

  function addSource(source, params) {
    if (source && !/[?&]source=[^&]/.test(params)) {
      params = addParam(params, 'source=' + source);
    }
    return params;
  }

  function addOrganic(ref, params) {
    // try to get google organic param
    var g = cs.get('__utmz');
    if(g && /organic/.test(g) && /google/.test(g) && (ref === '' || (ref !== null && /google/.test(ref)))){
      params = addParam(params, 'google_organic=1');
    }
    return params;
  }

  function daysToMs(days) {
    return 24 * 60 * 60 * 1000 * days;
  }

  function extendParams(ref, source, data) {
    data.params = addSource(source, data.params);
    data.params = addOrganic(ref, data.params);
    var moneData = SA.App.moneData || {};
    if (moneData.params){
      data.params = addParam(data.params, moneData.params);
    }
    return data;
  }

  function getUrlData(ref, source, overrideUrl) {
    var moneData = SA.App.moneData || {};
    var url = overrideUrl || moneData.url || SA.Utils.SASource.safeUrl() || '';
    url = url.match(/^(?:https?:\/\/[^\/?#]+)?(\/[^?#]*)(\?[^#]*)?/);
    if (url){
      url = {path: url[1], params: url[2] || ''};
    } else {
      url = {path: location.pathname, params: location.search};
    }

    return extendParams(ref, source, url);
  }

  function getSourceMatch(source) {
    var m = null;
    if(source) {
      m = source.toLowerCase().match(/^[a-z]+/);
      if(m) {
        m = m[0];
      }
    }
    return m;
  }

  function dUrl(sMatch, ref) {
    var d = false;
    $.each(SOURCES[sMatch], function(i, denUrl) {
      if(new RegExp('^https?:\/\/' + denUrl, 'i').test(ref.toLowerCase())) {
        d = true;
      }
    });
    return d;
  }

  function sMatchRegexp(ref, key, t) {
    var matched = ref.toLowerCase().match(new RegExp('(' + noSourceDomains.join('|').replace(/\./g,'\\.').replace('/','\\/') + ')'));
    var sMatched = ref.toLowerCase().match(new RegExp('(' + sourceDomains.join('|').replace(/\./g,'\\.') + ')'));
    if(matched) {
      ls.set(key, 'google.com', t);
    } else if(sMatched) {
      ls.set(key, 'search|' + sMatched[0], t);
    } else if(ref === '') {
      ls.set(key, 'direct', t);
    } else {
      ls.set(key, 'other', t);
    }
  }

  function setPartnerData(source, ref) {
    var key = 'n_ref_partner', nRefPartner = ls.get(key, true),
        sourceMatch = getSourceMatch(), deniedUrl = false, t = daysToMs(30);

    if (source && sourceMatch && SOURCES[sourceMatch] && !nRefPartner) {
      deniedUrl = dUrl(sourceMatch, ref);
      ls.set(key, deniedUrl ? 'other' : source.toLowerCase().match(/^[a-z]+/)[0], t);
    } else if (nRefPartner){
      ls.set(key, nRefPartner, t);
    } else {
      sMatchRegexp(ref, key, t);
    }
  }

  function readDocumentCookies() {
    var g = cs.get;
    //empty string for user email
    return [g('user_id'), g('user_nick'), '', g('u_voc'), g('author_slug'), g('user_mywebsite_url'), g('gigya_notified_login'), g('user_gigya_settings')].join(';;;');
  }

  function b(val) {
    return '{' + (mc.get(val) || '') + '}';
  }

  function readUserCookie() {
    return [b('user_watchlist_slugs'), b('user_non_watchlist_slugs'), b('user_watchlist_authors'), b('user_following_users')].join(';;;');
  }

  function addCustomVars(rc) {
    var screenX = 0;

    rc.push('load_time='+(new Date().getTime() - (SA.App.initTime || 0)));

    if(mc.get('stocktalker')) {
      rc.push('stocktalker=1');
    }

    SA.exec(function() {
      screenX = window.screen.availWidth;
    });

    rc.push('screenx=' + screenX);

    if(SA.AdsConf) {
      rc.push('us_geo=' + SA.AdsConf.isUSA);
    }

    if(SA.pageConfig && SA.pageConfig.Data && SA.pageConfig.Data.newSymbolLayout) {
      rc.push('new_qp=' + (SA.pageConfig.Data.newSymbolLayout == 1 ? 'test' : 'control'));
    }

    if (!SA.Data.Cache.get('h_px')){
      rc.push('p=bot');
    }

    return rc;
  }

  function readOtherCookies() {
    var ca = document.cookie.split(/\s*;\s*/), rc = [], i = 0, len = ca.length;
    if(SA.Data.User.loggedIn()) {
      rc.push('rsc=' + SA.Data.User.countRTASymbols());
    }

    rc.push('pro_status=' + (mc.get('user_pro_status') || 0));
    for(i; i < len; i += 1) {
      if(!/\n|;;;/.test(unescape(ca[i])) && !notWanted.test(ca[i])) {
        rc.push(ca[i]);
      }
    }

    rc = addCustomVars(rc);

    return unescape(rc.join('; '));
  }

  function getPvData(url, pageReferrer) {
    var tagData = '', d = [];
    d.push(VERSION);
    d.push(SA.App.type || 'regular');
    d.push(SA.pk.get());
    d.push((prevPageData && prevPageData.key) || '');
    d.push((prevPageData && prevPageData.url) || pageReferrer);
    d.push(url.path);
    d.push(url.params);
    d.push(config.machineID);
    d.push(config.sessionID);
    d.push(readDocumentCookies());
    d.push(readUserCookie());
    d.push(tagData);
    d.push(readOtherCookies());
    return escape(d.join(';;;'));
  }

  function touch(opt) {
    opt = opt || {};

    // allows to pass custom source with options
    opt.saSource = opt.hasOwnProperty('saSource') ? opt.saSource : SA.Utils.SASource.get();
    opt.ajaxReferrer = opt.hasOwnProperty('ajaxReferrer') ? opt.ajaxReferrer : false;
    var pageReferrer = opt.referrer || getRef(opt.ajaxReferrer);
    var url = getUrlData(pageReferrer, opt.saSource, opt.url);

    if (pageReferrer) {
      prevPageData = getPrevPageData(pageReferrer);
    }

    addPageData(url.path + url.params, SA.pk.get());
    setPartnerData(opt.saSource, pageReferrer);
    // Collect event data
    $.post('/mone', 'mone=' + getPvData(url, pageReferrer));

  }

  function event(type, source, action, opt) {
    //possibility to only send action
    if (action){
      type = type || '';
      source = source || '';
    } else if (source){
      action = source;
      source = type || '';
      type = '';
    } else if (type){
      action = type;
      type = source = '';
    } else {
      return false;
    }

    var params = {version: VERSION, key: opt.moneKey || SA.pk.get(), type: type, source: source, action: action};

    if (opt.data) {
      params.data = JSON.stringify(opt.data);
    }

    return $.post('/mone_event', params);
  }

  function init() {
    if(!isPreview && !SA.App.cancelPV){
      touch();
    }
  }

  SA.run(init, 'sa-mone');

  //PUBLIC METHODS

  // retrieves PV data, that was sent on previous page. Stored in localStorage
  scope.getPrevPageData = function() {
    return prevPageData || {};
  };

  // sends custom event
  // @param {string} type - event type. Can be anything, but in most cases provided by BI. (optional)
  // @param {string} source - event source. (optional)
  // @param {string} action - type of interaction triggered the event.
  // @param {object} opt - options object (optional)
  // opt.data - object with custom data to be sent with event
  // returns jQuery ajax promise, so can be chained with done/then/when/fail handlers
  // Usage:
  //   SA.Logger.Mone.event('adblock', 'article_page', 'render', {data: {
  //     user: SA.Data.User.id
  //   }}).done(function() {
  //     window.location.href = '/';
  //   })
  scope.event = function(type, source, action, opt){
    if(isPreview){
      return false;
    }
    opt = opt || {};

    return event(type, source, action, opt);
  };

  // manually trigger page view event with original page key.
  // @param {object} opt - options object (optional)
  // opt.saSource - option to override page's sasource collected by SaSource module. May be useful when sending additional PV event on ajax generated page
  // opt.url - String, should be without host - overrides current url.
  scope.touch = function(opt) {
    touch(opt);
  };

  // manually trigger page view event with new page key
  // @param {object} opt - options object (optional)
  // opt.saSource - option to override page's sasource collected by SaSource module. May be useful when sending additional PV event on ajax generated page
  // opt.url - String, should be without host - overrides current url. Otherwise takes current url from window.location
  scope.pv = function(opt) {
    SA.pk.generate();
    opt = opt || {};
    // This is needed to override initial page url with current url, that might have been changed with pushState/replaceState
    opt.url = opt.url || (location.pathname + location.search);
    opt.saSource = opt.saSource || null;
    touch(opt);
  };

  return scope;
});
// Module responsible for tracking user interactions on the page and detecting when user become idle.

(function(SA, $){

  'use strict';

  // instance of this class tracks idle time of any element with list of events provided. Also responsible for execution 'back-ti-active' callbacks
  var IdleTimeTracker = function(opt) {

    opt = opt || {};
    opt.element = opt.element || $(window);
    opt.interruptEvents = opt.interruptEvents || 'mousemove mousedown keypress touchstart';

    var timerTime = new Date(), activeCallbacks = $.Callbacks();

    function onActive() {
      timerTime = new Date();
      activeCallbacks.fire();
    }

    function init () {
      opt.element.bindWithDelay(opt.interruptEvents, function(){
        onActive();
      }, 500, true);
    }

    this.getIdleTime = function() {
      return new Date() - timerTime;
    };

    this.addActiveCallback = function(callback){
      if($.isFunction(callback)){
        activeCallbacks.add(callback);
      }
    };

    SA.run(init, 'idle-time-track');

  };

  var documentIdleTracker = new IdleTimeTracker(), scope = SA.UsingNamespace('SA.Utils');
  scope.IdleTracker = documentIdleTracker;

  // Instance of this class responsible for tracking separate idle events with different idle time-outs and custom elements
  // @param {object} opt - configuration options
  // opt.idleTime - amount of time in ms. after which user treated as idle in case there were no interactions(click, scroll...) during interval provided. Default - 5min
  // opt.interruptEvents - space separated string of browser events that can interrupt idle state. Default: 'mousemove mousedown keypress touchstart'
  // opt.element - this option dives the way to track users interactions with specific dom element. Default: document
  scope.IdleNotifier = function(opt) {

    if (!(this instanceof scope.IdleNotifier)) {
      return new scope.IdleNotifier(opt);
    }

    opt = opt || {};
    opt.idleTime = opt.idleTime || 300 * 1000;
    opt.interruptEvents = opt.interruptEvents || '';

    var  idleTracker = opt.element ? new IdleTimeTracker({interruptEvents: opt.interruptEvents, element: opt.element}) : documentIdleTracker,
         isIdle = true, idleCallbacks = $.Callbacks(), activeCallbacks = $.Callbacks(), timeout;

    function onIdle(){
      if (idleTracker.getIdleTime() >= opt.idleTime) {
        isIdle = true;
        idleCallbacks.fire();
      }
    }

    function setIdleTimer() {
      clearTimeout(timeout);
      timeout = setTimeout(onIdle, opt.idleTime);
    }

    function onActive() {
      if (isIdle){
        isIdle = false;
        activeCallbacks.fire();
      }
      setIdleTimer();
    }

    function init() {
      setIdleTimer();
      idleTracker.addActiveCallback(onActive);
    }

    // get amount of time in ms user been idle
    this.getIdleTime = function() {
      return idleTracker.getIdleTime();
    };

    // check if user currently active
    this.isActive = function() {
      return !isIdle;
    };

    // check if user currently idle
    this.isIdle = function() {
      return isIdle;
    };

    // ads callback which been executed when user transferee from idle to active state after triggering one of interruptEvents
    // @param {function} callback - function to execute on state change
    this.addActiveCallback = function(callback) {
      if($.isFunction(callback)){
        activeCallbacks.add(callback);
      }
    };

    // ads callback which been executed when user transferee from active to idle state after not triggering any of interruptEvents for idleTime period
    // @param {function} callback - function to execute on state change
    this.addIdleCallback = function(callback){
      if($.isFunction(callback)){
        idleCallbacks.add(callback);
      }
    };

    SA.run(init, 'idle-notifier-init');

  };

}(window.SA, window.jQuery));

// module responsible for refreshing the page every n minutes.
// disabled by default - to enable must set @call_refresher in controller action. Also custom redirect page can be set.
// Sets sasource to refreshed if user had no interactions within refresh interval.
// Sets sasource to nr if user had interactions within refresh interval.
// If internet connection was lost - will prevent page from refresh until reestablish connection or interrupted by user action
(function(w, SA){

  'use strict';

  var scope = SA.UsingNamespace('SA.Utils.PageRefresher'),
      config = (SA.pageConfig || {}).Refresher || {},
      interval = config.interval * 1000,
      idleNotifier = null,
      wasIdleWholeTime = true,
      passedInterval = false,
      retryTimeout = null;


  function testConnection(cb) {
    var img = w.document.createElement('img');
    img.onload = cb;
    img.src = SA.App.assetHost + '/images/empty.gif?r' + (Math.round(100000 * Math.random())+ '=' + Date.now());
  }

  function performRefresh() {
    w.location.href = config.url || w.location.href;
  }

  function connectAndRefresh(){
    if(idleNotifier.isIdle() && passedInterval && config.active) {
      testConnection(function () {
        SA.Data.Cookies.set('_sasource', wasIdleWholeTime ? 'refreshed' : 'nr');
        performRefresh();
      });
      retryTimeout = setTimeout(connectAndRefresh, 60 * 1000);
    }
  }

  function activeCallback() {
    wasIdleWholeTime = false;
    if (retryTimeout) {
      clearTimeout(retryTimeout);
    }
    retryTimeout = null;
  }

  function initialize() {
    idleNotifier = new SA.Utils.IdleNotifier({
      idleTime: config.idle * 1000
    });
    idleNotifier.addActiveCallback(activeCallback);
    idleNotifier.addIdleCallback(connectAndRefresh);

    setTimeout(function(){
      passedInterval = true;
      connectAndRefresh();
    }, interval);
  }

  function init() {
    if(config.active && (!SA.Data.User.isProPlus() || config.force)){
      initialize();
    }
  }

  // setter function to enable/disable page refresh.
  // @param {bool} val
  scope.setActive = function(val) {
    config.active = !!val;
  };

  SA.run(init, 'page-refresher-init');

}(window, window.SA));
// Module responsible for collecting data about user been idle or active
// Module saves data to localStorage and sends it with mone event on next page.
// No public methods

(function(SA, $){

  'use strict';

  var idleInterval = SA.pageConfig.idleStartTime === undefined ? 30 * 1000 : SA.pageConfig.idleTime,
      storeKey = '__sa_track__', storeKeyRegExp = new RegExp(storeKey),
      store = SA.Data.Cache,
      idleNotifier = new SA.Utils.IdleNotifier({
        idleTime: idleInterval
      }),
      updateInterval = 3000,
      sendInterval = updateInterval * 10,
      active = 0,
      idle = 0,
      wasNeverActive  = true,
      isActive = false;


  function onActive() {
    isActive = true;

    if(wasNeverActive && idle <= (idleInterval / 2)) {
      active = idle;
      idle = 0;
    }

    wasNeverActive = false;
  }

  function onIdle() {
    isActive = false;
  }

  function save() {
    var pageKey = SA.pk.get();
    var k = storeKey + pageKey, e = {a: active, i: idle, s: window.location.pathname, u: new Date().getTime(), k: pageKey};
    SA.exec(function() {
      store.set(k, JSON.stringify(e));
    });
  }

  function update() {
    if(isActive) {
      active += updateInterval;
    } else {
      idle += updateInterval;
    }
    save();
  }

  function sendEvent(e) {
    SA.Logger.Mone.event('time_tracking', e.s, 'time_active', {
      moneKey: e.k,
      data: {
        active: parseInt((e.a || 0) / 1000, 10).toString(),
        idle: parseInt((e.i || 0) / 1000, 10).toString()
      }
    });
  }

  function checkEvent(key) {
    var m;
    try {
      m = JSON.parse(store.get(key));
    } catch(ignore) { store.del(key); }
    if(m && (new Date().getTime() - (m.u || 0)) > sendInterval) {
      sendEvent(m);
      store.del(key);
    }
  }

  function enqueueEvents() {
    var s = store.getStore();
    if(s) {
      $.each(s, function (i) {
        if(storeKeyRegExp.test(i)) {
          checkEvent(i);
        }
      });
    }
  }

  function init() {
    store.del('sa-time-tracking'); // clean old tracking data from v1
    idleNotifier.addActiveCallback(onActive);
    idleNotifier.addIdleCallback(onIdle);
    setInterval(update, updateInterval);
    enqueueEvents();
  }

  SA.run(init, 'time-on-page');

}(window.SA, window.jQuery));
// Another SA tracking system. 100% async
// Sends data to Fastly. From there data been pulled with logs and saved to ElasticSearch.
// Also this module responsible for sending performance data on every page load.
// Can be accessed through Kibana http://kibana.seekingalpha.com
// Usage:
//   SA.trackq.push(['event', 'ad', 'slow_ad', {
//     user: SA.Data.User.id
//   })
(function(w, SA, $) {

  'use strict';

  var count = 0;

  function serializeObj(obj) {
    var str = [], i;
    for(i in obj) {
      if (obj.hasOwnProperty(i)) {
        str.push(encodeURIComponent(i) + '=' + encodeURIComponent(obj[i]));
      }
    }
    return str.join('&');
  }

  function trackPerformance(){
    if (!window.performance || !performance.timing) return;
    var timing = performance.timing, reqStart = timing.requestStart, data = {};
    var times = {
      start: 'domLoading',
      interactive: 'domInteractive',
      ready: 'domContentLoadedEventStart',
      load: 'loadEventStart'
    };
    for (var key in times){
      var t = timing[times[key]];
      if (t) data[key] = t - reqStart;
    }
    eventPx('page', 'load', data);
  }

  $(window).on('load', function(){
    trackPerformance();
  });

  function defaultData() {
    return serializeObj({
      uid: SA.Data.User.id() || 0,
      pkey: SA.pk.get() || 0,
      path: w.location.pathname || 0
    });
  }

  function eventPxPath(c, a, opt) {
    opt = opt || {};
    opt['c'] = count;
    return SA.App.host + '/_sa_track/' + c + '/' + a + '?' + defaultData() + '&' + serializeObj(opt);
  }

  function eventPx(c, a, opt) {
    (new Image()).src = eventPxPath(c, a, opt);
  }

  var Tracker = {};
  //public methods

  // sends event to ES with data provided
  // @param {string} category - event category. Default - 'tracking'
  // @param {string} action - event related action. Default - 'event'
  // @param (object) opt - custom data. Will be serialized and snt with event
  Tracker.event = function(category, action, opt) {
    category = category || 'tracking';
    action = action || 'event';
    eventPx(category, action, opt);
  };

  // event collected before init
  var initQ = SA.trackq || [];

  //replacing queue
  SA.trackq = {
    push: function(){
      var len = arguments.length, i = 0;
      for (i; i < len; i += 1){
        if (Tracker[arguments[i][0]]){
          Tracker[arguments[i][0]].apply(Tracker, arguments[i].slice(1));
          count += 1;
        }
      }
    }
  };

  // send initially collected data
  SA.trackq.push.apply(SA.trackq, initQ);
}(window, window.SA, window.jQuery));
// Google Ads offline conversion tracking
// https://support.google.com/google-ads/answer/7012522

(function (w, SA) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Stats.Gclid');


  // Public methods

  scope.get = function () {
    var gclid = SA.Data.Cache.getJson('gclid'),
      isGclidValid = gclid && new Date().getTime() < gclid.expiryDate;

    return isGclidValid ? gclid.value : null;
  };

  // Private methods

  function getParam(p) {
    var match = RegExp('[?&]' + p + '=([^&]*)').exec(w.location.search);
    return match && decodeURIComponent(match[1].replace(/\+/g, ' '));
  }

  function getExpiryRecord(value) {
    var expiryPeriod = 90 * 24 * 60 * 60 * 1000, // 90 day expiry in milliseconds
      expiryDate = new Date().getTime() + expiryPeriod;

    return {
      value: value,
      expiryDate: expiryDate
    };
  }

  function setGclid() {
    var gclidParam = getParam('gclid'), // saved in cookies under '_gcl_aw' key
      gclsrcParam = getParam('gclsrc'),
      isGclsrcValid = !gclsrcParam || gclsrcParam.indexOf('aw') !== -1;

    if (gclidParam && isGclsrcValid) {
      SA.Data.Cache.setJson('gclid', getExpiryRecord(gclidParam));
    }
  }

  function init() {
    setGclid();
  }

  SA.run(init, 'sa-gclid');

}(window, window.SA));
(function(w, SA) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Stats.PX'), cs = SA.Data.Cookies, ls = SA.Data.Cache;

  var d = SA.pageConfig.Data || {}, article = d.article || {}, author = d.author || {};
  var pName = w.location.pathname, pArray = pName ? w.location.pathname.split('/') : [], pType = '/', fKey = SA.App.perimeterXAppId + '_asyncInit';

  pType = pArray[1] || pType;

  var userStatus = SA.Data.User.loggedIn() ?
    (/mp_|archived|embargoed/.test(cs.get('gk_user_access')) ? '2' : '1') : '0';

  w._pxAppId = SA.App.perimeterXAppId;
  w._pxParam1 = article.id ? article.id.toString() : '0';
  w._pxParam2 = author.id ? author.id.toString() : '0';
  w._pxParam3 = SA.Data.User.id().toString();
  w._pxParam4 = SA.pageConfig.machineID || '';
  w._pxParam5 = SA.pk.get() || '';
  w._pxParam6 = SA.App.type;
  w._pxParam7 = pType;
  w._pxParam8 = userStatus;

  if(!SA.App.env.dev && !(/perx=false/).test(location.href)) {
    SA.loadJS([{src: '/' + SA.App.perimeterXAppId.replace('PX', '') + '/init.js'}]);
  }

  window[fKey] = function (px) {
    var whitelisted = false, checkedBinary = false;

    px.Events.on('score', function(s, k) {
      if (checkedBinary) return;
      if (k === 'binary' && !parseInt(s, 10)){
        if (!whitelisted){
          ls.set('h_px', 1);
          cs.set('h_px', 1, {expire: Infinity});
          SA.trackq.push(['event', 'px', 'hum']);
        }
      } else {
        ls.del('h_px');
        cs.del('h_px');
        SA.trackq.push(['event', 'px', 'bot']);
      }

      checkedBinary = true;
    });

    px.Events.on('enrich', function (value) {
      // value - the enriched data, in the form of <HMAC>:<Base64 encoded data>
      var base64Data = value.split(":")[1], // split value to get the base64 encoded data
          dataStr = atob(base64Data), // base64 decode the enrichment data
          data = JSON.parse(dataStr), // get the data as JSON
          exceptionRules = [
            'e13ad9c8-3493-4ff0-afe2-4cc4c417437c', // office
            '2145324f-f4fd-40e2-9ced-32fe7d2e61bc' // pro users
          ];

      if (data.f_type === 'w' && exceptionRules.indexOf(data.f_id) === -1 && !whitelisted){
        whitelisted = true;
        ls.del('h_px');
        cs.del('h_px');
        SA.trackq.push(['event', 'px', 'white', {origin: data.f_origin, id: data.f_id}]);
      }
    });
  };


}(window, window.SA));
SA.define('SA.Utils.Search', ['SA.Fn.ajax'], function (ajax) {

  'use strict';

  var symCache = {},
    LIMIT = 3,
    anchorClass = 'ticker-link';

  function fromSymCache(slug, clb) {
    var obj = symCache[slug.toLowerCase()];
    if (obj) {
      clb(obj);
      return true;
    }
    return false;
  }

  function match(opt, clb) {
    var query = opt.query ? opt.query.trim() : null;
    if (query && clb) {
      ajax('/api/common/ac/search?term='
        + encodeURIComponent(query)
        + (opt.symbols ? '&symbols=1' : '')
        + (opt.symbols && opt.excludeCrypto ? '&crypto=false' : '')
        + (opt.symbols && opt.excludeIndices ? '&indices=false' : '')
        + (opt.symbols && opt.stocksOnly ? '&only_stocks=true' : '')
        + (opt.symbols && opt.fundsOnly ? '&only_funds=true' : '')
        + '&pages=1'
        + (opt.people ? '&people=1' : '')
        + (opt.research ? '&has_author_research=1' : '')
        + (opt.resultsLimit ? ('&limit=' + opt.resultsLimit) : ''),
        function (res) {
          clb(res, opt);
        });
    }
  }

  function exactTicker(slug, clb) {
    if (slug && clb) {
      return fromSymCache(slug, clb) || ajax('/api/common/ac/exact/ticker?slug=' + encodeURIComponent(slug), function (res) {
        symCache[slug.toLowerCase()] = res;
        clb(res);
      });
    }
  }

  return {
    match: function (opt, clb) {
      opt = Object.assign({}, { resultsLimit: LIMIT, people: false, symbols: true, query: '' }, opt);
      match(opt, clb);
    },

    ticker: exactTicker,

    tickerLink: function (opt) {
      exactTicker(opt.slug, function (res) {
        if (res && res.slug) {
          var slug = res.slug.toUpperCase(),
            exchange = res.exchange ? [res.exchange, ':'] : [],
            link = ['<a href="', SA.App.host, '/symbol/', slug, '" class="', anchorClass, '">', slug, '</a>'];

          opt.clb(exchange.concat(link).join(''));
        } else {
          opt.clb(opt.slug);
        }
      });
    },

    tickerLinkClass: anchorClass
  };

});
(function (w, SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Utils');

  scope.Callbacks = function () {

    var list = $.Callbacks('unique'),
      added = false,
      milliseconds = 100,
      timeout = null;

    this.add = function (clb) {
      list.add(clb);
      set();
    };

    this.remove = function (clb) {
      list.remove(clb);
      unset();
    };

    function set() {
      if (list.has() && !added) {
        added = true;
        $(w).on('scroll', delayClb);
      }
    }

    function unset() {
      if (!list.has() && added) {
        added = false;
        $(w).off('scroll', delayClb);
      }
    }

    function delayClb() {
      if (timeout) {
        clearTimeout(timeout);
      }

      timeout = setTimeout(list.fire, milliseconds);
    }

  };

}(window, window.SA, window.jQuery));


// module containing set of functions to work with browser's scroll event
(function (w, SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Utils.Scroll');

  var callbacks = new SA.Utils.Callbacks();

  // detect if specific element has scrollbar (set by overflow: scroll)
  scope.elementHasScroll = function ($element) {
    return $element[0].scrollHeight > $element.height();
  };

  //calls some function on page scroll, but only 100ms after scroll stops
  //clb - reference to function that should be called
  scope.add = callbacks.add;

  //clb - reference to same function that was previously passed to add.
  scope.remove = callbacks.remove;

  // check if scroll position close to specific element
  scope.isCloseToElement = function (el, delta) {
    var epY = scope.getOffsetTop(el);

    //element is invisible or doesn't exist.
    return epY ? (epY < $(w).scrollTop() + $(w).height() + delta) : false;
  };

  scope.getOffsetTop = function (el) {
    var $el = el ? $(el) : null,
      epY = ($el && $el.length) ? $el.offset().top : null;

    //element is invisible or doesn't exist.
    if (epY) {
      //fix Mobile Safari bug showing wrong window offset http://bugs.jquery.com/ticket/6446
      var isAppleDevice;
      if ($.isFunction(SA.Utils.Env.isAppleDevice)) {
        isAppleDevice = SA.Utils.Env.isAppleDevice();
      } else {
        isAppleDevice = SA.Utils.Env.isAppleDevice;
      }

      if (isAppleDevice) {
        epY -= w.scrollY;
      }
    }

    return epY;
  };

  scope.isScrolledIntoView = function (el) {
    var $w = $(w),
      docViewTop = $w.scrollTop(),
      docViewBottom = docViewTop + $w.height();

    var $elem = $(el),
      elemTop = $elem.offset().top,
      elemBottom = elemTop + $elem.height();

    return elemBottom <= docViewBottom && elemTop >= docViewTop;
  };

  // for elements that have scrolling, check when scroll is close to the
  // bottom of it's container
  scope.isScrolledToElBottom = function (el, delta) {
    var $el = $(el);
    if (!delta) {
      delta = 0;
    }

    return $el.scrollTop() + $el.innerHeight() >= $el[0].scrollHeight - delta;
  };

}(window, window.SA, window.jQuery));
(function (SA, $, $w) {
  'use strict';

  var s = SA.UsingNamespace('SA.Utils.TourLoader');

  var user = SA.Data.User,
    saCache = SA.Data.Cache,
    activeTours;

  function tourDisplay() {
    var userTourIds = $.map(user.introductionTours(), function (element, index) {
      return index;
    });

    if (user.loggedIn()) {
      for (var i = 0; i < activeTours.length; i++) {
        var currTour = activeTours[i],
          forceUsers = currTour.force_users || '',
          regExUrl = new RegExp(currTour.target_url);

        // skip if user already saw this tour (show unit if force_user logic apply)
        if ($.grep(userTourIds, function (e) {
          return e == currTour.id;
        }).length === 0 || forceUsers.split(/\s*,\s*/).indexOf(user.id().toString()) !== -1) {
          // skip if url of page not match target url of tour
          if ((currTour.target_url === '/hp' && $w.location.pathname === '/') || $w.location.pathname.includes(currTour.target_url) || $w.location.pathname.match(regExUrl)) {
            if (JSON.parse(currTour.steps)) {
              saCache.set('current_tour', JSON.stringify(currTour));
              SA.loadJS([{ src: 'https://static3.seekingalpha.com/assets/pkg/intro_tour-b0eda45cf753ddd134e98a581b428a60c2f0b445c4c6c64b73613406e582573a.js', id: 'intro-tour' }]);
              break;
            }
          }
        }
      }
    }
  }

  function init() {
    $.get('/account/introduction_tour/active_tours', {}, function (res) {
      res = res || {};
      var tours = res.active_tours;
      if (tours && tours.length > 0) {
        activeTours = tours;
        tourDisplay();
      }
    });
  }

  s.init = function () {
    init();
  }

  init();
}(window.SA, window.jQuery, window));
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/hover_popup/template"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div class="popover ',  cssClass ,'">\n  <div class="arrow"></div>\n  <div class="popover-content"></div>\n</div>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/inline_svg/help_icon"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<svg class="thumb" version="1.1" x="0px" y="0px" width="',  width ,'" height="',  height ,'" viewBox="0 0 320.013 323.021" xml:space="preserve">\n  <path fill="#ffffff" d="M158.992 0C71.186 0 0 71.184 0 158.992s71.186 158.991 158.992 158.991c87.809 0 158.992-71.183 158.992-158.991S246.801 0 158.992 0zm21.289 250.469h-49.939v-44.051h49.939v44.051zm40.739-111.416c-3.846 6.463-11.699 14.356-23.559 23.682-8.264 6.546-13.479 11.801-15.645 15.768-2.17 3.969-3.252 9.142-3.252 15.522h-46.629v-4.663c0-7.934.9-14.375 2.699-19.325 1.799-4.949 4.48-9.468 8.037-13.56 3.559-4.089 11.555-11.288 23.99-21.596 6.625-5.399 9.939-10.348 9.939-14.848 0-4.497-1.332-7.994-3.988-10.491-2.66-2.494-6.688-3.742-12.086-3.742-5.811 0-10.615 1.923-14.418 5.768-3.805 3.846-6.24 10.552-7.301 20.123l-47.611-5.89c1.637-17.505 7.996-31.597 19.082-42.271 11.084-10.676 28.078-16.014 50.982-16.014 17.834 0 32.23 3.724 43.193 11.166 14.887 10.062 22.332 23.479 22.332 40.248.002 6.953-1.922 13.662-5.765 20.123z"/>\n</svg>\n');}return __p.join('');};
}).call(this);
/*!
 * hoverIntent v1.9.0 // 2017.09.01 // jQuery v1.7.0+
 * http://briancherne.github.io/jquery-hoverIntent/
 *
 * You may use hoverIntent under the terms of the MIT license. Basically that
 * means you are free to use hoverIntent as long as this header is left intact.
 * Copyright 2007-2017 Brian Cherne
 */

!function(factory){"use strict";"function"==typeof define&&define.amd?define(["jquery"],factory):jQuery&&!jQuery.fn.hoverIntent&&factory(jQuery)}(function($){"use strict";var cX,cY,_cfg={interval:100,sensitivity:6,timeout:0},INSTANCE_COUNT=0,track=function(ev){cX=ev.pageX,cY=ev.pageY},compare=function(ev,$el,s,cfg){if(Math.sqrt((s.pX-cX)*(s.pX-cX)+(s.pY-cY)*(s.pY-cY))<cfg.sensitivity)return $el.off(s.event,track),delete s.timeoutId,s.isActive=!0,ev.pageX=cX,ev.pageY=cY,delete s.pX,delete s.pY,cfg.over.apply($el[0],[ev]);s.pX=cX,s.pY=cY,s.timeoutId=setTimeout(function(){compare(ev,$el,s,cfg)},cfg.interval)},delay=function(ev,$el,s,out){return delete $el.data("hoverIntent")[s.id],out.apply($el[0],[ev])};$.fn.hoverIntent=function(handlerIn,handlerOut,selector){var instanceId=INSTANCE_COUNT++,cfg=$.extend({},_cfg);$.isPlainObject(handlerIn)?(cfg=$.extend(cfg,handlerIn),$.isFunction(cfg.out)||(cfg.out=cfg.over)):cfg=$.isFunction(handlerOut)?$.extend(cfg,{over:handlerIn,out:handlerOut,selector:selector}):$.extend(cfg,{over:handlerIn,out:handlerIn,selector:handlerOut});var handleHover=function(e){var ev=$.extend({},e),$el=$(this),hoverIntentData=$el.data("hoverIntent");hoverIntentData||$el.data("hoverIntent",hoverIntentData={});var state=hoverIntentData[instanceId];state||(hoverIntentData[instanceId]=state={id:instanceId}),state.timeoutId&&(state.timeoutId=clearTimeout(state.timeoutId));var mousemove=state.event="mousemove.hoverIntent.hoverIntent"+instanceId;if("mouseenter"===e.type){if(state.isActive)return;state.pX=ev.pageX,state.pY=ev.pageY,$el.off(mousemove,track).on(mousemove,track),state.timeoutId=setTimeout(function(){compare(ev,$el,state,cfg)},cfg.interval)}else{if(!state.isActive)return;$el.off(mousemove,track),state.timeoutId=setTimeout(function(){delay(ev,$el,state,cfg.out)},cfg.timeout)}};return this.on({"mouseenter.hoverIntent":handleHover,"mouseleave.hoverIntent":handleHover},cfg.selector)}});




(function (SA, $, w) {
  'use strict';

  var s = SA.UsingNamespace('SA.Utils.TooltipLoader');

  var TooltipTypes = {
    0: 'DATA_ITEM',
    1: 'SECTION_HEADER'
  };
  var activeTips = [];

  function setPopover($obj) {
    $obj.hoverIntent({
      over: function () {
        var _this = this;
        if ($(this).attr('aria-describedby')) {
          return;
        }
        $(this).popover('show');
        $('.popover').on('mouseleave', function () {
            setTimeout(function () {
              if (!$('.popover-el:hover').length) {
                $(_this).popover('hide');
              }
            }, 500);
        });
      },
      out: function () {
        var _this = this;
        setTimeout(function () {
          if (!$('.popover:hover').length) {
            $(_this).popover('hide');
          }
        }, 300);
      },
      timeout: 300,
      sensitivity: 5
    });
  }

  function headerTipDisplay($obj, tip) {
    var $existIcon = $obj.find('.tooltip-header-icon'),
      addSeparator = $obj.next().hasClass('download-spreadsheet'),
      config = {
        placement: 'left',
        trigger: 'manual',
        html: true,
        template: w.JST['jst/widgets/hover_popup/template']({cssClass: 'hover-tip'}),
        content: tip.content,
        container: 'body'
      };
    if ($existIcon && $existIcon.length > 0) {
      return;
    }
    $obj.append(helpIconHtml(addSeparator, tip.id));
    if (addSeparator) {
      $obj.next().addClass('margin-dl-btn');
    }

    setTimeout(function () {
      $('.tooltip-header-icon').each(function() {
        var $headerObj = $(this),
          currTip = activeTips.find(function(item) {return item.id === $headerObj.data('tip-id')});
        $headerObj.addClass('popover-el');
        $.extend(config, {content: currTip.content});
        $headerObj.popover(config);
        setPopover($headerObj);
      });
    }, 300);
  }

  function itemTipDisplay($obj, tip) {
    var config = {
        placement: 'right',
        trigger: 'manual',
        html: true,
        template: w.JST['jst/widgets/hover_popup/template']({cssClass: 'hover-tip'}),
        content: tip.content,
        container: 'body'
      };
    $obj.addClass('popover-el');
    $obj.popover(config);
    setPopover($obj);
  }

  function helpIconHtml(addSeparator, tipId) {
    var res = "<span class='tooltip-header-icon' rel='popover' data-tip-id="+tipId+">" + w.JST['jst/inline_svg/help_icon']({width: 14, height: 14}) + "</span>";
    return addSeparator ? res + "<span class='divider-el'>|</span>" : res;
  }

  function delayMethod() {
    window.setTimeout(init, 2000);
  }

  function init() {
    $.get('/tooltips/get', {}, function (res) {
      if (res && res.tips && res.tips.length) {
        activeTips = res.tips;

        $.each(activeTips, function(i, tip) {
          var type = TooltipTypes[tip.type_id];

          if (tip.active && type) {
            var objType = type === 'DATA_ITEM' ? 'th, td, div, span' : 'h4',
              elm = $('html').find(objType),
              $obj = tip.exact_match ? elm.filter(function() {return $(this).text().trim() === tip.term}) : elm.filter(function() {return $(this).text().indexOf(tip.term) !== -1});

            if ($obj && $obj.length > 0) {
              if (type === 'DATA_ITEM') {
                var child = $obj.children();
                if (child.length === 1) {
                  $obj = child
                }

                itemTipDisplay($obj, tip);
              } else if (type === 'SECTION_HEADER') {
                headerTipDisplay($obj, tip);
              }
            }
          }
        });
      }
    });
  }

  s.init = function () {
    delayMethod();
  };

  delayMethod();
}(window.SA, window.jQuery, window));
(function (SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Utils');

  scope.GetHistoricalPrice = function (symbols, callback) {
    if (symbols && callback && $.isFunction(callback) && $.isArray(symbols)) {
      $.get('/tickers/historical_prices', {'symbols[]':symbols}).done(function(r) {
        if (r) {
          return callback(r);
        }
      });
    }
  };

}(window.SA, window.jQuery));

(function (w, SA) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Utils.PageTracker');

  scope.recordVisitedItem = function (lsKey, id, opts) {
    var itemsVisited = SA.Data.Cache.getJson(lsKey);
    opts = opts || {};

    if (opts.maxValues) {
      itemsVisited[id] = Array.isArray(itemsVisited[id]) ? itemsVisited[id] : [];
      if (itemsVisited[id].length >= opts.maxValues) {
        itemsVisited[id].shift();
      }
      itemsVisited[id].push(Date.now());
    } else {
      itemsVisited[id] = [Date.now()];
    }
    // save articles/news ids that were read by the user and serve them for X days as a KV
    SA.Data.Cache.setJson(lsKey, itemsVisited);
  };

  scope.recordVisitedProPage = function (serviceId) {
    serviceId = serviceId || SA.Fn.param('service_id');
    var lpVal = {
      proresearch: 'premium_checkout',
      proplus: 'proplus_checkout'
    }[serviceId];

    if (lpVal) {
      scope.recordVisitedItem('pro_landing_page', lpVal, serviceId === 'proresearch' ? { maxValues: 2 } : null);
    }
  }

}(window, window.SA));
(function(w, SA) {

  'use strict';

  var AB = {
    identity: parseInt(SA.Fn.param('abid'), 10) || SA.Data.User.id() || parseInt(SA.pageConfig.machineID, 10)
  };

  AB.tenth = AB.identity % 10;

  AB.getABDigits = function () {
    return AB.identity / 10 % 100;
  };

  w.ABTest = AB;

}(window, window.SA));
// Constructor class for building popups.
// Based on bootstraps implementation of Modals http://getbootstrap.com/javascript/#modals
// Usage:
//   create new instance passing options
//   var popup = SA.Widgets.Popup.build(opt);
//
//   show popup
//   popup.show();
//
// Instance Options:
// opt.className - popup's preferred css class name. Default - 'sa-modal'
// opt.backdrop - boolean or the string 'static'. Includes a modal-backdrop element. Alternatively, specify static for a backdrop which doesn't close the modal on click. Default - 'static'
// opt.keyboard - boolean. Closes the modal when escape key is pressed. Default - false
// opt.showHeader - boolean. Indicated if popup should have header. Default - true
// opt.headerContent - string of html which will be rendered in popup's header. Default - ''
// opt.showCloseBtn - boolean. If there should be close btn in popup's header. Default - true
// opt.showBody - boolean. Indicated if popup should have body. Default - true
// opt.bodyContent - string of html which will be rendered in popup's body. Default - ''
// opt.showFooter - boolean. Indicated if popup should have footer. Default - false
// opt.footerContent - string of html which will be rendered in popup's footer. Default - ''
// opt.removeAfterClose - boolean. If popup should be removed from document after close. All connected events will be removed
// opt.beforeOpen - this callback fires immediately when the show instance method is called.
// opt.afterOpen - This event is fired when the modal has been made visible to the user (will wait for CSS transitions to complete).
// opt.beforeClose - This event is fired immediately when the hide instance method has been called.
// opt.afterClose - This event is fired when the modal has finished being hidden from the user (will wait for CSS transitions to complete).

(function(SA, $){

  'use strict';

  //opt.empty - gives no content insight (no header, body, footer)

  var scope = SA.UsingNamespace('SA.Widgets.Popup'), modals = {};

  // Modal possible options list

  var buildModalOptions = function(opt) {
    return $.extend({}, {
      className: 'sa-modal',
      backdrop: 'static',
      keyboard: false,
      showHeader: true,
      headerContent: '',
      showCloseBtn: true,
      showBody: true,
      bodyContent: '',
      showFooter: false,
      footerContent: '',
      removeAfterClose: false,
      // Callback functions available
      beforeOpen: null,
      afterOpen: null,
      beforeClose: null,
      afterClose: null,
      fade: 'fade'
    }, opt || {});
  };

  var buildModal = function(opt){
    var content, modal = $('<div id="' + opt.modalId + '" class="' + opt.className + ' modal ' + opt.fade + '" data-backdrop="' + opt.backdrop + '" data-keyboard="' + opt.keyboard + '"  tabindex="-1"><div class="modal-dialog"><div class="modal-content"></div></div></div>');

    if(opt.empty) {
      return modal;
    }

    content = modal.find('.modal-content');

    // Set Modal Header
    if(opt.showHeader || opt.headerContent) {
      content.append('<div class="modal-header">' + (opt.showCloseBtn ? '<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span class="close-icon" aria-hidden="true">&times;</span></button>' : '') + opt.headerContent + '</div>');
    }

    if(opt.showBody || opt.bodyContent) {
     content.append('<div class="modal-body">' + opt.bodyContent + '</div>');
    }

    if(opt.showFooter || opt.footerContent) {
      content.append('<div class="modal-footer">' + opt.footerContent + '</div>');
    }

    return modal;
  };

  var Modal = function(opt) {

    opt = buildModalOptions(opt);

    opt.modalId = opt.className + Date.now();

    //Store id to reference in modals array
    var id = opt.modalId, modalScope = this, modal = buildModal(opt);

    this.showing = false;

    this.id = id;

    var setEventListeners = function() {
      // Set beforeOpen callback
      if(opt.beforeOpen) {
        modal.on('show.bs.modal', function() {
          opt.beforeOpen();
        });
      }

      // Set afterOpen callback
      if(opt.afterOpen) {
        modal.on('shown.bs.modal', function() {
          opt.afterOpen(this);
        });
      }

      // Set beforeClose callback
      if(opt.beforeClose) {
        modal.on('hide.bs.modal', function() {
          opt.beforeClose();
        });
      }

      // Set afterClose callback
      if(opt.afterClose) {
        modal.on('hidden.bs.modal', function() {
          opt.afterClose(this);
        });
      }

      // remove after close

      modal.on('hidden.bs.modal', function() {
        modalScope.showing = false;
        if(opt.removeAfterClose) {
          $(this).detach();
        }
      });

    };

    //instance methods

    // returns jQuery object of current popup
    this.getModalObject = function() {
      return modal;
    };

    // show popup
    this.show = function(){
      modal.modal('show');
      this.showing = true;
    };

    // hide popup
    this.hide = function(){
      modal.modal('hide');
      this.showing = false;
    };

    this.innerBody = function(val){
      modal.find('.modal-body').html(val);
    };

    this.innerFooter = function(val){
      modal.find('.modal-footer').html(val);
    };

    setEventListeners();

  };

  // Widget public methods

  scope.build = function(opt){
    var modal = new Modal(opt);
    modals[modal.id] = modal;
    return modal;
  };

  scope.isRunning = function() {
    return $.map(modals, function(modal) {
      if(modal.showing) {
        return modal;
      }
    }).length > 0;
  };

}(window.SA, window.jQuery));

(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/utils/enter_name_body"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div class="popup-body-container">\n  <input class="input" type="text" placeholder="',  placeholder ,'" value="',  currentName ,'" title="">\n  ');  if (showAvailabilityIcon) { ; __p.push('\n    <div class="availability-icon"></div>\n  ');  } ; __p.push('\n  <div class="status"></div>\n</div>\n');}return __p.join('');};
}).call(this);

(function (w, SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Widgets');

  scope.EnterNamePopup = (function () {
    var enterNamePopup = this;
    var popupClassName = 'enter-name-popup';
    var bi, clb, checkAvailability;
    var popup, $input, $statusIcon, $status, $saveBtn, $closeBtn, timer;

    function show(opt) {
      if (!showing()) {
        bi = opt.bi || {type: '', source: ''};

        clb = {
          onSubmit: opt.clb.onSubmit,
          checkAvailability: opt.clb.checkAvailability
        };

        checkAvailability = $.isFunction(clb.checkAvailability);

        if ($.isFunction(opt.clb.beforeOpen)) {
          opt.clb.beforeOpen();
        }

        popup = SA.Widgets.Popup.build({
          className: popupClassName,
          headerContent: '<div class="header">' + opt.content.header + '</div>',
          bodyContent: w.JST["jst/widgets/utils/enter_name_body"]({
            placeholder: opt.content.placeholder || '',
            currentName: opt.currentName || '',
            showAvailabilityIcon: checkAvailability
          }),
          afterOpen: function () {
            onAfterOpen(opt.clb.afterOpen);
          },
          footerContent: '<span class="warning">' + opt.content.footer + '</span><button class="save-btn disabled">' + (opt.content.button || 'Create') + '</button>',
          removeAfterClose: true,
          afterClose: function () {
            onAfterClose(opt.clb.onClose);
          }
        });

        SA.Logger.Mone.event(bi.type, bi.source, 'shown');

        popup.show();
      }

      return enterNamePopup;
    }

    function showing() {
      return popup && popup.showing;
    }

    function hide() {
      popup.hide();
    }

    function updatePlaceholder(name) {
      $input.attr('placeholder', 'Example: ' + name);
    }

    function onAfterOpen(callback) {
      var $popup = $('.' + popupClassName);
      $input = $popup.find('input.input');
      $saveBtn = $popup.find('button.save-btn');
      $statusIcon = $popup.find('.availability-icon');
      $status = $popup.find('.status');
      $closeBtn = $popup.find('button.close');

      if ($.isFunction(callback)) {
        callback();
      }

      setEvents();
      focusInput();
    }

    function setEvents() {
      $input.on('keyup', function () {
        if (checkAvailability) {
          clearTimeout(timer);
          timer = setTimeout(function () {
            clb.checkAvailability($input.val());
          }, 500);
        } else if ($input.val()) {
          $saveBtn.removeClass('disabled');
        } else {
          $saveBtn.addClass('disabled');
        }
      });

      $saveBtn.click(function () {
        if ($input.val() && !$saveBtn.hasClass('sa-animated')) {
          $saveBtn.addClass('sa-animated');
          clb.onSubmit($input.val());
        }
      });

      $closeBtn.click(function () {
        SA.Logger.Mone.event(bi.type, bi.source, 'clicked_x');
      });
    }

    function focusInput() {
      $input.focus();

      var inputElem = $input[0];
      if (inputElem.setSelectionRange) {
        var len = $input.val().length * 2;
        setTimeout(function () {
          inputElem.setSelectionRange(len, len);
        }, 1);
      }
    }

    function setAvailable() {
      $statusIcon.removeClass('unavailable-icon').addClass('available-icon');
      $status.text('Available').removeClass('unavailable').addClass('available');
      $saveBtn.removeClass('disabled');
    }

    function setUnavailable(errors) {
      var errors = errors ? parseErrors(errors) : null;
      $saveBtn.removeClass('sa-animated').addClass('disabled');
      $statusIcon.removeClass('available-icon').addClass('unavailable-icon');
      $status.html(errors || 'Unavailable').removeClass('available').addClass('unavailable');
    }

    function parseErrors(errors) {
      var html = '<ul>';
      html += $.map(errors, function (error, i) {
        return '<li>' + error.charAt(0).toUpperCase() + error.slice(1) + '</li>';
      });
      html += '</ul>';
      return html;
    }

    function onAfterClose(callback) {
      if ($.isFunction(callback)) {
        callback();
      }

      $input.off('keyup');
      $saveBtn.off('click');
      $closeBtn.off('click');

      $input = null;
      $saveBtn = null;
      $statusIcon = null;
      $status = null;
      $closeBtn = null;

      bi = null;
      clb = null;
      checkAvailability = null;
      popup = null;
    }

    return {
      show: show,
      showing: showing,
      hide: hide,
      updatePlaceholder: updatePlaceholder,
      setAvailable: setAvailable,
      setUnavailable: setUnavailable
    };

  })();

}(window, window.SA, window.jQuery));
(function (SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Models');
  scope.EnterUsername = {

    getSuggestedUsername: function (data, clb) {
      $.get('/users/ajax_get_suggested_username', data).done(clb.onSuccess).fail(clb.onFail);
    },

    getUsernameAvailability: function (data, clb) {
      $.get('/users/ajax_username_is_available', data).done(clb.onSuccess).fail(clb.onFail);
    },

    saveUsername: function (data, clb) {
      $.ajax({
        url:'/users/ajax_set_nick',
        method: 'POST',
        data: data,
        timeout: 0
      }).done(function (res) {
        if (res.action === 'saved') {
          SA.Logger.Mone.event('profile', 'username_choice', 'username_chosen', {data: {'new_nick': res.username, 'previous_nick': res.previous_username}});
          SA.Data.Cookies.set('user_nick', res.username, Infinity);
          $('header#sa-hd #hd-user .dropdown-header.pro-gray-bg.elips').html(res.username);

          if ($.isFunction(clb.onSuccess)) {
            clb.onSuccess(res);
          }
        } else if (res.errors) {
          Rollbar.error('General Error while handling set username: ' + res.errors);
        } else if (res.warnings) {
          Rollbar.log('Warnings while setting username: ' + res.warnings);
        }

        if ($.isFunction(clb.onFail) && (res.errors || res.warnings)) {
          clb.onFail(res);
        }
      }).fail(function (res, errorType) {
        Rollbar.error('Error ' + errorType + ' while setting username: ' + res.errors);

        if ($.isFunction(clb.onFail)) {
          clb.onFail(res);
        }
      }).always(clb.onAlways);
    }

  };

}(window.SA, window.jQuery));

(function (SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Widgets');

  scope.EnterUsername = (function () {
    var bi = {source: 'username_choice', action: 'username_chosen'};
    var data, onDone, modelClb;
    var enterNamePopup = SA.Widgets.EnterNamePopup, model = SA.Models.EnterUsername;

    function show(opt) {
      bi.type = opt.type || '';

      data = opt.data || {};

      onDone = opt.onDone;

      modelClb = {
        onSuccess: onSuccess,
        onFail: onFail
      };

      var user = SA.Data.User,
        userId = user.id(),
        currentNick = SA.Data.Cookies.get('user_nick');

      return enterNamePopup.show({
        currentName: currentNick,
        content: {
          placeholder: '',
          header: (currentNick ? 'Update Username' : 'Choose Username'),
          footer: opt.footerContent || (currentNick ? '' : 'Username required'),
          button: opt.buttonContent || (currentNick ? 'Update' : 'Save')
        },
        clb: {
          afterOpen: function () {
            model.getSuggestedUsername({user_id: userId}, modelClb);
          },
          onSubmit: function (name) {
            model.saveUsername({username: name, user_id: userId}, modelClb);
          },
          checkAvailability: function (name) {
            if (!name) {
              enterNamePopup.setUnavailable();
            } else {
              model.getUsernameAvailability({username: name}, modelClb);
            }
          },
          afterClose: opt.afterClose
        },
        bi: bi
      });
    }

    function onSuccess(res) {

      switch (res.action) {
        case 'saved':
          return saved(res.username);

        case 'availability':
          return (res.errors && res.errors.length) ? enterNamePopup.setUnavailable(res.errors) : enterNamePopup.setAvailable();

        case 'suggested':
          return enterNamePopup.updatePlaceholder(res.suggested_username);
      }
    }

    function onFail(res) {
      enterNamePopup.setUnavailable(res.errors);
    }

    function saved(username) {

      enterNamePopup.hide();

      data.newUsername = username;

      if ($.isFunction(onDone)) {
        onDone(data);
      }
    }

    return {
      show: show,
      showing: enterNamePopup.showing,
      hide: enterNamePopup.hide
    };

  })();

}(window.SA, window.jQuery));
SA.define('SA.Fn.escapeHtml', [], function() {

  'use strict';

  var es = {
    '&': '&amp;',
    '<': '&lt;',
    '>': '&gt;',
    '"': '&quot;',
    "'": '&#x27;',
    '/': '&#x2F;'
  }, eRx = /[&<>"'\/]/g;

  return function(str) {
    return str.toString().replace(eRx, function(m) {
      return es[m];
    });
  };

});
SA.define('SA.Fn.debounce', [], function() {

  'use strict';

  var w = window;

  return function(cb, interval) {
    var locker = 0, ts = 0, nextCallArgs = null;

    function fire(args) {
      nextCallArgs = null;
      cb.apply(null, args);
    }

    function waiter() {
      locker = 0;
      var remaining = interval - (Date.now() - ts);
      if (remaining > 0) {
        locker = w.setTimeout(waiter, remaining);
      } else {
        fire(nextCallArgs);
      }
    }

    return function() {
      ts = Date.now();
      nextCallArgs = arguments;
      if (!locker) {
        locker = w.setTimeout(waiter, interval);
      }
    };

  };


});
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/search/recent_search"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<ul class="recent-searches">\n  <li class="dropdown-header recent"></li>\n  ');  jQuery.each(searches, (function() { ; __p.push('\n  ');  if (this.type === 'symbol') { ; __p.push('\n  <li data-slug="',  this.phrase.toUpperCase() ,'" data-type="symbol" class="item clearfix">\n    <span class="sym_name">',  this.phrase.toUpperCase() ,'</span>\n    <span class="sym_desc">',  this.text ,'</span>\n  </li>\n  ');  } else if (this.type === 'page') { ; __p.push('\n  <li data-url="',  this.url ,'" data-type="page" data-name="',  this.text ,'" class="item">\n    <span class="auth_name">',  this.text ,'</span>\n  </li>\n  ');  } else if (this.type === 'people') { ; __p.push('\n  <li data-slug="',  this.phrase ,'" data-type="author" data-name="',  this.phrase ,'" class="item">\n    <span class="auth_name">',  this.text ,'</span>\n  </li>\n  ');  } else if (this.type === 'hashtag') { ; __p.push('\n  <li data-url="',  this.url ,'" data-type="hashtag" data-name="',  this.text ,'" class="item">\n    <span class="auth_name">',  this.text ,'</span>\n  </li>\n  ');  } else { ; __p.push('\n  <li data-name="',  SA.Fn.escapeHtml(this.phrase) ,'" data-slug="',  this.phrase ,'" data-type="keyword" class="item">\n    ',  SA.Fn.escapeHtml(this.phrase) ,'\n  </li>\n  ');  }})); ; __p.push('\n</ul>\n');}return __p.join('');};
}).call(this);




// Module responsible for building input's symbol/authors autocomplete
// In order autocomplete to work - provided $element has to have id attribute
// Usage:
//  var auto = new SA.Utils.Autocomplete($element, opt);
//
// Options:
//   opt.symbols - search and autocomplete stock symbols. Default to true
//   opt.stocksOnly - search and autocomplete stocks only symbols. Default to false
//   opt.excludeCrypto - search and autocomplete stocks excludes crypto currencies. Default to false
//   opt.excludeIndices - search and autocomplete stocks excludes indices. Default to false
//   opt.people - search and autocomplete SA people. Default to false
//   opt.pages - search and autocomplete SA pages. Default to true
//   opt.multiple - allow multiple items to stay selected in provided input. Default - false
//   opt.resultsLimit - limits amount of results shown in autocomplete dropdown. default 10
//   opt.symbolSelectCallback/opt.authorSelectCallback - function executed after symbol/author was selected from autocomplete dropdown by click or by pressing Enter key. Slug of selected symbol is passed to the function
//   opt.onBeforeShowAutoComplete - function executed before showing autocomplete dropdown
//   opt.onShow - function executed when showing autocomplete dropdown
//   opt.onHide - function executed when hiding autocomplete dropdown

(function (w, SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Utils');

  var cache = {}, keyMap = {enter: 13, esc: 27, up: 38, down: 40};

  function b(n, v) {
    return n.replace(new RegExp('(' + v.replace(/[-[\]{}()*+?.,\\^$|#\s]/g, '\\$&') + ')', 'i'), '<b>$1</b>');
  }

  function head(cls) {
    return '<li class="dropdown-header ' + cls + '"></li>';
  }

  function buildHashContent(hashtags, v) {
    var c = '';
    hashtags.forEach(function (hashtag) {
      c += '<li data-url="' + 'hashtag/' + hashtag + '" data-type="hashtag" class="item clearfix" data-name="#' + hashtag + '"><span class="hashtag_name">#' + hashtag + '</span></li>';
    });
    return c ? head('hashtags') + c : c;
  }

  function buildSymbolsContent(symbols, v) {
    var c = '', addClass, addTitle;
    symbols.forEach(function (sym) {
      if (sym.slug.length > 7) {
        addClass = ' elipsis';
        addTitle = sym.name;
      } else {
        addClass = '';
        addTitle = '';
      }
      c += '<li data-slug="' + sym.slug.toUpperCase() + '" data-type="symbol" class="item clearfix"><span class="sym_name' + addClass + '" title="' + addTitle + '">' + b(sym.name, v) + '</span><span class="sym_desc">' + b(sym.content, v) + '</span></li>';
    });
    return c ? head('symbols') + c : c;
  }

  function buildPeopleContent(auth, v) {
    var c = '';
    auth.forEach(function (a) {
      c += '<li data-id="' + a.id + '" data-slug="' + (a.slug || '') + '" data-type="people" data-name="' + a.name + '" class="item"><span class="auth_name">' + b(a.name, v) + (a.content ? (', ' + b(a.content, v)) : '') + '</span></li>';
    });
    return c ? head('people') + c : c;
  }

  function buildPagesContent(auth, v) {
    var c = '';
    auth.forEach(function (a) {
      c += '<li data-url="' + a.url + '" data-type="page" data-name="' + a.name + '" class="item"><span class="auth_name">' + a.name + '</span></li>';
    });
    return c ? head('pages') + c : c;
  }

  function buildAutoCompleteContent(data, val, opt) {
    var content = '';
    data = data || {};
    if (data.hash) {
      content += buildHashContent(data.hash, val);
    }
    if (data.symbols) {
      content += buildSymbolsContent(data.symbols, val);
    }
    if (data.pages && opt.pages) {
      content += buildPagesContent(data.pages, val);
    }
    if (data.people && opt.people) {
      content += buildPeopleContent(data.people, val);
    }
    if (opt.keyword && val && !data.hash) {
      var kw = head('keyword') + '<li data-name="' + SA.Fn.escapeHtml(val) + '" data-slug="' + SA.Fn.escapeHtml(val) + '" data-type="keyword" class="item"><b>' + SA.Fn.escapeHtml(val) + '</b></li>';
      if (opt.cloudsearch) {
        content = kw + content;
      } else {
        content += kw;
      }
    }
    return content;
  }

  function buildRecentSearchContent(data) {
    data = data || {};

    if (!Object.keys(data).length && data.constructor === Object) {
      return '';
    }

    return $(w.JST['jst/widgets/search/recent_search']({searches: data}));
  }

  scope.Autocomplete = function ($input, opt) {

    var $dropDown, recentSearches, isTyping = false, typingTimer;

    var callback = {
      update: {
        state: function () {
          if ($input.val()) {
            return fromAPI(opt.multiple ? $input.val().split(',').pop().trim() : $input.val());
          }
          hide();
        },
        value: function ($item) {
          if (!opt.multiple) {
            var v = $item.data('type') === 'symbol' ? 'slug' : 'name';
            $input.val($item.data(v));
          }
        }
      },
      onBefore: {
        showAutoComplete: function () {
        }
      }
    };

    opt = $.extend({}, {
      symbols: true,
      stocksOnly: false,
      excludeCrypto: false,
      excludeIndices: false,
      people: false,
      multiple: false,
      pages: true,
      resultsLimit: 10
    }, opt);

    function show() {
      $dropDown.data('expended', true).show();

      if ($.isFunction(opt.onShow)) {
        opt.onShow();
      }
    }

    function hide() {
      $dropDown.hide().data('expended', false).html('');

      if ($.isFunction(opt.onHide)) {
        opt.onHide();
      }
    }

    function active() {
      return $dropDown.find('.active');
    }

    function deactivate() {
      active().removeClass('active');
    }

    function activate($item) {
      deactivate();
      $item.addClass('active');
    }

    function reservedKey(event) {
      return [keyMap.down, keyMap.up, keyMap.enter, keyMap.esc].indexOf(event.keyCode) !== -1;
    }

    function isUserAborted(xhr) {
      return !xhr.getAllResponseHeaders();
    }

    function sendSaveSearch(options) {
      var phrase = options.rawphrase.trim().substring(0, 50);
      if (phrase.length) {
        $.post('/api/common/ac/save_recent_search', {
          phrase: phrase,
          url: options.url || 'NA',
          type: options.type
        }).fail(function (xhr, textStatus, errorThrown) {
          if (!isUserAborted(xhr)) {
            w.console.log('An error has occurred on saving search.');
          }
        });
      }
    }

    function exec(method, slug, e) {
      if ($.isFunction(method)) {
        handleEscClick();
        method(slug, $input, e);
        return true;
      }
      return false;
    }


    function handleSelectedValue(e) {
      var $item = $(e.currentTarget);
      if ($item.length) {
        var type = $item.data('type'),
          slug = $item.data('slug'),
          url = $item.data('url'),
          id = $item.data('id'),
          name = $item.data('name'),
          bi = {source: (type === 'keyword' ? '&s=' : '?s=') + (slug || url || id || name).toString().toLowerCase() + '&source=search'},
          hash = window.location.hash ? window.location.hash.replace(/#/g,"&") : '';

        if ($.inArray(type, ['symbol', 'author']) > -1) {
          SA.Data.Cookies.set('_sasource', 'search', {expires: 120});
        }

        sendSaveSearch({type: type, rawphrase: slug || name, url: url});

        if (type === 'keyword' && !exec(opt.keywordSelect, $item.text().trim(), e)) {
          openSelectedValue('/search?type=keyword&q=' + $item.text().trim() + bi.source, e);
        } else if (type === 'symbol' && !exec(opt.symbolSelectCallback, slug, e)) {
          var symbolPagePath = '';
          if(document.location.pathname.indexOf('/symbol/') == 0){
            var regex = /.*?symbol\/.*?\/([\w\/-]+)/ig,
            regex_result = regex.exec(document.location.pathname);
            if(regex_result && regex_result.length) {
              symbolPagePath = '/' + regex_result[1];
            }
          }
          openSelectedValue('/symbol/' + slug + symbolPagePath + bi.source + hash, e);
        } else if (['page', 'hashtag'].indexOf(type) > -1) {
          openSelectedValue('/' + url + bi.source, e);
        } else if (type === 'people' || type === 'author') {
          if ($.isFunction(opt.authorSelectCallback)) {
            handleEscClick();
            return opt.authorSelectCallback({slug: slug, name: $item.data('name')});
          }
          openSelectedValue((slug ? ('/author/' + slug) : '/user/' + id) + bi.source, e);
        }
      }
    }

    function openSelectedValue(url, e) {
      var openIn = detectSpecialKey(e);
      if (openIn.tab) {
        openIn.event.preventDefault();
        w.open(url, '_blank');
        hide();
      } else if (openIn.window) {
        openIn.event.preventDefault();
        w.open(url);
        hide();
      } else {
        w.location.href = url;
      }
    }

    function detectSpecialKey(e) {
      e = e || {};
      return {
        event: e,
        tab: e.ctrlKey || e.metaKey || e.which === 2,
        window: e.shiftKey
      };
    }

    function setClickEvents() {
      $dropDown.on('click', '.item', handleSelectedValue);
    }

    function generateList(res, val) {
      var content = buildAutoCompleteContent(res, val, opt);
      if (content) {
        $dropDown.html(content);
        activateWhenAlone();
        callback.onBefore.showAutoComplete();
        return show();
      }

      hide();
    }

    function activateWhenAlone() {
      var $menuItems = $('.dropdown-menu .item');
      if ($menuItems.length < 3) {
        activate($menuItems.first());
      } else {
        deactivate();
      }
    }

    function fromAPI(val) {
      SA.Utils.Search.match({
        query: val,
        symbols: opt.symbols,
        stocksOnly: opt.stocksOnly,
        fundsOnly: opt.fundsOnly,
        resultsLimit: opt.resultsLimit,
        excludeCrypto: opt.excludeCrypto,
        excludeIndices: opt.excludeIndices,
        people: opt.people,
        pages: opt.pages,
        research: opt.research
      }, function (res) {
        cache[val] = {ts: Date.now(), res: res};
        generateList(res, val);
      });
    }

    function setRecentSearchEvents() {
      $('input#hd-auto').on('click', function () {
        var $this = $(this);
        if (!$this.val()) {
          if (recentSearches) {
            displayRecentSearches($this);
          } else {
            $.get('/api/common/ac/get_recent_search').done(function (res) {
              recentSearches = buildRecentSearchContent(res);
              displayRecentSearches($this);
            }).fail(function (xhr, textStatus, errorThrown) {
              if (!isUserAborted(xhr)) {
                w.console.log('An error has occurred on loading search.');
              }
            });
          }
        }
      });
    }

    function displayRecentSearches($el) {
      if (recentSearches && recentSearches !== '') {
        $dropDown.html(recentSearches);
        $('#hd-auto_sa_autocomplete').addClass('recent-active');
        $el.siblings('.dropdown-menu').data('expended', true).show();

        if ($.isFunction(opt.onShow)) {
          opt.onShow();
        }
      }
    }

    // Custom keys

    function setOutsideClick() {
      $(w.document).mouseup(function (e) {
        if (!$dropDown.is(e.target) && !$dropDown.has(e.target).length) {
          hide();
        }
      });
    }

    function handleEscClick() {
      if (!opt.multiple) {
        $input.val('').data('value', '');
      }

      hide();
    }

    function activateItem(dir) {
      var $list = $dropDown.find('.item'), len = $list.length, indexArr = $list.map(function (i) {
          if ($($list[i]).hasClass('active')) {
            return i;
          }
        }),
        index = indexArr.length ? indexArr[0] : null,
        $new = dir === 'up' ? $list.eq((index || 0) - 1) : $list.eq(index === null ? 0 - len : index - len + 1);

      activate($new);

      callback.update.value($new);
    }

    // Event listeners

    function setKeyUpEvent() {
      $input.keyup(function (e) {
        if ($.inArray(e.keyCode, [keyMap.up, keyMap.down, keyMap.esc, keyMap.enter]) > -1) {
          return onKeyup(e);
        }
        clearTimeout(typingTimer);
        typingTimer = setTimeout(function () {
          onKeyup(e);
        }, 200);
      });
    }

    function onKeyup(e) {
      var value = $input.val().trim().toLowerCase();
      if (value !== $input.data('value') && !reservedKey(e)) {
        $input.data('value', value);
        callback.update.state();
      }
      handleCustomKey(e);
    }

    function handleCustomKey(e) {
      switch (e.keyCode) {
        case keyMap.esc:
          return handleEscClick();
        case keyMap.down:
          return activateItem('down');
        case keyMap.up:
          return activateItem('up');
        case keyMap.enter:
          isTyping = false;
          if (!active().data()) {
            sendSaveSearch({rawphrase: $input.val().trim()});
          }
          return handleSelectedValue({currentTarget: active()});
        default:
          $('#hd-auto_sa_autocomplete').removeClass('recent-active');
      }
    }

    function setKeyDownEvent() {
      $input.keydown(function (e) {
        if ($.inArray(e.keyCode, [keyMap.up, keyMap.down]) > -1) {
          e.preventDefault();
        } else if (e.keyCode === keyMap.enter) {
          clearTimeout(typingTimer);
          handleSelectedValue({currentTarget: active()});
        } else {
          hide();
        }
      });
    }

    function prepare() {
      $input.data('value', '');

      if ($.isFunction(opt.onBeforeShowAutoComplete)) {
        callback.onBefore.showAutoComplete = opt.onBeforeShowAutoComplete;
      }
    }

    function setFormSubmit() {
      var $parent = $input.parent();
      if ($parent.is('form')) {
        $parent.submit(function (e) {
          if (isTyping) {
            e.preventDefault();
            e.stopPropagation();
          }
        });
      }
    }

    function setEvents() {
      setRecentSearchEvents();
      setOutsideClick();
      setClickEvents();
      setKeyUpEvent();
      setKeyDownEvent();
      setFormSubmit();
    }

    function init() {
      if ($input.attr('id')) {
        $dropDown = $('<span class="dropdown-menu boot_sa_autocomplete" id="' + $input.attr('id') + '_sa_autocomplete' + '" style="position:absolute;display:none;"></span>').insertAfter($input);
        prepare();
        setEvents();
      }
    }

    // Public methods

    this.getMatch = function () {
      return active().data('slug');
    };

    this.fromApi = function(ticker) {
      if (ticker.trim() !== '') {
        return fromAPI(ticker);
      }
    };

    SA.run(init, 'autocomplete-init');

  };

}(window, window.SA, window.jQuery));
(function() { this.JST || (this.JST = {}); this.JST["jst/popups/authentication/main"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('');  if(!displayHeader) { ; __p.push('\n    <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n      <span aria-hidden="true">&times;</span>\n    </button>\n');  } ; __p.push('\n\n<div class="row">\n  <div class="col-xs-3 promo">\n    <h3>',(''+ usersOnSite ).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/'/g, '&#x27;').replace(/\//g,'&#x2F;'),'</h3> people have already joined Seeking Alpha to track analysis of stocks they follow and exchange investment ideas.\n  </div>\n  <div class="col-xs-9 forms">\n    <div class="row">\n    ');  if(headerTitle) { ; __p.push('\n        <div class="col-xs-12"><h3 class="header-title">',(''+ headerTitle ).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/'/g, '&#x27;').replace(/\//g,'&#x2F;'),'</h3></div>\n    ');  } ; __p.push('\n      <div class="col-xs-6 sign-in" id="sign-form">\n          <h3>Join now (it\'s free):</h3>\n          <form id="authentication_register_form">\n            <div class="form-group">\n              <label for="authentication_register_nick">Choose Username</label>\n              <input type="text" class="form-control" id="authentication_register_nick">\n            </div>\n            <div class="form-group">\n              <label for="authentication_register_email">Email Address</label>\n              <input type="email" class="form-control" id="authentication_register_email" autocomplete="email">\n            </div>\n            <div class="form-group sign-pwd-grp">\n              <label for="authentication_register_password">Create Password:</label>\n              <input type="password" class="form-control" id="authentication_register_password" autocomplete="off" placeholder="',  passwordPlaceholder ,'">\n            </div>\n            <div class="form-group checkbox-sa-terms">\n              <input type="checkbox" id="authentication_register_agree_to_terms" checked>\n              <span class="sa-terms">I agree to <a href="/page/terms-of-use" target="_blank">Terms of Use</a> &amp; <a\n                    href="/page/privacy" target="_blank">Privacy Policy</a></span>\n            </div>\n            <div class="btn-grp">\n              <input type="submit" id="sign-btn" class="btn orange-btn" value="Join"/>\n            </div>\n          </form>\n        <div id="sign-error" class="alert alert-danger hidden" role="alert">...</div>\n      </div>\n      <div class="col-xs-6 log-in" id="log-form">\n        <form id="authentication_login_form" autocomplete="on">\n          <h3>Member sign in:</h3>\n          <div class="form-group">\n            <label for="authentication_login_email">Email Address</label>\n            <input type="email" class="form-control" id="authentication_login_email" autocomplete="email">\n          </div>\n          <div class="form-group log-pwd-grp">\n            <label for="authentication_login_password">Password:</label>\n            <input type="password" class="form-control" id="authentication_login_password" autocomplete="off">\n            <a href="#" class="frgt-pwd" id="rst-pwd">Forgot your password?</a>\n          </div>\n\n          <div class="btn-grp">\n            <input type="submit" id="log-btn" class="btn orange-btn pull-left" value="Sign in">\n            <div id="log-google">\n              ',  googleBtn ,'\n            </div>\n            <div class="clearfix"></div>\n            <a href="#" class= "btn otl-login" id="one-time-link">Email me a sign in link</a>\n          </div>\n\n        </form>\n        <form id="forgot-pwd" class="hidden">\n          <h3>Forgot Password:</h3>\n          <div class="form-group">\n            <label for="forgot-pwd-email">Please enter your email address:</label>\n            <input type="email" class="form-control" id="forgot-pwd-email" autocomplete="off"\n                   autocorrect="off" autocapitalize="off" spellcheck="false">\n          </div>\n          <div class="btn-grp">\n            <button type="submit" class="btn orange-btn pull-left">Submit</button>\n            <button type="button" class="btn btn-link cancel pull-right">Cancel</button>\n            <div class="sa-loader hidden"></div>\n            <div class="clearfix"></div>\n          </div>\n        </form>\n        <form id="one-time-login" class="hidden">\n          <h3>Sign in link:</h3>\n          <div class="form-group">\n            <label for="one-time-login-email">Please enter your email address:</label>\n            <input type="email" class="form-control" id="one-time-login-email" autocomplete="off"\n                   autocorrect="off" autocapitalize="off" spellcheck="false">\n          </div>\n          <div class="btn-grp">\n            <button type="submit" class="btn orange-btn pull-left">Submit</button>\n            <button type="button" class="btn btn-link cancel pull-right">Cancel</button>\n            <div class="sa-loader hidden"></div>\n            <div class="clearfix"></div>\n          </div>\n        </form>\n        <div id="log-error" class="alert alert-danger hidden" role="alert">...</div>\n      </div>\n    </div>\n  </div>\n</div>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/popups/authentication/not_confirmed_email_yet"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<p>Please confirm your registration by clicking the link in the email we\'ve sent you.</p>\n<p>We resent the confirmation email to you.</p>\n<p class=\'sub\'>(if you don\'t see it, please check your spam folder)</p>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/popups/authentication/not_confirmed_email_still"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<p>We\'ve sent you an email with a confirmation link which will set up your user. Please click the link and it\'ll log you in automatically.</p>\n<p>If you do not see any emails from \'account@seekingalpha.com\' in your inbox or spam folder, please report your issue on our <a href="',  SA.App.userEchoHost ,'">feedback forum</a>.</p>\n\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/popups/authentication/activated_bounced_user"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<p>This email already exists in our system, but was blocked by your email provider as of ',  date ,', we have attempted to remove the block and sent a password reset email to your inbox.</p>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/popups/authentication/not_activated_bounced_user"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<p>Registration is in progress for this email address. We attempted to remove a block placed by your email provider on ',  date ,'.<p>\n<p>Please check your inbox for a password reset email.</p>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/popups/authentication/not_activated_not_bounced_user"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<p>There is already a registration in progress for this email</p>\n<p>If you did not receive the confirmation email, please ask your IT department or email provider to place seekingalpha.com in the whitelist and try to register again.</p>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/popups/authentication/password_reset"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<p>We have sent you instructions on how to get a new password.</p>\n<p>Still not getting it?</p>\n<p>Please report your issue on our <a href="',  SA.App.userEchoHost ,'">feedback forum</a></p>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/inline_svg/google"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<svg width="',  width ,'" height="',  width ,'" viewBox="0 0 46 46" version="1.1" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">\n  <title>Google login</title>\n  <defs>\n    <filter x="-50%" y="-50%" width="200%" height="200%" filterUnits="objectBoundingBox" id="filter-1">\n      <feOffset dx="0" dy="1" in="SourceAlpha" result="shadowOffsetOuter1"></feOffset>\n      <feGaussianBlur stdDeviation="0.5" in="shadowOffsetOuter1" result="shadowBlurOuter1"></feGaussianBlur>\n      <feColorMatrix values="0 0 0 0 0   0 0 0 0 0   0 0 0 0 0  0 0 0 ',  withBorder ? 0.3 : 0 ,' 0" in="shadowBlurOuter1" type="matrix" result="shadowMatrixOuter1"></feColorMatrix>\n      <feOffset dx="0" dy="0" in="SourceAlpha" result="shadowOffsetOuter2"></feOffset>\n      <feGaussianBlur stdDeviation="0.5" in="shadowOffsetOuter2" result="shadowBlurOuter2"></feGaussianBlur>\n      <feColorMatrix values="0 0 0 0 0   0 0 0 0 0   0 0 0 0 0  0 0 0 ',  withBorder ? 0.3 : 0 ,' 0" in="shadowBlurOuter2" type="matrix" result="shadowMatrixOuter2"></feColorMatrix>\n      <feMerge>\n        <feMergeNode in="shadowMatrixOuter1"></feMergeNode>\n        <feMergeNode in="shadowMatrixOuter2"></feMergeNode>\n        <feMergeNode in="SourceGraphic"></feMergeNode>\n      </feMerge>\n    </filter>\n    <rect id="path-2" x="0" y="0" width="40" height="40" rx="2"></rect>\n  </defs>\n  <g id="Google-Button" stroke="none" stroke-width="none" fill="none" fill-rule="evenodd" sketch:type="MSPage">\n    <g id="9-PATCH" sketch:type="MSArtboardGroup" transform="translate(-608.000000, -160.000000)"></g>\n    <g id="btn_google_light_normal" sketch:type="MSArtboardGroup" transform="translate(-1.000000, -1.000000)">\n      <g id="button" sketch:type="MSLayerGroup" transform="translate(4.000000, 4.000000)" filter="url(#filter-1)">\n        <g id="button-bg">\n          <use fill="#FFFFFF" fill-rule="evenodd" sketch:type="MSShapeGroup" xlink:href="#path-2"></use>\n          <use fill="none" xlink:href="#path-2"></use>\n          <use fill="none" xlink:href="#path-2"></use>\n          <use fill="none" xlink:href="#path-2"></use>\n        </g>\n      </g>\n      <g id="logo_googleg_48dp" sketch:type="MSLayerGroup" transform="translate(15.000000, 15.000000)">\n        <path d="M17.64,9.20454545 C17.64,8.56636364 17.5827273,7.95272727 17.4763636,7.36363636 L9,7.36363636 L9,10.845 L13.8436364,10.845 C13.635,11.97 13.0009091,12.9231818 12.0477273,13.5613636 L12.0477273,15.8195455 L14.9563636,15.8195455 C16.6581818,14.2527273 17.64,11.9454545 17.64,9.20454545 L17.64,9.20454545 Z" id="Shape" fill="#4285F4" sketch:type="MSShapeGroup"></path>\n        <path d="M9,18 C11.43,18 13.4672727,17.1940909 14.9563636,15.8195455 L12.0477273,13.5613636 C11.2418182,14.1013636 10.2109091,14.4204545 9,14.4204545 C6.65590909,14.4204545 4.67181818,12.8372727 3.96409091,10.71 L0.957272727,10.71 L0.957272727,13.0418182 C2.43818182,15.9831818 5.48181818,18 9,18 L9,18 Z" id="Shape" fill="#34A853" sketch:type="MSShapeGroup"></path>\n        <path d="M3.96409091,10.71 C3.78409091,10.17 3.68181818,9.59318182 3.68181818,9 C3.68181818,8.40681818 3.78409091,7.83 3.96409091,7.29 L3.96409091,4.95818182 L0.957272727,4.95818182 C0.347727273,6.17318182 0,7.54772727 0,9 C0,10.4522727 0.347727273,11.8268182 0.957272727,13.0418182 L3.96409091,10.71 L3.96409091,10.71 Z" id="Shape" fill="#FBBC05" sketch:type="MSShapeGroup"></path>\n        <path d="M9,3.57954545 C10.3213636,3.57954545 11.5077273,4.03363636 12.4404545,4.92545455 L15.0218182,2.34409091 C13.4631818,0.891818182 11.4259091,0 9,0 C5.48181818,0 2.43818182,2.01681818 0.957272727,4.95818182 L3.96409091,7.29 C4.67181818,5.16272727 6.65590909,3.57954545 9,3.57954545 L9,3.57954545 Z" id="Shape" fill="#EA4335" sketch:type="MSShapeGroup"></path>\n        <path d="M0,0 L18,0 L18,18 L0,18 L0,0 Z" id="Shape" sketch:type="MSShapeGroup"></path>\n      </g>\n      <g id="handles_square" sketch:type="MSLayerGroup"></g>\n    </g>\n  </g>\n</svg>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/button/google_btn"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div class="google-btn-wrapper">\n  ',  googleSvg ,'\n  <span class="google-text">Sign in with Google</span>\n</div>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/popups/authentication/one_time_login"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<p>We have sent an email to ',  email,' with a temporary sign in link. This link will expire in 60 minutes. </p>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/popups/authentication/registration_success_body"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<p>A confirmation email has been sent to: <strong>',  email ,'</strong></p>\n<p class="sub">(if you don\'t see it, please check your spam folder)</p>\n<p class="b-btm">Please confirm your registration and enjoy Seeking Alpha</p>\n<p>After Confirming registration, please <a href="#" id="login-btn">log in</a></p>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/popups/authentication/registration_success_footer"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<p class="f-txt">Still not getting the email? <a href="#" id="expand-email">click here</a></p>\n<div class="well hidden">\n  <p>If your email is taking too long (more than 3 minutes), please check your spam folder.</p>\n  <p>Please <a href="#" id="resend-email-btn">click here</a> to send again.</p>\n  <p class="b-btm">Still not getting it?</p>\n  <p>Please report your issue on our <a href="',  SA.App.userEchoHost ,'">feedback forum</a></p>\n</div>\n');}return __p.join('');};
}).call(this);
// To trigger popup publish event to 'registration/success-popup' channel with opt.email SA.Utils.Observer.publish('registration/success-popup', {email:'alex'});




(function(window, SA, $){

  "use strict";

  var articlePage = window.aConf && window.aConf.pagination.page;

  var getDefaultOpt = function() {
    return {
      email: null,
      backdrop: true,
      keyboard: true,
      showCloseBtn: true,
      fromRoadblock: false,
      headerContent: '<h4>Thank you for registering!</h4>',
      source: 'regular_roadblock'
    };
  };

  var getBodyTemplate = function(opt) {
    return JST['jst/popups/authentication/registration_success_body']({
      email: opt.email
    });
  };

  var getFooterTemplate = function() {
    return JST['jst/popups/authentication/registration_success_footer']();
  };

  var onSuccess = function(response) {
    if(response.email_sent) {
      $('#resend-email-btn').unbind('click');
      return window.alert('We have sent you a second confirmation email');
    }
    if(response.error) {
      $('#resend-email-btn').unbind('click');
      return window.alert('There was an error sending confirmation email. Try again later');
    }
  };

  var handleEmailResend = function(opt) {
    SA.Models.Authentication.resendConfirmation({
      email: opt.email,
      onSuccess: onSuccess,
      onFailure: function() {}
    });
    if(opt.fromRoadblock){
      SA.Logger.Mone.event('roadblock', 'article_register_thank_you_reg', 'send_again', {data: {email: opt.email}});
    } else {
      SA.Logger.Mone.event('registration','confirmation','send_again');
    }
  };

  var setModalEvents = function(modal, opt) {
    var $modal = modal.getModalObject();

    if(opt.fromRoadblock){
      $modal.find('#login-btn').on('click', function() {
        modal.hide();
        SA.Logger.Mone.event('roadblock', 'article_register_thank_you_reg', 'clicked_login', {data: {email: opt.email}});
        location.href = SA.App.host + '/account/login?source=roadblock_article_confirmed';
      });
    } else {
      $modal.find('#login-btn').on('click', function(e) {
        e.preventDefault();
        modal.hide();
        SA.Widgets.AuthenticationPopup.show();
        SA.Logger.Mone.event('registration','confirmation','log_in');
      });
    }

    $modal.find('#expand-email').on('click', function(e) {
      e.preventDefault();
      $(this).closest('.f-txt').hide().closest('.modal-footer').find('.well').removeClass('hidden');
      if(opt.fromRoadblock){
        SA.Logger.Mone.event('roadblock', 'article_register_thank_you_reg', 'not_received', {data: {email: opt.email}});
      } else {
        SA.Logger.Mone.event('registration','confirmation','not-getting');
      }
    });

    $modal.find('#resend-email-btn').on('click', function(e) {
      e.preventDefault();
      handleEmailResend(opt);
    });
  };

  var showModal = function(opt) {
    var modal = SA.Widgets.Popup.build({
      className: 'sa-reg-success',
      backdrop: opt.backdrop,
      keyboard: opt.keyboard,
      showHeader: true,
      headerContent: opt.headerContent,
      showCloseBtn: opt.showCloseBtn,
      showBody: true,
      bodyContent: getBodyTemplate(opt),
      showFooter: true,
      footerContent: getFooterTemplate(),
      removeAfterClose: true
    });

    setModalEvents(modal, opt);

    modal.show();

    if(opt.fromRoadblock){
      var biData = articlePage ? {email: opt.email, page: articlePage} : {email: opt.email};

      SA.Logger.Mone.event('funnel_complete_popup', opt.source, 'email_signup', {data: biData});
    }
  };

  var subscriptionCallback = function(e, opt) {
    opt = opt || {};
    var options = $.extend({}, getDefaultOpt(), opt);
    if(options.email) {
      return showModal(options);
    }
  };

  var initialize = function() {
    if(!SA.Data.User.loggedIn()) {
      SA.Utils.Observer.subscribe('registration/success-popup', subscriptionCallback);
    }
  };

  SA.run(initialize, 'conf-reg-popup');

}(window, SA, jQuery));


(function(){

  "use strict";

  var scope = SA.UsingNamespace('SA.Utils.AuthenticationHelpers');


  // HELPERS

  scope.addLoader = function(btn) {
    btn.addClass('sa-animated');
  };

  scope.removeLoader = function(btn) {
    btn.removeClass('sa-animated');
  };

  scope.markWithError = function(input, errorContainer, error) {
    input.closest('.form-group').removeClass('has-success').addClass('has-error');
    if(error) {
      scope.showError(errorContainer, error);
      input.focus();
    }
  };

  scope.markWithSuccess = function(input, errorContainer) {
    input.closest('.form-group').removeClass('has-error').addClass('has-success');
    errorContainer.empty();
  };

  scope.showError = function(errorContainer, text) {
    if(errorContainer.html() !== text) {
      errorContainer.removeClass('hidden').html(text);
    }
  };

  scope.hideErrors = function(errorContainer) {
    errorContainer.addClass('hidden').empty();
  };

  scope.errorPopup = function(message, header, modal) {
    if(modal) modal.hide();
    return SA.Widgets.Popup.build({
      className: 'sa-auth-error',
      backdrop: true,
      keyboard: true,
      showHeader: true,
      headerContent: '<h4>' + header + '</h4>',
      showCloseBtn: true,
      showBody: true,
      bodyContent: message,
      showFooter: false,
      removeAfterClose: true
    }).show();
  };

  scope.rbErrorPopup = function(message, header, modal){
    if(modal) modal.hide();
    return SA.Widgets.Popup.build({
      className: 'sa-auth-error',
      showHeader: true,
      showCloseBtn: false,
      backdrop: false,
      keyboard: false,
      headerContent: '<h4>' + header + '</h4>',
      showBody: true,
      bodyContent: message,
      showFooter: false,
      removeAfterClose: true
    }).show();
  };

  scope.errorPopup = function(message, header, modal){
    if(modal) modal.hide();
    return SA.Widgets.Popup.build({
      className: 'sa-auth-error',
      showHeader: true,
      showCloseBtn: true,
      backdrop: false,
      keyboard: true,
      showBody: true,
      bodyContent: message,
      headerContent: '',
      showFooter: false,
      removeAfterClose: true
    }).show();
  };


  // VALIDATORS

  scope.validate = function(rule, input, errorContainer, error) {
    if(rule) {
      scope.markWithSuccess(input, errorContainer);
      return true;
    }

    scope.markWithError(input, errorContainer, error);
    return false;
  };

  scope.validatePresence = function(input, errorContainer, error) {
    return scope.validate(SA.Utils.Validate.required(input), input, errorContainer, error);
  };

  scope.validateNick = function(input, errorContainer, error) {
    var inputVal = input.val().trim();
    return scope.validate(SA.Utils.Validate.isUserNick(inputVal), input, errorContainer, error);
  };

  scope.validateEmailValue = function(input, errorContainer, error) {
    return scope.validate(SA.Utils.Validate.email(input.val().trim()), input, errorContainer, error);
  };

  scope.validateEmail = function(input, errorContainer, error) {
    return scope.validatePresence(input, errorContainer, error) && scope.validateEmailValue(input, errorContainer, error);
  };

  scope.validateSignInPasswordValue = function(input, errorContainer, error) {
    return scope.validate(SA.Utils.Validate.between(input.val(), 8, 40), input, errorContainer, error);
  };

  scope.validateSignInPasswordValueOld = function(input, errorContainer, error) {
    return scope.validate(SA.Utils.Validate.between(input.val(), 4, 40), input, errorContainer, error);
  };

  scope.validateSignInPassword = function(input, errorContainer, error) {
    return scope.validatePresence(input, errorContainer, error) && scope.validateSignInPasswordValue(input, errorContainer, error);
  };

  scope.validateTerms = function(input, errorContainer, error) {
    return scope.validate(input.prop('checked'), input, errorContainer, error);
  };

  scope.validateMinTickers = function(input, errorContainer, error) {
    var missingTickers = 0;
    $.map(input, function(i){
      return scope.validatePresence($(i),errorContainer , error) || missingTickers++
    });
    return missingTickers === 0;
  };


}());













(function(SA, $){

  "use strict";

  var scope = SA.UsingNamespace('SA.Widgets.AuthenticationPopup'),
      signInLock = false, loginLock = false, resetLock = false, options, modal;
  var helpers = SA.Utils.AuthenticationHelpers;

  var getError = function(error) {
    if (/^SA users/.test(error)) return error; // Whitelist some errors

    var errors = {
      defaultMessage: 'There was an error. Please try again later',
      emailNotValid: 'Please enter a valid email address.',
      passwordNotValid: 'Please enter your password.',
      passwordNotValidFormat: 'Minimum 8 characters',
      nickNotValid: 'Please enter a username.',
      termsNotValid: 'Terms must be agreed in order to confirm registration.',
      login_failed: 'Please check your email and password and try again.',
      blocked_user: 'Login failed, please report your issue on our <a href='+SA.App.userEchoHost+'>feedback forum</a>',
      no_user: 'Please check your email and try again.',
      too_many_attempts: 'Too many login attempts have been made with an incorrect password. Please press <a class="forgot-pwd-link">Forgot your password</a>? to reset your password',
      missing_user_details: 'Please check your email and password and try again.',
      missing_nick: 'Please enter a username.',
      already_registered: 'You are already registered, please try the Member sign in.',
      relevant_link: "You can request one sign in link per hour. Please recheck your email.",
    };

    if (errors[error]) return errors[error];
    if (/^(Nick|Username)/.test(error)) return error;
    return errors.defaultMessage;
  };

  //Google login

  var loginWithGoogle = function() {
    SA.Models.Authentication.googleLogin('registration', 'headtabs_gplus_button');
  };

  // CALLBACKS
  //Password Reset

  var beforePwdReset = function($modal) {
    resetLock = true;
    helpers.hideErrors($modal.find('#log-error'));
    $modal.find('#forgot-pwd').find('.sa-loader').removeClass('hidden');
  };

  var afterPwdReset = function() {
    resetLock = false;
    modal.getModalObject().find('#forgot-pwd').find('.sa-loader').addClass('hidden');
  };

  var resetPwdClck = function($modal) {
    $modal.find('#authentication_login_form').toggleClass('hidden');
    $modal.find('#forgot-pwd').toggleClass('hidden');
    $modal.find('.alert').addClass('hidden');
    $modal.find('.has-error').removeClass('has-error');
  };

  var resetPwdCancelClck = function($modal) {
    $modal.find('#authentication_login_form').toggleClass('hidden');
    $modal.find('#forgot-pwd').toggleClass('hidden');
    $modal.find('.alert').addClass('hidden');
    $modal.find('.has-error').removeClass('has-error');
  };

  var handleResetFailure = function(response) {
    var errorContainer = modal.getModalObject().find('#log-error');
    $('.has-success').removeClass('has-success');

    switch(response.message) {
      case 'not_confirmed_email_yet':
        return helpers.errorPopup(JST['jst/popups/authentication/not_confirmed_email_yet'](), 'Confirm your registration', modal);
      case 'not_confirmed_email_still':
        return helpers.errorPopup(JST['jst/popups/authentication/not_confirmed_email_still'](), 'Confirm your registration', modal);
      default:
        return helpers.showError(errorContainer, getError(response.message));
    }
  };

  var handleResetSuccess = function() {
    SA.Logger.Mone.event('forgotpass_login_sent');
    helpers.errorPopup(JST['jst/popups/authentication/password_reset'](), 'Password reset', modal);
  };

  var onResetSuccess = function(response) {
    response = response || {};
    afterPwdReset();

    return response.forgot_password ? handleResetSuccess() : handleResetFailure(response);
  };

  var onResetFailure = function() {
    afterPwdReset();
  };

  var handleForgotPassword = function($modal) {
    if(resetLock) {
      return false;
    }

    var $emailInput = $modal.find('#forgot-pwd-email'),
        $loginFormError = $modal.find('#log-error');

    if (helpers.validateEmail($emailInput, $loginFormError , getError('emailNotValid'))) {

      beforePwdReset($modal);

      SA.Models.Authentication.resetPassword({
        id: options.id,
        activity: options.activity,
        'function': options.resetSuccess,
        email: $emailInput.val().trim(),
        onSuccess: onResetSuccess,
        onFailure: onResetFailure
      });
    }

  };

  // SignIn

  var oneTimeLoginClick = function($modal) {
    $modal.find('#authentication_login_form').toggleClass('hidden');
    $modal.find('#one-time-login').toggleClass('hidden');
    $modal.find('.alert').addClass('hidden');
    $modal.find('.has-error').removeClass('has-error');
  };

  var handleOneTimeLoginFailure = function(response) {
    var errorContainer = modal.getModalObject().find('#log-error');
    $('.has-success').removeClass('has-success');
    if (['not_confirmed_email_yet', 'not_confirmed_email_still'].includes(response.message)) {
      return helpers.errorPopup(JST['jst/popups/authentication/' + response.message ](), 'Confirm your registration', modal);
    } else {
      SA.Logger.Mone.event('','Sign_in', 'one_time_login_link_error', {data: {error_message: response.message}});
      return helpers.showError(errorContainer, getError(response.message));
    }
  };

  var handleOneTimeLoginSuccess = function(email) {
    SA.Logger.Mone.event('Sign_in','one_time_login_link_sent');
    helpers.errorPopup(JST['jst/popups/authentication/one_time_login']({email: email}), 'One Time Login', modal);
  };

  var onOneTimeLoginSuccess = function(response) {
    resetLock = false;
    modal.getModalObject().find('#one-time-login').find('.sa-loader').addClass('hidden');
    return response.login_link ? handleOneTimeLoginSuccess(response.email) : handleOneTimeLoginFailure(response);
  };

  var submitOneTimeLogin = function($modal) {
    if(resetLock) {
      return false;
    }

    var $emailInput = $modal.find('#one-time-login-email'),
        $loginFormError = $modal.find('#log-error');

    if (helpers.validateEmail($emailInput, $loginFormError , getError('emailNotValid'))) {

      resetLock = true;
      helpers.hideErrors($loginFormError);
      $modal.find('#one-time-login').find('.sa-loader').removeClass('hidden');

      SA.Models.Authentication.oneClickLogin({
        id: options.id,
        activity: options.activity,
        'function': options.oneTimeClickSuccsess,
        email: $emailInput.val().trim(),
        onSuccess: onOneTimeLoginSuccess,
        onFailure: handleOneTimeLoginFailure
      });
    }

  };

  var onBeforeSignIn = function($modal) {
    signInLock = true;
    helpers.hideErrors($modal.find('#sign-error'));
    helpers.addLoader($modal.find('#sign-btn'));
  };

  var onAfterSignIn = function() {
    signInLock = false;
    helpers.removeLoader(modal.getModalObject().find('#sign-btn'));
  };

  var onSignInFailure = function() {
    onAfterSignIn();
  };

  var handleSignInFailure = function(response) {
    var errorContainer = modal.getModalObject().find('#sign-error');
    $('.has-success').removeClass('has-success');
    switch(response.message) {
      case 'not_confirmed_email_yet':
        return helpers.errorPopup(JST['jst/popups/authentication/not_confirmed_email_yet'](), 'Confirm your registration', modal);
      case 'not_confirmed_email_still':
        return helpers.errorPopup(JST['jst/popups/authentication/not_confirmed_email_still'](), 'Confirm your registration', modal);
      case 'activated_bounced_user':
        return helpers.errorPopup(JST['jst/popups/authentication/activated_bounced_user']({date: response.date}), 'This email already exists', modal);
      case 'not_activated_bounced_user':
        return helpers.errorPopup(JST['jst/popups/authentication/not_activated_bounced_user']({date: response.date}), 'Registration in progress', modal);
      case 'not_activated_not_bounced_user':
        return helpers.errorPopup(JST['jst/popups/authentication/not_activated_not_bounced_user'](), 'Registration in progress', modal);
      default:
        return helpers.showError(errorContainer, getError(response.message));
    }
  };

  var handleSignInSuccess = function(response, opt) {
    if($.isFunction(opt.onSignInSuccess)) {
      return opt.onSignInSuccess(response, opt, modal);
    }
    modal.hide();
    SA.Utils.Observer.publish('registration/success-popup', {email:opt.email});
  };

  var onSignInSuccess = function(response, opt) {
    response = response || {};
    onAfterSignIn();
    return response.registration ? handleSignInSuccess(response, opt) : handleSignInFailure(response, opt);
  };

  var tryToSignIn = function($modal) {
    if(signInLock) {
      return;
    }

    var $nickInput = $modal.find('#authentication_register_nick'),
        $emailInput = $modal.find('#authentication_register_email'),
        $passwordInput = $modal.find('#authentication_register_password'),
        $termsInput = $modal.find('#authentication_register_agree_to_terms'),
        $signInFormError = $modal.find('#sign-error'),
        $errorContainer = $modal.find('#log-error');

    if (helpers.validatePresence($nickInput, $signInFormError, getError('nickNotValid'))
      && helpers.validateEmail($emailInput, $signInFormError, getError('emailNotValid'))
      && helpers.validateSignInPassword($passwordInput, $signInFormError, getError('passwordNotValidFormat'))
      && helpers.validateTerms($termsInput, $signInFormError, getError('termsNotValid'))) {

      onBeforeSignIn($modal);

      SA.Models.Authentication.signIn({
        id: options.id,
        activity: options.activity,
        articleId: options.articleId,
        'function': options.signInSuccess,
        email: $emailInput.val().trim(),
        password: $passwordInput.val(),
        nick: $nickInput.val().trim(),
        onSuccess: onSignInSuccess,
        onFailure: onSignInFailure,
        rt: options.rt,
        urlHash: options.urlHash,
        rtaSlugs: options.rtaSlugs,
        // back compatibility
        moneAction: options.moneSignInAction,
        extra: options.extra
      });

    }
  };

  var setSignInEvents = function($modal) {
    $modal.find('#authentication_register_form').on('submit', function(event){
      event.preventDefault();
      $modal.find('#forgot-pwd').addClass('hidden');
      tryToSignIn($modal);
    });
  };


  // LogIn

  var onBeforeLogin = function($modal) {
    loginLock = true;
    helpers.hideErrors($modal.find('#log-error'));
    helpers.addLoader($modal.find('#log-btn'));
  };

  var onAfterLogin = function() {
    loginLock = false;
    helpers.removeLoader(modal.getModalObject().find('#log-btn'));
  };

  var handleLogInSuccess = function(response, opt) {
    if (opt.moneAction) {
      SA.Logger.Mone.event('log_reg_' + opt.moneAction + '_logged');
    }
    if ($.isFunction(opt.onLoginSuccess)) {
      return opt.onLoginSuccess(response, opt, modal);
    }

    if (opt.rt) {
      location.href = opt.rt;
    } else {
      if (opt.urlHash) {
        location.hash = opt.urlHash;
      }
      location.reload();
    }
  };

  var handleLogInFailure = function(response) {
    onAfterLogin();

    var errorContainer = modal.getModalObject().find('#log-error');
    $('.has-success').removeClass('has-success');
    switch(response.message) {
      case 'not_confirmed_email_yet':
        return helpers.errorPopup(JST['jst/popups/authentication/not_confirmed_email_yet'](), 'Confirm your registration', modal);
      case 'not_confirmed_email_still':
        return helpers.errorPopup(JST['jst/popups/authentication/not_confirmed_email_still'](), 'Confirm your registration', modal);
      case 'too_many_attempts':
        loginLock = false;
        return helpers.showError(errorContainer, getError('too_many_attempts'));
      default:
        return helpers.showError(errorContainer, getError(response.message));
    }
  };

  var onLogInSuccess = function(response, opt) {
    response = response || {};
    return response.login ? handleLogInSuccess(response, opt) : handleLogInFailure(response, opt);
  };

  var onLogInFailure = function() {
    onAfterLogin();
  };

  var tryToLogIn = function($modal) {
    if(loginLock) {
      return;
    }

    var emailInput = $modal.find('#authentication_login_email'),
        passwordInput = $modal.find('#authentication_login_password'),
        loginFormError = $modal.find('#log-error');

    if (helpers.validateEmail(emailInput, loginFormError, getError('emailNotValid')) && helpers.validatePresence(passwordInput, loginFormError, getError('passwordNotValid'))) {

      onBeforeLogin($modal);
      SA.Models.Authentication.logIn({
        id: options.id,
        articleId: options.articleId,
        activity: options.activity,
        'function': options.loginSuccess,
        email: emailInput.val().trim(),
        password: passwordInput.val(),
        onSuccess: onLogInSuccess,
        onFailure: onLogInFailure,
        rt: options.rt,
        urlHash: options.urlHash,
        rtaSlugs: options.rtaSlugs,
        onLoginSuccess: options.onLoginSuccess,
        // back compatibility
        moneAction: options.moneLoginAction,
        extra: options.extra
      });
    }
  };

  var setLogInEvents = function($modal) {
    var logInForm = $modal.find('#authentication_login_form');

    logInForm.on('submit', function(event){
      event.preventDefault();
      $modal.find('#forgot-pwd').addClass('hidden');
      tryToLogIn($modal);
    });

    logInForm.find('#rst-pwd').on('click', function(event){
      event.preventDefault();
      resetPwdClck($modal);
    });

    logInForm.find('#one-time-link').on('click', function(event){
      event.preventDefault();
      SA.Logger.Mone.event('Sign_in','click_one_time_link_popup');
      oneTimeLoginClick($modal);
    });

    logInForm.find('#log-google').on('click', function(event){
      event.preventDefault();
      loginWithGoogle();
    });

    $modal.find('#forgot-pwd').on('submit', function(event){
      event.preventDefault();
      handleForgotPassword($modal);
    }).on('click', '.cancel', function(event){
      event.preventDefault();
      resetPwdCancelClck($modal);
    });

    $modal.find('#one-time-login').on('submit', function(event){
      event.preventDefault();
      submitOneTimeLogin($modal);
    }).on('click', '.cancel', function(event){
      event.preventDefault();
      if (event.cancelable) { SA.Logger.Mone.event('Sign_in','one_time_login_link_cancel') }
      oneTimeLoginClick($modal);
    });

    $modal.find('#log-error').on('click', '.forgot-pwd-link', function(event){
      event.preventDefault();
      resetPwdClck($modal);
    });

    $modal.find('#log-error').on('click', '.one-time-login-email', function(event){
      event.preventDefault();
      oneTimeLoginClick($modal);
    });
  };

  // Event listener

  var setEventListeners = function(modal) {
    var $modal = modal.getModalObject();
    setSignInEvents($modal);
    setLogInEvents($modal);
  };

  // Popup builders

  function buildAuthModal() {
    return SA.Widgets.Popup.build({
      className: 'sa-auth',
      backdrop: true,
      keyboard: true,
      showHeader: options.header,
      headerContent: options.header ? ('<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4>' + options.headerContent +'</h4>') : '',
      showCloseBtn: false,
      showBody: true,
      bodyContent: JST['jst/popups/authentication/main'](
        {
          usersOnSite: SA.App.usersOnSite,
          displayHeader: options.header,
          headerTitle: options.headerTitle,
          passwordPlaceholder: options.placeholder,
          googleBtn: window.JST['jst/widgets/button/google_btn'](
            {
              googleSvg: window.JST['jst/inline_svg/google']({ width: 32, withBorder: false })
            })
        }),
      showFooter: false,
      removeAfterClose: true
    });
  }

  var showAuthPopup = function() {
    modal = buildAuthModal();
    setEventListeners(modal);
    modal.show();
  };


  // PUBLIC METHODS

  /* List of options

  opt.force - show popup even if user loggedIn (bool)
  opt.header - show extra header - default popup has no header (bool)
  opt.headerContent - content for header if opt.header === true

  callbacks:

  opt.onLoginSuccess - executed after successful login (not performing reload) - params: response, opt, modal

  opt.onSignInSuccess - executed after successful registration (prevent showing confirmation popup and modal hide) - params: response, opt, modal
  */
  scope.show = function(opt) {
    options = $.extend({}, {
      id: 'headtabs_login',
      activity: 'footer_login',
      moneLoginAction: 'login',
      moneSignInAction: 'Registered',
      loginSuccess: 'onLoginSuccess',
      signInSuccess: 'onSignInSuccess',
      resetSuccess: 'onResetSuccess',
      oneTimeClickSuccsess: 'onOneTimeLoginSuccess',
      onSignInSuccess: null,
      placeholder: 'Choose Password (minimum 8 characters)',
      header: false,
      articleId: SA.pageConfig.Data.article && SA.pageConfig.Data.article.id,
      extra: {}
    }, opt || {});

    if(!SA.Data.User.loggedIn() || options.force) {
      showAuthPopup();
    }
  };



}(SA, jQuery));

(function() { this.JST || (this.JST = {}); this.JST["jst/header/back_to_mobile_web"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<style>#sa-b-mob {display:none;margin:0;background-color:#f8f8f8;text-align:center;font-size:60px;padding:44px 0;color:#024999;border-bottom:1px solid #024999;cursor:pointer;}</style>\n<div id="sa-b-mob" class="container-fluid alert alert-warning alert-dismissible" role="alert"><div class="container">RETURN TO MOBILE VERSION</div></div>\n');}return __p.join('');};
}).call(this);

(function(w, SA, $) {

  'use strict';

  var cStore = SA.Data.Cookies, $c, cName = 'show_desktop';

  var getContent = function() {
    var $m = $(JST['jst/header/back_to_mobile_web']());
    return $m.on('click', function() {
      cStore.expire(cName);
      w.location.reload();
    });
  };

  var init = function () {
    if(cStore.get(cName)) {
      $c = getContent();
      $('#page_content_wrapper').prepend($c);
      $c.fadeIn();
    }
  };

  init();

}(window, window.SA, window.jQuery));
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/trading_alerts/ad_signup_success"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div>\n  <span class="ta-ad-success-icon">\n    <svg version=\'1.1\' x=\'0\' y=\'0\' width="30" height="30" viewBox="0 0 30 30">\n      <circle cx="14.761" cy="15.114" fill="none" r="13.761" stroke="#57BA5F" stroke-miterlimit="10" stroke-width="1.7336"></circle>\n      <polyline fill="none" points="9.583,16.165 12.548,20.431 19.939,9.799" stroke="#54B960" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-width="1.7336"></polyline>\n    </svg>\n  </span>\n  <span class=\'ta-ad-text\'>',  text ,'</span>\n  <span class="ta-ad-undo js-alerts-add-undo">\n    Undo\n  </span>\n  <a class="ta-ad-more" href="/account/edit_stocks?show_advanced=true">\n    Advanced settings &raquo;\n  </a>\n  <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n    <span aria-hidden="true"></span>\n  </button>\n</div>\n');}return __p.join('');};
}).call(this);

(function(){

  "use strict";

  var scope = SA.UsingNamespace('SA.Widgets.TradingAlertsAd'),
    $popup,
    newPortfolioId,
    constSymbols,
    moneSource,
    portfolioCreatedInSession,
    adType;

  var replaceSignupBarWithSuccessMsg = function(directSuccess) {
    var suffix = 'Fidelity Real-Time Analytics alerts';
    var text;
    if (directSuccess) {
      text = 'Successfully added ' + suffix;
      showSuccessPopup(text);
    } else {
      text = 'Successfully created portfolio with ' + suffix;
      var successBar = JST['jst/widgets/trading_alerts/ad_signup_success']({ text: text });
      var $successBar = $(successBar);
      $popup.removeClass('create-portfolio').addClass('ta-ad-success');
      $('.modal-dialog').addClass('long');
      $popup.find('.modal-header').remove();
      $popup.find('.modal-footer').remove();
      $popup.find('.modal-body').html(successBar);
      afterOpenSuccessPopup();
    }
  };

  var undoAddAlerts = function() {
    var onSuccess = function(res) {
      $popup.modal('hide');
      portfolioCreatedInSession = res.has_portfolio;
      newPortfolioId = null;
    };
    SA.Models.TradingAlert.unsubscribe(onSuccess, {portfolio_id: newPortfolioId, symbols: constSymbols});
  };

  var addAlerts = function() {
    if (SA.Data.User.loggedIn()) {
      if (SA.Data.User.hasPortfolio() || portfolioCreatedInSession) {
        var onSuccess = function(res) {
          replaceSignupBarWithSuccessMsg(true);
          fireClickedMoneEvent();
        };
        SA.Models.TradingAlert.subscribe(onSuccess, {symbols: constSymbols});
      } else {
        if (constSymbols) {
          var onSuccess = function(res) {
            newPortfolioId = res.new_portfolio_id;
            portfolioCreatedInSession = true;
            replaceSignupBarWithSuccessMsg(true);
            fireClickedMoneEvent();
          };
          SA.Models.TradingAlert.subscribe(onSuccess, {symbols: constSymbols});
        } else {
          showSelectSymbolsPopup();
        }
      }
    } else {
      SA.Widgets.AuthenticationPopup.show();
    }
  };

  var fireClickedMoneEvent = function() {
    SA.Logger.Mone.event('fidelity_alerts_on_portfolio', moneSource, 'clicked');
  };

  var createActionEvents = function() {
    var $alertsActionBtn = $popup.find('.ta-ad-action');
    var $alertsActionTxt = $popup.find('.ta-ad-symbols-picker');
    $alertsActionBtn.on('click', function() {
      var symbols = $alertsActionTxt.val();
      if (symbols) {
        var onSuccess = function(res) {
          newPortfolioId = res.new_portfolio_id;
          portfolioCreatedInSession = true;
          replaceSignupBarWithSuccessMsg(false);
          fireClickedMoneEvent();
        };
        var opt = { symbols: symbols };
        SA.Models.TradingAlert.subscribe(onSuccess, opt);
      } else {
        $alertsActionTxt.focus();
      }
    });
  };

  var addAutocomplete = function() {
    var $el = $('#alerts-autocomplete');
    new SA.Utils.Autocomplete($el, {
      symbols: true,
      multiple: true,
      symbolSelectCallback: function(symbol) {
        var addedSymbolsTxt = $el.val().trim();
        var addedSymbols = (addedSymbolsTxt == '') ? [] : addedSymbolsTxt.split(/[\s,]+/);
        addedSymbols.pop();
        addedSymbols.push(symbol);
        var uniqueSymbols = $.unique(addedSymbols);
        $el.val(uniqueSymbols.join(', ') + ', ').focus();
      }
    });
  };

  var showSuccessPopup = function(text) {
    var opt = {
      bodyContent: JST['jst/widgets/trading_alerts/ad_signup_success']({ text: text }),
      showHeader: false,
      backdrop: true,
      removeAfterClose: true,
      afterOpen: afterOpenSuccessPopup,
      className: 'ta-ad-trading-alert-popup ta-ad-success',
      fade: '',
      afterClose: afterClose
    };
    var popup = SA.Widgets.Popup.build(opt);
    popup.show();
  };

  var afterOpenSuccessPopup = function() {
    setPopupVariable();
    $popup.find('.js-alerts-add-undo').on('click', undoAddAlerts);
    $('.modal-backdrop.in').css('opacity', '0');
    $('body').addClass('ta-scrollable');
  };

  var showSelectSymbolsPopup = function() {
    var opt = {
      showHeader: true,
      headerContent: '<b>New Portfolio</b>',
      showFooter: true,
      footerContent: '<div class="ta-ad-content"><div class="ta-ad-action">Create Portfolio and Get Alerts</div></div>',
      showCloseBtn: true,
      bodyContent: '<div class="ta-ad-content"><div class="ta-ad-opener">Which tickers would you like to receive alerts on?</div><input type="text" id="alerts-autocomplete" class="ta-ad-symbols-picker" placeholder="e.g. GOOG, MSFT" /></div>',
      keyboard: true,
      backdrop: true,
      removeAfterClose: true,
      afterOpen: afterOpenPopup,
      className: 'ta-ad-trading-alert-popup ta-ad-create-portfolio',
      fade: '',
      afterClose: afterClose
    };
    var popup = SA.Widgets.Popup.build(opt);
    popup.show();
  };

  var afterOpenPopup = function() {
    setPopupVariable();
    addAutocomplete();
    createActionEvents();
  };

  var afterClose = function() {
    $('body').removeClass('ta-scrollable');
  };

  var setPopupVariable = function() {
    $popup = $('.ta-ad-trading-alert-popup');
  };

  var setMoneSource = function() {
    var pageType = SA.pageConfig.Data.pageType;
    if (adType === 'native_rr') {
      moneSource = 'rr_nativeunit';
      if ($.inArray(pageType, ['article', 'single_news']) > -1) {
        moneSource += '_' + pageType;
      }
    } else if (adType === 'single_link') {
      moneSource = pageType + '_singlelink';
    } else if (adType === 'sa-news-item') {
      moneSource = 'singlenews_nowread';
    }
  };

  scope.click = function(opt) {
    opt = opt || {};
    adType = opt.adType;
    constSymbols = opt.symbols;
    newPortfolioId = null;
    $popup = null;
    setMoneSource();
    addAlerts();
  }

})();
(function (w, SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Navigation.HeaderHelpLinks');

  scope.fetch = fetch;

  var $menu = $('#hd-help .dropdown-menu'), popup;

  function fetch() {
    if ($menu.length) {
      clearCustomLis();
      $.ajax({
        method: 'GET',
        url: '/header_help_links/get',
        cache: false
      }).done(function (res) {
        if (res && res.links && res.links.length) {
          var lis = $.map(res.links, renderLi);
          $menu.find('li.dropdown-header').after(lis.join(''));
        }
      });
    }
  }

  function clearCustomLis() {
    $menu.find('li.custom-link').remove();
  }

  function renderLi(obj) {
    return [
      '<li class="custom-link">',
      (obj.open_in === '_popup' ? renderPopup(obj) : renderLink(obj)),
      '</li>'
    ].join('');
  }

  function renderPopup(link) {
    return [
      '<a href="#" target="_popup" data-content="',
      encodeURIComponent(link.content),
      '">',
      link.title,
      '</a>'
    ].join('');
  }

  function renderLink(link) {
    return ['<a href="', link.content, '" target="', link.open_in, '">', link.title, '</a>'].join('');
  }

  function initEvents() {
    $menu.on('click', 'a[target="_popup"]', function (e) {
      e.preventDefault();

      var $elem = $(e.currentTarget), content = decodeURIComponent($elem.data('content'));
      if (!!content) {
        popup = SA.Widgets.Popup.build({
          showCloseBtn: true,
          headerContent: '<b>' + $elem.text() + '</b>',
          bodyContent: content,
          showFooter: false,
          keyboard: true,
          backdrop: true,
          removeAfterClose: true,
          className: 'popup header-help-link',
          afterOpen: function () {
          },
          afterClose: function () {
            popup = null;
          }
        });

        SA.Logger.Mone.event('help_menu', 'popup', 'shown', {data: {'header': $elem.text()}});

        popup.show();
      }
    });

    $('#hd-help').on('show.bs.dropdown', function () {
      SA.Logger.Mone.event('help_menu', 'top_nav', 'shown');
    });
  }

  if ($menu.length) {
    initEvents();

    fetch();
  }

}(window, window.SA, window.jQuery));
(function(SA, $){

  "use strict";

  //Class works only with callbacks, executes callback immediately if has cache, if no - performs request and callback

  var scope = SA.UsingNamespace('SA.Data.Notifications'),
      ls = SA.Data.Cache,
      loggedIn = SA.Data.User.loggedIn(),
      userNotifications = null,
      totalPages = null,
      currPage = null;

  var storeCountInLS = function(newCount, withCache) {
    if (withCache) {
      ls.set('user_notifications_count', newCount, 10*60*1000);
    } else {
      ls.set('user_notifications_count', newCount);
    }
  };

  var removeCountFromLs = function(){
    ls.del('user_notifications_count');
  };

  var getCountFromLS = function(cb) {
    userNotifications = JSON.parse(ls.get('user_notifications_count'));
    if(userNotifications.value && $.isFunction(cb)) {
      cb(userNotifications.value);
    }
  };

  var getNewNotificationsCount = function(cb){
    $.get('/notifications/new_notification_count').done(function(resp) {
      if(resp.new_notifications) {
        userNotifications = resp.new_notifications;
        storeCountInLS(userNotifications, true);
        if ($.isFunction(cb)) {
          cb(userNotifications);
        }
      }
      if(resp.total_pages) {
        totalPages = resp.total_pages;
      }
    });
  };

  var deliverNavbarNotifications = function(notificationType, cb) {
    if (currPage === null) {
      currPage = {
        "direct_messages" : 1,
        "user_notifications" : 1
      }
      getFirstNotificationsBatch(notificationType, cb);
    } else {
      if (currPage[notificationType]== totalPages[notificationType]){
        return;
      } else {
        currPage[notificationType] += 1;
        loadNextNotificationsBatch(notificationType, cb);
      }
    }
  };

  var getFirstNotificationsBatch = function(cb) {
    $.get('/notifications/navbar', { page: 1 }, function(res) {
      // no notifications => only single li element, set currPage to null again
      if ($(res).length === 1){
        currPage = null;
      }
      if ($.isFunction(cb)) {
        cb(res);
      }
    });
  };

  var loadNextNotificationsBatch = function(notificationType, cb) {
    var url = "/notifications/navbar_load_more_" + notificationType;
    $.get(url, { page: currPage[notificationType] }, function(res) {
      if ($.isFunction(cb)) {
        cb(res);
      }
    });
  };

  // Public functions

  scope.getNewNotificationsCount = function(callback){
    if(loggedIn) {
      return ls.get('user_notifications_count', true) ? getCountFromLS(callback) : getNewNotificationsCount(callback);
    }
  };

  scope.getNotifications = function(notificationType, callback) {
    if(loggedIn) {
      return deliverNavbarNotifications(notificationType, callback);
    }
  };

  scope.resetNewNotifications = function(){
    if(loggedIn) {
      removeCountFromLs();
    }
  };

  scope.resetFirstPage = function() {
    currPage = null;
  };

  scope.removeAllNotifications = function(opt, cb) {
    $.post('/notifications/remove_all_notifications', {})
      .done(function(resp){
        if (resp.status && resp.status === 'success' && $.isFunction(cb)) {
          cb();
        }
      });
  };

  scope.removeNotification = function(opt, cb) {
    var id = opt.notificationId;
    var el = opt.el;
    var url = '/notifications/' + id + '/remove_single';

    $.ajax({
      method: 'POST',
      url: url,
      dataType: 'json'
    }).done(function(resp){
      if ($.isFunction(cb)) {
        cb(resp, el);
      }
    });
  };

}(SA, jQuery));

(function(SA, $){

  "use strict";

  var scope = SA.UsingNamespace('SA.Widgets.UserNotifications');

  var nt = SA.Data.Notifications, $userNotificationsLink, $dropdown, ntWidget, scrollMoneSent = false;

  var removedNotifications = [];

  var showNotificationsList = function(){
    var newCount = $dropdown.find('.badge-n').text() || "0";
    nt.resetFirstPage();
    nt.getNotifications(function(notifications){
      $dropdown.find('.divider').prevAll().remove();
      $dropdown.find('.divider').before(notifications);
      $dropdown.find('.sa-loader').hide();
      ntWidget.checkNoNotifications($('.menu-notifications.direct-messages'));
      ntWidget.checkNoNotifications($('.menu-notifications.user-notifications'));

      $dropdown.loaded = true;
      setPopupMaxHeight();
      setNotificationEvents();

      SA.Logger.Mone.event('notification', 'header_icon', 'popup_opened', {
        data: {
          num: newCount,
          content_array: loadedNotifications($('li.single-notification'))
        }
      });

      var $embargoedArticles = $dropdown.find('.user-notifications').find('li[data-action="embargoed_article"]');
      $embargoedArticles.each(function () {
        SA.Logger.Mone.event('pro_marketing_notification', 'nav_notifications_link', 'displayed', {
          data: {
            article_id: $(this).data('subject')
          }
        });
      });
    });
  };

  var loadedNotifications = function($notifications){
    return $.map($notifications, function(el){
      var $el = $(el);
      return {position: $el.data('position'), content_id: $el.data('subject'), content_type: $el.data('type'), notification_type: $el.data('action')};
    });
  };

  var loadNextPage = function(e){
    var $menuNotifications = $(e);
    var notificationType = ($menuNotifications.attr("class").indexOf('direct') > -1) ? 'direct_messages' : 'notifications';
    nt.getNotifications(notificationType, function(notifications){
      $menuNotifications.append(notifications);
      SA.Logger.Mone.event('notification', 'header_icon', 'load_more', {
        data: {
          content_array : loadedNotifications($(notifications))
        }
      });
    });
  };

  var setDropdownEvents = function () {
    $dropdown.on('show.bs.dropdown', function () {
      showNotificationsList();
      $dropdown.find('.badge-n').remove();
      nt.resetNewNotifications();
    }).on('hide.bs.dropdown', function () {
      if (!$dropdown.loaded){
        return false;
      }
      nt.resetFirstPage();
      $dropdown.find('.divider').prevAll().remove();
      $dropdown.find('.sa-loader').show();
    });

    // "lock" scrolling on element to prevent scroll on page
    $(document).on('mousewheel DOMMouseScroll', '.menu-notifications', function (e) {
      var e0 = e.originalEvent,
        delta = e0.wheelDelta || -e0.detail;

      this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
      e.preventDefault();
    });
  };

  var setNotificationEvents = function() {
    var $wrapper = $('#hd-notify'),
      $dropMenu = $('.dropdown-menu');

    $wrapper.find('.menu-notifications').on('click', '.close', function(e) {
      e.preventDefault();
      e.stopPropagation();

      var $this = $(this),
        id = $this.data('id'),
        $singleNotification = $this.closest('.single-notification'),
        actionType = $singleNotification.data('action'),
        embargoedArticleId = actionType === 'embargoed_article' ? $singleNotification.data('subject') : null,
        data = {
          notificationId: id,
          el: this
        };

      if(removedNotifications.indexOf(id) === -1){
        removedNotifications.push(id);
        nt.removeNotification(data, function (resp, el) {
          removeAfterDelete(resp, el, $wrapper);

          if (embargoedArticleId) {
            SA.Logger.Mone.event('pro_marketing_notification', 'nav_notifications_link', 'dismissed', {
              data: {
                article_id: embargoedArticleId
              }
            });
          }
        });
      }
    }).on('click', '.single-notification', function(e) {
      if (e.ctrlKey || e.metaKey) {
        e.stopPropagation();
        var $menuNotificationWrapper = $(this).closest('.menu-notifications');
        $(this).remove();
        ntWidget.checkNoNotifications($menuNotificationWrapper);
      }
    }).on('mouseup', '.single-notification', function(e) {
      if(e.which === 2){ //mouse middle button click
        e.stopPropagation();
        e.preventDefault();
        var $el = $(this);
        var $menuNotificationWrapper = $el.closest('.menu-notifications');
        var a = $el.find('a')[0];
        if(typeof SA.Utils.Env.isFirefox === 'function' ? SA.Utils.Env.isFirefox() : SA.Utils.Env.isFirefox){
          window.open(a.href, "_blank");
        } else{
          var evt = document.createEvent("MouseEvents");
          evt.initMouseEvent("click", true, true, window, 0, 0, 0, 0, 0, true, false, false, true, 0, null);
          a.dispatchEvent(evt);
        }
        $el.remove();
        ntWidget.checkNoNotifications($menuNotificationWrapper);
      }
    }).on('scroll', function(e) {
      if (!scrollMoneSent) {
        scrollMoneSent = true;
        SA.Logger.Mone.event('notification', 'header_icon', 'popup_scrolled', {
          data: {
            scrolled: true
          }
        });
      }
      if (SA.Utils.Scroll.isScrolledToElBottom(this)) {
        loadNextPage(this);
      }
    });
    $dropMenu.on('click', '.direct-link', function(e) {
      if (e.ctrlKey || e.metaKey || e.which === 2) {
        e.stopPropagation();
      }
    });
    $dropMenu.on('click', '.clear-all', function(e) {
      e.stopPropagation();
      nt.removeAllNotifications('', function () {
        clearAllNotifications($wrapper);
      });
    });
  };

  var removeAfterDelete = function(resp, el, $wrapper) {
    $wrapper = $(el).closest('.menu-notifications');
    if (resp.status === 'success') {
      $(el).parents('li.single-notification').remove();
      ntWidget.checkNoNotifications($wrapper);
    } else {
      removedNotifications.pop($(el).data('id'));
    }
  };

  function clearAllNotifications($wrapper) {
    var $notifications = $('.menu-notifications.user-notifications').find('li.single-notification');
    $notifications.remove();
    $wrapper.find('.notifications-c[data-id=notifications]').text(0);
  }

  var setPopupMaxHeight = function(){
    if ($dropdown.hasClass('open')) {
      var $directMessagesMenu = $('.menu-notifications.direct-messages');
      var directHeight = $directMessagesMenu.outerHeight();
      var $notificationMenu = $('.menu-notifications.user-notifications');
      var notificationHeight = $notificationMenu .outerHeight();
      var totalHeight = window.innerHeight-125;
      if (notificationHeight > totalHeight/2){
        $directMessagesMenu.css({'max-height': totalHeight/2});
      } else {
        $directMessagesMenu.css({'max-height': totalHeight-notificationHeight});
      }
      if (directHeight > totalHeight/2){
        $notificationMenu.css({'max-height': totalHeight/2});
      } else {
        $notificationMenu.css({'max-height': totalHeight-directHeight});
      }
    }
  };

  scope.init = function(){
    var conf = SA.headerConfig;
    $dropdown = $('#hd-notify');
    ntWidget = SA.Widgets.Notifications;
    if(SA.Data.User.loggedIn() && $dropdown.length && !conf.noNotificationsMenu){
      $userNotificationsLink = $dropdown.find('#nav_notifications_link');

      nt.getNewNotificationsCount(function(count){
        ntWidget.setNewNotificationsIcon(count, $userNotificationsLink);
      });
      setDropdownEvents();
    }
  };

}(SA, jQuery));



(function (SA, $) {

  "use strict";

  var scope = SA.UsingNamespace('SA.Widgets.Notifications');

  scope.setNewNotificationsIcon = function (newCount, link) {
    setNewNotificationsIcon(newCount, link);
  };

  scope.removeNumberIcon = function ($button) {
    $button.find('.badge-n').remove();
  };

  var setNewNotificationsIcon = function (newCount, link) {
    if (newCount > 0) {
      link.append($('<span class="badge-n sa-notify">' + newCount + '</span>')).addClass('active');
      var mone_type = (link.attr('class').indexOf('rta') > -1) ? 'notification_inbox' : 'notification';
      SA.Logger.Mone.event(mone_type, 'header_icon', 'shown_num', {
        data: {
          num: newCount.toString()
        }
      });
    }
  };

  scope.checkNoNotifications = function ($wrapper) {
    var notifications = $wrapper.find('li.single-notification').length;

    if (!notifications) {
      $wrapper.find('.no-notifications').show();
    }

    $wrapper.prev('.notifications').find('.notifications-c').html(notifications);
  };

  var init = function () {
    var conf = SA.headerConfig;

    if (SA.Data.User.loggedIn() && !conf.noNotificationsMenu) {
      SA.Widgets.UserNotifications.init();
    }
  };

  init();

}(window.SA, window.jQuery));
(function() { this.JST || (this.JST = {}); this.JST["jst/header/profile_dropdown"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<ul class="dropdown-menu sa-with-arrow">\n  <li class="dropdown-header pro-gray-bg elips">\n    ',  (hasNick && nick && nick.trim()) ? nick : 'No username<span class="complete-username-link a-tnd">Create</span>' ,'\n  </li>\n  <li><a href="/inbox">Inbox</a></li>\n  <li><a href="',  profile ,'">Profile</a></li>\n  <li><a href="/account/history">Articles Read</a></li>\n  <li><a href="/submission">',  authorSlug ? 'Submit Article' : 'Write an Article' ,'</a></li>\n  ');  if (hasBlogPosts) { ; __p.push('\n    <li><a href="/account/authorboard/instablog">Manage Blog</a></li>\n  ');  } ; __p.push('\n  ');  if (SA.Data.User.MPModeratorForAuthorId()) {
     var txt = SA.Data.User.MPModeratorForService(); ; __p.push('\n      <li><a href="/account/marketplace_platform?auth_id=',  SA.Data.User.MPModeratorForAuthorId() ,'">',  txt ,'</a></li>\n    ');  } ; __p.push('\n  <li><a href="',  isPaidUser || hasPaidSubscription ? '/account/subscriptions_settings' : '/account/user_settings' ,'">Settings</a></li>\n  <li><a href="',  hasPortfolios ? '/account/edit_stocks' : '/account/edit_newsletters' ,'">Email Alerts</a></li>\n  <li class="divider"></li>\n  <li><a href="/account/logout" id="nav_logout_link">Sign Out</a></li>\n</ul>\n');}return __p.join('');};
}).call(this);

(function (w, SA, $) {

  'use strict';

  function buildProfileDd(u) {
    return $(w.JST['jst/header/profile_dropdown']({
      hasNick: u.hasNick(),
      nick: u.nick(),
      profile: u.profileLink(),
      authorSlug: u.authorSlug(),
      hasBlogPosts: u.hasBlogPosts(),
      hasPortfolios: !!u.getPortfolios().length,
      isPaidUser: u.isPaidUser(),
      hasPaidSubscription: u.hasPaidSubscription()
    }));
  }

  function setEvents($dd) {
    $dd.on('click', '.complete-username-link', function () {
      SA.Widgets.EnterUsername.show({type: 'page_header'});
    }).on('click', '#nav_logout_link', function (e) {
      e.preventDefault();
      SA.Models.Authentication.logOut(function () {
        var l = w.location;
        if ((/\/account|pro\//).test(l.href)) {
          l.href = SA.App.host;
        } else {
          l.reload();
        }
      });
    });
  }

  function init() {
    var $wrapper = $('#hd-user'), u = SA.Data.User;
    if ($wrapper.length && u.loggedIn()) {
      var $dd = buildProfileDd(u);
      setEvents($dd);
      $wrapper.append($dd);
      $('#user_dropdown').attr('src', u.pictureUrl());
    }
  }

  init();

}(window, window.SA, window.jQuery));
(function (SA, $) {

  'use strict';

  var $s = $('#sa-search'),
    $input = $('#hd-auto'),
    keyword = false;

  function avoidSymbol(on) {
    $s.find('[name="avoid_symbol"]').val(!!on);
  }

  function sub() {
    $s.submit();
  }

  function initEvents($input, autoComplete) {
    var val, match, valInput, valType, valPath, symbolPagePath = '';
    $s.on('submit', function (event) {
      event.preventDefault();
      val = $input.val().trim();
      match = autoComplete.getMatch();
      if (!val && !match) {
        return false;
      }
      valInput = $('#sa-search-hid');
      valType = $('#sa-search-type-hid');
      valPath = $('#sa-search-path-hid');
      if (match && !keyword) {
        valInput.val(match);
      } else {
        valInput.val(val);
        if (keyword) valType.val('keyword');
      }

      var regex = /.*?symbol\/.*?\/([\w\/-]+)/ig,
        regex_result = regex.exec(document.location.pathname);
      if (regex_result && regex_result.length) {
        symbolPagePath = '/' + regex_result[1];
      }
      valPath.val(symbolPagePath);
      this.submit();
    }).on('keydown', scrollPage);
  }

  function focusOnSearch() {
    if ($(document).scrollTop() === 0 && $(':focus').length === 0) {
      $input.focus();
    }
  }

  function scrollPage(e) {
    var $el = $(e.target);
    var keyCode = e.keyCode || e.which;
    if (!$el.next('.boot_sa_autocomplete').is(':visible')) {
      if([38,40,33,34].indexOf(keyCode) > -1){
        $input.blur();
      }
    }
    if($el.val() === "" && [32].indexOf(keyCode) > -1){
      $input.blur();
    }
    return true;
  }

  function init() {
    var autoComplete;
    if ($input.length) {
      autoComplete = new SA.Utils.Autocomplete($input, {
        people: true,
        symbols: true,
        keyword: true,
        resultsLimit: 3,
        onShow: function () {
          $input.addClass('focus');
        },
        onHide: function(){
          $input.removeClass('focus');
        },
        keywordSelect: function (name) {
          if(name) {
            $input.val(name);
          }
          keyword = true;
          avoidSymbol(true);
          sub();
        }
      });

      initEvents($input, autoComplete);
    }

    $().ready(focusOnSearch);
  }

  SA.run(init, 'hd-search');

}(window.SA, window.jQuery));

(function (SA, $) {

  'use strict';

  function init() {
    $('a#sign-in').on('click', function (e) {
      // fix for safari not setting cookies from ajax
      if (!SA.Utils.Env.isSafari()) {
        e.preventDefault();
        SA.Widgets.AuthenticationPopup.show();
      }
    });
  }

  SA.run(init, 'hd-sign');

}(window.SA, window.jQuery));
/*
CryptoJS v3.1.2
code.google.com/p/crypto-js
(c) 2009-2013 by Jeff Mott. All rights reserved.
code.google.com/p/crypto-js/wiki/License
*/

var CryptoJS=CryptoJS||function(s,p){var m={},l=m.lib={},n=function(){},r=l.Base={extend:function(b){n.prototype=this;var h=new n;b&&h.mixIn(b);h.hasOwnProperty("init")||(h.init=function(){h.$super.init.apply(this,arguments)});h.init.prototype=h;h.$super=this;return h},create:function(){var b=this.extend();b.init.apply(b,arguments);return b},init:function(){},mixIn:function(b){for(var h in b)b.hasOwnProperty(h)&&(this[h]=b[h]);b.hasOwnProperty("toString")&&(this.toString=b.toString)},clone:function(){return this.init.prototype.extend(this)}},
q=l.WordArray=r.extend({init:function(b,h){b=this.words=b||[];this.sigBytes=h!=p?h:4*b.length},toString:function(b){return(b||t).stringify(this)},concat:function(b){var h=this.words,a=b.words,j=this.sigBytes;b=b.sigBytes;this.clamp();if(j%4)for(var g=0;g<b;g++)h[j+g>>>2]|=(a[g>>>2]>>>24-8*(g%4)&255)<<24-8*((j+g)%4);else if(65535<a.length)for(g=0;g<b;g+=4)h[j+g>>>2]=a[g>>>2];else h.push.apply(h,a);this.sigBytes+=b;return this},clamp:function(){var b=this.words,h=this.sigBytes;b[h>>>2]&=4294967295<<
32-8*(h%4);b.length=s.ceil(h/4)},clone:function(){var b=r.clone.call(this);b.words=this.words.slice(0);return b},random:function(b){for(var h=[],a=0;a<b;a+=4)h.push(4294967296*s.random()|0);return new q.init(h,b)}}),v=m.enc={},t=v.Hex={stringify:function(b){var a=b.words;b=b.sigBytes;for(var g=[],j=0;j<b;j++){var k=a[j>>>2]>>>24-8*(j%4)&255;g.push((k>>>4).toString(16));g.push((k&15).toString(16))}return g.join("")},parse:function(b){for(var a=b.length,g=[],j=0;j<a;j+=2)g[j>>>3]|=parseInt(b.substr(j,
2),16)<<24-4*(j%8);return new q.init(g,a/2)}},a=v.Latin1={stringify:function(b){var a=b.words;b=b.sigBytes;for(var g=[],j=0;j<b;j++)g.push(String.fromCharCode(a[j>>>2]>>>24-8*(j%4)&255));return g.join("")},parse:function(b){for(var a=b.length,g=[],j=0;j<a;j++)g[j>>>2]|=(b.charCodeAt(j)&255)<<24-8*(j%4);return new q.init(g,a)}},u=v.Utf8={stringify:function(b){try{return decodeURIComponent(escape(a.stringify(b)))}catch(g){throw Error("Malformed UTF-8 data");}},parse:function(b){return a.parse(unescape(encodeURIComponent(b)))}},
g=l.BufferedBlockAlgorithm=r.extend({reset:function(){this._data=new q.init;this._nDataBytes=0},_append:function(b){"string"==typeof b&&(b=u.parse(b));this._data.concat(b);this._nDataBytes+=b.sigBytes},_process:function(b){var a=this._data,g=a.words,j=a.sigBytes,k=this.blockSize,m=j/(4*k),m=b?s.ceil(m):s.max((m|0)-this._minBufferSize,0);b=m*k;j=s.min(4*b,j);if(b){for(var l=0;l<b;l+=k)this._doProcessBlock(g,l);l=g.splice(0,b);a.sigBytes-=j}return new q.init(l,j)},clone:function(){var b=r.clone.call(this);
b._data=this._data.clone();return b},_minBufferSize:0});l.Hasher=g.extend({cfg:r.extend(),init:function(b){this.cfg=this.cfg.extend(b);this.reset()},reset:function(){g.reset.call(this);this._doReset()},update:function(b){this._append(b);this._process();return this},finalize:function(b){b&&this._append(b);return this._doFinalize()},blockSize:16,_createHelper:function(b){return function(a,g){return(new b.init(g)).finalize(a)}},_createHmacHelper:function(b){return function(a,g){return(new k.HMAC.init(b,
g)).finalize(a)}}});var k=m.algo={};return m}(Math);
(function(s){function p(a,k,b,h,l,j,m){a=a+(k&b|~k&h)+l+m;return(a<<j|a>>>32-j)+k}function m(a,k,b,h,l,j,m){a=a+(k&h|b&~h)+l+m;return(a<<j|a>>>32-j)+k}function l(a,k,b,h,l,j,m){a=a+(k^b^h)+l+m;return(a<<j|a>>>32-j)+k}function n(a,k,b,h,l,j,m){a=a+(b^(k|~h))+l+m;return(a<<j|a>>>32-j)+k}for(var r=CryptoJS,q=r.lib,v=q.WordArray,t=q.Hasher,q=r.algo,a=[],u=0;64>u;u++)a[u]=4294967296*s.abs(s.sin(u+1))|0;q=q.MD5=t.extend({_doReset:function(){this._hash=new v.init([1732584193,4023233417,2562383102,271733878])},
_doProcessBlock:function(g,k){for(var b=0;16>b;b++){var h=k+b,w=g[h];g[h]=(w<<8|w>>>24)&16711935|(w<<24|w>>>8)&4278255360}var b=this._hash.words,h=g[k+0],w=g[k+1],j=g[k+2],q=g[k+3],r=g[k+4],s=g[k+5],t=g[k+6],u=g[k+7],v=g[k+8],x=g[k+9],y=g[k+10],z=g[k+11],A=g[k+12],B=g[k+13],C=g[k+14],D=g[k+15],c=b[0],d=b[1],e=b[2],f=b[3],c=p(c,d,e,f,h,7,a[0]),f=p(f,c,d,e,w,12,a[1]),e=p(e,f,c,d,j,17,a[2]),d=p(d,e,f,c,q,22,a[3]),c=p(c,d,e,f,r,7,a[4]),f=p(f,c,d,e,s,12,a[5]),e=p(e,f,c,d,t,17,a[6]),d=p(d,e,f,c,u,22,a[7]),
c=p(c,d,e,f,v,7,a[8]),f=p(f,c,d,e,x,12,a[9]),e=p(e,f,c,d,y,17,a[10]),d=p(d,e,f,c,z,22,a[11]),c=p(c,d,e,f,A,7,a[12]),f=p(f,c,d,e,B,12,a[13]),e=p(e,f,c,d,C,17,a[14]),d=p(d,e,f,c,D,22,a[15]),c=m(c,d,e,f,w,5,a[16]),f=m(f,c,d,e,t,9,a[17]),e=m(e,f,c,d,z,14,a[18]),d=m(d,e,f,c,h,20,a[19]),c=m(c,d,e,f,s,5,a[20]),f=m(f,c,d,e,y,9,a[21]),e=m(e,f,c,d,D,14,a[22]),d=m(d,e,f,c,r,20,a[23]),c=m(c,d,e,f,x,5,a[24]),f=m(f,c,d,e,C,9,a[25]),e=m(e,f,c,d,q,14,a[26]),d=m(d,e,f,c,v,20,a[27]),c=m(c,d,e,f,B,5,a[28]),f=m(f,c,
d,e,j,9,a[29]),e=m(e,f,c,d,u,14,a[30]),d=m(d,e,f,c,A,20,a[31]),c=l(c,d,e,f,s,4,a[32]),f=l(f,c,d,e,v,11,a[33]),e=l(e,f,c,d,z,16,a[34]),d=l(d,e,f,c,C,23,a[35]),c=l(c,d,e,f,w,4,a[36]),f=l(f,c,d,e,r,11,a[37]),e=l(e,f,c,d,u,16,a[38]),d=l(d,e,f,c,y,23,a[39]),c=l(c,d,e,f,B,4,a[40]),f=l(f,c,d,e,h,11,a[41]),e=l(e,f,c,d,q,16,a[42]),d=l(d,e,f,c,t,23,a[43]),c=l(c,d,e,f,x,4,a[44]),f=l(f,c,d,e,A,11,a[45]),e=l(e,f,c,d,D,16,a[46]),d=l(d,e,f,c,j,23,a[47]),c=n(c,d,e,f,h,6,a[48]),f=n(f,c,d,e,u,10,a[49]),e=n(e,f,c,d,
C,15,a[50]),d=n(d,e,f,c,s,21,a[51]),c=n(c,d,e,f,A,6,a[52]),f=n(f,c,d,e,q,10,a[53]),e=n(e,f,c,d,y,15,a[54]),d=n(d,e,f,c,w,21,a[55]),c=n(c,d,e,f,v,6,a[56]),f=n(f,c,d,e,D,10,a[57]),e=n(e,f,c,d,t,15,a[58]),d=n(d,e,f,c,B,21,a[59]),c=n(c,d,e,f,r,6,a[60]),f=n(f,c,d,e,z,10,a[61]),e=n(e,f,c,d,j,15,a[62]),d=n(d,e,f,c,x,21,a[63]);b[0]=b[0]+c|0;b[1]=b[1]+d|0;b[2]=b[2]+e|0;b[3]=b[3]+f|0},_doFinalize:function(){var a=this._data,k=a.words,b=8*this._nDataBytes,h=8*a.sigBytes;k[h>>>5]|=128<<24-h%32;var l=s.floor(b/
4294967296);k[(h+64>>>9<<4)+15]=(l<<8|l>>>24)&16711935|(l<<24|l>>>8)&4278255360;k[(h+64>>>9<<4)+14]=(b<<8|b>>>24)&16711935|(b<<24|b>>>8)&4278255360;a.sigBytes=4*(k.length+1);this._process();a=this._hash;k=a.words;for(b=0;4>b;b++)h=k[b],k[b]=(h<<8|h>>>24)&16711935|(h<<24|h>>>8)&4278255360;return a},clone:function(){var a=t.clone.call(this);a._hash=this._hash.clone();return a}});r.MD5=t._createHelper(q);r.HmacMD5=t._createHmacHelper(q)})(Math);

(function (w, SA, $) {

  "use strict";

  var scope = SA.UsingNamespace('SA.Utils.AbTests');

  var activeTests, activeTestsAjax, user = SA.Data.User, c = SA.Data.Cookies;

  function logSuccess(name) {
    w.console.log('the variation for this user is: ' + name);
  }

  function logError(error) {
    w.console.log('failed to get variation name. error message: ' + error);
  }

  function getUserIdentifier(statusId) {
    switch (statusId) {
      case 0:
        return user.id() ? null : (c.get('machine_cookie') || (Math.round((new Date()).getTime() + Math.random() * 1000000003366)).toString());
      case 1:
        return user.id();
      case 2:
        return user.id() || c.get('machine_cookie');
      default:
        return 0;
    }
  }

  function getAbId(testIdentifier, userIdentifier) {
    var md5Hash = w.CryptoJS.MD5(userIdentifier + '&' + testIdentifier).toString().slice(-3);
    return parseInt(md5Hash, 16) % 100;
  }

  function getVariationForId(variations, id) {
    var variationName = null;

    $.each(variations, function (k, v) {
      if (id >= v[0] && id <= v[1]) {
        variationName = k;
        return false;
      }
    });

    return variationName;
  }

  function getForcedVariation(testName, abTest) {
    return SA.Fn.param(testName) || c.get(testName) || getForcedVariationUsers(abTest);
  }

  function getForcedVariationUsers(abTest) {
    var list = abTest.force_users, item;
    if (list) {
      if ((item = list[user.id()])) {
        return item;
      }

      if ((item = list[abTest.force_group.MP_Authors]) && user.isMPAuthor()) {
        return item;
      }

      if ((item = list[abTest.force_group.Pro]) && user.isPro()) {
        return item;
      }

      if ((item = list[abTest.force_group.SA_Internal]) && user.isSATeam()) {
        return item;
      }

      if ((item = list[abTest.force_group.Beta_Group]) && user.inBetaGroup()) {
        return item;
      }

      if ((item = list[abTest.force_group.Contributors]) && user.isAuthor() && !user.isMPAuthor()) {
        return item;
      }
    }

    return null;
  }

  function getVariationForUser(abTest) {
    var userIdentifier = getUserIdentifier(abTest.population_status);
    if (userIdentifier) {
      return getVariationForId(abTest.variations, getAbId(abTest.identifier, userIdentifier));
    }

    return null;
  }

  function getVariation(name, test, fallback) {
    return getForcedVariation(name, test) || getVariationForUser(test) || fallback;
  }

  function executeTests(tests) {
    var v, t;
    $.each(tests, function (k, f) {
      if ($.isFunction(f)) {
        v = 'control';
        if ((t = activeTests[k])) {
          v = getVariation(k, t, v);
          SA.Logger.Mone.event('ab_tests', '', '', {data: {test_name: k, identifier: t.identifier, variation: v}});
        }
        f(v);
      } else {
        SA.exceptions.push(['incorrect function for test:' + k]);
      }
    });
  }

  function printVariationName(testName) {
    var t, v;
    if ((t = activeTests[testName])) {
      v = getVariation(testName, t, null);
      return v ? logSuccess(v) : logError('test not relevant for user');
    }

    return logError('unable to find test');
  }

  // `tests` is a hash with all abtests to run on the page, the key is the test name and the value is the callback function which take variation name as a param, example:
  //   {'test 1 Name': callBackFunctionTest1(VariationName), 'test 2 Name': callBackFunctionTest2(VariationName)}
  //
  // It's ok to call SA.Utils.AbTests.init few times in a page, ajax will be sent only once
  // all tests will execute as soon as ajax returns, or immediately if the ajax already returned.
  scope.init = function (tests) {
    activeTestsAjax = activeTestsAjax || $.get('/ab_test/active_tests');
    activeTestsAjax.done(function (response) {
      activeTests = response ? response.active_tests : {};
      executeTests(tests);
    });
  };

  scope.printVariationName = function (testName) {
    return $.isEmptyObject(activeTests) ? logError('tests are still loading please try again in a moment') : printVariationName(testName);
  };

  scope.forceVariation = function (testName, variationName) {
    c.set(testName, variationName, {expires: 24 * 60 * 60});
  };

}(window, window.SA, window.jQuery));
(function() { this.JST || (this.JST = {}); this.JST["jst/header/portfolios_list"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('');  for (var i = 0, len = portfolios.length; i < len; i++) { ; __p.push('\n  ');  var portfolio = portfolios[i] ; __p.push('\n  <li class="subnav-dropdown-item ',  extraClass ,'" data-portfolio-id="',  portfolio.portfolio_id ,'" itemprop="name" role="none">\n    <a class="s-tab-a" href="/account/portfolio/latest?pu=',  portfolio.portfolio_id ,'" itemprop="url" role="menuitem" sasource="secondarytabs">\n      ',  portfolio.portfolio_name ,'\n    </a>\n  </li>\n');  } ; __p.push('\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/navigation/nav_tab_submenu"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div class="subnav-dropdown ',  type ,'-drop">\n    <ul aria-label="Most Used" class="list-unstyled pull-left ',  type ,'" role="menu">\n        <li class="header" itemprop="name" role="none">Most Used</li>\n        ');  col1.forEach( function (elem) { ; __p.push('\n          <li class="subnav-dropdown-item" itemprop="name" role="none"><a class="s-tab-a" href="/',  elem.url ,'" itemprop="url" role="menuitem" sasource="',  elem.sasource ,'">',  elem.title ,'</a></li>\n        ');  }); ; __p.push('\n        <li class="subnav-dropdown-item more-sections" itemprop="name" role="none"><a class="s-tab-a" href="/sitemap" itemprop="url" role="menuitem" sasource="trending_',  type ,'_navmenu_more">See All Sections</a></li>\n    </ul>\n    <ul aria-label="Recommended" class="list-unstyled pull-left ',  type ,'" role="menu">\n        <li class="header" itemprop="name" role="none">Recommended</li>\n        ');  col2.forEach( function (elem) { ; __p.push('\n          <li class="subnav-dropdown-item" itemprop="name" role="none"><a class="s-tab-a" href="/',  elem.url ,'" itemprop="url" role="menuitem" sasource="',  elem.sasource ,'">',  elem.title ,'</a></li>\n        ');  }); ; __p.push('\n    </ul>\n</div>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/navigation/nav_tab_submenu_prepare_for_responsive"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div class="subnav-dropdown ',  type ,'-drop">\n    <ul class="section no-link-title">\n        ');  col1.forEach( function (elem) { ; __p.push('\n          <li class="s-tab-b"><a href="/',  elem.url ,'" itemprop="url" role="menuitem" sasource="',  elem.sasource ,'">',  elem.title ,'</a></li>\n        ');  }); ; __p.push('\n    </ul>\n    <ul class="section no-link-title">\n        ');  col2.forEach( function (elem) { ; __p.push('\n          <li class="s-tab-b"><a href="/',  elem.url ,'" itemprop="url" role="menuitem" sasource="',  elem.sasource ,'">',  elem.title ,'</a></li>\n        ');  }); ; __p.push('\n    </ul>\n</div>\n');}return __p.join('');};
}).call(this);



(function (SA, $) {

  'use strict';

  var RECENT_DASHBOARDS_CACHE_SIZE = 20;
  var PATHS_EXCLUDED_FROM_CACHE = ['recommended-for-you', 'latest-articles'];

  var MAX_RECOMMENDED_LINKS = 3;
  var MAX_ALL_LINKS = 5;

  function getDashboardType() {
    return SA.pageConfig.Data.dashboardType
      || ((location.pathname.indexOf('fund-letters') > -1) ? 'analysis' : null)
      || ((location.pathname === '/market-outlook/global-investing/map') ? 'analysis' : null)
      || ((location.pathname === '/market-news/wall-street-breakfast') ? 'news' : null);
  }

  function cacheRecents() {
    var type, allRecents, recents, url;

    type = getDashboardType();
    url = location.pathname.slice(1);

    if (type && !PATHS_EXCLUDED_FROM_CACHE.includes(url)) {
      allRecents = getRecentsFromCache() || {};
      recents = allRecents[type] || [];

      if (recents.includes(url)) {
        recents.splice(recents.indexOf(url), 1);
      }

      recents.unshift(url);
      allRecents[type] = recents.slice(0, RECENT_DASHBOARDS_CACHE_SIZE);
      saveRecentsToCache(allRecents);
    }
  }

  function saveRecommendationsToCache(data) {
    var EXPIRATION_HOURS = 12;
    var cacheName = "subnavs_recommendations_" + getUserId();
    SA.Data.Cache.set(cacheName, JSON.stringify(data), EXPIRATION_HOURS * 60 * 60 * 1000);
  }

  function getRecommendationsFromCache() {
    var cacheName = "subnavs_recommendations_" + getUserId();
    return JSON.parse(SA.Data.Cache.get(cacheName, true));
  }

  function saveSubnavsToCache(data) {
    var cacheName = "subnavs_data_" + getUserId();
    SA.Data.Cache.set(cacheName, JSON.stringify(data));
  }

  function saveRecentsToCache(data) {
    var cacheName = "subnavs_recents_" + getUserId();
    SA.Data.Cache.set(cacheName, JSON.stringify(data));
  }

  function getRecentsFromCache() {
    var cacheName = "subnavs_recents_" + getUserId();
    return JSON.parse(SA.Data.Cache.get(cacheName));
  }

  function fetchUrl(l) {
    return l.url;
  }

  function getUserId() {
    return SA.Data.User.id() || 0;
  }

  function prepareRecommendationsData(type, mostUsedLinks, recommendedLinks, salesLinks, linksData) {
    var result = [];
    var recenUrls = getRecentsFromCache() || {};
    var allUrlsFromServer, finalSalesLinks;

    allUrlsFromServer = mostUsedLinks.map(fetchUrl).concat(recommendedLinks.map(fetchUrl));
    if (type === 'news') {
      allUrlsFromServer = allUrlsFromServer.concat(salesLinks.map(fetchUrl));
    }

    if (recenUrls[type]) {
      result = recenUrls[type]
        .filter(function (e) {
          return !allUrlsFromServer.includes(e)
        })
        .slice(0, MAX_RECOMMENDED_LINKS)
        .map(function (url, i) {
          return {
            url: url,
            sasource: "most_recent_" + type + "_navmenu_" + (i + 1),
            title: linksData[url] || ''
          }
        });
    }

    if ((MAX_RECOMMENDED_LINKS - result.length) > 0) {
      result = result.concat(recommendedLinks.slice(0, MAX_RECOMMENDED_LINKS - result.length));
    }

    finalSalesLinks = salesLinks.filter(function (e) {
      return !result.map(function (el) {
        return el.url;
      }).includes(e.url);
    }).slice(0, MAX_ALL_LINKS - result.length);

    result = result.concat(finalSalesLinks);
    return result;
  }

  function createSubnavs(data) {
    var newsRecommendedLinks = prepareRecommendationsData('news', data.news_sub_nav.most_used_links, data.news_sub_nav.recommended_links, data.news_sub_nav.sales_links, data.all_links);
    var analysisRecommendedLinks = prepareRecommendationsData('analysis', data.analysis_sub_nav.most_used_links, data.analysis_sub_nav.recommended_links, data.analysis_sub_nav.sales_links, data.all_links);

    var seeAllSectionsAnalysisMenuItem = [{
      sasource: "trending_analysis_navmenu_forced",
      title   : "See All Sections ",
      url     : "sitemap"
    }];

    if (SA.App.is_new_header) analysisRecommendedLinks = analysisRecommendedLinks.concat(seeAllSectionsAnalysisMenuItem);

    renderSubnavs({
      'news': [
        data.news_sub_nav.most_used_links,
        newsRecommendedLinks
      ],
      'analysis': [
        data.analysis_sub_nav.most_used_links,
        analysisRecommendedLinks
      ]
    });
  }

  function renderSubnavs(data) {
    saveSubnavsToCache(data);
    var $news = $('.news .subnav-dropdown'), $analysis = $('.analysis .subnav-dropdown'), $analysisResp = $('.analysis-resp .analysis-resp-drop');

    if ($news.length > 0 ) {
      $('.news .subnav-dropdown').replaceWith(JST['jst/navigation/nav_tab_submenu']({
        type: 'news',
        col1: data['news'][0],
        col2: data['news'][1]
      }));
    }

    if ($analysis.length > 0) {
      $('.analysis .subnav-dropdown').replaceWith(JST['jst/navigation/nav_tab_submenu']({
        type: 'analysis',
        col1: data['analysis'][0],
        col2: data['analysis'][1]
      }))
    }
    if ($analysisResp.length > 0 ) {
      $('.analysis-resp .analysis-resp-drop').replaceWith(JST['jst/navigation/nav_tab_submenu_prepare_for_responsive']({
        type: 'analysis-resp',
        col1: data['analysis'][0],
        col2: data['analysis'][1]
      }))
    }
  }

  function init() {
    var cachedRes = getRecommendationsFromCache();

    if (cachedRes) {
      createSubnavs(cachedRes);
      cacheRecents();
    } else {
      $.get('/users/dashboard_recommendations', null, function (res) {
        if (res.news_sub_nav && res.analysis_sub_nav && res.all_links) {
          saveRecommendationsToCache(res);
          createSubnavs(res);
          cacheRecents();
        }
      });
    }
  }

  init();

}(window.SA, window.jQuery));
/*
     * LetterAvatar
     * 
     * Artur Heinze
     * Create Letter avatar based on Initials
     * based on https://gist.github.com/leecrossley/6027780
     */

(function(w, d){

  function LetterAvatar (name, size) {

    name  = name || '';
    size  = size || 60;

    var colours = [
        "#1abc9c", "#2ecc71", "#3498db", "#9b59b6", "#34495e", "#16a085", "#27ae60", "#2980b9", "#8e44ad", "#2c3e50",
        "#f1c40f", "#e67e22", "#e74c3c", "#ecf0f1", "#95a5a6", "#f39c12", "#d35400", "#c0392b", "#bdc3c7", "#7f8c8d"
      ],

      nameSplit = String(name).toUpperCase().split(' '),
      initials, charIndex, colourIndex, canvas, context, dataURI;


    if (nameSplit.length == 1) {
      initials = nameSplit[0] ? nameSplit[0].charAt(0):'?';
    } else {
      initials = nameSplit[0].charAt(0) + nameSplit[1].charAt(0);
    }

    if (w.devicePixelRatio) {
      size = (size * w.devicePixelRatio);
    }

    charIndex     = (initials == '?' ? 72 : initials.charCodeAt(0)) - 64;
    colourIndex   = charIndex % 20;
    canvas        = d.createElement('canvas');
    canvas.width  = size;
    canvas.height = size;
    context       = canvas.getContext("2d");

    context.fillStyle = colours[colourIndex - 1];
    context.fillRect (0, 0, canvas.width, canvas.height);
    context.font = Math.round(canvas.width/2)+"px Arial";
    context.textAlign = "center";
    context.fillStyle = "#FFF";
    context.fillText(initials, size / 2, size / 1.5);

    dataURI = canvas.toDataURL();
    canvas  = null;

    return dataURI;
  }

  LetterAvatar.transform = function() {

    Array.prototype.forEach.call(d.querySelectorAll('img[avatar]'), function(img, name) {
      name = img.getAttribute('avatar');
      img.src = LetterAvatar(name, img.getAttribute('width'));
      img.removeAttribute('avatar');
      img.setAttribute('alt', name);
    });
  };


  // AMD support
  if (typeof define === 'function' && define.amd) {

    define(function () { return LetterAvatar; });

    // CommonJS and Node.js module support.
  } else if (typeof exports !== 'undefined') {

    // Support Node.js specific `module.exports` (which can be a function)
    if (typeof module != 'undefined' && module.exports) {
      exports = module.exports = LetterAvatar;
    }

    // But always support CommonJS module 1.1.1 spec (`exports` cannot be a function)
    exports.LetterAvatar = LetterAvatar;

  } else {

    window.LetterAvatar = LetterAvatar;

    d.addEventListener('DOMContentLoaded', function(event) {
      LetterAvatar.transform();
    });
  }

})(window, document);






(function (w, SA, $) {

  'use strict';

  var $win = $(w),
    $body = $('body'),
    $header = $('#sa-hd'),
    $saNav = $header.find('#sa-nav'),
    $portfolioDropdown = $('.subnav-dropdown.my_portfolio-drop'),
    $tabDropdowns = $('.tab.dropdown'),
    config = SA.headerConfig || {},
    user = SA.Data.User,
    c = SA.Data.Cache,
    lastScrollTop = 0,
    userPortfolios = user ? user.getPortfolios() : [],
    $mpHeader = $header.find('#top-menu-wrapper-row');

  function setScrollingBehavior() {
    var fix = false,
      stickClass = 'stick-hd';

    function stickHd() {
      if (!fix) {
        $body.addClass(stickClass);
        fix = true;
      }
    }

    function unStickHd() {
      if (fix) {
        $body.removeClass(stickClass);
        fix = false;
      }
    }

    function getHeight() {
      var breakingNewsHeight = $('#breaking-news').outerHeight() || 0;
      return breakingNewsHeight + 1;
    }

    function handleScroll() {
      $header.css('left', -window.scrollX + 'px');

      if ($win.scrollTop() >= getHeight()) {
        stickHd();
        var scrollingDirection = detectScrollingDirection($win);
        if (scrollingDirection === 'up') {
          showNavigationLinks();
        } else if (scrollingDirection === 'down') {
          $tabDropdowns.removeClass('focus');
          hideNavigationLinks();
        }
      } else {
        unStickHd();
      }
    }

    function showNavigationLinks() {
      $header.addClass('slideup');
    }

    function hideNavigationLinks() {
      $header.removeClass('slideup');
    }

    function detectScrollingDirection($win) {
      var st = window.pageYOffset || $win.scrollTop,
        direction = '';
      if (st > lastScrollTop) {
        direction = 'down';
      } else if (st < lastScrollTop) {
        direction = 'up';
      }
      lastScrollTop = st <= 0 ? 0 : st; // For Mobile or negative scrolling
      return direction;
    }

    if (!config.nonFixed && !config.tabless && getHeight() && !$('body').hasClass('no-stick')) {
      $win.scroll(handleScroll);
      handleScroll();
    }
  }

  function activateTab($elem, tabName) {
    $elem.find(tabName).parent().addClass('active');
  }

  function setActiveItems() {
    if (!config.tabless) {
      activateTab($saNav, config.activeTab);
    }
  }

  function getSubnavsFromCache() {
    return JSON.parse(c.get('subnavs_data_' + (user.id() || 0)));
  }

  function formatLinksData(obj) {
    return {url: obj.link, sasource: obj.sasource};
  }

  function setMenuHover(portfolioExists) {
    var $listItems = $saNav.find('li.dropdown');

    if (!portfolioExists) {
      $listItems = $listItems.not('.my_portfolio');
      $portfolioDropdown.remove();
      $('#header-port-js').removeClass('touchable');
    }

    $listItems.hoverIntent({
      over: function () {
        var $this = $(this), type, allData, data;
        $this.addClass('focus').siblings().addClass('no-focus');

        if ($this.hasClass('analysis') || $this.hasClass('news')) {
          type = $(this).hasClass('analysis') ? 'analysis_menu' : 'news_menu';
          allData = getSubnavsFromCache();

          if (allData) {
            data = $(this).hasClass('analysis') ? allData.analysis : allData.news;

            SA.Logger.Mone.event(type, 'header', 'hover', {
              data: {
                MostUsed: data[0].map(formatLinksData),
                Recommended: data[1].map(formatLinksData)
              }
            });
          }
        } else if ($this.hasClass('my_portfolio')) {
          SA.Logger.Mone.event('portfolio_menu', 'header', 'hover');
        }
      },
      out: function () {
        $(this).removeClass('focus').siblings().removeClass('no-focus');
      },
      interval: 0
    });

    $saNav.find('a.touchable').on('touch touchend', function (e) {
      e.preventDefault();
      $tabDropdowns.removeClass('focus');
      $(this).parent('.tab.dropdown').toggleClass('focus');
    });
  }

  function setPortfolios(itemClassName, portfolios, extraClass) {
    $portfolioDropdown.find('.' + itemClassName).replaceWith(w.JST['jst/header/portfolios_list']({
      portfolios: portfolios.slice(0, 100),
      extraClass: extraClass
    }));
  }

  // DON'T REMOVE - will be used in September by Media Sales
  function setModelPortfolios(cb) {
    $.get('/account/ajax_get_model_portfolios').done(function (res) {
      var addedModelPortfoliosIds = user.getAddedModelPortfoliosIds(),
        modelPortfolios = res.model_portfolios.filter(function (item) {
          return addedModelPortfoliosIds.indexOf(item.portfolio_id) === -1;
        });
      if (modelPortfolios.length) {
        setPortfolios('model_portfolios', modelPortfolios, 'sponsored-item');
      } else {
        $portfolioDropdown.find('.model_portfolios').closest('ul').remove();
      }
      if ($.isFunction(cb)) {
        cb();
      }
    }).fail(function (response) {
      SA.exceptions.push(['ajax_get_model_portfolios error', {}, {
        status: response.status,
        statusText: response.statusText,
        responseText: response.responseText
      }]);
    });
  }

  function setUserPortfolios() {
    setPortfolios('user_portfolios', userPortfolios);
  }

  function setLastUsedMyPortfolioTab() {
    var k = 'last_used_portfolio_tab', l = c.get(k);
    if (l) {
      $('#nav_my_portfolio_tab').children('a').attr('href', l);
    }
  }

  function setLastUsedPeopleTab() {
    var url = c.get('last_used_people_tab');
    if (url) {
      $('#nav_people_tab').find('a').attr('href', url);
    }
  }

  function initPortfolios() {
    setUserPortfolios();
    setMenuHover(true);
  }

  function setCtaButton() {
    if (user.loggedIn() && !user.isCommonPro()) {
      if (user.isFp()) {
        SA.Utils.AbTests.init({
          'proplus_vs_subscriptions_test': function (variation) {
            if (variation === 'test_v1') {
              $('#top-nav-cta').attr('href', '/proplus');
            }
          }
        });
      } else {
        SA.Utils.AbTests.init({
          'premium_vs_subscriptions_test': function (variation) {
            if (variation === 'test_v1') {
              $('#top-nav-cta, .navbar-nav a.tab-a[href="/subscriptions"]').attr('href', '/premium');
            }
          }
        });
      }
    }
  }

  function init() {
    if ($header.length) {
      if (user.loggedIn() && userPortfolios.length) {
        initPortfolios();
      } else {
        setMenuHover(false);
      }
      setActiveItems();
      setScrollingBehavior();
      setLastUsedMyPortfolioTab();
      setLastUsedPeopleTab();
      setCtaButton();
    }
  }

  init();

}(window, window.SA || {}, window.jQuery));

(function (SA, $) {

  'use strict';

  function init(){
    $('a').on('click', function(){
      var $this = $(this);
      if(SA.Utils.Validate.isExternalLink($this.attr('href') || '')){
        $this.attr('target', '_blank');
        $this.attr('rel', $this.attr('rel') ? $this.attr('rel') + " noopener" : "noopener");
      }
    });
  }

  init();

}(window.SA || {}, window.jQuery));

(function(w, SA, $){

  'use strict';

  var scope = SA.UsingNamespace('SA.Models.Authentication'), conf = SA.pageConfig || {};

  scope.staticLoginLink = SA.App.host + '/account/login';

  var showGoogleLogin = function(linkUrl, width, height) {
    var left = (screen.width - width) / 2 - 16,
        top = (screen.height - height) / 2 - 50,
        windowFeatures = 'menubar=no,toolbar=no,status=no,width=' + width + ',height=' + height + ',left=' + left + ',top=' + top;
    return window.open(linkUrl, 'authPopup', windowFeatures);
  };

  var flushUserCookies = function(){
    SA.Data.Cookies.expireByPrefix('user_').expireByPrefix('notice_').expire('author_slug').expire('last_comment').expire('last_comment_date').expire('mybbuser').expire('adminsid').expire('sapu').expire('tou').expireByPrefix('gk_user_');
    SA.Data.Cache.del('user_update_note_cookies');
    SA.Data.Cache.del('user_notifications');
  };

  var performLogout = function(callback){
    SA.Logger.Mone.event('log_out', 'user_menu', 'clicked');
    $.post(SA.App.host + '/account/ajax_logout').always(function(){
      flushUserCookies(); // Just in case. Normally server should delete all cookies.
      if ($.isFunction(callback)) {
        callback();
      }
    });
  };

  var performLogin = function(opt) {
    $.ajax({
      method: 'POST',
      dataType: 'json',
      url: SA.App.host + '/authentication/login',
      data: {
        user: {
          email: opt.email,
          password: opt.password
        },
        id: opt.id,
        activity: opt.activity,
        'function': opt['function'],
        rta_slugs: opt.rtaSlugs,
        rta_add_alerts: opt.rtaAddAlerts,
        extra: opt.extra
      }
    }).done(function(response) {
      if (response.login) {
        SA.Logger.Mone.event('registration', 'email', 'login_success', {
          data: {
            source: 'pop-up'
          }
        }).always(function () {
          if ($.isFunction(opt.onSuccess)) {
            opt.onSuccess(response, opt);
          }
        });
      } else if ($.isFunction(opt.onSuccess)) {
        opt.onSuccess(response, opt);
      }
    }).fail(function(response) {
      if($.isFunction(opt.onFailure)) {
        opt.onFailure(response, opt);
      }
    });
  };

  var performLoginLimitedUser = function(opt) {
    $.ajax({
      method: 'POST',
      dataType: 'json',
      url: SA.App.host + '/authentication/login_limited_user',
      data: {
        password: opt.password
      }
    }).done(function(response) {
      if($.isFunction(opt.onSuccess)) {
        opt.onSuccess(response, opt);
      }
    }).fail(function(response) {
      if($.isFunction(opt.onFailure)) {
        opt.onFailure(response, opt);
      }
    });
  };

  var performSignUp = function(opt) {
    $.ajax({
      method: 'POST',
      dataType: 'json',
      url: SA.App.host + '/authentication/registration',
      data: {
        user: {
          email: opt.email,
          password: opt.password,
          nick: opt.nick
        },
        id: opt.id,
        activity: opt.activity,
        'function': opt['function'],
        url_source: location.href.replace(/\?.*$/, ''),
        referrer: conf.sessionReferrer,
        rta_source: opt.rtaSource ,
        rta_slugs: opt.rtaSlugs,
        author_tag_id_to_follow: opt.authorTagId,
        force_params: opt.rtaSource,
        rta_add_alerts: opt.rtaAddAlerts,
        article_id: opt.articleId,
        sender: opt.sender,
        extra: opt.extra,
        newsletter: opt.newsletter
      }
    }).done(function(response) {
      if (response.registration) {
        var source = 'nonconfirmed_signup';
        SA.Vendor.Gtm.event('registration', {
          category: 'Registration',
          action: 'Signup',
          label: w.location.href
        });
        SA.Logger.Mone.event('registration', source, 'accepted', {
          data: {
            source: 'pop-up'
          }
        }).always(function () {
          if ($.isFunction(opt.onSuccess)) {
            opt.onSuccess(response, opt);
          }
        });
      } else if ($.isFunction(opt.onSuccess)) {
        opt.onSuccess(response, opt);
      }
    }).fail(function(response) {
      if($.isFunction(opt.onFailure)) {
        opt.onFailure(response, opt);
      }
    });
  };

  var performCheckEmail = function(opt) {
    $.ajax({
      method: 'POST',
      dataType: 'json',
      url: '/authentication/check_email',
      data: {
        user: {email: opt.email},
        rb_user: opt.rb_user
      }
    }).done(function(response) {
      if($.isFunction(opt.onSuccess)) {
        opt.onSuccess(response, opt);
      }
    }).fail(function() {
      if($.isFunction(opt.onFailure)) {
        opt.onFailure();
      }
    });
  };

  var resendConfirmation = function(opt) {
    $.ajax({
      method: 'POST',
      dataType: 'json',
      url: '/authentication/send_confirmation_email',
      data: {email:opt.email}
    }).done(function(response) {
      if($.isFunction(opt.onSuccess)) {
        opt.onSuccess(response, opt);
      }
    }).fail(function(response) {
      if($.isFunction(opt.onFailure)) {
        opt.onFailure(response, opt);
      }
    });
  };

  var performReset = function(opt) {
    $.ajax({
      method: 'POST',
      dataType: 'json',
      url: '/authentication/forgot_password',
      data: {
        user: {email: opt.email},
        id: opt.id,
        activity: opt.activity,
        'function': opt['function'],
        url_source: SA.App.host + SA.Utils.SASource.safeUrl()
      }
    }).done(function(response) {
      if($.isFunction(opt.onSuccess)) {
        opt.onSuccess(response, opt);
      }
    }).fail(function(response) {
      if($.isFunction(opt.onFailure)) {
        opt.onFailure(response, opt);
      }
    });
  };

  var requestOneClickLogin = function(opt) {
   $.ajax({
      method: 'POST',
      dataType: 'json',
      url: '/account/one_click_login/login_link',
      data: {
        user: {email: opt.email},
        id: opt.id,
        activity: opt.activity,
        'function': opt['function'],
        url_source: SA.Utils.SASource.safeUrl()
      }
    }).done(function(response) {
      if($.isFunction(opt.onSuccess)) {
        opt.onSuccess(response, opt);
      }
    }).fail(function(response) {
      if($.isFunction(opt.onFailure)) {
        opt.onFailure(response, opt);
      }
    });
  };

  // public functions

  var registerRoadblockAlerts = function() {
    $.ajax({
      method: 'POST',
      dataType: 'json',
      url: '/authentication/ajax_roadblock_subscribe',
      data: {}
    }).fail(function(res) {
      Rollbar.error("General error while subscribing roadblock user via g-plus: " + res.responseText || res.errors);
    });
  };

  //Gplus registration/login events
  var sendEventsGplusRegistration = function() {
    var cp = SA.Data.Cookies;
    var newSignUpFromRb = cp.get('gplus_new_sign_up_from_roadblock');
    var source = '';

    if (cp.get('gplus_button_registration') && SA.Data.User.loggedIn() && !SA.Data.User.getPortfolioTickers().length) {
      if (cp.get('gplus_new_user') && !newSignUpFromRb) {
        var event = cp.get('gplus_button_registration').split(',');
        SA.Logger.Mone.event(event[0], event[1], 'Registration conversion no alerts', {
          data: {
            user_id: SA.Data.User.id()
          }
        });
        cp.set('gplus_new_user');
        cp.set('gplus_button');
        window.new_registration_gplus = true;
      }
      if (!location.pathname.match(/article/)) {
        if (location.href.match(/step1/)) {
          cp.del('gplus_button_registration');
        } else {
          if (window.new_registration_gplus || newSignUpFromRb) {
            source = '?source=gplus_reg';
            window.new_registration_gplus = false;
          };
          setTimeout(function () {
            location.href = '/account/step1'+source;
          }, 1000);
        }
      }
    }

    if (cp.get('gplus_button') && !newSignUpFromRb) {
      var eventArray = cp.get('gplus_button').split(',');
      SA.Logger.Mone.event(eventArray[0], eventArray[1], 'login_success');
      cp.del('gplus_button');
      cp.del('gplus_button_registration');
    }

    if (newSignUpFromRb) {
      if (SA.Data.User.loggedIn()) {
        registerRoadblockAlerts();
      }
      SA.Logger.Mone.event('funnel_complete_popup', newSignUpFromRb , 'gplus_signup');
      cp.del('gplus_new_sign_up_from_roadblock');
      cp.del('gplus_roadblock_type');
      if (location.pathname.match(/article/)) {
        window.new_registration_gplus = true;
      }
    }
  };

  sendEventsGplusRegistration();

  scope.googleLogin = function(type, source, action, data) {
    var val = type + ',' + source,
      path = window.location.pathname,
      moneAction = action || 'button_clicked',
      cookieExpiration = 24 * 60 * 60; // expire cookie after 24 hours

    SA.Data.Cookies.set('gplus_button', val, {expires: cookieExpiration}).set('gplus_button_registration', val, {expires: cookieExpiration}).set('gplus_back_article', path, {expires: cookieExpiration});
    SA.Logger.Mone.event(type, source, moneAction, data);

    if (data && data.data.rbType) {
      SA.Data.Cookies.set('gplus_roadblock_type', data.data.rbType, {expires: cookieExpiration});
    }

    showGoogleLogin('/auth/gplus', 727, 630);
  };

  scope.logOut = function(callback) {
    performLogout(callback);
  };

  scope.logIn = function(opt) {
    opt = opt || {};
    if(opt.email && opt.password && opt.id && opt.activity && opt['function']) {
      performLogin(opt);
    }
  };

  scope.loginLimitedUser = function (opt) {
    opt = opt || {};
    if (opt.password) {
      performLoginLimitedUser(opt);
    }
  };

  scope.signIn = function(opt) {
    opt = opt || {};
    var missingNick = opt.activity !== 'roadblock' && !opt.nick;
    if(opt.email && opt.password && !missingNick && opt.id && opt.activity && opt['function']) {
      performSignUp(opt);
    }
  };

  scope.registerNoPw = function(opt){
    if(opt.email){
      performSignUp(opt);
    }
  };

  scope.checkEmail = function(opt){
    opt = opt || {};
    if(opt.email) {
      performCheckEmail(opt);
    }
  };

  scope.resendConfirmation = function(opt) {
    opt = opt || {};
    if(opt.email) {
      resendConfirmation(opt);
    }
  };

  scope.resetPassword = function(opt) {
    opt = opt || {};
    if(opt.email && opt.id && opt.activity && opt['function']) {
      performReset(opt);
    }
  };

  scope.oneClickLogin = function(opt) {
    requestOneClickLogin(opt);
  };

  scope.softRoadblockSignIn = function(opt) {
    performSignUp(opt);
  };


  scope.hardRoadblockSignIn = function(opt) {
    performSignUp(opt);
  };

}(window, window.SA, window.jQuery));
(function(){

  "use strict";

  var scope = SA.UsingNamespace("SA.Models.TradingAlert");

  scope.subscribe = function(onSuccess, opt) {
    opt = opt || {};
    $.post('/account/trading_alerts_subscribe', opt, onSuccess);
  };

  scope.unsubscribe = function(onSuccess, opt) {
    opt = opt || {};
    $.post('/account/remove_trading_alerts', opt, onSuccess);
  };

})();
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/banners/premium_top_v1"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div id="premium_banner" class="banner_',  bannerLocation ,' banner_',  bannerVersion ,' ',  pageType ,'">\n    <div class="container">\n        <div class="text-container">\n            <span>THE NEW</span>\n            ',  JST['jst/inline_svg/logo/premium']({
                  height: 32,
                  text_color: '#fff',
                  alpha_color: '#fff'}) ,'\n            <span>IS HERE</span>\n        </div>\n        <div class="cta-container">\n            <a class="btn" href="',  ctaLink ,'" sasource="banner_premium_',  bannerLocation ,':',  bannerVersion ,':',  pageType ,':',  shownRemaining ,'">',  ctaText ,'</a>\n        </div>\n        <button type="button" class="close">\n            <span></span>\n        </button>\n    </div>\n</div>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/banners/premium_top_v2"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div id="premium_banner" class="banner_',  bannerLocation ,' banner_',  bannerVersion ,' ',  pageType ,'">\n    <div class="container">\n        <div class="text-container">\n            <span class="green">NEW!</span>\n            ',  JST['jst/inline_svg/logo/premium']({
                  height: 32,
                  text_color: '#fff',
                  alpha_color: '#fff'}) ,'\n            <br>\n            <span>Institutional-grade tools and insights for investors who want to beat the market</span>\n        </div>\n        <div class="cta-container">\n            <a class="btn" href="',  ctaLink ,'" sasource="banner_premium_',  bannerLocation ,':',  bannerVersion ,':',  pageType ,':',  shownRemaining ,'">',  ctaText ,'</a>\n        </div>\n        <button type="button" class="close">\n            <span></span>\n        </button>\n    </div>\n</div>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/banners/premium_top_v3"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div id="premium_banner" class="banner_',  bannerLocation ,' banner_',  bannerVersion ,' ',  pageType ,'">\n    <div class="container">\n        <div class="text-container">\n            <span>UNLOCK THE POWER OF</span>\n            ',  JST['jst/inline_svg/logo/premium']({
                  height: 32,
                  text_color: '#fff',
                  alpha_color: '#fff'}) ,'\n        </div>\n        <div class="cta-container">\n            <a class="btn" href="',  ctaLink ,'" sasource="banner_premium_',  bannerLocation ,':',  bannerVersion ,':',  pageType ,':',  shownRemaining ,'">',  ctaText ,'</a>\n        </div>\n        <button type="button" class="close">\n            <span></span>\n        </button>\n    </div>\n</div>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/banners/premium_v1"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div id="premium_banner" class="banner_',  bannerLocation ,' banner_',  bannerVersion ,' ',  pageType ,'">\n    <div class="container">\n        <div class="text-container">\n            <span>The stock market can be extremely confusing</span>\n            <br>\n            <span>THE NEW</span>\n            ',  JST['jst/inline_svg/logo/premium']({
                  height: 32,
                  text_color: '#fff',
                  alpha_color: '#fff'}) ,'\n            <span>GIVES YOU CLARITY</span>\n        </div>\n        <div class="cta-container">\n            <a class="btn" href="',  ctaLink ,'" sasource="banner_premium_',  bannerLocation ,':',  bannerVersion ,':',  pageType ,':',  shownRemaining ,'">',  ctaText ,'</a>\n        </div>\n    </div>\n</div>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/banners/premium_v2"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div id="premium_banner" class="banner_',  bannerLocation ,' banner_',  bannerVersion ,' ',  pageType ,'">\n    <div class="container">\n        <div class="text-container">\n            <span>NEW!</span>\n            ',  JST['jst/inline_svg/logo/premium']({
                  height: 32,
                  text_color: '#fff',
                  alpha_color: '#fff'}) ,'\n            <br>\n            <span>Exclusive tools & insights for investors who want to beat the market</span>\n        </div>\n        <div class="cta-container">\n            <a class="btn" href="',  ctaLink ,'" sasource="banner_premium_',  bannerLocation ,':',  bannerVersion ,':',  pageType ,':',  shownRemaining ,'">',  ctaText ,'</a>\n        </div>\n    </div>\n</div>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/banners/premium_v3"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div id="premium_banner" class="banner_',  bannerLocation ,' banner_',  bannerVersion ,' ',  pageType ,'">\n    <div class="container">\n        <div class="text-container">\n            <span>NEW!</span>\n            ',  JST['jst/inline_svg/logo/premium']({
                  height: 32,
                  text_color: '#fff',
                  alpha_color: '#fff'}) ,'\n            <br>\n            <span>Exclusive tools & insights to take your performance to the next level</span>\n        </div>\n        <div class="cta-container">\n            <a class="btn" href="',  ctaLink ,'" sasource="banner_premium_',  bannerLocation ,':',  bannerVersion ,':',  pageType ,':',  shownRemaining ,'">',  ctaText ,'</a>\n        </div>\n    </div>\n</div>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/inline_svg/logo/premium"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('');  var text_color = text_color || '#000000' ; __p.push('\n');  var alpha_color = alpha_color || '#000000' ; __p.push('\n');  var product_color = product_color || '#00D885' ; __p.push('\n<!--auto-scale to support all browsers-->\n');  var width = height * (200.17 / 25.8) ; __p.push('\n\n<svg class="sa-logo-premium" data-name="Seeking Alpha PREMIUM" viewbox="0 0 200.17 25.8" height=',  height ,' width=',  width ,'>\n    <title>Seeking Alpha PREMIUM</title>\n    ',  JST['jst/inline_svg/logo/common']({
          text_color: text_color,
          alpha_color: alpha_color
      }) ,'\n    <path d="M134.5,21.3V11h3.88a9,9,0,0,1,1.57.1,3.06,3.06,0,0,1,1.27.48,2.6,2.6,0,0,1,.82,1,3.17,3.17,0,0,1,.31,1.41,3.2,3.2,0,0,1-.83,2.22,4,4,0,0,1-3,.91h-2.64V21.3Zm1.36-5.4h2.66a2.83,2.83,0,0,0,1.88-.49A1.75,1.75,0,0,0,141,14a1.87,1.87,0,0,0-.33-1.11,1.51,1.51,0,0,0-.86-.6,5.88,5.88,0,0,0-1.27-.09h-2.63Z" transform="translate(0 -0.58)" style="fill:',  product_color ,'"></path>\n    <path d="M144.11,21.3V11h4.56a5.93,5.93,0,0,1,2.09.28,2.22,2.22,0,0,1,1.14,1,2.87,2.87,0,0,1,.43,1.55,2.58,2.58,0,0,1-.71,1.84,3.6,3.6,0,0,1-2.19,1,3.24,3.24,0,0,1,.82.51,6.88,6.88,0,0,1,1.13,1.37l1.79,2.8h-1.71l-1.36-2.14c-.4-.62-.73-1.09-1-1.42a3.16,3.16,0,0,0-.69-.69,2.09,2.09,0,0,0-.62-.27,4.41,4.41,0,0,0-.76-.05h-1.58V21.3Zm1.36-5.75h2.92a4.33,4.33,0,0,0,1.46-.19,1.53,1.53,0,0,0,.8-.62,1.61,1.61,0,0,0,.28-.92,1.53,1.53,0,0,0-.53-1.2,2.52,2.52,0,0,0-1.68-.47h-3.25Z" transform="translate(0 -0.58)" style="fill:',  product_color ,'"></path>\n    <path d="M154.49,21.3V11h7.44v1.22h-6.08v3.15h5.69v1.2h-5.69v3.5h6.32V21.3Z" transform="translate(0 -0.58)" style="fill:',  product_color ,'"></path>\n    <path d="M164,21.3V11h2.05l2.43,7.29c.23.67.39,1.18.49,1.52.12-.38.3-.93.55-1.65L172,11h1.83V21.3h-1.31V12.69l-3,8.61h-1.23l-3-8.76V21.3Z" transform="translate(0 -0.58)" style="fill:',  product_color ,'"></path>\n    <path d="M176.25,21.3V11h1.36V21.3Z" transform="translate(0 -0.58)" style="fill:',  product_color ,'"></path>\n    <path d="M186.76,11h1.36v6a6.9,6.9,0,0,1-.35,2.46,3,3,0,0,1-1.26,1.48,4.5,4.5,0,0,1-2.41.57,5,5,0,0,1-2.36-.49,2.89,2.89,0,0,1-1.31-1.45A6.65,6.65,0,0,1,180,17V11h1.36V17a5.9,5.9,0,0,0,.25,2,1.92,1.92,0,0,0,.86,1,3,3,0,0,0,1.48.35,2.83,2.83,0,0,0,2.14-.68,3.92,3.92,0,0,0,.64-2.62Z" transform="translate(0 -0.58)" style="fill:',  product_color ,'"></path>\n    <path d="M190.35,21.3V11h2.05l2.43,7.29c.23.67.39,1.18.49,1.52.12-.38.3-.93.55-1.65L198.33,11h1.84V21.3h-1.32V12.69l-3,8.61h-1.22l-3-8.76V21.3Z" transform="translate(0 -0.58)" style="fill:',  product_color ,'"></path>\n</svg>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/inline_svg/logo/common"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<path d="M.39,18.27A9.05,9.05,0,0,1,0,20.1a5.33,5.33,0,0,0,3.34,1.18c2.79,0,5.07-1.74,5.07-4.67C8.41,12.24,2,13.76,2,10a2.42,2.42,0,0,1,2.58-2.4A2.63,2.63,0,0,1,7.07,9.37h.21a12.22,12.22,0,0,1,.55-1.68,4.64,4.64,0,0,0-2.93-1C2.44,6.71.35,8,.35,10.64c0,4.64,6.42,3,6.42,6.77a2.89,2.89,0,0,1-2.85,3A3.66,3.66,0,0,1,.6,18.27Z" transform="translate(0 -0.58)" style="fill:',  text_color ,'"></path>\n<path d="M18.41,18.93a4.56,4.56,0,0,1-3,1.41c-2.48,0-3.73-2-3.55-4.26h2.89c1.37,0,2.77,0,4.16.06.21-3.43-1.88-5-4.16-5-3.05,0-4.69,2.19-4.69,5,0,3.18,2,5,4.83,5A6.21,6.21,0,0,0,18.39,20Zm-6.58-3.61c.12-1.72,1-3.57,2.89-3.57s2.52,1.79,2.56,3.57Z" transform="translate(0 -0.58)" style="fill:',  text_color ,'"></path>\n<path d="M28.87,18.93a4.58,4.58,0,0,1-3,1.41c-2.48,0-3.73-2-3.54-4.26h2.89c1.37,0,2.77,0,4.16.06.2-3.43-1.89-5-4.16-5-3.06,0-4.7,2.19-4.7,5,0,3.18,2,5,4.84,5A6.26,6.26,0,0,0,28.85,20Zm-6.58-3.61c.12-1.72,1-3.57,2.89-3.57s2.52,1.79,2.56,3.57Z" transform="translate(0 -0.58)" style="fill:',  text_color ,'"></path>\n<path d="M32.68,5.64c-.31,0-.55.06-.82.06s-.55,0-.82-.06V21c.27,0,.53-.06.82-.06s.51,0,.82.06V16.86c0-.89.29-.95.74-.44,1.31,1.5,2.93,3.33,3.92,4.62.32,0,.65-.06,1-.06s.62,0,1,.06v-.1c-1.62-1.85-3.35-3.9-4.82-5.6,1.88-1.79,3.69-3.22,4.51-4v-.14c-.31,0-.56.06-.8.06s-.56,0-.82-.06L35.84,13l-1.27,1.29c-.27.27-1.36,1.44-1.79,1.21-.18-.1-.1-.41-.1-.67Z" transform="translate(0 -0.58)" style="fill:',  text_color ,'"></path>\n<path d="M42.52,11.24c-.3,0-.55.06-.82.06s-.55,0-.82-.06V21c.27,0,.54-.06.82-.06s.52,0,.82.06Zm.23-3.51a1.06,1.06,0,0,0-1-1,1,1,0,0,0,0,2.09,1.06,1.06,0,0,0,1-1" transform="translate(0 -0.58)" style="fill:',  text_color ,'"></path>\n<path d="M44.28,21c.27,0,.53-.06.82-.06s.51,0,.82.06V16.28c0-2.52.54-4.1,2.69-4.1,1.92,0,2.27,1.5,2.27,3.4V21c.27,0,.53-.06.82-.06s.51,0,.82.06V15.11c0-2.7-.92-4-3.3-4a3.68,3.68,0,0,0-3.3,2V11.24c-.31,0-.55.06-.82.06s-.55,0-.82-.06Z" transform="translate(0 -0.58)" style="fill:',  text_color ,'"></path>\n<path d="M58.24,20.87c1.53,0,3,.15,3,2.28,0,1.93-1.76,2.62-3.24,2.62-1.7,0-2.95-.82-2.95-2.48s1-2.44,3.18-2.42m4.34-9.69a5.24,5.24,0,0,1-1.48,0l-2.84-.1c-3-.11-4.14,1.27-4.14,3.26a3,3,0,0,0,2,2.93c-.8.35-1.41.78-1.41,1.76,0,1.25.66,1.56,1.25,1.66v.16a2.35,2.35,0,0,0-2.13,2.49c0,2.15,2,3,3.71,3,3.13,0,5.2-1.64,5.2-4,0-1.74-1.12-2.73-3.54-2.73H57.87c-1.23,0-2-.12-2-1,0-1.19,1.23-1,1.47-1,2.38,0,4.37-.95,4.37-3.18a3.38,3.38,0,0,0-1.41-2.71l2.25.19Zm-6.9,3.18c0-1.56.83-2.69,2.31-2.69s2.19,1.21,2.19,2.79a2.4,2.4,0,0,1-2.27,2.68c-1.5,0-2.3-1.33-2.23-2.78" transform="translate(0 -0.58)" style="fill:',  text_color ,'"></path>\n<path d="M75.84,6.71h-.47L69,21c.23,0,.45-.06.72-.06s.47,0,.76.06c.57-1.93,1.31-3.73,2-5.54h5.21c.82,1.87,1.55,3.84,2.15,5.54.35,0,.69-.06,1.08-.06S81.6,21,82,21Zm1.54,7.93H72.87L75.1,9.39Z" transform="translate(0 -0.58)" style="fill:',  text_color ,'"></path>\n<path d="M83.52,21c.27,0,.54-.06.82-.06s.52,0,.82.06V5.64c-.3,0-.55.06-.82.06s-.55,0-.82-.06Z" transform="translate(0 -0.58)" style="fill:',  text_color ,'"></path>\n<path d="M88.54,16.41c0-1.91.62-4.6,3-4.6,2.21,0,2.83,2.07,2.83,4.08,0,2.38-.74,4.45-2.81,4.45s-3-1.74-3-3.93m0,2.82h0a3.36,3.36,0,0,0,3.16,2c2.63,0,4.43-2,4.43-5.39,0-2.46-1.48-4.69-4.12-4.69a3.39,3.39,0,0,0-3.47,2.19h0V11.24c-.31,0-.55.06-.82.06s-.55,0-.82-.06V26.29c.27,0,.53-.07.82-.07s.51.05.82.07Z" transform="translate(0 -0.58)" style="fill:',  text_color ,'"></path>\n<path d="M97.91,21c.27,0,.53-.06.82-.06s.51,0,.82.06V15.46c0-2.13.84-3.28,2.69-3.28s2.27,1.13,2.27,3.4V21c.27,0,.53-.06.82-.06s.51,0,.82.06V15.11c0-2.58-.92-4-3.3-4a3.67,3.67,0,0,0-3.3,2V5.64c-.31,0-.55.06-.82.06s-.55,0-.82-.06Z" transform="translate(0 -0.58)" style="fill:',  text_color ,'"></path>\n<path d="M115.17,14.56c0-2.32-1.17-3.44-3.32-3.44a5.85,5.85,0,0,0-3.3,1.12v1.15h.22A2.57,2.57,0,0,1,111.21,12a2.18,2.18,0,0,1,2.4,2.4c0,1-.55,1.1-2.17,1.37-1.93.31-3.79.61-3.79,2.95a2.56,2.56,0,0,0,2.72,2.5,4.06,4.06,0,0,0,3-1.29l.18-.18c.16,1.21,1,1.37,2.11,1.19a4,4,0,0,0,.62-.21v-.45c-1.21.26-1.15-.15-1.15-.94Zm-1.64,4.37c0,.14-.41.49-.55.63a2.69,2.69,0,0,1-1.64.78,1.77,1.77,0,0,1-2-1.93c0-1.86,2.09-2.07,3.48-2.33l.72-.15Z" transform="translate(0 -0.58)" style="fill:',  text_color ,'"></path>\n<path d="M119,6.7c0,2.8,1.41,5.1,3.27,5.05,2.61-.09,3.37-2.27,3.37-5.08s-1.51-5.09-3.37-5.07c-2.3,0-3.27,2.3-3.27,5.1m-2,0C117.31.72,122,.58,122,.58c3.41,0,4.37,3.65,4.37,3.65a34.51,34.51,0,0,0,2-3.39h1.11c-2.27,5-2.18,7-2.18,7-.19,2.65,1.31,3.57,1.31,3.57,1.4.89,1.48-1.71,1.48-1.71a5.25,5.25,0,0,0,.5-.22c.74,3.62-1.48,3.37-1.48,3.37-1.74.18-2.48-2.64-2.48-2.64-2.46,3.24-5.29,2.54-5.29,2.54-4.85-.62-4.46-6-4.46-6" transform="translate(0 -0.58)" style="fill:',  alpha_color ,'"></path>\n');}return __p.join('');};
}).call(this);









SA.require(['SA.Utils.Ads'], function (ads) {
  (function (w, SA, $) {
    var scope = SA.UsingNamespace('SA.Widgets.PremiumBanner'),
      user = SA.Data.User,
      cache = SA.Data.Cache,
      pageData = SA.pageConfig ? SA.pageConfig.Data : {},
      pageType = w.location.pathname.split('/')[1] || 'home_page',
      isInnerBanner = isShowInnerBanner(),
      MAX_WEEK_CAP = 3,
      MAX_TOTAL_CAP = 6,
      imagePromises = [],
      bannerVersion,
      impressionsLimited,
      cacheKey,
      bannerLocation,
      shownRemaining,
      shownAllocated,
      topPremiumBannerHeight = 89,
      isNewNav = false,
      $body = $('body');

    function isIC() {
      var kvs = SA.Ads && SA.Ads.KVs && SA.Ads.KVs.get();
      return kvs && kvs.inc;
    }

    function isTakeoverAdDisplay() {
      return $.inArray(w.location.pathname, ['/', '/market-news']) > -1 && !ads.isDisabled('970x250,970x66,970x90');
    }

    function getInsertAfterSelector() {
      if (!isInnerBanner) {
        if(isNewNav) {
          return '#nav-tabs';
        } else {
          return 'body #sa-hd';
        }
      }

      switch (pageType) {
        case 'symbol':
          return '#after-title-content';
        case 'article':
          return '#article-options';
        default:
          return 'body #sa-hd';
      }
    }

    function isArticlePaywalled(reason) {
      return pageData.article && pageData.article.paywallReason && pageData.article.paywallReason === reason;
    }

    function isArticleSponsored() {
      return pageData.article && pageData.article.isSponsored;
    }

    function isArticleFreeMp() {
      return pageData.article && pageData.article.isFreeMpArticle;
    }

    function isArticleInsight() {
      return pageData.article && pageData.article.isInsight;
    }

    function isArticleIshares() {
      return pageData.isIshares;
    }

    function showBanner() {
      preloadImages();

      $.when.apply($, imagePromises).done(function () {
        var ctaLink,
          ctaText = user.loggedIn() && user.everPremium() ? 'Get started' : 'Try it Free';

        SA.Utils.AbTests.init({
          'premium_vs_subscriptions_test': function (variation) {
            switch (variation) {
              case 'test_v1':
                ctaLink = '/premium';
                break;
              default:
                ctaLink = '/subscriptions';
                break;
            }

            if(isNewNav) {
              var tempPaddingTop = parseInt($body.css('padding-top'));
              $body.css('padding-top', tempPaddingTop + topPremiumBannerHeight + 'px');
            }

            $(w.JST[getBannerTemplate()]({
              ctaLink: ctaLink,
              ctaText: ctaText,
              bannerVersion: bannerVersion,
              bannerLocation: bannerLocation,
              pageType: pageType,
              shownRemaining: shownRemaining
            }))
              .insertAfter(getInsertAfterSelector())
              .slideDown('slow', function () {
                SA.Logger.Mone.event('banner', pageType, 'shown', {
                  data: {
                    banner_version: bannerVersion,
                    banner_location: bannerLocation,
                    shown_remaining: shownRemaining,
                    shown_allocated: shownAllocated
                  }
                });

                updateViewsCache();

                if (!isInnerBanner) {
                  setEvents();
                  $body.addClass('includes-premium-banner'); // for portfolio right rail
                }
              });
          }
        });
      });

      function getImagesPath() {
        if (isInnerBanner) {
          if (pageType === 'symbol') {
            return ['/images/banners/premium_quote_bg.jpg'];
          } else if (pageType === 'article') {
            return ['/images/banners/premium_article_bg.jpg'];
          }
        } else {
          return ['/images/banners/premium_bg1.jpg', '/images/banners/premium_bg2.jpg'];
        }
      }

      function preloadImages() {
        var images = getImagesPath();
        images.forEach(function (img, i) {
          (function (url, promise) {
            var img = new Image();
            img.onload = function () {
              promise.resolve();
            };
            img.src = url;
          })(img, imagePromises[i] = $.Deferred());
        });
      }
    }

    function setEvents() {
      $('#premium_banner .close').one('click', function () {
        $('#premium_banner').remove();

        if(isNewNav) {
          var tempPaddingTop = parseInt($body.css('padding-top'));
          $body.css('padding-top', tempPaddingTop - topPremiumBannerHeight + 'px');
        }

        SA.Logger.Mone.event('banner', pageType, 'dismiss', {
          data: {
            banner_version: bannerVersion,
            banner_location: bannerLocation,
            shown_allocated: shownAllocated,
            shown_remaining: shownRemaining
          }
        });
      });
    }

    function getBannerTemplate() {
      var templateName = isInnerBanner ? 'premium_v' : 'premium_top_v';
      return 'jst/widgets/banners/' + templateName + bannerVersion.toString();
    }

    function updateViewsCache() {
      if (!impressionsLimited) {
        return;
      }

      var viewsArr = getViewsArray();
      viewsArr.push(Date.now());
      cache.setJson(cacheKey, viewsArr);
    }

    function exceededMaxCap() {
      if (!impressionsLimited) {
        return false;
      }
      return getUsedViewsNumber() >= MAX_TOTAL_CAP;
    }

    function exceededWeekCap() {
      if (!impressionsLimited) {
        return false;
      }

      var nowTs = Date.now(),
        weekTsDiff = 7 * 24 * 60 * 60 * 1000,
        weekViewsCount = 0;

      getViewsArray().forEach(function (ts) {
        if ((nowTs - ts) < weekTsDiff) {
          weekViewsCount++;
        }
      });
      return weekViewsCount >= MAX_WEEK_CAP;
    }

    function exceedDayCap() {
      if (!impressionsLimited) {
        return false;
      }

      var nowTs = Date.now(),
        lastViewTs,
        dayTSDiff = 24 * 60 * 60 * 1000,
        viewsArr = getViewsArray();

      if (!viewsArr.length) {
        return false;
      }

      lastViewTs = viewsArr.pop();
      return (nowTs - lastViewTs) < dayTSDiff;
    }

    function passedMonth() {
      if (!impressionsLimited) {
        return false;
      }

      var nowTs = Date.now(),
        firstViewTs,
        viewsArr = getViewsArray(),
        monthTsDiff = 30 * 24 * 60 * 60 * 1000;

      if (!viewsArr.length) {
        return false;
      }

      firstViewTs = viewsArr[0];
      return (nowTs - firstViewTs) > monthTsDiff;
    }

    function isUserEligible() {
      return !user.isCommonPro() && !user.isFp();
    }

    function isPageEligible() {
      var blacklist = ['/premium', '/proplus', '/subscriptions', '/checkout', '/get_started', '/marketplace', '/market-news/on-the-move'];
      return blacklist.indexOf(w.location.pathname) === -1 && w.location.host.indexOf('cms') === -1 && !$('body').hasClass('sa-error');
    }

    function isArticleEligible() {
      return !isArticleSponsored() && !isArticleInsight() && !isArticleIshares() && !isArticlePaywalled('pro_plus_paywall');
    }

    function exceedCap() {
      return exceedDayCap() || exceededWeekCap() || exceededMaxCap();
    }

    function getViewsArray() {
      return JSON.parse(cache.get(cacheKey)) || [];
    }

    function getUsedViewsNumber() {
      return getViewsArray().length;
    }

    function initTopBanner() {
      if (!isTakeoverAdDisplay() && !exceedCap() && !passedMonth()) {
        var max = 3;
        bannerVersion = Math.floor(Math.random() * max) + 1;
        showBanner();
      }
    }

    function initInnerBanner() {
      SA.Utils.AbTests.init({
        'premium_banner': function (variation) {
          bannerVersion = {
            test_v1: 1,
            test_v2: 2,
            test_v3: 3
          }[variation];

          // don't display inner banner for control group
          if (bannerVersion) { // banner 1/2/3
            showBanner();
          } else {
            isInnerBanner = false; // try to show top banner instead
            init(); // re-set banner parameters and init again
          }
        }
      });
    }

    function isShowInnerBanner() {
      if (pageType === 'symbol') {
        return true;
      } else if (pageType === 'article') {
        return user.loggedIn() && !isArticlePaywalled('pro_paywall') && !isArticleFreeMp();
      }
      return false;
    }

    function isShowBanner() {
      return isUserEligible() && isPageEligible() && isArticleEligible() && !isIC();
    }

    function setBannerParams() {
      impressionsLimited = !isInnerBanner; // impressions are limited for top banner only
      cacheKey = isInnerBanner ? null : 'premium_top_banner_views';
      bannerLocation = isInnerBanner ? 'content_based' : 'top';
      shownRemaining = impressionsLimited ? MAX_TOTAL_CAP - getUsedViewsNumber() : 'unlimited';
      shownAllocated = impressionsLimited ? MAX_TOTAL_CAP : 'unlimited';
    }

    function initNavAbTest() {
      SA.Utils.AbTests.init({
        'premium_vs_subscriptions_test': function (variation) {
          if(variation === 'nav_black') {
            isNewNav = true;
          }
        }
      });
    }

    function init() {
      if (isShowBanner()) {
        initNavAbTest();
        setBannerParams();
        if (isInnerBanner) { // symbol/article page
          initInnerBanner();
        } else {
          initTopBanner();
        }
      }
    }

    scope.init = init;

    init();

  })(window, window.SA, window.jQuery);
}, 'premium-banner');
(function (SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Models.SubscriptionModel');

  scope.subscribe = function (opt) {
    opt = opt || {};
    if (isValid(opt)) {
      var data = {tags: opt.tagIds, modes: opt.modes, source: opt.source};

      $.post('/account/ajax_subscribe_to_tags', data).done(function (res) {
        if (res && !res.msg && res.slugs) {
          kruxPortfolioEvent(res.slugs[0]);

          if ($.isFunction(opt.onSuccess)) {
            opt.onSuccess(res);
          }
        } else if ($.isFunction(opt.onFailure)) {
          opt.onFailure(res);
        }
      }).fail(opt.onFailure)
        .always(opt.onAlways);
    }
  };

  scope.unsubscribe = function (opt) {
    opt = opt || {};
    if (isValid(opt)) {
      var data = {tags: opt.tagIds, modes: opt.modes};

      $.post('/account/ajax_unsubscribe_from_tags', data).done(function (res) {
        if (res && !res.msg && res.slugs) {
          if ($.isFunction(opt.onSuccess)) {
            opt.onSuccess(res);
          }
        } else if ($.isFunction(opt.onFailure)) {
          opt.onFailure(res);
        }
      }).fail(opt.onFailure)
        .always(opt.onAlways);
    }
  };

  scope.unsubscribeAll = function (opt) {
    if (opt.auth) {
      $.post('/account/ajax_unsubscribe_all', {
        auth: opt.auth,
        daily_pre_market: !!opt.dailyPreMarket,
        essentials: !!opt.essentials
      }).done(opt.onSuccess).fail(opt.onFailure);
    }
  };

  function isValid(opt) {
    return SA.Data.User.loggedIn() && !$.isEmptyObject(opt) && opt.tagIds && opt.modes;
  }

  function kruxPortfolioEvent(slug) {
    if (typeof(slug) === 'string') {
      $('#krux_container_rta').remove();
      var html = ['<div id="krux_container_rta" style="display:none">',
        '<div id="rta_added_', slug.toLowerCase(), '"></div>',
        '<img src="https://beacon.krxd.net/event.gif?event_id=KRoUG3qj&event_type=cact&RTA_Added=1"/>',
        '</div>'];

      $('body').append(html.join(''));
    }
  }

}(window.SA, window.jQuery));
(function (w, SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Models.PortfolioModel'),
    user = SA.Data.User,
    portfolio = {
      name: 'Portfolio 1',
      stocks: {},
      stocksCount: function () {
        return this.stocks && Object.keys(this.stocks).length;
      }
    },
    curDiff = {added: [], removed: []};

  scope.listPortfolios = function (onSuccess, onFailure, searchSymbol) {
    // taken from public/javascripts/models/portfolioModel to work the top add portfolio button on quote page
    var data = searchSymbol ? {sym: searchSymbol} : {};
    $.get('/account/get_portfolios_list', data).done(onSuccess).fail(function () {
      if ($.isFunction(onFailure)) {
        onFailure('Unknown error');
      }
    });
  };

  scope.getPortfolio = function () {
    return portfolio;
  };

  scope.renamePortfolio = function (title, uriName, callback) {
    $('#p_name_pop').focus();

    var $error = $('#p_name_error');
    if (!title.length) {
      $error.text('Portfolio name must not be empty');
      return;
    }

    if (title.length > 50) {
      $error.text("Portfolio name can't be longer than 50 characters");
      return;
    }

    $error.html('&nbsp;');

    $.post('/account/portfolio/rename_portfolio', {
      'portfolio[title]': title,
      'portfolio[pu]': uriName
    }, function (res) {
      if (res && !res.errors && $.isFunction(callback)) {
        callback(res);
      }
    });
  };

  scope.deletePortfolio = function (uriName, callback) {
    if (SA.Data.User.isLimited()) {
      Rollbar.log('limited user is trying to delete a portfolio');
      return;
    }

    if (uriName) {
      $.post('/account/portfolio/delete_portfolio', {pu: uriName}, function (res) {
        if (res && !res.errors && $.isFunction(callback)) {
          callback(res);
        }
      });
    }
  };

  scope.addSymbols = function (options) {
    options = options || {};

    if (options.symbols) {
      var portfolioTickers = Object.keys(portfolio.stocks),
        symbols = $.grep(options.symbols.split(','), function (s) {
          if (portfolioTickers.indexOf(s.toLowerCase().replace(/ /g, '')) === -1) {
            return s;
          }
        });

      if (symbols.length) {
        var data = {
          symbols: symbols.join(','),
          pu: options.pu || '',
          rta: options.alerts || ''
        };

        $.post('/account/portfolio/add_symbols', data, function (res) {
          res = res || {};
          var slugs = res.recognized, tags = res.recognized_tags;

          if (!res.errors && slugs.length && tags.length && slugs.length === tags.length) {
            var isPortfolio = isCurrentPortfolio([res.portfolio]),
              added = [],
              arr = user.getPortfolioTickers().split(',');

            for (var i = 0, t; i < slugs.length; i++) {
              t = {
                slug: slugs[i].toLowerCase().replace(/ /g, ''),
                tag: tags[i]
              };

              if (isPortfolio && !portfolio.stocks[t.slug]) {
                portfolio.stocks[t.slug] = t.tag;
              }

              added.push(t);

              if (arr.indexOf(t.slug) === -1) {
                arr.push(t.slug);
              }
            }

            update(arr, added, []);

            if ($.isFunction(options.onComplete)) {
              options.onComplete(options, res);
            }

            kruxPortfolioEvent(slugs[0], data.rta);
          } else {
            if (res.errors) {
              alert(res.errors);
            }

            if ($.isFunction(options.onFailed)) {
              options.onFailed();
            }
          }
        }).fail(options.onFailed);
      } else if ($.isFunction(options.onFailed)) {
        options.onFailed();
      }
    }
  };

  scope.removeSymbols = function (opt) {
    if (opt.slugs.length || opt.tagIds.length) {
      var d = {
        all_portfolios: opt.allPortfolios,
        slugs: (opt.slugs || []).join(','),
        tag_ids: (opt.tagIds || []).join(',')
      };

      $.post('/account/portfolio/remove_symbols', d, function (res) {
        if (res && !res.errors) {
          var isPortfolio = isCurrentPortfolio(res.portfolios),
            removed = [],
            arr = user.getPortfolioTickers().split(',');

          $.each(res.removed_slugs, function (i, slug) {
            if (isPortfolio && portfolio.stocks[slug]) {
              delete portfolio.stocks[slug];
            }

            removed.push(slug);

            if (arr.indexOf(slug) > -1) {
              arr.splice(arr.indexOf(slug), 1);
            }
          });

          update(arr, [], removed);

          if ($.isFunction(opt.onComplete)) {
            opt.onComplete(res.portfolios);
          }
        } else if ($.isFunction(opt.onFailure)) {
          opt.onFailure(res);
        }
      }).fail(opt.onFailure);
    }
  };

  scope.getSubscribeData = function (slug, onComplete) {
    $.get('/memcached2/get_subscribe_data/' + slug, {id: slug}, function (res) {
      res = res || {};

      if (!res.errors && $.isFunction(onComplete)) {
        onComplete(res);
      }
    });
  };

  scope.createPortfolio = function (opt) {
    var clb = opt.callback || {},
      d = {
        name: opt.name,
        stocks: opt.stocks.join(','),
        rta: opt.rtaTypes || 'rta_articles,rta_market_currents,filings,trading_rta',
        source: opt.source
      };
      if (opt.is_model_portfolio) {
        $.extend(d, {portfolio_id: opt.portfolio_id, is_model_portfolio: true});
      }

    $.post('/account/add_new_portfolio', d, function (res, status) {
      if (status === 'success' && !res.errors) {
        SA.Vendor.Gtm.event('portfolio_created', {
          category: 'Portfolio',
          action: 'Creation',
          label: w.location.href
        });

        if (!d.is_model_portfolio) {
          scope.createPortfolioOfSlugsTags(res.title, res.stocks, res.stock_ids);
          updateUserPortfolios({portfolio_id: res.portfolio_uri.split('-')[0], portfolio_name: res.title});
        }

        if ($.isFunction(clb.done)) {
          clb.done(res);
        }
      } else if ($.isFunction(clb.fail)) {
        clb.fail(res);
      }
    }).fail(clb.fail);
  };

  scope.createPortfolioOfSlugsTags = function (portfolioName, slugs, tags, iex_slugs) {
    portfolio.name = portfolioName;
    portfolio.stocks = {};
    portfolio.sa_iex = {};

    for (var q in slugs) {
      if (slugs.hasOwnProperty(q)) {
        portfolio.stocks[slugs[q]] = tags[q];
      }
    }
    portfolio.sa_iex = iex_slugs;

    return portfolio;
  };

  scope.getSlugs = function () {
    return $.map(portfolio.stocks, function (tagId, slug) {
      return slug;
    });
  };

  scope.getDiff = function () {
    return curDiff;
  };

  function isCurrentPortfolio(portfolios) {
    var isPortfolio = false;
    $.each(portfolios, function () {
      if (portfolio.name.indexOf(this.id + '-') > -1) {
        isPortfolio = true;
      }
    });
    return isPortfolio;
  }

  function update(userWatchlistSlugs, addedSlugs, removedSlugs) {
    w.user_cookie.user_watchlist_slugs = userWatchlistSlugs.join(',');

    curDiff.added = addedSlugs;
    curDiff.removed = removedSlugs;
  }

  function kruxPortfolioEvent(slug, rta) {
    if (typeof(slug) === 'string') {
      var html;
      if (rta) {
        $('#krux_container_rta').remove();
        html = ['<div id="krux_container_rta" style="display:none">',
          '<div id="rta_added_', slug.toLowerCase(), '"></div>',
          '<img src="https://beacon.krxd.net/event.gif?event_id=KRoUG3qj&event_type=cact&RTA_Added=1"/>',
          '</div>'];
      } else {
        $('#krux_container').remove();
        html = ['<div id="krux_container" style="display:none">',
          '<div id="portfolio_added_', slug.toLowerCase() + '"></div>',
          '<img src="https://beacon.krxd.net/event.gif?event_id=KRq8URwJ&event_type=cact&Portfolio_Add=1"/>',
          '</div>'];
      }

      $('body').append(html.join(''));
    }
  }

  function updateUserPortfolios(newPortfolio) {
    var userPortfolios = w.user_cookie.user_portfolios;
    userPortfolios.push(newPortfolio);
    w.user_cookie.user_portfolios = userPortfolios.sort(function (a, b) {
      return a.portfolio_name - b.portfolio_name;
    });
  }

}(window, window.SA, window.jQuery));



(function (SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Widgets');
  scope.AddTickerByClick = function (slug , moneSource, options) {
    if (!slug) return;
    options = options || {};
    if (!SA.Data.User.loggedIn() && SA.Widgets.AuthenticationPopup) {
      var bi = biData(options.mone_type, moneSource, slug);
      return SA.Widgets.AuthenticationPopup.show({
        rtaSlugs: slug,
        extra: {bi: bi},
        onLoginSuccess: onLoginSuccess
      });
    }

    var _this = this;
    _this.has_rta_temp = [];
    _this.has_slugs_temp = [];
    var ticker = slug;
    var portfolioModel = SA.Models.PortfolioModel;
    var slugs = options.slugs || SA.Data.User.getPortfolioTickers(); // check by specific slugs
    var sucModal = null;

    var initOpt = (function (opt) {
      return {
        toEmail: opt.toEmail || false,
        onComplete: opt.onComplete
      }
    })(options);


    var delegate = (function (type, source, ticker, bi) {
      var bi = bi(type, source, ticker);

      return {
        clickedAddToPortfolio: function () {
          SA.Logger.Mone.event(bi.type, bi.source, 'ticker_added_to_portolio', bi.data);
        },
        emailAlertPopupClicked: function () {
          SA.Logger.Mone.event(bi.type, bi.source, 'rta_added', bi.data);
        },
        emailAlertNoThanks: function () {
          SA.Logger.Mone.event(bi.type, bi.source, 'rta_no_thanks_clicked', bi.data);
        }
      }
    })(options.mone_type, moneSource, ticker, biData);

    this.init = function () {
      if (ticker) {
        if (initOpt.toEmail) {
          return addToEmail();
        }
        checkTicker();
      }
    };

    function biData(moneType, moneSource, slug) {
      return {
        type: options && options.mone_type || 'tooltip c',
        source: moneSource || 'Add_ticker',
        data: {data: {'ticker': slug, 'login': 'true'}}
      };
    }

    //this strategy executed only from add iframe
    function addToEmail() {
      if (hasPortfolioSlug()) {
        if (_this.hasRta()) {
          _this.thankyouMsg();
        } else {
          addRta();
        }
      } else {
        addSlugToEmail();
      }
    }

    function addSlugToEmail() {
      portfolioModel.addSymbols({
        symbols: ticker,
        onComplete: function (options, res) {
          delegate.clickedAddToPortfolio();
          _this.has_slugs_temp.push(ticker.toLowerCase());
          delegate.emailAlertPopupClicked();
          SA.Models.SubscriptionModel.subscribe({
            tagIds: ticker,
            modes: 'rta_articles,rta_market_currents,filings,trading_rta',
            source: 'add_to_portfolio_widget',
            onSuccess: function () {
              sucModal = SA.Widgets.Popup.build({
                bodyContent: getThanksBody(ticker),
                showHeader: false,
                showBodyCloseBtn: true,
                showFooter: false,
                className: 'sa-modal income already',
                backdrop: true,
                removeAfterClose: true
              });
              if (!SA.Widgets.Popup.isRunning()) {
                sucModal.show();
              }
              _this.has_rta_temp.push(ticker.toLowerCase());
            }
          });

          if ($.isFunction(initOpt.onComplete)) {
            initOpt.onComplete();
          }
        },
        onFailed: sucModal.hide
      });
    }

    function checkTicker() {
      if (hasPortfolioSlug()) {
        if (_this.hasRta()) {
          _this.thankyouMsg();
        } else {
          addRta();
        }
      } else {
        addPortfolioSlug();
      }
    }

    function addRta() {
      var emailAlertsPopup = function () {
        var dataArr = ["<div class='ticker_to_portfolio add_rta_container'>",
          "<div class='ticker_to_portfolio add_rta_title'>Do you also want to get email alerts on <strong>", ticker.toUpperCase(), "</strong>?</div>",
          "<div class='ticker_to_portfolio buttons_containter'>",
          "<div class='ticker_to_portfolio get_alerts'><span class='ticker_to_portfolio get_alerts_span' id='add_rta_add_to_portfolio'>Get Alerts</span></div>",
          "<div class='ticker_to_portfolio no_thanks_containter'><span class='ticker_to_portfolio no_thanks' id='no_thanks_add_to_portfolio'>No Thanks</span></div>",
          "</div>",
          "</div>"];
        sucModal = SA.Widgets.Popup.build({
          bodyContent: dataArr.join(''),
          backdrop: true,
          showHeader: true,
          showBodyCloseBtn: false,
          className: 'sa-modal income',
          removeAfterClose: true,
          afterOpen: afterOpenPopup
        });

        if (!SA.Widgets.Popup.isRunning()) {
          sucModal.show();
        }

        function afterOpenPopup() {
          $('#no_thanks_add_to_portfolio').click(function () {
            delegate.emailAlertNoThanks();
            sucModal.hide();
          });

          $('#add_rta_add_to_portfolio').click(function () {
            delegate.emailAlertPopupClicked();
            SA.Models.SubscriptionModel.subscribe({
              tagIds: ticker,
              modes: 'rta_articles,rta_market_currents,filings,trading_rta',
              source: 'add_to_portfolio_widget',
              onSuccess: function () {
                ShowThanksWithRta();
                _this.has_rta_temp.push(ticker.toLowerCase());
              }
            });
          });
        }
      };

      emailAlertsPopup();
    }

    function hasPortfolioSlug() {
      var slugsArr = slugs.length ? slugs.split(',') : [];
      return slugsArr.concat(_this.has_slugs_temp).indexOf(ticker.toLowerCase()) > -1;
    }

    function addPortfolioSlug() {
      portfolioModel.addSymbols({
        symbols: ticker,
        onComplete: function(options, res) {
          delegate.clickedAddToPortfolio();

          addRta();

          if ($.isFunction(initOpt.onComplete)) {
            initOpt.onComplete()
          }
        },
        onFailed: function() {
          sucModal.hide()
        }
      });
      _this.has_slugs_temp.push(ticker.toLowerCase());
    }

    var getThanksBody = function(ticker) {
      var dataArr = ["<div class='ticker_to_portfolio add_rta_container'>",
        "<div class='ticker_to_portfolio add_rta_title'><strong>Congratulations!</strong></div>",
        "<div class='ticker_to_portfolio info_text'>You successfuly subscribed to alerts on ", ticker.toUpperCase(), "<br>and added this stock to <a id='portfolio_link_add_rta_popup' class='portfolio_link' href='/account/portfolio'>your portfolio</a></div>",
        "</div>"];
      return dataArr.join('');
    };

    function ShowThanksWithRta() {
      sucModal.innerBody(getThanksBody(ticker));
    }

    function onLoginSuccess(response, opt, modal) {
      var bi = opt && opt.extra && opt.extra.bi;
      if (bi) {
        var promise = SA.Logger.Mone.event(bi.type, bi.source, 'ticker_added_to_portolio', bi.data);
        promise.always(function(){
          location.reload();
        });
      } else {
        location.reload();
      }
    }

    this.thankyouMsg = function () {
      var dataArr = ["<div class='ticker_to_portfolio add_rta_container'>",
        "<div class='ticker_to_portfolio add_rta_title'><strong></strong></div>",
        "<div class='ticker_to_portfolio info_text'>You are already getting  alerts on ", ticker.toUpperCase(), "</div>",
        "</div>"];

      sucModal = SA.Widgets.Popup.build({
        bodyContent: dataArr.join(''),
        showHeader: false,
        showBodyCloseBtn: true,
        showFooter: false,
        className: 'sa-modal income already',
        backdrop: true,
        removeAfterClose: true
      });

      if (!SA.Widgets.Popup.isRunning()) {
        sucModal.show();
      }
    };

    this.hasRta = function () {
      return SA.Data.User.getRTASymbolsOnArticles().concat(_this.has_rta_temp).indexOf(ticker.toLowerCase()) > -1;
    };

    this.init();
  };

}(window.SA, window.jQuery));
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/breaking_news"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div id="breaking-news" data-mcid="',  item.id ,'">\n  <div class="container clearfix">\n    <div class="pull-left">\n      <span class="breaking">Breaking - </span>\n      <a href="',  item.uri ,'" target="_blank" class="title" sasource="top_nav_breaking_news">',  item.title ,'</a>\n    </div>\n    <div class="pull-right">\n      <img src=\'',  assetHost ,'/images/widgets/x.png\' class=\'x-button\' />\n    </div>\n  </div>\n</div>\n');}return __p.join('');};
}).call(this);
/**
 * Created by SA-User on 2/24/16.
 */


(function ($) {

  var scope = SA.UsingNamespace('SA.Widgets.BreakingNews');

  var AJAX_BREAKING = '/market-news/breaking_news_ajax';
  var BREAKING_ELM = '#breaking-news';
  var CLOSE_AFTER = 30 * 60 * 1000;
  var CHECK_AGAIN = 15 * 60 * 1000;
  var $navSec;
  var $afterElm;
  var autoClose;
  var $body = $('body');


  scope.init = function() {
    $navSec = $('#nav-sec');
    $afterElm = $('#main-nav-wrapper-row');
    if ($afterElm.length!=1) {
      return;
    }
    getBreakingNews();
    setTimeout(getBreakingNews, CHECK_AGAIN);
  };

  scope.close = function(byUser) {
    var $elm = $(BREAKING_ELM);
    var mcid = $elm.data('mcid');
    $elm.remove();
    $navSec.show();
    $body.removeClass('breaking-news-present');
    if (byUser) {
      stopShowing(mcid);
      SA.Logger.Mone.event('breaking_news', 'top_nav', 'closed', {data:{'mc_id': mcid}});
    }
  };

  var isMobile = function(){
    return window.Prototype ? SA.Utils.Env.isMobile : SA.Utils.Env.isMobile();
  };

  var getBreakingNews = function() {
    if(isMobile() || location.pathname === '/submission') return false;
    $.ajax({
      url: AJAX_BREAKING,
      type: 'GET',
      dataType: 'json'
    }).done(function(response) {
      if (response && response.id && !userAware(response.id) && !mcOn(response.id) && $('.banner_top').length === 0) {
        if (inBreakingNews(response.id)) {
          stopShowing(response.id);
        } else {
          showBreakingNews(response);
        }
      }
    });
  };

  var inBreakingNews = function(breakingNewsId) {
    var targetNews = document.location.pathname;
    return (targetNews.indexOf(breakingNewsId) !== -1);
  };

  var mcOn = function(mcid) {
    var $elm = $(BREAKING_ELM);
    if ($elm.length === 0) {
      return false;
    }
    return ($elm.data('mcid') == mcid);
  };

  var userAware = function(mcid) {
    return (SA.Data.Cache.get('user-closed-breaking-' + mcid) === '1');
  };

  var stopShowing = function(mcid) {
    SA.Data.Cache.set('user-closed-breaking-' + mcid, 1);
  };

  var initCloseEvent = function() {
    var xButton = $('.x-button');
    var breakingNews = $('#breaking-news');
    var link = breakingNews.find('.title');
    var mcid = breakingNews.data('mcid');
    xButton.on('click', function() {
      scope.close(true);
    });
    link.on('click', function() {
      scope.close(true);
    });
  };

  var showBreakingNews = function(res) {
    var html = JST['jst/widgets/breaking_news']({
      item: res,
      assetHost: SA.App.assetHost
    });
    var closeFunc = scope.close;
    var $curElm = $(BREAKING_ELM);
    if ($curElm.length) {
      $curElm.remove();
    }
    $('body > header').prepend(html);
    setBreakingNewsPresent();
    initCloseEvent();
    SA.Logger.Mone.event('breaking_news', 'top_nav', 'shown', {data:{'mc_id': res.id}});
    if(autoClose) {
      clearTimeout(autoClose);
    }
    autoClose = setTimeout(closeFunc, CLOSE_AFTER);
  };

  var setBreakingNewsPresent = function() {
    $body.addClass("breaking-news-present");
  };

  scope.init();

})(jQuery);
(function(SA){

  'use strict';

  SA.Logger.Mone.event('blocker', 'blocker', 'catch', { data: {
    url: window.location.pathname,
    active: SA.Utils.Detect.adBlock().toString()
  }});

}(SA));
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/utils/adblock_popup_paid"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div id="adblock_popup_paid_body">\n  <p id="adblock_popup_paid_text_row">\n    With the support of our advertisers, we are able to provide great content\n    without charging users. If you wish to continue using Seeking Alpha for\n    free, please add us to your ad blocker whitelist.\n  </p>\n  <p id="adblock_popup_paid_sec_text_row">\n    <b>To use Seeking Alpha with an ad blocker, please purchase a monthly subscription for $9.99.</b>\n  </p>\n  <div id="adblock_popup_paid_btns_row">\n    <a id="whitelist-btn" href="/page/how-to-disable-adblock" class="border-only-btn" sasource="adblock_soft_paid" role="button">Whitelist Seeking Alpha</a>\n    <div id="adblock_popup_paid_or_label">&nbsp;or&nbsp;</div>\n    <a id="adblock-btn-paid" href="',  subscribeUrl ,'" class="border-only-btn" role="button">Subscribe Now</a>\n  </div>\n</div>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/utils/adblock_thankyou_popup"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div class="row adblock-content thankyou">\n  <div class="col-xs-12">\n  <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n    <span aria-hidden="true"></span>\n  </button>\n  <div class="text-center">\n    <p class=\'title\'>Thank you for your purchase.</p>\n    <p class=\'receipt\'><b>You will receive an email receipt shortly.</b></p>\n    <p>Please email adblock@seekingalpha.com with any questions or concerns.</p>\n  </div>\n  </div>\n</div>\n');  SA.Logger.Mone.event('adblock_detection', 'hard_p_roadblock', 'ad_free_signup_complete', { data: {"url":window.location.pathname,"user_id":SA.Data.User.id()}}); ; __p.push('\n');}return __p.join('');};
}).call(this);




(function(w, SA, $) {

  'use strict';

  var s = SA.UsingNamespace('SA.Utils.AdBlockManager'),
      adblockMinScore = 3,
      subscribeUrl = '/checkout?service_id=ad',
      excludedPages = [
        'how-to-disable-adblock',
        '/checkout',
        '/submission',
        '/stock-ideas[/]?$',
        'account/edit_bio',
        'account/payment_details',
        'account/authorboard_overview',
        'account/authorboard/article_stats',
        'account/authorboard/published',
        'account/authorboard/earnings',
        'account/authorboard/payments',
        'page/premium-partnership-faq',
        'page/article-submission-guidelines',
        'page/become-a-seeking-alpha-contributor',
        'market-news/on-the-move'
      ],
      spDetector = false,
      currPath = w.location.href.replace(SA.App.host, ''),
      event = SA.Logger.Mone.event,
      user = SA.Data.User;

  function isSelfRefresh() {
    return currPath === document.referrer;
  }

  function checkUGCScore(userObject) {
    var passScore = false;

    // for authors we don't check the passScore
    // we want them to see the adblock unless they meet other criteria (pro users etc...)
    if (!userObject.isAuthor()) {
      passScore = parseInt(userObject.adblockScore(), 10) > adblockMinScore;
    }
    return passScore;
  }

  function checkUserExclusion() {
    var rbStrategy = SA.Data.Cache.get('roadblock_calc_type');
    return (!user.loggedIn() && rbStrategy !== 'no_rb_strategy') || user.isPro() || user.hasAuthorResearch() || user.isAdFree() || checkUGCScore(user);
  }

  function checkDfpRendered() {
    var ads = SA.Ads && SA.Ads.DataTracker ? SA.Ads.DataTracker.getData() : {},
      rendered = false;

    // if there are no items send true as well
    if($.isEmptyObject(ads)) {
      return true;
    }

    $.each(ads, function(i) {
      if(ads[i].visibilityEvent){
        rendered = true;
        return false;
      }
    });

    return rendered;
  }

  function checkAdblockFlags() {
    // dfpRenderTriggered means that no adblock was detected, ads are being served normally
    var dfpRenderTriggered = checkDfpRendered();
    if(!dfpRenderTriggered){
      event('adblock_detector', 'dfp_visibility_blocker', 'catch', {
        data: {
          url: currPath, userid: user.id()
        }
      });
    }
    var adblockFlagsOn = SA.Utils.Detect.adBlock() && spDetector && !dfpRenderTriggered;
    if (adblockFlagsOn) {
      SA.Data.Cache.set('ab', 't');
    }
    return adblockFlagsOn;
  }

  function checkExcludedPages() {
    var path = currPath, len = excludedPages.length, i = 0;
    for(i; i < len; i += 1) {
      if(path.match(excludedPages[i])) {
        return true;
      }
    }
    return false;
  }

  function isProPaywalledArticle() {
    return (SA.pageConfig.Data.article && SA.pageConfig.Data.article.isProPaywall);
  }

  function dontRoadblock() {
    return !checkAdblockFlags() || checkUserExclusion() || (isSelfRefresh() && sessionStorage.softAdBlocked) || checkExcludedPages() || isProPaywalledArticle();
  }

  function bindSignUpEvent() {
    $('#adblock-btn-paid').on('click', function(){
      // exclude URL's hash part
      SA.Data.Cookies.set('adb_ret_url', currPath.split('#')[0], {expires: 60 * 60});
      event('adblock_detection', 'soft_p_roadblock', 'sign_up_clicked');
    });
  }

  function buildRoadblockPopup(variation) {
    var isHardAdblocker = variation === 'hard_adblock';
    return SA.Widgets.Popup.build({
      className: 'sa-adblock-paid',
      headerContent: 'Hey, we noticed you are using an ad blocker',
      bodyContent: w.JST['jst/widgets/utils/adblock_popup_paid']({
        subscribeUrl: subscribeUrl
      }),
      footerContent: '<p>Don\'t want to see this anymore? <a href="/page/how-to-disable-adblock" sasource="adblock_soft">Simply add us to your ad-block whitelist</a> (instructions).</p>',
      keyboard: !isHardAdblocker,
      backdrop: isHardAdblocker ? 'static' : true,
      showCloseBtn: !isHardAdblocker,
      removeAfterClose: true,
      beforeOpen: function() {
        event('adblock_detection', 'soft_roadblock_popup_paid', 'shown');
      },
      beforeClose: function() {
        event('adblock_detection', 'soft_roadblock_popup_paid', 'closed');
      },
      afterOpen: function() {
        bindSignUpEvent();
      }
    });
  }

  function popUpRoadblock() {
    if (!SA.Widgets.Popup.isRunning()) {
      SA.Utils.AbTests.init({
        'Hard Ad Blocker Pop-Up Strategy': function (variation) {
          buildRoadblockPopup(variation).show();
        }
      });
    }
  }

  function checkForRoadblock() {
    if(!dontRoadblock()) {
      sessionStorage.setItem('softAdBlocked', true);
      popUpRoadblock();
    }
  }

  function buildThankYouPopup() {
    return SA.Widgets.Popup.build({
      className: 'sa-adblock',
      showHeader: false,
      bodyContent: w.JST['jst/widgets/utils/adblock_thankyou_popup'](),
      showFooter: false,
      keyboard: true,
      backdrop: true,
      removeAfterClose: true
    });
  }

  function popupThankYou() {
    if (!SA.Widgets.Popup.isRunning()) {
      buildThankYouPopup().show();
    }
  }

  function init() {
    if (SA.Fn.param('adb_signup_complete') === 'true') {
      popupThankYou();
    } else {
      setTimeout(checkForRoadblock, 8000);
    }
  }

  SA.run(init, 'ad-block-manager');

  // PUBLIC functions

  s.adBlockDetected = function(detector) {
    if (detector === 'sp') {
      spDetector = true;
    }
  };

  s.blockDisplayBottomUnit = function() {
    var today = new Date(),
        last6Months = today.setMonth(today.getMonth() - 6),
        userSince = user.createdAt() * 1000;
    return checkUGCScore(user) || userSince > last6Months;
  }

}(window, window.SA, window.jQuery));
/* Please NOTE: The file is symlinked in the public folder */
/* SourcePoint JS code is under vendor/source-point */

(function (SA) {

  'use strict';

  function init() {
    document.addEventListener('sp.blocking', function() {
      SA.Logger.Mone.event('adblock_detector', 'sp_blocker', 'catch', {
        data: {
          url: window.location.pathname,
          userId: SA.Data.User.id() || 'logged out'
        }
      });
      SA.Utils.AdBlockManager.adBlockDetected('sp');
    });
  }

  SA.run(init, 'detect-sp');

}(window.SA));
try{
window._sp_ = window._sp_ || {};
window._sp_.config = window._sp_.config || {};
window._sp_.config.account_id = 218;
window._sp_.config.cmd = [];
!function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=518)}([function(e,t,n){var r,o;!function(i){"use strict";var u={};u.VERSION="1.3.0";var a,c={},f=function(e,t){return function(){return t.apply(e,arguments)}},s=function(){var e,t,n=arguments,r=n[0];for(t=1;t<n.length;t++)for(e in n[t])e in r||!n[t].hasOwnProperty(e)||(r[e]=n[t][e]);return r},l=function(e,t){return{value:e,name:t}};u.DEBUG=l(1,"DEBUG"),u.INFO=l(2,"INFO"),u.TIME=l(3,"TIME"),u.WARN=l(4,"WARN"),u.ERROR=l(8,"ERROR"),u.OFF=l(99,"OFF");var p=function(e){this.context=e,this.setLevel(e.filterLevel),this.log=this.info};p.prototype={setLevel:function(e){e&&"value"in e&&(this.context.filterLevel=e)},enabledFor:function(e){var t=this.context.filterLevel;return e.value>=t.value},debug:function(){this.invoke(u.DEBUG,arguments)},info:function(){this.invoke(u.INFO,arguments)},warn:function(){this.invoke(u.WARN,arguments)},error:function(){this.invoke(u.ERROR,arguments)},time:function(e){"string"==typeof e&&e.length>0&&this.invoke(u.TIME,[e,"start"])},timeEnd:function(e){"string"==typeof e&&e.length>0&&this.invoke(u.TIME,[e,"end"])},invoke:function(e,t){a&&this.enabledFor(e)&&a(t,s({level:e},this.context))}};var h=new p({filterLevel:u.OFF});!function(){var e=u;e.enabledFor=f(h,h.enabledFor),e.debug=f(h,h.debug),e.time=f(h,h.time),e.timeEnd=f(h,h.timeEnd),e.info=f(h,h.info),e.warn=f(h,h.warn),e.error=f(h,h.error),e.log=e.info}(),u.setHandler=function(e){a=e},u.setLevel=function(e){h.setLevel(e);for(var t in c)c.hasOwnProperty(t)&&c[t].setLevel(e)},u.get=function(e){return c[e]||(c[e]=new p(s({name:e},h.context)))},u.createDefaultHandler=function(e){e=e||{},e.formatter=e.formatter||function(e,t){t.name&&e.unshift("["+t.name+"]")};var t={},n=function(e,t){Function.prototype.apply.call(e,console,t)};return"undefined"==typeof console?function(){}:function(r,o){r=Array.prototype.slice.call(r);var i,a=console.log;o.level===u.TIME?(i=(o.name?"["+o.name+"] ":"")+r[0],"start"===r[1]?console.time?console.time(i):t[i]=(new Date).getTime():console.timeEnd?console.timeEnd(i):n(a,[i+": "+((new Date).getTime()-t[i])+"ms"])):(o.level===u.WARN&&console.warn?a=console.warn:o.level===u.ERROR&&console.error?a=console.error:o.level===u.INFO&&console.info&&(a=console.info),e.formatter(r,o),n(a,r))}},u.useDefaults=function(e){u.setLevel(e&&e.defaultLevel||u.DEBUG),u.setHandler(u.createDefaultHandler(e))},r=u,void 0!==(o="function"==typeof r?r.call(t,n,t,e):r)&&(e.exports=o)}()},function(e,t,n){"use strict";function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e){return e instanceof h}function a(e){return e instanceof d}function c(e){return e instanceof _}function f(e){return e instanceof y}function s(e){return e instanceof b}n.d(t,"g",function(){return v}),n.d(t,"j",function(){return m}),n.d(t,"h",function(){return g}),n.d(t,"i",function(){return E}),n.d(t,"w",function(){return O}),n.d(t,"v",function(){return T}),n.d(t,"t",function(){return S}),n.d(t,"u",function(){return R}),n.d(t,"q",function(){return k}),n.d(t,"r",function(){return N}),n.d(t,"p",function(){return A}),n.d(t,"s",function(){return C}),n.d(t,"o",function(){return x}),t.k=u,t.l=a,t.m=c,t.d=f,t.n=s,n.d(t,"b",function(){return I}),n.d(t,"c",function(){return M}),n.d(t,"f",function(){return H}),n.d(t,"a",function(){return K});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),p=(n(0).get("detection:test_result:attribute:index"),function(){function e(t){i(this,e),this._str=t}return l(e,[{key:"is",value:function(e){return e.name()===this.name()&&e.toString()===this.toString()}},{key:"name",value:function(){return"at"}},{key:"toString",value:function(){return this._str}}]),e}());t.e=p;var h=function(e){function t(){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),l(t,[{key:"name",value:function(){return"tat"}}]),t}(p),d=function(e){function t(){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),l(t,[{key:"name",value:function(){return"teat"}}]),t}(p),_=function(e){function t(){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),l(t,[{key:"name",value:function(){return"rat"}}]),t}(p),y=function(e){function t(){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),l(t,[{key:"name",value:function(){return"reat"}}]),t}(p),b=function(e){function t(e,n){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e+"="+n))}return o(t,e),t}(p),v=function(e){function t(e){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"url",e))}return o(t,e),t}(b),m=function(e){function t(e){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"err",e.toString()))}return o(t,e),t}(b),g=function(e){function t(e){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"st",e.toFixed()))}return o(t,e),t}(b),E=function(e){function t(e){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"ts",e.toFixed(3)))}return o(t,e),t}(b),O=function(e){function t(e){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"dom",e))}return o(t,e),t}(b),w=(function(e){function t(e){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"ch",e.toString()))}o(t,e)}(b),function(e){function t(e,n){i(this,t);var o=e?"_"+e:"";return r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"sel"+o,n))}return o(t,e),t}(b)),T=function(e){function t(e){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"",e))}return o(t,e),t}(w),S=function(e){function t(e){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"br",e))}return o(t,e),t}(w),R=function(e){function t(e){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"nc",e))}return o(t,e),t}(w),P=function(e){function t(e,n,o){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"net_"+e,JSON.stringify({src:n,tag:o})))}return o(t,e),t}(b),k=function(e){function t(e,n){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"ld",e,n))}return o(t,e),t}(P),N=function(e){function t(e,n){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"err",e,n))}return o(t,e),t}(P),j=function(e){function t(e,n,o,u){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"netr_"+e,JSON.stringify({rule:n,lds:o.map(function(e){return e.toString()}),errs:u.map(function(e){return e.toString()})})))}return o(t,e),t}(b),A=function(e){function t(e,n,o){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"bl",e,n,o))}return o(t,e),t}(j),C=function(e){function t(e,n,o){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"wl",e,n,o))}return o(t,e),t}(j),x=function(e){function t(e,n,o){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"bkrl",JSON.stringify({name:e,bls:n.map(function(e){return e.toString()}),wls:o.map(function(e){return e.toString()})})))}return o(t,e),t}(b),I={},L={INTERFERENCE:"in",DFP_INTERFERENCE:"dfpi",ADBLOCKER:"ad",GENERIC_ADBLOCKER:"gad",STAND_DOWN:"sd",PRIVATE:"pr",RECOVERY_INTERFERENCE:"rin",FSM_DATA:"fda",ACCEPTABLE_AD:"aad"};for(var D in L)I[D]=new h(L[D]);var M={},B={INFERENCE:"inf",NETWORK:"ne",IMAGE:"im",SCRIPT:"sc",IFRAME:"if",ELEMENT:"el",ARTIFACT:"ar",STYLE_SHEET:"ss",STYLE_PROPERTY:"sp",INLINE_STYLE_SHEET:"iss",HIDDEN_PROPERTY:"hp",CUSTOM_PROPERTY:"cp",HIDING:"hi",USER_AGENT:"ua",BOT:"bo",PROXY_HOST:"ph",NATIVE_OVERRIDE:"no",FEATURE_ACCESS:"fa",AJAX:"aj",FSM:"fsm",NETWORK_LISTENER:"nel",HIDING_DATA:"hid"};for(var F in B)M[F]=new d(B[F]);var H={},U={NO_LOAD_BLOCK:"nlb",LOAD_BLOCK:"lb",ELEMENT_HIDDEN:"eh",CONTROL_ELEMENT_HIDDEN:"ceh",NO_ELEMENT_HIDDEN:"neh",URL_REWRITTEN:"ur",NO_URL_REWRITTEN:"nur",DATA_URL_REWRITTEN:"dur",NO_ARTIFACT_PRESENT:"nap",ARTIFACT_PRESENT:"ap",NO_STYLE_SHEET_PRESENT:"nssp",STYLE_SHEET_PRESENT:"ssp",NO_STYLE_PROPERTY_PRESENT:"nspp",STYLE_PROPERTY_PRESENT:"spp",NO_HIDDEN_PROPERTY_PRESENT:"nhpp",HIDDEN_PROPERTY_PRESENT:"hpp",NO_CUSTOM_PROPERTY_PRESENT:"ncpp",CUSTOM_PROPERTY_PRESENT:"cpp",TIMEOUT:"to",NO_BOT_USER_AGENT:"nbua",GOOGLE_BOT_USER_AGENT:"gbua",BING_BOT_USER_AGENT:"bbua",NO_PROXY_HOST:"nph",GOOGLE_WEBCACHE_PROXY_HOST:"gwph",NO_NATIVE_OVERRIDE:"nno",SHADOW_ROOT_NATIVE_OVERRIDE:"srno",REQUEST_FILE_SYSTEM_SUCCESS:"rfss",REQUEST_FILE_SYSTEM_ERROR:"rfse",NO_REQUEST_FILE_SYSTEM:"nrfs",INDEXED_DB_OPEN_SUCCESS:"idos",INDEXED_DB_OPEN_ERROR:"idoe",NO_INDEXED_DB:"nid",INDEXED_DB_EXISTS:"ide",LOCAL_STORAGE_SET_SUCCESS:"lsss",LOCAL_STORAGE_SET_ERROR:"lsse",NO_LOCAL_STORAGE:"nls",AJAX_LOAD_BLOCK:"alb",AJAX_LOAD_SUCCESS:"als",AJAX_LOAD_ERROR:"ale",AJAX_OPEN_BLOCK:"aob",AJAX_SEND_BLOCK:"asb",PROTOCOL_MISMATCH:"pm",EXA_BOT_USER_AGENT:"ebua",CANNOT_TEST:"cnt",GOOGLE_WEB_LIGHT_USER_AGENT:"gwl",OPTIMIZELY_PREVIEW_PROXY_HOST:"opph",NO_BLOCKER_RULES:"nbr",BROKEN_ELEMENT_HIDING_RULE:"behr",NO_ELEMENT_HIDING_RULES:"nehr",HIDE_MATCHING_BLACKLIST:"hmbl",NO_MATCHING_BLACKLIST:"nmbl",ERROR_MATCHING_BLACKLIST:"embl",LOAD_MATCHING_BLACKLIST:"lmbl",ERROR_MATCHING_WHITELIST:"emwl",LOAD_MATCHING_WHITELIST:"lmwl",NO_NETWORK_LISTENER_DATA:"nnld",NO_NETWORK_BLOCKING_RULES:"nnbr",HIDDEN_IMMEDIATELY:"hii",NONE_HIDDEN_IMMEDIATELY:"nhii",HIDDEN_LATER:"hil",NONE_HIDDEN_LATER:"nhil",OFFLINE:"off"};for(var G in U)H[G]=new _(U[G]);var K={},Y={ADBLOCK:"ab",ADBLOCK_PLUS:"abp",ADGUARD:"ag",UBLOCK:"ub",UBLOCK_ORIGIN:"ubo",NATIVE:"na",PRESENT:"pr",NOT_PRESENT:"npr",UNKNOWN_ADBLOCKER:"ua"};for(var W in Y)K[W]=new y(Y[W])},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return new(Function.prototype.bind.apply(Error,[null].concat(["Uncaught in promise: "+(null==e?"":e.toString()+e.stack||"")],n)))}function i(e){return new s(function(t,n){e.then(function(e){t(e)},function(e){n(e)})})}Object.defineProperty(t,"__esModule",{value:!0});var u=n(28);n.d(t,"UtilPromise",function(){return s});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=n(0).get("util:promise"),f=0,s=function(){function e(t){if(r(this,e),this._state=f,this._resolveCallbacks=[],this._rejectCallbacks=[],this._catchListenerAdded=!1,null!=t)try{t(this._resolve.bind(this),this._reject.bind(this))}catch(e){if(e.message&&e.message.match(/^Uncaught in promise: /))throw e;this._reject(e)}}return a(e,null,[{key:"resolve",value:function(t){return new e(function(e){e(t)})}},{key:"reject",value:function(t){return new e(function(e,n){return n(t)})}},{key:"all",value:function(t){var n=this;if(0===t.length)return e.resolve([]);var r=0,o=[];return new e(function(i,u){function a(e,n){o[e]=n,++r===t.length&&i(o)}t.forEach(function(t,r){e.resolve(t).then(a.bind(n,r),u)})})}},{key:"race",value:function(t){return 0===t.length?l:new e(function(e,n){t.forEach(function(t){t.then(e,n)})})}}]),a(e,[{key:"then",value:function(t,n){var r=this;return new e(function(e,o){r._then(function(n){return e(t(n))}),r._catch(function(t){null==n?o(t):e(n(t))})})}},{key:"catch",value:function(e){return this.then(function(e){return e},e)}},{key:"_resolve",value:function(t){if(this._state===f){var n=this._resolve.bind(this),r=this._reject.bind(this);t instanceof e?t.then(n,r):null!=t&&t instanceof Object&&t.then&&"function"==typeof t.then&&t["catch"]&&"function"==typeof t["catch"]?i(t).then(n,r):(this._state=1,this._result=t,this._resolveCallbacks.forEach(function(e){e(t)}),this._clearCallbacks())}}},{key:"_reject",value:function(e){var t=this;this._state===f&&(this._state=2,this._error=e,this._catchListenerAdded?c.debug("caught promise error",e):(c.error("uncaught promise error",e),setTimeout(function(){if(!t._catchListenerAdded)throw o(e)},0)),this._rejectCallbacks.forEach(function(t){t(e)}),this._clearCallbacks())}},{key:"_clearCallbacks",value:function(){this._resolveCallbacks=[],this._rejectCallbacks=[]}},{key:"_then",value:function(e){1===this._state?e(this._result):this._state===f&&this._resolveCallbacks.push(e)}},{key:"_catch",value:function(e){this._catchListenerAdded=!0,2===this._state?e(this._error):this._state===f&&this._rejectCallbacks.push(e)}}]),e}(),l=s.resolve(null),p=n.i(u.a)(window.Promise)?window.Promise:s;t["default"]=p},function(e,t,n){"use strict";function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var u=n(2);n.d(t,"a",function(){return p});var a=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var u=o.get;if(void 0!==u)return u.call(r)},c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),f=(n(0).get("detection:test"),new Error("not implemented")),s=function(){function e(){var t=this;i(this,e),this.runPromise=new u["default"](function(e){t.resolve=e.bind(t.runPromise)})}return c(e,null,[{key:"getSchema",value:function(){throw f}},{key:"testMethod",value:function(){throw f}},{key:"has",value:function(){var e;return(e=this.getSchema()).has.apply(e,arguments)}}]),c(e,[{key:"waitForResult",value:function(){return this.runPromise}}]),e}(),l=function(e){function t(){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),c(t,[{key:"run",value:function(){var e,t=this;return u["default"].resolve((e=this.constructor).testMethod.apply(e,arguments)).then(function(e){return t.resolve(e),t.runPromise})}}],[{key:"testMethod",value:function(){throw f}},{key:"bindArgs",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){function n(){return i(this,n),r(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return o(n,e),c(n,null,[{key:"testMethod",value:function(){for(var e=arguments.length,r=Array(e),o=0;o<e;o++)r[o]=arguments[o];return a(n.__proto__||Object.getPrototypeOf(n),"testMethod",this).apply(this,t.concat(r))}}]),n}(this)}}]),t}(s);t.b=l;var p=function(e){function t(){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),c(t,[{key:"run",value:function(e){for(var t,n=this,r=arguments.length,o=Array(r>1?r-1:0),i=1;i<r;i++)o[i-1]=arguments[i];return u["default"].resolve((t=this.constructor).testMethod.apply(t,[e].concat(o))).then(function(e){return n.resolve(e),n.runPromise})}}],[{key:"findDependency",value:function(){throw f}},{key:"bindArgs",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){function n(){return i(this,n),r(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return o(n,e),c(n,null,[{key:"testMethod",value:function(e){for(var r,o=arguments.length,i=Array(o>1?o-1:0),u=1;u<o;u++)i[u-1]=arguments[u];return(r=a(n.__proto__||Object.getPrototypeOf(n),"testMethod",this)).call.apply(r,[this,e].concat(t,i))}}]),n}(this)}}]),t}(s)},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=n(298),a=n(133),c=n(132),f=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=(n(0).get("detection:test_result:schema"),function(e){function t(){var e;r(this,t);for(var i=arguments.length,u=Array(i),a=0;a<i;a++)u[a]=arguments[a];var f=o(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(u))),s=n.i(c.a)(f.attributes);if(0===s.types.length||0===s.tests.length)throw new Error("missing required types or tests from schema");return f}return i(t,e),f(t,[{key:"createResult",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return new(Function.prototype.bind.apply(u.a,[null].concat([this.attributes],t)))}},{key:"addAttribute",value:function(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return new(Function.prototype.bind.apply(t,[null].concat([this.attributes],n)))}},{key:"removeAttribute",value:function(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];var o=new(Function.prototype.bind.apply(a.a,[null].concat(n)));return new t(this.attributes.filter(function(e){return!o.attributes.some(function(t){return t.is(e)})}))}}]),t}(a.a));t.a=s},function(e,t,n){"use strict";function r(){if(!window._sp_||!window._sp_.config)throw new Error("_sp_.config is not defined");window._sp_.config.hasBeenRead||(n.i(O.a)(["config","hasBeenRead"],!0),n.i(O.a)(["config","has_been_read"],!0)),o.apply(void 0,arguments),a(M)}function o(){B=new E.a(L.getSearchParam()),D=window._sp_.config;for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];M=i(t),u(M)}function i(e){return e.reduce(function(e,t){return b()(e,t),e},{})}function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:D,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];Object.keys(t).forEach(function(r){var o=n.concat(r).join(".");if(e[r]){var i=s(t[r],e[r]);if(e[r].type!==(void 0===i?"undefined":T(i)))throw new Error("invalid value: '"+JSON.stringify(i)+"' for option: '"+o+"' expected: '"+e[r].type+"'");if(e[r].validation&&!e[r].validation(i)){var a=e[r].validationMessage||"";throw new Error("invalid value: '"+JSON.stringify(i)+"' for option: '"+o+"' "+a)}e[r].keys&&u(e[r].keys,i,n.concat(r))}}),Object.keys(e).forEach(function(t){var r=n.concat(t).join(".");if(e[t].required&&!D.hasOwnProperty(t))throw new Error("required option: '"+r+"' not specified in config")})}function a(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:D,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];Object.keys(t).forEach(function(r){var o=n.concat(r).join(".");if(!e.hasOwnProperty(r))throw new Error("invalid option: '"+o+"' valid keys are: '"+JSON.stringify(Object.keys(e).map(function(e){return n.concat(e).join(".")}))+"'");e[r].keys&&a(e[r].keys,t[r],n.concat(r))})}function c(e){return"config value: "+JSON.stringify([].concat(e))+" does not exist in spec"}function f(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:D,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:M,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=void 0,i=[];if(Array.isArray(e)?(o=e[0],i=e.slice(1)):o=e,!n)throw new Error('config value: "'+o+'" fetched before initialization');if(!n[o])throw new Error(c(r.concat(e)));var u=void 0;t&&t.hasOwnProperty(o)&&(u=t[o]);var a=n[o],l=a.keys;if(i.length>0)return f(i,u,l,r.concat(o));if(l){var p={};for(var h in l)p[h]=f(h,u,l,r.concat(o));return p}if(a.mapQueryParam){var d=r.concat(o).join("_"),_=B.getSearchParam("_sp_"+d);if(_){var y=a.mapQueryParam(_);if(void 0!==y)return s(y,a)}}if(void 0!==u)return s(u,a);var b=a.fallback?a.fallback():null;return null!=b?s(b,a):s(a["default"],a)}function s(e,t){return t.mapConfigParam?t.mapConfigParam(e):e}function l(e){var t=void 0;try{t=f(e)}catch(t){if(t.message.indexOf(c(e))>-1)return!1;throw t}return void 0!==t}function p(){return Object.keys(M)}function h(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.reduce(function(e,t){return Object.keys(t).forEach(function(n){e[n]=f(n,D,t)}),e},{});return JSON.stringify(r)}function d(e){D=JSON.parse(e);for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];M=i(n),B=B||new E.a(L.getSearchParam())}function _(){return window.location.search}Object.defineProperty(t,"__esModule",{value:!0});var y=n(200),b=n.n(y),v=n(104),m=n.n(v),g=n(142),E=n(25),O=n(11),w=n(30),T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S=(n(0).get("config:client_api"),"boolean"),R="string",P="object",k={hasBeenRead:{type:S,"default":!1},has_been_read:{type:S,"default":!1},accountId:{type:"number",required:!0},clientId:{type:R},cmd:{type:P,"default":[],validation:function(e){return Array.isArray(e)},validationMessage:"must be an array"},debug:{type:P,keys:{level:{type:R,"default":"OFF",mapQueryParam:function(e){return e},mapConfigParam:function(e){return e.toUpperCase()},validation:function(e){return"string"==typeof e&&g.a.indexOf(e)>-1},validationMessage:"expected one of "+g.a.join(",")}}},beacon:{type:P,keys:{pageViewEndpoint:{type:R,fallback:function(){return w.d}},contentControlEndpoint:{type:R,fallback:function(){return w.e}},customEntries:{type:P,validation:function(e){return Array.isArray(e)&&e.length<=3&&e.every(function(e){return"string"==typeof e})},validationMessage:"expected an array of at most 3 string values"}}},bootstrap:{type:P,keys:{contentControlCallback:{type:"function","default":function(){}}}},detection:{type:P,keys:{useNetworkBlockerTests:{type:S,"default":!1},useDFPNetworkBlockerTests:{type:S,"default":!1},useGenericContentBlockerTests:{type:S,"default":!0},useSpecificContentBlockerTests:{type:S,"default":!0},internal:{type:P,keys:{useNetworkBlockerTests:{type:S,"default":!1},useDFPNetworkBlockerTests:{type:S,"default":!1},useGenericContentBlockerTests:{type:S,"default":!0},useSpecificContentBlockerTests:{type:S,"default":!0}}},fsm:{type:P,keys:{enable:{type:S,"default":!1,mapQueryParam:function(e){if("true"===e)return!0}},endpoint:{type:R,fallback:function(){return w.f}},enableNetwork:{type:S,"default":!1,mapQueryParam:function(e){if("true"===e)return!0}}}},exposeSpecificContentBlockerData:{type:S,"default":!1}}},dfp:{type:P,keys:{targetingKey:{type:R,"default":"sp.block"}}},events:{type:P,keys:{onDetectionComplete:{type:"function","default":function(){}}}},rid:{type:P,keys:{enable:{type:S,fallback:function(){return f(["rid","enableForgivenessCookie"])},"default":!1},enableForgivenessCookie:{type:S,"default":!1},contentControlCallback:{type:"function","default":function(){}}}},siteCssLocation:{type:R},disableBlockerStyleSheets:{type:S,"default":!0},styleManager:{type:P,keys:{enable:{type:S,"default":!0},enableSimple:{type:S,"default":!0,mapQueryParam:function(e){if("true"===e)return!0}},enableMorphingOutsideAdHierarchy:{type:S,"default":!1}}},vid:{type:P,keys:{enable:{type:S,fallback:function(){return f(["vid","enableInIFrame"])||f(["vid","enableGeneric"])},"default":!1},enableInIFrame:{type:S,"default":!1},enableGeneric:{type:S,"default":!1},contentControlCallback:{type:"function","default":function(){}}}},runImmediately:{type:S,"default":!1}},N={events:{type:P,keys:{onReceiveMessageData:{type:"function",fallback:function(){return f(["msg","clientDataCallback"])}},onMessageChoiceSelect:{type:"function",fallback:function(){return f(["msg","selectChoiceCallback"])}}}},msg:{type:P,keys:{zIndex:{type:"number","default":1e4},domain:{type:R,"default":""},clientDataCallback:{type:"function"},selectChoiceCallback:{type:"function"}}},vid:{type:P,keys:{enable:{fallback:null,"default":!0}}}},j={smart:{type:P,keys:{libURL:{type:R},targetingKey:{type:R,"default":"sp_block"}}}},A={publisherBase:{type:R,required:!0},events:{type:P,keys:{onReadyToReloadAdLibrary:{type:"function","default":function(){}}}}},C={accountId:{type:"number",required:!1,fallback:function(){return f("clientId")}}},x={publisherBase:A.publisherBase,accountId:k.accountId,debug:m()(k.debug,["type","keys.level"]),vid:m()(k.vid,["type","keys.enableInIFrame"]),styleManager:m()(k.styleManager,["type","styleManager.enableMorphingOutsideAdHierarchy"])},I={BASE:k,SMART:j,RECOVERY_LIB_API_IFRAME:x,MESSAGING:N,PROXY:A,ANALYTICS:C},L={init:r,internalInit:o,get:f,has:l,availableConfigKeys:p,serialize:h,initFromSerialized:d,specs:I,getSearchParam:_},D=void 0,M=void 0,B=void 0;t["default"]=L},function(e,t,n){function r(e){if(!e)return[];if(a(e))return c(e)?p(e):i(e);if(y&&e[y])return f(e[y]());var t=u(e);return(t==d?s:t==_?l:h)(e)}var o=n(106),i=n(60),u=n(77),a=n(39),c=n(224),f=n(221),s=n(222),l=n(109),p=n(115),h=n(120),d="[object Map]",_="[object Set]",y=o?o.iterator:void 0;e.exports=r},function(e,t,n){"use strict";n.d(t,"b",function(){return r}),n.d(t,"a",function(){return o}),n.d(t,"k",function(){return i}),n.d(t,"j",function(){return u}),n.d(t,"i",function(){return a}),n.d(t,"h",function(){return c}),n.d(t,"c",function(){return f}),n.d(t,"d",function(){return s}),n.d(t,"e",function(){return l}),n.d(t,"f",function(){return p}),n.d(t,"g",function(){return h});var r=(n(0).get("util:dom:get_elements_from_selector:selector_text_matchers"),/^([a-zA-Z0-9\-_]|\\.)+/),o=/^( *\+ *| *~ *| *> *| +)/,i=/^ *> */,u=/^ +/,a=/^ *\+ */,c=/^ *~ */,f=/^\*/,s=/^[#.[:]/,l=/^([~^$*]?=|])/,p=/.*?[^\\](\\\\)*]/,h=/^['"]?(.*?)['"]?( i)?]$/},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e){var t=[];try{t=T()(O()(e.ownerDocument.querySelectorAll("::shadow link, ::shadow style")).map(function(e){return e.sheet}))}catch(e){}return t}function a(e,t,r){return p()(e.filter(function(e){return!(e.ownerNode&&e.ownerNode.disabled)}).map(function(e){return n.i(R.a)(e)})).filter(function(e){var o=n.i(k.b)(e.selectorText),i=!1;try{i=n.i(P.a)(t,o)}catch(e){}return(c(e.style)||f(e.style))&&i&&(null==r||o.indexOf(r.trim())>-1)})}function c(e){return"none"===e.getPropertyValue("display")}function f(e){return(e.getPropertyValue("-moz-binding")||"").indexOf("abp-elemhide")>-1}function s(e,t){var n=t.hasAttribute("style"),r=t.getAttribute("style");t.style.setProperty("display","block","important");var o=e.getComputedStyle(t).display;if(n&&null!=r)t.setAttribute("style",r);else{var i=t.attributes.getNamedItem("style");i&&t.removeAttributeNode(i),t.removeAttribute("style")}return"none"===o}var l=n(19),p=n.n(l),h=n(167),d=n.n(h),_=n(67),y=n.n(_),b=n(73),v=n.n(b),m=n(216),g=n.n(m),E=n(6),O=n.n(E),w=n(76),T=n.n(w),S=n(57),R=n(48),P=n(122),k=n(163),N=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),j=(n(0).get("detection:test_result:attribute:data:element_hiding"),function(e){function t(e){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return i(t,e),N(t,null,[{key:"fromStyleSheets",value:function(e){var n=e.documentSheets,r=e.shadowSheets;return new t(new A({documentSheets:n,shadowSheets:r}))}},{key:"fromElement",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=r.selector,i=r.documentSheets,l=void 0===i?T()(O()(e.ownerDocument.querySelectorAll("link, style")).map(function(e){return e.sheet})):i,p=r.shadowSheets,h=void 0===p?u(e):p,d=r.hiddenImmediately,_=e.ownerDocument.defaultView,y={hasNone:c(e.style),hasImportant:"important"===e.style.getPropertyPriority("display")},b={hasDisplayNoneImportant:s(_,e)},m=_.getComputedStyle(e),E=f(m),w=null!=e.shadowRoot,S=e.hidden,R=["id","class","hidden","disabled","style"],P=g()(e.attributes,function(e){return-1===R.indexOf(e.name)&&""===e.value}),N=P.map(function(e){var t=_.document.createElement("div");return t.hidden=!0,t.setAttribute(e.name,""),t.style.setProperty("display","block"),_.document.body.appendChild(t),t}),j=null;N.forEach(function(e,t){if(null==j){var n=_.getComputedStyle(e);n&&"none"===n.display&&(j=P[t].name)}}),N.forEach(function(e){e.parentElement&&e.parentElement.removeChild(e)});var C=null;null!=o&&(C=n.i(k.a)(o,e.ownerDocument)||o);var x=a(l,e,C),I=a(h,e,C),L=v()(T()(x.map(function(e){return e.parentStyleSheet}))),D=v()(T()(I.map(function(e){return e.parentStyleSheet}))),M=x.concat(I);return new t(new A({inlineDisplay:y,inlineStyleSheet:b,hiddenImmediately:d,hasHiddenAttribute:S,hidingId:j,hasShadowRoot:w,hasMozBinding:E,documentSheets:L,shadowSheets:D,hidingCSSRules:M}))}}]),N(t,[{key:"is",value:function(e){if(e instanceof t){var n=e,r=this.getValue(),o=n.getValue();if(r instanceof A&&o instanceof A)return r.is(o)}return!1}}]),t}(S.a));t.a=j;var A=function(){function e(t){var n=t.documentSheets,o=void 0===n?[]:n,i=t.shadowSheets,u=void 0===i?[]:i,a=t.hidingCSSRules,c=void 0===a?[]:a,f=t.inlineDisplay,s=void 0===f?{hasNone:!1,hasImportant:!1}:f,l=t.inlineStyleSheet,p=void 0===l?{hasDisplayNoneImportant:!1}:l,h=t.hiddenImmediately,d=t.hasHiddenAttribute,_=void 0!==d&&d,b=t.hidingId,v=t.hasMozBinding,m=void 0!==v&&v,g=t.hasShadowRoot,E=void 0!==g&&g;r(this,e),this.documentSheets=o,this.shadowSheets=u,this.hidingCSSRules=c,this.inlineDisplay=y()({},s),this.inlineStyleSheet=y()({},p),this.hiddenImmediately=h,this.hasHiddenAttribute=_,this.hidingId=null,null!=b&&(this.hidingId=b),this.hasMozBinding=m,this.hasShadowRoot=E}return N(e,[{key:"is",value:function(e){return d()(this,e)}}]),e}()},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=n(2);n.d(t,"b",function(){return a});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=(n(0).get("detection:artifact:finder_record"),function(){function e(t,n,o){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];r(this,e),this._type=t,this._foundAdblocker=n,this._elementMatchMethod=o,this._adblockerStyleSheets=i}return i(e,[{key:"type",value:function(){return this._type}},{key:"foundAdblocker",value:function(){return this._foundAdblocker}},{key:"findElementMatches",value:function(){if(this._foundAdblocker&&this._elementMatchMethod)return o["default"].resolve(this._elementMatchMethod.apply(this,arguments));throw new Error("no adblocker or element match method")}},{key:"supportsElementMatching",value:function(){return null!=this._elementMatchMethod}},{key:"getAdblockerStyleSheets",value:function(){return this._adblockerStyleSheets}}]),e}());t.a=u;var a={ADBLOCK:"adblock",ADBLOCK_PLUS:"adblock_plus",ADGUARD:"adguard",UBLOCK:"ublock",UBLOCK_ORIGIN:"ublock_origin",OPERA:"opera"}},function(e,t){var n=Array.isArray;e.exports=n},function(e,t,n){"use strict";function r(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:window._sp_,r=[].concat(e),o=r.pop();r.reduce(function(e,t){return e[t]=e[t]||{},e[t]},n)[o]=t}t.a=r;n(0).get("life_cycle:util:set_sp_key")},function(e,t,n){"use strict";function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var u=n(97),a=n(2);n.d(t,"a",function(){return l}),n.d(t,"f",function(){return p}),n.d(t,"d",function(){return h}),n.d(t,"b",function(){return d}),n.d(t,"c",function(){return _}),n.d(t,"e",function(){return y});var c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),f=(n(0).get("life_cycle:feature"),function(){function e(){i(this,e),this.eventMap={},this.startPromise=a["default"].resolve(!0),this.resolutionPromise=a["default"].resolve(!0)}return c(e,[{key:"on",value:function(e,t){this.eventMap[e]=this.eventMap[e]||[],this.eventMap[e].push(t)}},{key:"emit",value:function(e){var t=this;(this.eventMap[e]||[]).forEach(function(e){return e.call(t)})}}]),e}()),s=new u.a(function(e){return function(e){function t(e){i(this,t);var n=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.detection=e,n}return o(t,e),t}(e)}),l=new u.a,p=new u.a,h=function(e){function t(){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),t}(f),d=function(e){function t(){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),t}(s.to(f)),_=function(e){function t(){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),t}(s.to(f)),y=function(e){function t(){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),t}(s.to(f))},function(e,t){function n(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}e.exports=n},function(e,t,n){"use strict";function r(e){return o.indexOf(e)>-1}var o=(n(0).get("util:ua_detection"),(navigator.userAgent||navigator.vendor||window.opera).toLowerCase()),i={chrome:function(){return r("chrome")&&!i.edge()&&!i.android_chrome()&&!i.opera()},phantom:function(){return r("phantom")},mobile:function(){return r("mobi")},android:function(){return r("android")},firefox:function(){return r("firefox")},safari:function(){return r("safari")&&r("mozilla")&&!i.edge()&&!i.chrome()&&!i.mobile()&&!i.mobile_safari()&&!i.opera()&&!i.phantom()},ie:function(){return r("trident")||r("msie")},edge:function(){return r("edge")},ipad:function(){return r("ipad")},mobile_safari:function(){return null!==o.match(/(ipod|iphone|ipad)/gi)&&null!==o.match(/AppleWebKit/gi)&&!r("crios")},android_chrome:function(){return r("chrome")&&r("android")},googlebot:function(){return r("googlebot")||r("adsbot-google")||r("mediapartners-google")},googleweblight:function(){return r("googleweblight")},bingbot:function(){return r("bingbot")||r("bingpreview")},exabot:function(){return r("exabot")},opera:function(){return r("opera")||r("opr/")},contains:r};t.a=i},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){return"string"==typeof t?"_sp_"+t:"number"==typeof t?t.toString():"boolean"==typeof t?String(t):null==t?String(t):t[e]||null}var i=n(28),u=function(){function e(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var u,a=e[Symbol.iterator]();!(r=(u=a.next()).done)&&(n.push(u.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{!r&&a["return"]&&a["return"]()}finally{if(o)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=(n(0).get("util:map"),function(){function e(){r(this,e),this._guid="_sp_map_key_"+Math.random().toString(),this._insertionCount=0,this.clear()}return a(e,[{key:"clear",value:function(){this._data={},this.size=0}},{key:"set",value:function(e,t){this.has(e)||(this.size++,this._insertionCount++);var n=o(this._guid,e);null==n&&(n="o_sp_"+this._insertionCount,Object.defineProperty(e,this._guid,{enumerable:!1,configurable:!0,writable:!0,value:n}));var r=this._data[n]?this._data[n][2]:this._insertionCount;this._data[n]=[e,t,r]}},{key:"has",value:function(e){return null!=this._getKeyIfInMap(e)}},{key:"get",value:function(e){var t=this._getKeyIfInMap(e);if(null!=t)return this._data[t][1]}},{key:"delete",value:function(e){var t=this._getKeyIfInMap(e);return null!=t&&(this.size--,delete this._data[t],!0)}},{key:"forEach",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,r=Object.keys(this._data);r.sort(function(e,n){return t._data[e][2]-t._data[n][2]}),r.forEach(function(r){var o=u(t._data[r],2),i=o[0],a=o[1];e.call(n,a,i)})}},{key:"_getKeyIfInMap",value:function(e){var t=o(this._guid,e);return null==t?null:t in this._data?t:null}}]),e}());t.a=n.i(i.a)(window.Map)?window.Map:c},function(e,t,n){function r(e){return(null==e?0:e.length)?o(e,i):[]}var o=n(63),i=1/0;e.exports=r},function(e,t,n){function r(e,t,n,r){var u=!n;n||(n={});for(var a=-1,c=t.length;++a<c;){var f=t[a],s=r?r(n[f],e[f],f,n,e):void 0;void 0===s&&(s=e[f]),u?i(n,f,s):o(n,f,s)}return n}var o=n(44),i=n(29);e.exports=r},function(e,t,n){"use strict";function r(e,t){return i(e.querySelectorAll("style,link"),t)}function o(e,t){return i(e.querySelectorAll("::shadow style,::shadow link"),t)}function i(e,t){return f()(e).map(function(e){return e.sheet}).filter(function(e){return a(e,t)})}function u(e,t){return e.some(function(e){return n.i(s.a)(e).some(t)})}function a(e,t){if(!e)return!1;var r=void 0;try{r=n.i(s.a)(e)}catch(e){return!1}return!(!r||0===r.length)&&r.every(t)}var c=n(6),f=n.n(c),s=n(48);n.d(t,"b",function(){return l}),t.a=r,t.d=o,t.c=u;var l=(n(0).get("detection:artifact:get_sheets_with_rules"),{ONLY_DISPLAY_NONE:/{\s*display:\s*none\s*!\s*important;\s*}/,ROOT:/:root/,DISPLAY_NONE_AND_ORPHAN:/display\s*:\s*none\s*!\s*important.*orphans\s*:\s*4321/})},function(e,t,n){function r(e){return(null==e?0:e.length)?o(e,1):[]}var o=n(63);e.exports=r},function(e,t,n){"use strict";function r(e,t){return p()(e,t)}function o(e){return s()(e,c).join("")}function i(){return o(r(arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,arguments.length>1&&void 0!==arguments[1]?arguments[1]:25))}function u(){var e=i();return document.getElementsByClassName(e).length>0?u():e}function a(){var e=i();return null!=document.getElementById(e)?a():e}function c(){return String.fromCharCode(r(97,122))}var f=n(118),s=n.n(f),l=n(225),p=n.n(l);t.a=r,t.b=i,t.d=u,t.c=a;n(0).get("util:random_generators")},function(e,t,n){"use strict";function r(e,t,n){return new s.a(t,n.length>0,o.bind(null,e,n),n)}function o(e,t){for(var r=arguments.length,o=Array(r>2?r-2:0),u=2;u<r;u++)o[u-2]=arguments[u];return f()(t.map(function(t){return n.i(p.a)(t).map(function(t){var n=t.selectorText,r=n.replace(/::content/g,""),u=e.querySelectorAll(r);return a()(u).filter(function(e){return o.some(function(t){return t.contains(e)||e.contains(t)})}).map(function(t){var n=i(e,r,t);return new l.a(l.b.STYLE,t,n)})})}))}function i(e,t,n){return t.replace(/(\[[^\]]*),/g,"$1"+h).split(",").map(function(e){return e.trim().replace(h,",")}).filter(function(t){return a()(e.querySelectorAll(t)).some(function(e){return e===n})}).join(",")}var u=n(6),a=n.n(u),c=n(16),f=n.n(c),s=n(9),l=n(65),p=n(48);t.b=r,t.a=o;var h=(n(0).get("detection:artifact:get_cosmetic_finder_record"),"__SP__COMMA_PLACEHOLDER")},function(e,t,n){"use strict";function r(e){return("div"===e.tagName.toLowerCase()||"img"===e.tagName.toLowerCase()||"iframe"===e.tagName.toLowerCase())&&(!!o(e)||i(e))}function o(e){return 0===e.clientHeight||0===e.offsetHeight||0===e.offsetWidth||0===e.clientWidth}function i(e){if(window.getComputedStyle){var t=window.getComputedStyle(e,null);if("none"===t.getPropertyValue("display")||"hidden"===t.getPropertyValue("visibility"))return!0}return!1}function u(e){return a([e])[0]}function a(e){return e.map(function(e){var t=document.createElement("div");return Object.defineProperty(t,"_sp_isMarker",{writable:!1,configurable:!0,enumerable:!1,value:!0}),t.style.height="2px",t.style.width="2px",t.style.position="absolute",t.style.top="-9999px",t.style.left="-9999px",e.appendChild(t),[e,t]}).map(function(e){var t=f(e,2),n=t[0],r=t[1],i=o(r);return r.parentElement&&r.parentElement.removeChild(r),!(o(n)&&i)})}function c(e){return!0===e._sp_isMarker||!1}t.b=o,t.c=a,t.a=c;var f=function(){function e(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var u,a=e[Symbol.iterator]();!(r=(u=a.next()).done)&&(n.push(u.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{!r&&a["return"]&&a["return"]()}finally{if(o)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();n(0).get("util:dom:element_hidden");r.elementIsCollapsed=o,r.elementIsDisplayable=u,r.batchedElementIsDisplayable=a,r.isMarkerElement=c},function(e,t,n){function r(e,t){return o(e)?e:i(e,t)?[e]:u(a(e))}var o=n(10),i=n(184),u=n(195),a=n(47);e.exports=r},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=n(87),a=(n(0).get("util:dom:get_elements_from_selector:consumers:attribute_consumer:element_attribute_modification_record"),function(e){function t(e,n){r(this,t);var i=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.key=e,i.value=n,i}return i(t,e),t}(u.a));t.a=a},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){var t=e.match(/\?(.*)/);return null==t?new i.a:t[1].trim().split("&").reduce(function(e,t){var n=t.indexOf("=");if(-1===n)return e.set(t,""),e;var r=t.substring(0,n),o=t.substring(n+1);return e.set(r,o),e},new i.a)}var i=n(15),u=n(94),a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=(n(0).get("util:url"),function(){function e(t){r(this,e),this._parser=window.document.createElement("a"),this._parser.href=t,this._searchParams=o(this._parser.search)}return a(e,[{key:"_formatPathname",value:function(e){return"/"===e[0]?e:"/"+e}},{key:"toString",value:function(){var e=this.port?":"+this.port:"";return this.protocol+"//"+this.hostname+e+this.pathname+this.search+this.hash}},{key:"getSearchParam",value:function(e){var t=this._searchParams.get(encodeURIComponent(e));return null==t?t:decodeURIComponent(t)}},{key:"setSearchParam",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return this._searchParams.set(encodeURIComponent(e),encodeURIComponent(t))}},{key:"deleteSearchParam",value:function(e){return this._searchParams["delete"](encodeURIComponent(e))}},{key:"forEachSearchParam",value:function(e){return this._searchParams.forEach(function(t,n){e(decodeURIComponent(t),decodeURIComponent(n))})}},{key:"protocol",get:function(){return this._parser.protocol||window.location.protocol},set:function(e){return this._parser.protocol=e}},{key:"hostname",get:function(){return this._parser.hostname},set:function(e){return this._parser.hostname=e}},{key:"port",get:function(){return"21"===this._parser.port||"80"===this._parser.port||"443"===this._parser.port?"":this._parser.port},set:function(e){return this._parser.port=e}},{key:"pathname",get:function(){return this._formatPathname(this._parser.pathname)},set:function(e){var t=this._formatPathname(e);return this._parser.pathname=t}},{key:"search",get:function(){var e=this,t=n.i(u.a)(this._searchParams).map(function(t){return t+"="+e._searchParams.get(t)}).join("&");return t.length>0?"?"+t:t},set:function(e){var t="?"===e[0]?e:"?"+e;this._searchParams=o(t)}},{key:"hash",get:function(){return this._parser.hash},set:function(e){return this._parser.hash=e}}]),e}());t.a=c},function(e,t,n){var r=n(61),o=r(Object.keys,Object);e.exports=o},function(e,t,n){var r=n(145),o="object"==typeof self&&self&&self.Object===Object&&self,i=r||o||Function("return this")();e.exports=i},function(e,t,n){"use strict";function r(e){try{return i()(e)}catch(e){return!1}}var o=n(198),i=n.n(o);t.a=r;n(0).get("util:is_native")},function(e,t,n){function r(e,t,n){"__proto__"==t&&o?o(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}var o=n(182);e.exports=r},function(e,t,n){"use strict";function r(e){return e.join("")}n.d(t,"a",function(){return o}),n.d(t,"d",function(){return i}),n.d(t,"e",function(){return u}),n.d(t,"f",function(){return a}),n.d(t,"g",function(){return c}),n.d(t,"c",function(){return f}),n.d(t,"b",function(){return s});var o=(n(0).get("config:index"),"2.0.1003"),i=r(["w","w","w",".","s","u","m","m","e","r","h","a","m","s","t","e","r",".","c","o","m"]),u=r(["w","w","w",".","r","o","o","s","t","e","r","f","i","r","e","w","o","r","k",".","c","o","m"]),a=r(["/","/","f","s","m","1","0","1","9",".","g","l","o","b","a","l",".","s","s","l",".","f","a","s","t","l","y",".","n","e","t","/","f","s","m","/","d","s"]),c=r(["h","t","t","p","s",":","/","/","d","2","z","v","5","r","k","i","i","4","6","m","i","q",".","c","l","o","u","d","f","r","o","n","t",".","n","e","t","/","0","/","2",".","0",".","1","0","0","3","/","r","e","c","o","v","e","r","y","_","d","f","p","_","i","n","t","e","r","n","a","l","-","v","2",".","0",".","1","0","0","3",".","j","s"]),f=r(["h","t","t","p","s",":","/","/","d","2","z","v","5","r","k","i","i","4","6","m","i","q",".","c","l","o","u","d","f","r","o","n","t",".","n","e","t","/","0","/","2",".","0",".","1","0","0","3","/","r","e","c","o","v","e","r","y","_","l","i","b","_","a","p","i","_","i","f","r","a","m","e","-","v","2",".","0",".","1","0","0","3",".","h","t","m","l"]),s=r(["h","t","t","p","s",":","/","/","d","2","z","v","5","r","k","i","i","4","6","m","i","q",".","c","l","o","u","d","f","r","o","n","t",".","n","e","t","/","0","/","2",".","0",".","1","0","0","3","/","r","e","c","o","v","e","r","y","_","l","i","b","_","r","i","d","_","i","f","r","a","m","e","-","v","2",".","0",".","1","0","0","3",".","h","t","m","l"])},function(e,t){function n(e){return e}e.exports=n},function(e,t,n){function r(e){if(!i(e))return!1;var t=o(e);return t==a||t==c||t==u||t==f}var o=n(51),i=n(13),u="[object AsyncFunction]",a="[object Function]",c="[object GeneratorFunction]",f="[object Proxy]";e.exports=r},function(e,t,n){function r(e,t){for(var n=e.length;n--;)if(o(e[n][0],t))return n;return-1}var o=n(35);e.exports=r},function(e,t){function n(e){return e}e.exports=n},function(e,t){function n(e,t){return e===t||e!==e&&t!==t}e.exports=n},function(e,t){function n(e){return null!=e&&"object"==typeof e}e.exports=n},function(e,t){function n(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}e.exports=n},,function(e,t,n){function r(e){return null!=e&&i(e.length)&&!o(e)}var o=n(32),i=n(82);e.exports=r},function(e,t,n){"use strict";function r(){for(var e=n.i(o.a)(0,5),t=[],r=0;r<e;r++)t.push(n.i(o.b)());return t}var o=n(20);t.a=r;n(0).get("util:dom:get_elements_from_selector:consumers:attribute_consumer:generate_random_words")},function(e,t,n){"use strict";function r(e){return o.g.exec(e)[1]}var o=n(7);t.a=r;n(0).get("util:dom:get_elements_from_selector:consumers:attribute_consumer:unwrap_attribute_value")},function(e,t,n){"use strict";function r(e){var t=e.lookAheadRegex(f.b,f.c);t.length>0&&e.consumeCharacters(t);var n=void 0;n="*"===t||0===t.length?new o.b("div"):new o.b(t);for(var r=e.lookAheadRegex(f.d);r.length>0;){var i=s[r];n.addElementModificationRecord(i(e)),r=e.lookAheadRegex(f.d)}return n}var o=n(88),i=n(307),u=n(310),a=n(311),c=n(315),f=n(7);t.a=r;var s=(n(0).get("util:dom:get_elements_from_selector:consumers:element_consumer"),{"[":i.a,".":u.a,"#":c.a,":":a.a})},function(e,t,n){"use strict";function r(e){return new Error("Unsupported Selector: "+e)}function o(e){return new Error("Unparseable Selector: "+e)}function i(e){return new Error("Non-Matching Selector: "+e)}function u(e){return new Error("Network Request Triggering Selector: "+e)}t.c=r,t.a=o,t.b=i,t.d=u;n(0).get("util:dom:get_elements_from_selector:error")},function(e,t,n){function r(e,t,n){var r=e[t];a.call(e,t)&&i(r,n)&&(void 0!==n||t in e)||o(e,t,n)}var o=n(29),i=n(35),u=Object.prototype,a=u.hasOwnProperty;e.exports=r},function(e,t,n){"use strict";function r(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function o(e){var t=f(e);if(!t)return[];var n=m()(t.data,g),r=b()(n);return _()(r,function(e){return e.net_list}).map(function(e){return h()(e,function(e,t){return l()(t)})})}function i(e){return c(e,g)}function u(e){return c(e,E)}function a(e){var t=f(e);if(!t)return null;var n=t.data.test_urls;return{img:n.i_url,script:n.s_url}}function c(e,t){var n=[],o=f(e);if(!o)return n;var i=m()(o.data,t);for(var u in i){var a=i[u];if(a.hasOwnProperty("css")){var c=a.css,s=c.blacklist,l=c.non_specific_blacklist;n.push.apply(n,r(s)),n.push.apply(n,r(l))}}return n}function f(e){return e.responseText?JSON.parse(e.responseText):null}var s=n(346),l=n.n(s),p=n(350),h=n.n(p),d=n(62),_=n.n(d),y=n(120),b=n.n(y),v=n(104),m=n.n(v);t.c=o,t.d=i,t.a=u,t.b=a;var g=(n(0).get("detection:fsm:parse_data"),["reg","exception"]),E=["legacy"]},function(e,t,n){n(0).get("util:beacon:beacon_types");e.exports={BEACON:"bcn",IMPRESSION:"imp",CLICK:"clk",CONTEXT_CLICK:"ctx",CONTENT_CONTROL:"cct",MSG:"msg"}},function(e,t){function n(e){return e}e.exports=n},function(e,t,n){"use strict";function r(e){var t=void 0;try{if(null==e.cssRules)return[];t=c()(e.cssRules)}catch(e){return[]}return u()(c()(t).map(function(e){return o(e)}))}function o(e){return e.type===CSSRule.STYLE_RULE?e:null!=e.cssRules?c()(e.cssRules).map(function(e){return o(e)}):[]}var i=n(16),u=n.n(i),a=n(6),c=n.n(a);t.a=r;n(0).get("util:css:extract_style_rules_from_style_sheet")},function(e,t,n){var r=n(237),o=n(116),i=r(o);e.exports=i},function(e,t,n){n(0).get("util:beacon:beacon_keys");e.exports={USER_ID:"uid",SCRIPT_VERSION:"v",ACCOUNT_ID:"cid",PAGE_URL:"u",CORRELATION_ID:"bid",REASON_CODE:"rc",SENTINEL_FLAG:"sntl",ADBLOCK_DETECTED:"abl",FIRST_ACCESS:"fa",SESSION_START:"ss",PRIVACY_LIST_BLOCKED:"pl",UNSUPPORTED_OPERATING_SYSTEM:"unsupos",UNSUPPORTED_NEW_BROWSER:"unsupnb",UNSUPPORTED_USER_AGENT:"unsupua",RECOVERY_FLAG:"rcv",WHITELISTED_SESSION:"wnsk",INJECTION_STATE:"st",INJECTION_DOMAINS:"noq.id",INJECTION_CLASSES:"noq.ic",INJECTION_IDS:"noq.ii",DEBUG_0:"d0",DEBUG_1:"d1",DEBUG_2:"d2",CUSTOMER_1:"c0",CUSTOMER_2:"c1",CUSTOMER_3:"c2",EXCEPTION_RULES:"er",cct:{LOCK:"l",CONTROL_TYPE:"ct"},msg:{MSG_ID:"mid",MSG_EVENT_TYPE:"met"}}},function(e,t){function n(e){return o.call(e)}var r=Object.prototype,o=r.toString;e.exports=n},function(e,t,n){"use strict";function r(e){var t=e.document;return n.i(o.a)(t).then(function(e){return n.i(o.b)(e)?[]:e}).then(function(e){return new i.a(i.b.UBLOCK,e.length>0,o.c.bind(null,t),e)})}var o=n(84),i=n(9);t.a=r;n(0).get("detection:artifact:generic:ublock")},function(e,t,n){"use strict";function r(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.some(function(t){return e.nodeName.toLowerCase()===t})}function o(e){return r(e,"iframe")}function i(e){return r(e,"img")}function u(e){return r(e,"video")}function a(e){return o(e)&&(!e.src||"about:blank"===e.src||0===e.src.indexOf("javascript"))}function c(e,t){try{return"complete"===e.contentDocument.readyState&&e.contentDocument.body&&b()(e.contentDocument.querySelectorAll("*")).some(t)}catch(e){}}function f(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return c(e,function(n){return!r(n,"html","head","body")&&(t||!r(n,"link","script")&&!e.contentDocument.head.contains(n))})}function s(e){return c(e,function(e){return!r(e,"html","head","body")&&_(e)})}function l(e){return a(e)&&f(e)}function p(){function e(e){o(e.target)&&n.add(e.target)}var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window;if(g&&!E.has(t)){var n=g.get(t)||new m.a;n&&(g.set(t,n),E.set(t,e),t.document.addEventListener("load",e,!0))}}function h(e){if(f(e,!0))return!0;if(!g)return!1;var t=g.get(e.ownerDocument.defaultView);return!!t&&t.has(e)}function d(e){if(r.apply(void 0,[e].concat(w)))return!0;if(i(e)&&(null==e.naturalHeight||0===e.naturalHeight||1===e.naturalHeight||!e.complete))return!0;if(e.ownerDocument.head.contains(e))return!0;if(o(e)){if(!1===s(e))return!0}return!1}function _(e){return!d(e)&&(0===e.children.length||(!!b()(e.childNodes).some(function(e){return 3===e.nodeType&&e.data.trim().length>0})||(!!r.apply(void 0,[e].concat(O))||e.ownerDocument.defaultView.getComputedStyle(e).backgroundImage.toLowerCase().indexOf("url(")>-1)))}var y=n(6),b=n.n(y),v=n(15),m=n(54);t.d=r,t.c=o,t.g=i,t.h=u,t.b=l,t.a=p,t.f=h,t.i=d,t.e=_;var g=(n(0).get("util:dom:is_element"),new v.a),E=new v.a,O=["iframe","img","video","object","input","button","select","textarea"],w=["link","script"]},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=n(15),i=n(28),u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=(n(0).get("util:set"),function(){function e(){r(this,e),this._data=new o.a}return u(e,[{key:"add",value:function(e){this._data.set(e,e)}},{key:"has",value:function(e){return this._data.has(e)}},{key:"delete",value:function(e){return this._data["delete"](e)}},{key:"clear",value:function(){return this._data.clear()}},{key:"forEach",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;this._data.forEach(function(n){e.call(t,n)})}},{key:"size",get:function(){return this._data.size}}]),e}());t.a=n.i(i.a)(window.Set)?window.Set:a},function(e,t){function n(){return!1}e.exports=n},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=n(3),a=n(85),c=n(1),f=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=(n(0).get("detection:fsm:data_dependent_test"),function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),f(t,null,[{key:"findDependency",value:function(e){return e.has(c.b.FSM_DATA)}},{key:"getFSMData",value:function(e,t){return e.map(function(e){return e.getData(a.a)}).filter(function(e){return e}).map(function(e){return t(e)}).filter(function(e){return e})}}]),t}(u.a));t.a=s},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=n(1),a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=(n(0).get("detection:test_result:attribute:data:index"),function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"DataAttribute"));return n._value=e,n}return i(t,e),a(t,[{key:"is",value:function(e){return e instanceof t&&e.getValue()===this._value}},{key:"getValue",value:function(){return this._value}}]),t}(u.e));t.a=c},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=(n(0).get("util:dom:get_elements_from_selector:element_hierarchy_modification_record"),function(){function e(t){r(this,e),this.elementRecord=t}return o(e,[{key:"applyToElementRecord",value:function(e){throw new Error("not implemented")}},{key:"getElementRecord",value:function(){return this.elementRecord}}]),e}());t.a=i},function(e,t,n){function r(e,t){return u(i(e,t,o),e+"")}var o=n(110),i=n(193),u=n(194);e.exports=r},function(e,t){function n(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}e.exports=n},function(e,t){function n(e,t){return function(n){return e(t(n))}}e.exports=n},function(e,t,n){function r(e,t){return o(i(e,t),1)}var o=n(63),i=n(199);e.exports=r},function(e,t,n){function r(e,t,n,u,a){var c=-1,f=e.length;for(n||(n=i),a||(a=[]);++c<f;){var s=e[c];t>0&&n(s)?t>1?r(s,t-1,n,u,a):o(a,s):u||(a[a.length]=s)}return a}var o=n(236),i=n(239);e.exports=r},function(e,t,n){"use strict";function r(e){d="OFF"!==e;var t={defaultLevel:h[e]},n={};p.a.ie()||p.a.edge()?t.formatter=function(e,t){null!=t.name&&e.unshift("[SP:"+t.name+"]")}:t.formatter=function(e,t){var r=t.name;if(null!=r){if(!(r in n)){var o=f(c(u(i(r))));n[r]=o}e.unshift("%c[SP:"+r+"]","color: "+n[r])}},l.a.useDefaults(t)}function o(){return d}function i(e){for(var t=0,n=0;n<e.length;n++){t=(t<<5)-t+e.charCodeAt(n),t|=0}return t}function u(e){return[(16711680&e)>>16,(65280&e)>>8,255&e]}function a(e){return.299*e[0]+.587*e[1]+.114*e[2]}function c(e){var t=a(e);if(t>_){var n=_/t;return[Math.floor(e[0]*n),Math.floor(e[1]*n),Math.floor(e[2]*n)]}return e}function f(e){return"#"+e.map(function(e){return e.toString(16)}).join("")}Object.defineProperty(t,"__esModule",{value:!0});var s=n(0),l=n.n(s),p=n(14);t["default"]=r,t.isLoggerEnabled=o;var h=(n(0).get("util:logger:init"),{DEBUG:l.a.DEBUG,INFO:l.a.INFO,TIME:l.a.TIME,WARN:l.a.WARN,ERROR:l.a.ERROR,OFF:l.a.OFF}),d=!1,_=100},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,"b",function(){return i});var o=(n(0).get("detection:artifact:element_match_record"),function e(t,n,o){r(this,e),this.type=t,this.element=n,this.info=o});t.a=o;var i={STYLE:"s",MOZ:"m"}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=n(3),a=n(4),c=n(8),f=n(2),s=n(22),l=n(135),p=n(1),h=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),d=n(0).get("detection:generic_adblocker:element_hiding_test"),_=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),h(t,null,[{key:"getSchema",value:function(){return new a.a(p.b.GENERIC_ADBLOCKER,p.c.INFERENCE,p.c.ELEMENT,p.c.HIDING,p.c.HIDING_DATA)}},{key:"testMethod",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:".plainAd",t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:30;return new f["default"](function(i){function u(t){if(n.i(s.b)(f))return d.error("control element hidden, standing down element hiding detection test",f),h(p.a.NOT_PRESENT,p.f.CONTROL_ELEMENT_HIDDEN);n.i(s.b)(a)&&(d.info("bait element hidden, element hiding detection test detected adblocker",a),h(p.a.PRESENT,p.f.ELEMENT_HIDDEN,c.a.fromElement(a,{selector:e,hiddenImmediately:t})))}var a=n.i(l.a)(e,r.document)[0];a.style.position="absolute",a.style.top="-2000px",a.style.left="-2000px",a.style.height="30px",a.style.width="30px";var f=a.cloneNode(!1);f.removeAttribute("class"),f.removeAttribute("id"),r.document.body.appendChild(a),r.document.body.appendChild(f);var h=function(){for(var n,o=arguments.length,u=Array(o),c=0;c<o;c++)u[c]=arguments[c];r.clearInterval(y),a.parentElement&&r.document.body.removeChild(a),f.parentElement&&r.document.body.removeChild(f),i((n=t.getSchema()).createResult.apply(n,[new p.v(e)].concat(u)))},_=0,y=r.setInterval(function(){if(++_===o)return d.info("bait element not hidden, element hiding detection test did not detect adblocker"),void h(p.a.NOT_PRESENT,p.f.NO_ELEMENT_HIDDEN);u(!1)},10);u(!0)})}}]),t}(u.b);t.a=_},function(e,t,n){var r=n(44),o=n(17),i=n(71),u=n(39),a=n(102),c=n(26),f=Object.prototype,s=f.hasOwnProperty,l=i(function(e,t){if(a(t)||u(t))return void o(t,c(t),e);for(var n in t)s.call(t,n)&&r(e,n,t[n])});e.exports=l},function(e,t){function n(){}e.exports=n},,function(e,t,n){function r(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}var o=n(187),i=n(188),u=n(189),a=n(190),c=n(191);r.prototype.clear=o,r.prototype["delete"]=i,r.prototype.get=u,r.prototype.has=a,r.prototype.set=c,e.exports=r},function(e,t,n){function r(e){return o(function(t,n){var r=-1,o=n.length,u=o>1?n[o-1]:void 0,a=o>2?n[2]:void 0;for(u=e.length>3&&"function"==typeof u?(o--,u):void 0,a&&i(n[0],n[1],a)&&(u=o<3?void 0:u,o=1),t=Object(t);++r<o;){var c=n[r];c&&e(t,c,r,u)}return t})}var o=n(59),i=n(78);e.exports=r},function(e,t){function n(){return!1}e.exports=n},function(e,t,n){function r(e){return e&&e.length?o(e):[]}var o=n(81);e.exports=r},function(e,t){function n(e,t){for(var n=-1,r=null==e?0:e.length,o=Array(r);++n<r;)o[n]=t(e[n],n,e);return o}e.exports=n},function(e,t,n){function r(e,t){t=o(t,e);for(var n=0,r=t.length;null!=e&&n<r;)e=e[i(t[n++])];return n&&n==r?e:void 0}var o=n(23),i=n(34);e.exports=r},function(e,t){function n(e){for(var t=-1,n=null==e?0:e.length,r=0,o=[];++t<n;){var i=e[t];i&&(o[r++]=i)}return o}e.exports=n},function(e,t){function n(e){return o.call(e)}var r=Object.prototype,o=r.toString;e.exports=n},function(e,t){function n(){return!1}e.exports=n},,function(e,t,n){"use strict";function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t,n,r){var o=e.charCodeAt(0),i=r-n;if(o<n||o>r)return o;var u=o-n;return u=(u+t+i)%i,String.fromCharCode(u+n)}n.d(t,"a",function(){return s});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=(n(0).get("util:shift_cipher"),function(){function e(t){i(this,e),this._shift=t}return a(e,[{key:"encode",value:function(e){return this._encode(e,this._shift)}},{key:"decode",value:function(e){return this._encode(e,-this._shift)}}]),e}()),f=function(e){function t(){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),a(t,[{key:"_encode",value:function(e,t){return e.split("").map(function(e){return u(e,t,33,127)}).join("")}}]),t}(c);t.b=f;var s=function(e){function t(){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),a(t,[{key:"_encode",value:function(e,t){return e.replace(/[A-Z]/g,function(e){return u(e,t,65,91)}).replace(/[a-z]/g,function(e){return u(e,t,97,123)})}}]),t}(c)},function(e,t,n){function r(e,t,n){var r=-1,l=i,p=e.length,h=!0,d=[],_=d;if(n)h=!1,l=u;else if(p>=s){var y=t?null:c(e);if(y)return f(y);h=!1,l=a,_=new o}else _=t?[]:d;e:for(;++r<p;){var b=e[r],v=t?t(b):b;if(b=n||0!==b?b:0,h&&v===v){for(var m=_.length;m--;)if(_[m]===v)continue e;t&&_.push(v),d.push(b)}else l(_,v,n)||(_!==d&&_.push(v),d.push(b))}return d}var o=n(124),i=n(234),u=n(235),a=n(125),c=n(238),f=n(109),s=200;e.exports=r},function(e,t){function n(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=r}var r=9007199254740991;e.exports=n},function(e,t,n){"use strict";function r(){return i++,i%=o.length,o[i]}n.d(t,"a",function(){return o}),t.b=r;var o=(n(0).get("detection:artifact:get_easylist_classnames"),["ad-space","placeholder-ad","placeholderAd","plainAd","play-page-ads","playAds1","playAds2","player-ads","player-leaderboard-ad-wrapper","player-under-ad","playerAd","player_ad","player_ad2","player_ad_box","player_hover_ad","player_page_ad_box"]),i=Math.floor(Math.random()*o.length)},function(e,t,n){"use strict";function r(e){return o(e,function(){var t=n.i(p.a)(e,function(e){return p.b.ONLY_DISPLAY_NONE.test(e.cssText)}),r=t.length>0&&t.every(function(e){return e.cssRules.length<50}),o=n.i(p.c)(t,function(e){return s.a.some(function(t){return e.selectorText.toLowerCase().indexOf(t.toLowerCase())>-1})});return r&&o?t:[]})}function o(e,t){var r=e.createElement("div");return new f["default"](function(t){r.className=n.i(s.b)();var o=new MutationObserver(function(n){n.some(function(e){return c()(e.addedNodes).some(function(e){return e===r})})&&(o.disconnect(),e.defaultView.setTimeout(function(){t()},1))});o.observe(e.body,{childList:!0}),e.body.appendChild(r)}).then(function(){return new f["default"](function(n){e.defaultView.setTimeout(function(){n(t(r)),r.parentElement&&e.body.removeChild(r)},150)})})}function i(e){return n.i(p.c)(e,function(e){return p.b.ROOT.test(e.cssText)})}function u(e){for(var t=arguments.length,n=Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return r(e).then(function(t){return l.a.apply(void 0,[e,t].concat(n))})}var a=n(6),c=n.n(a),f=n(2),s=n(83),l=n(21),p=n(18);t.a=r,t.d=o,t.b=i,t.c=u;n(0).get("detection:artifact:get_ublock_sheets")},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=n(57),a=(n(0).get("detection:test_result:attribute:data:xhr"),function(e){function t(e){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return i(t,e),t}(u.a));t.a=a},,function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=(n(0).get("util:dom:get_elements_from_selector:element_modification_record"),function(){function e(){r(this,e)}return o(e,[{key:"applyToElement",value:function(e){throw new Error("not implemented")}}]),e}());t.a=i},function(e,t,n){"use strict";function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){return(e instanceof a.a?1:-1)-(t instanceof a.a?1:-1)}var a=n(24);n.d(t,"a",function(){return f});var c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),f=(n(0).get("util:dom:get_elements_from_selector:element_record"),function(){function e(){i(this,e),this._childElementRecords=[]}return c(e,[{key:"appendChildElementRecord",value:function(e){e.setParentElementRecord(this),this._childElementRecords.push(e)}},{key:"generateElementHierarchy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document;return this._childElementRecords.map(function(t){return t.generateElement(e)})}}]),e}()),s=function(e){function t(e){i(this,t);var n=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n._nodeName=e,n._elementModificationRecords=[],n}return o(t,e),c(t,[{key:"addElementModificationRecord",value:function(e){this._elementModificationRecords.push(e)}},{key:"setParentElementRecord",value:function(e){this._parentElementRecord=e}},{key:"getParentElementRecord",value:function(){return this._parentElementRecord}},{key:"generateElement",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document,t=e.createElement(this._nodeName);return this._elementModificationRecords.slice().sort(u).forEach(function(e){e.applyToElement(t)}),this.generateElementHierarchy(e).forEach(function(e){t.appendChild(e)}),t}}]),t}(f);t.b=s},function(e,t,n){function r(e,t,n){(void 0===n||i(e[t],n))&&(void 0!==n||t in e)||o(e,t,n)}var o=n(29),i=n(35);e.exports=r},function(e,t,n){var r=n(181),o=r();e.exports=o},function(e,t,n){var r=n(27),o=r["__core-js_shared__"];e.exports=o},function(e,t,n){var r=n(61),o=r(Object.getPrototypeOf,Object);e.exports=o},function(e,t){function n(e,t){return!!(t=null==t?r:t)&&("number"==typeof e||o.test(e))&&e>-1&&e%1==0&&e<t}var r=9007199254740991,o=/^(?:0|[1-9]\d*)$/;e.exports=n},function(e,t,n){"use strict";function r(e){if(e instanceof o.a){if("function"==typeof e.keys&&"function"==typeof Array.from&&n.i(u.a)(Array.from)){return Array.from.bind(Array)(e.keys())}var t=[];return e.forEach(function(e,n){return t.push(n)}),t}if(e instanceof i.a){if("function"==typeof e.keys&&"function"==typeof Array.from&&n.i(u.a)(Array.from)){return Array.from.bind(Array)(e.keys())}var r=[];return e.forEach(function(e){return r.push(e)}),r}throw new Error("non es6 structure")}var o=n(15),i=n(54),u=n(28);t.a=r;n(0).get("util:es6_keys")},,function(e,t,n){"use strict";function r(e){for(var t=[],r=e;r&&!n.i(u.d)(r,"html","head","body");)t.push(r),r=r.parentElement;t.reverse();var o=e.querySelectorAll("*");return t.concat(i()(o))}var o=n(6),i=n.n(o),u=n(53);t.a=r;n(0).get("util:dom:get_all_elements_in_hierarchy")},function(e,t,n){"use strict";function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e){return function(e){function t(){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),t}(e)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=(n(0).get("util:mixin"),function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u;i(this,e),this._toCallback=t,this._mixinClasses=[]}return a(e,[{key:"to",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var o=this._toCallback.apply(this,[e].concat(n));return this._mixinClasses.push(o),o}},{key:"test",value:function(e){var t=e.hasOwnProperty("prototype")?e.prototype:e;return this._mixinClasses.some(function(n){return t instanceof n||e===n})}}]),e}());t.a=c},function(e,t){function n(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}e.exports=n},function(e,t){function n(e,t,n){for(var r=n-1,o=e.length;++r<o;)if(e[r]===t)return r;return-1}e.exports=n},function(e,t,n){(function(e){function r(e,t){if(t)return e.slice();var n=e.length,r=f?f(n):new e.constructor(n);return e.copy(r),r}var o=n(27),i="object"==typeof t&&t&&!t.nodeType&&t,u=i&&"object"==typeof e&&e&&!e.nodeType&&e,a=u&&u.exports===i,c=a?o.Buffer:void 0,f=c?c.allocUnsafe:void 0;e.exports=r}).call(t,n(203)(e))},function(e,t,n){function r(e){return"function"!=typeof e.constructor||u(e)?{}:o(i(e))}var o=n(171),i=n(92),u=n(102);e.exports=r},function(e,t){function n(){return!1}e.exports=n},function(e,t){function n(){return!1}e.exports=n},function(e,t,n){var r=n(176),o=n(113),i=o(function(e,t){return null==e?{}:r(e,t)});e.exports=i},function(e,t,n){"use strict";function r(e){var t=e.document;return n.i(o.a)(t).then(function(e){return n.i(o.b)(e)?e:[]}).then(function(e){return new i.a(i.b.UBLOCK_ORIGIN,e.length>0,o.c.bind(null,t),e)})}var o=n(84),i=n(9);t.a=r;n(0).get("detection:artifact:generic:ublock_origin")},function(e,t,n){var r=n(27),o=r.Symbol;e.exports=o},function(e,t,n){function r(e,t,n,r){if(!a(e))return e;t=i(t,e);for(var f=-1,s=t.length,l=s-1,p=e;null!=p&&++f<s;){var h=c(t[f]),d=n;if(f!=l){var _=p[h];d=r?r(_,h,p):void 0,void 0===d&&(d=a(_)?_:u(t[f+1])?[]:{})}o(p,h,d),p=p[h]}return e}var o=n(44),i=n(23),u=n(93),a=n(13),c=n(34);e.exports=r},function(e,t,n){function r(e,t,n){t=o(t,e);for(var r=-1,s=t.length,l=!1;++r<s;){var p=f(t[r]);if(!(l=null!=e&&n(e,p)))break;e=e[p]}return l||++r!=s?l:!!(s=null==e?0:e.length)&&c(s)&&a(p,s)&&(u(e)||i(e))}var o=n(23),i=n(55),u=n(10),a=n(93),c=n(82),f=n(34);e.exports=r},function(e,t){function n(){return[]}e.exports=n},function(e,t){function n(e){return e}e.exports=n},function(e,t,n){function r(e){return i(e)&&o(e)}var o=n(39),i=n(36);e.exports=r},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=n(5),i=n(11),u=n(80),a=n(30),c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),f=n(0).get("util:beacon:core"),s=n(230).beacon,l=n(46),p=n(50),h=new u.a(s.shiftKey),d=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l.BEACON,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o["default"].get(["beacon","pageViewEndpoint"]),a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];r(this,e),window._sp_&&window._sp_._bid?this._bid=window._sp_._bid:(this._bid=Math.floor(1e9*Math.random()),n.i(i.a)("_bid",this._bid)),this._beaconType=t,this._data={},this._endpoint=u,this._sent=!1,this._shouldCipher=a}return c(e,[{key:"set",value:function(e,t){this._data[e]=String(t)}},{key:"get",value:function(e){return this._data[e]}},{key:"unset",value:function(e){delete this._data[e]}},{key:"send",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};if(!0===this._sent)return void e(new Error("Beacon already sent"));this._sent=!0,this.set("cb",(new Date).getTime()),this.populateBeaconFields(),this._sendBeacon(e)}},{key:"populateBeaconFields",value:function(){this.set(p.SCRIPT_VERSION,a.a),this.set(p.CORRELATION_ID,this._bid),this.set(p.ACCOUNT_ID,o["default"].get("accountId"))}},{key:"getBeaconUrl",value:function(){return"//"+this._getEndpoint()+"/"+this._beaconType+"?"+this._encodeData()}},{key:"_sendBeacon",value:function(e){var t=this.getBeaconUrl(),n=new Image;f.info("firing "+this._beaconType+" beacon: "+t),f.info("beacon data",this._data),n.addEventListener("load",function(){return e()}),n.addEventListener("error",function(t){return e(t)}),n.src=t}},{key:"_getEndpoint",value:function(){return this.processEndpoint(this._endpoint)}},{key:"processEndpoint",value:function(e){return e}},{key:"_encodeData",value:function(){var e=this,t=Object.keys(this._data).map(function(t){return encodeURIComponent(e._shouldCipher?h.encode(t):t)+"="+encodeURIComponent(e._shouldCipher?h.encode(e._data[t]):e._data[t])});return t=this.dataPostProcessing(t),t.join("&")}},{key:"dataPostProcessing",value:function(e){return e}}]),e}();t.a=d},function(e,t){function n(e){return e}e.exports=n},function(e,t){function n(){return!1}e.exports=n},function(e,t,n){function r(e){return i(e)?u(e):o(e)}var o=n(217),i=n(114),u=n(223);e.exports=r},function(e,t,n){function r(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var c=null==n?0:u(n);return c<0&&(c=a(r+c,0)),o(e,i(t,3),c)}var o=n(218),i=n(31),u=n(119),a=Math.max;e.exports=r},function(e,t,n){function r(e){if(!u(e)||o(e)!=a)return!1;var t=i(e);if(null===t)return!0;var n=l.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&s.call(n)==p}var o=n(51),i=n(92),u=n(36),a="[object Object]",c=Function.prototype,f=Object.prototype,s=c.toString,l=f.hasOwnProperty,p=s.call(Object);e.exports=r},function(e,t){function n(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}e.exports=n},function(e,t){function n(e){return e}e.exports=n},function(e,t,n){function r(e){return null==e?[]:o(e,i(e))}var o=n(220),i=n(26);e.exports=r},,function(e,t,n){"use strict";function r(e,t){return(Element.prototype.matches||Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(e){var t=this,n=(this.document||this.ownerDocument).querySelectorAll(e);return i()(n).some(function(e){return e===t})}).call(e,t)}var o=n(6),i=n.n(o);t.a=r;n(0).get("util:dom:matches_selector")},,function(e,t,n){function r(){if(!arguments.length)return[];var e=arguments[0];return o(e)?e:[e]}var o=n(10);e.exports=r},function(e,t,n){function r(e,t){return!!(null==e?0:e.length)&&o(e,t,0)>-1}var o=n(99);e.exports=r},function(e,t){function n(){return!1}e.exports=n},function(e,t,n){"use strict";var r=n(263);n(0).get("detection:adblocker:generic:ublock_origin:index");t.a=[r.a]},function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.location,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:window.navigator;return n.i(a.b)(e,t,r).then(function(t){var n=t.blocked,r=t.succeeded,o=t.type,a=t.status,c=t.timeStamp,f=t.errorText,h=t.xhr;s.info("ajax test finished",n,r,o,a,c,f,h);var d=n?l[o]:p[o],_=[];return null!=a&&_.push(new u.h(a)),null!=c&&_.push(new u.i(c)),null!=f&&_.push(new u.j(f)),_.push(new u.g(e)),{blocked:n,succeeded:r,reasonAttribute:d,infoAttributes:_,xhrData:h&&new i.a(h)}})}var i=n(85),u=n(1),a=n(228);t.a=o;var c,f,s=n(0).get("detection:interference:ajax_network_test:promise"),l=(c={},r(c,a.a.NETWORK_FAILURE,u.f.AJAX_LOAD_BLOCK),r(c,a.a.OPEN_ERROR,u.f.AJAX_OPEN_BLOCK),r(c,a.a.SEND_ERROR,u.f.AJAX_SEND_BLOCK),c),p=(f={},r(f,a.a.SUCCEEDED,u.f.AJAX_LOAD_SUCCESS),r(f,a.a.NETWORK_FAILURE,u.f.AJAX_LOAD_ERROR),r(f,a.a.OFFLINE,u.f.OFFLINE),r(f,a.a.PROTOCOL_MISMATCH,u.f.PROTOCOL_MISMATCH),f)},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e,t){return new p["default"](function(n){var r=document.createElement("div");r.style.position="absolute",r.style.left="-9999px",r.style.top="-9999px",r.style.width="1px",r.style.height="1px";var o=new Image;o.setAttribute("height","1"),o.setAttribute("width","1"),r.appendChild(o);var i=c()(function(o,i,u){r.parentElement&&document.body.removeChild(r),n(e.createResult(o,i,new h.g(t),new l.a(u)))});o.addEventListener("load",function(e){o.src===y?i(h.a.PRESENT,h.f.URL_REWRITTEN,e):i(h.a.NOT_PRESENT,h.f.NO_LOAD_BLOCK,e)},!0),o.addEventListener("error",function(e){i(h.a.PRESENT,h.f.LOAD_BLOCK,e)},!0),o.src=t,document.body.appendChild(r)})}var a=n(146),c=n.n(a),f=n(3),s=n(4),l=n(131),p=n(2),h=n(1),d=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),_=(n(0).get("detection:interference:image_network_test"),function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),d(t,null,[{key:"getSchema",value:function(){return new s.a(h.b.INTERFERENCE,h.c.INFERENCE,h.c.IMAGE,h.c.NETWORK)}},{key:"testMethod",value:function(e){return null==e?this.getSchema().createResult(h.a.NOT_PRESENT,h.f.CANNOT_TEST):u(this.getSchema(),e)}}]),t}(f.b));t.a=_;var y="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACwAAAAAAQABAAACAkQBADs="},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e){return e+"?cb="+Date.now()}function a(e,t,n){var r=n.document.createElement("script");return new l["default"](function(o){r.addEventListener("load",function(n){o(e.createResult(d.a.NOT_PRESENT,d.f.NO_LOAD_BLOCK,new d.g(t),new s.a(n)))}),r.addEventListener("error",function(n){o(e.createResult(d.a.PRESENT,d.f.LOAD_BLOCK,new d.g(t),new s.a(n)))}),h.a.safari()&&window.setTimeout(function(){o(e.createResult(d.a.NOT_PRESENT,d.f.TIMEOUT,new d.g(t)))},1e4),r.src=t,n.document.body.appendChild(r)}).then(function(e){return r.parentElement&&r.parentElement.removeChild(r),e})}var c=n(3),f=n(4),s=n(131),l=n(2),p=n(128),h=n(14),d=n(1),_=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),y=(n(0).get("detection:interference:script_network_test"),["/","/","d","3","u","j","i","d","s6","8","p","6x","m","q",".","c","l","o","ud","f","r","o","n","t",".","ne","t","/","x",".","j","s"].join("")),b=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),_(t,null,[{key:"getSchema",value:function(){return new f.a(d.b.INTERFERENCE,d.c.INFERENCE,d.c.SCRIPT,d.c.AJAX,d.c.NETWORK)}},{key:"testMethod",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:y,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window,r=u(e);return a(this.getSchema(),r,t).then(function(e){return e.has(d.a.NOT_PRESENT)?e:n.i(p.a)(r).then(function(t){return t.blocked||t.succeeded?e.addAttribute(t.reasonAttribute,t.infoAttributes):e.addAttribute(d.a.NOT_PRESENT,t.reasonAttribute,t.infoAttributes).removeAttribute(d.a.PRESENT)})})}}]),t}(c.b);t.a=b},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=n(57),a=(n(0).get("detection:test_result:attribute:data:event"),function(e){function t(e){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return i(t,e),t}(u.a));t.a=a},function(e,t,n){"use strict";function r(e){var t={};for(var n in u)!function(n){t[n]=e.filter(function(e){return u[n](e)})}(n);return t}var o=n(57),i=n(1);t.a=r;var u=(n(0).get("detection:test_result:attribute:group_attributes_by_type"),{types:i.k,tests:i.l,reasons:i.m,results:i.d,info:i.n,data:function(e){return e instanceof o.a}})},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=n(76),i=n.n(o),u=n(19),a=n.n(u),c=n(141),f=n.n(c),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=(n(0).get("detection:test_result:core"),function(){function e(){r(this,e);for(var t=arguments.length,n=Array(t),o=0;o<t;o++)n[o]=arguments[o];this.attributes=f()(a()(i()(n)),function(e,t){return e.is(t)})}return s(e,[{key:"has",value:function(){for(var e=this,t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.every(function(t){return e.attributes.some(function(e){return e.is(t)})})}}]),e}());t.a=l},function(e,t,n){"use strict";function r(){for(var e=n.i(i.a)(0,5),t=[],r=0;r<e;r++){var a=u[n.i(i.a)(0,u.length)];t.push(new o.b(a))}return t}var o=n(88),i=n(20);t.a=r;var u=(n(0).get("util:dom:get_elements_from_selector:consumers:generate_random_element_records"),["li","span","div"])},function(e,t,n){"use strict";function r(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;try{t.querySelector(e)}catch(t){throw n.i(a.a)(e.toString())}var r=n.i(u.a)(new i.a(e.trim())).generateElementHierarchy(t);return o(e,r,t),r}function o(e,t,r){var o=r.createElement("div");if(t.forEach(function(e){o.appendChild(e)}),!(null!=o.querySelector(e)))throw n.i(a.b)(e)}var i=n(317),u=n(312),a=n(43);t.a=r;n(0).get("util:dom:get_elements_from_selector:index")},function(e,t,n){"use strict";function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,"a",function(){return a}),n.d(t,"b",function(){return c});var u=(n(0).get("util:network_event"),function e(t,n){i(this,e),this.src=t,this.tagName=n}),a=function(e){function t(){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),t}(u),c=function(e){function t(){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),t}(u)},function(e,t){function n(e,t,n){var r=-1,o=e.length;t<0&&(t=-t>o?0:o+t),n=n>o?o:n,n<0&&(n+=o),o=t>n?0:n-t>>>0,t>>>=0;for(var i=Array(o);++r<o;)i[r]=e[r+t];return i}e.exports=n},function(e,t,n){var r=n(61),o=r(Object.keys,Object);e.exports=o},function(e,t){function n(e){var t=null==e?0:e.length;return t?e[t-1]:void 0}e.exports=n},function(e,t,n){function r(e,t){return e&&e.length?i(e,o(t,2)):[]}var o=n(31),i=n(81);e.exports=r},function(e,t,n){function r(e,t){return t="function"==typeof t?t:void 0,e&&e.length?o(e,void 0,t):[]}var o=n(81);e.exports=r},function(e,t,n){"use strict";var r=(n(0).get("util:logger:levels"),["DEBUG","INFO","TIME","WARN","ERROR","OFF"]);t.a=r},,,function(e,t,n){(function(t){var n="object"==typeof t&&t&&t.Object===Object&&t;e.exports=n}).call(t,n(147))},function(e,t,n){function r(e){return o(2,e)}var o=n(345);e.exports=r},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";var r=n(16),o=n.n(r),i=n(245),u=n(247),a=n(249),c=n(251),f=n(127);n(0).get("detection:adblocker:chrome:index");t.a=o()([i.a,u.a,a.a,c.a,f.a])},function(e,t,n){"use strict";var r=n(16),o=n.n(r),i=n(254),u=n(256),a=n(259),c=n(127);n(0).get("detection:adblocker:firefox:index");t.a=o()([i.a,u.a,a.a,c.a])},function(e,t,n){"use strict";var r=n(16),o=n.n(r),i=n(265);n(0).get("detection:adblocker:internet_explorer:index");t.a=o()([i.a])},function(e,t,n){"use strict";var r=n(16),o=n.n(r),i=n(266);n(0).get("detection:adblocker:opera:index");t.a=o()([i.a])},function(e,t,n){"use strict";var r=n(16),o=n.n(r),i=n(268),u=n(270),a=n(261);n(0).get("detection:adblocker:safari:index");t.a=o()([i.a,u.a,a.a])},function(e,t,n){"use strict";function r(e){var t=e.document,r=n.i(u.d)(t,function(e){return u.b.ONLY_DISPLAY_NONE.test(e.cssText)}),a=1===r.length&&r[0].cssRules.length<200?r:[];return n.i(o.b)(t,i.b.ADBLOCK,a)}var o=n(21),i=n(9),u=n(18);t.a=r;n(0).get("detection:artifact:chrome:adblock")},function(e,t,n){"use strict";function r(e){var t=e.document,r=n.i(u.d)(t,function(e){return u.b.ONLY_DISPLAY_NONE.test(e.cssText)}),a=1===r.length&&r[0].cssRules.length<200?r:[];return n.i(o.b)(t,i.b.ADBLOCK_PLUS,a)}var o=n(21),i=n(9),u=n(18);t.a=r;n(0).get("detection:artifact:chrome:adblock_plus")},function(e,t,n){"use strict";function r(e){var t=e.document,r=n.i(u.d)(t,function(e){return u.b.ONLY_DISPLAY_NONE.test(e.cssText)}),a=2===r.length||3===r.length?r:[];return n.i(o.b)(t,i.b.ADGUARD,a)}var o=n(21),i=n(9),u=n(18);t.a=r;n(0).get("detection:artifact:chrome:adguard")},function(e,t,n){"use strict";function r(e){var t=e.document,r=o(t,n.i(b.b)()),a=o(t);return t.body.appendChild(r),t.body.appendChild(a),new _["default"](function(t){i(e,r)&&n.i(v.b)(r)&&!n.i(v.b)(a)?window.setTimeout(function(){window.setTimeout(function(){t(n.i(v.b)(r))},300)},1):t(!1)}).then(function(n){return r.parentElement&&t.body.removeChild(r),a.parentElement&&t.body.removeChild(a),u(n,e)})}function o(e,t){var n=e.createElement("div");return n.className=t||"",n.style.width="1px",n.style.height="1px",n.style.position="absolute",n.style.top="-9999px",n}function i(e,t){return((e.getComputedStyle(t)||{}).MozBinding||"").indexOf("abp-elemhide")>-1}function u(e,t){return new h.a(h.b.ADBLOCK_PLUS,e,a.bind(null,t))}function a(e){for(var t=arguments.length,r=Array(t>1?t-1:0),o=1;o<t;o++)r[o-1]=arguments[o];var u=p()(r,function(e){return n.i(y.a)(e)}).filter(function(t){return i(e,t)}).map(function(e){return new d.a(d.b.MOZ,e,c(e))});return s()(u,function(e){return e.element})}function c(e){return e.nodeName.toLowerCase()+"#"+e.id+"."+e.className}var f=n(140),s=n.n(f),l=n(62),p=n.n(l),h=n(9),d=n(65),_=n(2),y=n(96),b=n(83),v=n(22);t.a=r;n(0).get("detection:artifact:firefox:adblock_plus")},function(e,t,n){"use strict";function r(e){var t=e.document,r=n.i(u.a)(t,function(e){return u.b.ONLY_DISPLAY_NONE.test(e.cssText)}),a=(2===r.length||3===r.length)&&r[0].cssRules.length>300?r:[];return n.i(o.b)(t,i.b.ADGUARD,a)}var o=n(21),i=n(9),u=n(18);t.a=r;n(0).get("detection:artifact:firefox:adguard")},function(e,t,n){"use strict";function r(e){return n.i(E.d)(e.document,function(t){var n=c(t);return new m.a(m.b.UBLOCK_ORIGIN,i(e,t)&&null!=n,o.bind(null,e,n))})}function o(e,t){for(var r=arguments.length,o=Array(r>2?r-2:0),u=2;u<r;u++)o[u-2]=arguments[u];var c=b()(o,function(e){return n.i(g.a)(e)}).filter(function(n){return i(e,n)||f(e,t,n)}).map(function(e){return new v.a(v.b.STYLE,e,a(e))});return _()(c,function(e){return e.element})}function i(e,t){return u(e,t)&&t.hidden}function u(e,t){return"none"===((e.getComputedStyle(t)||{}).display||"")}function a(e){return e.nodeName.toLowerCase()+"#"+e.id+"."+e.className}function c(e){var t=h()(e.attributes,function(e){return-1===O.indexOf(e.name)&&""===e.value});return t?t.name:null}function f(e,t,n){return u(e,n)&&l()(n.attributes).some(function(e){return e.name===t})}var s=n(6),l=n.n(s),p=n(49),h=n.n(p),d=n(140),_=n.n(d),y=n(62),b=n.n(y),v=n(65),m=n(9),g=n(96),E=n(84);t.a=r;var O=(n(0).get("detection:artifact:firefox:ublock_origin_1_11"),["id","class","hidden"])},function(e,t,n){"use strict";function r(e){return new o.a(o.b.ADBLOCK_PLUS,"0"===e.document.body.getAttribute("abp"))}var o=n(9);t.a=r;n(0).get("detection:artifact:internet_explorer:adblock_plus")},function(e,t,n){"use strict";function r(e){return new o["default"](function(t){var r=e.document.createElement("div");r.className=n.i(u.b)(),e.document.body.appendChild(r),e.setTimeout(function(){var n="none"===r.style.display;e.document.body.removeChild(r),t(new i.a(i.b.OPERA,n))},1)})}var o=n(2),i=n(9),u=n(83);t.a=r;var a=(n(0).get("detection:artifact:opera:index"),[r]);t.b=a},function(e,t,n){"use strict";function r(e){var t=e.document,r=n.i(u.a)(t,function(e){return u.b.DISPLAY_NONE_AND_ORPHAN.test(e.cssText)});return n.i(o.b)(t,i.b.ADBLOCK,r)}var o=n(21),i=n(9),u=n(18);t.a=r;n(0).get("detection:artifact:safari:adblock")},function(e,t,n){"use strict";function r(e){var t=e.document,r=n.i(u.a)(t,function(e){return u.b.ONLY_DISPLAY_NONE.test(e.cssText)}),a=1===r.length&&r[0].cssRules.length>50&&r[0].cssRules.length<200?r:[];return n.i(o.b)(t,i.b.ADBLOCK_PLUS,a)}var o=n(21),i=n(9),u=n(18);t.a=r;n(0).get("detection:artifact:safari:adblock_plus")},function(e,t,n){"use strict";function r(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document,n=t.createElement("style");t.head.appendChild(n);var r=o(e),i=r+" { no_affect_rule: 0; }";n.sheet&&"function"==typeof n.sheet.insertRule?n.sheet.insertRule(i,0):n.innerHTML=i;var u=n.sheet&&null!=n.sheet.cssRules&&"function"==typeof n.sheet.cssRules.item?n.sheet.cssRules.item(0).selectorText:null;return n.parentElement&&n.parentElement.removeChild(n),u}function o(e){return e.replace(/::content/g,"").trim()}t.a=r,t.b=o;n(0).get("util:css:normalize_selector")},function(e,t,n){"use strict";function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document;return new o["default"](function(t){function r(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,u=e.createElement("div");u.style.setProperty("display","block","important"),u.style.setProperty("height","10px","important"),e.body.appendChild(u),n.i(i.b)(e.body)&&o-- >0?(u.parentElement&&e.body.removeChild(u),setTimeout(function(){r(o)},100)):(u.parentElement&&e.body.removeChild(u),t())}if("loading"===e.readyState){var o=function(){r()};n.i(u.a)(e.addEventListener)?e.addEventListener("DOMContentLoaded",o):e.defaultView.setTimeout(function(){r()},5e3)}else r()})}var o=n(2),i=n(22),u=n(28);t.a=r;n(0).get("util:dom:ready")},function(e,t,n){"use strict";function r(e,t){function n(e){try{return e&&e.timeStamp?e.timeStamp:window.performance.now()}catch(e){return Date.now()}}var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:window.location,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:window.navigator,p=document.createElement("a");if(p.href=e,"https:"===r.protocol&&p.protocol!==r.protocol)return o.error("protocol mismatch in https environment, standing down"),void t(!1,!1,p.protocol,f);var h=new XMLHttpRequest;try{h.open("GET",e)}catch(e){return void t(!0,!1,e.toString(),a,h)}var d=void 0,_=void 0;h.onloadstart=function(e){d=n(e)},h.onreadystatechange=function(e){if(4===this.readyState){_=n(e)-d;var r=0===this.status&&!1!==l.onLine,o="2"===this.status.toString()[0],a=void 0;return a=o?u:!1===l.onLine?s:i,void t(r,o,this.status+"::"+_,a,h)}};try{h.send()}catch(e){return void t(!0,!1,e.toString(),c,h)}}n.d(t,"c",function(){return i}),n.d(t,"b",function(){return u}),n.d(t,"f",function(){return a}),n.d(t,"g",function(){return c}),n.d(t,"e",function(){return f}),n.d(t,"d",function(){return s}),t.a=r;var o=n(0).get("util:load_via_xhr:callback"),i="n",u="nx",a="xo",c="xs",f="p",s="of"},function(e,t){function n(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}e.exports=n},function(e,t,n){function r(e,t){return o(e,t)}var o=n(326);e.exports=r},function(e,t,n){"use strict";function r(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n(141),u=n.n(i),a=n(49),c=n.n(a),f=n(76),s=n.n(f),l=n(349),p=n.n(l),h=n(299),d=n(8),_=n(85),y=n(244),b=n(148),v=n(286),m=n(164),g=n(149),E=n(288),O=n(282),w=n(277),T=n(284),S=n(273),R=n(150),P=n(290),k=n(151),N=n(152),j=n(292),A=n(296),C=n(14),x=n(1),I=function(){function e(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var u,a=e[Symbol.iterator]();!(r=(u=a.next()).done)&&(n.push(u.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{!r&&a["return"]&&a["return"]()}finally{if(o)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),L=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),D=(n(0).get("detection:index"),function(){function e(t,r){o(this,e),this._options=p()({},t||{},{useInterference:!1,useDFPInterference:!1,useGenericAdblocker:!0,useAdblocker:!0,runImmediately:!1,internal:{}}),this._options.internal=p()({},this._options.internal,{useInterference:!1,useDFPInterference:!1,useGenericAdblocker:!0,useAdblocker:!0}),this._testClasses=r||[A.a,T.a,S.a,O.a,y.a,C.a.chrome()?b.a:[],C.a.firefox()?g.a:[],C.a.safari()?N.a:[],C.a.ie()?R.a:[],C.a.opera()?k.a:[],C.a.chrome()?v.a:[],C.a.firefox()?E.a:[],C.a.safari()?j.a:[],C.a.ie()?P.a:[],n.i(w.a)()],this.rerun()}return L(e,[{key:"rerun",value:function(){var e=this,t=new(Function.prototype.bind.apply(h.a,[null].concat(r(this._testClasses))));return this._runner=t,this._options.runImmediately?this._runner.run():n.i(m.a)().then(function(){e._runner===t&&e._runner.run()}),this}},{key:"serializeResults",value:function(){return this._runner.waitForResultsWhere().then(function(e){return e.join("|")})}},{key:"isStandingDown",value:function(){return this._runner.someResultPresentWhere(function(e){return e.has(x.b.STAND_DOWN)})}},{key:"isInterfering",value:function(){return this._isNotStandDownAnd(this._runner.someResultPresentWhere(function(e){return e.has(x.b.INTERFERENCE)||e.has(x.b.GENERIC_ADBLOCKER)||e.has(x.b.ADBLOCKER)}))}},{key:"isDFPInterfering",value:function(){return this._isNotStandDownAnd(this._runner.someResultPresentWhere(function(e){return e.has(x.b.DFP_INTERFERENCE)}))}},{key:"allowsAcceptableAds",value:function(){var e=this;return this.isContentBlockerPresent().then(function(t){return t&&e._runner.someResultPresentWhere(function(e){return e.has(x.b.ACCEPTABLE_AD)})})}},{key:"isFSM",value:function(){return this._isNotStandDownAnd(this._runner.waitForResultsWhere(function(e){return e.has(x.c.FSM)}).then(function(e){return e.some(function(e){return!e.has(x.a.NOT_PRESENT)})}))}},{key:"isPrivate",value:function(){return this._isNotStandDownAnd(this._runner.someResultPresentWhere(function(e){return e.has(x.b.PRIVATE)}))}},{key:"isContentBlockerPresent",value:function(){return this._isContentBlockerPresent(this._options)}},{key:"internalIsContentBlockerPresent",value:function(){return this._isContentBlockerPresent(this._options.internal)}},{key:"getContentBlockers",value:function(){var e=this;return this.isContentBlockerPresent().then(function(t){return t?e._runner.waitForResultsWhere(function(e){return e.has(x.b.ADBLOCKER)}).then(function(e){return s()(e.map(function(e){return c()(e.attributes,function(e){return n.i(x.d)(e)&&e!==x.a.NOT_PRESENT&&e!==x.a.PRESENT})}))}):[]})}},{key:"getContentBlocker",value:function(){var e=this;return this.isContentBlockerPresent().then(function(t){return t?e.getContentBlockers().then(function(e){return I(e,1)[0]||x.a.UNKNOWN_ADBLOCKER}):null})}},{key:"getFSMData",value:function(){return this._runner.waitForResultsWhere(function(e){return e.has(x.c.FSM)}).then(function(e){return c()(e.map(function(e){return e.getData(_.a)}),function(e){return null!=e})||null})}},{key:"getAllElementHidingData",value:function(){return this._runner.waitForResultsWhere(function(e){return e.has(x.c.HIDING_DATA)}).then(function(e){return u()(s()(e.map(function(e){return e.getData(d.a)})),function(e,t){return e.is(t)})})}},{key:"_isContentBlockerPresent",value:function(e){return this._isNotStandDownAnd(this._runner.someResultPresentWhere(function(t){return e.useInterference&&t.has(x.b.INTERFERENCE)||e.useDFPInterference&&t.has(x.b.DFP_INTERFERENCE)||e.useGenericAdblocker&&t.has(x.b.GENERIC_ADBLOCKER)||e.useAdblocker&&t.has(x.b.ADBLOCKER)}))}},{key:"_isNotStandDownAnd",value:function(e){return this.isStandingDown().then(function(t){return!t&&e})}}]),e}());t.a=D},function(e,t,n){var r=n(27),o=r.Uint8Array;e.exports=o},function(e,t,n){function r(e,t,n,A,C,x){var I,L=t&w,D=t&T,M=t&S;if(n&&(I=C?n(e,A,C,x):n(e)),void 0!==I)return I;if(!E(e))return e;var B=m(e);if(B){if(I=y(e),!L)return s(e,I)}else{var F=_(e),H=F==P||F==k;if(g(e))return f(e,L);if(F==N||F==R||H&&!C){if(I=D||H?{}:v(e),!L)return D?p(e,c(I,e)):l(e,a(I,e))}else{if(!j[F])return C?e:{};I=b(e,F,r,L)}}x||(x=new o);var U=x.get(e);if(U)return U;x.set(e,I);var G=M?D?d:h:D?keysIn:O,K=B?void 0:G(e);return i(K||e,function(o,i){K&&(i=o,o=e[i]),u(I,i,r(o,t,n,i,e,x))}),I}var o=n(70),i=n(320),u=n(44),a=n(324),c=n(325),f=n(100),s=n(60),l=n(329),p=n(330),h=n(138),d=n(166),_=n(77),y=n(340),b=n(341),v=n(101),m=n(10),g=n(72),E=n(13),O=n(26),w=1,T=2,S=4,R="[object Arguments]",P="[object Function]",k="[object GeneratorFunction]",N="[object Object]",j={};j[R]=j["[object Array]"]=j["[object ArrayBuffer]"]=j["[object DataView]"]=j["[object Boolean]"]=j["[object Date]"]=j["[object Float32Array]"]=j["[object Float64Array]"]=j["[object Int8Array]"]=j["[object Int16Array]"]=j["[object Int32Array]"]=j["[object Map]"]=j["[object Number]"]=j[N]=j["[object RegExp]"]=j["[object Set]"]=j["[object String]"]=j["[object Symbol]"]=j["[object Uint8Array]"]=j["[object Uint8ClampedArray]"]=j["[object Uint16Array]"]=j["[object Uint32Array]"]=!0,j["[object Error]"]=j[P]=j["[object WeakMap]"]=!1,e.exports=r},function(e,t,n){var r=n(13),o=Object.create,i=function(){function e(){}return function(t){if(!r(t))return{};if(o)return o(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();e.exports=i},function(e,t){function n(e,t){return null!=e&&t in Object(e)}e.exports=n},function(e,t,n){function r(e){return!(!u(e)||i(e))&&(o(e)?d:f).test(a(e))}var o=n(32),i=n(186),u=n(13),a=n(196),c=/[\\^$.*+?()[\]{}|]/g,f=/^\[object .+?Constructor\]$/,s=Function.prototype,l=Object.prototype,p=s.toString,h=l.hasOwnProperty,d=RegExp("^"+p.call(h).replace(c,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=r},function(e,t,n){function r(e,t,n,s,l){e!==t&&u(t,function(u,f){if(c(u))l||(l=new o),a(e,t,f,n,r,s,l);else{var p=s?s(e[f],u,f+"",e,t,l):void 0;void 0===p&&(p=u),i(e,f,p)}},f)}var o=n(70),i=n(89),u=n(90),a=n(175),c=n(13),f=n(37);e.exports=r},function(e,t,n){function r(e,t,n,r,v,m,g){var E=e[n],O=t[n],w=g.get(O);if(w)return void o(e,n,w);var T=m?m(E,O,n+"",e,t,g):void 0,S=void 0===T;if(S){var R=s(O),P=!R&&p(O),k=!R&&!P&&y(O);T=O,R||P||k?s(E)?T=E:l(E)?T=a(E):P?(S=!1,T=i(O,!0)):k?(S=!1,T=u(O,!0)):T=[]:_(O)||f(O)?(T=E,f(E)?T=b(E):(!d(E)||r&&h(E))&&(T=c(O))):S=!1}S&&(g.set(O,T),v(T,O,r,m,g),g["delete"](O)),o(e,n,T)}var o=n(89),i=n(100),u=n(180),a=n(60),c=n(101),f=n(55),s=n(10),l=n(111),p=n(72),h=n(32),d=n(13),_=n(117),y=n(103),b=n(202);e.exports=r},function(e,t,n){function r(e,t){return o(e,t,function(t,n){return i(e,n)})}var o=n(177),i=n(197);e.exports=r},function(e,t,n){function r(e,t,n){for(var r=-1,a=t.length,c={};++r<a;){var f=t[r],s=o(e,f);n(s,f)&&i(c,u(f,e),s)}return c}var o=n(75),i=n(107),u=n(23);e.exports=r},function(e,t,n){function r(e,t){return t=o(t,e),null==(e=u(e,t))||delete e[a(i(t))]}var o=n(23),i=n(139),u=n(342),a=n(34);e.exports=r},function(e,t,n){function r(e){var t=new e.constructor(e.byteLength);return new o(t).set(new o(e)),t}var o=n(169);e.exports=r},function(e,t,n){function r(e,t){var n=t?o(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}var o=n(179);e.exports=r},function(e,t){function n(e){return function(t,n,r){for(var o=-1,i=Object(t),u=r(t),a=u.length;a--;){var c=u[e?a:++o];if(!1===n(i[c],c,i))break}return t}}e.exports=n},function(e,t,n){var r=n(183),o=function(){try{var e=r(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();e.exports=o},function(e,t){function n(e,t){return null==e?void 0:e[t]}e.exports=n},function(e,t,n){function r(e,t){if(o(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!i(e))||(a.test(e)||!u.test(e)||null!=t&&e in Object(t))}var o=n(10),i=n(126),u=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,a=/^\w*$/;e.exports=r},function(e,t,n){var r=n(91),o=n(32),i=n(201),u=r?o:i;e.exports=u},function(e,t,n){function r(e){return!!i&&i in e}var o=n(91),i=function(){var e=/[^.]+$/.exec(o&&o.keys&&o.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();e.exports=r},function(e,t){function n(){this.__data__=[],this.size=0}e.exports=n},function(e,t,n){function r(e){var t=this.__data__,n=o(t,e);return!(n<0)&&(n==t.length-1?t.pop():u.call(t,n,1),--this.size,!0)}var o=n(33),i=Array.prototype,u=i.splice;e.exports=r},function(e,t,n){function r(e){var t=this.__data__,n=o(t,e);return n<0?void 0:t[n][1]}var o=n(33);e.exports=r},function(e,t,n){function r(e){return o(this.__data__,e)>-1}var o=n(33);e.exports=r},function(e,t,n){function r(e,t){var n=this.__data__,r=o(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}var o=n(33);e.exports=r},function(e,t){function n(e){return e}e.exports=n},function(e,t,n){function r(e,t,n){return t=i(void 0===t?e.length-1:t,0),function(){for(var r=arguments,u=-1,a=i(r.length-t,0),c=Array(a);++u<a;)c[u]=r[t+u];u=-1;for(var f=Array(t+1);++u<t;)f[u]=r[u];return f[t]=n(c),o(e,this,f)}}var o=n(98),i=Math.max;e.exports=r},function(e,t){function n(e){return e}e.exports=n},function(e,t,n){var r=n(192),o=/^\./,i=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,u=/\\(\\)?/g,a=r(function(e){var t=[];return o.test(e)&&t.push(""),e.replace(i,function(e,n,r,o){t.push(r?o.replace(u,"$1"):n||e)}),t});e.exports=a},function(e,t){function n(e){if(null!=e){try{return o.call(e)}catch(e){}try{return e+""}catch(e){}}return""}var r=Function.prototype,o=r.toString;e.exports=n},function(e,t,n){function r(e,t){return null!=e&&i(e,t,o)}var o=n(172),i=n(108);e.exports=r},function(e,t,n){function r(e){if(i(e))throw new Error(u);return o(e)}var o=n(173),i=n(185),u="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.";e.exports=r},function(e,t){function n(e,t){for(var n=-1,r=null==e?0:e.length,o=Array(r);++n<r;)o[n]=t(e[n],n,e);return o}e.exports=n},function(e,t,n){var r=n(174),o=n(71),i=o(function(e,t,n){r(e,t,n)});e.exports=i},function(e,t){function n(){return!1}e.exports=n},function(e,t,n){function r(e){return o(e,i(e))}var o=n(17),i=n(37);e.exports=r},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},,function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=n(233),a=n(12),c=n(2),f=n(25),s=n(5);n.d(t,"AdblockBeacon",function(){return y});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),p=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var u=o.get;if(void 0!==u)return u.call(r)},h=n(0).get("analytics:pageview_beacon"),d=n(46),_=n(50),y=function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,d.BEACON));return c["default"].all([e.isInterfering().then(function(e){n._isInterfering=e}),e.isDFPInterfering().then(function(e){n._isDFPInterfering=e}),e.isContentBlockerPresent().then(function(e){n._isContentBlockerPresent=e}),e.isPrivate().then(function(e){n._isPrivate=e}),e.isFSM().then(function(e){n._isFSM=e}),e.serializeResults().then(function(e){n._serializedResults=e}),e.allowsAcceptableAds().then(function(e){n._allowsAcceptableAds=e}),e.getContentBlockers().then(function(e){n._contentBlockers=e})]).then(function(){n.send()}),n}return i(t,e),l(t,[{key:"populateBeaconFields",value:function(){p(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"populateBeaconFields",this).call(this),this.set(_.SENTINEL_FLAG,1),!0===this._isInterfering||!0===this._isDFPInterfering?this.set(_.ADBLOCK_DETECTED,1):null!=this._isInterfering&&null!=this._isDFPInterfering&&this.set(_.ADBLOCK_DETECTED,0),null!=this._serializedResults&&this.set(_.DEBUG_0,this._serializedResults),null!=this._allowsAcceptableAds&&this.set(_.EXCEPTION_RULES,this._allowsAcceptableAds?1:0),null!=this._contentBlockers&&this._contentBlockers.length>0&&this.set(_.DEBUG_1,this._contentBlockers.join(","));var e=[this._isInterfering,this._isContentBlockerPresent,this._isPrivate,this._isFSM,this._isDFPInterfering].map(function(e){return null==e?-1:e?1:0}).join("::");this.set(_.DEBUG_2,e)}},{key:"send",value:function(e){p(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"send",this).call(this,function(t){if(null!=t&&s["default"].has(["msg","domain"])){var n=t;if(null!=n.target&&"string"==typeof n.target.src){var r=n.target.src,o=new f.a(r);o.hostname=s["default"].get(["msg","domain"]),o.pathname="/pv";var i=new Image;i.src=o.toString(),h.info("firing msg pv error beacon",i.src)}}e&&(t?e(t):e())})}}]),t}(u["default"]),b=function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return new y(e),n.on("pagechange",function(){new y(e)}),n}return i(t,e),t}(a.b);t["default"]=b},function(e,t,n){"use strict";function r(e){e.events=e.events||{},e.events.onDetectionComplete=e.events.onDetectionComplete||function(e){n.i(o.a)(e?"sp.blocking":"sp.not_blocking")}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(227);t["default"]=r;n(0).get("backwards_compatibility:config:apply_default_params")},function(e,t,n){"use strict";function r(e){function t(t,r){l()(e,t)&&(l()(e,r)||f()(n,r,a()(e,t)),i()(n,t))}var n=h()(e);return t("account_id","accountId"),t("client_id","clientId"),t("publisher_base","publisherBase"),t("beacon_endpoint",["beacon","pageViewEndpoint"]),t("content_control_beacon_endpoint",["beacon","contentControlEndpoint"]),t("custom_beacon_entries",["beacon","customEntries"]),t("content_control_callback",["bootstrap","contentControlCallback"]),t("content_control_callback",["rid","contentControlCallback"]),t("enable_rid",["rid","enable"]),t("enable_rid_retry",["rid","enableForgivenessCookie"]),t("dfp_targeting_key",["dfp","targetingKey"]),t("enable_vid",["vid","enable"]),t("enable_generic_vid",["vid","enableGeneric"]),t("enable_iframe_vid",["vid","enableInIFrame"]),t("vid_control_callback",["vid","contentControlCallback"]),t("enable_artifact_detection",["detection","exposeSpecificContentBlockerData"]),t("enable_fsm_detection",["detection","fsm","enable"]),t("enable_fsm_network_detection",["detection","fsm","enableNetwork"]),t("fsm_endpoint",["detection","fsm","endpoint"]),t("use_network_detection",["detection","useNetworkBlockerTests"]),t("site_css_url","siteCssLocation"),t("enable_blocker_style_sheet_disabling","disableBlockerStyleSheets"),t("disable_blocker_style_sheets","disableBlockerStyleSheets"),t("run_immediately","runImmediately"),t("mms_domain",["msg","domain"]),t("mms_client_data_callback",["events","onReceiveMessageData"]),t("mms_choice_selected_callback",["events","onMessageChoiceSelect"]),t("msg_z_index",["msg","zIndex"]),t("enable_style_manager",["styleManager","enable"]),t("enable_simple_style_manager",["styleManager","enableSimple"]),t("enable_full_morph",["styleManager","enableMorphingOutsideAdHierarchy"]),t("smart_lib_url",["smart","libURL"]),t("smart_targeting_key",["smart","targetingKey"]),i()(n,"rid_asset_base"),i()(n,"gpt_auto_load"),i()(n,"converge_recovery_domain"),i()(n,"msg_lib_location"),i()(n,"smart_auto_load"),n}Object.defineProperty(t,"__esModule",{value:!0});var o=n(372),i=n.n(o),u=n(368),a=n.n(u),c=n(371),f=n.n(c),s=n(370),l=n.n(s),p=n(367),h=n.n(p);t["default"]=r;n(0).get("backwards_compatibility:config:index")},function(e,t,n){"use strict";function r(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:window.location.search,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:window,c=i()(t),f=r&&new u.a(r).getSearchParam("_sp_scriptVersion");if(!f)return void c(!1);var s=o.document.createElement("script");s.id="_sp_override",s.addEventListener("load",function(){c(!0)}),s.addEventListener("error",function(){c(!1)});var l="latest"===f?"":"-v"+f;s.src=n+"/0/"+f+"/"+e+l+".js",o.document.head?o.document.head.appendChild(s):o.document.documentElement.appendChild(s)}Object.defineProperty(t,"__esModule",{value:!0});var o=n(146),i=n.n(o),u=n(25);t["default"]=r;var a=(n(0).get("delivery:override_script_version"),["h","t","t","p","s",":","/","/","s","p","-","j","s","-","r","e","l","e","a","s","e","s",".","s","3",".","a","m","a","z","o","n","a","w","s",".","c","o","m"].join(""))},function(e,t,n){n(0).get("delivery:stand_down");window._sp_=window._sp_||{};var r={checkState:function(e){e(!1)},isAdBlocking:function(e){e(!1)},getSafeUri:function(e){return e},pageChange:function(){},setupSmartBeacons:function(){}};e.exports.mockApi=function(e){for(var t=0;t<e.length;t++)window._sp_[e[t]]=r[e[t]]}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e,t){e.getContentBlockers().then(function(e){t(c()(e.map(function(e){return _.get(e)||"unknown"})))})}Object.defineProperty(t,"__esModule",{value:!0});var a=n(73),c=n.n(a),f=n(12),s=n(15),l=n(5),p=n(1),h=n(11),d=(n(0).get("detection:get_content_blockers_feature"),function(e){function t(e){r(this,t);var i=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return l["default"].get(["detection","exposeSpecificContentBlockerData"])&&(n.i(h.a)("getContentBlockers",u.bind(null,e)),n.i(h.a)("getAdblockers",u.bind(null,e))),i}return i(t,e),t}(f.b));t["default"]=d;var _=new s.a;_.set(p.a.ADBLOCK,"adblock"),_.set(p.a.ADBLOCK_PLUS,"adblock_plus"),_.set(p.a.ADGUARD,"adguard"),_.set(p.a.UBLOCK,"ublock"),_.set(p.a.UBLOCK_ORIGIN,"ublock_origin"),_.set(p.a.NATIVE,"native")},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e){e.forEach(function(e){try{e()}catch(e){p.error("Failed to execute command function",e)}})}Object.defineProperty(t,"__esModule",{value:!0});var a=n(68),c=n.n(a),f=n(2),s=n(5),l=n(12),p=n(0).get("life_cycle:command_queue_feature"),h=function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.resolutionPromise=new f["default"](function(e){var t=s["default"].get("cmd");u(t),Object.defineProperty(t,"push",{get:function(){return function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];u(t)}},set:c.a}),e(!0)}),n}return i(t,e),t}(l.f.to(l.b));t["default"]=h},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e){var t=Date.now();e.isContentBlockerPresent().then(function(e){function n(){f.info("triggering on detection complete",e),a["default"].get(["events","onDetectionComplete"])(e)}var r=Date.now(),o=a["default"].get("runImmediately")?0:Math.max(200-(r-t),0);o>0?window.setTimeout(function(){n()},o):n()})}Object.defineProperty(t,"__esModule",{value:!0});var a=n(5),c=n(12),f=n(0).get("life_cycle:events:on_detection_complete_feature"),s=function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.on("pagechange",function(){u(e)}),u(e),n}return i(t,e),t}(c.f.to(c.b));t["default"]=s},function(e,t,n){"use strict";function r(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function o(e,t){function o(e,t){var n=e[0].map(function(e){return t?new e(t):new e});return u.push.apply(u,r(n)),f["default"].all(n.map(function(e){return e.startPromise})).then(function(){var o=e[1].map(function(e){return t?new e(t):new e});return u.push.apply(u,r(o)),f["default"].all(n.map(function(e){return e.resolutionPromise}).concat(o.map(function(e){return e.resolutionPromise})))})}n.i(p["default"])(l["default"].get(["debug","level"])),b.info("client config",window._sp_.config);var u=[];n.i(h.a)("pageChange",function(){u.forEach(function(e){e.emit("pagechange")})}),n.i(h.a)("scriptName",e),n.i(h.a)("version",_.a),b.info("build version",window._sp_.version),window._sp_._networkListenerData||n.i(h.a)("_networkListenerData",n.i(d.a)());var a=n.i(s.a)(),v=t.filter(function(e){return null!=e.prototype&&e.prototype instanceof y.d}),m=t.filter(function(e){return null!=e.prototype&&e.prototype instanceof y.b}),g=t.filter(function(e){return null!=e.prototype&&e.prototype instanceof y.c}),E=t.filter(function(e){return null!=e.prototype&&e.prototype instanceof y.e});o(i(v)).then(function(){var e=l["default"].get("detection"),t=e.internal,n=new c.a({runImmediately:l["default"].get("runImmediately"),useInterference:e.useNetworkBlockerTests,useDFPInterference:e.useDFPNetworkBlockerTests,useGenericAdblocker:e.useGenericContentBlockerTests,useAdblocker:e.useSpecificContentBlockerTests,internal:{useInterference:t.useNetworkBlockerTests,useDFPInterference:t.useDFPNetworkBlockerTests,useGenericAdblocker:t.useGenericContentBlockerTests,useAdblocker:t.useSpecificContentBlockerTests}});return n.isContentBlockerPresent().then(function(e){a(e)}),o(i(m),n).then(function(){return o(i(g),n)}).then(function(){return o(i(E),n)})})}function i(e){var t=a()(e,function(e){return y.f.test(e)?"1":"0"});return[t[0]||[],t[1]||[]]}Object.defineProperty(t,"__esModule",{value:!0});var u=n(369),a=n.n(u),c=n(168),f=n(2),s=n(357),l=n(5),p=n(64),h=n(11),d=n(359),_=n(30),y=n(12);t["default"]=o;var b=n(0).get("life_cycle:index")},function(e,t,n){n(0).get("util:detect_stand_down_browser");e.exports=function(e){var t=void 0;t=null==e?(navigator.userAgent||navigator.vendor||window.opera).toLowerCase():e.toLowerCase();var n=t.match(/(msie|trident)\s*(\d+)\./),r=n&&window.parseInt(n[2]);return!!r&&r<11}},function(e,t,n){n(0).get("util:force_util_promise");e.exports=function(){var e=window.Promise;delete window.Promise,n(2),window.Promise=e}},function(e,t){function n(e,t){for(var n=-1,r=null==e?0:e.length,o=0,i=[];++n<r;){var u=e[n];t(u,n,e)&&(i[o++]=u)}return i}e.exports=n},function(e,t){function n(e){return e.split("")}e.exports=n},function(e,t){function n(e,t,n,r){for(var o=e.length,i=n+(r?1:-1);r?i--:++i<o;)if(t(e[i],i,e))return i;return-1}e.exports=n},function(e,t){function n(e,t){return e+r(o()*(t-e+1))}var r=Math.floor,o=Math.random;e.exports=n},function(e,t,n){function r(e,t){return o(t,function(t){return e[t]})}var o=n(74);e.exports=r},function(e,t){function n(e){for(var t,n=[];!(t=e.next()).done;)n.push(t.value);return n}e.exports=n},function(e,t){function n(){return[]}e.exports=n},function(e,t){function n(e){return e.split("")}e.exports=n},function(e,t,n){function r(e){return"string"==typeof e||!i(e)&&u(e)&&o(e)==a}var o=n(51),i=n(10),u=n(36),a="[object String]";e.exports=r},function(e,t,n){function r(e,t,n){if(n&&"boolean"!=typeof n&&i(e,t,n)&&(t=n=void 0),void 0===n&&("boolean"==typeof t?(n=t,t=void 0):"boolean"==typeof e&&(n=e,e=void 0)),void 0===e&&void 0===t?(e=0,t=1):(e=u(e),void 0===t?(t=e,e=0):t=u(t)),e>t){var r=e;e=t,t=r}if(n||e%1||t%1){var s=f();return c(e+s*(t-e+a("1e-"+((s+"").length-1))),t)}return o(e,t)}var o=n(219),i=n(78),u=n(226),a=parseFloat,c=Math.min,f=Math.random;e.exports=r},function(e,t){function n(e){return e}e.exports=n},function(e,t,n){"use strict";function r(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document,n=void 0;try{n=new Event(e,{bubbles:!0,cancelable:!1})}catch(t){n=document.createEvent("Event"),"function"==typeof n.initEvent&&n.initEvent(e,!0,!1)}t.dispatchEvent(n)}t.a=r;n(0).get("util:dom:dispatch_event")},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.location,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:window.navigator;return new u["default"](function(o){n.i(a.a)(e,function(e,t,n,r,i){var u=void 0,a=void 0;if(n.indexOf("::")>-1){var c=n.split("::")[1];u=parseInt(c)}else a=n;o(new l({succeeded:t,blocked:e,bootstrapType:r,timeStamp:u,xhr:i,errorText:a,status:i&&i.status}))},t,r)})}var u=n(2),a=n(165);t.b=i,n.d(t,"a",function(){return f});var c,f=(n(0).get("util:load_via_xhr:index"),{SUCCEEDED:"SUCCEEDED",NETWORK_FAILURE:"NETWORK_FAILURE",OFFLINE:"OFFLINE",PROTOCOL_MISMATCH:"PROTOCOL_MISMATCH",OPEN_ERROR:"OPEN_ERROR",SEND_ERROR:"SEND_ERROR"}),s=(c={},o(c,a.b,f.SUCCEEDED),o(c,a.c,f.NETWORK_FAILURE),o(c,a.d,f.OFFLINE),o(c,a.e,f.PROTOCOL_MISMATCH),o(c,a.f,f.OPEN_ERROR),o(c,a.g,f.SEND_ERROR),c),l=function e(t){var n=t.succeeded,o=t.blocked,i=t.status,u=void 0===i?null:i,a=t.timeStamp,c=void 0===a?null:a,f=t.bootstrapType,l=t.errorText,p=void 0===l?null:l,h=t.xhr,d=void 0===h?null:h;r(this,e),this.succeeded=n,this.blocked=o,this.status=u,this.timeStamp=c,this.type=s[f],this.errorText=p,this.xhr=d}},function(e,t,n){function r(e,t){return e&&o(e,t,i)}var o=n(90),i=n(26);e.exports=r},function(e,t,n){n(0).get("config:config");e.exports={bugsnagKey:"00eac706c084cf17802b8cba591a1128",detection:{elementDetection:{waitInterval:100,maxRetries:1}},beacon:{shiftKey:3}}},,,function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=n(112),a=n(5),c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),f=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var u=o.get;if(void 0!==u)return u.call(r)},s=(n(0).get("util:beacon:index"),n(319)),l=n(50),p=n(46),h=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:p.BEACON;r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return s(function(){return n.send()}),n}return i(t,e),c(t,[{key:"populateBeaconFields",value:function(){f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"populateBeaconFields",this).call(this),this._populateCommonFields(),this._populateCustomerFields()}},{key:"_populateCommonFields",value:function(){this.set(l.PAGE_URL,document.location.hostname+document.location.pathname)}},{key:"_populateCustomerFields",value:function(){var e=this,t=a["default"].get(["beacon","customEntries"]);t&&t.forEach(function(t,n){e.set(l["CUSTOMER_"+(n+1).toString()],t)})}},{key:"processEndpoint",value:function(e){return e.replace(/^(https?:)?\/\//,"")}},{key:"dataPostProcessing",value:function(e){if(e=e.slice(),e.length>0&&0===e[0].indexOf("id")){var t=Math.floor(Math.random()*(e.length-1)+1),n=e[0];e[0]=e[t],e[t]=n}return e}}]),t}(u.a);t["default"]=h},function(e,t,n){function r(e,t){return!!(null==e?0:e.length)&&o(e,t,0)>-1}var o=n(99);e.exports=r},function(e,t){function n(e,t,n){for(var r=-1,o=null==e?0:e.length;++r<o;)if(n(t,e[r]))return!0;return!1}e.exports=n},function(e,t){function n(e,t){for(var n=-1,r=t.length,o=e.length;++n<r;)e[o+n]=t[n];return e}e.exports=n},function(e,t,n){function r(e){return function(t,n,r){var a=Object(t);if(!i(t)){var c=o(n,3);t=u(t),n=function(e){return c(a[e],e,a)}}var f=e(t,n,r);return f>-1?a[c?t[f]:f]:void 0}}var o=n(31),i=n(39),u=n(26);e.exports=r},function(e,t){function n(){}e.exports=n},function(e,t,n){function r(e){return u(e)||i(e)||!!(a&&e&&e[a])}var o=n(106),i=n(55),u=n(10),a=o?o.isConcatSpreadable:void 0;e.exports=r},,,function(e,t,n){"use strict";function r(){return["/","/","a","d",".","d","o","u","b","l","e","c","l","i","c","k",".","n","e","t","/","d","d","m","/","a","d","/",o(),"/",";","o","r","d","=",Date.now(),"?"].join("")}function o(){return u()(n.i(a.a)(1,5),function(){return n.i(a.b)(2,11)}).join("/")}var i=n(118),u=n.n(i),a=n(20);t.a=r;n(0).get("config:network_test_uri")},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=n(66),a=n(1),c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),f=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var u=o.get;if(void 0!==u)return u.call(r)},s=(n(0).get("detection:acceptable_ad:element_hiding_test"),function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),c(t,null,[{key:"getSchema",value:function(){return f(t.__proto__||Object.getPrototypeOf(t),"getSchema",this).call(this).addAttribute([a.b.ACCEPTABLE_AD])}},{key:"testMethod",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:".abp_ob_exist",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window;return f(t.__proto__||Object.getPrototypeOf(t),"testMethod",this).call(this,e,n)}}]),t}(u.a));t.a=s},function(e,t,n){"use strict";var r=n(243);n(0).get("detection:acceptable_ad:index");t.a=[r.a]},function(e,t,n){"use strict";var r=n(246);n(0).get("detection:adblocker:chrome:adblock:index");t.a=[r.a]},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=n(3),a=n(4),c=n(8),f=n(153),s=n(1),l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),p=(n(0).get("detection:adblocker:chrome:adblock:style_sheet_test"),function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),l(t,null,[{key:"getSchema",value:function(){return new a.a(s.b.ADBLOCKER,s.c.ARTIFACT,s.c.STYLE_SHEET,s.c.HIDING_DATA)}},{key:"testMethod",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window,t=n.i(f.a)(e),r=t.foundAdblocker();return this.getSchema().createResult(r?s.a.ADBLOCK:s.a.NOT_PRESENT,r?s.f.STYLE_SHEET_PRESENT:s.f.NO_STYLE_SHEET_PRESENT,c.a.fromStyleSheets({shadowSheets:t.getAdblockerStyleSheets()}))}}]),t}(u.b));t.a=p},function(e,t,n){"use strict";var r=n(248);n(0).get("detection:adblocker:chrome:adblock_plus:index");t.a=[r.a]},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=n(3),a=n(4),c=n(8),f=n(154),s=n(1),l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),p=(n(0).get("detection:adblocker:chrome:adblock_plus:style_sheet_test"),function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),l(t,null,[{key:"getSchema",value:function(){return new a.a(s.b.ADBLOCKER,s.c.ARTIFACT,s.c.STYLE_SHEET,s.c.HIDING_DATA)}},{key:"testMethod",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window,t=n.i(f.a)(e),r=t.foundAdblocker();return this.getSchema().createResult(r?s.a.ADBLOCK_PLUS:s.a.NOT_PRESENT,r?s.f.STYLE_SHEET_PRESENT:s.f.NO_STYLE_SHEET_PRESENT,c.a.fromStyleSheets({shadowSheets:t.getAdblockerStyleSheets()}))}}]),t}(u.b));t.a=p},function(e,t,n){"use strict";var r=n(250);n(0).get("detection:adblocker:chrome:adguard:index");t.a=[r.a]},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=n(3),a=n(4),c=n(8),f=n(155),s=n(1),l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),p=(n(0).get("detection:adblocker:chrome:adguard:style_sheet_test"),function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),l(t,null,[{key:"getSchema",value:function(){return new a.a(s.b.ADBLOCKER,s.c.ARTIFACT,s.c.STYLE_SHEET,s.c.HIDING_DATA)}},{key:"testMethod",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window,t=n.i(f.a)(e),r=t.foundAdblocker();return this.getSchema().createResult(r?s.a.ADGUARD:s.a.NOT_PRESENT,r?s.f.STYLE_SHEET_PRESENT:s.f.NO_STYLE_SHEET_PRESENT,c.a.fromStyleSheets({shadowSheets:t.getAdblockerStyleSheets()}))}}]),t}(u.b));t.a=p},function(e,t,n){"use strict";var r=n(16),o=n.n(r),i=n(252);n(0).get("detection:adblocker:chrome:ublock_origin:index");t.a=o()([i.a])},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=n(3),a=n(4),c=n(8),f=n(52),s=n(1),l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),p=(n(0).get("detection:adblocker:chrome:ublock_origin:style_sheet_test"),function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),l(t,null,[{key:"getSchema",value:function(){return new a.a(s.b.ADBLOCKER,s.c.ARTIFACT,s.c.STYLE_SHEET,s.c.HIDING_DATA)}},{key:"testMethod",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window;return n.i(f.a)(t).then(function(t){var n=t.foundAdblocker();return e.getSchema().createResult(n?s.a.UBLOCK_ORIGIN:s.a.NOT_PRESENT,n?s.f.STYLE_SHEET_PRESENT:s.f.NO_STYLE_SHEET_PRESENT,c.a.fromStyleSheets({documentSheets:t.getAdblockerStyleSheets()}))})}}]),t}(u.b));t.a=p},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=n(3),a=n(4),c=n(8),f=n(1),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=(n(0).get("detection:adblocker:firefox:adblock_plus:57:inline_style_sheet_test"),function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),s(t,null,[{key:"findDependency",value:function(e){return e.has(f.c.HIDING_DATA)}},{key:"getSchema",value:function(){return new a.a(f.b.ADBLOCKER,f.c.INLINE_STYLE_SHEET)}},{key:"testMethod",value:function(e){var t=e.map(function(e){return e.getData(c.a)}).filter(function(e){return null!=e&&e.inlineStyleSheet.hasDisplayNoneImportant});return 0===t.length?this.getSchema().createResult(f.a.NOT_PRESENT,f.f.NO_STYLE_SHEET_PRESENT):t.some(function(e){return!1===e.hiddenImmediately})?this.getSchema().createResult(f.a.NOT_PRESENT,f.f.STYLE_SHEET_PRESENT,f.f.HIDDEN_LATER):t.some(function(e){return!0===e.hiddenImmediately})?this.getSchema().createResult(f.a.ADBLOCK_PLUS,f.f.STYLE_SHEET_PRESENT,f.f.HIDDEN_IMMEDIATELY):this.getSchema().createResult(f.a.NOT_PRESENT,f.f.STYLE_SHEET_PRESENT,f.f.NONE_HIDDEN_IMMEDIATELY)}}]),t}(u.a));t.a=l},function(e,t,n){"use strict";var r=n(253),o=n(255);n(0).get("detection:adblocker:firefox:adblock_plus:index");t.a=[r.a,o.a]},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=n(3),a=n(4),c=n(1),f=n(156),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=(n(0).get("detection:adblocker:firefox:adblock_plus:style_property_test"),function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),s(t,null,[{key:"getSchema",value:function(){return new a.a(c.b.ADBLOCKER,c.c.ARTIFACT,c.c.STYLE_PROPERTY)}},{key:"testMethod",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window;return n.i(f.a)(t).then(function(t){var n=t.foundAdblocker();return e.getSchema().createResult(n?c.a.ADBLOCK_PLUS:c.a.NOT_PRESENT,n?c.f.STYLE_PROPERTY_PRESENT:c.f.NO_STYLE_PROPERTY_PRESENT)})}}]),t}(u.b));t.a=l},function(e,t,n){"use strict";var r=n(257);n(0).get("detection:adblocker:firefox:adguard:index");t.a=[r.a]},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=n(3),a=n(4),c=n(8),f=n(157),s=n(1),l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),p=(n(0).get("detection:adblocker:firefox:adguard:style_sheet_test"),function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),l(t,null,[{key:"getSchema",value:function(){return new a.a(s.b.ADBLOCKER,s.c.ARTIFACT,s.c.STYLE_SHEET,s.c.HIDING_DATA)}},{key:"testMethod",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window,t=n.i(f.a)(e),r=t.foundAdblocker();return this.getSchema().createResult(r?s.a.ADGUARD:s.a.NOT_PRESENT,r?s.f.STYLE_SHEET_PRESENT:s.f.NO_STYLE_SHEET_PRESENT,c.a.fromStyleSheets({documentSheets:t.getAdblockerStyleSheets()}))}}]),t}(u.b));t.a=p},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=n(3),a=n(4),c=n(8),f=n(1),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=(n(0).get("detection:adblocker:firefox:ublock_origin:57:inline_style_sheet_test"),function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),s(t,null,[{key:"findDependency",value:function(e){return e.has(f.c.HIDING_DATA)}},{key:"getSchema",value:function(){return new a.a(f.b.ADBLOCKER,f.c.INLINE_STYLE_SHEET)}},{key:"testMethod",value:function(e){var t=e.map(function(e){return e.getData(c.a)}).filter(function(e){return null!=e&&e.inlineStyleSheet.hasDisplayNoneImportant});return 0===t.length?this.getSchema().createResult(f.a.NOT_PRESENT,f.f.NO_STYLE_SHEET_PRESENT):t.some(function(e){return!1===e.hiddenImmediately})?this.getSchema().createResult(f.a.UBLOCK_ORIGIN,f.f.STYLE_SHEET_PRESENT,f.f.HIDDEN_LATER):this.getSchema().createResult(f.a.NOT_PRESENT,f.f.STYLE_SHEET_PRESENT,f.f.NONE_HIDDEN_LATER)}}]),t}(u.a));t.a=l},function(e,t,n){"use strict";var r=n(258),o=n(260);n(0).get("detection:adblocker:firefox:ublock_origin:index");t.a=[r.a,o.a]},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=n(3),a=n(4),c=n(1),f=n(158),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=(n(0).get("detection:adblocker:firefox:ublock_origin:style_property_and_hidden_property_test"),function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),s(t,null,[{key:"getSchema",value:function(){return new a.a(c.b.ADBLOCKER,c.c.ARTIFACT,c.c.STYLE_PROPERTY,c.c.HIDDEN_PROPERTY)}},{key:"testMethod",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window;return n.i(f.a)(t).then(function(t){var n=t.foundAdblocker();return e.getSchema().createResult(n?c.a.UBLOCK_ORIGIN:c.a.NOT_PRESENT,n?c.f.STYLE_PROPERTY_PRESENT:c.f.NO_STYLE_PROPERTY_PRESENT,n?c.f.HIDDEN_PROPERTY_PRESENT:c.f.NO_HIDDEN_PROPERTY_PRESENT)})}}]),t}(u.b));t.a=l},function(e,t,n){"use strict";var r=n(262);n(0).get("detection:adblocker:generic:ublock:index");t.a=[r.a]},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=n(3),a=n(4),c=n(8),f=n(52),s=n(1),l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),p=(n(0).get("detection:adblocker:generic:ublock:style_sheet_test"),function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),l(t,null,[{key:"getSchema",value:function(){return new a.a(s.b.ADBLOCKER,s.c.ARTIFACT,s.c.STYLE_SHEET,s.c.HIDING_DATA)}},{key:"testMethod",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window;return n.i(f.a)(t).then(function(t){var n=t.foundAdblocker();return e.getSchema().createResult(n?s.a.UBLOCK:s.a.NOT_PRESENT,n?s.f.STYLE_SHEET_PRESENT:s.f.NO_STYLE_SHEET_PRESENT,c.a.fromStyleSheets({documentSheets:t.getAdblockerStyleSheets()}))})}}]),t}(u.b));t.a=p},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=n(3),a=n(4),c=n(8),f=n(105),s=n(1),l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),p=(n(0).get("detection:adblocker:generic:ublock_origin:style_sheet_test"),function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),l(t,null,[{key:"getSchema",value:function(){return new a.a(s.b.ADBLOCKER,s.c.ARTIFACT,s.c.STYLE_SHEET,s.c.HIDING_DATA)}},{key:"testMethod",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window;return n.i(f.a)(t).then(function(t){var n=t.foundAdblocker();return e.getSchema().createResult(n?s.a.UBLOCK_ORIGIN:s.a.NOT_PRESENT,n?s.f.STYLE_SHEET_PRESENT:s.f.NO_STYLE_SHEET_PRESENT,c.a.fromStyleSheets({documentSheets:t.getAdblockerStyleSheets()}))})}}]),t}(u.b));t.a=p},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=n(3),a=n(4),c=n(1),f=n(159),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=(n(0).get("detection:adblocker:internet_explorer:adblock_plus:custom_property_test"),function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),s(t,null,[{key:"getSchema",value:function(){return new a.a(c.b.ADBLOCKER,c.c.ARTIFACT,c.c.CUSTOM_PROPERTY)}},{key:"testMethod",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window,t=n.i(f.a)(e).foundAdblocker();return this.getSchema().createResult(t?c.a.ADBLOCK_PLUS:c.a.NOT_PRESENT,t?c.f.CUSTOM_PROPERTY_PRESENT:c.f.NO_CUSTOM_PROPERTY_PRESENT)}}]),t}(u.b));t.a=l},function(e,t,n){"use strict";var r=n(264);n(0).get("detection:adblocker:internet_explorer:adblock_plus:index");t.a=[r.a]},function(e,t,n){"use strict";var r=n(267);n(0).get("detection:adblocker:opera:native:index");t.a=[r.a]},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=n(3),a=n(4),c=n(1),f=n(160),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=(n(0).get("detection:adblocker:opera:native:style_property_test"),function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),s(t,null,[{key:"getSchema",value:function(){return new a.a(c.b.ADBLOCKER,c.c.ARTIFACT,c.c.STYLE_PROPERTY)}},{key:"testMethod",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window;return n.i(f.a)(t).then(function(t){var n=t.foundAdblocker();return e.getSchema().createResult(n?c.a.NATIVE:c.a.NOT_PRESENT,n?c.f.STYLE_PROPERTY_PRESENT:c.f.NO_STYLE_PROPERTY_PRESENT)})}}]),t}(u.b));t.a=l},function(e,t,n){"use strict";var r=n(269);n(0).get("detection:adblocker:safari:adblock:index");t.a=[r.a]},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=n(3),a=n(4),c=n(8),f=n(161),s=n(1),l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),p=(n(0).get("detection:adblocker:safari:adblock:style_sheet_test"),function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),l(t,null,[{key:"getSchema",value:function(){return new a.a(s.b.ADBLOCKER,s.c.ARTIFACT,s.c.STYLE_SHEET,s.c.HIDING_DATA)}},{key:"testMethod",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window,t=n.i(f.a)(e),r=t.foundAdblocker();return this.getSchema().createResult(r?s.a.ADBLOCK:s.a.NOT_PRESENT,r?s.f.STYLE_SHEET_PRESENT:s.f.NO_STYLE_SHEET_PRESENT,c.a.fromStyleSheets({documentSheets:t.getAdblockerStyleSheets()}))}}]),t}(u.b));t.a=p},function(e,t,n){"use strict";var r=n(271);n(0).get("detection:adblocker:safari:adblock_plus:index");t.a=[r.a]},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=n(3),a=n(4),c=n(8),f=n(162),s=n(1),l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),p=(n(0).get("detection:adblocker:safari:adblock_plus:style_sheet_test"),function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),l(t,null,[{key:"getSchema",value:function(){return new a.a(s.b.ADBLOCKER,s.c.ARTIFACT,s.c.STYLE_SHEET,s.c.HIDING_DATA)}},{key:"testMethod",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window,t=n.i(f.a)(e),r=t.foundAdblocker();return this.getSchema().createResult(r?s.a.ADBLOCK_PLUS:s.a.NOT_PRESENT,r?s.f.STYLE_SHEET_PRESENT:s.f.NO_STYLE_SHEET_PRESENT,c.a.fromStyleSheets({documentSheets:t.getAdblockerStyleSheets()}))}}]),t}(u.b));t.a=p},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=n(129),a=n(242),c=n(1),f=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var u=o.get;if(void 0!==u)return u.call(r)},l=(n(0).get("detection:dfp_interference:image_network_test"),function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),f(t,null,[{key:"getSchema",value:function(){return s(t.__proto__||Object.getPrototypeOf(t),"getSchema",this).call(this).addAttribute(c.b.DFP_INTERFERENCE).removeAttribute(c.b.INTERFERENCE)}},{key:"testMethod",value:function(){return s(t.__proto__||Object.getPrototypeOf(t),"testMethod",this).call(this,n.i(a.a)())}}]),t}(u.a));t.a=l},function(e,t,n){"use strict";var r=n(272);n(0).get("detection:dfp_interference:index");t.a=[r.a]},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e,t){return e+"/"+t}var a=n(3),c=n(4),f=n(128),s=n(1),l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),p=n(0).get("detection:fsm:ajax_data_test"),h=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),l(t,null,[{key:"getSchema",value:function(){return new c.a(s.b.GENERIC_ADBLOCKER,s.b.FSM_DATA,s.c.NETWORK,s.c.INFERENCE,s.c.AJAX,s.c.FSM)}},{key:"testMethod",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return t&&r?(p.info("loading fsm data",t,r),n.i(f.a)(u(t,r)).then(function(t){return e.getSchema().createResult(t.blocked?s.a.PRESENT:s.a.NOT_PRESENT,t.reasonAttribute,t.infoAttributes,t.xhrData,new s.w(r))})):(p.error("cannot load fsm data",t,r),this.getSchema().createResult(s.a.NOT_PRESENT,s.f.CANNOT_TEST))}}]),t}(a.b);t.a=h},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e,t){var r=document.createElement(O[n.i(m.a)(0,O.length)]);r.className=n.i(m.b)(),document.body.appendChild(r);var o=document.createElement("style");return document.head.appendChild(o),o.innerHTML="\n        "+r.nodeName.toLowerCase()+"."+r.className+" {\n            position: absolute !important;\n            top: -9999px !important;\n            left: -9999px !important;\n        }\n    ",d["default"].all(a(o,r,e,t)).then(function(e){r.parentElement&&document.body.removeChild(r),o.parentElement&&document.head.removeChild(o);var t=e.reduce(function(e,t){return e.addAttribute(t.attributes)});return t.has(v.a.PRESENT)?t.removeAttribute(v.a.NOT_PRESENT,v.f.NO_MATCHING_BLACKLIST):t})}function a(e,t,r,o){var i=!1;return o.map(function(o){var u=document.createElement(O[n.i(m.a)(0,O.length)]);u.className=n.i(m.b)(),t.appendChild(u);var a=void 0;try{a=n.i(y.a)(o)}catch(e){return E.warn("broken rule",o),r.createResult(v.a.NOT_PRESENT,v.f.NO_MATCHING_BLACKLIST,new v.t(o))}var f=u.nodeName.toLowerCase()+"."+u.className+" > "+o,s="\n            "+f+" {\n                display: block;\n                height: 5px !important;\n                width: 5px !important;\n            }\n        ";return null==e.sheet||"function"!=typeof e.sheet.insertRule?e.innerHTML+=s:e.sheet.insertRule(s,0),a.forEach(function(e){u.appendChild(e)}),c().then(function(){return new d["default"](function(e){var t=document.querySelector(f);if(!t)return void e(r.createResult(v.a.NOT_PRESENT,v.f.NO_MATCHING_BLACKLIST,new v.u(o)));if(n.i(_.b)(t)){E.debug("hiding rule",o);var u=void 0;i||(i=!0,u=p.a.fromElement(t,o)),e(r.createResult(v.a.PRESENT,v.f.HIDE_MATCHING_BLACKLIST,u,new v.v(o)))}else e(r.createResult(v.a.NOT_PRESENT,v.f.NO_MATCHING_BLACKLIST))})}).then(function(e){return u.parentElement&&t.removeChild(u),e})})}function c(){return new d["default"](function(e){setTimeout(function(){setTimeout(function(){e()},150)},1)})}var f=n(19),s=n.n(f),l=n(4),p=n(8),h=n(56),d=n(2),_=n(22),y=n(135),b=n(45),v=n(1),m=n(20),g=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),E=n(0).get("detection:fsm:element_hiding_test"),O=["div","span","li","section"],w=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),g(t,null,[{key:"getSchema",value:function(){return new l.a(v.b.GENERIC_ADBLOCKER,v.c.INFERENCE,v.c.FSM,v.c.ELEMENT,v.c.HIDING,v.c.HIDING_DATA)}},{key:"testMethod",value:function(e){var t=s()(this.getFSMData(e,b.d));return 0===t.length?(E.debug("no hiding rules"),this.getSchema().createResult(v.a.NOT_PRESENT,v.f.NO_ELEMENT_HIDING_RULES)):u(this.getSchema(),t)}}]),t}(h.a);t.a=w},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=n(56),a=n(129),c=n(45),f=n(1),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(0).get("detection:fsm:image_network_test"),p=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),s(t,null,[{key:"getSchema",value:function(){return a.a.getSchema().addAttribute(f.c.FSM)}},{key:"testMethod",value:function(e){var t=this.getFSMData(e,c.b).pop(),n=t&&t.img;return l.debug("fsm image network url",n),null==n?this.getSchema().createResult(f.a.NOT_PRESENT,f.f.CANNOT_TEST):a.a.testMethod.call(this,n+"?cb="+Date.now())}}]),t}(u.a);t.a=p},function(e,t,n){"use strict";function r(){if(!f["default"].get(["detection","fsm","enable"]))return[];var e=o.a.bindArgs(f["default"].get(["detection","fsm","endpoint"]),document.domain);return f["default"].get(["detection","fsm","enableNetwork"])?[e,i.a,a.a,u.a,c.a]:[e,i.a]}var o=n(274),i=n(275),u=n(276),a=n(279),c=n(281),f=n(5);t.a=r;n(0).get("detection:fsm:index")},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=(n(0).get("detection:fsm:network_blocker_list"),function(){function e(t,n,o,i){r(this,e),this._name=t,this._domain=n||"",this._blacklistRules=o,this._whitelistRules=i}return o(e,[{key:"getName",value:function(){return this._name}},{key:"allMatchingBlacklistRules",value:function(e,t){return this._allMatchingRules(this._blacklistRules,e,t)}},{key:"allMatchingWhitelistRules",value:function(e,t){return this._allMatchingRules(this._whitelistRules,e,t)}},{key:"_allMatchingRules",value:function(e,t,n){var r=this;return e.reduce(function(e,o){var i=t.filter(function(e){return o.test(e.src,{tagName:e.tagName,domain:r._domain})}),a=n.filter(function(e){return o.test(e.src,{tagName:e.tagName,domain:r._domain})});return 0===i.length&&0===a.length?e:e.concat(new u(o,i,a))},[])}}]),e}());t.a=i;var u=function e(t,n,o){r(this,e),this.rule=t,this.loadEvents=n,this.errorEvents=o}},function(e,t,n){"use strict";function r(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e,t,o){var i=n.i(m.a)(window._sp_._networkListenerData);if(null==i)return e.createResult(E.a.NOT_PRESENT,E.f.NO_NETWORK_LISTENER_DATA);var u=i.loadEvents,a=i.errorEvents;S.debug("fsm load/error events",u,a);var f=t.reduce(function(e,t){var n,o,i=p()(e,function(e){return e.listName===t.listName});return-1===i?(e.push(t),e):((n=e[i].blacklist).push.apply(n,r(t.blacklist)),(o=e[i].whitelist).push.apply(o,r(t.whitelist)),e)},[]);S.debug("network rules by list",f);var l=f.map(function(e){return new b.a(e.listName,document.domain,e.blacklist.map(function(e){return new O.a(e)}),e.whitelist.map(function(e){return new O.b(e)}))});if(0===l.length)return e.createResult(E.a.NOT_PRESENT,E.f.NO_NETWORK_BLOCKING_RULES);var h=u.map(function(e){return new w.a(c(e.src,o.location.protocol),e.tagName)}),d=a.map(function(e){return new w.b(c(e.src,o.location.protocol),e.tagName)});return l.reduce(function(e,t){S.debug("fsm networker blocker list:",t.getName());var n=t.allMatchingBlacklistRules(h,d);S.debug("blacklist rule matches:",n);var r=t.allMatchingWhitelistRules(h,d);S.debug("whitelist rule matches:",r);var o=n.some(function(e){return e.loadEvents.length>0}),i=n.some(function(e){return e.errorEvents.length>0}),u=r.some(function(e){return e.loadEvents.length>0}),a=r.some(function(e){return e.errorEvents.length>0}),c=new E.o(t.getName(),n.map(function(e){return new E.p(e.rule.toString(),e.loadEvents.map(function(e){return new E.q(e.src,e.tagName)}),e.errorEvents.map(function(e){return new E.r(e.src,e.tagName)}))}),r.map(function(e){return new E.s(e.rule.toString(),e.loadEvents.map(function(e){return new E.q(e.src,e.tagName)}),e.errorEvents.map(function(e){return new E.r(e.src,e.tagName)}))}));if(S.debug("blacklist load",o),S.debug("blacklist error",i),S.debug("whitelist load",u),S.debug("whitelist error",a),S.debug(c),e.has(E.a.PRESENT))return o||i||u||a?e.addAttribute(c):e;if(i&&!o)return e.addAttribute(E.a.PRESENT,E.f.ERROR_MATCHING_BLACKLIST,c).removeAttribute(E.a.NOT_PRESENT,E.f.NO_MATCHING_BLACKLIST);if(i&&o){var f=s()(n.map(function(e){return e.loadEvents})),p=f.every(function(e){return l.some(function(t){return t.allMatchingWhitelistRules([e],[]).length>0})});return S.debug("all loads matching whitelist",p),p?e.addAttribute(E.a.PRESENT,E.f.ERROR_MATCHING_BLACKLIST,E.f.LOAD_MATCHING_WHITELIST,c).removeAttribute(E.a.NOT_PRESENT,E.f.NO_MATCHING_BLACKLIST):e.addAttribute(E.f.LOAD_MATCHING_BLACKLIST,c).removeAttribute(E.f.NO_MATCHING_BLACKLIST)}return!i&&o?e.addAttribute(E.f.LOAD_MATCHING_BLACKLIST,c).removeAttribute(E.f.NO_MATCHING_BLACKLIST):u||a?e.addAttribute(c):e},e.createResult(E.a.NOT_PRESENT,E.f.NO_MATCHING_BLACKLIST))}function c(e,t){return 0===e.indexOf("//")?t+e:e}var f=n(16),s=n.n(f),l=n(116),p=n.n(l),h=n(19),d=n.n(h),_=n(4),y=n(56),b=n(278),v=n(2),m=n(318),g=n(45),E=n(1),O=n(280),w=n(136),T=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),S=n(0).get("detection:fsm:network_listener_test"),R=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return u(t,e),T(t,null,[{key:"getSchema",value:function(){return new _.a(E.b.GENERIC_ADBLOCKER,E.c.FSM,E.c.NETWORK_LISTENER,E.c.INFERENCE)}},{key:"testMethod",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window,r=d()(this.getFSMData(e,g.c));return S.debug("fsm network rules",r),new v["default"](function(e){"complete"===n.document.readyState?e(a(t.getSchema(),r,n)):n.addEventListener("load",function(){e(a(t.getSchema(),r,n))})})}}]),t}(y.a);t.a=R},function(e,t,n){"use strict";function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e){return new RegExp(e.replace(/\*+/g,"*").replace(/\^\|$/,"^").replace(/\W/g,"\\$&").replace(/\\\*/g,".*").replace(/\\\^/g,"(?:[\\x00-\\x24\\x26-\\x2C\\x2F\\x3A-\\x40\\x5B-\\x5E\\x60\\x7B-\\x7F]|$)").replace(/^\\\|\\\|/,"^[\\w\\-]+:\\/+(?!\\/)(?:[^\\/]+\\.)?").replace(/^\\\|/,"^").replace(/\\\|$/,"$").replace(/^(\.\*)/,"").replace(/(\.\*)$/,""))}function a(e){return e.split(",").map(function(e){if(0===e.indexOf("domain=")){var t=e.slice("domain=".length);return new P("domain",t.split("|").map(s))}var n=e.indexOf("third-party");return 0===n||1===n?f(e):c(e)})}function c(e){return l(e,T)}function f(e){return l(e,S)}function s(e){return l(e,R)}function l(e,t){var n=e.match(/(~)?(.*)/);return null==n?new t(e):new t(n[2],"~"===n[1])}function p(e,t,n){if(0===e.length)return!0;var r=e.filter(function(e){return e instanceof O&&!e.not}),o=e.filter(function(e){return e instanceof E&&!e.not}),i=e.filter(function(e){return e.not});return!o.some(function(e){return!e.test(t,n)})&&(!(r.length>0&&r.every(function(e){return!e.test(t,n)}))&&!i.some(function(e){return e.test(t,n)}))}var h=n(139),d=n.n(h),_=n(25);n.d(t,"a",function(){return v}),n.d(t,"b",function(){return m});var y=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),b=(n(0).get("detection:fsm:network_rule"),function(){function e(t){i(this,e);var n=t.indexOf("$"),r=t,o=[];n>-1&&(o=a(t.slice(n+1)),r=t.slice(0,n)),this._ruleStr=t,this.regExp=u(r),this.options=o}return y(e,[{key:"toString",value:function(){return this._ruleStr}},{key:"test",value:function(e,t){return this.regExp.test(e)&&this._testOptions(e,t)}},{key:"_testOptions",value:function(e,t){return p(this.options,e,t)}}]),e}()),v=function(e){function t(){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),t}(b),m=function(e){function t(){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),t}(b),g=function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];i(this,e),this.name=t,this.not=n},E=function(e){function t(){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),t}(g),O=function(e){function t(){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),t}(g),w={img:"image",iframe:"subdocument"},T=function(e){function t(){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),y(t,[{key:"test",value:function(e,t){var n=t.tagName,r=w[n]||n;return this.name===r}}]),t}(O),S=function(e){function t(){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),y(t,[{key:"test",value:function(e,t){var n=new _.a(e),r=n.hostname;if(r.indexOf(t.domain)>-1)return!1;var o=r.split("."),i=t.domain.split(".");if(d()(o)!==d()(i))return!0;if("co"===o[o.length-2]&&"uk"===d()(o)){if("co"!==i[i.length-2]||"uk"!==d()(i))return!0;o.pop(),i.pop()}return o.pop(),i.pop(),d()(o)!==d()(i)}}]),t}(E),R=function(e){function t(){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),y(t,[{key:"test",value:function(e,t){return t.domain.indexOf(this.name)>-1}}]),t}(O),P=function(e){function t(e,n){i(this,t);var o=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return o.domains=n,o}return o(t,e),y(t,[{key:"test",value:function(e,t){return p(this.domains,e,t)}}]),t}(E)},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=n(56),a=n(130),c=n(45),f=n(1),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(0).get("detection:fsm:script_network_test"),p=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),s(t,null,[{key:"getSchema",value:function(){return a.a.getSchema().addAttribute(f.c.FSM)}},{key:"findDependency",value:function(e){return e.has(f.b.FSM_DATA)}},{key:"testMethod",value:function(e){var t=this.getFSMData(e,c.b).pop(),n=t&&t.script;return l.debug("fsm script network url",n),null==n?this.getSchema().createResult(f.a.NOT_PRESENT,f.f.CANNOT_TEST):a.a.testMethod.call(this,n)}}]),t}(u.a);t.a=p},function(e,t,n){"use strict";var r=n(66),o=n(283);n(0).get("detection:generic_adblocker:index");t.a=[r.a,o.a]},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=n(66),a=n(2),c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),f=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var u=o.get;if(void 0!==u)return u.call(r)},s=(n(0).get("detection:generic_adblocker:on_load_element_hiding_test"),function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),c(t,null,[{key:"testMethod",value:function(e){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;return"complete"===r.document.readyState?f(t.__proto__||Object.getPrototypeOf(t),"testMethod",this).call(this,e,r,o):new a["default"](function(i){r.addEventListener("load",function(){i(f(t.__proto__||Object.getPrototypeOf(t),"testMethod",n).call(n,e,r,o))})})}}]),t}(u.a));t.a=s},function(e,t,n){"use strict";var r=n(285);n(0).get("detection:interference:index");t.a=[r.a]},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=n(2),a=n(130),c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),f=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var u=o.get;if(void 0!==u)return u.call(r)},s=(n(0).get("detection:interference:script_network_optimizely_test"),function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),c(t,null,[{key:"testMethod",value:function(){var e=this,n=document.createElement("iframe");return new u["default"](function(r){n.addEventListener("load",function(){r(f(t.__proto__||Object.getPrototypeOf(t),"testMethod",e).call(e,"//cdn3.optimizely.com/js/geo2.js",n.contentWindow))}),document.body.appendChild(n)}).then(function(e){return n.parentElement&&n.parentElement.removeChild(n),e})}}]),t}(a.a));t.a=s},function(e,t,n){"use strict";var r=n(287);n(0).get("detection:private:chrome:index");t.a=[r.a]},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=n(3),a=n(4),c=n(2),f=n(1),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=(n(0).get("detection:private:chrome:request_file_system_test"),function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),s(t,null,[{key:"getSchema",value:function(){return new a.a(f.b.PRIVATE,f.c.FEATURE_ACCESS)}},{key:"testMethod",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window;return new c["default"](function(n){t.webkitRequestFileSystem?t.webkitRequestFileSystem(window.TEMPORARY,1,function(){n(e.getSchema().createResult(f.a.NOT_PRESENT,f.f.REQUEST_FILE_SYSTEM_SUCCESS))},function(t){n("SecurityError"===t.name?e.getSchema().createResult(f.a.PRESENT,f.f.REQUEST_FILE_SYSTEM_ERROR,new f.j(t.name)):e.getSchema().createResult(f.a.NOT_PRESENT,f.f.REQUEST_FILE_SYSTEM_ERROR,new f.j(t.name)))}):n(e.getSchema().createResult(f.a.NOT_PRESENT,f.f.NO_REQUEST_FILE_SYSTEM))})}}]),t}(u.b));t.a=l},function(e,t,n){"use strict";var r=n(289);n(0).get("detection:private:firefox:index");t.a=[r.a]},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=n(3),a=n(4),c=n(2),f=n(1),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(0).get("detection:private:firefox:indexed_db_open_test"),p=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),s(t,null,[{key:"getSchema",value:function(){return new a.a(f.b.PRIVATE,f.c.FEATURE_ACCESS)}},{key:"testMethod",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window;return new c["default"](function(n){if(t.indexedDB){var r=t.indexedDB.open("test");r.onsuccess=function(){n(e.getSchema().createResult(f.a.NOT_PRESENT,f.f.INDEXED_DB_OPEN_SUCCESS))},r.onerror=function(){l.warn("you may see an InvalidStateError this is generated by ff when attempting to open indexed DB in private browsing mode"),n(e.getSchema().createResult(f.a.PRESENT,f.f.INDEXED_DB_OPEN_ERROR))}}else n(e.getSchema().createResult(f.a.NOT_PRESENT,f.f.NO_INDEXED_DB))})}}]),t}(u.b);t.a=p},function(e,t,n){"use strict";var r=n(291);n(0).get("detection:private:internet_explorer:index");t.a=[r.a]},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=n(3),a=n(4),c=n(1),f=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=(n(0).get("detection:private:internet_explorer:indexed_db_exists_test"),function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),f(t,null,[{key:"getSchema",value:function(){return new a.a(c.b.PRIVATE,c.c.FEATURE_ACCESS)}},{key:"testMethod",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:window).indexedDB?this.getSchema().createResult(c.a.NOT_PRESENT,c.f.INDEXED_DB_EXISTS):this.getSchema().createResult(c.a.PRESENT,c.f.NO_INDEXED_DB)}}]),t}(u.b));t.a=s},function(e,t,n){"use strict";var r=n(293);n(0).get("detection:private:safari:index");t.a=[r.a]},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=n(3),a=n(4),c=n(1),f=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=(n(0).get("detection:private:safari:local_storage_set_test"),function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),f(t,null,[{key:"getSchema",value:function(){return new a.a(c.b.PRIVATE,c.c.FEATURE_ACCESS)}},{key:"testMethod",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window;if(!e.localStorage)return this.getSchema().createResult(c.a.NOT_PRESENT,c.f.NO_LOCAL_STORAGE);try{return e.localStorage.setItem("sp","1"),e.localStorage.removeItem("sp"),this.getSchema().createResult(c.a.NOT_PRESENT,c.f.LOCAL_STORAGE_SET_SUCCESS)}catch(e){return"QuotaExceededError"===e.name?this.getSchema().createResult(c.a.PRESENT,c.f.LOCAL_STORAGE_SET_ERROR,new c.j(e.name)):this.getSchema().createResult(c.a.NOT_PRESENT,c.f.LOCAL_STORAGE_SET_ERROR,new c.j(e.name))}}}]),t}(u.b));t.a=s},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(){return new c["default"](function(e){window.setTimeout(function(){e()},500)})}var a=n(97),c=n(2),f=n(1),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var u=o.get;if(void 0!==u)return u.call(r)};n(0).get("detection:rerun_test_mixin");t.a=new a.a(function(e){return function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),s(t,null,[{key:"testMethod",value:function(){for(var e=this,n=arguments.length,r=Array(n),o=0;o<n;o++)r[o]=arguments[o];var i=function(n){return n.has(f.a.NOT_PRESENT)?n:u().then(function(){return l(t.__proto__||Object.getPrototypeOf(t),"testMethod",e).apply(e,r)})};return c["default"].resolve(l(t.__proto__||Object.getPrototypeOf(t),"testMethod",this).apply(this,r)).then(function(e){return i(e)}).then(function(e){return i(e)})}}]),t}(e)})},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=n(3),a=n(4),c=n(14),f=n(1),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=(n(0).get("detection:stand_down:bot_ua_test"),function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),s(t,null,[{key:"getSchema",value:function(){return new a.a(f.b.STAND_DOWN,f.c.USER_AGENT,f.c.BOT)}},{key:"testMethod",value:function(){return c.a.googlebot()?this.getSchema().createResult(f.a.PRESENT,f.f.GOOGLE_BOT_USER_AGENT):c.a.googleweblight()?this.getSchema().createResult(f.a.PRESENT,f.f.GOOGLE_WEB_LIGHT_USER_AGENT):c.a.bingbot()?this.getSchema().createResult(f.a.PRESENT,f.f.BING_BOT_USER_AGENT):c.a.exabot()?this.getSchema().createResult(f.a.PRESENT,f.f.EXA_BOT_USER_AGENT):this.getSchema().createResult(f.a.NOT_PRESENT,f.f.NO_BOT_USER_AGENT)}}]),t}(u.b));t.a=l},function(e,t,n){"use strict";var r=n(295),o=n(297);n(0).get("detection:stand_down:index");t.a=[r.a,o.a]},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=n(3),a=n(4),c=n(1),f=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=(n(0).get("detection:stand_down:proxy_host_test"),["w","e","b","c","a","c","h","e",".","g","o","o","g","l","e","u","s","e","r","c","o","n","t","e","n","t",".","c","o","m"].join("")),l=["o","p","t","i","m","i","z","e","l","y","p","r","e","v","i","e","w",".","c","o","m"].join(""),p=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),f(t,null,[{key:"getSchema",value:function(){return new a.a(c.b.STAND_DOWN,c.c.PROXY_HOST)}},{key:"testMethod",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.location.host;return e===s?this.getSchema().createResult(c.a.PRESENT,c.f.GOOGLE_WEBCACHE_PROXY_HOST):e.indexOf(l)>-1?this.getSchema().createResult(c.a.PRESENT,c.f.OPTIMIZELY_PREVIEW_PROXY_HOST):this.getSchema().createResult(c.a.NOT_PRESENT,c.f.NO_PROXY_HOST)}}]),t}(u.b);t.a=p},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=n(49),a=n.n(u),c=n(133),f=n(132),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=(n(0).get("detection:test_result:index"),["types","tests","reasons","results"]),p=function(e){function t(){var e;r(this,t);for(var i=arguments.length,u=Array(i),a=0;a<i;a++)u[a]=arguments[a];var c=o(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(u))),s=n.i(f.a)(c.attributes);return l.forEach(function(e){if(0===s[e].length)throw new Error("did not provide attribute type: "+e)}),c}return i(t,e),s(t,[{key:"toString",value:function(){var e=n.i(f.a)(this.attributes);return l.concat("info").filter(function(t){return e[t].length>0}).map(function(t){return e[t].slice().sort().join(",")}).join("::")}},{key:"addAttribute",value:function(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return new(Function.prototype.bind.apply(t,[null].concat([this.attributes],n)))}},{key:"removeAttribute",value:function(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];var o=new(Function.prototype.bind.apply(c.a,[null].concat(n)));return new t(this.attributes.filter(function(e){return!o.attributes.some(function(t){return t.is(e)})}))}},{key:"getData",value:function(e){var t=a()(this.attributes,function(t){return t instanceof e});return t?t.getValue():null}}]),t}(c.a);t.a=p},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=n(19),i=n.n(o),u=n(3),a=n(2),c=n(294),f=n(1),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=(n(0).get("detection:test_runner"),function(){function e(){r(this,e);for(var t=arguments.length,n=Array(t),o=0;o<t;o++)n[o]=arguments[o];this._tests=i()(n).map(function(e){return e.has(f.c.NETWORK)?c.a.to(e):e}).map(function(e){return new e}),this._running=!1}return s(e,[{key:"run",value:function(){var e=this;if(this._running)throw new Error("already running");this._running=!0,this._tests.forEach(function(t){if(t instanceof u.a){var n=t,r=e._tests.filter(function(e){return e!==n&&n.constructor.findDependency(e.constructor)});a["default"].all(r.map(function(e){return e.waitForResult()})).then(function(e){return t.run(e)})}else t.run()})}},{key:"waitForResultsWhere",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){return!0};return a["default"].all(this._getTestResultsWhere(e))}},{key:"someResultPresentWhere",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){return!0};return new a["default"](function(n){var r=e._getTestResultsWhere(t);if(0===r.length)return n(!1);var o=!1,i=0;r.forEach(function(e){e.then(function(e){if(!o){if(i++,!e.has(f.a.NOT_PRESENT))return o=!0,void n(!0);i===r.length&&(o=!0,n(!1))}})})})}},{key:"_getTestResultsWhere",value:function(e){return this._tests.filter(function(t){return e(t.constructor)}).map(function(e){return e.waitForResult()})}}]),e}());t.a=l},,,function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e,t){return e.consumeCharacters("]"),new s(t)}var a=n(24),c=n(40);t.a=u;var f=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=(n(0).get("util:dom:get_elements_from_selector:consumers:attribute_consumer:any_value_consumer"),function(e){function t(e){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n.i(c.a)().join(" ")))}return i(t,e),f(t,[{key:"applyToElement",value:function(e){e.setAttribute(this.key,e.hasAttribute(this.key)?e.getAttribute(this.key)||"":this.value)}}]),t}(a.a))},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e,t){e.consumeCharacters("*=");var r=e.consumeRegex(l.f),o=n.i(f.a)(r);return new h(t,o)}var a=n(24),c=n(40),f=n(41),s=n(20),l=n(7);t.a=u;var p=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),h=(n(0).get("util:dom:get_elements_from_selector:consumers:attribute_consumer:contains_value_consumer"),function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),p(t,[{key:"applyToElement",value:function(e){if(e.hasAttribute(this.key)){var t=(e.getAttribute(this.key)||"").split(" ");t.splice(n.i(s.a)(0,t.length),0,this.value),e.setAttribute(this.key,t.join(" "))}else{var r=n.i(c.a)().join(" "),o=n.i(s.a)(0,r.length);e.setAttribute(this.key,r.slice(0,o)+this.value+r.slice(o))}}}]),t}(a.a))},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e,t){e.consumeCharacters("$=");var r=e.consumeRegex(s.f),o=n.i(f.a)(r);return new p(t,o)}var a=n(24),c=n(40),f=n(41),s=n(7);t.a=u;var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),p=(n(0).get("util:dom:get_elements_from_selector:consumers:attribute_consumer:ends_with_value_consumer"),function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),l(t,[{key:"applyToElement",value:function(e){var t=e.hasAttribute(this.key)?e.getAttribute(this.key)||"":n.i(c.a)().join(" ");e.setAttribute(this.key,t+" "+this.value)}}]),t}(a.a))},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e,t){e.consumeCharacters("=");var r=e.consumeRegex(f.f),o=n.i(c.a)(r);return new l(t,o)}var a=n(24),c=n(41),f=n(7);t.a=u;var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=(n(0).get("util:dom:get_elements_from_selector:consumers:attribute_consumer:equals_value_consumer"),function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),s(t,[{key:"applyToElement",value:function(e){e.setAttribute(this.key,this.value)}}]),t}(a.a))},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e,t){e.consumeCharacters("~=");var r=e.consumeRegex(l.f),o=n.i(f.a)(r);return new h(t,o)}var a=n(24),c=n(40),f=n(41),s=n(20),l=n(7);t.a=u;var p=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),h=(n(0).get("util:dom:get_elements_from_selector:consumers:attribute_consumer:equals_word_value_consumer"),function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),p(t,[{key:"applyToElement",value:function(e){var t=e.hasAttribute(this.key)?(e.getAttribute(this.key)||"").split(" "):n.i(c.a)(),r=n.i(s.a)(0,t.length);t.splice(r,0,this.value),e.setAttribute(this.key,t.join(" "))}}]),t}(a.a))},function(e,t,n){"use strict";function r(e){e.consumeCharacters("[");var t=e.consumeRegex(s.b);if(p.indexOf(t)>-1)throw n.i(l.d)(e.getSelector());var r=e.lookAheadRegex(s.e),o=h[r];if(!o)throw n.i(l.a)(e.getSelector());return o(e,t)}var o=n(302),i=n(303),u=n(305),a=n(304),c=n(308),f=n(306),s=n(7),l=n(43);t.a=r;var p=(n(0).get("util:dom:get_elements_from_selector:consumers:attribute_consumer:index"),["src"]),h={"=":u.a,"~=":f.a,"^=":c.a,"$=":a.a,"*=":i.a,"]":o.a}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e,t){e.consumeCharacters("^=");var r=e.consumeRegex(s.f),o=n.i(f.a)(r);return new p(t,o)}var a=n(24),c=n(40),f=n(41),s=n(7);t.a=u;var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),p=(n(0).get("util:dom:get_elements_from_selector:consumers:attribute_consumer:starts_with_value_consumer"),function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),l(t,[{key:"applyToElement",value:function(e){var t=e.hasAttribute(this.key)?e.getAttribute(this.key)||"":n.i(c.a)().join(" ");e.setAttribute(this.key,this.value+" "+t)}}]),t}(a.a))},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e){return e.consumeRegex(f.k),new l(n.i(c.a)(e))}var a=n(58),c=n(42),f=n(7);t.a=u;var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=(n(0).get("util:dom:get_elements_from_selector:consumers:child_element_consumer"),function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),s(t,[{key:"applyToElementRecord",value:function(e){e.appendChildElementRecord(this.elementRecord)}}]),t}(a.a))},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e){return e.consumeCharacters("."),new s(e.consumeRegex(c.b))}var a=n(87),c=n(7);t.a=u;var f=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=(n(0).get("util:dom:get_elements_from_selector:consumers:class_name_consumer"),function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n._className=e,n}return i(t,e),f(t,[{key:"applyToElement",value:function(e){e.className=e.className?e.className+" "+this._className:this._className}}]),t}(a.a))},function(e,t,n){"use strict";function r(e){throw e.consumeCharacters(":"),n.i(o.c)(e.getSelector())}var o=n(43);t.a=r;n(0).get("util:dom:get_elements_from_selector:consumers:custom_selector_method_consumer")},function(e,t,n){"use strict";function r(e){var t=new f.a,r=n.i(c.a)(e);t.appendChildElementRecord(r);for(var o=r;!e.isDone();){var i=e.lookAheadRegex(s.a);if(""===i)throw n.i(l.a)(e.getSelector());var u=p[i.trim()];if(!u)throw n.i(l.a)(e.getSelector());var a=u(e);a.applyToElementRecord(o),o=a.getElementRecord()}return t}var o=n(309),i=n(313),u=n(314),a=n(316),c=n(42),f=n(88),s=n(7),l=n(43);t.a=r;var p=(n(0).get("util:dom:get_elements_from_selector:consumers:element_hierarchy_consumer"),{">":o.a,"":i.a,"+":a.a,"~":u.a})},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e){return e.consumeRegex(s.j),new p(n.i(c.a)(e))}var a=n(58),c=n(42),f=n(134),s=n(7);t.a=u;var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),p=(n(0).get("util:dom:get_elements_from_selector:consumers:grand_child_element_consumer"),function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),l(t,[{key:"applyToElementRecord",value:function(e){var t=n.i(f.a)();t.push(this.elementRecord),t.forEach(function(e,n){n>0&&t[n-1].appendChildElementRecord(e)}),e.appendChildElementRecord(t[0])}}]),t}(a.a))},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e){return e.consumeRegex(s.h),new p(n.i(c.a)(e))}var a=n(58),c=n(42),f=n(134),s=n(7);t.a=u;var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),p=(n(0).get("util:dom:get_elements_from_selector:consumers:grand_sibling_element_consumer"),function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),l(t,[{key:"applyToElementRecord",value:function(e){var t=e.getParentElementRecord(),r=n.i(f.a)();r.push(this.elementRecord),r.forEach(function(e){t.appendChildElementRecord(e)})}}]),t}(a.a))},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e){return e.consumeCharacters("#"),new s(e.consumeRegex(c.b))}var a=n(87),c=n(7);t.a=u;var f=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=(n(0).get("util:dom:get_elements_from_selector:consumers:id_consumer"),function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n._id=e,n}return i(t,e),f(t,[{key:"applyToElement",value:function(e){e.id=this._id}}]),t}(a.a))},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e){return e.consumeRegex(f.i),new l(n.i(c.a)(e))}var a=n(58),c=n(42),f=n(7);t.a=u;var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=(n(0).get("util:dom:get_elements_from_selector:consumers:sibling_element_consumer"),function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),s(t,[{key:"applyToElementRecord",value:function(e){e.getParentElementRecord().appendChildElementRecord(this.elementRecord)}}]),t}(a.a))},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=n(43),i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=(n(0).get("util:dom:get_elements_from_selector:selector_reader"),function(){function e(t){r(this,e),this._selector=t,this._index=0}return i(e,[{key:"lookAheadRegex",value:function(){var e=this._getCharsWithRegex.apply(this,arguments);return this._validateNoSkippedChars(e),e}},{key:"consumeRegex",value:function(){var e=this._getCharsWithRegex.apply(this,arguments);return this._validateConsumed(e),this._advanceReader(e.length),e}},{key:"consumeCharacters",value:function(e){return this._validateConsumed(e),this._advanceReader(e.length),e}},{key:"getSelector",value:function(){return this._selector}},{key:"isDone",value:function(){return this._index>=this._selector.length}},{key:"_getCharsWithRegex",value:function(){for(var e=this._getRemainingCharacters(),t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];var o=n.reduce(function(t,n){return t||n.exec(e)},null);return o?o[0]:""}},{key:"_getRemainingCharacters",value:function(){return this._selector.slice(this._index)}},{key:"_advanceReader",value:function(e){this._index+=e}},{key:"_validateConsumed",value:function(e){if(0===e.length)throw n.i(o.a)(this.getSelector());this._validateNoSkippedChars(e)}},{key:"_validateNoSkippedChars",value:function(e){if(0!==this._getRemainingCharacters().indexOf(e))throw n.i(o.a)(this.getSelector())}}]),e}());t.a=u},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=n(136);n(0).get("util:get_network_listener_data");t.a=function(e){return null==e?null:new i(e.load.events.map(function(e){return new o.a(e.src,e.tagName)}),e.error.events.map(function(e){return new o.b(e.src,e.tagName)}))};var i=function e(t,n){r(this,e),this.loadEvents=t,this.errorEvents=n}},function(e,t,n){function r(e){var t=window.document,n=t.addEventListener,r=n?"addEventListener":"attachEvent",o=n?"":"on";window[r](o+"unload",e,!1)}n(0).get("util:unload");e.exports=r},function(e,t){function n(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e}e.exports=n},function(e,t){function n(e,t,n,r){var o=-1,i=null==e?0:e.length;for(r&&i&&(n=e[++o]);++o<i;)n=t(n,e[o],o,e);return n}e.exports=n},function(e,t){function n(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}e.exports=n},function(e,t){function n(e){return e.match(r)||[]}var r=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;e.exports=n},function(e,t,n){function r(e,t){return e&&o(t,i(t),e)}var o=n(17),i=n(26);e.exports=r},function(e,t,n){function r(e,t){return e&&o(t,i(t),e)}var o=n(17),i=n(37);e.exports=r},function(e,t,n){function r(e,t,n,u,a){return e===t||(null==e||null==t||!i(e)&&!i(t)?e!==e&&t!==t:o(e,t,n,u,r,a))}var o=n(327),i=n(36);e.exports=r},function(e,t,n){function r(e,t,n,r,y,v){var m=f(e),g=f(t),E=m?d:c(e),O=g?d:c(t);E=E==h?_:E,O=O==h?_:O;var w=E==_,T=O==_,S=E==O;if(S&&s(e)){if(!s(t))return!1;m=!0,w=!1}if(S&&!w)return v||(v=new o),m||l(e)?i(e,t,n,r,y,v):u(e,t,E,n,r,y,v);if(!(n&p)){var R=w&&b.call(e,"__wrapped__"),P=T&&b.call(t,"__wrapped__");if(R||P){var k=R?e.value():e,N=P?t.value():t;return v||(v=new o),y(k,N,n,r,v)}}return!!S&&(v||(v=new o),a(e,t,n,r,y,v))}var o=n(70),i=n(334),u=n(335),a=n(336),c=n(77),f=n(10),s=n(72),l=n(103),p=1,h="[object Arguments]",d="[object Array]",_="[object Object]",y=Object.prototype,b=y.hasOwnProperty;e.exports=r},function(e,t,n){function r(e,t,n){var r=e.length;return n=void 0===n?r:n,!t&&n>=r?e:o(e,t,n)}var o=n(137);e.exports=r},function(e,t,n){function r(e,t){return o(e,i(e),t)}var o=n(17),i=n(337);e.exports=r},function(e,t,n){function r(e,t){return o(e,i(e),t)}var o=n(17),i=n(338);e.exports=r},function(e,t,n){function r(e){return function(t){t=a(t);var n=i(t)?u(t):void 0,r=n?n[0]:t.charAt(0),c=n?o(n,1).join(""):t.slice(1);return r[e]()+c}}var o=n(328),i=n(114),u=n(115),a=n(47);e.exports=r},function(e,t,n){function r(e){return function(t){return o(u(i(t).replace(a,"")),e,"")}}var o=n(321),i=n(348),u=n(352),a=RegExp("[']","g");e.exports=r},function(e,t,n){function r(e,t,n,r){return void 0===e||o(e,i[n])&&!u.call(r,n)?t:e}var o=n(35),i=Object.prototype,u=i.hasOwnProperty;e.exports=r},function(e,t,n){function r(e,t,n,r,f,s){var l=n&a,p=e.length,h=t.length;if(p!=h&&!(l&&h>p))return!1;var d=s.get(e);if(d&&s.get(t))return d==t;var _=-1,y=!0,b=n&c?new o:void 0;for(s.set(e,t),s.set(t,e);++_<p;){var v=e[_],m=t[_];if(r)var g=l?r(m,v,_,t,e,s):r(v,m,_,e,t,s);if(void 0!==g){if(g)continue;y=!1;break}if(b){if(!i(t,function(e,t){if(!u(b,t)&&(v===e||f(v,e,n,r,s)))return b.push(t)})){y=!1;break}}else if(v!==m&&!f(v,m,n,r,s)){y=!1;break}}return s["delete"](e),s["delete"](t),y}var o=n(124),i=n(322),u=n(125),a=1,c=2;e.exports=r},function(e,t){function n(e,t){return e===t||e!==e&&t!==t}e.exports=n},function(e,t,n){function r(e,t,n,r,u,c){var f=n&i,s=o(e),l=s.length;if(l!=o(t).length&&!f)return!1;for(var p=l;p--;){var h=s[p];if(!(f?h in t:a.call(t,h)))return!1}var d=c.get(e);if(d&&c.get(t))return d==t;var _=!0;c.set(e,t),c.set(t,e);for(var y=f;++p<l;){h=s[p];var b=e[h],v=t[h];if(r)var m=f?r(v,b,h,t,e,c):r(b,v,h,e,t,c);if(!(void 0===m?b===v||u(b,v,n,r,c):m)){_=!1;break}y||(y="constructor"==h)}if(_&&!y){var g=e.constructor,E=t.constructor;g!=E&&"constructor"in e&&"constructor"in t&&!("function"==typeof g&&g instanceof g&&"function"==typeof E&&E instanceof E)&&(_=!1)}return c["delete"](e),c["delete"](t),_}var o=n(138),i=1,u=Object.prototype,a=u.hasOwnProperty;e.exports=r},function(e,t){function n(){return[]}e.exports=n},function(e,t){function n(){return[]}e.exports=n},function(e,t){function n(){return!1}e.exports=n},function(e,t){function n(e){var t=e.length,n=e.constructor(t);return t&&"string"==typeof e[0]&&o.call(e,"index")&&(n.index=e.index,n.input=e.input),n}var r=Object.prototype,o=r.hasOwnProperty;e.exports=n},function(e,t){function n(e){return e}e.exports=n},function(e,t,n){function r(e,t){return t.length<2?e:o(e,i(t,0,-1))}var o=n(75),i=n(137);e.exports=r},function(e,t){function n(e){return e.match(r)||[]}var r=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;e.exports=n},function(e,t,n){var r=n(17),o=n(71),i=n(37),u=o(function(e,t,n,o){r(t,i(t),e,o)});e.exports=u},function(e,t,n){function r(e,t){var n;if("function"!=typeof t)throw new TypeError(i);return e=o(e),function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=void 0),n}}var o=n(119),i="Expected a function";e.exports=r},function(e,t,n){var r=n(347),o=n(332),i=o(function(e,t,n){return t=t.toLowerCase(),e+(n?r(t):t)});e.exports=i},function(e,t,n){function r(e){return i(o(e).toLowerCase())}var o=n(47),i=n(351);e.exports=r},function(e,t){function n(e){return e}e.exports=n},function(e,t,n){var r=n(98),o=n(344),i=n(59),u=n(333),a=i(function(e){return e.push(void 0,u),r(o,void 0,e)});e.exports=a},function(e,t,n){function r(e,t){var n={};return t=u(t,3),i(e,function(e,r,i){o(n,t(e,r,i),e)}),n}var o=n(29),i=n(229),u=n(31);e.exports=r},function(e,t,n){var r=n(331),o=r("toUpperCase");e.exports=o},function(e,t,n){function r(e,t,n){return e=u(e),t=n?void 0:t,void 0===t?i(e)?a(e):o(e):e.match(t)||[]}var o=n(323),i=n(339),u=n(47),a=n(343);e.exports=r},,,,,function(e,t,n){"use strict";function r(){var e=i.a,t=new u["default"](function(t){e=t});return n.i(a.a)("checkState",function(e){t.then(function(t){e(t)})}),e}var o=n(68),i=n.n(o),u=n(2),a=n(11);t.a=r;n(0).get("backwards_compatibility:life_cycle:check_state")},,function(e,t,n){"use strict";function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document,t=[],n=[],r=o.bind(null,t),i=o.bind(null,n);return e.addEventListener("load",r,!0),e.addEventListener("error",i,!0),{load:{events:t,listener:r},error:{events:n,listener:i}}}function o(e,t){if(t.target){var n="string"==typeof t.target.tagName?t.target.tagName.toLowerCase():"",r="string"==typeof t.target.src?t.target.src:"";"iframe"!==n&&e.push({tagName:n,src:r})}}t.a=r;n(0).get("util:setup_network_listeners")},function(e,t){function n(e,t,n,r){for(var o=-1,i=null==e?0:e.length;++o<i;){var u=e[o];t(r,u,n(u),e)}return r}e.exports=n},,function(e,t){function n(e,t,n,r){for(var o=-1,i=null==e?0:e.length;++o<i;){var u=e[o];t(r,u,n(u),e)}return r}e.exports=n},function(e,t){function n(e,t){return null!=e&&o.call(e,t)}var r=Object.prototype,o=r.hasOwnProperty;e.exports=n},,,function(e,t,n){function r(e,t){return function(n,r){var c=a(n)?o:i,f=t?t():{};return c(n,e,u(r,2),f)}}var o=n(360),i=n(362),u=n(31),a=n(10);e.exports=r},function(e,t,n){function r(e){return o(e,i|u)}var o=n(170),i=1,u=4;e.exports=r},function(e,t,n){function r(e,t,n){var r=null==e?void 0:o(e,t);return void 0===r?n:r}var o=n(75);e.exports=r},function(e,t,n){var r=n(29),o=n(366),i=Object.prototype,u=i.hasOwnProperty,a=o(function(e,t,n){u.call(e,n)?e[n].push(t):r(e,n,[t])});e.exports=a},function(e,t,n){function r(e,t){return null!=e&&i(e,t,o)}var o=n(363),i=n(108);e.exports=r},function(e,t,n){function r(e,t,n){return null==e?e:o(e,t,n)}var o=n(107);e.exports=r},function(e,t,n){function r(e,t){return null==e||o(e,t)}var o=n(178);e.exports=r},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=n(12),a=n(11),c=(n(0).get("detection:is_content_blocker_present_feature"),function(e){function t(e){function i(t){e.isContentBlockerPresent().then(function(e){t(e)})}r(this,t);var u=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.i(a.a)("isContentBlockerPresent",i),n.i(a.a)("rerunDetection",function(){e.rerun()}),n.i(a.a)("isAdblocking",i),n.i(a.a)("isAdBlocking",i),u}return i(t,e),t}(u.b));t["default"]=c},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){n(0).get("detection");if(n(214)())n(209).mockApi(["checkState","isAdBlocking","pageChange"]);else{var r=function(){if(window._sp_&&window._sp_.config&&window._sp_.config.runImmediately&&n(215)(),window._sp_&&window._sp_.config){var e=n(207)["default"],t=n(206)["default"];window._sp_.config=e(window._sp_.config),t(window._sp_.config)}var r=n(5)["default"];r.init(r.specs.BASE),(0,n(213)["default"])("detection",[n(205)["default"],n(210)["default"],n(409)["default"],n(211)["default"],n(212)["default"]])};document.getElementById("_sp_override")?r():(0,n(208)["default"])("detection",function(e){if(e)throw new Error("overridden");r()})}}]);
}catch(e){
  console.log('Error occued in Source Point code. ', e);
}
;
(function(SA, $) {

  'use strict';

  var s = SA.UsingNamespace('SA.Utils.TrackingPixel');

  s.track = function(src){
    var resSource = src + ';ord=' + (Math.random() * 10000000000000) + '?';
    $('body').append('<img src="' + resSource + '" width="1" height="1" border="0">');
  };

}(window.SA, window.jQuery));
SA.define('SA.Fn.daysBetween', [], function() {

  'use strict';

  return function(ts) {
    return Math.abs((Date.now() - ts) / (24 * 60 * 60 * 1000));
  };

});
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/roadblock/roadblock_step1"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div id="reg-form">\n  <div class=\'switch login\'> Already Registered?<span class="switch-btn"> Sign in</span><span class="goog-icon" id="log-google">',  googleSvg ,'</span><span class="clearfix"></span></div>\n  <div>\n    <h3> Register for <span>FREE</span> to finish reading this ',  type ,'</h3>\n    <b>',(''+ usersOnSite ).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/'/g, '&#x27;').replace(/\//g,'&#x2F;'),'</b> investors already registered\n  </div>\n  <form id="rb_step1_reg_form" autocomplete="off">\n    <div class="form-group">\n      <input type="email" class="form-control" id="rb_step1_reg_email" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Email Address">\n    </div>\n    <div class="form-group sign-pwd-grp">\n      <input type="password" class="form-control" id="rb_step1_reg_password" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="',  passwordPlaceholder ,'">\n    </div>\n    <div class="error-container">\n      <div id="reg-error" class="alert hidden" role="alert"></div>\n    </div>\n    <div class="btn-grp reg">\n      <input type="submit" id="reg-btn" class="btn reg-orange-btn" value="REGISTER"/>\n    </div>\n  </form>\n\n</div>\n<div class="hidden" id="log-form">\n  <div class="switch reg">Not yet registered? <span class="switch-btn">Register</span></div>\n  <h3>Please sign in:</h3>\n  <form id="rb_step1_login_form" autocomplete="on">\n    <div class="form-group">\n      <input type="email" class="form-control" id="rb_step1_login_email" autocomplete="on" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Email Address">\n    </div>\n    <div class="form-group log-pwd-grp">\n      <input type="password" class="form-control" id="rb_step1_login_password" autocomplete="on" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Password">\n      <div class="frgt-pwd"><a href="#" id="rst-pwd">Forgot password?</a></div>\n    </div>\n    <div class="btn-grp">\n      <input type="submit" id="log-btn" class="btn orange-btn" value="GO!">\n      <input type="submit" class= "btn otl-login" id="one-time-link" value="Email me a sign in link">\n      <div id="log-google" class="goog-btn">\n        ',  googleBtn ,'\n      </div>\n    </div>\n  </form>\n  <form id="rb_forgot_pwd" class="hidden">\n    <div class="form-group">\n      <label for="rb_forgot_pwd_email">Please enter your email address:</label>\n      <input type="email" class="form-control" id="rb_forgot_pwd_email" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">\n      <button type="submit" class="btn btn-link">Submit</button>\n      <div class="sa-loader hidden"></div>\n    </div>\n  </form>\n  <form id="rb_one_click_login" class="hidden">\n    <div class="form-group">\n      <label for="rb_one_click_login_email">Please enter your email address:</label>\n      <input type="email" class="form-control" id="rb_one_click_login_email" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">\n      <button type="submit" class="btn btn-link">Submit</button>\n      <div class="sa-loader hidden"></div>\n    </div>\n  </form>\n  <div id="log-error" class="alert hidden" role="alert"></div>\n</div>\n');}return __p.join('');};
}).call(this);
(function (SA, $) {

  var scope = SA.UsingNamespace('SA.Utils');
  var API_KEY = 'f0966361ed4ac001a9d3b0e6db29707eadeb22bd558df071b64ede90a2892a5c';
  var EXTRA_PARAM = 'SeekingAlpha';

  scope.cryptoAPI = {
    priceMultiFull: function (symbols, currencies) {
      var result = $.Deferred();
      $.get('https://static.seekingalpha.com/cdn/cryptocompare/data/pricemultifull', {
        fsyms: symbols.join(','),
        tsyms: currencies.join(','),
        extraParams: EXTRA_PARAM,
        api_key: API_KEY
      }).then(function (res) {
        result.resolve(res);
      });
      return result;
    },
    historical: function (frequency, symbol, currency, limit, aggregate) {
      // CryptoCompare has max response time span:
      // 80 hours for 'minute' request and 80 days for 'hour'
      var result = $.Deferred();
      $.get('https://static.seekingalpha.com/cdn/cryptocompare/data/histo' + frequency, {
        fsym: symbol,
        tsym: currency,
        limit: limit,
        aggregate: aggregate,
        extraParams: EXTRA_PARAM,
        api_key: API_KEY
      }).then(function (res) {
        result.resolve(res);
      });
      return result;
    },
  };

}(window.SA, window.jQuery));
//! moment.js
//! version : 2.10.6
//! authors : Tim Wood, Iskren Chernev, Moment.js contributors
//! license : MIT
//! momentjs.com
!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):a.moment=b()}(this,function(){"use strict";function a(){return Hc.apply(null,arguments)}function b(a){Hc=a}function c(a){return"[object Array]"===Object.prototype.toString.call(a)}function d(a){return a instanceof Date||"[object Date]"===Object.prototype.toString.call(a)}function e(a,b){var c,d=[];for(c=0;c<a.length;++c)d.push(b(a[c],c));return d}function f(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function g(a,b){for(var c in b)f(b,c)&&(a[c]=b[c]);return f(b,"toString")&&(a.toString=b.toString),f(b,"valueOf")&&(a.valueOf=b.valueOf),a}function h(a,b,c,d){return Ca(a,b,c,d,!0).utc()}function i(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1}}function j(a){return null==a._pf&&(a._pf=i()),a._pf}function k(a){if(null==a._isValid){var b=j(a);a._isValid=!(isNaN(a._d.getTime())||!(b.overflow<0)||b.empty||b.invalidMonth||b.invalidWeekday||b.nullInput||b.invalidFormat||b.userInvalidated),a._strict&&(a._isValid=a._isValid&&0===b.charsLeftOver&&0===b.unusedTokens.length&&void 0===b.bigHour)}return a._isValid}function l(a){var b=h(NaN);return null!=a?g(j(b),a):j(b).userInvalidated=!0,b}function m(a,b){var c,d,e;if("undefined"!=typeof b._isAMomentObject&&(a._isAMomentObject=b._isAMomentObject),"undefined"!=typeof b._i&&(a._i=b._i),"undefined"!=typeof b._f&&(a._f=b._f),"undefined"!=typeof b._l&&(a._l=b._l),"undefined"!=typeof b._strict&&(a._strict=b._strict),"undefined"!=typeof b._tzm&&(a._tzm=b._tzm),"undefined"!=typeof b._isUTC&&(a._isUTC=b._isUTC),"undefined"!=typeof b._offset&&(a._offset=b._offset),"undefined"!=typeof b._pf&&(a._pf=j(b)),"undefined"!=typeof b._locale&&(a._locale=b._locale),Jc.length>0)for(c in Jc)d=Jc[c],e=b[d],"undefined"!=typeof e&&(a[d]=e);return a}function n(b){m(this,b),this._d=new Date(null!=b._d?b._d.getTime():NaN),Kc===!1&&(Kc=!0,a.updateOffset(this),Kc=!1)}function o(a){return a instanceof n||null!=a&&null!=a._isAMomentObject}function p(a){return 0>a?Math.ceil(a):Math.floor(a)}function q(a){var b=+a,c=0;return 0!==b&&isFinite(b)&&(c=p(b)),c}function r(a,b,c){var d,e=Math.min(a.length,b.length),f=Math.abs(a.length-b.length),g=0;for(d=0;e>d;d++)(c&&a[d]!==b[d]||!c&&q(a[d])!==q(b[d]))&&g++;return g+f}function s(){}function t(a){return a?a.toLowerCase().replace("_","-"):a}function u(a){for(var b,c,d,e,f=0;f<a.length;){for(e=t(a[f]).split("-"),b=e.length,c=t(a[f+1]),c=c?c.split("-"):null;b>0;){if(d=v(e.slice(0,b).join("-")))return d;if(c&&c.length>=b&&r(e,c,!0)>=b-1)break;b--}f++}return null}function v(a){var b=null;if(!Lc[a]&&"undefined"!=typeof module&&module&&module.exports)try{b=Ic._abbr,require("./locale/"+a),w(b)}catch(c){}return Lc[a]}function w(a,b){var c;return a&&(c="undefined"==typeof b?y(a):x(a,b),c&&(Ic=c)),Ic._abbr}function x(a,b){return null!==b?(b.abbr=a,Lc[a]=Lc[a]||new s,Lc[a].set(b),w(a),Lc[a]):(delete Lc[a],null)}function y(a){var b;if(a&&a._locale&&a._locale._abbr&&(a=a._locale._abbr),!a)return Ic;if(!c(a)){if(b=v(a))return b;a=[a]}return u(a)}function z(a,b){var c=a.toLowerCase();Mc[c]=Mc[c+"s"]=Mc[b]=a}function A(a){return"string"==typeof a?Mc[a]||Mc[a.toLowerCase()]:void 0}function B(a){var b,c,d={};for(c in a)f(a,c)&&(b=A(c),b&&(d[b]=a[c]));return d}function C(b,c){return function(d){return null!=d?(E(this,b,d),a.updateOffset(this,c),this):D(this,b)}}function D(a,b){return a._d["get"+(a._isUTC?"UTC":"")+b]()}function E(a,b,c){return a._d["set"+(a._isUTC?"UTC":"")+b](c)}function F(a,b){var c;if("object"==typeof a)for(c in a)this.set(c,a[c]);else if(a=A(a),"function"==typeof this[a])return this[a](b);return this}function G(a,b,c){var d=""+Math.abs(a),e=b-d.length,f=a>=0;return(f?c?"+":"":"-")+Math.pow(10,Math.max(0,e)).toString().substr(1)+d}function H(a,b,c,d){var e=d;"string"==typeof d&&(e=function(){return this[d]()}),a&&(Qc[a]=e),b&&(Qc[b[0]]=function(){return G(e.apply(this,arguments),b[1],b[2])}),c&&(Qc[c]=function(){return this.localeData().ordinal(e.apply(this,arguments),a)})}function I(a){return a.match(/\[[\s\S]/)?a.replace(/^\[|\]$/g,""):a.replace(/\\/g,"")}function J(a){var b,c,d=a.match(Nc);for(b=0,c=d.length;c>b;b++)Qc[d[b]]?d[b]=Qc[d[b]]:d[b]=I(d[b]);return function(e){var f="";for(b=0;c>b;b++)f+=d[b]instanceof Function?d[b].call(e,a):d[b];return f}}function K(a,b){return a.isValid()?(b=L(b,a.localeData()),Pc[b]=Pc[b]||J(b),Pc[b](a)):a.localeData().invalidDate()}function L(a,b){function c(a){return b.longDateFormat(a)||a}var d=5;for(Oc.lastIndex=0;d>=0&&Oc.test(a);)a=a.replace(Oc,c),Oc.lastIndex=0,d-=1;return a}function M(a){return"function"==typeof a&&"[object Function]"===Object.prototype.toString.call(a)}function N(a,b,c){dd[a]=M(b)?b:function(a){return a&&c?c:b}}function O(a,b){return f(dd,a)?dd[a](b._strict,b._locale):new RegExp(P(a))}function P(a){return a.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(a,b,c,d,e){return b||c||d||e}).replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function Q(a,b){var c,d=b;for("string"==typeof a&&(a=[a]),"number"==typeof b&&(d=function(a,c){c[b]=q(a)}),c=0;c<a.length;c++)ed[a[c]]=d}function R(a,b){Q(a,function(a,c,d,e){d._w=d._w||{},b(a,d._w,d,e)})}function S(a,b,c){null!=b&&f(ed,a)&&ed[a](b,c._a,c,a)}function T(a,b){return new Date(Date.UTC(a,b+1,0)).getUTCDate()}function U(a){return this._months[a.month()]}function V(a){return this._monthsShort[a.month()]}function W(a,b,c){var d,e,f;for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),d=0;12>d;d++){if(e=h([2e3,d]),c&&!this._longMonthsParse[d]&&(this._longMonthsParse[d]=new RegExp("^"+this.months(e,"").replace(".","")+"$","i"),this._shortMonthsParse[d]=new RegExp("^"+this.monthsShort(e,"").replace(".","")+"$","i")),c||this._monthsParse[d]||(f="^"+this.months(e,"")+"|^"+this.monthsShort(e,""),this._monthsParse[d]=new RegExp(f.replace(".",""),"i")),c&&"MMMM"===b&&this._longMonthsParse[d].test(a))return d;if(c&&"MMM"===b&&this._shortMonthsParse[d].test(a))return d;if(!c&&this._monthsParse[d].test(a))return d}}function X(a,b){var c;return"string"==typeof b&&(b=a.localeData().monthsParse(b),"number"!=typeof b)?a:(c=Math.min(a.date(),T(a.year(),b)),a._d["set"+(a._isUTC?"UTC":"")+"Month"](b,c),a)}function Y(b){return null!=b?(X(this,b),a.updateOffset(this,!0),this):D(this,"Month")}function Z(){return T(this.year(),this.month())}function $(a){var b,c=a._a;return c&&-2===j(a).overflow&&(b=c[gd]<0||c[gd]>11?gd:c[hd]<1||c[hd]>T(c[fd],c[gd])?hd:c[id]<0||c[id]>24||24===c[id]&&(0!==c[jd]||0!==c[kd]||0!==c[ld])?id:c[jd]<0||c[jd]>59?jd:c[kd]<0||c[kd]>59?kd:c[ld]<0||c[ld]>999?ld:-1,j(a)._overflowDayOfYear&&(fd>b||b>hd)&&(b=hd),j(a).overflow=b),a}function _(b){a.suppressDeprecationWarnings===!1&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+b)}function aa(a,b){var c=!0;return g(function(){return c&&(_(a+"\n"+(new Error).stack),c=!1),b.apply(this,arguments)},b)}function ba(a,b){od[a]||(_(b),od[a]=!0)}function ca(a){var b,c,d=a._i,e=pd.exec(d);if(e){for(j(a).iso=!0,b=0,c=qd.length;c>b;b++)if(qd[b][1].exec(d)){a._f=qd[b][0];break}for(b=0,c=rd.length;c>b;b++)if(rd[b][1].exec(d)){a._f+=(e[6]||" ")+rd[b][0];break}d.match(ad)&&(a._f+="Z"),va(a)}else a._isValid=!1}function da(b){var c=sd.exec(b._i);return null!==c?void(b._d=new Date(+c[1])):(ca(b),void(b._isValid===!1&&(delete b._isValid,a.createFromInputFallback(b))))}function ea(a,b,c,d,e,f,g){var h=new Date(a,b,c,d,e,f,g);return 1970>a&&h.setFullYear(a),h}function fa(a){var b=new Date(Date.UTC.apply(null,arguments));return 1970>a&&b.setUTCFullYear(a),b}function ga(a){return ha(a)?366:365}function ha(a){return a%4===0&&a%100!==0||a%400===0}function ia(){return ha(this.year())}function ja(a,b,c){var d,e=c-b,f=c-a.day();return f>e&&(f-=7),e-7>f&&(f+=7),d=Da(a).add(f,"d"),{week:Math.ceil(d.dayOfYear()/7),year:d.year()}}function ka(a){return ja(a,this._week.dow,this._week.doy).week}function la(){return this._week.dow}function ma(){return this._week.doy}function na(a){var b=this.localeData().week(this);return null==a?b:this.add(7*(a-b),"d")}function oa(a){var b=ja(this,1,4).week;return null==a?b:this.add(7*(a-b),"d")}function pa(a,b,c,d,e){var f,g=6+e-d,h=fa(a,0,1+g),i=h.getUTCDay();return e>i&&(i+=7),c=null!=c?1*c:e,f=1+g+7*(b-1)-i+c,{year:f>0?a:a-1,dayOfYear:f>0?f:ga(a-1)+f}}function qa(a){var b=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return null==a?b:this.add(a-b,"d")}function ra(a,b,c){return null!=a?a:null!=b?b:c}function sa(a){var b=new Date;return a._useUTC?[b.getUTCFullYear(),b.getUTCMonth(),b.getUTCDate()]:[b.getFullYear(),b.getMonth(),b.getDate()]}function ta(a){var b,c,d,e,f=[];if(!a._d){for(d=sa(a),a._w&&null==a._a[hd]&&null==a._a[gd]&&ua(a),a._dayOfYear&&(e=ra(a._a[fd],d[fd]),a._dayOfYear>ga(e)&&(j(a)._overflowDayOfYear=!0),c=fa(e,0,a._dayOfYear),a._a[gd]=c.getUTCMonth(),a._a[hd]=c.getUTCDate()),b=0;3>b&&null==a._a[b];++b)a._a[b]=f[b]=d[b];for(;7>b;b++)a._a[b]=f[b]=null==a._a[b]?2===b?1:0:a._a[b];24===a._a[id]&&0===a._a[jd]&&0===a._a[kd]&&0===a._a[ld]&&(a._nextDay=!0,a._a[id]=0),a._d=(a._useUTC?fa:ea).apply(null,f),null!=a._tzm&&a._d.setUTCMinutes(a._d.getUTCMinutes()-a._tzm),a._nextDay&&(a._a[id]=24)}}function ua(a){var b,c,d,e,f,g,h;b=a._w,null!=b.GG||null!=b.W||null!=b.E?(f=1,g=4,c=ra(b.GG,a._a[fd],ja(Da(),1,4).year),d=ra(b.W,1),e=ra(b.E,1)):(f=a._locale._week.dow,g=a._locale._week.doy,c=ra(b.gg,a._a[fd],ja(Da(),f,g).year),d=ra(b.w,1),null!=b.d?(e=b.d,f>e&&++d):e=null!=b.e?b.e+f:f),h=pa(c,d,e,g,f),a._a[fd]=h.year,a._dayOfYear=h.dayOfYear}function va(b){if(b._f===a.ISO_8601)return void ca(b);b._a=[],j(b).empty=!0;var c,d,e,f,g,h=""+b._i,i=h.length,k=0;for(e=L(b._f,b._locale).match(Nc)||[],c=0;c<e.length;c++)f=e[c],d=(h.match(O(f,b))||[])[0],d&&(g=h.substr(0,h.indexOf(d)),g.length>0&&j(b).unusedInput.push(g),h=h.slice(h.indexOf(d)+d.length),k+=d.length),Qc[f]?(d?j(b).empty=!1:j(b).unusedTokens.push(f),S(f,d,b)):b._strict&&!d&&j(b).unusedTokens.push(f);j(b).charsLeftOver=i-k,h.length>0&&j(b).unusedInput.push(h),j(b).bigHour===!0&&b._a[id]<=12&&b._a[id]>0&&(j(b).bigHour=void 0),b._a[id]=wa(b._locale,b._a[id],b._meridiem),ta(b),$(b)}function wa(a,b,c){var d;return null==c?b:null!=a.meridiemHour?a.meridiemHour(b,c):null!=a.isPM?(d=a.isPM(c),d&&12>b&&(b+=12),d||12!==b||(b=0),b):b}function xa(a){var b,c,d,e,f;if(0===a._f.length)return j(a).invalidFormat=!0,void(a._d=new Date(NaN));for(e=0;e<a._f.length;e++)f=0,b=m({},a),null!=a._useUTC&&(b._useUTC=a._useUTC),b._f=a._f[e],va(b),k(b)&&(f+=j(b).charsLeftOver,f+=10*j(b).unusedTokens.length,j(b).score=f,(null==d||d>f)&&(d=f,c=b));g(a,c||b)}function ya(a){if(!a._d){var b=B(a._i);a._a=[b.year,b.month,b.day||b.date,b.hour,b.minute,b.second,b.millisecond],ta(a)}}function za(a){var b=new n($(Aa(a)));return b._nextDay&&(b.add(1,"d"),b._nextDay=void 0),b}function Aa(a){var b=a._i,e=a._f;return a._locale=a._locale||y(a._l),null===b||void 0===e&&""===b?l({nullInput:!0}):("string"==typeof b&&(a._i=b=a._locale.preparse(b)),o(b)?new n($(b)):(c(e)?xa(a):e?va(a):d(b)?a._d=b:Ba(a),a))}function Ba(b){var f=b._i;void 0===f?b._d=new Date:d(f)?b._d=new Date(+f):"string"==typeof f?da(b):c(f)?(b._a=e(f.slice(0),function(a){return parseInt(a,10)}),ta(b)):"object"==typeof f?ya(b):"number"==typeof f?b._d=new Date(f):a.createFromInputFallback(b)}function Ca(a,b,c,d,e){var f={};return"boolean"==typeof c&&(d=c,c=void 0),f._isAMomentObject=!0,f._useUTC=f._isUTC=e,f._l=c,f._i=a,f._f=b,f._strict=d,za(f)}function Da(a,b,c,d){return Ca(a,b,c,d,!1)}function Ea(a,b){var d,e;if(1===b.length&&c(b[0])&&(b=b[0]),!b.length)return Da();for(d=b[0],e=1;e<b.length;++e)(!b[e].isValid()||b[e][a](d))&&(d=b[e]);return d}function Fa(){var a=[].slice.call(arguments,0);return Ea("isBefore",a)}function Ga(){var a=[].slice.call(arguments,0);return Ea("isAfter",a)}function Ha(a){var b=B(a),c=b.year||0,d=b.quarter||0,e=b.month||0,f=b.week||0,g=b.day||0,h=b.hour||0,i=b.minute||0,j=b.second||0,k=b.millisecond||0;this._milliseconds=+k+1e3*j+6e4*i+36e5*h,this._days=+g+7*f,this._months=+e+3*d+12*c,this._data={},this._locale=y(),this._bubble()}function Ia(a){return a instanceof Ha}function Ja(a,b){H(a,0,0,function(){var a=this.utcOffset(),c="+";return 0>a&&(a=-a,c="-"),c+G(~~(a/60),2)+b+G(~~a%60,2)})}function Ka(a){var b=(a||"").match(ad)||[],c=b[b.length-1]||[],d=(c+"").match(xd)||["-",0,0],e=+(60*d[1])+q(d[2]);return"+"===d[0]?e:-e}function La(b,c){var e,f;return c._isUTC?(e=c.clone(),f=(o(b)||d(b)?+b:+Da(b))-+e,e._d.setTime(+e._d+f),a.updateOffset(e,!1),e):Da(b).local()}function Ma(a){return 15*-Math.round(a._d.getTimezoneOffset()/15)}function Na(b,c){var d,e=this._offset||0;return null!=b?("string"==typeof b&&(b=Ka(b)),Math.abs(b)<16&&(b=60*b),!this._isUTC&&c&&(d=Ma(this)),this._offset=b,this._isUTC=!0,null!=d&&this.add(d,"m"),e!==b&&(!c||this._changeInProgress?bb(this,Ya(b-e,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,a.updateOffset(this,!0),this._changeInProgress=null)),this):this._isUTC?e:Ma(this)}function Oa(a,b){return null!=a?("string"!=typeof a&&(a=-a),this.utcOffset(a,b),this):-this.utcOffset()}function Pa(a){return this.utcOffset(0,a)}function Qa(a){return this._isUTC&&(this.utcOffset(0,a),this._isUTC=!1,a&&this.subtract(Ma(this),"m")),this}function Ra(){return this._tzm?this.utcOffset(this._tzm):"string"==typeof this._i&&this.utcOffset(Ka(this._i)),this}function Sa(a){return a=a?Da(a).utcOffset():0,(this.utcOffset()-a)%60===0}function Ta(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function Ua(){if("undefined"!=typeof this._isDSTShifted)return this._isDSTShifted;var a={};if(m(a,this),a=Aa(a),a._a){var b=a._isUTC?h(a._a):Da(a._a);this._isDSTShifted=this.isValid()&&r(a._a,b.toArray())>0}else this._isDSTShifted=!1;return this._isDSTShifted}function Va(){return!this._isUTC}function Wa(){return this._isUTC}function Xa(){return this._isUTC&&0===this._offset}function Ya(a,b){var c,d,e,g=a,h=null;return Ia(a)?g={ms:a._milliseconds,d:a._days,M:a._months}:"number"==typeof a?(g={},b?g[b]=a:g.milliseconds=a):(h=yd.exec(a))?(c="-"===h[1]?-1:1,g={y:0,d:q(h[hd])*c,h:q(h[id])*c,m:q(h[jd])*c,s:q(h[kd])*c,ms:q(h[ld])*c}):(h=zd.exec(a))?(c="-"===h[1]?-1:1,g={y:Za(h[2],c),M:Za(h[3],c),d:Za(h[4],c),h:Za(h[5],c),m:Za(h[6],c),s:Za(h[7],c),w:Za(h[8],c)}):null==g?g={}:"object"==typeof g&&("from"in g||"to"in g)&&(e=_a(Da(g.from),Da(g.to)),g={},g.ms=e.milliseconds,g.M=e.months),d=new Ha(g),Ia(a)&&f(a,"_locale")&&(d._locale=a._locale),d}function Za(a,b){var c=a&&parseFloat(a.replace(",","."));return(isNaN(c)?0:c)*b}function $a(a,b){var c={milliseconds:0,months:0};return c.months=b.month()-a.month()+12*(b.year()-a.year()),a.clone().add(c.months,"M").isAfter(b)&&--c.months,c.milliseconds=+b-+a.clone().add(c.months,"M"),c}function _a(a,b){var c;return b=La(b,a),a.isBefore(b)?c=$a(a,b):(c=$a(b,a),c.milliseconds=-c.milliseconds,c.months=-c.months),c}function ab(a,b){return function(c,d){var e,f;return null===d||isNaN(+d)||(ba(b,"moment()."+b+"(period, number) is deprecated. Please use moment()."+b+"(number, period)."),f=c,c=d,d=f),c="string"==typeof c?+c:c,e=Ya(c,d),bb(this,e,a),this}}function bb(b,c,d,e){var f=c._milliseconds,g=c._days,h=c._months;e=null==e?!0:e,f&&b._d.setTime(+b._d+f*d),g&&E(b,"Date",D(b,"Date")+g*d),h&&X(b,D(b,"Month")+h*d),e&&a.updateOffset(b,g||h)}function cb(a,b){var c=a||Da(),d=La(c,this).startOf("day"),e=this.diff(d,"days",!0),f=-6>e?"sameElse":-1>e?"lastWeek":0>e?"lastDay":1>e?"sameDay":2>e?"nextDay":7>e?"nextWeek":"sameElse";return this.format(b&&b[f]||this.localeData().calendar(f,this,Da(c)))}function db(){return new n(this)}function eb(a,b){var c;return b=A("undefined"!=typeof b?b:"millisecond"),"millisecond"===b?(a=o(a)?a:Da(a),+this>+a):(c=o(a)?+a:+Da(a),c<+this.clone().startOf(b))}function fb(a,b){var c;return b=A("undefined"!=typeof b?b:"millisecond"),"millisecond"===b?(a=o(a)?a:Da(a),+a>+this):(c=o(a)?+a:+Da(a),+this.clone().endOf(b)<c)}function gb(a,b,c){return this.isAfter(a,c)&&this.isBefore(b,c)}function hb(a,b){var c;return b=A(b||"millisecond"),"millisecond"===b?(a=o(a)?a:Da(a),+this===+a):(c=+Da(a),+this.clone().startOf(b)<=c&&c<=+this.clone().endOf(b))}function ib(a,b,c){var d,e,f=La(a,this),g=6e4*(f.utcOffset()-this.utcOffset());return b=A(b),"year"===b||"month"===b||"quarter"===b?(e=jb(this,f),"quarter"===b?e/=3:"year"===b&&(e/=12)):(d=this-f,e="second"===b?d/1e3:"minute"===b?d/6e4:"hour"===b?d/36e5:"day"===b?(d-g)/864e5:"week"===b?(d-g)/6048e5:d),c?e:p(e)}function jb(a,b){var c,d,e=12*(b.year()-a.year())+(b.month()-a.month()),f=a.clone().add(e,"months");return 0>b-f?(c=a.clone().add(e-1,"months"),d=(b-f)/(f-c)):(c=a.clone().add(e+1,"months"),d=(b-f)/(c-f)),-(e+d)}function kb(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function lb(){var a=this.clone().utc();return 0<a.year()&&a.year()<=9999?"function"==typeof Date.prototype.toISOString?this.toDate().toISOString():K(a,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):K(a,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")}function mb(b){var c=K(this,b||a.defaultFormat);return this.localeData().postformat(c)}function nb(a,b){return this.isValid()?Ya({to:this,from:a}).locale(this.locale()).humanize(!b):this.localeData().invalidDate()}function ob(a){return this.from(Da(),a)}function pb(a,b){return this.isValid()?Ya({from:this,to:a}).locale(this.locale()).humanize(!b):this.localeData().invalidDate()}function qb(a){return this.to(Da(),a)}function rb(a){var b;return void 0===a?this._locale._abbr:(b=y(a),null!=b&&(this._locale=b),this)}function sb(){return this._locale}function tb(a){switch(a=A(a)){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===a&&this.weekday(0),"isoWeek"===a&&this.isoWeekday(1),"quarter"===a&&this.month(3*Math.floor(this.month()/3)),this}function ub(a){return a=A(a),void 0===a||"millisecond"===a?this:this.startOf(a).add(1,"isoWeek"===a?"week":a).subtract(1,"ms")}function vb(){return+this._d-6e4*(this._offset||0)}function wb(){return Math.floor(+this/1e3)}function xb(){return this._offset?new Date(+this):this._d}function yb(){var a=this;return[a.year(),a.month(),a.date(),a.hour(),a.minute(),a.second(),a.millisecond()]}function zb(){var a=this;return{years:a.year(),months:a.month(),date:a.date(),hours:a.hours(),minutes:a.minutes(),seconds:a.seconds(),milliseconds:a.milliseconds()}}function Ab(){return k(this)}function Bb(){return g({},j(this))}function Cb(){return j(this).overflow}function Db(a,b){H(0,[a,a.length],0,b)}function Eb(a,b,c){return ja(Da([a,11,31+b-c]),b,c).week}function Fb(a){var b=ja(this,this.localeData()._week.dow,this.localeData()._week.doy).year;return null==a?b:this.add(a-b,"y")}function Gb(a){var b=ja(this,1,4).year;return null==a?b:this.add(a-b,"y")}function Hb(){return Eb(this.year(),1,4)}function Ib(){var a=this.localeData()._week;return Eb(this.year(),a.dow,a.doy)}function Jb(a){return null==a?Math.ceil((this.month()+1)/3):this.month(3*(a-1)+this.month()%3)}function Kb(a,b){return"string"!=typeof a?a:isNaN(a)?(a=b.weekdaysParse(a),"number"==typeof a?a:null):parseInt(a,10)}function Lb(a){return this._weekdays[a.day()]}function Mb(a){return this._weekdaysShort[a.day()]}function Nb(a){return this._weekdaysMin[a.day()]}function Ob(a){var b,c,d;for(this._weekdaysParse=this._weekdaysParse||[],b=0;7>b;b++)if(this._weekdaysParse[b]||(c=Da([2e3,1]).day(b),d="^"+this.weekdays(c,"")+"|^"+this.weekdaysShort(c,"")+"|^"+this.weekdaysMin(c,""),this._weekdaysParse[b]=new RegExp(d.replace(".",""),"i")),this._weekdaysParse[b].test(a))return b}function Pb(a){var b=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=a?(a=Kb(a,this.localeData()),this.add(a-b,"d")):b}function Qb(a){var b=(this.day()+7-this.localeData()._week.dow)%7;return null==a?b:this.add(a-b,"d")}function Rb(a){return null==a?this.day()||7:this.day(this.day()%7?a:a-7)}function Sb(a,b){H(a,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),b)})}function Tb(a,b){return b._meridiemParse}function Ub(a){return"p"===(a+"").toLowerCase().charAt(0)}function Vb(a,b,c){return a>11?c?"pm":"PM":c?"am":"AM"}function Wb(a,b){b[ld]=q(1e3*("0."+a))}function Xb(){return this._isUTC?"UTC":""}function Yb(){return this._isUTC?"Coordinated Universal Time":""}function Zb(a){return Da(1e3*a)}function $b(){return Da.apply(null,arguments).parseZone()}function _b(a,b,c){var d=this._calendar[a];return"function"==typeof d?d.call(b,c):d}function ac(a){var b=this._longDateFormat[a],c=this._longDateFormat[a.toUpperCase()];return b||!c?b:(this._longDateFormat[a]=c.replace(/MMMM|MM|DD|dddd/g,function(a){return a.slice(1)}),this._longDateFormat[a])}function bc(){return this._invalidDate}function cc(a){return this._ordinal.replace("%d",a)}function dc(a){return a}function ec(a,b,c,d){var e=this._relativeTime[c];return"function"==typeof e?e(a,b,c,d):e.replace(/%d/i,a)}function fc(a,b){var c=this._relativeTime[a>0?"future":"past"];return"function"==typeof c?c(b):c.replace(/%s/i,b)}function gc(a){var b,c;for(c in a)b=a[c],"function"==typeof b?this[c]=b:this["_"+c]=b;this._ordinalParseLenient=new RegExp(this._ordinalParse.source+"|"+/\d{1,2}/.source)}function hc(a,b,c,d){var e=y(),f=h().set(d,b);return e[c](f,a)}function ic(a,b,c,d,e){if("number"==typeof a&&(b=a,a=void 0),a=a||"",null!=b)return hc(a,b,c,e);var f,g=[];for(f=0;d>f;f++)g[f]=hc(a,f,c,e);return g}function jc(a,b){return ic(a,b,"months",12,"month")}function kc(a,b){return ic(a,b,"monthsShort",12,"month")}function lc(a,b){return ic(a,b,"weekdays",7,"day")}function mc(a,b){return ic(a,b,"weekdaysShort",7,"day")}function nc(a,b){return ic(a,b,"weekdaysMin",7,"day")}function oc(){var a=this._data;return this._milliseconds=Wd(this._milliseconds),this._days=Wd(this._days),this._months=Wd(this._months),a.milliseconds=Wd(a.milliseconds),a.seconds=Wd(a.seconds),a.minutes=Wd(a.minutes),a.hours=Wd(a.hours),a.months=Wd(a.months),a.years=Wd(a.years),this}function pc(a,b,c,d){var e=Ya(b,c);return a._milliseconds+=d*e._milliseconds,a._days+=d*e._days,a._months+=d*e._months,a._bubble()}function qc(a,b){return pc(this,a,b,1)}function rc(a,b){return pc(this,a,b,-1)}function sc(a){return 0>a?Math.floor(a):Math.ceil(a)}function tc(){var a,b,c,d,e,f=this._milliseconds,g=this._days,h=this._months,i=this._data;return f>=0&&g>=0&&h>=0||0>=f&&0>=g&&0>=h||(f+=864e5*sc(vc(h)+g),g=0,h=0),i.milliseconds=f%1e3,a=p(f/1e3),i.seconds=a%60,b=p(a/60),i.minutes=b%60,c=p(b/60),i.hours=c%24,g+=p(c/24),e=p(uc(g)),h+=e,g-=sc(vc(e)),d=p(h/12),h%=12,i.days=g,i.months=h,i.years=d,this}function uc(a){return 4800*a/146097}function vc(a){return 146097*a/4800}function wc(a){var b,c,d=this._milliseconds;if(a=A(a),"month"===a||"year"===a)return b=this._days+d/864e5,c=this._months+uc(b),"month"===a?c:c/12;switch(b=this._days+Math.round(vc(this._months)),a){case"week":return b/7+d/6048e5;case"day":return b+d/864e5;case"hour":return 24*b+d/36e5;case"minute":return 1440*b+d/6e4;case"second":return 86400*b+d/1e3;case"millisecond":return Math.floor(864e5*b)+d;default:throw new Error("Unknown unit "+a)}}function xc(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*q(this._months/12)}function yc(a){return function(){return this.as(a)}}function zc(a){return a=A(a),this[a+"s"]()}function Ac(a){return function(){return this._data[a]}}function Bc(){return p(this.days()/7)}function Cc(a,b,c,d,e){return e.relativeTime(b||1,!!c,a,d)}function Dc(a,b,c){var d=Ya(a).abs(),e=ke(d.as("s")),f=ke(d.as("m")),g=ke(d.as("h")),h=ke(d.as("d")),i=ke(d.as("M")),j=ke(d.as("y")),k=e<le.s&&["s",e]||1===f&&["m"]||f<le.m&&["mm",f]||1===g&&["h"]||g<le.h&&["hh",g]||1===h&&["d"]||h<le.d&&["dd",h]||1===i&&["M"]||i<le.M&&["MM",i]||1===j&&["y"]||["yy",j];return k[2]=b,k[3]=+a>0,k[4]=c,Cc.apply(null,k)}function Ec(a,b){return void 0===le[a]?!1:void 0===b?le[a]:(le[a]=b,!0)}function Fc(a){var b=this.localeData(),c=Dc(this,!a,b);return a&&(c=b.pastFuture(+this,c)),b.postformat(c)}function Gc(){var a,b,c,d=me(this._milliseconds)/1e3,e=me(this._days),f=me(this._months);a=p(d/60),b=p(a/60),d%=60,a%=60,c=p(f/12),f%=12;var g=c,h=f,i=e,j=b,k=a,l=d,m=this.asSeconds();return m?(0>m?"-":"")+"P"+(g?g+"Y":"")+(h?h+"M":"")+(i?i+"D":"")+(j||k||l?"T":"")+(j?j+"H":"")+(k?k+"M":"")+(l?l+"S":""):"P0D"}var Hc,Ic,Jc=a.momentProperties=[],Kc=!1,Lc={},Mc={},Nc=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Q|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,Oc=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,Pc={},Qc={},Rc=/\d/,Sc=/\d\d/,Tc=/\d{3}/,Uc=/\d{4}/,Vc=/[+-]?\d{6}/,Wc=/\d\d?/,Xc=/\d{1,3}/,Yc=/\d{1,4}/,Zc=/[+-]?\d{1,6}/,$c=/\d+/,_c=/[+-]?\d+/,ad=/Z|[+-]\d\d:?\d\d/gi,bd=/[+-]?\d+(\.\d{1,3})?/,cd=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,dd={},ed={},fd=0,gd=1,hd=2,id=3,jd=4,kd=5,ld=6;H("M",["MM",2],"Mo",function(){return this.month()+1}),H("MMM",0,0,function(a){return this.localeData().monthsShort(this,a)}),H("MMMM",0,0,function(a){return this.localeData().months(this,a)}),z("month","M"),N("M",Wc),N("MM",Wc,Sc),N("MMM",cd),N("MMMM",cd),Q(["M","MM"],function(a,b){b[gd]=q(a)-1}),Q(["MMM","MMMM"],function(a,b,c,d){var e=c._locale.monthsParse(a,d,c._strict);null!=e?b[gd]=e:j(c).invalidMonth=a});var md="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),nd="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),od={};a.suppressDeprecationWarnings=!1;var pd=/^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,qd=[["YYYYYY-MM-DD",/[+-]\d{6}-\d{2}-\d{2}/],["YYYY-MM-DD",/\d{4}-\d{2}-\d{2}/],["GGGG-[W]WW-E",/\d{4}-W\d{2}-\d/],["GGGG-[W]WW",/\d{4}-W\d{2}/],["YYYY-DDD",/\d{4}-\d{3}/]],rd=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],sd=/^\/?Date\((\-?\d+)/i;a.createFromInputFallback=aa("moment construction falls back to js Date. This is discouraged and will be removed in upcoming major release. Please refer to https://github.com/moment/moment/issues/1407 for more info.",function(a){a._d=new Date(a._i+(a._useUTC?" UTC":""))}),H(0,["YY",2],0,function(){return this.year()%100}),H(0,["YYYY",4],0,"year"),H(0,["YYYYY",5],0,"year"),H(0,["YYYYYY",6,!0],0,"year"),z("year","y"),N("Y",_c),N("YY",Wc,Sc),N("YYYY",Yc,Uc),N("YYYYY",Zc,Vc),N("YYYYYY",Zc,Vc),Q(["YYYYY","YYYYYY"],fd),Q("YYYY",function(b,c){c[fd]=2===b.length?a.parseTwoDigitYear(b):q(b)}),Q("YY",function(b,c){c[fd]=a.parseTwoDigitYear(b)}),a.parseTwoDigitYear=function(a){return q(a)+(q(a)>68?1900:2e3)};var td=C("FullYear",!1);H("w",["ww",2],"wo","week"),H("W",["WW",2],"Wo","isoWeek"),z("week","w"),z("isoWeek","W"),N("w",Wc),N("ww",Wc,Sc),N("W",Wc),N("WW",Wc,Sc),R(["w","ww","W","WW"],function(a,b,c,d){b[d.substr(0,1)]=q(a)});var ud={dow:0,doy:6};H("DDD",["DDDD",3],"DDDo","dayOfYear"),z("dayOfYear","DDD"),N("DDD",Xc),N("DDDD",Tc),Q(["DDD","DDDD"],function(a,b,c){c._dayOfYear=q(a)}),a.ISO_8601=function(){};var vd=aa("moment().min is deprecated, use moment.min instead. https://github.com/moment/moment/issues/1548",function(){var a=Da.apply(null,arguments);return this>a?this:a}),wd=aa("moment().max is deprecated, use moment.max instead. https://github.com/moment/moment/issues/1548",function(){var a=Da.apply(null,arguments);return a>this?this:a});Ja("Z",":"),Ja("ZZ",""),N("Z",ad),N("ZZ",ad),Q(["Z","ZZ"],function(a,b,c){c._useUTC=!0,c._tzm=Ka(a)});var xd=/([\+\-]|\d\d)/gi;a.updateOffset=function(){};var yd=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,zd=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/;Ya.fn=Ha.prototype;var Ad=ab(1,"add"),Bd=ab(-1,"subtract");a.defaultFormat="YYYY-MM-DDTHH:mm:ssZ";var Cd=aa("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(a){return void 0===a?this.localeData():this.locale(a)});H(0,["gg",2],0,function(){return this.weekYear()%100}),H(0,["GG",2],0,function(){return this.isoWeekYear()%100}),Db("gggg","weekYear"),Db("ggggg","weekYear"),Db("GGGG","isoWeekYear"),Db("GGGGG","isoWeekYear"),z("weekYear","gg"),z("isoWeekYear","GG"),N("G",_c),N("g",_c),N("GG",Wc,Sc),N("gg",Wc,Sc),N("GGGG",Yc,Uc),N("gggg",Yc,Uc),N("GGGGG",Zc,Vc),N("ggggg",Zc,Vc),R(["gggg","ggggg","GGGG","GGGGG"],function(a,b,c,d){b[d.substr(0,2)]=q(a)}),R(["gg","GG"],function(b,c,d,e){c[e]=a.parseTwoDigitYear(b)}),H("Q",0,0,"quarter"),z("quarter","Q"),N("Q",Rc),Q("Q",function(a,b){b[gd]=3*(q(a)-1)}),H("D",["DD",2],"Do","date"),z("date","D"),N("D",Wc),N("DD",Wc,Sc),N("Do",function(a,b){return a?b._ordinalParse:b._ordinalParseLenient}),Q(["D","DD"],hd),Q("Do",function(a,b){b[hd]=q(a.match(Wc)[0],10)});var Dd=C("Date",!0);H("d",0,"do","day"),H("dd",0,0,function(a){return this.localeData().weekdaysMin(this,a)}),H("ddd",0,0,function(a){return this.localeData().weekdaysShort(this,a)}),H("dddd",0,0,function(a){return this.localeData().weekdays(this,a)}),H("e",0,0,"weekday"),H("E",0,0,"isoWeekday"),z("day","d"),z("weekday","e"),z("isoWeekday","E"),N("d",Wc),N("e",Wc),N("E",Wc),N("dd",cd),N("ddd",cd),N("dddd",cd),R(["dd","ddd","dddd"],function(a,b,c){var d=c._locale.weekdaysParse(a);null!=d?b.d=d:j(c).invalidWeekday=a}),R(["d","e","E"],function(a,b,c,d){b[d]=q(a)});var Ed="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),Fd="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),Gd="Su_Mo_Tu_We_Th_Fr_Sa".split("_");H("H",["HH",2],0,"hour"),H("h",["hh",2],0,function(){return this.hours()%12||12}),Sb("a",!0),Sb("A",!1),z("hour","h"),N("a",Tb),N("A",Tb),N("H",Wc),N("h",Wc),N("HH",Wc,Sc),N("hh",Wc,Sc),Q(["H","HH"],id),Q(["a","A"],function(a,b,c){c._isPm=c._locale.isPM(a),c._meridiem=a}),Q(["h","hh"],function(a,b,c){b[id]=q(a),j(c).bigHour=!0});var Hd=/[ap]\.?m?\.?/i,Id=C("Hours",!0);H("m",["mm",2],0,"minute"),z("minute","m"),N("m",Wc),N("mm",Wc,Sc),Q(["m","mm"],jd);var Jd=C("Minutes",!1);H("s",["ss",2],0,"second"),z("second","s"),N("s",Wc),N("ss",Wc,Sc),Q(["s","ss"],kd);var Kd=C("Seconds",!1);H("S",0,0,function(){return~~(this.millisecond()/100)}),H(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),H(0,["SSS",3],0,"millisecond"),H(0,["SSSS",4],0,function(){return 10*this.millisecond()}),H(0,["SSSSS",5],0,function(){return 100*this.millisecond()}),H(0,["SSSSSS",6],0,function(){return 1e3*this.millisecond()}),H(0,["SSSSSSS",7],0,function(){return 1e4*this.millisecond()}),H(0,["SSSSSSSS",8],0,function(){return 1e5*this.millisecond()}),H(0,["SSSSSSSSS",9],0,function(){return 1e6*this.millisecond()}),z("millisecond","ms"),N("S",Xc,Rc),N("SS",Xc,Sc),N("SSS",Xc,Tc);var Ld;for(Ld="SSSS";Ld.length<=9;Ld+="S")N(Ld,$c);for(Ld="S";Ld.length<=9;Ld+="S")Q(Ld,Wb);var Md=C("Milliseconds",!1);H("z",0,0,"zoneAbbr"),H("zz",0,0,"zoneName");var Nd=n.prototype;Nd.add=Ad,Nd.calendar=cb,Nd.clone=db,Nd.diff=ib,Nd.endOf=ub,Nd.format=mb,Nd.from=nb,Nd.fromNow=ob,Nd.to=pb,Nd.toNow=qb,Nd.get=F,Nd.invalidAt=Cb,Nd.isAfter=eb,Nd.isBefore=fb,Nd.isBetween=gb,Nd.isSame=hb,Nd.isValid=Ab,Nd.lang=Cd,Nd.locale=rb,Nd.localeData=sb,Nd.max=wd,Nd.min=vd,Nd.parsingFlags=Bb,Nd.set=F,Nd.startOf=tb,Nd.subtract=Bd,Nd.toArray=yb,Nd.toObject=zb,Nd.toDate=xb,Nd.toISOString=lb,Nd.toJSON=lb,Nd.toString=kb,Nd.unix=wb,Nd.valueOf=vb,Nd.year=td,Nd.isLeapYear=ia,Nd.weekYear=Fb,Nd.isoWeekYear=Gb,Nd.quarter=Nd.quarters=Jb,Nd.month=Y,Nd.daysInMonth=Z,Nd.week=Nd.weeks=na,Nd.isoWeek=Nd.isoWeeks=oa,Nd.weeksInYear=Ib,Nd.isoWeeksInYear=Hb,Nd.date=Dd,Nd.day=Nd.days=Pb,Nd.weekday=Qb,Nd.isoWeekday=Rb,Nd.dayOfYear=qa,Nd.hour=Nd.hours=Id,Nd.minute=Nd.minutes=Jd,Nd.second=Nd.seconds=Kd,
Nd.millisecond=Nd.milliseconds=Md,Nd.utcOffset=Na,Nd.utc=Pa,Nd.local=Qa,Nd.parseZone=Ra,Nd.hasAlignedHourOffset=Sa,Nd.isDST=Ta,Nd.isDSTShifted=Ua,Nd.isLocal=Va,Nd.isUtcOffset=Wa,Nd.isUtc=Xa,Nd.isUTC=Xa,Nd.zoneAbbr=Xb,Nd.zoneName=Yb,Nd.dates=aa("dates accessor is deprecated. Use date instead.",Dd),Nd.months=aa("months accessor is deprecated. Use month instead",Y),Nd.years=aa("years accessor is deprecated. Use year instead",td),Nd.zone=aa("moment().zone is deprecated, use moment().utcOffset instead. https://github.com/moment/moment/issues/1779",Oa);var Od=Nd,Pd={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},Qd={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},Rd="Invalid date",Sd="%d",Td=/\d{1,2}/,Ud={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},Vd=s.prototype;Vd._calendar=Pd,Vd.calendar=_b,Vd._longDateFormat=Qd,Vd.longDateFormat=ac,Vd._invalidDate=Rd,Vd.invalidDate=bc,Vd._ordinal=Sd,Vd.ordinal=cc,Vd._ordinalParse=Td,Vd.preparse=dc,Vd.postformat=dc,Vd._relativeTime=Ud,Vd.relativeTime=ec,Vd.pastFuture=fc,Vd.set=gc,Vd.months=U,Vd._months=md,Vd.monthsShort=V,Vd._monthsShort=nd,Vd.monthsParse=W,Vd.week=ka,Vd._week=ud,Vd.firstDayOfYear=ma,Vd.firstDayOfWeek=la,Vd.weekdays=Lb,Vd._weekdays=Ed,Vd.weekdaysMin=Nb,Vd._weekdaysMin=Gd,Vd.weekdaysShort=Mb,Vd._weekdaysShort=Fd,Vd.weekdaysParse=Ob,Vd.isPM=Ub,Vd._meridiemParse=Hd,Vd.meridiem=Vb,w("en",{ordinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(a){var b=a%10,c=1===q(a%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th";return a+c}}),a.lang=aa("moment.lang is deprecated. Use moment.locale instead.",w),a.langData=aa("moment.langData is deprecated. Use moment.localeData instead.",y);var Wd=Math.abs,Xd=yc("ms"),Yd=yc("s"),Zd=yc("m"),$d=yc("h"),_d=yc("d"),ae=yc("w"),be=yc("M"),ce=yc("y"),de=Ac("milliseconds"),ee=Ac("seconds"),fe=Ac("minutes"),ge=Ac("hours"),he=Ac("days"),ie=Ac("months"),je=Ac("years"),ke=Math.round,le={s:45,m:45,h:22,d:26,M:11},me=Math.abs,ne=Ha.prototype;ne.abs=oc,ne.add=qc,ne.subtract=rc,ne.as=wc,ne.asMilliseconds=Xd,ne.asSeconds=Yd,ne.asMinutes=Zd,ne.asHours=$d,ne.asDays=_d,ne.asWeeks=ae,ne.asMonths=be,ne.asYears=ce,ne.valueOf=xc,ne._bubble=tc,ne.get=zc,ne.milliseconds=de,ne.seconds=ee,ne.minutes=fe,ne.hours=ge,ne.days=he,ne.weeks=Bc,ne.months=ie,ne.years=je,ne.humanize=Fc,ne.toISOString=Gc,ne.toString=Gc,ne.toJSON=Gc,ne.locale=rb,ne.localeData=sb,ne.toIsoString=aa("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",Gc),ne.lang=Cd,H("X",0,0,"unix"),H("x",0,0,"valueOf"),N("x",_c),N("X",bd),Q("X",function(a,b,c){c._d=new Date(1e3*parseFloat(a,10))}),Q("x",function(a,b,c){c._d=new Date(q(a))}),a.version="2.10.6",b(Da),a.fn=Od,a.min=Fa,a.max=Ga,a.utc=h,a.unix=Zb,a.months=jc,a.isDate=d,a.locale=w,a.invalid=l,a.duration=Ya,a.isMoment=o,a.weekdays=lc,a.parseZone=$b,a.localeData=y,a.isDuration=Ia,a.monthsShort=kc,a.weekdaysMin=nc,a.defineLocale=x,a.weekdaysShort=mc,a.normalizeUnits=A,a.relativeTimeThreshold=Ec;var oe=a;return oe});
//! moment-timezone.js
//! version : 0.5.17
//! Copyright (c) JS Foundation and other contributors
//! license : MIT
//! github.com/moment/moment-timezone

(function (root, factory) {
  "use strict";

  /*global define*/
  if (typeof define === 'function' && define.amd) {
    define(['moment'], factory);                 // AMD
  } else if (typeof module === 'object' && module.exports) {
    module.exports = factory(require('moment')); // Node
  } else {
    factory(root.moment);                        // Browser
  }
}(this, function (moment) {
  "use strict";

  // Do not load moment-timezone a second time.
  // if (moment.tz !== undefined) {
  // 	logError('Moment Timezone ' + moment.tz.version + ' was already loaded ' + (moment.tz.dataVersion ? 'with data from ' : 'without any data') + moment.tz.dataVersion);
  // 	return moment;
  // }

  var VERSION = "0.5.17",
    zones = {},
    links = {},
    names = {},
    guesses = {},
    cachedGuess,

    momentVersion = moment.version.split('.'),
    major = +momentVersion[0],
    minor = +momentVersion[1];

  // Moment.js version check
  if (major < 2 || (major === 2 && minor < 6)) {
    logError('Moment Timezone requires Moment.js >= 2.6.0. You are using Moment.js ' + moment.version + '. See momentjs.com');
  }

  /************************************
   Unpacking
   ************************************/

  function charCodeToInt(charCode) {
    if (charCode > 96) {
      return charCode - 87;
    } else if (charCode > 64) {
      return charCode - 29;
    }
    return charCode - 48;
  }

  function unpackBase60(string) {
    var i = 0,
      parts = string.split('.'),
      whole = parts[0],
      fractional = parts[1] || '',
      multiplier = 1,
      num,
      out = 0,
      sign = 1;

    // handle negative numbers
    if (string.charCodeAt(0) === 45) {
      i = 1;
      sign = -1;
    }

    // handle digits before the decimal
    for (i; i < whole.length; i++) {
      num = charCodeToInt(whole.charCodeAt(i));
      out = 60 * out + num;
    }

    // handle digits after the decimal
    for (i = 0; i < fractional.length; i++) {
      multiplier = multiplier / 60;
      num = charCodeToInt(fractional.charCodeAt(i));
      out += num * multiplier;
    }

    return out * sign;
  }

  function arrayToInt (array) {
    for (var i = 0; i < array.length; i++) {
      array[i] = unpackBase60(array[i]);
    }
  }

  function intToUntil (array, length) {
    for (var i = 0; i < length; i++) {
      array[i] = Math.round((array[i - 1] || 0) + (array[i] * 60000)); // minutes to milliseconds
    }

    array[length - 1] = Infinity;
  }

  function mapIndices (source, indices) {
    var out = [], i;

    for (i = 0; i < indices.length; i++) {
      out[i] = source[indices[i]];
    }

    return out;
  }

  function unpack (string) {
    var data = string.split('|'),
      offsets = data[2].split(' '),
      indices = data[3].split(''),
      untils  = data[4].split(' ');

    arrayToInt(offsets);
    arrayToInt(indices);
    arrayToInt(untils);

    intToUntil(untils, indices.length);

    return {
      name       : data[0],
      abbrs      : mapIndices(data[1].split(' '), indices),
      offsets    : mapIndices(offsets, indices),
      untils     : untils,
      population : data[5] | 0
    };
  }

  /************************************
   Zone object
   ************************************/

  function Zone (packedString) {
    if (packedString) {
      this._set(unpack(packedString));
    }
  }

  Zone.prototype = {
    _set : function (unpacked) {
      this.name       = unpacked.name;
      this.abbrs      = unpacked.abbrs;
      this.untils     = unpacked.untils;
      this.offsets    = unpacked.offsets;
      this.population = unpacked.population;
    },

    _index : function (timestamp) {
      var target = +timestamp,
        untils = this.untils,
        i;

      for (i = 0; i < untils.length; i++) {
        if (target < untils[i]) {
          return i;
        }
      }
    },

    parse : function (timestamp) {
      var target  = +timestamp,
        offsets = this.offsets,
        untils  = this.untils,
        max     = untils.length - 1,
        offset, offsetNext, offsetPrev, i;

      for (i = 0; i < max; i++) {
        offset     = offsets[i];
        offsetNext = offsets[i + 1];
        offsetPrev = offsets[i ? i - 1 : i];

        if (offset < offsetNext && tz.moveAmbiguousForward) {
          offset = offsetNext;
        } else if (offset > offsetPrev && tz.moveInvalidForward) {
          offset = offsetPrev;
        }

        if (target < untils[i] - (offset * 60000)) {
          return offsets[i];
        }
      }

      return offsets[max];
    },

    abbr : function (mom) {
      return this.abbrs[this._index(mom)];
    },

    offset : function (mom) {
      logError("zone.offset has been deprecated in favor of zone.utcOffset");
      return this.offsets[this._index(mom)];
    },

    utcOffset : function (mom) {
      return this.offsets[this._index(mom)];
    }
  };

  /************************************
   Current Timezone
   ************************************/

  function OffsetAt(at) {
    var timeString = at.toTimeString();
    var abbr = timeString.match(/\([a-z ]+\)/i);
    if (abbr && abbr[0]) {
      // 17:56:31 GMT-0600 (CST)
      // 17:56:31 GMT-0600 (Central Standard Time)
      abbr = abbr[0].match(/[A-Z]/g);
      abbr = abbr ? abbr.join('') : undefined;
    } else {
      // 17:56:31 CST
      // 17:56:31 GMT+0800 ()
      abbr = timeString.match(/[A-Z]{3,5}/g);
      abbr = abbr ? abbr[0] : undefined;
    }

    if (abbr === 'GMT') {
      abbr = undefined;
    }

    this.at = +at;
    this.abbr = abbr;
    this.offset = at.getTimezoneOffset();
  }

  function ZoneScore(zone) {
    this.zone = zone;
    this.offsetScore = 0;
    this.abbrScore = 0;
  }

  ZoneScore.prototype.scoreOffsetAt = function (offsetAt) {
    this.offsetScore += Math.abs(this.zone.utcOffset(offsetAt.at) - offsetAt.offset);
    if (this.zone.abbr(offsetAt.at).replace(/[^A-Z]/g, '') !== offsetAt.abbr) {
      this.abbrScore++;
    }
  };

  function findChange(low, high) {
    var mid, diff;

    while ((diff = ((high.at - low.at) / 12e4 | 0) * 6e4)) {
      mid = new OffsetAt(new Date(low.at + diff));
      if (mid.offset === low.offset) {
        low = mid;
      } else {
        high = mid;
      }
    }

    return low;
  }

  function userOffsets() {
    var startYear = new Date().getFullYear() - 2,
      last = new OffsetAt(new Date(startYear, 0, 1)),
      offsets = [last],
      change, next, i;

    for (i = 1; i < 48; i++) {
      next = new OffsetAt(new Date(startYear, i, 1));
      if (next.offset !== last.offset) {
        change = findChange(last, next);
        offsets.push(change);
        offsets.push(new OffsetAt(new Date(change.at + 6e4)));
      }
      last = next;
    }

    for (i = 0; i < 4; i++) {
      offsets.push(new OffsetAt(new Date(startYear + i, 0, 1)));
      offsets.push(new OffsetAt(new Date(startYear + i, 6, 1)));
    }

    return offsets;
  }

  function sortZoneScores (a, b) {
    if (a.offsetScore !== b.offsetScore) {
      return a.offsetScore - b.offsetScore;
    }
    if (a.abbrScore !== b.abbrScore) {
      return a.abbrScore - b.abbrScore;
    }
    return b.zone.population - a.zone.population;
  }

  function addToGuesses (name, offsets) {
    var i, offset;
    arrayToInt(offsets);
    for (i = 0; i < offsets.length; i++) {
      offset = offsets[i];
      guesses[offset] = guesses[offset] || {};
      guesses[offset][name] = true;
    }
  }

  function guessesForUserOffsets (offsets) {
    var offsetsLength = offsets.length,
      filteredGuesses = {},
      out = [],
      i, j, guessesOffset;

    for (i = 0; i < offsetsLength; i++) {
      guessesOffset = guesses[offsets[i].offset] || {};
      for (j in guessesOffset) {
        if (guessesOffset.hasOwnProperty(j)) {
          filteredGuesses[j] = true;
        }
      }
    }

    for (i in filteredGuesses) {
      if (filteredGuesses.hasOwnProperty(i)) {
        out.push(names[i]);
      }
    }

    return out;
  }

  function rebuildGuess () {

    // use Intl API when available and returning valid time zone
    try {
      var intlName = Intl.DateTimeFormat().resolvedOptions().timeZone;
      if (intlName && intlName.length > 3) {
        var name = names[normalizeName(intlName)];
        if (name) {
          return name;
        }
        logError("Moment Timezone found " + intlName + " from the Intl api, but did not have that data loaded.");
      }
    } catch (e) {
      // Intl unavailable, fall back to manual guessing.
    }

    var offsets = userOffsets(),
      offsetsLength = offsets.length,
      guesses = guessesForUserOffsets(offsets),
      zoneScores = [],
      zoneScore, i, j;

    for (i = 0; i < guesses.length; i++) {
      zoneScore = new ZoneScore(getZone(guesses[i]), offsetsLength);
      for (j = 0; j < offsetsLength; j++) {
        zoneScore.scoreOffsetAt(offsets[j]);
      }
      zoneScores.push(zoneScore);
    }

    zoneScores.sort(sortZoneScores);

    return zoneScores.length > 0 ? zoneScores[0].zone.name : undefined;
  }

  function guess (ignoreCache) {
    if (!cachedGuess || ignoreCache) {
      cachedGuess = rebuildGuess();
    }
    return cachedGuess;
  }

  /************************************
   Global Methods
   ************************************/

  function normalizeName (name) {
    return (name || '').toLowerCase().replace(/\//g, '_');
  }

  function addZone (packed) {
    var i, name, split, normalized;

    if (typeof packed === "string") {
      packed = [packed];
    }

    for (i = 0; i < packed.length; i++) {
      split = packed[i].split('|');
      name = split[0];
      normalized = normalizeName(name);
      zones[normalized] = packed[i];
      names[normalized] = name;
      addToGuesses(normalized, split[2].split(' '));
    }
  }

  function getZone (name, caller) {
    name = normalizeName(name);

    var zone = zones[name];
    var link;

    if (zone instanceof Zone) {
      return zone;
    }

    if (typeof zone === 'string') {
      zone = new Zone(zone);
      zones[name] = zone;
      return zone;
    }

    // Pass getZone to prevent recursion more than 1 level deep
    if (links[name] && caller !== getZone && (link = getZone(links[name], getZone))) {
      zone = zones[name] = new Zone();
      zone._set(link);
      zone.name = names[name];
      return zone;
    }

    return null;
  }

  function getNames () {
    var i, out = [];

    for (i in names) {
      if (names.hasOwnProperty(i) && (zones[i] || zones[links[i]]) && names[i]) {
        out.push(names[i]);
      }
    }

    return out.sort();
  }

  function addLink (aliases) {
    var i, alias, normal0, normal1;

    if (typeof aliases === "string") {
      aliases = [aliases];
    }

    for (i = 0; i < aliases.length; i++) {
      alias = aliases[i].split('|');

      normal0 = normalizeName(alias[0]);
      normal1 = normalizeName(alias[1]);

      links[normal0] = normal1;
      names[normal0] = alias[0];

      links[normal1] = normal0;
      names[normal1] = alias[1];
    }
  }

  function loadData (data) {
    addZone(data.zones);
    addLink(data.links);
    tz.dataVersion = data.version;
  }

  function zoneExists (name) {
    if (!zoneExists.didShowError) {
      zoneExists.didShowError = true;
      logError("moment.tz.zoneExists('" + name + "') has been deprecated in favor of !moment.tz.zone('" + name + "')");
    }
    return !!getZone(name);
  }

  function needsOffset (m) {
    var isUnixTimestamp = (m._f === 'X' || m._f === 'x');
    return !!(m._a && (m._tzm === undefined) && !isUnixTimestamp);
  }

  function logError (message) {
    if (typeof console !== 'undefined' && typeof console.error === 'function') {
      console.error(message);
    }
  }

  /************************************
   moment.tz namespace
   ************************************/

  function tz (input) {
    var args = Array.prototype.slice.call(arguments, 0, -1),
      name = arguments[arguments.length - 1],
      zone = getZone(name),
      out  = moment.utc.apply(null, args);

    if (zone && !moment.isMoment(input) && needsOffset(out)) {
      out.add(zone.parse(out), 'minutes');
    }

    out.tz(name);

    return out;
  }

  tz.version      = VERSION;
  tz.dataVersion  = '';
  tz._zones       = zones;
  tz._links       = links;
  tz._names       = names;
  tz.add          = addZone;
  tz.link         = addLink;
  tz.load         = loadData;
  tz.zone         = getZone;
  tz.zoneExists   = zoneExists; // deprecated in 0.1.0
  tz.guess        = guess;
  tz.names        = getNames;
  tz.Zone         = Zone;
  tz.unpack       = unpack;
  tz.unpackBase60 = unpackBase60;
  tz.needsOffset  = needsOffset;
  tz.moveInvalidForward   = true;
  tz.moveAmbiguousForward = false;

  /************************************
   Interface with Moment.js
   ************************************/

  var fn = moment.fn;

  moment.tz = tz;

  moment.defaultZone = null;

  moment.updateOffset = function (mom, keepTime) {
    var zone = moment.defaultZone,
      offset;

    if (mom._z === undefined) {
      if (zone && needsOffset(mom) && !mom._isUTC) {
        mom._d = moment.utc(mom._a)._d;
        mom.utc().add(zone.parse(mom), 'minutes');
      }
      mom._z = zone;
    }
    if (mom._z) {
      offset = mom._z.utcOffset(mom);
      if (Math.abs(offset) < 16) {
        offset = offset / 60;
      }
      if (mom.utcOffset !== undefined) {
        mom.utcOffset(-offset, keepTime);
      } else {
        mom.zone(offset, keepTime);
      }
    }
  };

  fn.tz = function (name, keepTime) {
    if (name) {
      this._z = getZone(name);
      if (this._z) {
        moment.updateOffset(this, keepTime);
      } else {
        logError("Moment Timezone has no data for " + name + ". See http://momentjs.com/timezone/docs/#/data-loading/.");
      }
      return this;
    }
    if (this._z) { return this._z.name; }
  };

  function abbrWrap (old) {
    return function () {
      if (this._z) { return this._z.abbr(this); }
      return old.call(this);
    };
  }

  function resetZoneWrap (old) {
    return function () {
      this._z = null;
      return old.apply(this, arguments);
    };
  }

  fn.zoneName = abbrWrap(fn.zoneName);
  fn.zoneAbbr = abbrWrap(fn.zoneAbbr);
  fn.utc      = resetZoneWrap(fn.utc);

  moment.tz.setDefault = function(name) {
    if (major < 2 || (major === 2 && minor < 9)) {
      logError('Moment Timezone setDefault() requires Moment.js >= 2.9.0. You are using Moment.js ' + moment.version + '.');
    }
    moment.defaultZone = name ? getZone(name) : null;
    return moment;
  };

  // Cloning a moment should include the _z property.
  var momentProperties = moment.momentProperties;
  if (Object.prototype.toString.call(momentProperties) === '[object Array]') {
    // moment 2.8.1+
    momentProperties.push('_z');
    momentProperties.push('_a');
  } else if (momentProperties) {
    // moment 2.7.0
    momentProperties._z = null;
  }

  loadData({
    "version": "2018e",
    "zones": [
      "America/New_York|EST EDT EWT EPT|50 40 40 40|01010101010101010101010101010101010101010101010102301010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010|-261t0 1nX0 11B0 1nX0 11B0 1qL0 1a10 11z0 1qN0 WL0 1qN0 11z0 1o10 11z0 1o10 11z0 1o10 11z0 1o10 11z0 1qN0 11z0 1o10 11z0 1o10 11z0 1o10 11z0 1o10 11z0 1qN0 WL0 1qN0 11z0 1o10 11z0 1o10 11z0 1o10 11z0 1o10 11z0 1qN0 WL0 1qN0 11z0 1o10 11z0 RB0 8x40 iv0 1o10 11z0 1o10 11z0 1o10 11z0 1o10 11z0 1qN0 WL0 1qN0 11z0 1o10 11z0 1o10 11z0 1o10 11z0 1o10 1fz0 1cN0 1cL0 1cN0 1cL0 1cN0 1cL0 1cN0 1cL0 1cN0 1fz0 1cN0 1cL0 1cN0 1cL0 1cN0 1cL0 1cN0 1cL0 1cN0 1fz0 1a10 1fz0 1cN0 1cL0 1cN0 1cL0 1cN0 1cL0 1cN0 1cL0 1cN0 1fz0 1cN0 1cL0 1cN0 1cL0 s10 1Vz0 LB0 1BX0 1cN0 1fz0 1a10 1fz0 1cN0 1cL0 1cN0 1cL0 1cN0 1cL0 1cN0 1cL0 1cN0 1fz0 1a10 1fz0 1cN0 1cL0 1cN0 1cL0 1cN0 1cL0 14p0 1lb0 14p0 1nX0 11B0 1nX0 11B0 1nX0 14p0 1lb0 14p0 1lb0 14p0 1nX0 11B0 1nX0 11B0 1nX0 14p0 1lb0 14p0 1lb0 14p0 1lb0 14p0 1nX0 11B0 1nX0 11B0 1nX0 14p0 1lb0 14p0 1lb0 14p0 1nX0 11B0 1nX0 11B0 1nX0 Rd0 1zb0 Op0 1zb0 Op0 1zb0 Rd0 1zb0 Op0 1zb0 Op0 1zb0 Op0 1zb0 Op0 1zb0 Op0 1zb0 Rd0 1zb0 Op0 1zb0 Op0 1zb0 Op0 1zb0 Op0 1zb0 Rd0 1zb0 Op0 1zb0 Op0 1zb0 Op0 1zb0 Op0 1zb0 Op0 1zb0 Rd0 1zb0 Op0 1zb0 Op0 1zb0 Op0 1zb0 Op0 1zb0 Rd0 1zb0 Op0 1zb0 Op0 1zb0 Op0 1zb0 Op0 1zb0 Op0 1zb0|21e6",
    ],
    "links": [
      "America/New_York|US/Eastern",
      ]
  });


  return moment;
}));




(function (w, SA, $) {

  var scope = SA.UsingNamespace('SA.Utils');
  scope.SymbolData = scope.SymbolData || new function () {

    var $scriptContainer = $('head'),
      IDENTIFIER_TYPE_SYMBOL = 'IdentifierType=Symbol';

    var Url = {
      marketDataIndicesCharts: '/market_data/real_time_indices_with_charts',
      xignite: {
        cachedSuperQuotes: function () {
          var assetHost = SA.App.env.dev ? 'https://static-staging.seekingalpha.com' : SA.App.assetHost;
          return assetHost + '/cdn/xignite/superquotes/xSuperQuotes.json/GetQuotes';
        },
        cachedRealTimeIndices: function () {
          var assetHost = SA.App.env.dev ? 'https://static-staging.seekingalpha.com' : SA.App.assetHost;
          return assetHost + '/cdn/xignite/globalindicesrealtime/xglobalindicesrealtime.json/GetRealTimeIndicesValue';
        },
        cachedGlobalIndicesBars: function () {
          var assetHost = SA.App.env.dev ? 'https://static-staging.seekingalpha.com' : SA.App.assetHost;
          return assetHost + '/cdn/xignite/globalindicesrealtime/xglobalindicesrealtime.json/GetIndexBars';
        },
        cachedGlobalIndices: function () {
          var assetHost = SA.App.env.dev ? 'https://static-staging.seekingalpha.com' : SA.App.assetHost;
          return assetHost + '/cdn/xignite/globalindiceshistorical/xglobalindiceshistorical.json/GetHistoricalIndexValues';
        },
        globalHistoricalQuotesRangeV3CDN: function () {
          var assetHost = SA.App.env.dev ? 'https://static-staging.seekingalpha.com' : SA.App.assetHost;
          return assetHost + '/cdn/xignite/globalhistorical/v3/xGlobalHistorical.json/GetGlobalHistoricalQuotesRange';
        },

        quotes: 'https://superquotes.xignite.com/xSuperQuotes.json/GetQuotes',
        endOfDayQuotes: 'https://www.xignite.com/xGlobalHistorical.json/GetEndOfDayQuotes',
        cashDividendHistoryV3: 'https://globalhistorical.xignite.com/v3/xGlobalHistorical.json/GetCashDividendHistory',
        splitHistory: 'https://globalhistorical.xignite.com/v3/xGlobalHistorical.json/GetSplitHistory',
        globalHistoricalQuotesRange: 'https://www.xignite.com/xGlobalHistorical.json/GetGlobalHistoricalQuotesRange',
        globalHistoricalQuotesRangeV3: 'https://globalhistorical.xignite.com/v3/xGlobalHistorical.json/GetGlobalHistoricalQuotesRange',
        globalHistoricalQuarterlyQuotesRangeV3: 'https://globalhistorical.xignite.com/v3/xGlobalHistorical.json/GetGlobalHistoricalQuarterlyQuotesRange',
        globalHistoricalWeeklyQuotesRange: 'https://globalhistorical.xignite.com/v3/xGlobalHistorical.json/GetGlobalHistoricalWeeklyQuotesRange',
        globalHistoricalMonthlyQuotesRange: 'https://globalhistorical.xignite.com/v3/xGlobalHistorical.json/GetGlobalHistoricalMonthlyQuotesRange',
        equityOptionChain: 'https://globaloptions.xignite.com/xglobaloptions.json/GetEquityOptionChain',
        globalHistoricalMutualFundsRange: 'https://navs.xignite.com/v2/xNAVs.json/GetHistoricalNAVs',
      }
    };

    function runScript(url, notoken) {
      SA.Data.Xignite.getData(url, notoken);
    }

    function getData(url, clb) {
      $.get(url).always(clb);
    }

    var clbCounter = 0;

    function oneTimeClb(handler) {
      var clbName = 'clb' + Date.now() + (clbCounter++);

      SA.Utils.SymbolData[clbName] = function (response) {
        handler(response);
        delete SA.Utils.SymbolData[clbName];
      };

      return 'SA.Utils.SymbolData.' + clbName;
    }

    function superQuotesHandle(data, clb) {
      if (data && clb) {
        var res = {};
        $.each(data, function (i, v) {
          if (v.Identifier) {
            res[v.Identifier.toLowerCase()] = v;
          }
        });

        clb(res);
      }
    }

    function iexQuotes(slugs, onSuccess) {
      var iexQuotesbackupURL = SA.App.finance_api_host + '/prices?symbols=' + slugs.join(',');

      $.get(iexQuotesbackupURL).success(function (data) {
        var quote, res = $.map(data, function (obj) {
          for (var key in obj) {
            quote = obj[key].quote;
            return {
              Identifier: quote.symbol,
              Name: quote.companyName,
              Last: quote.latestPrice,
              Open: quote.open,
              High: quote.high,
              Low: quote.low,
              Close: quote.close,
              PreviousClose: quote.previousClose,
              Change: quote.change,
              PercentChange: quote.changePercent,
              Volume: quote.volume || quote.previousVolume,
              High52Week: quote.week52High,
              Low52Week: quote.week52Low,
              SourceAPI: 'IEX',
              DateTime: w.moment(quote.lastTradeTime).tz('America/New_York').locale('en-En').format('M/DD/YYYY LTS'),
              ExtendedHoursType: quote.latestSource,
              ExtendedHoursDateTime: w.moment(quote.extendedPriceTime).tz('America/New_York').locale('en-En').format('M/DD/YYYY LTS'),
              ExtendedHoursPrice: quote.extendedPrice,
              ExtendedHoursChange: quote.extendedChange,
              ExtendedHoursPercentChange: quote.extendedChangePercent
            };
          }
        });

        superQuotesHandle(res, onSuccess);
      }).error(function (res) {
        SA.exceptions.push(['IEX Error Response: ' + res.status + ' ' + res.responseText]);
        superQuotesHandle({Outcome: 'Error ' + res.status}, onSuccess);
      });
    }

    function endOfDayQuotesHandle(response, clb) {
      if (response && clb) {
        var res = {};
        for (var i = 0, len = response.length; i < len; i++) {
          if (response[i].Security) {
            res[response[i].Security.Symbol.toLowerCase()] = response[i];
          }
        }
        clb(res);
      }
    }

    function globalHistoricalUrl(url, opt, clb) {
      var params =
        [
          'Identifier=' + opt.slug,
          'AdjustmentMethod=' + opt.adjustmentMethod,
          'StartDate=' + opt.startDate,
          'EndDate=' + opt.endDate,
          'IdentifierAsOfDate=',
          '_callback=' + oneTimeClb(clb)
        ];

      return formatUrl(url, params);
    }

    function globalHistoricalUrlV3(url, opt, clb) {
      var params =
        [
          'Identifier=' + opt.slug,
          'StartDate=' + opt.startDate,
          'EndDate=' + opt.endDate,
          'IdentifierAsOfDate=',
          'CorporateActionsAdjusted=' + opt.adjusted,
          '_callback=' + oneTimeClb(clb)
        ];

      return formatUrl(url, params);
    }

    function globalHistoricalQuotesUrlV3(url, opt, clb) {
      var params =
        [
          'Identifier=' + opt.slug,
          'StartDate=' + opt.startDate,
          'EndDate=' + opt.endDate,
          'IdentifierAsOfDate=',
          'adjustmentMethod=PriceReturn',
          '_callback=' + oneTimeClb(clb)
        ];

      return formatUrl(url, params);
    }

    function globalHistoricalIndicesRangeUrl(url, opt, clb) {
      var fields = opt.fields ? opt.fields : 'Outcome,Message,values.close,values.date';
      var params =
        [
          'IdentifierType=Symbol',
          'Identifier=' + opt.slug,
          'StartDate=' + opt.startDate,
          'EndDate=' + opt.endDate,
          '_fields=' + fields,
          '_callback=' + oneTimeClb(clb)
        ];

      return formatUrl(url, params);
    }

    function globalHistoricalQuarterlyQuotesRangeUrlV3(url, opt, clb) {
      var params =
        [
          'Identifier=' + opt.slug,
          'StartDate=' + opt.startDate,
          'EndDate=' + opt.endDate,
          'IdentifierAsOfDate=',
          'adjustmentMethod=All',
          '_callback=' + oneTimeClb(clb)
        ];

      return formatUrl(url, params);
    }

    function formatUrl(url, params) {
      return url + '?' + [IDENTIFIER_TYPE_SYMBOL].concat(params).join('&');
    }

    this.removeAllScripts = function () {
      var $allScripts = $scriptContainer.find('script');

      $allScripts.each(function () {
        if ((/xignite/).test($(this).attr('src'))) {
          $(this).remove();
        }
      });
    };

    // In use with all subfunctions
    this.getFromSuperQuotes = function (slugs, onSuccess) {
      switch ((SA.pageConfig || {}).useSQuoteSource) {
        case 'iex':
          return iexQuotes(slugs, onSuccess);
        default: //xignite
          if (slugs.length > 20) {
            this.getDirectSuperQuotes(slugs.join(','), function (res) {
              superQuotesHandle(res, onSuccess);
            });
          } else {
            var promises = $.map(slugs, singleQuoteData);
            $.when.apply($, promises).then(function () {
              var data = $.map(arguments, function (a) {
                return a[0];
              });
              superQuotesHandle(data, onSuccess);
            }).fail(function () {
              SA.exceptions.push(['getFromSuperQuotes: Error']);
            });
          }
      }
    };

    this.getEquityOptionChain = function (slug, month, year, clb) {
      function callback(response) {
        if ($.isFunction(clb)) {
          clb(response);
        }
      }

      var url = formatUrl(Url.xignite.equityOptionChain,
        [
          'Identifier=' + slug,
          'Month=' + month,
          'Year=' + year,
          'SymbologyType=',
          'OptionExchange=',
          '_callback=' + oneTimeClb(callback)
        ]);

      runScript(url);
    };

    this.getMainIndicesChart = function (clbDone, clbAlways) {
      $.get(Url.marketDataIndicesCharts).done(clbDone).always(clbAlways);
    };

    this.getFromEndOfDayQuotes = function (date, slugs, onSuccess) {
      var clbName = oneTimeClb(function (response) {
          endOfDayQuotesHandle(response, onSuccess);
        }),
        params = [
          'Identifiers=' + slugs.join(',').toUpperCase(),
          'AdjustmentMethod=SplitAndProportionalCashDividend',
          'EndOfDayPriceMethod=LastTrade',
          'AsOfDate=' + [date.getMonth() + 1, date.getDate(), date.getFullYear()].join('/'),
          '_fields=Outcome,Message,Delay,Security.Symbol,Date,EndOfDayPrice,LastClose',
          '_callback=' + clbName
        ];

      runScript(formatUrl(Url.xignite.endOfDayQuotes, params));
    };

    this.getCashDividendHistoryV3 = function (opt, clb) {
      var url = globalHistoricalUrlV3(Url.xignite.cashDividendHistoryV3, opt, clb);
      runScript(url);
    };

    this.getSplitHistory = function (opt, clb) {
      var url = globalHistoricalUrl(Url.xignite.splitHistory, opt, clb);
      runScript(url);
    };

    this.getGlobalHistoricalQuotesRange = function (opt, clb) {
      var url = globalHistoricalUrl(Url.xignite.globalHistoricalQuotesRangeV3, opt, clb);
      runScript(url);
    };

    this.getGlobalHistoricalQuotesRangeV3 = function (opt, clb) {
      var url = globalHistoricalQuotesUrlV3(Url.xignite.globalHistoricalQuotesRangeV3, opt, clb);
      runScript(url);
    };

    this.getGlobalHistoricalQuarterlyQuotesRangeV3 = function (opt, clb) {
      var url = globalHistoricalQuarterlyQuotesRangeUrlV3(Url.xignite.globalHistoricalQuarterlyQuotesRangeV3, opt, clb);
      runScript(url);
    };

    this.getHistoricalMutualFundsRange = function (opt, clb) {
      var url = globalHistoricalUrl(Url.xignite.globalHistoricalMutualFundsRange, opt, clb);
      runScript(url);
    };

    this.getGlobalHistoricalQuotesRangeCDN = function (opt, clb) {
      var url = this.getGlobalHistoricalQuotesRangeCdnUrl(opt);
      getData(url, clb);
    };

    this.getGlobalHistoricalQuotesRangeCdnUrl = function (opt) {
      return formatUrl(Url.xignite.globalHistoricalQuotesRangeV3CDN(),
        [
          'Identifier=' + opt.slug,
          'StartDate=' + opt.startDate,
          'EndDate=' + opt.endDate,
          'IdentifierAsOfDate=',
          'AdjustmentMethod=' + opt.adjustmentMethod,
        ]);
    };

    this.getDirectSuperQuotes = function (slugs, clb) {
      var url = formatUrl(Url.xignite.quotes,
        [
          'Identifiers=' + slugs,
          'sasource=symbol_data',
          '_callback=' + oneTimeClb(clb)
        ]);

      runScript(url);
    };

    this.getCachedSuperQuotes = getCachedSuperQuotes;

    this.getCacheDailyData = function (slugs, clb) {
      getData('/market_data/daily?symbols=' + slugs, clb);
    };

    this.getGlobalHistoricalWeeklyQuotesRange = function (opt, clb) {
      var url = globalHistoricalUrl(Url.xignite.globalHistoricalWeeklyQuotesRange, opt, clb);
      runScript(url);
    };

    this.getGlobalHistoricalMonthlyQuotesRange = function (opt, clb) {
      var url = globalHistoricalUrl(Url.xignite.globalHistoricalMonthlyQuotesRange, opt, clb);
      runScript(url);
    };

    this.getCrypto = function (opt, clb) {
      if (opt.symbols && opt.symbols.length && opt.toSymbol) {
        var toSym = Array.isArray(opt.toSymbol) ? opt.toSymbol : [opt.toSymbol];
        SA.Utils.cryptoAPI.priceMultiFull(opt.symbols, toSym).then(function (data) {
          if (data.Response === "Error") {
            return SA.exceptions.push(['Error loading cryptocompare price', {}, {message: data.Message}]);
          }
          clb(data);
        });
      } else {
        clb(null);
      }
    };

    function getCachedSuperQuotes(slugs, clb) {
      var url = formatUrl(Url.xignite.cachedSuperQuotes(),
        [
          'Identifiers=' + slugs
        ]);

      getData(url, clb);
    }

    function singleQuoteData(slug) {
      var $d = $.Deferred();
      getCachedSuperQuotes(slug, $d.resolve);
      return $d;
    }

    this.getCachedRealTimeIndices = function (slugs, clb) {
      var url = formatUrl(Url.xignite.cachedRealTimeIndices(),
        [
          'Identifiers=' + slugs,
        ]);

      getData(url, clb);
    };

    this.getCachedGlobalIndicesBars = function (opt, clb) {
      var url = formatUrl(Url.xignite.cachedGlobalIndicesBars(),
        [
          'Identifier=' + opt.slug,
          'StartTime=' + opt.startTime,
          'EndTime=' + opt.endTime,
          'Precision=Minutes',
          'Period=' + opt.period,
          '_fields=Outcome,Message,Bars.StartDate,Bars.StartTime,Bars.Close'
        ]);

      getData(url, clb);
    };

    this.getCachedGlobalIndices = function (opt, clb) {
      var fields = opt.fields ? opt.fields : 'Outcome,Message,values.close,values.date',
        url = SA.Utils.SymbolData.getCachedGlobalIndicesUrl(opt);
      getData(url, clb);
    };

    this.getCachedGlobalIndicesUrl = function (opt) {
      var fields = opt.fields ? opt.fields : 'Outcome,Message,values.close,values.date';
      return formatUrl(Url.xignite.cachedGlobalIndices(),
        [
          'Identifier=' + opt.slug,
          'IdentifierType=Symbol',
          'StartDate=' + opt.startDate,
          'EndDate=' + opt.endDate,
          '_fields=' + fields,
        ]);
    };
  };

}(window, window.SA, window.jQuery));
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/roadblock/roadblock_step2"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<table class="table">\n  <thead>\n    <tr>\n      <th class="sym">Symbol</th>\n      <th>Price</th>\n      <th>% Chg</th>\n      <th>Remove</th>\n    </tr>\n  </thead>\n  <tbody>\n  ');  for(var i = 0; i < 8; i++) { ; __p.push('\n\n      <tr class="',  (i%2 === 1)? 'b-g' : '' ,'">\n           <td class="sym">\n             <input id="s_input', i,'" type="text" placeholder="Type Ticker" maxlength="9" value="',  i === 0 ? primaryTicker.toUpperCase() : '' ,'"/>\n           </td>\n           <td class="p">-</td>\n           <td class="c">-</td>\n           <td><span class="rmv"></span></td>\n      </tr>\n  ');  } ; __p.push('\n  </tbody>\n</table>\n<div>\n  <div class="testimonial"><em> "I love the short emails these "bite-sized" emails are quick reads and keep me informed." </em></div>\n  <div class="right"> - Alan, Seeking Alpha user for over 7 years </div>\n</div>\n<div class="get-alerts">\n  <input type="checkbox" id="rtas" checked>\n  <span>Send me breaking news and articles on my stocks</span>\n</div>\n<input type="submit" id="reg-btn" class="btn orange-btn" value="Complete Free Registration"/>\n<div class="sym-error" class="alert alert-danger hidden" role="alert"></div>\n');}return __p.join('');};
}).call(this);




(function(SA, $, w){

  "use strict";

  var scope = SA.UsingNamespace('SA.Widgets.RoadblockStep2');
  var modal = null;
  var regLock = false;
  var helpers = SA.Utils.AuthenticationHelpers;
  var options;
  var articlePage = w.aConf && w.aConf.pagination && w.aConf.pagination.page;

  var symbolError = {
    defaultMessage: 'There was an error. Please try again later',
    already_registered: 'Please check your email and password and try the Member sign in.',
    regis_login: 'You can manage your stocks from the Portfolio tab.',
    addOneStockMessage: '* Please enter at least 1 stock to continue' ,
    addStocksMessage: function(n) { return '* Please add at least '+ n + ' stocks to continue.'; }
  };

  var getError = function(error) {
    return symbolError[error] || symbolError.defaultMessage;
  };

  var getDefaultOptions = function(){
    return {
      id: 'login',
      activity: 'roadblock',
      pageType: null,
      email: null,
      password: null,
      regStep2Success: 'onRegStep2Success',
      afterClose: removeSetModalLeftOnResizeEvent,
      minSymbols: 1
    };
  };

  var sendMoneEvent = function(action, opt){
    opt = opt || {};
    var data = $.extend({}, {email: options.email} , opt);
    return SA.Logger.Mone.event('roadblock', options.pageType + '_register' , action, {data:data} );
  };

  //portfolio unit

  var onAfterAddSymbol = function($row){
    $row.find('.p').removeClass('sa-loader');
    $row.find('.c').removeClass('sa-loader');
  };

  var onBeforeAddSymbol = function($row){
    $row.find('.p').text('').addClass('sa-loader');
    $row.find('.c').text('').addClass('sa-loader');
  };

  var handleSQFailure = function(data, $row) {
    $row.find('input').val('');
    $row.find('.p').text('-');
    $row.find('.c').text('-');
    onAfterAddSymbol($row);
    SA.exceptions.push(['rb-portfolio: SuperQuote fail', {}, data]);
  };

  var handleSQSuccess = function(data, $row) {
    onAfterAddSymbol($row);
    $row.find('.has-error').removeClass('has-error');
    $row.find('.p').text(data.last);
    $row.find('.c')
      .text(data.percent > 0 ? '+' + data.percent : data.percent)
      .css('color', data.percent > 0 ? 'green' : data.percent < 0 ? 'red' : 'gray');
  };

  var validResponse = function(data) {
    data = data || {};
    return $.isNumeric(data.last) || $.isNumeric(data.percent);
  };

  var mapResponse = function (res, slug) {
    var response = (res || {})[slug.toLowerCase()],
      data = {};
    if (!response) return data;
    data.last = SA.Utils.Formatter.number(response.Last || response.latestPrice);
    data.percent = SA.Utils.Formatter.number(response.PercentChange || response.changePercent, {prefix: '%'});
    return data;
  };

  var handleSuperQuotes = function(res, slug, $row) {
    var data = mapResponse(res, slug);
    return validResponse(data) ? handleSQSuccess(data, $row) : handleSQFailure(data, $row);
  };

  var addSymbolData= function($row, slug) {
    onBeforeAddSymbol($row);
    SA.Utils.SymbolData.getFromSuperQuotes([slug], function(response){
      handleSuperQuotes(response, slug, $row);
    });
  };

  var initSymbolData = function($row){
    var $input = $row.find('input');
    $input.on('keypress', function (event) {
      if (event.keyCode === 13) {
        $('#' + this.id + '_sa_autocomplete').hide();
        addSymbolData($row, $input.val());
      }
    }).on('keyup', function () {
      this.value = this.value.toUpperCase();
    });
  };

  var initAutocomplete = function($row){
    var $input = $row.find('input');
    return new SA.Utils.Autocomplete($input, {
      authors: false,
      symbols: true,
      symbolSelectCallback: function(slug){$input.val(slug); addSymbolData($row, slug);}
    });
  };

  var initRemoveBtn = function($row){
    $row.on('click', '.rmv', function(){
      $row.find('input').val('');
      $row.find('.p').text('-');
      $row.find('.c').text('-');
    });
  };

  var initSymbolRow = function($row){
    initAutocomplete($row);
    initSymbolData($row);
    initRemoveBtn($row);
  };

  var initPrimaryTicker = function($modal){
    if(options.primaryTicker){
      var firstRow = $modal.find('tbody').find('tr').first();
      addSymbolData(firstRow, options.primaryTicker);
    }
  };

  var initOtherTickers = function($modal, visited){
    var array = visited.split(',');
    var $rows = $modal.find('tbody').find('tr');
    $.map($rows, function(row){
      var i = row.sectionRowIndex;
      var ticker = array[i];
      row = $(row);
      if(ticker){
        var $input =row.find('input');
        $input.val(ticker.toUpperCase());
        return addSymbolData(row, ticker)
      }
    });
  };

  var setSymbolEvents = function($modal){
    var rows = $modal.find('tbody').find('tr');
    $.map(rows, function(r){return initSymbolRow($(r));});
    $(rows.find('.sym').splice(0, options.minSymbols)).addClass('form-group');
  };

  //Register Step 2

  var onBeforeReg = function($modal){
    regLock = true;
    helpers.hideErrors($modal.find('#symbol-error'));
    helpers.addLoader($modal.find('#reg-btn'));
  };

  var onAfterReg = function(){
    regLock = false;
    helpers.removeLoader(modal.getModalObject().find('#reg-btn'));
  };

  var getSymbols = function($inputs){
    var symbolArr = [];
    var symbol;
    $.each($inputs, function(index,value){
      symbol = $(value).val();
      if(symbol.length){
        symbolArr.push(symbol);
      }
    });
    return symbolArr;
  };

  var getSymbolsError = function(n){
    var missing = options.minSymbols - n ;
    if(missing === 0) return;
    return missing === 1 ? getError('addOneStockMessage') : getError('addStocksMessage')(missing);
  };

  var onRegStep2Failure = function(response, opt){
    onAfterReg();
  };

  var handleRegStep2Failure = function(response) {
    switch(response.message) {
      case 'regis_login':
        return helpers.rbErrorPopup(getError('regis_login'), 'The stocks youve marked have been added to your portfolio', modal, true);
      case 'already_registered':
        return helpers.rbErrorPopup(getError('already_registered'), 'You are already registered', modal, true);
      default:
        return helpers.rbErrorPopup(getError('defaultMessage'), '', modal, true);
    }
  };

  var handleRegStep2Success = function(opt) {
    modal.hide();
    var biData =  {email: opt.email, RTA_checkbox: (opt.rtaAddAlerts ? 'checked' : 'unchecked'), portfolio_slugs: opt.rtaSlugs};
    if (articlePage) {biData.page = articlePage;}
    SA.Logger.Mone.event('portfolio_popup', 'regular_roadblock', 'input',  {data: biData});
    SA.Utils.Observer.publish('registration/success-popup', {
      email:opt.email,
      backdrop: false,
      keyboard: false,
      showCloseBtn: false,
      fromRoadblock: true,
      source: 'regular_roadblock'
    });
  };

  var onRegStep2Success = function(response, opt) {
    response = response || {};
    onAfterReg();

    return response.registration ? handleRegStep2Success(opt) : handleRegStep2Failure(response, opt);
  };

  var tryToRegStep2 = function($modal){

    if(regLock){
      return;
    }

    var $symbolInputs = $modal.find('.sym').find('input');
    var symbolsArray = getSymbols($symbolInputs);
    var symbolsNum = symbolsArray.length;
    var $mandatoryTickers = $modal.find('.sym.form-group').find('input');
    var alerts = $modal.find('input#rtas').prop('checked');
    var numAlerts = alerts ? symbolsNum : null;
    var $error = $modal.find('.sym-error');

    if(symbolsNum >= options.minSymbols || helpers.validateMinTickers($mandatoryTickers, $error, getSymbolsError(symbolsNum)) ){

      onBeforeReg($modal);

      SA.Models.Authentication.signIn({
        id: options.id,
        activity: options.activity,
        'function': options.regStep2Success,
        email: options.email,
        password: options.password,
        rtaSource: options.pageType + '_' + options.activity,
        rtaSlugs: symbolsArray.join(','),
        rtaAddAlerts: numAlerts,
        authorTagId: options.authorTagId,
        articleId: options.article_id,
        symbolsNum: symbolsNum,
        onSuccess: onRegStep2Success,
        onFailure: onRegStep2Failure,
        extra: {dont_send_confirmation_email: true}
      });

    }else{
      sendMoneEvent('error', {num_tickers: symbolsNum, rta_checked: alerts, error_message: $error.text(), mandatory_num_tickers:options.minSymbols});
    }
  };

  var setRegisterEvent = function($modal){
    $modal.find('#reg-btn').on('click', function(event){
      event.preventDefault();
      tryToRegStep2($modal);
    });
  };

  var initialize = function(){
    var $modal = modal.getModalObject();
    prefillTickers($modal);
    setSymbolEvents($modal);
    setRegisterEvent($modal);
  };

  var prefillTickers = function($modal){
    var visited = SA.Data.Cache.get('primary_tickers_visited');
    if (visited){
      initOtherTickers($modal, visited);
    } else {
      initPrimaryTicker($modal);
    }
  };

  var buildModal = function(){
    modal = SA.Widgets.Popup.build({
      className: 'rb-port',
      showHeader: true,
      showCloseBtn: false,
      backdrop: false,
      keyboard: false,
      headerContent:  '<div> <h3>Which Stocks Do You Follow?</h3>Customize Seeking Alpha to your interests. </div> <b> Build Your Portfolio </b>',
      showBody: true,
      bodyContent: JST['jst/widgets/roadblock/roadblock_step2']({ primaryTicker: options.primaryTicker || ''}),
      showFooter: false,
      removeAfterClose: true
    });
    modal.show();
  };
  var centerModal = function() {
    setModalLeft();
    centerVertically();
  };

  var setModalLeft = function (){
    var contentRailOffsetLeft, contentRailWidth, $modalDialog, $contentRail;
    $contentRail = $('#content-rail');
    if($contentRail && $contentRail.length && modal){
      contentRailOffsetLeft = $contentRail.offset().left;
      contentRailWidth = $contentRail.outerWidth();
      $modalDialog = modal.getModalObject().find('.modal-dialog');
      if($modalDialog){
        var modalWidth = $modalDialog.outerWidth();
        $modalDialog.css({
          "margin-left": contentRailOffsetLeft+(contentRailWidth-modalWidth)/2+'px'
        });
      }
    }
  };

  var centerVertically = function() {
    var windowHeight = $(window).height();
    var $modalDialog = modal.getModalObject().find('.modal-dialog');
    var modalDialogHeight = $modalDialog.height();
    $modalDialog.css({
      "margin-top": (windowHeight-modalDialogHeight)/2+'px'
    })
  };

  var removeSetModalLeftOnResizeEvent = function(){
    $(window).off('resize.roadblock');
  };

  scope.show = function(opt){
    opt = opt || {};
    options = $.extend(getDefaultOptions(), opt);
    buildModal();
    initialize();
    centerModal();
    $(window).on('resize.roadblock', centerModal);
  };

  scope.showing = function() {
    return (modal && modal.showing) ? true : false;
  };


}(SA, jQuery, window));













(function(w, SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Widgets.RoadblockStep1');
  var checkEmailLock = false,
    signInLock = false,
    loginLock = false,
    resetLock = false,
    options,
    modal;

  var helpers = SA.Utils.AuthenticationHelpers,
    auth = SA.Models.Authentication,
    articlePage = w.aConf && w.aConf.pagination && w.aConf.pagination.page,
    moneEvent = SA.Logger.Mone.event;

  var errors = {
    defaultMessage: 'There was an error. Please try again later',
    emailNotValid: 'Please enter a valid email address.',
    passwordMissing: 'Please enter your password.',
    passwordNotValid: 'Your password must contain between 8 and 40 characters.',
    login_failed: 'Please check your email and password and try again.',
    blocked_user: 'Login failed, please report your issue on our <a href=' + SA.App.userEchoHost + '>feedback forum</a>',
    no_user: 'Please check your email and try again.',
    too_many_attempts: 'Too many login attempts have been made with an incorrect password. Please press Forgot your password? to reset your password',
    missing_user_details: 'Please check your email and password and try again.',
    already_registered: 'You are already registered, please try the Member sign in.',
    not_activated_not_bounced_user: 'There is already a registration in progress for this email, if you did not receive the confirmation email, please ask your IT department or email provider to place seekingalpha.com in the whitelist and try to register again',
    relevant_link: "You can request one sign in link per hour. Please recheck your email.",
    not_activated_bounced_user: function (date) {
      return 'There is already a registration in progress for this email, but our confirmation email was blocked by your email provider as of ' + date + ', we have attempted to remove the block and sent a password reset email to your inbox.';
    },
    activated_bounced_user: function (date) {
      return 'This email already exists in our system, but was blocked by your email provider as of ' + date + ', we have attempted to remove the block and sent a password reset email to your inbox.';
    }
  };

  var defaultOpt = {
    id: 'login',
    activity: 'roadblock',
    loginSuccess: 'onLoginSuccess',
    regStep1Success: 'onRegStep1Success',
    resetSuccess: 'onResetSuccess',
    pageType: '',
    modal: {
      className: 'sa-rb',
      passwordPlaceholder: 'Choose Password (minimum 8 characters)',
      afterOpen: function () {
        $('#a-cont').removeClass('rb');
      }
    },
    onLoginSuccess: null
  };

  function getError(error) {
    return errors[error] || errors.defaultMessage;
  }

  function emailValid($elem, $errorElem) {
    return helpers.validateEmail($elem, $errorElem, getError('emailNotValid'));
  }

  var passwordValid = function($password, $formError) {
    return helpers.validatePresence($password, $formError, getError('passwordMissing'))
      && helpers.validateSignInPasswordValue($password, $formError, getError('passwordNotValid'));
  };

  function passwordPresent($elem, $errorElem) {
    return helpers.validatePresence($elem, $errorElem, getError('passwordMissing'));
  }

  function sendRegisterEvent(action, data) {
    moneEvent('signup_popup', 'regular_roadblock', action, {data: data});
  }

  function sendLoginEvent(action, data) {
    return moneEvent('roadblock', options.pageType + '_login', action, data ? {data: data} : null);
  }

  //Google login

  function loginWithGoogle() {
    var biData = articlePage ? {page: articlePage, rbType: 'regular_roadblock'} : {rbType: 'regular_roadblock'};
    auth.googleLogin('gplus_popup', 'regular_roadblock', 'shown', {data: biData});
  }

  // CALLBACKS

  //Password Reset

  var beforePwdReset = function($modal) {
    resetLock = true;
    helpers.hideErrors($modal.find('#log-error'));
    $modal.find('#rb_forgot_pwd').find('.sa-loader').removeClass('hidden');
  };

  var afterPwdReset = function() {
    resetLock = false;
    modal.getModalObject().find('#rb_forgot_pwd').find('.sa-loader').addClass('hidden');
  };

  var resetPwdClb = function($modal) {
    $modal.find('#rb_one_click_login').addClass('hidden');
    $modal.find('#rb_forgot_pwd').toggleClass('hidden');
    $modal.find('.alert').addClass('hidden');
    $modal.find('.has-error').removeClass('has-error');
    sendLoginEvent('clicked_forgot_password');
  };

  var handleResetFailure = function(response, opt) {
    var errorContainer = modal.getModalObject().find('#log-error');
    $('.has-success').removeClass('has-success');
    moneEvent('roadblock', 'article_login_forgot_password','error', {data: {error_message: response.message, email : opt.email}});
    switch(response.message) {
      case 'not_confirmed_email_yet':
        return helpers.rbErrorPopup(w.JST['jst/popups/authentication/not_confirmed_email_yet'](), 'Confirm your registration', modal, true);
      case 'not_confirmed_email_still':
        return helpers.rbErrorPopup(w.JST['jst/popups/authentication/not_confirmed_email_still'](), 'Confirm your registration', modal, true);
      default:
        return helpers.showError(errorContainer, getError(response.message));
    }
  };

  var handleResetSuccess = function(opt) {
    sendLoginEvent('forgot_password_success', {email: opt.email});
    helpers.rbErrorPopup(w.JST['jst/popups/authentication/password_reset'](), 'Password reset', modal, true);
  };

  var onResetSuccess = function(response, opt) {
    response = response || {};
    afterPwdReset();

    return response.forgot_password ? handleResetSuccess(opt) : handleResetFailure(response, opt);
  };

  var onResetFailure = function(response, opt) {
    afterPwdReset();
    SA.exceptions.push(['Authentication: Reset password error', {}, {
      status: response.status,
      statusText: response.statusText,
      responseText: response.responseText,
      opt: opt
    }]);
  };

  var handleForgotPassword = function($modal) {
    if (!resetLock) {
      var $email = $modal.find('#rb_forgot_pwd_email'),
        $formError = $modal.find('#log-error');

      if (emailValid($email, $formError)) {
        beforePwdReset($modal);

        auth.resetPassword({
          id: options.id,
          activity: options.activity,
          'function': options.resetSuccess,
          email: $email.val().trim(),
          onSuccess: onResetSuccess,
          onFailure: onResetFailure
        });
      } else {
        sendLoginEvent('error', {error_message: $formError.text()});
      }
    }
  };

  // One Click Login

  var beforeOneClickLogin = function($modal) {
    resetLock = true;
    helpers.hideErrors($modal.find('#log-error'));
    $modal.find('#rb_one_click_login').find('.sa-loader').removeClass('hidden');
  };

  var afterOneClickLogin = function() {
    resetLock = false;
    modal.getModalObject().find('#rb_one_click_login').find('.sa-loader').addClass('hidden');
  };

  var OneClickLoginclb = function($modal) {
    $modal.find('#rb_forgot_pwd').addClass('hidden');
    $modal.find('#rb_one_click_login').toggleClass('hidden');
    $modal.find('.alert').addClass('hidden');
    $modal.find('.has-error').removeClass('has-error');
    SA.Logger.Mone.event('hard_roadblock','click_one_time_link_popup');
  };

  var handleOneClickLoginFailure = function(response, opt) {
    var errorContainer = modal.getModalObject().find('#log-error');
    $('.has-success').removeClass('has-success');
    SA.Logger.Mone.event('', 'hard_roadblock', 'one_time_login_link_error', {data: {error_message: response.message, email : opt.email}});
    switch(response.message) {
      case 'not_confirmed_email_yet':
        return helpers.rbErrorPopup(w.JST['jst/popups/authentication/not_confirmed_email_yet'](), 'Confirm your registration', modal, true);
      case 'not_confirmed_email_still':
        return helpers.rbErrorPopup(w.JST['jst/popups/authentication/not_confirmed_email_still'](), 'Confirm your registration', modal, true);
      default:
        return helpers.showError(errorContainer, getError(response.message));
    }
  };

  var handleOneClickLoginSuccess = function(opt) {
    SA.Logger.Mone.event('hard_roadblock','one_time_login_link_sent');
    helpers.rbErrorPopup(w.JST['jst/popups/authentication/one_time_login']({email: opt.email}), 'One Time Login', modal)
  };

  var onOneClickLoginSuccess = function(response, opt) {
    response = response || {};
    afterOneClickLogin();

    return response.login_link ? handleOneClickLoginSuccess(opt) : handleOneClickLoginFailure(response, opt);
  };

  var onOneClickLoginFailure = function(response, opt) {
    afterOneClickLogin();
    SA.exceptions.push(['Authentication: One click login error', {}, {
      status: response.status,
      statusText: response.statusText,
      responseText: response.responseText,
      opt: opt
    }]);
  };

  var handleOneClickLogin = function($modal) {
    if (!resetLock) {
      var $email = $modal.find('#rb_one_click_login_email'),
        $formError = $modal.find('#log-error');
      if (emailValid($email, $formError)) {
        beforeOneClickLogin($modal);
        auth.oneClickLogin({
          id: options.id,
          activity: options.activity,
          'function': options.oneTimeClickSuccsess,
          email: $email.val().trim(),
          onSuccess: onOneClickLoginSuccess,
          onFailure: onOneClickLoginFailure
        });
      } else {
        sendOneClickLoginEvent('error', {error_message: $formError.text()});
      }
    }
  };

  //checkEmail

  var onBeforeCheckEmail = function($modal) {
    checkEmailLock = true;
    helpers.hideErrors($modal.find('#reg-error'));
    helpers.addLoader($modal.find('#reg-btn'));
  };

  var onAfterCheckEmail = function() {
    checkEmailLock = false;
  };

  var handleActivatedEmail = function(response, opt) {
    if(response.user_exists){
      var $modal = modal.getModalObject();
      toggleRegLogin($modal);
      $modal.find('#rb_step1_login_email').val(opt.email);
      $modal.find('#rb_step1_login_password').val(opt.password);

      tryToLogIn($modal, true);
    }
  };

  var showEmailErrorMessage = function(container, message, email){
    sendRegisterEvent('error', {email: email, error_message: message});
    helpers.showError(container, message);
  };


  var handleNonActivatedEmail = function(response, opt) {
    var errorContainer = modal.getModalObject().find('#reg-error');
    $('.has-success').removeClass('has-success');
    switch(response.message) {
      case 'not_activated_not_bounced_user':
        return showEmailErrorMessage(errorContainer, getError('not_activated_not_bounced_user'), opt.email);
      case 'activated_bounced_user':
        return showEmailErrorMessage(errorContainer, getError('activated_bounced_user'), opt.email);
      case 'not_activated_bounced_user':
        return showEmailErrorMessage(errorContainer, getError('not_activated_bounced_user')(response.date), opt.email);
      default:
        return tryToRegStep1(opt);
    }
  };

  var onCheckEmailSuccess = function(response, opt){
    onAfterCheckEmail();
    response = response || {};
    return response.user_exists ? handleActivatedEmail(response, opt) : handleNonActivatedEmail(response, opt);
  };

  var tryCheckEmail = function ($modal) {
    if (signInLock || checkEmailLock) {
      return;
    }

    var $email = $modal.find('#rb_step1_reg_email'),
      $password = $modal.find('#rb_step1_reg_password'),
      $formError = $modal.find('#reg-error');

    if (emailValid($email, $formError) && passwordValid($password, $formError)) {
      onBeforeCheckEmail($modal);

      auth.checkEmail({
        email: $email.val().trim(),
        password: $password.val(),
        onSuccess: onCheckEmailSuccess,
        onFailure: onAfterCheckEmail,
        sender: true
      });
    } else {
      sendRegisterEvent('error', {email: $email.val().trim(), error_message: $formError.text()});
    }
  };


  // Register Step 1


  var onAfterRegStep1 = function() {
    signInLock = false;
    helpers.removeLoader(modal.getModalObject().find('#reg-btn'));
  };

  var handleRegStep1Failure = function(response, opt) {
    var errorContainer = modal.getModalObject().find('#reg-error');
    $('.has-success').removeClass('has-success');

    sendRegisterEvent('reg_failure', {error: response.message, email : opt.email});

    switch(response.message) {
      case 'not_confirmed_email_yet':
        return helpers.rbErrorPopup(w.JST['jst/popups/authentication/not_confirmed_email_yet'](), 'Confirm your registration', modal, true);
      case 'not_confirmed_email_still':
        return helpers.rbErrorPopup(w.JST['jst/popups/authentication/not_confirmed_email_still'](), 'Confirm your registration', modal, true);
      case 'activated_bounced_user':
        return helpers.rbErrorPopup(w.JST['jst/popups/authentication/activated_bounced_user']({data: response.date}), 'This email already exists', modal, true);
      case 'not_activated_bounced_user':
        return helpers.rbErrorPopup(w.JST['jst/popups/authentication/not_activated_bounced_user']({data: response.date}), 'Registration in progress', modal, true);
      case 'not_activated_not_bounced_user':
        return helpers.rbErrorPopup(w.JST['jst/popups/authentication/not_activated_not_bounced_user'](), 'Registration in progress', modal, true);
      default:
        return helpers.showError(errorContainer, getError(response.message));
    }
  };

  var handleRegStep1Success = function(opt) {
    var biData = articlePage ? {email: opt.email, page: articlePage} : {email: opt.email};
    sendRegisterEvent('register', biData);
    modal.hide();
    SA.Widgets.RoadblockStep2.show(opt);
  };


  var onRegStep1Success = function(response, opt) {
    response = response || {};
    onAfterRegStep1();

    return response.registration ? handleRegStep1Success(opt) : handleRegStep1Failure(response, opt);
  };


  var tryToRegStep1 = function(opt){
    if (checkEmailLock || signInLock) {
      return;
    }

    if (opt.email && opt.password) {
      signInLock = true;

      auth.signIn({
        id: options.id,
        activity: options.activity,
        'function': options.regStep1Success,
        pageType: options.pageType,
        sender: true,
        email: opt.email,
        password: opt.password,
        rtaAddAlerts: 1,
        rtaSource: 'hard_roadblock',
        author_tag_id_to_follow: options.authorTagId,
        primaryTicker: options.primaryTicker,
        articleId: SA.pageConfig.Data.article && SA.pageConfig.Data.article.id,
        onSuccess: onRegStep1Success,
        onFailure: onAfterRegStep1,
        backdrop: false
      });
    }
  };


  // LogIn

  var onBeforeLogin = function($modal) {
    loginLock = true;
    helpers.hideErrors($modal.find('#log-error'));
    helpers.addLoader($modal.find('#log-btn'));
  };

  var onAfterLogin = function() {
    loginLock = false;
    helpers.removeLoader(modal.getModalObject().find('#log-btn'));
  };

  var handleLogInSuccess = function(opt) {
    var biData = articlePage ? {email: opt.email, page: articlePage} : {email: opt.email};
    if (opt.fromReg) {
      moneEvent('signup_popup', 'regular_roadblock', 'regislogin', {data: biData});
    } else {
      moneEvent('signin_popup', 'regular_roadblock', 'login_success', {data: biData});
    }

    if($.isFunction(options.onLoginSuccess)) {
      return options.onLoginSuccess();
    }
    return location.reload();
  };


  var handleLogInFailure = function(response, opt) {
    onAfterLogin();

    sendLoginEvent('error', {error_message: response.message, email: opt.email});

    var errorContainer = modal.getModalObject().find('#log-error');
    $('.has-success').removeClass('has-success');
    switch(response.message) {
      case 'not_confirmed_email_yet':
        return helpers.rbErrorPopup(w.JST['jst/popups/authentication/not_confirmed_email_yet'](), 'Confirm your registration', modal, true);
      case 'not_confirmed_email_still':
        return helpers.rbErrorPopup(w.JST['jst/popups/authentication/not_confirmed_email_still'](), 'Confirm your registration', modal, true);
      case 'too_many_attempts':
        loginLock = false;
        return helpers.showError(errorContainer, getError('too_many_attempts'));
      default:
        return helpers.showError(errorContainer, getError(response.message));
    }
  };

  var onLogInSuccess = function(response, opt) {
    response = response || {};
    return response.login ? handleLogInSuccess(opt) : handleLogInFailure(response, opt);
  };

  var tryToLogIn = function($modal, fromReg) {
    if (!loginLock) {
      fromReg = fromReg || false;

      var $email = $modal.find('#rb_step1_login_email'),
        $password = $modal.find('#rb_step1_login_password'),
        $formError = $modal.find('#log-error');

      $formError.html('');

      if (emailValid($email, $formError) && passwordPresent($password, $formError)) {
        onBeforeLogin($modal);

        auth.logIn({
          id: options.id,
          activity: options.activity,
          'function': options.loginSuccess,
          email: $email.val().trim(),
          password: $password.val(),
          onSuccess: onLogInSuccess,
          onFailure: onAfterLogin,
          fromReg: fromReg
        });
      } else {
        sendLoginEvent('error', {email: $email.val().trim(), error_message: $formError.text()});
      }
    }
  };

  //toggle register/login

  var toggleRegLogin = function($modal) {
    $modal.find('#reg-form').toggleClass('hidden');
    $modal.find('#log-form').toggleClass('hidden');
    resetForms($modal);
    sendSwitchEvent($modal);
  };

  var resetForms = function($modal){
    $modal.find('.has-error').removeClass('has-error');
    $modal.find('.has-success').removeClass('has-success');
    $modal.find('input.form-control').val('');
    $modal.find('.alert').not('.hidden').addClass('hidden').text('');
    $modal.find('#rb_forgot_pwd').not('.hidden').addClass('hidden');
    $modal.find('#rb_one_click_login').not('.hidden').addClass('hidden');
  };

  var sendSwitchEvent = function($modal){
    if ($modal.find('#reg-form').hasClass('hidden')) {
      sendRegisterEvent('switch_to_login');
    } else {
      sendRegisterEvent('switch_to_register');
    }
  };

  // Event listener

  var setRegisterEvents = function($modal) {
    $modal.find('#rb_step1_reg_form').on('submit', function(event){
      event.preventDefault();
      $modal.find('#rb_forgot_pwd').addClass('hidden');
      tryCheckEmail($modal);
    });
  };

  var setLogInEvents = function($modal) {
    $modal.find('#rb_step1_login_form').on('submit', function(event){
      event.preventDefault();
      $modal.find('#rb_forgot_pwd').addClass('hidden');
      tryToLogIn($modal);
    });
  };

  var setGoogleLoginEvents = function($modal) {
    $modal.find('#log-google').on('click', function(event){
      setArticleMadeUserRegister(SA.pageConfig.Data.article.id);
      event.preventDefault();
      loginWithGoogle();
    });
  };

  function setArticleMadeUserRegister(articleId){
    $.post('/articles/article_made_user_register', {article_id: articleId});
  }

  var setForgotPasswordEvents = function($modal) {
    $modal.find('#rst-pwd').on('click', function(event){
      event.preventDefault();
      resetPwdClb($modal);
    });

    $modal.find('#rb_forgot_pwd').on('submit', function(event){
      event.preventDefault();
      handleForgotPassword($modal);
    });
  };

  var setOneClickLoginEvents = function($modal) {
    $modal.find('#one-time-link').on('click', function(event){
      event.preventDefault();
      OneClickLoginclb($modal);
    });

    $modal.find('#rb_one_click_login').on('submit', function(event){
      event.preventDefault();
      handleOneClickLogin($modal);
    });
  };

  var setRegLoginSwitchEvents = function($modal){
    $modal.find('.switch-btn').on('click', function(event){
      event.preventDefault();
      toggleRegLogin($modal);
    });
  };

  var setEventListeners = function(modal) {
    var $modal = modal.getModalObject();
    setRegisterEvents($modal);
    setLogInEvents($modal);
    setGoogleLoginEvents($modal);
    setForgotPasswordEvents($modal);
    setOneClickLoginEvents($modal);
    setRegLoginSwitchEvents($modal);
  };

  // Popup builders

  function initialize() {
    showRbPopup();
    centerModal();
    $(w).on('resize.roadblock', centerModal);
  }

  function showRbPopup() {
    modal = buildRbModal();
    setEventListeners(modal);
    modal.show();
    moneEvent('signup_popup', 'regular_roadblock', 'shown', {data: articlePage ? {page: articlePage} : ''});
  }

  function buildRbModal() {
    var bodyContent = getModalBody();
    if (bodyContent) {
      return SA.Widgets.Popup.build({
        className: options.modal.className,
        backdrop: false,
        keyboard: false,
        showHeader: false,
        showCloseBtn: false,
        showBody: true,
        bodyContent: bodyContent,
        showFooter: false,
        removeAfterClose: true,
        afterOpen: options.modal.afterOpen
      });
    }
  }

  function getModalBody() {
    return w.JST['jst/widgets/roadblock/roadblock_step1']({
      usersOnSite: SA.App.usersOnSite,
      host: SA.App.host,
      type: options.pageType,
      passwordPlaceholder: options.modal.passwordPlaceholder,
      googleBtn: window.JST['jst/widgets/button/google_btn'](
        {
          googleSvg: window.JST['jst/inline_svg/google']({ width: 32, withBorder: false })
        }),
      googleSvg: window.JST['jst/inline_svg/google']({ width: 32, withBorder: true })
    }) || '';
  }

  function centerModal() {
    setModalLeft();
    centerVertically();
  }

  function setModalLeft() {
    var contentRailOffsetLeft, contentRailWidth, $modalDialog, $contentRail;
    $contentRail = $('#content-rail');
    if ($contentRail && $contentRail.length && modal) {
      contentRailOffsetLeft = $contentRail.offset().left;
      contentRailWidth = $contentRail.outerWidth();
      $modalDialog = modal.getModalObject().find('.modal-dialog');
      if ($modalDialog) {
        var modalWidth = $modalDialog.outerWidth();
        $modalDialog.css({'margin-left': contentRailOffsetLeft + (contentRailWidth - modalWidth) / 2 + 'px'});
      }
    }
  }

  function centerVertically() {
    var height = $(w).height(),
      $modalDialog = modal.getModalObject().find('.modal-dialog'),
      modalDialogHeight = $modalDialog.height();

    $modalDialog.css({'margin-top': (height - modalDialogHeight) / 2 + 'px'});
  }

  scope.show = function(opt) {
    opt = opt || {};
    options = $.extend({}, defaultOpt, opt);
    initialize();
  };

  scope.showing = function() {
    return !!(modal && modal.showing);
  };

}(window, window.SA, window.jQuery));
(function() { this.JST || (this.JST = {}); this.JST["jst/inline_svg/close_btn"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="15" height="15">\n  <path fill="#999999" d="M14.59,8L12,10.59,9.41,8,8,9.41,10.59,12,8,14.59,9.41,16,12,13.41,14.59,16,16,14.59,13.41,12,16,9.41ZM12,2A10,10,0,1,0,22,12,10,10,0,0,0,12,2Zm0,18a8,8,0,1,1,8-8A8,8,0,0,1,12,20Z" transform="translate(-2 -2)"></path>\n</svg>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/roadblock/roadblock_step1_v1"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push(''); 
  var checkboxElement;
  
  if (ticker && ticker.length) {
      checkboxElement = '<input type="checkbox" name="ticker_rta_checkbox" value="" checked><span>Get email alerts on </span><span class="orange">' + ticker.toUpperCase() + '</span>'
  } else {
      checkboxElement = '<input type="checkbox" name="theme_news_checkbox" value="" checked><span>Get all our top </span><span class="orange">' + theme['val'] + '</span><span> stories in a daily email</span>'
  }
  ; __p.push('\n\n<div id="hard-reg">\n    <div class="soft-body">\n        <div class="left-col">\n            <div class="header">\n                <span class="heading"><span class="orange">Register for free</span> to finish reading this article </span>\n            </div>\n            <form id="rb-reg-form" autocomplete="off">\n                <div class="form-group">\n                    <input type="email" class="form-control" autocomplete="off" spellcheck="false" placeholder="Email Address" data-id="form-email">\n                    <div class="sub-container">\n                        <div class="error-container">\n                            <div id="reg-error" class="rb-alert hidden" role="alert"></div>\n                        </div>\n                        <div class="checkbox-container">',  checkboxElement ,'</div>\n                    </div>\n                    <input type="submit" class="btn reg-orange-btn" value="Register"/>\n\n                </div>\n            </form>\n            <div class="footer small">\n                <span>Already have an account?</span><span class="switch-btn"> Sign in</span>\n                <br>\n                <span>Not ready to register yet? <a href="/latest-articles?source=hard_roadblock_register" target="_blank">Explore additional content</a></span>\n            </div>\n            <div class="footer supersmall">\n                <span>By clicking Register, I agree to Seeking Alphas <a href="/page/terms-of-use?source=hard_roadblock_register" target="_blank"> terms of use</a> and <a href="/page/privacy?source=hard_roadblock_register" target="_blank">privacy policy</a>.</span>\n            </div>\n        </div>\n        <div class="right-col">\n            <div class="article-title">\n                <span>',  articleTitle ,'</span>\n            </div>\n            <div class="article-info">\n                <span>',  articlePublicationDate ,'</span>\n                ');  if (articleCommentsNumber > 0) { ; __p.push('\n                    <span> | ',  articleCommentsNumber ,' comments</span>\n                ');  } ; __p.push('\n                ');  if (ticker && ticker.length) { ; __p.push('\n                    <span> |  About: ',  ticker.toUpperCase() ,'</span>\n                ');  } ; __p.push('\n            </div>\n            <div class="author-info">\n                <span>By ',  articleAuthorInfo ,'</span>\n            </div>\n            <div class="article-content">\n                ');  if (articleBullets.length) { ; __p.push('\n                    <ul>\n                        ');  articleBullets.forEach(function(element) {  ; __p.push('\n                        <li>',  element ,'</li>\n                        ');   }); ; __p.push('\n                    </ul>\n                ');  } else if (articleFirstParagraph.length) { ; __p.push('\n                    <p>',  articleFirstParagraph ,'</p>\n                ');  } ; __p.push('\n            </div>\n            <div class="blur-cover"></div>\n        </div>\n    </div>\n</div>\n<div class="hidden" id="hard-login">\n    <div class="soft-body">\n        <div class="header">\n            <span class="heading">Please sign in:</span>\n        </div>\n        <form id="rb-login-form" autocomplete="on">\n            <div class="left-col">\n                <div class="form-group">\n                    <input type="email" class="form-control" id="rb_login_email" autocomplete="on" spellcheck="false" placeholder="Email Address" data-id="form-email">\n                </div>\n                <div class="form-group">\n                    <input type="password" class="form-control" id="rb_login_password" autocomplete="on" spellcheck="false" placeholder="Password" data-id="form-pwd">\n                </div>\n                <input type="submit" id="log-btn" class="btn orange-btn" value="Sign in">\n                <div class="frgt-pwd"><a href="#" id="rst-pwd">Forgot password?</a></div>\n            </div>\n            <div class="right-col">\n                <div id="log-google" class="goog-btn log-google">',  googleBtn ,'</div>\n                <input type="submit" class= "btn otl-login" id="one-click-link" value="Email me a sign in link">\n            </div>\n        </form>\n        <div class="error-container">\n            <div id="log-error" class="rb-alert hidden" role="alert"></div>\n        </div>\n    </div>\n    <div class="soft-footer">\n        <span>Dont have an account?<span class="switch-btn"> Register</span></span>\n    </div>\n</div>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/roadblock/roadblock_step2_v1"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<table class="table">\n  <thead>\n    <tr>\n      <th class="sym">Symbol</th>\n      <th>Price</th>\n      <th>% Chg</th>\n      <th>Remove</th>\n    </tr>\n  </thead>\n  <tbody>\n  ');  for(var i = 0; i < 8; i++) { ; __p.push('\n    <tr class="',  (i%2 === 1)? 'b-g' : '' ,'">\n      <td class="sym">\n        <input id="s_input', i,'" type="text" placeholder="Type Ticker" maxlength="9" value=""/>\n      </td>\n      <td class="p">-</td>\n      <td class="c">-</td>\n      <td><span class="rmv"></span></td>\n    </tr>\n  ');  } ; __p.push('\n  </tbody>\n</table>\n<div>\n  <div class="testimonial"><em> "I love the short emails these "bite-sized" emails are quick reads and keep me informed." </em></div>\n  <div class="right"> - Alan, Seeking Alpha user for over 7 years </div>\n</div>\n<div class="get-alerts">\n  <input type="checkbox" id="rtas" checked>\n  <span>Send me breaking news and articles on my stocks</span>\n</div>\n<input type="submit" id="reg-btn" class="btn orange-btn" value="Complete Free Registration"/>\n<div class="sym-error" class="alert alert-danger hidden" role="alert"></div>\n');}return __p.join('');};
}).call(this);




(function(SA, $, w){

  "use strict";

  var scope = SA.UsingNamespace('SA.Widgets.RoadblockStep2_v1');
  var modal = null;
  var regLock = false;
  var helpers = SA.Utils.AuthenticationHelpers;
  var options;
  var articlePage = w.aConf && w.aConf.pagination && w.aConf.pagination.page;

  var symbolError = {
    defaultMessage: 'There was an error. Please try again later',
    already_registered: 'Please check your email and password and try the Member sign in.',
    regis_login: 'You can manage your stocks from the Portfolio tab.',
    addOneStockMessage: '* Please enter at least 1 stock to continue' ,
    addStocksMessage: function(n) { return '* Please add at least '+ n + ' stocks to continue.'; }
  };

  var getError = function(error) {
    return symbolError[error] || symbolError.defaultMessage;
  };

  var getDefaultOptions = function(){
    return {
      id: 'login',
      activity: 'roadblock',
      pageType: null,
      email: null,
      password: null,
      regStep2Success: 'onRegStep2Success',
      afterClose: removeSetModalLeftOnResizeEvent,
      minSymbols: 1
    };
  };

  var sendMoneEvent = function(action, opt){
    opt = opt || {};
    var data = $.extend({}, {email: options.email} , opt);
    return SA.Logger.Mone.event('roadblock', options.pageType + '_register' , action, {data:data} );
  };

  //portfolio unit

  var onAfterAddSymbol = function($row){
    $row.find('.p').removeClass('sa-loader');
    $row.find('.c').removeClass('sa-loader');
  };

  var onBeforeAddSymbol = function($row){
    $row.find('.p').text('').addClass('sa-loader');
    $row.find('.c').text('').addClass('sa-loader');
  };

  var handleSQFailure = function(data, $row) {
    $row.find('input').val('');
    $row.find('.p').text('-');
    $row.find('.c').text('-');
    onAfterAddSymbol($row);
    SA.exceptions.push(['rb-portfolio: SuperQuote fail', {}, data]);
  };

  var handleSQSuccess = function(data, $row) {
    onAfterAddSymbol($row);
    $row.find('.has-error').removeClass('has-error');
    $row.find('.p').text(data.last);
    $row.find('.c')
      .text(data.percent > 0 ? '+' + data.percent : data.percent)
      .css('color', data.percent > 0 ? 'green' : data.percent < 0 ? 'red' : 'gray');
  };

  var validResponse = function(data) {
    data = data || {};
    return $.isNumeric(data.last) || $.isNumeric(data.percent);
  };

  var mapResponse = function (res, slug) {
    var response = (res || {})[slug.toLowerCase()],
      data = {};
    if (!response) return data;
    data.last = SA.Utils.Formatter.number(response.Last || response.latestPrice);
    data.percent = SA.Utils.Formatter.number(response.PercentChange || response.changePercent, {prefix: '%'});
    return data;
  };

  var handleSuperQuotes = function(res, slug, $row) {
    var data = mapResponse(res, slug);
    return validResponse(data) ? handleSQSuccess(data, $row) : handleSQFailure(data, $row);
  };

  var addSymbolData= function($row, slug) {
    onBeforeAddSymbol($row);
    SA.Utils.SymbolData.getFromSuperQuotes([slug], function(response){
      handleSuperQuotes(response, slug, $row);
    });
  };

  var initSymbolData = function($row){
    var $input = $row.find('input');
    $input.on('keypress', function (event) {
      if (event.keyCode === 13) {
        $('#' + this.id + '_sa_autocomplete').hide();
        addSymbolData($row, $input.val());
      }
    }).on('keyup', function () {
      this.value = this.value.toUpperCase();
    });
  };

  var initAutocomplete = function($row){
    var $input = $row.find('input');
    return new SA.Utils.Autocomplete($input, {
      authors: false,
      symbols: true,
      symbolSelectCallback: function(slug){$input.val(slug); addSymbolData($row, slug);}
    });
  };

  var initRemoveBtn = function($row){
    $row.on('click', '.rmv', function(){
      $row.find('input').val('');
      $row.find('.p').text('-');
      $row.find('.c').text('-');
    });
  };

  var initSymbolRow = function($row){
    initAutocomplete($row);
    initSymbolData($row);
    initRemoveBtn($row);
  };


  var initOtherTickers = function($modal, visited){
    var array = visited.split(',');
    var index = array.indexOf(options.primaryTicker);
    if (index > -1) {
      array.splice(index, 1);
    }

    var $rows = $modal.find('tbody').find('tr');
    $.map($rows, function(row){
      var i = row.sectionRowIndex;
      var ticker = array[i];
      row = $(row);
      if(ticker){
        var $input =row.find('input');
        $input.val(ticker.toUpperCase());
        return addSymbolData(row, ticker)
      }
    });
  };

  var setSymbolEvents = function($modal){
    var rows = $modal.find('tbody').find('tr');
    $.map(rows, function(r){return initSymbolRow($(r));});
    $(rows.find('.sym').splice(0, options.minSymbols)).addClass('form-group');
  };

  //Register Step 2

  var onBeforeReg = function($modal){
    regLock = true;
    helpers.hideErrors($modal.find('#symbol-error'));
    helpers.addLoader($modal.find('#reg-btn'));
  };

  var onAfterReg = function(){
    regLock = false;
    helpers.removeLoader(modal.getModalObject().find('#reg-btn'));
  };

  var getSymbols = function($inputs){
    var symbolArr = [];
    var symbol;
    $.each($inputs, function(index,value){
      symbol = $(value).val();
      if(symbol.length){
        symbolArr.push(symbol);
      }
    });
    return symbolArr;
  };

  var getSymbolsError = function(n){
    var missing = options.minSymbols - n ;
    if(missing === 0) return;
    return missing === 1 ? getError('addOneStockMessage') : getError('addStocksMessage')(missing);
  };

  var onRegStep2Failure = function(response, opt){
    onAfterReg();
  };

  var handleRegStep2Failure = function(response) {
    switch(response.message) {
      case 'regis_login':
        return helpers.rbErrorPopup(getError('regis_login'), 'The stocks youve marked have been added to your portfolio', modal, true);
      case 'already_registered':
        return helpers.rbErrorPopup(getError('already_registered'), 'You are already registered', modal, true);
      default:
        return helpers.rbErrorPopup(getError('defaultMessage'), '', modal, true);
    }
  };

  var handleRegStep2Success = function(opt) {
    modal.hide();
    var biData =  {email: opt.email, RTA_checkbox: (opt.rtaAddAlerts ? 'checked' : 'unchecked'), portfolio_slugs: opt.rtaSlugs};
    if (articlePage) {biData.page = articlePage;}
    SA.Logger.Mone.event('portfolio_popup', 'regular_roadblock', 'input',  {data: biData});
    SA.Utils.Observer.publish('registration/success-popup', {
      email:opt.email,
      backdrop: false,
      keyboard: false,
      showCloseBtn: false,
      fromRoadblock: true,
      source: 'regular_roadblock'
    });
  };

  var onRegStep2Success = function(response, opt) {
    response = response || {};
    onAfterReg();

    return response.registration ? handleRegStep2Success(opt) : handleRegStep2Failure(response, opt);
  };

  var tryToRegStep2 = function($modal){
    if(regLock){
      return;
    }

    var $symbolInputs = $modal.find('.sym').find('input');
    var symbolsArray = getSymbols($symbolInputs);
    var symbolsNum = symbolsArray.length;
    var $mandatoryTickers = $modal.find('.sym.form-group').find('input');
    var alerts = $modal.find('input#rtas').prop('checked');
    var numAlerts = alerts ? symbolsNum : null;
    var $error = $modal.find('.sym-error');

    if(symbolsNum >= options.minSymbols || helpers.validateMinTickers($mandatoryTickers, $error, getSymbolsError(symbolsNum)) ){

      onBeforeReg($modal);

      SA.Models.Authentication.hardRoadblockSignIn({
        id: options.id,
        activity: 'roadblock_step2',
        'function': options.regStep2Success,
        email: options.email,
        password: options.password,
        rtaSource: 'hard_roadblock_v2',
        rtaSlugs: symbolsArray.join(','),
        rtaAddAlerts: numAlerts,
        authorTagId: options.authorTagId,
        articleId: options.article_id,
        symbolsNum: symbolsNum,
        onSuccess: onRegStep2Success,
        onFailure: onRegStep2Failure,
        extra: {dont_send_confirmation_email: true}
      });

    }else{
      sendMoneEvent('error', {num_tickers: symbolsNum, rta_checked: alerts, error_message: $error.text(), mandatory_num_tickers:options.minSymbols});
    }
  };

  var setRegisterEvent = function($modal){
    $modal.find('#reg-btn').on('click', function(event){
      event.preventDefault();
      tryToRegStep2($modal);
    });
  };

  var initialize = function(){
    var $modal = modal.getModalObject();
    prefillTickers($modal);
    setSymbolEvents($modal);
    setRegisterEvent($modal);
  };

  var prefillTickers = function($modal){
    var visited = SA.Data.Cache.get('primary_tickers_visited');
    if (visited){
      initOtherTickers($modal, visited);
    }
  };

  var buildModal = function(){
    modal = SA.Widgets.Popup.build({
      className: 'rb-port',
      showHeader: true,
      showCloseBtn: false,
      backdrop: false,
      keyboard: false,
      headerContent:  '<div> <h3>Which Stocks Do You Follow?</h3>Customize Seeking Alpha to your interests. </div> <b> Build Your Portfolio </b>',
      showBody: true,
      bodyContent: JST['jst/widgets/roadblock/roadblock_step2_v1']({ primaryTicker: options.primaryTicker || ''}),
      showFooter: false,
      removeAfterClose: true
    });
    modal.show();
  };
  var centerModal = function() {
    setModalLeft();
    centerVertically();
  };

  var setModalLeft = function (){
    var contentRailOffsetLeft, contentRailWidth, $modalDialog, $contentRail;
    $contentRail = $('#content-rail');
    if($contentRail && $contentRail.length && modal){
      contentRailOffsetLeft = $contentRail.offset().left;
      contentRailWidth = $contentRail.outerWidth();
      $modalDialog = modal.getModalObject().find('.modal-dialog');
      if($modalDialog){
        var modalWidth = $modalDialog.outerWidth();
        $modalDialog.css({
          "margin-left": contentRailOffsetLeft+(contentRailWidth-modalWidth)/2+'px'
        });
      }
    }
  };

  var centerVertically = function() {
    var windowHeight = $(window).height();
    var $modalDialog = modal.getModalObject().find('.modal-dialog');
    var modalDialogHeight = $modalDialog.height();
    $modalDialog.css({
      "margin-top": (windowHeight-modalDialogHeight)/2+'px'
    })
  };

  var removeSetModalLeftOnResizeEvent = function(){
    $(window).off('resize.roadblock');
  };

  scope.show = function(opt){
    opt = opt || {};
    opt.activity = 'roadblock'
    options = $.extend(getDefaultOptions(), opt);
    buildModal();
    initialize();
    centerModal();
    $(window).on('resize.roadblock', centerModal);
  };

  scope.showing = function() {
    return (modal && modal.showing) ? true : false;
  };


}(SA, jQuery, window));













(function(SA, $, cookie){

  "use strict";

  var scope = SA.UsingNamespace('SA.Widgets.RoadblockStep1_v1');
  var checkEmailLock = false;
  var signInLock = false;
  var loginLock = false;
  var resetLock = false;
  var options;
  var modal;
  var helpers = SA.Utils.AuthenticationHelpers;
  var articlePage = window.aConf && window.aConf.pagination && window.aConf.pagination.page;

  var $popupModal, $regForm, $loginForm, $regContainer, $loginContainer, $resetPwdBtn, $oneClickLoginBtn, $googleLoginBtn, $switchLoginBtn, $closeFormBtn, $articleContainer;
  var articleEmailTheme = {}, userEmailExists = false, cookieExpiration = 24*60*60;

  var getError = function(error) {
    var errors = {
      defaultMessage: 'There was an error. Please try again later',
      emailNotValid: 'Please enter a valid email address.',
      passwordMissing: 'Please enter your password.',
      passwordNotValid: 'Your password must contain between 4 and 40 characters.',
      login_failed: 'Please check your email and password and try again.',
      blocked_user: 'Login failed, please report your issue on our <a href=' + SA.App.userEchoHost + '>feedback forum</a>',
      no_user: 'Please check your email and try again.',
      too_many_attempts: 'Too many login attempts have been made with an incorrect password. Please press Forgot your password? to reset your password',
      missing_user_details: 'Please check your email and password and try again.',
      already_registered: 'You are already registered, please try the Member sign in.',
      not_activated_not_bounced_user: 'There is already a registration in progress for this email, if you did not receive the confirmation email, please ask your IT department or email provider to place seekingalpha.com in the whitelist and try to register again',
      relevant_link: "You can request one sign in link per hour. Please recheck your email.",
      not_activated_bounced_user: function(date){ return 'There is already a registration in progress for this email, but our confirmation email was blocked by your email provider as of ' + date + ', we have attempted to remove the block and sent a password reset email to your inbox.';},
      activated_bounced_user: function(date){return 'This email already exists in our system, but was blocked by your email provider as of '+date+', we have attempted to remove the block and sent a password reset email to your inbox.'; }
    };

    return errors[error] || errors.defaultMessage;
  };

  var getDefaultOptions = function() {
    return {
      id: 'login',
      activity: 'roadblock',
      loginSuccess: 'onLoginSuccess',
      regStep1Success: 'onRegStep1Success',
      resetSuccess: 'onResetSuccess',
      oneClickLogin: 'onOneClickLoginSuccess',
      afterOpen: setupModal,
      afterClose: removeSetModalLeftOnResizeEvent,
      pageType: '',
      className: 'sa-hard-rb-v1',
      onLoginSuccess: null,
      loginContainer: 'hard-login',
      regContainer: 'hard-reg'
    };
  };

  var sendRegisterEvent = function(action ,data){
    SA.Logger.Mone.event('signup_popup', 'regular_roadblock', action, {data: data});
  };

  var sendLoginEvent = function(action, data){
    return data ? SA.Logger.Mone.event('roadblock', options.pageType+ '_login', action, { data: data }) : SA.Logger.Mone.event('roadblock', options.pageType+ '_login' , action);
  };

  var loginWithGoogle = function() {
    var biData = articlePage ? {page: articlePage, rbType: 'regular_roadblock'} : {rbType: 'regular_roadblock'};
    SA.Models.Authentication.googleLogin('gplus_popup', 'regular_roadblock', 'shown', {data: biData});
  };

  var beforePwdReset = function() {
    resetLock = true;
    helpers.hideErrors($popupModal.find('#log-error'));
    $resetPwdBtn.find('.sa-loader').removeClass('hidden');
  };

  var afterPwdReset = function() {
    resetLock = false;
    $resetPwdBtn.find('.sa-loader').addClass('hidden');
  };

  var handleResetFailure = function(response, opt) {
    var errorContainer = $popupModal.find('#log-error');
    $('.has-success').removeClass('has-success');
    SA.Logger.Mone.event('roadblock', 'article_login_forgot_password','error', {data: {error_message: response.message, email : opt.email}});
    switch(response.message) {
      case 'not_confirmed_email_yet':
        return helpers.rbErrorPopup(JST['jst/popups/authentication/not_confirmed_email_yet'](), 'Confirm your registration', modal, true);
      case 'not_confirmed_email_still':
        return helpers.rbErrorPopup(JST['jst/popups/authentication/not_confirmed_email_still'](), 'Confirm your registration', modal, true);
      default:
        return helpers.showError(errorContainer, getError(response.message));
    }
  };

  var handleResetSuccess = function(opt) {
    sendLoginEvent('forgot_password_success', {email: opt.email});
    helpers.rbErrorPopup(JST['jst/popups/authentication/password_reset'](), 'Password reset', modal, true);
  };

  var onResetSuccess = function(response, opt) {
    response = response || {};
    afterPwdReset();

    return response.forgot_password ? handleResetSuccess(opt) : handleResetFailure(response, opt);
  };

  var onResetFailure = function(response, opt) {
    afterPwdReset();
  };

  var handleForgotPassword = function() {
    if(resetLock) {
      return false;
    }
    var $emailInput = $popupModal.find('#rb-login-form input[data-id="form-email"]'),
      $loginFormError = $popupModal.find('#log-error');

    if (helpers.validateEmail($emailInput, $loginFormError , getError('emailNotValid'))) {

      beforePwdReset();

      SA.Models.Authentication.resetPassword({
        id: options.id,
        activity: options.activity,
        'function': options.resetSuccess,
        email: $emailInput.val().trim(),
        onSuccess: onResetSuccess,
        onFailure: onResetFailure
      });
    } else {
      sendLoginEvent('error', {error_message: $loginFormError.text()});
    }

  };

  var beforeOneClickLogin = function() {
    resetLock = true;
    helpers.hideErrors($popupModal.find('#log-error'));
    SA.Logger.Mone.event('hard_roadblock','click_one_time_link_popup');
    $oneClickLoginBtn.find('.sa-loader').removeClass('hidden');
  };

  var afterOneClickLogin = function() {
    resetLock = false;
    $oneClickLoginBtn.find('.sa-loader').addClass('hidden');
  };

  var handleOneClickLoginFailure = function(response, opt) {
    var errorContainer = $popupModal.find('#log-error');
    $('.has-success').removeClass('has-success');
    SA.Logger.Mone.event('', 'hard_roadblock', 'one_time_login_link_error', {data: {error_message: response.message, email : opt.email}});
    switch(response.message) {
      case 'not_confirmed_email_yet':
        return helpers.rbErrorPopup(JST['jst/popups/authentication/not_confirmed_email_yet'](), 'Confirm your registration', modal, true);
      case 'not_confirmed_email_still':
        return helpers.rbErrorPopup(JST['jst/popups/authentication/not_confirmed_email_still'](), 'Confirm your registration', modal, true);
      default:
        return helpers.showError(errorContainer, getError(response.message));
    }
  };

  var handleOneClickLoginSuccess = function(opt) {
    SA.Logger.Mone.event('hard_roadblock','one_time_login_link_sent');
    helpers.rbErrorPopup(JST['jst/popups/authentication/one_time_login']({email: opt.email}), 'One Time Login', modal)
  };

  var onOneClickLoginSuccess = function(response, opt) {
    response = response || {};
    afterOneClickLogin();
    return response.login_link ? handleOneClickLoginSuccess(opt) : handleOneClickLoginFailure(response, opt);
  };

  var onOneClickLoginFailure = function(response, opt) {
    afterOneClickLogin();
  };

  var handleOneClickLogin = function() {
    if(resetLock) {
      return false;
    }
    var $emailInput = $popupModal.find('#rb-login-form input[data-id="form-email"]'),
      $loginFormError = $popupModal.find('#log-error');
    if (helpers.validateEmail($emailInput, $loginFormError , getError('emailNotValid'))) {

      beforeOneClickLogin();
      SA.Models.Authentication.oneClickLogin({
        id: options.id,
        activity: options.activity,
        'function': options.resetSuccess,
        email: $emailInput.val().trim(),
        onSuccess: onOneClickLoginSuccess,
        onFailure: onOneClickLoginFailure
      });
    } else {
      sendLoginEvent('error', {error_message: $loginFormError.text()});
    }

  };

  var onBeforeCheckEmail = function() {
    checkEmailLock = true;
    helpers.hideErrors($popupModal.find('#reg-error'));
    helpers.addLoader($popupModal.find('#reg-btn'));
  };

  var onAfterCheckEmail = function() {
    checkEmailLock = false;
  };


  var onCheckEmailFailure = function(request, opt){
    onAfterCheckEmail();
  };

  var handleActivatedEmail = function(response, opt){
    if(response.user_exists){
      userEmailExists = true;
      toggleRegLogin({action: 'regislogin_attempt', email: opt.email, user_exists: true});
      $popupModal.find('#rb_login_email').val(opt.email);
      $popupModal.find('#rb_login_password').val(opt.password);
      tryToLogIn();
    }
  };

  var showEmailErrorMessage = function(container, message, email){
    sendRegisterEvent('error', {email: email, error_message: message});
    helpers.showError(container, message);
  };


  var handleNonActivatedEmail = function(response, opt) {
    var errorContainer = $popupModal.find('#reg-error');
    $('.has-success').removeClass('has-success');
    switch(response.message) {
      case 'not_activated_not_bounced_user':
        return showEmailErrorMessage(errorContainer, getError('not_activated_not_bounced_user'), opt.email);
      case 'activated_bounced_user':
        return showEmailErrorMessage(errorContainer, getError('activated_bounced_user'), opt.email);
      case 'not_activated_bounced_user':
        return showEmailErrorMessage(errorContainer, getError('not_activated_bounced_user')(response.date), opt.email);
      default:
        return tryToReg(opt);
    }
  };

  var onCheckEmailSuccess = function(response, opt){
    onAfterCheckEmail();
    response = response || {};
    return response.user_exists ? handleActivatedEmail(response, opt) : handleNonActivatedEmail(response, opt);
  };

  var tryCheckEmail = function(){

    if (signInLock || checkEmailLock) {
      return;
    }

    var $emailInput = $popupModal.find('input[data-id="form-email"]');
    var $signInFormError = $popupModal.find('#reg-error');

    if (helpers.validateEmail($emailInput, $signInFormError, getError('emailNotValid'))) {
      onBeforeCheckEmail();

      SA.Models.Authentication.checkEmail({
        email: $emailInput.val().trim(),
        rb_user: true,
        onSuccess: onCheckEmailSuccess,
        onFailure: onCheckEmailFailure
      });
    } else {
      sendRegisterEvent('error', {email: $emailInput.val().trim(), error_message: $signInFormError.text()});
    }
  };

  var onAfterReg = function() {
    signInLock = false;
    helpers.removeLoader($popupModal.find('#reg-btn'));
  };



  var onRegStep1Success = function(response, opt) {
    response = response || {};
    onAfterRegStep1();

    return response.registration ? handleRegStep1Success(opt) : handleRegStep1Failure(response, opt);
  };

  var onAfterRegStep1 = function() {
    signInLock = false;
    helpers.removeLoader(modal.getModalObject().find('#reg-btn'));
  };

  var handleRegStep1Failure = function(response, opt) {
    var errorContainer = modal.getModalObject().find('#reg-error');
    $('.has-success').removeClass('has-success');

    sendRegisterEvent('reg_failure', {error: response.message, email : opt.email});

    switch(response.message) {
      case 'not_confirmed_email_yet':
        return helpers.rbErrorPopup(window.JST['jst/popups/authentication/not_confirmed_email_yet'](), 'Confirm your registration', modal, true);
      case 'not_confirmed_email_still':
        return helpers.rbErrorPopup(window.JST['jst/popups/authentication/not_confirmed_email_still'](), 'Confirm your registration', modal, true);
      case 'activated_bounced_user':
        return helpers.rbErrorPopup(window.JST['jst/popups/authentication/activated_bounced_user']({data: response.date}), 'This email already exists', modal, true);
      case 'not_activated_bounced_user':
        return helpers.rbErrorPopup(window.JST['jst/popups/authentication/not_activated_bounced_user']({data: response.date}), 'Registration in progress', modal, true);
      case 'not_activated_not_bounced_user':
        return helpers.rbErrorPopup(window.JST['jst/popups/authentication/not_activated_not_bounced_user'](), 'Registration in progress', modal, true);
      default:
        return helpers.showError(errorContainer, getError(response.message));
    }
  };

  var handleRegStep1Success = function(opt) {
    var biData = articlePage ? {email: opt.email, page: articlePage} : {email: opt.email};
    sendRegisterEvent('register', biData);
    modal.hide();

    if($("input[name=ticker_rta_checkbox]").is(':checked')) {
      SA.Utils.Observer.publish('registration/success-popup', {
        email:opt.email,
        backdrop: false,
        keyboard: false,
        showCloseBtn: false,
        fromRoadblock: true,
        source: 'regular_roadblock'
      });
    } else {
      SA.Widgets.RoadblockStep2_v1.show(opt);
    }
  };

  var tryToReg = function(opt){

    if (checkEmailLock || signInLock) {
      return;
    }

    if (opt.email) {
      signInLock = true;

      var activity = options.isNewsLetter ? 'newsletter' : 'rta'

      SA.Models.Authentication.hardRoadblockSignIn({
        id: options.id,
        activity: activity,
        'function': options.regStep1Success,
        pageType: options.pageType,
        sender: true,
        email: opt.email,
        password: opt.password,
        rtaAddAlerts: 1,
        rtaSource: 'hard_roadblock_v2',
        author_tag_id_to_follow: options.authorTagId,
        primaryTicker: options.primaryTicker,
        articleId: SA.pageConfig.Data.article && SA.pageConfig.Data.article.id,
        onSuccess: onRegStep1Success,
        onFailure: onAfterRegStep1,
        backdrop: false
      });
    }
  };

  var onBeforeLogin = function() {
    loginLock = true;
    helpers.hideErrors($popupModal.find('#log-error'));
    helpers.addLoader($popupModal.find('#log-btn'));
  };

  var onAfterLogin = function() {
    loginLock = false;
    helpers.removeLoader($popupModal.find('#log-btn'));
  };

  var handleLogInSuccess = function(opt) {
    var biData = articlePage ? {email: opt.email, page: articlePage} : {email: opt.email};
    if (opt.fromReg) {
      SA.Logger.Mone.event('signup_popup', 'regular_roadblock', 'regislogin', {data: biData});
    } else {
      SA.Logger.Mone.event('signin_popup', 'regular_roadblock', 'login_success', {data: biData});
    }

    if($.isFunction(options.onLoginSuccess)) {
      return options.onLoginSuccess();
    }
    return location.reload();
  };


  var handleLogInFailure = function(response, opt) {
    onAfterLogin();

    sendLoginEvent('error', {error_message: response.message, email: opt.email});

    var errorContainer = $popupModal.find('#log-error');
    $('.has-success').removeClass('has-success');
    switch(response.message) {
      case 'not_confirmed_email_yet':
        return helpers.rbErrorPopup(JST['jst/popups/authentication/not_confirmed_email_yet'](), 'Confirm your registration', modal, true);
      case 'not_confirmed_email_still':
        return helpers.rbErrorPopup(JST['jst/popups/authentication/not_confirmed_email_still'](), 'Confirm your registration', modal, true);
      case 'too_many_attempts':
        loginLock = false;
        return helpers.showError(errorContainer, getError('too_many_attempts'));
      default:
        return helpers.showError(errorContainer, getError(response.message));
    }
  };

  var onLogInSuccess = function(response, opt) {
    response = response || {};
    return response.login ? handleLogInSuccess(opt) : handleLogInFailure(response, opt);
  };

  var onLogInFailure = function(response, opt) {
    onAfterLogin();
  };

  var tryToLogIn = function() {
    if(loginLock) {
      return;
    }

    var $emailInput = $popupModal.find('#rb_login_email');
    var  $passwordInput = $popupModal.find('#rb_login_password');
    var  $loginFormError = $popupModal.find('#log-error');
    $loginFormError.html('');

    if (helpers.validateEmail($emailInput, $loginFormError, getError('emailNotValid'))
      && helpers.validatePresence($passwordInput, $loginFormError, getError('passwordMissing'))
      && helpers.validateSignInPasswordValueOld($passwordInput, $loginFormError, getError('passwordNotValid'))) {
      onBeforeLogin();

      SA.Models.Authentication.logIn({
        id: options.id,
        activity: options.activity,
        'function': options.loginSuccess,
        email: $emailInput.val().trim(),
        password: $passwordInput.val(),
        onSuccess: onLogInSuccess,
        onFailure: onLogInFailure,
        fromReg: userEmailExists
      });
    }else{
      sendLoginEvent('error',{email: $emailInput.val().trim(), error_message: $loginFormError.text()});
    }
  };

  var toggleRegLogin = function(data){
    if (data && data.user_exists) {
      $loginContainer.find('.header').text('We already have a user with that email').css('color', 'red');
    }

    $regContainer.toggleClass('hidden');
    $loginContainer.toggleClass('hidden');
    $('.modal-dialog').toggleClass('sign-in');
    resetForms();
    sendSwitchEvent(data);
  };

  var resetForms = function(){
    $popupModal.find('.has-error').removeClass('has-error');
    $popupModal.find('.has-success').removeClass('has-success');
    $popupModal.find('input.form-control').val('');
    $popupModal.find('.rb-alert').not('.hidden').addClass('hidden').text('');
  };

  var sendSwitchEvent = function(data){
    var data = data || {}
    if( $popupModal.find('#hard-reg').hasClass('hidden') ){
      SA.Logger.Mone.event('signin_popup', 'regular_roadblock', 'switch_to_login', {data: data});
    } else {
      userEmailExists=false;
      SA.Logger.Mone.event('email_popup', 'regular_roadblock', 'switch_to_register', {data: data});
    }
  };

  var setRegisterEvents = function() {
    $regForm.on('submit', function(event){
      event.preventDefault();
      tryCheckEmail();
    });

    $("input[name=theme_news_checkbox]").change(function() {
      cookie.del('rb_newsletter');
      if(this.checked) {
        cookie.set('rb_newsletter', articleEmailTheme['key'], {expires: cookieExpiration});
      }
    });

    $("input[name=ticker_rta_checkbox]").change(function() {
      cookie.del('rb_rta_slug');
      if(this.checked) {
        cookie.set('rb_rta_slug', options.primaryTicker, {expires: cookieExpiration});
      }
    });
  };

  var setLogInEvents = function() {
    $loginForm.on('submit', function(event){
      event.preventDefault();
      tryToLogIn();
    });
  };

  var setGoogleLoginEvents = function() {
    $googleLoginBtn.on('click', function(event){
      event.preventDefault();
      loginWithGoogle();
    });
  };

  var setForgotPasswordEvents = function() {
    $resetPwdBtn.on('click', function(event){
      event.preventDefault();
      handleForgotPassword();
    });
  };

  var setOneClickLoginEvents = function() {
    $oneClickLoginBtn.on('click', function(event){
      event.preventDefault();
      handleOneClickLogin();
    });
  };

  var setRegLoginSwitchEvents = function(){
    $switchLoginBtn.on('click', function(event){
      event.preventDefault();
      toggleRegLogin();
    });
  };

  var setupModal = function() {
    $popupModal = modal.getModalObject();
    $regContainer = $('#' + options.regContainer);
    $loginContainer = $('#' + options.loginContainer);
    $regForm = $popupModal.find('#rb-reg-form');
    $loginForm = $popupModal.find('#rb-login-form');
    $googleLoginBtn = $popupModal.find('.log-google');
    $resetPwdBtn = $popupModal.find('#rst-pwd');
    $oneClickLoginBtn = $popupModal.find('#one-click-link');
    $switchLoginBtn = $popupModal.find('.switch-btn');
    $closeFormBtn = $popupModal.find('.close-svg');
    $articleContainer = $('#a-cont');
    setEventListeners();
  };

  var setEventListeners = function() {
    setRegisterEvents();
    setLogInEvents();
    setGoogleLoginEvents();
    setForgotPasswordEvents();
    setOneClickLoginEvents();
    setRegLoginSwitchEvents();
  };

  var getModalBody = function() {
    return JST['jst/widgets/roadblock/roadblock_step1_v1']({
      ticker: options.primaryTicker,
      theme: articleEmailTheme,
      isNewsLetter: options.isNewsLetter,
      articleBullets: getArticleBullets(),
      articleFirstParagraph: getArticleFirstParagraph(),
      articlePublicationDate: getArticlePublicationDate(),
      articleCommentsNumber: getArticleCommentsNumber(),
      articleAuthorInfo: getArticleAuthorInfo(),
      articleTitle: getArticleTitle(),
      closeSvgIcon: JST['jst/inline_svg/close_btn'](),
      host: SA.App.host,
      googleBtn: window.JST['jst/widgets/button/google_btn'](
        {
          googleSvg: window.JST['jst/inline_svg/google']({ width: 32, withBorder: false })
        })
    }) || '';
  };

  var getArticleTitle = function() {
    return $('.sa-art-hd h1').html() || '';
  }

  var getArticleAuthorInfo = function() {
    return $('.media-body .name-link .name').html() || '';
  }

  var getArticleCommentsNumber = function() {
    return parseInt($('#a-comments').find('a').html()) || 0;
  }

  var getArticlePublicationDate = function() {
    return window.moment(new Date($(".a-info time").attr('content'))).format('MMM DD, YYYY');
  }

  var getArticleFirstParagraph = function() {
    var text = '';
    $(".sa-art").children("p").each(function() {
      var txt = $(this).text().trim();
      if (txt.length > 0) {
        text = txt;
        return false;
      }
    });
    return text.replace(/<a\b[^>]*>(.*?)<\/a>/i,"$1");
  }

  var getArticleBullets = function() {
    var BULLETS_NUM = 3;
    var res = [];
    $(".a-sum p").each(function( index ) {
      res.push($( this ).text())
    });
    return res.slice(0,BULLETS_NUM);
  }

  var buildRbModal = function() {

    var bodyContent = getModalBody();
    if(bodyContent) {
      return SA.Widgets.Popup.build({
        className: options.className,
        backdrop: false,
        keyboard: false,
        showHeader: false,
        showCloseBtn: false,
        showBody: true,
        bodyContent: bodyContent,
        showFooter: false,
        removeAfterClose: true,
        afterOpen: options.afterOpen
      });
    }
  };

  var showRbPopup = function() {
    modal = buildRbModal();
    modal.show();
    SA.Logger.Mone.event('signup_popup', 'regular_roadblock', 'shown', {data: articlePage ? {page: articlePage} : ''});
  };

  var centerModal = function () {
    var windowHeight = $(window).height();
    var $modalDialog = modal.getModalObject().find('.modal-dialog');
    var modalDialogHeight = $modalDialog.height();
    $modalDialog.css({
      "margin-top": (windowHeight-modalDialogHeight)/2+'px'
    })
  };

  var removeSetModalLeftOnResizeEvent = function(){
    $(window).off('resize.roadblock');
  };

  var correctThemeIds = function() {
    var key = articleEmailTheme['key'];
    if (['etfs', 'investing-strategy', 'etfs-and-funds'].indexOf(key) > -1) {
      key = 'etf-content-once-daily-newsletter';
    } else if (key === 'market-outlook') {
      key = 'macro-view';
    } else if (key === 'earnings') {
      key = 'transcripts';
    } else if (key === 'dividends') {
      key = 'investing-income';
    } else if (key === 'stock-ideas'){
      key = 'investing-ideas'
    }

    articleEmailTheme['key'] = key;
  };

  var setCookies = function() {
    cookie.del('rb_newsletter');
    cookie.del('rb_rta_slug');
    if (options.primaryTicker) {
      cookie.set('rb_rta_slug', options.primaryTicker, {expires: cookieExpiration});
    } else {
      correctThemeIds();
      cookie.set('rb_newsletter', articleEmailTheme['key'], {expires: cookieExpiration});
    }
  };

  scope.getArticleEmailTheme = function (pageType) {

    var serverKVScope = SA.pageConfig.Ads.kvs, dKey = [], tKey = [];

    if (serverKVScope.d) {
      dKey = $.isArray(serverKVScope.d) ? serverKVScope.d : serverKVScope.d.split(',');
    }
    if (serverKVScope.t) {
      tKey = $.isArray(serverKVScope.t) ? serverKVScope.t : serverKVScope.t.split(',');
    }

    var pageKvs = $.unique($.merge($.merge([], tKey), dKey));
    var articleTypeKvs = {
      'investing-income': 'Dividends & Income',
      'investing-ideas': 'Investing Ideas',
      'market-outlook': 'Macro View',
      'etfs-and-funds': 'ETF & Portfolio Strategy',
      'portfolio-strategy-asset-allocation': 'Portfolio Strategy',
      'wall-st-breakfast': 'Wall Street Breakfast',
      'stock-ideas': 'Investing Ideas',
      'investing-strategy': 'ETF & Portfolio Strategy',
      'earnings': 'Transcript',
      'dividends': 'Dividends & Income'
    };
    var articleTypeIds = $.map(articleTypeKvs, function (value, id) {
      return id;
    });
    var foundRes;

    if (pageType === 'wall-st-breakfast') {
      foundRes = {key: 'wall-st-breakfast', val: articleTypeKvs['wall-st-breakfast']};
    } else {
      $.each(pageKvs, function (i, kvsSet) {
        if ($.inArray(kvsSet, articleTypeIds) !== -1) {
          var tmpKey = kvsSet;
          if (kvsSet === 'etfs-and-funds' || kvsSet === 'portfolio-strategy-asset-allocation') {
            tmpKey = 'etfs';
          }
          foundRes = {key: tmpKey, val: articleTypeKvs[kvsSet]};
          return false;
        }
      });
    }
    return foundRes ? foundRes : {key: 'stock-ideas', val: articleTypeKvs['stock-ideas']};
  };

  scope.show = function(opt) {
    opt = opt || {};
    options = $.extend({}, getDefaultOptions(), opt);

    if ( ["article", "wall-st-breakfast", "dashboard"].includes(opt.pageType) ) {
      articleEmailTheme = scope.getArticleEmailTheme(opt.pageType);
      correctThemeIds();
    }
    showRbPopup();
    setCookies();
    centerModal();
    $(window).on('resize.roadblock', centerModal);

  };

  scope.showing = function() {
    return modal && modal.showing;
  };

}(SA, jQuery, SA.Data.Cookies));
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/roadblock/soft_roadblock"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div id="soft-reg">\n  <div class="soft-body">\n    <div class="header">\n      ');  if (ticker) { ; __p.push('\n        Get email alerts on <span class="ticker upcase">',  ticker ,'</span>\n      ');  } else if (isNewsLetter) { ; __p.push('\n        <span class="ticker">',  theme ,'</span>\n      ');  } else { ; __p.push('\n        Get all of our top <span class="ticker">',  theme ,'</span> articles in a single daily email\n      ');  } ; __p.push('\n\n      <button type="button" class="close close-svg" data-dismiss="modal" aria-label="Close">\n        <span aria-hidden="true"></span>\n      </button>\n    </div>\n    <form id="rb-reg-form" autocomplete="off">\n      <div class="form-group">\n        <span class="soft-reg-email">\n          <input type="email" class="form-control" autocomplete="off" spellcheck="false" placeholder="Your email" data-id="form-email">\n        </span>\n        <span class="get-alerts">\n          <input type="submit" class="btn reg-orange-btn" value="Get Alerts"/>\n        </span>\n      </div>\n    </form>\n    <div id="reg-error" class="rb-alert hidden" role="alert"></div>\n  </div>\n\n  <div class="soft-footer">\n    <span class="switch">\n      Already Registered?<span class="switch-btn"> Sign in</span><span class="goog-icon log-google" id="log-google">',  googleSvg ,'</span><span class="clearfix"></span>\n    </span>\n  </div>\n</div>\n\n<div class="hidden" id="soft-login">\n  <div class="soft-body">\n    <div class="header">\n      Please sign in:\n    </div>\n    <form id="rb-login-form" autocomplete="on">\n      <div class="form-group">\n        <input type="email" class="form-control" id="rb_login_email" autocomplete="on" spellcheck="false" placeholder="Email Address" data-id="form-email">\n      </div>\n      <div class="form-group log-pwd-grp">\n        <input type="password" class="form-control" id="rb_login_password" autocomplete="on" spellcheck="false" placeholder="Password" data-id="form-pwd">\n        <div class="frgt-pwd"><a href="#" id="rst-pwd">Forgot password?</a></div>\n      </div>\n      <div class="btn-grp">\n        <input type="submit" id="log-btn" class="btn orange-btn" value="GO!">\n        <input type="submit" class= "btn otl-login" id="one-click-link" value="Email me a sign in link">\n        <div id="log-google" class="goog-btn log-google">\n          ',  googleBtn ,'\n        </div>\n      </div>\n    </form>\n    <div id="log-error" class="rb-alert hidden" role="alert"></div>\n  </div>\n  <div class="soft-footer">\n    <span class="switch">\n      Not yet registered?<span class="switch-btn"> Register</span><span class="clearfix"></span>\n    </span>\n  </div>\n</div>\n');}return __p.join('');};
}).call(this);










(function(SA, $, cookie){

  "use strict";

  var scope = SA.UsingNamespace('SA.Widgets.SoftRoadblock');
  var checkEmailLock = false;
  var signInLock = false;
  var loginLock = false;
  var resetLock = false;
  var options;
  var modal;
  var helpers = SA.Utils.AuthenticationHelpers;

  var $popupModal, $regForm, $loginForm, $regContainer, $loginContainer, $resetPwdBtn, $oneClickLoginBtn, $googleLoginBtn, $switchLoginBtn, $closeFormBtn, $articleContainer;
  var moneSource, monePage, articleEmailTheme, userEmailExists = false, cookieExpiration = 24*60*60;

  var getError = function(error) {
    var errors = {
      defaultMessage: 'There was an error. Please try again later',
      emailNotValid: 'Please enter a valid email address.',
      passwordNotValid: 'Please enter your password.',
      passwordNotValidFormat: 'Please enter a password with 4 to 40 characters.',
      login_failed: 'Please check your email and password and try again.',
      blocked_user: 'Login failed, please report your issue on our <a href='+SA.App.userEchoHost+'>feedback forum</a>',
      no_user: 'Please check your email and try again.',
      too_many_attempts: 'Too many login attempts have been made with an incorrect password. Please press Forgot your password? to reset your password',
      missing_user_details: 'Please check your email and password and try again.',
      already_registered: 'You are already registered, please try the Member sign in.',
      not_activated_not_bounced_user: 'There is already a registration in progress for this email, if you did not receive the confirmation email, please ask your IT department or email provider to place seekingalpha.com in the whitelist and try to register again',
      relevant_link: "You can request one sign in link per hour. Please recheck your email.",
      not_activated_bounced_user: function(date){ return 'There is already a registration in progress for this email, but our confirmation email was blocked by your email provider as of '+date+', we have attempted to remove the block and sent a password reset email to your inbox.';},
      activated_bounced_user: function(date){return 'This email already exists in our system, but was blocked by your email provider as of '+date+', we have attempted to remove the block and sent a password reset email to your inbox.'; }
    };

    return errors[error] || errors.defaultMessage;
  };

  var getDefaultOptions = function() {
    return {
      id: 'login',
      activity: 'roadblock',
      loginSuccess: 'onLoginSuccess',
      regSuccess: 'onRegSuccess',
      resetSuccess: 'onResetSuccess',
      oneClickLogin: 'onOneClickLoginSuccess',
      afterOpen: setupModal,
      afterClose: removeSetModalLeftOnResizeEvent,
      pageType: '',
      className: 'sa-soft-rb',
      onLoginSuccess: null,
      loginContainer: 'soft-login',
      regContainer: 'soft-reg'
    };
  };

  var sendRegisterEvent = function(action ,data){
    SA.Logger.Mone.event('signup_popup', moneSource , action,  {data: data});
  };

  var sendLoginEvent = function(action, data){
    return data ? SA.Logger.Mone.event('roadblock', options.pageType+ '_login', action, { data: data }) : SA.Logger.Mone.event('roadblock', options.pageType+ '_login' , action);
  };

  var loginWithGoogle = function() {
    SA.Models.Authentication.googleLogin('gplus_popup', moneSource, 'shown', {data: {rbType: moneSource, page: monePage}});
  };

  var beforePwdReset = function() {
    resetLock = true;
    helpers.hideErrors($popupModal.find('#log-error'));
    $resetPwdBtn.find('.sa-loader').removeClass('hidden');
  };

  var afterPwdReset = function() {
    resetLock = false;
    $resetPwdBtn.find('.sa-loader').addClass('hidden');
  };

  var handleResetFailure = function(response, opt) {
    var errorContainer = $popupModal.find('#log-error');
    $('.has-success').removeClass('has-success');
    SA.Logger.Mone.event('roadblock', 'article_login_forgot_password','error', {data: {error_message: response.message, email : opt.email}});
    switch(response.message) {
      case 'not_confirmed_email_yet':
        return helpers.rbErrorPopup(JST['jst/popups/authentication/not_confirmed_email_yet'](), 'Confirm your registration', modal, true);
      case 'not_confirmed_email_still':
        return helpers.rbErrorPopup(JST['jst/popups/authentication/not_confirmed_email_still'](), 'Confirm your registration', modal, true);
      default:
        return helpers.showError(errorContainer, getError(response.message));
    }
  };

  var handleResetSuccess = function(opt) {
    sendLoginEvent('forgot_password_success', {email: opt.email});
    helpers.rbErrorPopup(JST['jst/popups/authentication/password_reset'](), 'Password reset', modal, true);
  };

  var onResetSuccess = function(response, opt) {
    response = response || {};
    afterPwdReset();

    return response.forgot_password ? handleResetSuccess(opt) : handleResetFailure(response, opt);
  };

  var onResetFailure = function(response, opt) {
    afterPwdReset();
  };

  var handleForgotPassword = function() {
    if(resetLock) {
      return false;
    }
    var $emailInput = $popupModal.find('#rb-login-form input[data-id="form-email"]'),
      $loginFormError = $popupModal.find('#log-error');

    if (helpers.validateEmail($emailInput, $loginFormError , getError('emailNotValid'))) {

      beforePwdReset();

      SA.Models.Authentication.resetPassword({
        id: options.id,
        activity: options.activity,
        'function': options.resetSuccess,
        email: $emailInput.val().trim(),
        onSuccess: onResetSuccess,
        onFailure: onResetFailure
      });
    } else {
      sendLoginEvent('error', {error_message: $loginFormError.text()});
    }

  };

  var beforeOneClickLogin = function() {
    resetLock = true;
    helpers.hideErrors($popupModal.find('#log-error'));
    SA.Logger.Mone.event('soft_roadblock','click_one_time_link_popup');
    $oneClickLoginBtn.find('.sa-loader').removeClass('hidden');
  };

  var afterOneClickLogin = function() {
    resetLock = false;
    $oneClickLoginBtn.find('.sa-loader').addClass('hidden');
  };

  var handleOneClickLoginFailure = function(response, opt) {
    var errorContainer = $popupModal.find('#log-error');
    $('.has-success').removeClass('has-success');
    SA.Logger.Mone.event('', 'soft_roadblock', 'one_time_login_link_error', {data: {error_message: response.message, email : opt.email}});
    switch(response.message) {
      case 'not_confirmed_email_yet':
        return helpers.rbErrorPopup(JST['jst/popups/authentication/not_confirmed_email_yet'](), 'Confirm your registration', modal, true);
      case 'not_confirmed_email_still':
        return helpers.rbErrorPopup(JST['jst/popups/authentication/not_confirmed_email_still'](), 'Confirm your registration', modal, true);
      default:
        return helpers.showError(errorContainer, getError(response.message));
    }
  };

  var handleOneClickLoginSuccess = function(opt) {
    SA.Logger.Mone.event('soft_roadblock','one_time_login_link_sent');
    helpers.rbErrorPopup(JST['jst/popups/authentication/one_time_login']({email: opt.email}), 'One Time Login', modal)
  };

  var onOneClickLoginSuccess = function(response, opt) {
    response = response || {};
    afterOneClickLogin();
    return response.login_link ? handleOneClickLoginSuccess(opt) : handleOneClickLoginFailure(response, opt);
  };

  var onOneClickLoginFailure = function(response, opt) {
    afterOneClickLogin();
  };

  var handleOneClickLogin = function() {
    if(resetLock) {
      return false;
    }
    var $emailInput = $popupModal.find('#rb-login-form input[data-id="form-email"]'),
      $loginFormError = $popupModal.find('#log-error');
    if (helpers.validateEmail($emailInput, $loginFormError , getError('emailNotValid'))) {

      beforeOneClickLogin();
      SA.Models.Authentication.oneClickLogin({
        id: options.id,
        activity: options.activity,
        'function': options.resetSuccess,
        email: $emailInput.val().trim(),
        onSuccess: onOneClickLoginSuccess,
        onFailure: onOneClickLoginFailure
      });
    } else {
      sendLoginEvent('error', {error_message: $loginFormError.text()});
    }

  };

  var onBeforeCheckEmail = function() {
    checkEmailLock = true;
    helpers.hideErrors($popupModal.find('#reg-error'));
    helpers.addLoader($popupModal.find('#reg-btn'));
  };

  var onAfterCheckEmail = function() {
    checkEmailLock = false;
  };


  var onCheckEmailFailure = function(request, opt){
    onAfterCheckEmail();
  };

  var handleActivatedEmail = function(response, opt){
    if(response.user_exists){
      userEmailExists = true;
      toggleRegLogin({action: 'regislogin_attempt', email: opt.email, user_exists: true});
      $popupModal.find('#rb_login_email').val(opt.email);
      $popupModal.find('#rb_login_password').val(opt.password);
      tryToLogIn();
    }
  };

  var showEmailErrorMessage = function(container, message, email){
    sendRegisterEvent('error', {email: email, error_message: message});
    helpers.showError(container, message);
  };


  var handleNonActivatedEmail = function(response, opt) {
    var errorContainer = $popupModal.find('#reg-error');
    $('.has-success').removeClass('has-success');
    switch(response.message) {
      case 'not_activated_not_bounced_user':
        return showEmailErrorMessage(errorContainer, getError('not_activated_not_bounced_user'), opt.email);
      case 'activated_bounced_user':
        return showEmailErrorMessage(errorContainer, getError('activated_bounced_user'), opt.email);
      case 'not_activated_bounced_user':
        return showEmailErrorMessage(errorContainer, getError('not_activated_bounced_user')(response.date), opt.email);
      default:
        return tryToReg(opt);
    }
  };

  var onCheckEmailSuccess = function(response, opt){
    onAfterCheckEmail();
    response = response || {};
    return response.user_exists ? handleActivatedEmail(response, opt) : handleNonActivatedEmail(response, opt);
  };

  var tryCheckEmail = function(){

    if (signInLock || checkEmailLock) {
      return;
    }

    var $emailInput = $popupModal.find('input[data-id="form-email"]');
    var $signInFormError = $popupModal.find('#reg-error');

    if (helpers.validateEmail($emailInput, $signInFormError, getError('emailNotValid'))) {
      onBeforeCheckEmail();

      SA.Models.Authentication.checkEmail({
        email: $emailInput.val().trim(),
        rb_user: true,
        onSuccess: onCheckEmailSuccess,
        onFailure: onCheckEmailFailure
      });
    }else{
      sendRegisterEvent('error', {email: $emailInput.val().trim(), error_message: $signInFormError.text()});
    }
  };

  var onAfterReg = function() {
    signInLock = false;
    helpers.removeLoader($popupModal.find('#reg-btn'));
  };

  var onRegFailure = function(request, opt) {
    onAfterReg();
  };

  var handleRegFailure = function(response, opt) {
    var errorContainer = $popupModal.find('#reg-error');
    $('.has-success').removeClass('has-success');

    sendRegisterEvent('reg_failure', {error: response.message, email : opt.email});

    switch(response.message) {
      case 'not_confirmed_email_yet':
        return helpers.rbErrorPopup(JST['jst/popups/authentication/not_confirmed_email_yet'](), 'Confirm your registration', modal, true);
      case 'not_confirmed_email_still':
        return helpers.rbErrorPopup(JST['jst/popups/authentication/not_confirmed_email_still'](), 'Confirm your registration', modal, true);
      case 'activated_bounced_user':
        return helpers.rbErrorPopup(JST['jst/popups/authentication/activated_bounced_user']({data: response.date}), 'This email already exists', modal, true);
      case 'not_activated_bounced_user':
        return helpers.rbErrorPopup(JST['jst/popups/authentication/not_activated_bounced_user']({data: response.date}), 'Registration in progress', modal, true);
      case 'not_activated_not_bounced_user':
        return helpers.rbErrorPopup(JST['jst/popups/authentication/not_activated_not_bounced_user'](), 'Registration in progress', modal, true);
      default:
        return helpers.showError(errorContainer, getError(response.message));
    }
  };

  var handleRegSuccess = function(opt) {
    modal.hide();
    $('#a-cont').removeClass('rb');
    SA.Logger.Mone.event('email_popup', moneSource , 'register',  {data: {email : opt.email}});

    if ( opt.activity === "newsletter" ) {
      SA.Utils.Observer.publish('registration/success-popup', {
        email:opt.email,
        backdrop: false,
        keyboard: false,
        showCloseBtn: true,
        fromRoadblock: true,
        headerContent: '<div class="subscription-success">Thank you for subscribing to Wall Street Breakfast newsletter</div>',
        source: moneSource
      });
    } else {
      SA.Utils.Observer.publish('registration/success-popup', {
        email:opt.email,
        backdrop: false,
        keyboard: false,
        showCloseBtn: true,
        fromRoadblock: true,
        source: moneSource
      });
    }
  };

  var onRegSuccess = function(response, opt) {
    response = response || {};
    onAfterReg();

    return response.registration ? handleRegSuccess(opt) : handleRegFailure(response, opt);
  };

  var tryToReg = function(opt){
    if (checkEmailLock || signInLock) {
      return;
    }
    if (opt.email) {
      signInLock = true;
      var activity = options.isNewsLetter ? 'newsletter' : 'rta',
        params = {
          id: options.id,
          activity: activity,
          'function': options.regSuccess,
          newsletter: 'wall-st-breakfast',
          pageType: options.pageType,
          email: opt.email,
          rtaAddAlerts: 1,
          rtaSource: 'soft_roadblock',
          author_tag_id_to_follow: options.authorTagId,
          primaryTicker: options.primaryTicker,
          onSuccess: onRegSuccess,
          onFailure: onRegFailure,
          backdrop: false
        };
      if (options.primaryTicker) {
        params.rta_slugs = options.primaryTicker;
      }
      SA.Models.Authentication.softRoadblockSignIn(params);
    }
  };

  var onBeforeLogin = function() {
    loginLock = true;
    helpers.hideErrors($popupModal.find('#log-error'));
    helpers.addLoader($popupModal.find('#log-btn'));
  };

  var onAfterLogin = function() {
    loginLock = false;
    helpers.removeLoader($popupModal.find('#log-btn'));
  };

  var handleLogInSuccess = function(opt) {
    opt.fromReg ? SA.Logger.Mone.event('signin_popup', moneSource, 'regislogin',  {data: {email: opt.email}}) :
      SA.Logger.Mone.event('signin_popup', moneSource, 'login_success',  {data: {email: opt.email}});
    if($.isFunction(options.onLoginSuccess)) {
      return options.onLoginSuccess();
    }
    return location.reload();
  };


  var handleLogInFailure = function(response, opt) {
    onAfterLogin();

    sendLoginEvent('error', {error_message: response.message, email: opt.email});

    var errorContainer = $popupModal.find('#log-error');
    $('.has-success').removeClass('has-success');
    switch(response.message) {
      case 'not_confirmed_email_yet':
        return helpers.rbErrorPopup(JST['jst/popups/authentication/not_confirmed_email_yet'](), 'Confirm your registration', modal, true);
      case 'not_confirmed_email_still':
        return helpers.rbErrorPopup(JST['jst/popups/authentication/not_confirmed_email_still'](), 'Confirm your registration', modal, true);
      case 'too_many_attempts':
        loginLock = false;
        return helpers.showError(errorContainer, getError('too_many_attempts'));
      default:
        return helpers.showError(errorContainer, getError(response.message));
    }
  };

  var onLogInSuccess = function(response, opt) {
    response = response || {};
    return response.login ? handleLogInSuccess(opt) : handleLogInFailure(response, opt);
  };

  var onLogInFailure = function(response, opt) {
    onAfterLogin();
  };

  var tryToLogIn = function() {
    if(loginLock) {
      return;
    }

    var $emailInput = $popupModal.find('#rb_login_email');
    var  $passwordInput = $popupModal.find('#rb_login_password');
    var  $loginFormError = $popupModal.find('#log-error');
    $loginFormError.html('');

    if (helpers.validateEmail($emailInput, $loginFormError, getError('emailNotValid')) && helpers.validatePresence($passwordInput, $loginFormError, getError('passwordNotValid'))) {
      onBeforeLogin();

      SA.Models.Authentication.logIn({
        id: options.id,
        activity: options.activity,
        'function': options.loginSuccess,
        email: $emailInput.val().trim(),
        password: $passwordInput.val(),
        onSuccess: onLogInSuccess,
        onFailure: onLogInFailure,
        fromReg: userEmailExists
      });
    }else{
      sendLoginEvent('error',{email: $emailInput.val().trim(), error_message: $loginFormError.text()});
    }
  };

  var toggleRegLogin = function(data){
    if (data && data.user_exists) {
      $loginContainer.find('.header').text('We already have a user with that email');
    }

    $regContainer.toggleClass('hidden');
    $loginContainer.toggleClass('hidden');
    resetForms();
    sendSwitchEvent(data);
  };

  var resetForms = function(){
    $popupModal.find('.has-error').removeClass('has-error');
    $popupModal.find('.has-success').removeClass('has-success');
    $popupModal.find('input.form-control').val('');
    $popupModal.find('.rb-alert').not('.hidden').addClass('hidden').text('');
  };

  var sendSwitchEvent = function(data){
    var data = data || {}
    data.page = monePage;
    if($regContainer.hasClass('hidden') ){
      SA.Logger.Mone.event('signin_popup', moneSource , 'switch_to_login', {data: data});
    } else {
      userEmailExists=false;
      SA.Logger.Mone.event('email_popup', moneSource, 'switch_to_register', {data: data});
    }
  };

  var setRegisterEvents = function() {
    $regForm.on('submit', function(event){
      event.preventDefault();
      tryCheckEmail();
    });
  };

  var setLogInEvents = function() {
    $loginForm.on('submit', function(event){
      event.preventDefault();
      tryToLogIn();
    });
  };

  var setGoogleLoginEvents = function() {
    $googleLoginBtn.on('click', function(event){
      event.preventDefault();
      loginWithGoogle();
    });
  };

  var setForgotPasswordEvents = function() {
    $resetPwdBtn.on('click', function(event){
      event.preventDefault();
      handleForgotPassword();
    });
  };

  var setOneClickLoginEvents = function() {
    $oneClickLoginBtn.on('click', function(event){
      event.preventDefault();
      handleOneClickLogin();
    });
  };

  var setRegLoginSwitchEvents = function(){
    $switchLoginBtn.on('click', function(event){
      event.preventDefault();
      toggleRegLogin();
    });
  };

  var setCloseFormEvent = function(){
    $closeFormBtn.on('click', function(event){
      event.preventDefault();
      modal.hide();
      $articleContainer.removeClass('rb');
      SA.Logger.Mone.event('email_popup', moneSource , 'dismiss', {data: {page: monePage}});
    });
  };

  var setupModal = function() {
    $popupModal = modal.getModalObject();

    $regContainer = $('#' + options.regContainer);
    $loginContainer = $('#' + options.loginContainer);
    $regForm = $popupModal.find('#rb-reg-form');
    $loginForm = $popupModal.find('#rb-login-form');
    $googleLoginBtn = $popupModal.find('.log-google');
    $resetPwdBtn = $popupModal.find('#rst-pwd');
    $oneClickLoginBtn = $popupModal.find('#one-click-link');
    $switchLoginBtn = $popupModal.find('.switch-btn');
    $closeFormBtn = $popupModal.find('.close-svg');
    $articleContainer = $('#a-cont');

    $articleContainer.addClass('rb');

    setEventListeners();
  };

  var setEventListeners = function() {
    setRegisterEvents();
    setLogInEvents();
    setGoogleLoginEvents();
    setForgotPasswordEvents();
    setOneClickLoginEvents();
    setRegLoginSwitchEvents();
    setCloseFormEvent();
  };

  var getModalBody = function() {
    return JST['jst/widgets/roadblock/soft_roadblock']({
        ticker: options.primaryTicker,
        theme: articleEmailTheme['val'],
        isNewsLetter: options.isNewsLetter,
        closeSvgIcon: JST['jst/inline_svg/close_btn'](),
        host: SA.App.host,
        googleBtn: window.JST['jst/widgets/button/google_btn'](
          {
            googleSvg: window.JST['jst/inline_svg/google']({ width: 32, withBorder: false })
          }),
        googleSvg: window.JST['jst/inline_svg/google']({ width: 32, withBorder: true })
      }) || '';
  };

  var buildRbModal = function() {
    var bodyContent = getModalBody();
    if(bodyContent) {
      return SA.Widgets.Popup.build({
        className: options.className,
        backdrop: false,
        keyboard: false,
        showHeader: false,
        showCloseBtn: false,
        showBody: true,
        bodyContent: bodyContent,
        showFooter: false,
        removeAfterClose: true,
        afterOpen: options.afterOpen
      });
    }
  };

  var showRbPopup = function() {
    modal = buildRbModal();
    modal.show();
    SA.Logger.Mone.event('email_popup', moneSource , 'shown', {data: {page: monePage}});
  };

  var centerModal = function () {
    setModalLeft();
    centerVertically();
  };

  var setModalLeft = function (){
    var contentRailOffsetLeft, contentRailWidth, $modalDialog, $contentRail;
    $contentRail = $('#content-rail');
    if($contentRail && $contentRail.length && modal){
      contentRailOffsetLeft = $contentRail.offset().left;
      contentRailWidth = $contentRail.outerWidth();
      $modalDialog = modal.getModalObject().find('.modal-dialog');
      if($modalDialog){
        var modalWidth = $modalDialog.outerWidth();
        $modalDialog.css({
          "margin-left": contentRailOffsetLeft+(contentRailWidth-modalWidth)/2+'px'
        });
      }
    }
  };

  var centerVertically = function() {
    var windowHeight = $(window).height();
    var $modalDialog = modal.getModalObject().find('.modal-dialog');
    var modalDialogHeight = $modalDialog.height();
    $modalDialog.css({
      "margin-top": (windowHeight-modalDialogHeight)/2+'px'
    })
  };

  var removeSetModalLeftOnResizeEvent = function(){
    $(window).off('resize.roadblock');
  };

  var correctThemeIds = function() {
    var key = articleEmailTheme['key'];
    if (['etfs', 'investing-strategy', 'etfs-and-funds'].indexOf(key) > -1) {
      key = 'etf-content-once-daily-newsletter';
    } else if (key === 'market-outlook') {
      key = 'macro-view';
    } else if (key === 'earnings') {
      key = 'transcripts';
    } else if (key === 'dividends') {
      key = 'investing-income';
    } else if (key === 'stock-ideas'){
      key = 'investing-ideas'
    }

    articleEmailTheme['key'] = key;
  };

  var setCookies = function() {
    cookie.del('rb_newsletter');
    cookie.del('rb_rta_slug');
    if (options.primaryTicker) {
      cookie.set('rb_rta_slug', options.primaryTicker, {expires: cookieExpiration});
    } else {
      correctThemeIds();
      cookie.set('rb_newsletter', articleEmailTheme['key'], {expires: cookieExpiration});
    }
  };

  scope.getArticleEmailTheme = function (pageType) {

    var serverKVScope = SA.pageConfig.Ads.kvs, dKey = [], tKey = [];

    if (serverKVScope.d) {
      dKey = $.isArray(serverKVScope.d) ? serverKVScope.d : serverKVScope.d.split(',');
    }
    if (serverKVScope.t) {
      tKey = $.isArray(serverKVScope.t) ? serverKVScope.t : serverKVScope.t.split(',');
    }

    var pageKvs = $.unique($.merge($.merge([], tKey), dKey));
    var articleTypeKvs = {
      'investing-income': 'Dividends & Income',
      'investing-ideas': 'Investing Ideas',
      'market-outlook': 'Macro View',
      'etfs-and-funds': 'ETF & Portfolio Strategy',
      'portfolio-strategy-asset-allocation': 'Portfolio Strategy',
      'wall-st-breakfast': 'Wake up with a fresh Wall Street Breakfast, daily',
      'stock-ideas': 'Investing Ideas',
      'investing-strategy': 'ETF & Portfolio Strategy',
      'earnings': 'Transcript',
      'dividends': 'Dividends & Income'
    };
    var articleTypeIds = $.map(articleTypeKvs, function (value, id) {
      return id;
    });
    var foundRes;

    if (pageType === 'wall-st-breakfast') {
      foundRes = {key: 'wall-st-breakfast', val: articleTypeKvs['wall-st-breakfast']};
    } else {
      $.each(pageKvs, function (i, kvsSet) {
        if ($.inArray(kvsSet, articleTypeIds) !== -1) {
          var tmpKey = kvsSet;
          if (kvsSet === 'etfs-and-funds' || kvsSet === 'portfolio-strategy-asset-allocation') {
            tmpKey = 'etfs';
          }
          foundRes = {key: tmpKey, val: articleTypeKvs[kvsSet]};
          return false;
        }
      });
    }
    return foundRes ? foundRes : {key: 'stock-ideas', val: articleTypeKvs['stock-ideas']};
  };

  scope.show = function(opt) {
    opt = opt || {};
    options = $.extend({}, getDefaultOptions(), opt);
    var primaryText = options.primaryTicker ? 'primary' : 'no_primary',
        pageType = options.pageType ? '_' + options.pageType : '';
    moneSource = 'soft_roadblock_' + primaryText + pageType;
    monePage = window.aConf && window.aConf.pagination && window.aConf.pagination.page;
    articleEmailTheme = {};
    if ( ["article", "wall-st-breakfast", "dashboard"].includes(opt.pageType) ) {
      articleEmailTheme = scope.getArticleEmailTheme(opt.pageType);
      correctThemeIds();
    }
    showRbPopup();
    setCookies();
    centerModal();
    $(window).on('resize.roadblock', centerModal);
  };

  scope.showing = function() {
    return modal && modal.showing;
  };

}(SA, jQuery, SA.Data.Cookies));
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/roadblock/soft_roadblock_v1"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push(''); 
    var headingText = '',
      subscriptionsText = '',
      ctaText = 'Get Alerts',
      tickerSubsCount = '0',
      themeSubsCount = '0',
      MAX_SYMBOL_LENGTH_TO_SHOW = 7;
  
    function validateCounter(counter){
      return counter && counter !== '0'
    }
  
    if (ticker && ticker.length) {
      headingText = 'Get email alerts on <span class="ticker">' + ticker.toUpperCase() + '</span>';
      if(ticker.length <= MAX_SYMBOL_LENGTH_TO_SHOW) {
        ctaText = 'Get Alerts on ' + ticker.toUpperCase();
      }
    } else if (isNewsLetter) {
      headingText = 'Wake up with a fresh <span class="ticker">' + theme['val'] + '</span>, daily';
    } else {
      headingText = 'Get all of our top <span class="ticker">' + theme['val'] + '</span><br> articles in a single daily email'
    }
  
    if (ticker) {
      tickerSubsCount = SA.pageConfig.Data.primaryTickerRtaCount || tickerSubsCount;
      if(validateCounter(tickerSubsCount)) {
        subscriptionsText =  tickerSubsCount + ' investors are already subscribed to these alerts';
      }
    } else if(theme && SA.pageConfig.Data.themesSubscriprionsCounter){
      themeSubsCount = SA.pageConfig.Data.themesSubscriprionsCounter[theme['key']] || themeSubsCount;
      if(validateCounter(themeSubsCount)) {
        subscriptionsText =  themeSubsCount + ' investors are already subscribed to this newsletter';
      }
    }
  ; __p.push('\n\n<div id="soft-reg">\n  <button type="button" class="close close-svg" data-dismiss="modal" aria-label="Close">\n    <span aria-hidden="true"></span>\n  </button>\n  <div class="soft-body">\n    <div class="header">\n      <span class="heading">',  headingText ,'</span>\n      <br>\n      <span class="subheading">',  subscriptionsText ,'</span>\n    </div>\n    <form id="rb-reg-form" autocomplete="off">\n      <div class="form-group">\n        <input type="email" class="form-control" autocomplete="off" spellcheck="false" placeholder="Email Address" data-id="form-email">\n        <div class="error-container">\n          <div id="reg-error" class="rb-alert hidden" role="alert"></div>\n        </div>\n        <input type="submit" class="btn reg-orange-btn" value="',  ctaText ,'"/>\n      </div>\n    </form>\n  </div>\n  <div class="soft-footer">\n    <span>You are seeing this message because you are not signed in</span>\n    <br>\n    <span><a href="/account/login" source="soft_roadblock_register">Register</a> or <span class="switch-btn"> Sign in</span></span>\n  </div>\n</div>\n\n<div class="hidden" id="soft-login">\n  <button type="button" class="close close-svg" data-dismiss="modal" aria-label="Close">\n    <span aria-hidden="true"></span>\n  </button>\n  <div class="soft-body">\n    <div class="header">\n      <span class="heading">Please sign in:</span>\n    </div>\n\n    <form id="rb-login-form" autocomplete="on">\n      <div class="left-col">\n        <div class="form-group">\n          <input type="email" class="form-control" id="rb_login_email" autocomplete="on" spellcheck="false" placeholder="Email Address" data-id="form-email">\n        </div>\n        <div class="form-group">\n            <input type="password" class="form-control" id="rb_login_password" autocomplete="on" spellcheck="false" placeholder="Password" data-id="form-pwd">\n        </div>\n        <input type="submit" id="log-btn" class="btn orange-btn" value="Sign in">\n        <div class="frgt-pwd"><a href="#" id="rst-pwd">Forgot password?</a></div>\n      </div>\n      <div class="right-col">\n        <div id="log-google" class="goog-btn log-google">',  googleBtn ,'</div>\n        <input type="submit" class= "btn otl-login" id="one-click-link" value="Email me a sign in link">\n      </div>\n    </form>\n    <div class="error-container">\n      <div id="log-error" class="rb-alert hidden" role="alert"></div>\n    </div>\n  </div>\n  <div class="soft-footer">\n    <span>Dont have an account?<span class="switch-btn"> Register</span></span>\n  </div>\n</div>\n');}return __p.join('');};
}).call(this);










(function(SA, $, cookie){

  "use strict";

  var scope = SA.UsingNamespace('SA.Widgets.SoftRoadblock_v1');
  var checkEmailLock = false;
  var signInLock = false;
  var loginLock = false;
  var resetLock = false;
  var options;
  var modal;
  var helpers = SA.Utils.AuthenticationHelpers;

  var $popupModal, $regForm, $loginForm, $regContainer, $loginContainer, $resetPwdBtn, $oneClickLoginBtn, $googleLoginBtn, $switchLoginBtn, $closeFormBtn, $articleContainer;
  var moneSource, monePage, articleEmailTheme, userEmailExists = false, cookieExpiration = 24*60*60;

  var getError = function(error) {
    var errors = {
      defaultMessage: 'There was an error. Please try again later',
      emailNotValid: 'Please enter a valid email address.',
      passwordMissing: 'Please enter your password.',
      passwordNotValid: 'Your password must contain between 4 and 40 characters.',
      login_failed: 'Please check your email and password and try again.',
      blocked_user: 'Login failed, please report your issue on our <a href=' + SA.App.userEchoHost + '>feedback forum</a>',
      no_user: 'Please check your email and try again.',
      too_many_attempts: 'Too many login attempts have been made with an incorrect password. Please press Forgot your password? to reset your password',
      missing_user_details: 'Please check your email and password and try again.',
      already_registered: 'You are already registered, please try the Member sign in.',
      not_activated_not_bounced_user: 'There is already a registration in progress for this email, if you did not receive the confirmation email, please ask your IT department or email provider to place seekingalpha.com in the whitelist and try to register again',
      relevant_link: "You can request one sign in link per hour. Please recheck your email.",
      not_activated_bounced_user: function(date){ return 'There is already a registration in progress for this email, but our confirmation email was blocked by your email provider as of ' + date + ', we have attempted to remove the block and sent a password reset email to your inbox.';},
      activated_bounced_user: function(date){return 'This email already exists in our system, but was blocked by your email provider as of '+date+', we have attempted to remove the block and sent a password reset email to your inbox.'; }
    };

    return errors[error] || errors.defaultMessage;
  };

  var getDefaultOptions = function() {
    return {
      id: 'login',
      activity: 'roadblock',
      loginSuccess: 'onLoginSuccess',
      regSuccess: 'onRegSuccess',
      resetSuccess: 'onResetSuccess',
      oneClickLogin: 'onOneClickLoginSuccess',
      afterOpen: setupModal,
      afterClose: removeSetModalLeftOnResizeEvent,
      pageType: '',
      className: 'sa-soft-rb-v1',
      onLoginSuccess: null,
      loginContainer: 'soft-login',
      regContainer: 'soft-reg'
    };
  };

  var sendRegisterEvent = function(action ,data){
    SA.Logger.Mone.event('signup_popup', moneSource , action,  {data: data});
  };

  var sendLoginEvent = function(action, data){
    return data ? SA.Logger.Mone.event('roadblock', options.pageType+ '_login', action, { data: data }) : SA.Logger.Mone.event('roadblock', options.pageType+ '_login' , action);
  };

  var loginWithGoogle = function() {
    SA.Models.Authentication.googleLogin('gplus_popup', moneSource, 'shown', {data: {rbType: moneSource, page: monePage}});
  };

  var beforePwdReset = function() {
    resetLock = true;
    helpers.hideErrors($popupModal.find('#log-error'));
    $resetPwdBtn.find('.sa-loader').removeClass('hidden');
  };

  var afterPwdReset = function() {
    resetLock = false;
    $resetPwdBtn.find('.sa-loader').addClass('hidden');
  };

  var handleResetFailure = function(response, opt) {
    var errorContainer = $popupModal.find('#log-error');
    $('.has-success').removeClass('has-success');
    SA.Logger.Mone.event('roadblock', 'article_login_forgot_password','error', {data: {error_message: response.message, email : opt.email}});
    switch(response.message) {
      case 'not_confirmed_email_yet':
        return helpers.rbErrorPopup(JST['jst/popups/authentication/not_confirmed_email_yet'](), 'Confirm your registration', modal, true);
      case 'not_confirmed_email_still':
        return helpers.rbErrorPopup(JST['jst/popups/authentication/not_confirmed_email_still'](), 'Confirm your registration', modal, true);
      default:
        return helpers.showError(errorContainer, getError(response.message));
    }
  };

  var handleResetSuccess = function(opt) {
    sendLoginEvent('forgot_password_success', {email: opt.email});
    helpers.rbErrorPopup(JST['jst/popups/authentication/password_reset'](), 'Password reset', modal, true);
  };

  var onResetSuccess = function(response, opt) {
    response = response || {};
    afterPwdReset();

    return response.forgot_password ? handleResetSuccess(opt) : handleResetFailure(response, opt);
  };

  var onResetFailure = function(response, opt) {
    afterPwdReset();
  };

  var handleForgotPassword = function() {
    if(resetLock) {
      return false;
    }
    var $emailInput = $popupModal.find('#rb-login-form input[data-id="form-email"]'),
      $loginFormError = $popupModal.find('#log-error');

    if (helpers.validateEmail($emailInput, $loginFormError , getError('emailNotValid'))) {

      beforePwdReset();

      SA.Models.Authentication.resetPassword({
        id: options.id,
        activity: options.activity,
        'function': options.resetSuccess,
        email: $emailInput.val().trim(),
        onSuccess: onResetSuccess,
        onFailure: onResetFailure
      });
    } else {
      sendLoginEvent('error', {error_message: $loginFormError.text()});
    }

  };

  var beforeOneClickLogin = function() {
    resetLock = true;
    helpers.hideErrors($popupModal.find('#log-error'));
    SA.Logger.Mone.event('soft_roadblock','click_one_time_link_popup');
    $oneClickLoginBtn.find('.sa-loader').removeClass('hidden');
  };

  var afterOneClickLogin = function() {
    resetLock = false;
    $oneClickLoginBtn.find('.sa-loader').addClass('hidden');
  };

  var handleOneClickLoginFailure = function(response, opt) {
    var errorContainer = $popupModal.find('#log-error');
    $('.has-success').removeClass('has-success');
    SA.Logger.Mone.event('', 'soft_roadblock', 'one_time_login_link_error', {data: {error_message: response.message, email : opt.email}});
    switch(response.message) {
      case 'not_confirmed_email_yet':
        return helpers.rbErrorPopup(JST['jst/popups/authentication/not_confirmed_email_yet'](), 'Confirm your registration', modal, true);
      case 'not_confirmed_email_still':
        return helpers.rbErrorPopup(JST['jst/popups/authentication/not_confirmed_email_still'](), 'Confirm your registration', modal, true);
      default:
        return helpers.showError(errorContainer, getError(response.message));
    }
  };

  var handleOneClickLoginSuccess = function(opt) {
    SA.Logger.Mone.event('soft_roadblock','one_time_login_link_sent');
    helpers.rbErrorPopup(JST['jst/popups/authentication/one_time_login']({email: opt.email}), 'One Time Login', modal)
  };

  var onOneClickLoginSuccess = function(response, opt) {
    response = response || {};
    afterOneClickLogin();
    return response.login_link ? handleOneClickLoginSuccess(opt) : handleOneClickLoginFailure(response, opt);
  };

  var onOneClickLoginFailure = function(response, opt) {
    afterOneClickLogin();
  };

  var handleOneClickLogin = function() {
    if(resetLock) {
      return false;
    }
    var $emailInput = $popupModal.find('#rb-login-form input[data-id="form-email"]'),
      $loginFormError = $popupModal.find('#log-error');
    if (helpers.validateEmail($emailInput, $loginFormError , getError('emailNotValid'))) {

      beforeOneClickLogin();
      SA.Models.Authentication.oneClickLogin({
        id: options.id,
        activity: options.activity,
        'function': options.resetSuccess,
        email: $emailInput.val().trim(),
        onSuccess: onOneClickLoginSuccess,
        onFailure: onOneClickLoginFailure
      });
    } else {
      sendLoginEvent('error', {error_message: $loginFormError.text()});
    }

  };

  var onBeforeCheckEmail = function() {
    checkEmailLock = true;
    helpers.hideErrors($popupModal.find('#reg-error'));
    helpers.addLoader($popupModal.find('#reg-btn'));
  };

  var onAfterCheckEmail = function() {
    checkEmailLock = false;
  };


  var onCheckEmailFailure = function(request, opt){
    onAfterCheckEmail();
  };

  var handleActivatedEmail = function(response, opt){
    if(response.user_exists){
      userEmailExists = true;
      toggleRegLogin({action: 'regislogin_attempt', email: opt.email, user_exists: true});
      $popupModal.find('#rb_login_email').val(opt.email);
      $popupModal.find('#rb_login_password').val(opt.password);
      tryToLogIn();
    }
  };

  var showEmailErrorMessage = function(container, message, email){
    sendRegisterEvent('error', {email: email, error_message: message});
    helpers.showError(container, message);
  };


  var handleNonActivatedEmail = function(response, opt) {
    var errorContainer = $popupModal.find('#reg-error');
    $('.has-success').removeClass('has-success');
    switch(response.message) {
      case 'not_activated_not_bounced_user':
        return showEmailErrorMessage(errorContainer, getError('not_activated_not_bounced_user'), opt.email);
      case 'activated_bounced_user':
        return showEmailErrorMessage(errorContainer, getError('activated_bounced_user'), opt.email);
      case 'not_activated_bounced_user':
        return showEmailErrorMessage(errorContainer, getError('not_activated_bounced_user')(response.date), opt.email);
      default:
        return tryToReg(opt);
    }
  };

  var onCheckEmailSuccess = function(response, opt){
    onAfterCheckEmail();
    response = response || {};
    return response.user_exists ? handleActivatedEmail(response, opt) : handleNonActivatedEmail(response, opt);
  };

  var tryCheckEmail = function(){

    if (signInLock || checkEmailLock) {
      return;
    }

    var $emailInput = $popupModal.find('input[data-id="form-email"]');
    var $signInFormError = $popupModal.find('#reg-error');

    if (helpers.validateEmail($emailInput, $signInFormError, getError('emailNotValid'))) {
      onBeforeCheckEmail();

      SA.Models.Authentication.checkEmail({
        email: $emailInput.val().trim(),
        rb_user: true,
        onSuccess: onCheckEmailSuccess,
        onFailure: onCheckEmailFailure
      });
    }else{
      sendRegisterEvent('error', {email: $emailInput.val().trim(), error_message: $signInFormError.text()});
    }
  };

  var onAfterReg = function() {
    signInLock = false;
    helpers.removeLoader($popupModal.find('#reg-btn'));
  };

  var onRegFailure = function(request, opt) {
    onAfterReg();
  };

  var handleRegFailure = function(response, opt) {
    var errorContainer = $popupModal.find('#reg-error');
    $('.has-success').removeClass('has-success');

    sendRegisterEvent('reg_failure', {error: response.message, email : opt.email});

    switch(response.message) {
      case 'not_confirmed_email_yet':
        return helpers.rbErrorPopup(JST['jst/popups/authentication/not_confirmed_email_yet'](), 'Confirm your registration', modal, true);
      case 'not_confirmed_email_still':
        return helpers.rbErrorPopup(JST['jst/popups/authentication/not_confirmed_email_still'](), 'Confirm your registration', modal, true);
      case 'activated_bounced_user':
        return helpers.rbErrorPopup(JST['jst/popups/authentication/activated_bounced_user']({data: response.date}), 'This email already exists', modal, true);
      case 'not_activated_bounced_user':
        return helpers.rbErrorPopup(JST['jst/popups/authentication/not_activated_bounced_user']({data: response.date}), 'Registration in progress', modal, true);
      case 'not_activated_not_bounced_user':
        return helpers.rbErrorPopup(JST['jst/popups/authentication/not_activated_not_bounced_user'](), 'Registration in progress', modal, true);
      default:
        return helpers.showError(errorContainer, getError(response.message));
    }
  };

  var handleRegSuccess = function(opt) {
    modal.hide();
    SA.Logger.Mone.event('email_popup', moneSource , 'register',  {data: {email : opt.email}});

    if ( opt.activity === "newsletter" ) {
      SA.Utils.Observer.publish('registration/success-popup', {
        email:opt.email,
        backdrop: false,
        keyboard: false,
        showCloseBtn: true,
        fromRoadblock: true,
        headerContent: '<div class="subscription-success">Thank you for subscribing to Wall Street Breakfast newsletter</div>',
        source: moneSource
      });
    } else {
      SA.Utils.Observer.publish('registration/success-popup', {
        email:opt.email,
        backdrop: false,
        keyboard: false,
        showCloseBtn: true,
        fromRoadblock: true,
        source: moneSource
      });
    }
  };

  var onRegSuccess = function(response, opt) {
    response = response || {};
    onAfterReg();

    return response.registration ? handleRegSuccess(opt) : handleRegFailure(response, opt);
  };

  var tryToReg = function(opt){
    if (checkEmailLock || signInLock) {
      return;
    }
    if (opt.email) {
      signInLock = true;
      var activity = options.isNewsLetter ? 'newsletter' : 'rta',
        params = {
          id: options.id,
          activity: activity,
          'function': options.regSuccess,
          newsletter: 'wall-st-breakfast',
          pageType: options.pageType,
          email: opt.email,
          rtaAddAlerts: 1,
          rtaSource: 'soft_roadblock',
          author_tag_id_to_follow: options.authorTagId,
          primaryTicker: options.primaryTicker,
          onSuccess: onRegSuccess,
          onFailure: onRegFailure,
          backdrop: false
        };
      if (options.primaryTicker) {
        params.rta_slugs = options.primaryTicker;
      }
      SA.Models.Authentication.softRoadblockSignIn(params);
    }
  };

  var onBeforeLogin = function() {
    loginLock = true;
    helpers.hideErrors($popupModal.find('#log-error'));
    helpers.addLoader($popupModal.find('#log-btn'));
  };

  var onAfterLogin = function() {
    loginLock = false;
    helpers.removeLoader($popupModal.find('#log-btn'));
  };

  var handleLogInSuccess = function(opt) {
    opt.fromReg ? SA.Logger.Mone.event('signin_popup', moneSource, 'regislogin',  {data: {email: opt.email}}) :
      SA.Logger.Mone.event('signin_popup', moneSource, 'login_success',  {data: {email: opt.email}});
    if($.isFunction(options.onLoginSuccess)) {
      return options.onLoginSuccess();
    }
    return location.reload();
  };


  var handleLogInFailure = function(response, opt) {
    onAfterLogin();

    sendLoginEvent('error', {error_message: response.message, email: opt.email});

    var errorContainer = $popupModal.find('#log-error');
    $('.has-success').removeClass('has-success');
    switch(response.message) {
      case 'not_confirmed_email_yet':
        return helpers.rbErrorPopup(JST['jst/popups/authentication/not_confirmed_email_yet'](), 'Confirm your registration', modal, true);
      case 'not_confirmed_email_still':
        return helpers.rbErrorPopup(JST['jst/popups/authentication/not_confirmed_email_still'](), 'Confirm your registration', modal, true);
      case 'too_many_attempts':
        loginLock = false;
        return helpers.showError(errorContainer, getError('too_many_attempts'));
      default:
        return helpers.showError(errorContainer, getError(response.message));
    }
  };

  var onLogInSuccess = function(response, opt) {
    response = response || {};
    return response.login ? handleLogInSuccess(opt) : handleLogInFailure(response, opt);
  };

  var onLogInFailure = function(response, opt) {
    onAfterLogin();
  };

  var tryToLogIn = function() {
    if(loginLock) {
      return;
    }

    var $emailInput = $popupModal.find('#rb_login_email');
    var  $passwordInput = $popupModal.find('#rb_login_password');
    var  $loginFormError = $popupModal.find('#log-error');
    $loginFormError.html('');

    if (helpers.validateEmail($emailInput, $loginFormError, getError('emailNotValid'))
      && helpers.validatePresence($passwordInput, $loginFormError, getError('passwordMissing'))
      && helpers.validateSignInPasswordValueOld($passwordInput, $loginFormError, getError('passwordNotValid'))) {
      onBeforeLogin();

      SA.Models.Authentication.logIn({
        id: options.id,
        activity: options.activity,
        'function': options.loginSuccess,
        email: $emailInput.val().trim(),
        password: $passwordInput.val(),
        onSuccess: onLogInSuccess,
        onFailure: onLogInFailure,
        fromReg: userEmailExists
      });
    }else{
      sendLoginEvent('error',{email: $emailInput.val().trim(), error_message: $loginFormError.text()});
    }
  };

  var toggleRegLogin = function(data){
    if (data && data.user_exists) {
      $loginContainer.find('.header').text('We already have a user with that email').css('color', 'red');
    }

    $regContainer.toggleClass('hidden');
    $loginContainer.toggleClass('hidden');
    resetForms();
    sendSwitchEvent(data);
  };

  var resetForms = function(){
    $popupModal.find('.has-error').removeClass('has-error');
    $popupModal.find('.has-success').removeClass('has-success');
    $popupModal.find('input.form-control').val('');
    $popupModal.find('.rb-alert').not('.hidden').addClass('hidden').text('');
  };

  var sendSwitchEvent = function(data){
    var data = data || {}
    data.page = monePage;
    if($regContainer.hasClass('hidden') ){
      SA.Logger.Mone.event('signin_popup', moneSource , 'switch_to_login', {data: data});
    } else {
      userEmailExists=false;
      SA.Logger.Mone.event('email_popup', moneSource, 'switch_to_register', {data: data});
    }
  };

  var setRegisterEvents = function() {
    $regForm.on('submit', function(event){
      event.preventDefault();
      tryCheckEmail();
    });
  };

  var setLogInEvents = function() {
    $loginForm.on('submit', function(event){
      event.preventDefault();
      tryToLogIn();
    });
  };

  var setGoogleLoginEvents = function() {
    $googleLoginBtn.on('click', function(event){
      event.preventDefault();
      loginWithGoogle();
    });
  };

  var setForgotPasswordEvents = function() {
    $resetPwdBtn.on('click', function(event){
      event.preventDefault();
      handleForgotPassword();
    });
  };

  var setOneClickLoginEvents = function() {
    $oneClickLoginBtn.on('click', function(event){
      event.preventDefault();
      handleOneClickLogin();
    });
  };

  var setRegLoginSwitchEvents = function(){
    $switchLoginBtn.on('click', function(event){
      event.preventDefault();
      toggleRegLogin();
    });
  };

  var setCloseFormEvent = function(){
    $closeFormBtn.on('click', function(event){
      event.preventDefault();
      modal.hide();
      SA.Logger.Mone.event('email_popup', moneSource , 'dismiss', {data: {page: monePage}});
    });
  };

  var setupModal = function() {
    $popupModal = modal.getModalObject();

    $regContainer = $('#' + options.regContainer);
    $loginContainer = $('#' + options.loginContainer);
    $regForm = $popupModal.find('#rb-reg-form');
    $loginForm = $popupModal.find('#rb-login-form');
    $googleLoginBtn = $popupModal.find('.log-google');
    $resetPwdBtn = $popupModal.find('#rst-pwd');
    $oneClickLoginBtn = $popupModal.find('#one-click-link');
    $switchLoginBtn = $popupModal.find('.switch-btn');
    $closeFormBtn = $popupModal.find('.close-svg');
    $articleContainer = $('#a-cont');
    setEventListeners();
  };

  var setEventListeners = function() {
    setRegisterEvents();
    setLogInEvents();
    setGoogleLoginEvents();
    setForgotPasswordEvents();
    setOneClickLoginEvents();
    setRegLoginSwitchEvents();
    setCloseFormEvent();
  };

  var getModalBody = function() {
    return JST['jst/widgets/roadblock/soft_roadblock_v1']({
        ticker: options.primaryTicker,
        theme: articleEmailTheme,
        isNewsLetter: options.isNewsLetter,
        closeSvgIcon: JST['jst/inline_svg/close_btn'](),
        host: SA.App.host,
        googleBtn: window.JST['jst/widgets/button/google_btn'](
          {
            googleSvg: window.JST['jst/inline_svg/google']({ width: 32, withBorder: false })
          })
      }) || '';
  };

  var buildRbModal = function() {
    var bodyContent = getModalBody();
    if(bodyContent) {
      return SA.Widgets.Popup.build({
        className: options.className,
        backdrop: false,
        keyboard: false,
        showHeader: false,
        showCloseBtn: false,
        showBody: true,
        bodyContent: bodyContent,
        showFooter: false,
        removeAfterClose: true,
        afterOpen: options.afterOpen
      });
    }
  };

  var showRbPopup = function() {
    modal = buildRbModal();
    modal.show();
    SA.Logger.Mone.event('email_popup', moneSource , 'shown', {data: {page: monePage}});
  };

  var centerModal = function () {
    var windowHeight = $(window).height();
    var $modalDialog = modal.getModalObject().find('.modal-dialog');
    var modalDialogHeight = $modalDialog.height();
    $modalDialog.css({
      "margin-top": (windowHeight-modalDialogHeight)/2+'px'
    })
  };

  var removeSetModalLeftOnResizeEvent = function(){
    $(window).off('resize.roadblock');
  };

  var correctThemeIds = function() {
    var key = articleEmailTheme['key'];
    if (['etfs', 'investing-strategy', 'etfs-and-funds'].indexOf(key) > -1) {
      key = 'etf-content-once-daily-newsletter';
    } else if (key === 'market-outlook') {
      key = 'macro-view';
    } else if (key === 'earnings') {
      key = 'transcripts';
    } else if (key === 'dividends') {
      key = 'investing-income';
    } else if (key === 'stock-ideas'){
      key = 'investing-ideas'
    }

    articleEmailTheme['key'] = key;
  };

  var setCookies = function() {
    cookie.del('rb_newsletter');
    cookie.del('rb_rta_slug');
    if (options.primaryTicker) {
      cookie.set('rb_rta_slug', options.primaryTicker, {expires: cookieExpiration});
    } else {
      correctThemeIds();
      cookie.set('rb_newsletter', articleEmailTheme['key'], {expires: cookieExpiration});
    }
  };

  scope.getArticleEmailTheme = function (pageType) {

    var serverKVScope = SA.pageConfig.Ads.kvs, dKey = [], tKey = [];

    if (serverKVScope.d) {
      dKey = $.isArray(serverKVScope.d) ? serverKVScope.d : serverKVScope.d.split(',');
    }
    if (serverKVScope.t) {
      tKey = $.isArray(serverKVScope.t) ? serverKVScope.t : serverKVScope.t.split(',');
    }

    var pageKvs = $.unique($.merge($.merge([], tKey), dKey));
    var articleTypeKvs = {
      'investing-income': 'Dividends & Income',
      'investing-ideas': 'Investing Ideas',
      'market-outlook': 'Macro View',
      'etfs-and-funds': 'ETF & Portfolio Strategy',
      'portfolio-strategy-asset-allocation': 'Portfolio Strategy',
      'wall-st-breakfast': 'Wall Street Breakfast',
      'stock-ideas': 'Investing Ideas',
      'investing-strategy': 'ETF & Portfolio Strategy',
      'earnings': 'Transcript',
      'dividends': 'Dividends & Income'
    };
    var articleTypeIds = $.map(articleTypeKvs, function (value, id) {
      return id;
    });
    var foundRes;

    if (pageType === 'wall-st-breakfast') {
      foundRes = {key: 'wall-st-breakfast', val: articleTypeKvs['wall-st-breakfast']};
    } else {
      $.each(pageKvs, function (i, kvsSet) {
        if ($.inArray(kvsSet, articleTypeIds) !== -1) {
          var tmpKey = kvsSet;
          if (kvsSet === 'etfs-and-funds' || kvsSet === 'portfolio-strategy-asset-allocation') {
            tmpKey = 'etfs';
          }
          foundRes = {key: tmpKey, val: articleTypeKvs[kvsSet]};
          return false;
        }
      });
    }
    return foundRes ? foundRes : {key: 'stock-ideas', val: articleTypeKvs['stock-ideas']};
  };

  scope.show = function(opt) {
    opt = opt || {};
    options = $.extend({}, getDefaultOptions(), opt);
    var primaryText = options.primaryTicker ? 'primary' : 'no_primary',
        pageType = options.pageType ? '_' + options.pageType : '';
    moneSource = 'soft_roadblock_' + primaryText + pageType;
    monePage = window.aConf && window.aConf.pagination && window.aConf.pagination.page;
    articleEmailTheme = {};
    if ( ["article", "wall-st-breakfast", "dashboard"].includes(opt.pageType) ) {
      articleEmailTheme = scope.getArticleEmailTheme(opt.pageType);
      correctThemeIds();
    }
    showRbPopup();
    setCookies();
    centerModal();
    $(window).on('resize.roadblock', centerModal);
  };

  scope.showing = function() {
    return modal && modal.showing;
  };

}(SA, jQuery, SA.Data.Cookies));





(function(SA, $){
  "use strict";

  var scope = SA.UsingNamespace('SA.Widgets.PageRoadblock');

  var regularRB,
    options,
    rbScope,
    isRoadblocked = false,
    rbTimeout,
    singlePageforced;

  var getDefaultOpt = function(opt){
    return {
      articleId: null,
      authorTagId: null,
      primaryTicker: opt.primaryTicker,
      pageType: opt.pageType,
      isNewsLetter: opt.isNewsLetter
    };
  };

  var getRbDelay = function(){
    var delay = 0;
    if (singlePageforced || options.config.type === 'soft_rb_strategy') {
      delay = singlePageforced ? 1000 : 10000;
    } else {
      switch(options.page){
        case 1: delay = 15000;
        case 2: delay = 5000;
        default: delay = 0;
      }
    }
    return delay;
  };

  var initTimedRb = function(){
    var singlePageSent = false;
    if ( singlePageforced ) {
      SA.Utils.Scroll.add(function () {
        if ( !singlePageSent && SA.Utils.Scroll.isCloseToElement($('#sticky-ad-container-3'), 0) ) {
          singlePageSent = true;
          if(options.config.timed){
            rbTimeout = setTimeout(scope.show, getRbDelay());
          }
        }
      });
    } else {
      if ( options.config.timed ){
        rbTimeout = setTimeout(scope.show, getRbDelay());
      }
    }
  };

  scope.init = function(opt) {
    opt = opt || {};
    options = $.extend({}, getDefaultOpt(opt), opt);
    singlePageforced = window.aConf && window.aConf.pagination && window.aConf.pagination.singlePageforced;
    if (options.config.type === 'soft_rb_strategy') {
      SA.Utils.AbTests.init({
        'Soft roadblock': function (variation) {
          switch (variation){
            case 'test_v1':
              rbScope = SA.Widgets.SoftRoadblock_v1;
              break;
            default:
              rbScope = SA.Widgets.SoftRoadblock;
          }
          initTimedRb();
        }});
    } else { // no_rb / hard / tiered_1 / tiered_2
      SA.Utils.AbTests.init({
        'Hard roadblock': function (variation) {
          switch (variation){
            case 'test_v1':
              rbScope = SA.Widgets.RoadblockStep1_v1;
              break;
            default:
              rbScope = SA.Widgets.RoadblockStep1;
          }
          initTimedRb();
        }});
    }
  };

  scope.show = function(opt){
    options = $.extend({}, options, opt);
    if (options.config.type === 'soft_rb_strategy') {
      if(!SA.Widgets.Popup.isRunning() && !rbScope.showing()){
        rbScope.show(options);
        isRoadblocked = true;
      }
    } else {
      if(!SA.Widgets.Popup.isRunning() && !rbScope.showing()){
        rbScope.show(options);
        isRoadblocked = true;
      }
    }
  };

  scope.active = function(){
    return options.config.active;
  };

  scope.isRoadblocked = function(){
    return isRoadblocked;
  };

  scope.resetTimeout = function(time){
    if(rbTimeout) {
      clearTimeout(rbTimeout);
      if (time) {
        rbTimeout = setTimeout(scope.show, time);
      }
    }
  };

}(SA, jQuery));

(function(w, SA, $){

  "use strict";

  var scope = SA.UsingNamespace('SA.Widgets.TranscriptRoadblock'), step1 = SA.Widgets.RoadblockStep1;
  var options;
  var isRoadblocked = false;

  var getDefaultOpt = function(){
    return {
      articleId: null,
      authorTagId: null,
      primaryTicker: null,
      pageType: 'transcript'
    };
  };

  var initTimedRb = function(time){
    $(w).load(function() {
      time = time || 5000;
      if(scope.active()){
        setTimeout(scope.show, time);
      }
    });
  };

  scope.init = function(opt) {
    opt = opt || {};
    options = $.extend({}, getDefaultOpt(), opt);
    initTimedRb();
  };

  scope.show = function(opt){
    options = $.extend({}, options, opt);
    if(!SA.Widgets.Popup.isRunning() && !step1.showing()){
      step1.show(options);
      isRoadblocked = true;
    }
  };

  scope.active = function(){
    return options.config.active;
  };
  scope.isRoadblocked = function(){
    return isRoadblocked;
  };


}(window, SA, jQuery));




(function (w, SA) {

  'use strict';

  var cache,
    rbCache,
    DAYS_EXPIRED = 28,
    SOFT_RB_STRATEGY = 'soft_rb_strategy',
    HARD_RB_STRATEGY = 'hard_rb_strategy',
    TEST_NAME = 'New Registration Roadblock Soft Tiered Test News/QP/DB',
    TEST_IDENTIFIER = 'new_registration_roadblock_soft_tiered_test',
    PAGES_FOR_SOFT_RB = ['single_news', 'symbol_page', 'dashboard', 'wall-st-breakfast'],
    PAGE_VIEWS_FOR_SOFT_RB = [1, 3, 5];

  var softRbStrategy = function (pageData, roadblockSettings) {
    pageData.roadblock.type = SOFT_RB_STRATEGY;
    pageData.roadblock.active = true;
    var FirstVisit =
      roadblockSettings.visitsCount === 1 && (pageData.pagination.singlePageforced || pageData.pagination.page > 1),
      pagesForSoft = PAGES_FOR_SOFT_RB.includes(pageData.pageType) && PAGE_VIEWS_FOR_SOFT_RB.includes(roadblockSettings.pageViewsBySession);
    pageData.roadblock.timed = pagesForSoft || roadblockSettings.visitsCount > 1 || FirstVisit;
  };

  var hardRbStrategy = function (pageData) {
    pageData.roadblock.type = HARD_RB_STRATEGY;
    pageData.roadblock.active = true;
    pageData.roadblock.timed = pageData.pagination.singlePageforced || pageData.pagination.page > 1
  };

  function fromCache() {
    var rb = cache.getJson('roadblock_site_type');
    return rb && rb.value;
  }

  function getExpiration(days) {
    var date = new Date();
    return date.setDate(date.getDate() + days);
  }

  function getRbVisits() {
    var lsKey = 'roadblock_site_visits',
      rbVisitsJson = cache.get(lsKey),
      rbVisits;

    rbVisits = rbVisitsJson ? JSON.parse(rbVisitsJson) : [];

    // clear visits older than 28 days
    rbVisits = rbVisits.filter(function (ts) {
      return SA.Fn.daysBetween(ts) <= DAYS_EXPIRED;
    });

    cache.set(lsKey, JSON.stringify(rbVisits));

    return rbVisits;
  }

  function initRoadblock(roadblockSettings) {
    var pageData = SA.pageConfig.Data,
      method = pageData.article && pageData.article.isTranscript ? SA.Widgets.TranscriptRoadblock : SA.Widgets.PageRoadblock,
      page = pageData.article || pageData.mc || pageData,
      primaryTicker = page.primaryTicker || page.slug,
      newsPageNoTicker = (roadblockSettings.pageType === 'single_news' && !primaryTicker);

    if ($.isEmptyObject(method) || newsPageNoTicker) {
      w.skipSoftRb = true;
      return;
    }
    pageData.pagination = window.aConf && window.aConf.pagination || {};
    pageData.roadblock = window.aConf && window.aConf.roadblock || {};
    pageData.pageType = roadblockSettings.pageType;

    switch (roadblockSettings.variationName) {
      case SOFT_RB_STRATEGY:
        softRbStrategy(pageData, roadblockSettings);
        break;
      case HARD_RB_STRATEGY:
        hardRbStrategy(pageData);
        break;
      default:
        break;
    }

    var config;
    if (pageData.article) {
      config = {
        articleId: pageData.article.id,
        authorTagId: pageData.author.tagId,
        primaryTicker: primaryTicker,
        config: pageData.roadblock,
        page: pageData.pagination.page,
        pageType: roadblockSettings.pageType,
        isNewsLetter: roadblockSettings.isNewsLetter
      }
    } else {
      config = {
        primaryTicker: primaryTicker,
        config: pageData.roadblock,
        page: 1,
        pageType: roadblockSettings.pageType
      }
    }
    method.init(config);
  }

  function setRbVariation(variationName) {
    var visits = getRbVisits(),
      isArchived = SA.pageConfig.Data.article && SA.pageConfig.Data.article.isArchived,
      lastSessionId = cache.get('roadblock_session_id'),
      currentSessionId = SA.pageConfig.sessionID.split('.')[0],
      isNewVisit = lastSessionId !== currentSessionId,
      pageData = SA.pageConfig.Data,
      isNewsLetter = pageData.article && pageData.article.themes && pageData.article.themes.includes('wall-st-breakfast'),
      pageType = isNewsLetter ? 'wall-st-breakfast' : pageData.pageType,
      pageViewsBySession = parseInt(cache.get('roadblock_page_views_by_session')) || 0;

    if (isNewVisit) {
      SA.run(function () {
        cache.set('roadblock_session_id', currentSessionId);
        visits.push(Date.now());
        cache.set('roadblock_site_visits', JSON.stringify(visits));
        cache.set('roadblock_page_views_by_session', 0);
      }, 'RbSessionIdSet');
    }
    if (PAGES_FOR_SOFT_RB.includes(pageType)) {
      pageViewsBySession += 1;
      cache.set('roadblock_page_views_by_session', pageViewsBySession);
    } else {
      if (!pageType || pageType !== "article") {
        return;
      }
    }

    var visitsCount = visits.length;
    switch (variationName) {
      case 'test':
        if (PAGES_FOR_SOFT_RB.includes(pageType)) {
          variationName = SOFT_RB_STRATEGY;
        }
        break;
      case 'soft_tiered_rb_strategy':
        if (isArchived || visitsCount >= 4) {
          variationName = HARD_RB_STRATEGY;
        } else {
          variationName = SOFT_RB_STRATEGY;
        }
        break;
      default:
        break;
    }
    cache.set('roadblock_calc_type', variationName);
    var roadblockSettings = {
      variationName: variationName,
      visitsCount: visitsCount,
      pageViewsBySession: pageViewsBySession,
      pageType: pageType,
      isNewsLetter: isNewsLetter
    };
    initRoadblock(roadblockSettings);
  }

  function handleRoadblockStrategy(variationName) {
    if (!variationName) {
      return;
    }
    cache.set('roadblock_site_type', variationName, getExpiration(DAYS_EXPIRED));
    setRbVariation(variationName);
  }

  function initAbTestRoadblock() {
    if (rbCache) {
      setRbVariation(rbCache);
      SA.Logger.Mone.event('ab_tests', '', '', {
        data: {
          test_name: TEST_NAME,
          identifier: TEST_IDENTIFIER,
          variation: rbCache
        }
      });
    } else {
      SA.Utils.AbTests.init({
        'New Registration Roadblock Soft Tiered Test News/QP/DB': handleRoadblockStrategy
      });
    }
  }

  function init() {
    if (SA.Data.User.loggedIn()) {
      return;
    }

    cache = SA.Data.Cache;
    rbCache = fromCache();
    if (SA.pageConfig.Data.article) {
      setRbVariation('soft_tiered_rb_strategy');
    } else {
      initAbTestRoadblock();
    }
  }

  SA.run(init, 'roadblock-strategy');

}(window, window.SA));
(function (w, SA, $) {

  'use strict';

  var pushButton = $('#desktop_notifications'), UIPage = !!pushButton.length, isSubscribed, swRegistration;

  function mone(action) {
    SA.Logger.Mone.event('desktop_notifications', 'browser_permission_popup', action, {
      data: {
        user_id: SA.Data.User.id()
      }
    });
  }

  function token(sub) {
    return sub.endpoint.replace('https://android.googleapis.com/gcm/send/', '')
  }

  function subscribeOnServer(subscription) {
    if (subscription) {
      $.post(SA.App.host + '/pushes/desktop/subscribe', { token: token(subscription) }).done(function () {
        mone('device_added');
      }).fail(function () {
        mone('device_add_failed');
      });
    }
  }

  function unsubscribeOnServer(subscription) {
    if (subscription) {
      $.post(SA.App.host + '/pushes/desktop/unsubscribe', { token: token(subscription) }).done(function () {
        mone('device_added');
      });
    }
  }

  function updateUI() {
    if (UIPage) {
      if (w.Notification.permission === 'denied') {
        return pushButton.prop('disabled', true);
      }
      pushButton.prop('checked', isSubscribed);
      pushButton.prop('disabled', false);
    }
  }

  function subscribe() {
    swRegistration.pushManager.subscribe({
      userVisibleOnly: true
    }).then(function (subscription) {
      mone('clicked_allow');
      subscribeOnServer(subscription);
      isSubscribed = true;
      updateUI();
    }).catch(function () {
      updateUI();
    });
  }

  function unsubscribe() {
    swRegistration.pushManager.getSubscription().then(function (subscription) {
      if (subscription) {
        subscription.unsubscribe().then(function (success) {
          if (success) {
            unsubscribeOnServer(subscription);
            isSubscribed = false;
            updateUI();
            return success;
          }
        });
      }
    }).catch(function (error) {
      console.log(error);
    });
  }

  function handleCheckbox() {
    pushButton.prop('disabled', true);
    SA.Logger.Mone.event('RTA', 'email preferences', 'desktop_notifications:' + (isSubscribed ? 'uncheck' : 'check'));
    return isSubscribed ? unsubscribe() : subscribe();
  }

  function initUI() {
    if (UIPage) {
      pushButton.on('click', function (e) {
        e.preventDefault();
        handleCheckbox();
      });
    }
  }

  function handleDenied() {
    mone('notifications_already_denied');
  }

  function checkSubscription() {
    // Check the current Notification permission.
    // If its denied, it's a permanent block until the
    // user changes the permission
    if (w.Notification.permission === 'denied') {
      return handleDenied();
    }
    updateUI();
  }

  function initNotifications() {
    initUI();
    swRegistration.pushManager.getSubscription().then(function (subscription) {
      isSubscribed = subscription !== null;
      checkSubscription();
    }).catch(function () {
      mone('get_subscription_failed');
    });
  }

  function unregisterOld() {
    var scriptURL;
    if ($.isFunction(navigator.serviceWorker.getRegistration)) {
      var promise = navigator.serviceWorker.getRegistration();
      if (promise && $.isFunction(promise.then)) {
        promise.then(function (r) {
          if (r) {
            scriptURL = (r.active && r.active.scriptURL) ? r.active.scriptURL : '';
            // unregister old version where version number was used in URL
            // unregister both new and old versions of AMP SW not to interrupt desktop version
            if ((/seekingalpha\.com\/service-worker\.js\?v=/).test(scriptURL) || (/seekingalpha\.com\/amp\/sw\.js(\?v=)?/).test(scriptURL)) {
              r.unregister();
            }
          }
        });
      }
    }
  }

  function valid() {
    var o = {},
      chrome = o.toString.call(SA.Utils.Env.isChrome) === '[object Function]' ? SA.Utils.Env.isChrome() : SA.Utils.Env.isChrome;
    return (new RegExp(SA.App.host, 'g').test(location.href)) && chrome && SA.Data.User.loggedIn() && 'PushManager' in w;
  }

  function registerSW() {
    if ($.isFunction(navigator.serviceWorker.register)) {
      var promise = navigator.serviceWorker.register(SA.App.host + '/service-worker.js', { scope: '/' });
      if (promise && $.isFunction(promise.then)) {
        promise.then(function (swReg) {
          swRegistration = swReg;
          if (valid()) {
            initNotifications();
          }
        }).catch(function (ignore) {
        });
      }
    }
  }

  function initSW() {
    unregisterOld();
    // registerSW(); TODO: Do proper clean up after moving to oneSignal
  }

  function init() {
    if (window.navigator && ('serviceWorker' in navigator) && !(/^\/amp\//).test(window.location.pathname)) {
      initSW();
    } else {
      mone('push_unsupported');
      pushButton.parent().hide();
    }
  }

  SA.run(init, 'desktop-notifications');

}(window, window.SA, window.jQuery));
SA.require(['SA.Fn.ajax'], function(ajax) {

  'use strict';

  ajax('/custom_scripts', function(r) {
    r.forEach(function(s) {
      if(window.location.pathname.match(s[0])) {
        eval(s[1]);
      }
    });
  });

}, 'cust-script');
(function (SA) {
  if (SA.Utils.Env.isSafari() && !SA.Data.Cookies.get('kppid')) {
    var text = "";
    var possible = "abcdefghijklmnopqrstuvwxyz0123456789";
    for(var i = 0; i < 11; i++) {
        text += possible.charAt(Math.floor(Math.random() * possible.length));
    }
    SA.Data.Cookies.set('kppid', text, {expires: 60 * 60 * 24 * 180});
  }
}(window.SA));
// Google Tag Manager

(function (w, SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Vendor.Gtm'),
    logger = [];

  // public methods
  scope.trigger = function (data) {
    try {
      w.dataLayer.push(data);
      SA.trackq.push(['event', 'gtm', 'event', data]);
      logger.push(data);
    } catch (e) {
      console.log('Error occured in GTM trigger code', e);
      SA.exceptions.push(['Error occured in GTM trigger code', e]);
    }
  };

  scope.event = function (eventName, extra) {
    extra = extra || {};
    var data = {
      event: eventName
    };
    if (SA.Data.User.loggedIn()) {
      data.userId = SA.Data.User.id();
    }
    scope.trigger($.extend(data, extra));
  };

  scope.pv = function () {
    scope.event('VirtualPageview', {
      virtualPageURL: location.pathname + location.search,
      virtualPageTitle: document.title
    });
  };

  scope.showLog = function () {
    console.log(logger);
  };

  // private methods

  function triggerEvents() {
    if (w.location.pathname === '/account/user_account_created') {
      scope.event('registration', {
        category: 'Registration',
        action: 'Signup',
        label: w.location.href
      });
    } else {
      var saSource = SA.Utils.SASource.get();
      if (saSource === 'gplus_reg' || w.new_registration_gplus) {
        scope.event('registration_gplus', {
          category: 'SignInGoogle',
          action: 'Signup',
          label: w.location.href
        });
      } else if (SA.pageConfig.aconf === 't') {
        scope.event('confirmation', {
          category: 'Confirmation',
          action: 'Signup',
          label: w.location.href
        });
      }
    }
  }

  function init() {
    triggerEvents();
  }

  init();

}(window, window.SA, window.jQuery));
(function (w, SA, $) {
  'use strict';

  function init() {
    if (!SA.App.oneSignalAppId || SA.Data.User.isAuthor()) {
      return;
    }

    (function (w, d, s, l) {
      w[l] = w[l] || [];
      w[l].push(function() {
        OneSignal.init({
          appId: SA.App.oneSignalAppId
        });
      });
      var f = d.getElementsByTagName(s)[0],
        j = d.createElement(s);
      j.async = true;
      j.src = 'https://cdn.onesignal.com/sdks/OneSignalSDK.js';
      f.parentNode.insertBefore(j, f);
    })(window, document, 'script', 'OneSignal');
  }


  init();

}(window, window.SA, window.jQuery));
// should be very last script in pkg; Used in SpeedCurve
SA.require(['SA.mark'], function(m) {

  'use strict';

  m('sa-boot-common-footer-end');

}, 'footer-end-mark');



































































/*! jquery-dateFormat 18-05-2015 */

var DateFormat={};!function(a){var b=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],c=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],d=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],e=["January","February","March","April","May","June","July","August","September","October","November","December"],f={Jan:"01",Feb:"02",Mar:"03",Apr:"04",May:"05",Jun:"06",Jul:"07",Aug:"08",Sep:"09",Oct:"10",Nov:"11",Dec:"12"},g=/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.?\d{0,3}[Z\-+]?(\d{2}:?\d{2})?/;a.format=function(){function a(a){return b[parseInt(a,10)]||a}function h(a){return c[parseInt(a,10)]||a}function i(a){var b=parseInt(a,10)-1;return d[b]||a}function j(a){var b=parseInt(a,10)-1;return e[b]||a}function k(a){return f[a]||a}function l(a){var b,c,d,e,f,g=a,h="";return-1!==g.indexOf(".")&&(e=g.split("."),g=e[0],h=e[e.length-1]),f=g.split(":"),3===f.length?(b=f[0],c=f[1],d=f[2].replace(/\s.+/,"").replace(/[a-z]/gi,""),g=g.replace(/\s.+/,"").replace(/[a-z]/gi,""),{time:g,hour:b,minute:c,second:d,millis:h}):{time:"",hour:"",minute:"",second:"",millis:""}}function m(a,b){for(var c=b-String(a).length,d=0;c>d;d++)a="0"+a;return a}return{parseDate:function(a){var b,c,d={date:null,year:null,month:null,dayOfMonth:null,dayOfWeek:null,time:null};if("number"==typeof a)return this.parseDate(new Date(a));if("function"==typeof a.getFullYear)d.year=String(a.getFullYear()),d.month=String(a.getMonth()+1),d.dayOfMonth=String(a.getDate()),d.time=l(a.toTimeString()+"."+a.getMilliseconds());else if(-1!=a.search(g))b=a.split(/[T\+-]/),d.year=b[0],d.month=b[1],d.dayOfMonth=b[2],d.time=l(b[3].split(".")[0]);else switch(b=a.split(" "),6===b.length&&isNaN(b[5])&&(b[b.length]="()"),b.length){case 6:d.year=b[5],d.month=k(b[1]),d.dayOfMonth=b[2],d.time=l(b[3]);break;case 2:c=b[0].split("-"),d.year=c[0],d.month=c[1],d.dayOfMonth=c[2],d.time=l(b[1]);break;case 7:case 9:case 10:d.year=b[3],d.month=k(b[1]),d.dayOfMonth=b[2],d.time=l(b[4]);break;case 1:c=b[0].split(""),d.year=c[0]+c[1]+c[2]+c[3],d.month=c[5]+c[6],d.dayOfMonth=c[8]+c[9],d.time=l(c[13]+c[14]+c[15]+c[16]+c[17]+c[18]+c[19]+c[20]);break;default:return null}return d.date=d.time?new Date(d.year,d.month-1,d.dayOfMonth,d.time.hour,d.time.minute,d.time.second,d.time.millis):new Date(d.year,d.month-1,d.dayOfMonth),d.dayOfWeek=String(d.date.getDay()),d},date:function(b,c){try{var d=this.parseDate(b);if(null===d)return b;for(var e,f=d.year,g=d.month,k=d.dayOfMonth,l=d.dayOfWeek,n=d.time,o="",p="",q="",r=!1,s=0;s<c.length;s++){var t=c.charAt(s),u=c.charAt(s+1);if(r)"'"==t?(p+=""===o?"'":o,o="",r=!1):o+=t;else switch(o+=t,q="",o){case"ddd":p+=a(l),o="";break;case"dd":if("d"===u)break;p+=m(k,2),o="";break;case"d":if("d"===u)break;p+=parseInt(k,10),o="";break;case"D":k=1==k||21==k||31==k?parseInt(k,10)+"st":2==k||22==k?parseInt(k,10)+"nd":3==k||23==k?parseInt(k,10)+"rd":parseInt(k,10)+"th",p+=k,o="";break;case"MMMM":p+=j(g),o="";break;case"MMM":if("M"===u)break;p+=i(g),o="";break;case"MM":if("M"===u)break;p+=m(g,2),o="";break;case"M":if("M"===u)break;p+=parseInt(g,10),o="";break;case"y":case"yyy":if("y"===u)break;p+=o,o="";break;case"yy":if("y"===u)break;p+=String(f).slice(-2),o="";break;case"yyyy":p+=f,o="";break;case"HH":p+=m(n.hour,2),o="";break;case"H":if("H"===u)break;p+=parseInt(n.hour,10),o="";break;case"hh":e=0===parseInt(n.hour,10)?12:n.hour<13?n.hour:n.hour-12,p+=m(e,2),o="";break;case"h":if("h"===u)break;e=0===parseInt(n.hour,10)?12:n.hour<13?n.hour:n.hour-12,p+=parseInt(e,10),o="";break;case"mm":p+=m(n.minute,2),o="";break;case"m":if("m"===u)break;p+=n.minute,o="";break;case"ss":p+=m(n.second.substring(0,2),2),o="";break;case"s":if("s"===u)break;p+=n.second,o="";break;case"S":case"SS":if("S"===u)break;p+=o,o="";break;case"SSS":var v="000"+n.millis.substring(0,3);p+=v.substring(v.length-3),o="";break;case"a":p+=n.hour>=12?"PM":"AM",o="";break;case"p":p+=n.hour>=12?"p.m.":"a.m.",o="";break;case"E":p+=h(l),o="";break;case"'":o="",r=!0;break;default:p+=t,o=""}}return p+=q}catch(w){return console&&console.log&&console.log(w),b}},prettyDate:function(a){var b,c,d;return("string"==typeof a||"number"==typeof a)&&(b=new Date(a)),"object"==typeof a&&(b=new Date(a.toString())),c=((new Date).getTime()-b.getTime())/1e3,d=Math.floor(c/86400),isNaN(d)||0>d?void 0:60>c?"just now":120>c?"1 minute ago":3600>c?Math.floor(c/60)+" minutes ago":7200>c?"1 hour ago":86400>c?Math.floor(c/3600)+" hours ago":1===d?"Yesterday":7>d?d+" days ago":31>d?Math.ceil(d/7)+" weeks ago":d>=31?"more than 5 weeks ago":void 0},toBrowserTimeZone:function(a,b){return this.date(new Date(a),b||"MM/dd/yyyy HH:mm:ss")}}}()}(DateFormat),function(a){a.format=DateFormat.format}(jQuery);
(function (w, SA, $) {

  'use strict';

  function initHelpHeroEvents() {
    if(typeof(HelpHero) === 'undefined'){
      return;
    }
    var pageData = SA.pageConfig.Data;
    HelpHero.identify('tour_1' + SA.Data.User.id(), {
      newUser: SA.Data.User.isNewEssentialTour(),
      hasProductSubscription: SA.Data.User.isCommonPro(),
      hasPremium: SA.Data.User.isPro(),
      hasQuant:$('.breakdown-section').length,
      hasSaAuthors: !!pageData.symbolSentimentInfo,
      hasStockChart: pageData.article && pageData.article.primaryTicker.length,
      hasCoverageTab: !!$('#profile_tabs li.tab.coverage').length,
      hasArticlesTab: !!$('#profile_tabs li.tab.articles').length,
      hasPeersTab: !!$('#peers__comparison').length,
      hasEarningsTab: !!$('#earnings__earnings-summary').length,
      showLauncher: SA.Data.User.isShowLauncher(),
      symbolHasQuant:true
    });

    HelpHero.on('tour_advanced', function(event, info){
      var body = $('body');
      body.addClass('overflow-hidden');
      var indexNextStep = info.tour.stepIds.indexOf(info.step.id) + 1,
        nextStepId = info.tour.stepIds[indexNextStep],
        nextStep = info.tour.stepsById[nextStepId];
      if(nextStep.mode === 'HIGHLIGHT' && !$(nextStep.selector).length){
        body.removeClass('overflow-hidden');
      }

      if(info.step.mode=== "URL_MATCH" && info.tour.name === 'Start Tour'){
        $('body.logged-in').removeClass('load');
      }

      if(["HIGHLIGHT", "MODAL"].indexOf(info.step.mode) > -1){
        SA.Logger.Mone.event('product_tour', info.tour.name, 'foreword', {data: {step: info.step.className}});
      }
    });

    HelpHero.on('tour_started', function(event, info){
      if(info.tour.name === 'Start Tour'){
        $('body.logged-in').addClass('load');
      }

      if(info.tour.name === 'Symbol - Summary Tab'){
        $('.analysis .section-heading').click();
      }

      SA.Logger.Mone.event('product_tour', info.tour.name, 'started');
    });

    HelpHero.on('tour_cancelled', function(event, info){
      $('body').css({'overflow':'auto'});
      SA.Logger.Mone.event('product_tour', info.tour.name, 'cancel', { data: { 'step': info.step.className } });
    });

    HelpHero.on('tour_completed', function(event, info){
      $('body').css({'overflow':'auto'});
      SA.Logger.Mone.event('product_tour', info.tour.name, 'completed');
    });

    HelpHero.on('tour_interrupted', function(event, info){
      $('body').css({'overflow':'auto'});
      SA.Logger.Mone.event('product_tour', info.tour.name, 'interrupted', { data: { 'step': info.step.className } });
    });
  }

  function init() {
      initHelpHeroEvents();
  }

  init();
}(window, window.SA, window.jQuery));
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/follow_author_tooltip"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('\n');  if(authorResearch){ ; __p.push('\n<div class="checkbox b-b">\n  <label><input type="checkbox" class="a-r">',  authorResearch.title ,'</label>\n  <div>',  authorResearch.shortPitch ,'<a target=\'_blank\' href="',  authorResearch.subscribeLink ,'&source=follow_top_learn_more"><b> Learn More</a></b></div>\n</div>\n');  } ; __p.push('\n<div class="checkbox">\n  <label><input type="checkbox" class="fol" ',  userFollowInfo.authorFollow  ? 'checked' : '' ,'>Follow this author</label>\n  <div>See their articles on your Seeking Alpha homepage and in your feed.</div>\n</div>\n<div class="checkbox b-t">\n  <label><input type="checkbox" class="rta" ',  userFollowInfo.authorRta  ? 'checked' : '' ,'>Real-time alerts on this author</label>\n  <div>Get their new articles emailed to you as they are published.</div>\n</div>\n<div class="checkbox b-t">\n  <label><input type="checkbox" class="d-d" ',  userFollowInfo.dailyDigest  ? 'checked' : '' ,'>Daily digest on all my authors</label>\n  <div>Get all your favorite authors new articles emailed to you in one daily digest.</div>\n</div>\n');}return __p.join('');};
}).call(this);
(function (SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Models.AuthorModel'),
    followedUsers = SA.Data.User.followedUsers(),
    followedAuthors = SA.Data.User.followedAuthors(),
    o = SA.Utils.Observer;

  // Unfollow - rta parameter means ONLY rta, not unfollow
  // Follow - rta means also getting rta
  scope.updateFollowCountByArticle = function (articleId, mode, rta) {
    $.ajax({
      method: 'POST',
      url: '/articles/update_follow_counter_by_article',
      dataType: 'text',
      data: {
        article_id: articleId,
        mode: mode,
        rta: rta
      }
    });
  };

  scope.isFollowingUser = function (id) {
    return $.inArray(id, followedUsers) !== -1;
  };

  scope.isFollowingAuthor = function (slug) {
    return $.inArray(slug, followedAuthors) !== -1;
  };

  scope.unFollowUser = function (opt) {
    opt = opt || {};
    if (!$.isEmptyObject(opt) && $.isNumeric(opt.id)) {
      unFollowUser(opt);
    }
  };

  scope.followUser = function (opt) {
    opt = opt || {};
    if (!isNaN(opt.id) && $.isNumeric(opt.id)) {
      var d = {user_id: opt.id};
      followUserOrAuthor(d,
        onFollowUserSuccess(d.user_id, opt.onSuccess),
        onUserFailure(d.user_id, opt.onFailure)
      );
    }
  };

  scope.unFollowAuthor = function (opt) {
    opt = opt || {};
    if (!$.isEmptyObject(opt) && opt.slug) {
      unFollowAuthor(opt);
    }
  };

  scope.followAuthor = function (opt) {
    opt = opt || {};
    if (!$.isEmptyObject(opt) && opt.slug) {
      followUserOrAuthor({slug: opt.slug},
        onFollowAuthorSuccess(opt.slug, opt.id, opt.onSuccess),
        onAuthorFailure(opt.slug, opt.onFailure)
      );
    }
  };

  scope.followAuthorWithRta = function (opt) {
    opt = opt || {};
    if (!$.isEmptyObject(opt) && opt.slug) {
      followAuthorWithRta(opt);
    }
  };

  scope.followersFollowings = function (opt) {
    opt = opt || {};
    if (!$.isEmptyObject(opt) && opt.userId) {
      followersFollowings(opt);
    }
  };


  // Private functions

  function removeFromUserFollowing(id) {
    if (scope.isFollowingUser(id)) {
      followedUsers.splice($.inArray(id, followedUsers), 1);
    }
  }

  function addToAuthorFollowing(slug) {
    if (!scope.isFollowingAuthor(slug)) {
      followedAuthors.push(slug);
    }
  }

  function removeFromAuthorFollowing(slug) {
    if (scope.isFollowingAuthor(slug)) {
      followedAuthors.splice($.inArray(slug, followedAuthors), 1);
    }
  }

  function addToUserFollowing(id) {
    if (!scope.isFollowingUser(id)) {
      followedUsers.push(id);
    }
  }

  function unFollowUser(opt) {
    $.ajax({
      method: 'POST',
      url: '/account/ajax_stop_follow_this_user',
      dataType: 'text',
      data: {
        follow_user_id: opt.id
      }
    }).done(function (res) {
      removeFromUserFollowing(opt.id);
      o.publish('user/unfollow', {id: opt.id});
      if ($.isFunction(opt.onSuccess)) {
        opt.onSuccess(opt.id);
      }
    }).fail(function (res) {
      onUserFailure(opt.id, opt.onFailure);
    });
  }

  function followUserOrAuthor(data, onSuccess, onFailure) {
    $.ajax({
      method: 'POST',
      url: '/account/ajax_logged_in_follow_new_user',
      data: data,
      dataType: 'text'
    }).done(onSuccess).fail(onFailure);
  }

  function onFollowUserSuccess(userId, clb) {
    addToUserFollowing(userId);
    o.publish('user/follow', {id: userId});
    if ($.isFunction(clb)) {
      clb(userId);
    }
  }

  function onFollowAuthorSuccess(slug, authorId, clb) {
    addToAuthorFollowing(slug);
    o.publish('user/follow', {slug: slug, id: authorId});
    if ($.isFunction(clb)) {
      clb(slug);
    }
  }

  function unFollowAuthor(opt) {
    $.ajax({
      method: 'POST',
      url: '/account/ajax_stop_follow_this_author',
      data: {author_slug: opt.slug},
      dataType: 'text'
    }).done(function (response) {
      removeFromAuthorFollowing(opt.slug);
      o.publish('user/unfollow', {slug: opt.slug});
      if (opt.articleId) {
        scope.updateFollowCountByArticle(opt.articleId, 'unfollow', false);
      }
      if ($.isFunction(opt.onSuccess)) {
        opt.onSuccess(opt.slug, response);
      }
    }).fail(onAuthorFailure(opt.slug, opt.onFailure));
  }

  function followAuthorWithRta(opt) {
    $.post('/account/ajax_subscribe_to_author_rta', {
      author_slug: opt.slug
    }).done(function (res) {
      if (res && !res.msg) {
        addToAuthorFollowing(opt.slug);
        o.publish('user/follow', {slug: opt.slug, id: opt.id});

        if (opt.articleId) {
          scope.updateFollowCountByArticle(opt.articleId, 'follow', true);
        }

        if ($.isFunction(opt.onSuccess)) {
          opt.onSuccess(opt.slug, res);
        }
      } else {
        onAuthorFailure(opt.slug, opt.onFailure);
      }
    }).fail(onAuthorFailure(opt.slug, opt.onFailure));
  }

  function followersFollowings(opt) {
    $.get('/account/ajax_user_followers_followings', {user_id: opt.userId}).done(function (response) {
      if ($.isFunction(opt.onSuccess)) {
        opt.onSuccess(opt.userId, response);
      }
    }).fail(function (response) {
      if ($.isFunction(opt.onFailure)) {
        opt.onFailure(opt.slug, response);
      }
    });
  }

  function onUserFailure(userId, clb) {
    if ($.isFunction(clb)) {
      clb(userId);
    }
  }

  function onAuthorFailure(slug, clb) {
    if ($.isFunction(clb)) {
      clb(slug);
    }
  }

}(window.SA, window.jQuery));
(function() { this.JST || (this.JST = {}); this.JST["jst/profile/logged_out_subscription_success"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div class="rta_pop_article thankyou">\n  <div class="rta_pop_article_top">\n    <p class="email_msg_popup">\n      A confirmation email has been sent to <strong>',  email ,'</strong>\n    </p>\n    <p class="last_p">\n      Please confirm your registration by clicking the link in the email\n    </p>\n  </div>\n  <div class="cleaner"></div>\n</div>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/profile/logged_out_subscription_failure"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div class="rta_pop_article thankyou">\n  <div class="rta_pop_article_top">\n    <p class="email_msg_popup">\n      Subscription for ',  email || 'this email' ,' has failed\n    </p>\n    <p class="last_p">\n      ',  error_message ,'\n    </p>\n  </div>\n  <div class="cleaner"></div>\n</div>\n');}return __p.join('');};
}).call(this);
// Petametrics-Liftigniter load-init script

(function (window, SA) {

  "use strict";

  var scope = SA.UsingNamespace('SA.Utils.Liftigniter');

  scope.init = function () {
    (function (w, d, s, p, v, e, r) {
      w['$igniter_var'] = v;
      w[v] = w[v] || function () {
          (w[v].q = w[v].q || []).push(
            arguments)
        };
      w[v].l = 1 * new Date();
      e = d.createElement(s), r = d.getElementsByTagName(s)[0];
      e.async = 1;
      e.src = p + '?ts=' + (+new Date() / 3600000 | 0);
      e.onload = function(){
        SA.Logger.Mone.event("liftigniter", "liftigniter_script", "successful");
      };
      e.onerror = function(){
        SA.Logger.Mone.event("liftigniter", "liftigniter_script", "failed");
      };
      r.parentNode.insertBefore(e, r)
    })(window, document, 'script', '//cdn.petametrics.com/k2lfmn21cq6srufb.js', '$p');
    $p("init", "k2lfmn21cq6srufb");
    $p("send", "pageview");
  };
}(window, SA));








(function(SA, $){

  'use strict';

  var scope = SA.UsingNamespace('SA.Widgets.ArticleAuthorHeader'), conf = SA.pageConfig || {};

  var followClass = '.follow-link',
    dailyDigestTagId = 34909,
    wallStBreakfastTagId = 3340,
    authorData,
    userData,
    articleId,
    followToolTipShown = false,
    moneData = {},
    showProBanner = true,
    $wsbHdHide = $('#wsb-hd-hide'),
    $txtUserEmail = $('[data-behavior="user-email"]'),
    $btnUserEmail = $('[data-behavior="submit-email"]'),
    authorModel = SA.Models.AuthorModel;

  var getAuthorOpt = function(){
    return {
      tagId: 0,
      slug: '',
      research: null,
      followers: 0,
      nick: '',
      isBrand: false
    };
  };

  var initAuthorResearchData = function(){
    if(authorData.research){
      authorData.research.subscribeLink = '/checkout?service_id=mp_' + authorData.research.id;
    }
  };

  var separateNumberWithCommas = function(n){
    while (/(\d+)(\d{3})/.test(n.toString())){
      n = n.toString().replace(/(\d+)(\d{3})/, '$1'+','+'$2');
    }
    return n;
  };

  var setFollowersText = function(followers){
    var string = '(' + separateNumberWithCommas(followers) + ' follower' + (followers === 1 ? '' :'s') + ')';
    $('.a-followers').text(string);
  };

  // Track author external link
  var initExternalClickTracking = function(){
    $('#author-external').on('click', function(){
      SA.Logger.Mone.event('article', 'auth_header_link', 'click', {
        data: $(this).data('event')
      });
    });
  };

  //followers

  var onGetAuthorInfoSuccess = function(data){
    authorData.followers =  parseInt(data.followers, 10);
    setFollowersText(authorData.followers);
  };

  var initAuthorInfo = function(){
    $.get('/articles/ajax_get_article_author_info?tag_id=' + authorData.tagId, function(res) {
      if(res.data){
        onGetAuthorInfoSuccess(res.data);
      }
    });
  };

  //user following

  var getUserData = function(){
    if(SA.Data.User.loggedIn()){
      return {
        loggedIn: true,
        id: SA.Data.User.id(),
        authorFollow: $.inArray(authorData.slug, SA.Data.User.followedAuthors()) !== -1,
        authorRta: $.inArray(authorData.tagId, SA.Data.User.getRtaAuthorsIds()) !== -1,
        dailyDigest: $.inArray('authors-alerts', SA.Data.User.getNewsletterSubscriptions()) !== -1,
        wallStBreakfast: $.inArray('wall-st-breakfast', SA.Data.User.getNewsletterSubscriptions()) !== -1
      };
    }
    return {loggedIn: false};
  };

  var getCheckbox = function(type){
    var inputClass = {
      authorFollow: 'input.fol',
      authorRta: 'input.rta',
      dailyDigest: 'input.d-d'
    };
    return $('.popover-content').find(inputClass[type]);
  };

  var setfollowLinkHtml = function($link, following){
    $link.html(following ? 'Following' : '<span>Follow</span>');
    return following ? $link.addClass('following') : $link.removeClass('following');
  };

  var updateFollowers = function(diff){
    authorData.followers += diff;
    setFollowersText(authorData.followers);
  };

  var addCheckboxLoaders = function($inputs){
    $inputs.parent('label').addClass('cb-loader');
    $inputs.addClass('hidden');
  };

  var rmvCheckboxLoaders = function(){
    var $tooltip = $('.popover-content');
    $tooltip.find('label.cb-loader').removeClass('cb-loader');
    $tooltip.find('input.hidden').removeClass('hidden');
  };

  var updateUserData = function(type, value){
    userData[type] = value;
  };

  var toggleCheckbox = function(type, checked){
    getCheckbox(type).prop('checked', checked);
  };

  var onCheckboxChange = function(type, checked){
    updateUserData(type, checked);
    toggleCheckbox(type, checked);
  };

  // send event to Liftigniter upon following MP author
  var updateLiftigniter = function(data) {
    SA.Utils.Liftigniter.init();
    var hashParams = {conversion_t: 'author follow', author_name: data.nick};
    if (SA.pageConfig.Data.article.from_liftigniter) {
      hashParams.source = 'LI';
    }

    $p('send', 'engaged',hashParams)
  };

  var onFollowSuccess = function(){
    updateFollowers(1);
    setfollowLinkHtml($(followClass), true);
    onCheckboxChange('authorFollow', true);
    onCheckboxChange('authorRta', true);
    rmvCheckboxLoaders();

    if(authorData.research){
      updateLiftigniter(authorData);
    }
  };

  var onUnfollowSuccess = function(){
    updateFollowers(-1);
    setfollowLinkHtml($(followClass), false);
    onCheckboxChange('authorFollow', false);
    onCheckboxChange('authorRta', false);
    rmvCheckboxLoaders();
  };

  var followAuthor = function(){
    authorModel.followAuthorWithRta({
      slug: authorData.slug,
      id: authorData.userId,
      onSuccess: onFollowSuccess,
      onFailure: rmvCheckboxLoaders,
      articleId: articleId
    });
  };

  var unfollowAuthor = function(){
    authorModel.unFollowAuthor({
      slug: authorData.slug,
      onSuccess: onUnfollowSuccess,
      onFailure: rmvCheckboxLoaders,
      articleId: articleId,
      rta: userData.authorRta
    });
  };

  var authenticateAndFollow = function(){
    SA.Widgets.AuthenticationPopup.show(
      {
        id: 'slug|' + authorData.slug,
        activity: 'follow_me',
        loginSuccess: 'Follow.Login',
        signInSuccess: 'Follow.Register',
        resetSuccess: 'Follow.ForgotPassword'
      }
    );
  };

  var onAddRtaSuccess = function(){
    onCheckboxChange('authorRta', true);
    authorModel.updateFollowCountByArticle(articleId, 'follow', true);
    rmvCheckboxLoaders();
  };

  var onRmvRtaSuccess = function(){
    onCheckboxChange('authorRta', false);
    authorModel.updateFollowCountByArticle(articleId, 'unfollow', true);
    rmvCheckboxLoaders();
  };

  var addAuthorRta = function(){
    SA.Models.SubscriptionModel.subscribe(
      {
        tagIds: authorData.tagId,
        modes: 'author_rta',
        onSuccess: onAddRtaSuccess,
        onFailure: rmvCheckboxLoaders
      }
    );
  };

  var rmvAuthorRta = function(){
    SA.Models.SubscriptionModel.unsubscribe(
      {
        tagIds: authorData.tagId,
        modes: 'author_rta',
        onSuccess: onRmvRtaSuccess,
        onFailure: rmvCheckboxLoaders
      }
    );
  };

  var onAddDigestSuccess = function(){
    onCheckboxChange('dailyDigest', true);
    rmvCheckboxLoaders();
  };

  var onRmvDigestSuccess = function(){
    onCheckboxChange('dailyDigest', false);
    rmvCheckboxLoaders();
  };

  var addDailyDigest = function(){
    SA.Models.SubscriptionModel.subscribe(
      {
        tagIds: dailyDigestTagId,
        modes: 'newsletters',
        onSuccess: onAddDigestSuccess,
        onFailure: rmvCheckboxLoaders
      }
    );
  };

  var rmvDailyDigest = function(){
    SA.Models.SubscriptionModel.unsubscribe(
      {
        tagIds: dailyDigestTagId,
        modes: 'newsletters',
        onSuccess: onRmvDigestSuccess,
        onFailure: rmvCheckboxLoaders
      }
    );
  };

  // Init Follow Link

  var onClickFollow = function(event){

    var action = 'follow_author';
    var moneSource = 'article_auth_header';
    if(userData && userData.authorFollow) action = 'stop_' + action;
    if(event) moneSource = event.data.moneSource;
    sendMoneEvent('auth_follow', moneSource, action);

    addCheckboxLoaders(getCheckbox('authorFollow'));
    if (!userData.authorFollow || userData.authorRta) {
      addCheckboxLoaders(getCheckbox('authorRta'));
    }
    return userData.authorFollow ? unfollowAuthor() : followAuthor();
  };

  var onEnterFollowLink = function(){
    $(this).popover('show');
    followToolTipShown = true;
    sendMoneEvent('auth_follow','article_auth_header', 'tooltip_shown');
    $(this).siblings('.popover').on('mouseleave', function () {
      $(followClass).popover('hide');
      followToolTipShown = false;
    });
    if(userData.authorFollow){
      $(this).find('b').html('&times; Unfollow');
    }
  };

  var onLeaveFollowLink = function(){
    setTimeout(function () {
      if (!$('.popover:hover').length) {
        $(followClass).popover('hide');
        followToolTipShown = false;
      }
    }, 100);
    if(userData.authorFollow){
      $(this).find('b').html('&#10004; Following');
    }
  };

  var setTabletEvents = function($link){
    var env = SA.Utils.Env;
    var isTablet = env.isMobile() || env.isAppleIpad() || (window.hasOwnProperty('ontouchstart') && !env.isChrome()) ;
    if(isTablet && followToolTipShown){
      $(window).bindWithDelay("scroll", function() {
        $link.popover('hide');
        followToolTipShown = false;
      }, 500, true);
    }
  };

  var setFollowLinkEvents = function($link){
    $link.on(
      {
        'mouseenter': onEnterFollowLink,
        'mouseleave': onLeaveFollowLink,
        'click': function(e) {
          e.preventDefault();
          onClickFollow();
        }
      }
    );
  };

  var initFollowLink = function($link){
    setfollowLinkHtml($link, userData.authorFollow);
    setFollowLinkEvents($link);
  };

  // init follow tooltip

  var onCheckRta = function() {
    var action = 'follow_author';
    if(userData && userData.authorRta)
      action = 'stop_' + action;
    sendMoneEvent('RTA','article_auth_header_tooltip', action);

    if (userData.authorFollow) {
      addCheckboxLoaders($(this));
      return userData.authorRta ? rmvAuthorRta() : addAuthorRta();
    }
    return onClickFollow();
  };
  var onCheckDailyDigest = function(){
    var action = 'newsletters';
    if(userData)
      action += ':' + (!userData.dailyDigest ? 'checked' : 'unchecked');
    sendMoneEvent('RTA','article_auth_header_tooltip', action);

    addCheckboxLoaders($(this));
    return userData.dailyDigest ? rmvDailyDigest() : addDailyDigest();
  };

  var onCheckAuthorResearch = function(){
    window.open(authorData.research.subscribeLink + '&source=follow_top', '_blank');
  };

  var getTooltipContent = function(){
    return JST['jst/widgets/follow_author_tooltip']({userFollowInfo: userData, authorResearch: authorData.research});
  };

  var initFollowTooltip = function($link){
    $link.popover({
      html: true,
      trigger: 'manual',
      placement: 'bottom',
      title: 'Author Following Options:',
      content: getTooltipContent
    });
  };

  var setFollowTooltipEvents = function($link){
    $link.one('mouseenter', function(){
      var $tooltip = $(this).siblings('.popover');
      var moneSource = {moneSource : 'article_auth_header_tooltip'};
      $tooltip.on('click', 'input.fol',moneSource, onClickFollow);
      $tooltip.on('click', 'input.rta',moneSource, onCheckRta);
      $tooltip.on('click', 'input.d-d',moneSource, onCheckDailyDigest);
      if(authorData.research){
        $tooltip.on('click', 'input.a-r',moneSource, onCheckAuthorResearch);
      }
      setTabletEvents($link);
    });
  };

  var initFollowAuthorLoggedIn = function($link){
    initFollowLink($link);
    initAuthorResearchData();
    initFollowTooltip($link);
    setFollowTooltipEvents($link);
  };

  var initFollowAuthorLoggedOut = function($link){
    $link.html('<span>Follow</span>');
    $link.on('click', function(e){
      e.preventDefault();
      authenticateAndFollow();
    });
  };

  var initNavHeader = function() {
    if ($('body').attr('class').indexOf('force-pro') > -1) {
      $('#nav_notifications_link svg path').css('fill', '#e7e7e7');
      SA.Logger.Mone.event(articleId.toString(), 'free_pro_article', 'shown');
    }

    $(window).bindWithDelay("scroll", function() {
      if (showProBanner && $('.pro-bottom-unit').is(':visible')) {
        showProBanner = false;
        SA.Logger.Mone.event('bottom_banner', 'free_pro_article', 'banner_shown');
      }
    }, 500, true);
  };

  var initSubscribeWsb = function () {
    if (userData.loggedIn) {
      if (!userData.wallStBreakfast) {
        $txtUserEmail.hide();
        $wsbHdHide.slideDown(1500);
      }
    } else {
      $txtUserEmail.show();
      $wsbHdHide.slideDown(1500);
    }

    $btnUserEmail.on('click', function(e){
      $(this).addClass("sa-animated").prop('disabled', true);
      if (userData.loggedIn) {
        return SA.Models.SubscriptionModel.subscribe({
          tagIds:wallStBreakfastTagId,
          modes:"newsletters",
          onSuccess: successWsbSubscribed});
      }
      subscribeWsbLoggedOut(e);
    });
  };
  var successWsbSubscribed = function(response){
    if (response.errors) { // response from SA.Models.SubscriptionModel.subscribe
      buildSubscribePopup(response).show();
    } else {               // response from '/authentication/registration'
      $wsbHdHide.fadeOut();
      if (userData.loggedIn) {
        moneData.user_id = userData.id;
        SA.Logger.Mone.event('email_subscribe', 'wsb_header', 'subscribed', {data: moneData});
      }
    }
  }

  var subscribeWsbLoggedOut = function(e){
    e.preventDefault();
    var data = {
      user: {
        email: $txtUserEmail.val().trim()
      },
      activity: 'newsletter',
      newsletter:'wall-st-breakfast',
      'function': '',
      id: 'login',
      referrer: conf.sessionReferrer,
      url_source: location.href.replace(/\?.*$/, '')
    };

    $.ajax({
      data: data,
      method: 'POST',
      dataType: 'json',
      url: '/authentication/registration'
    }).always(function(response){
        buildSubscribePopup(response).show();
        $txtUserEmail.val('');
      });


    return false;
  };

  var buildSubscribePopup = function(response){
    $btnUserEmail.removeClass("sa-animated").prop('disabled', false);
    var opt = {};
    var templates = {modalNewMessage:{}};
    setSubscribeTemplate(response, templates);
    opt.className = 'sa-logged-out-subscribe-modal';
    opt.headerContent = templates.modalNewMessage.header;
    opt.bodyContent = templates.modalNewMessage.body;
    opt.keyboard = true;
    opt.backdrop = true;
    return SA.Widgets.Popup.build(opt);
  };

  var setSubscribeTemplate = function(response, templates){
    var moneType = 'registration';
    var monSource = 'wsb_header';
    var monAction = 'registered';
    var email = $txtUserEmail.val().trim();

    if(response.registration === true){
      templates.modalNewMessage = {
        header: '<div class="subscription-success">Thank you for subscribing to Wall Street Breakfast newsletter</div>',
        body: JST['jst/profile/logged_out_subscription_success']({
          email: email
        })
      };
      successWsbSubscribed(response); // Hide wsb subscribe section
      SA.Vendor.Gtm.event('registration', {
        category: 'Registration',
        action: 'Signup',
        label: window.location.href
      });
    } else {
      templates.modalNewMessage = {header: '<div class="subscription-failure"> Registration failed</div>'};
      if (response.message === 'already_registered'){
        templates.modalNewMessage.body = JST['jst/profile/logged_out_subscription_failure']({
          email: email,
          error_message: 'This email has already been registered'
        });
        monAction = 'error';
        moneData.error_message = response.message;
      } else if (response.errors === 'Invalid subscriptions') { // Response from SA.Models.SubscriptionModel.subscribe
        templates.modalNewMessage = {header: '<div class="subscription-failure"> Wall Street Breakfast newsletter subscription</div>'};
        templates.modalNewMessage.body = JST['jst/profile/logged_out_subscription_failure']({
          email: email,
          error_message: 'Subscription failure!'
        });
        moneType = 'subscription';
        monAction = 'error';
        moneData.error_message = response.errors;
        if (userData.loggedIn) {
          moneData.user_id = userData.id;
        }
      } else {
        templates.modalNewMessage.body = JST['jst/profile/logged_out_subscription_failure']({
          email: email,
          error_message: 'The email could not be registered'
        });
        monAction = 'error';
        moneData.error_message = response.message;
      }
    }

    SA.Logger.Mone.event(moneType, monSource,monAction,{data:moneData});

  };
  var sendMoneEvent = function(type,source, action){
    if(authorData && userData) {
      moneData = {
        "author": authorData.slug,
        "author_tag": authorData.tagId,
        "follow_author": userData.authorFollow,
        "alerts_on_author": userData.authorRta,
        "daily_digest": userData.dailyDigest
      };
      SA.Logger.Mone.event(type, source,action,{data:moneData});
    }
  };

  scope.init = function(opt){
    opt = opt || {};
    authorData = $.extend({}, getAuthorOpt(), opt);
    if(authorData.tagId && authorData.slug){
      if(authorData.isBrand) {
        initExternalClickTracking();
        initNavHeader();
      } else {
        userData = getUserData();
        articleId = opt.articleId;
        initAuthorInfo();
        initExternalClickTracking();
        initSubscribeWsb();
        initNavHeader();
      }
    }
  };

}(window.SA, window.jQuery));

(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/pro/ticker_snapshot/table"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<ul class="table">\n</ul>\n');}return __p.join('');};
}).call(this);

(function (SA, $) {

  "use strict";

  //TODO: Replace with slim or json and minimum content
  var scope = SA.UsingNamespace('SA.Widgets.Pro');

  scope.Helper = new function () {

    this.html = {
      create: function ($container, tableClass) {
        var $subContainer = $(JST['jst/widgets/pro/ticker_snapshot/table']());
        if (tableClass) {
          $subContainer.addClass(tableClass);
        }
        $container.append($subContainer);

        return $subContainer;
      },
      removeLoader: function ($container) {
        $container.find('.loader').remove();
      },
      populate: function ($container, template, data) {
        this.removeLoader($container);

        data = data || {};
        $container.append($(JST[template](data)));
      },
      append: function ($container, html) {
        this.removeLoader($container);

        html = html || '';
        $container.append(html);
      },
      createAndPopulate: function ($container, tableClass, template, data) {
        var $table = this.create($container, tableClass);
        this.populate($table, template, data);
      },
      handleFailure: function ($container, error, data) {
        this.removeLoader($container);
      }
    };

    this.valueFormatter = {
      sign: {
        notAvailable: "N/A",
        percent: "%",
        money: "$"
      },
      fixDecimalPoint: function (num) {
        if (num === this.sign.notAvailable) return num;
        num = parseFloat(num);
        if (num === 0) return '0';
        var log = Math.log(Math.abs(num)) / Math.log(10);
        if (Math.abs(num) < 0.01) return num.toFixed(Math.abs(Math.round(log)) + 1).replace(/0+$/, '');
        return num.toFixed(2);
      },
      separatorNum: function (n) {
        var exp = /(\d+)(\d{3})/;
        n = n.toString();
        while (exp.test(n)) {
          n = n.replace(exp, '$1' + "," + '$2');
        }
        return n;
      },
      bigNum: function (n, precision) {
        var s = '';
        if (Math.abs(n) > 1000) {
          n /= 1000;
          s = 'K';
        }
        if (Math.abs(n) > 1000) {
          n /= 1000;
          s = 'M';
        }
        if (Math.abs(n) > 1000) {
          n /= 1000;
          s = 'B';
        }
        return (Math.round(n * 100) / 100).toFixed(precision) + s;
      },
      formatWithCommas: function (number) {
        var parts;
        if (number.toString().indexOf(".") === -1) {
          parts = [number.toString()];
        } else {
          parts = number.toString().split(".");
        }
        parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        return parts.join(".").toString();
      },
      toPercent: function (number, divideBy, fixDecimalPoint) {
        var res = this.sign.notAvailable;
        if (divideBy) {
          var p = (number / divideBy).toFixed(4) * 100;
          if (fixDecimalPoint) {
            p = this.fixDecimalPoint(p);
          }
          p = this.formatWithCommas(p);

          res = p + this.sign.percent;
        }
        return res;
      },
      toMoney: function (val) {
        if (!val || val === "-") {
          val = this.sign.notAvailable;
        } else if (val.indexOf(this.sign.money) === -1) {
          val = this.sign.money + this.formatWithCommas(val);
        }
        return val;
      },
      range: function (valueFrom, valueTo, prefix) {
        prefix = prefix || '';
        var val = this.sign.notAvailable;
        if (valueFrom && !valueTo || (valueFrom && valueTo && valueFrom !== valueTo)) {
          val = prefix + this.formatWithCommas(valueFrom);
        }
        if (valueFrom && valueTo && valueFrom !== valueTo) {
          val += " - " + prefix + this.formatWithCommas(valueTo);
        }
        if (!valueFrom && valueTo || (valueFrom && valueTo && valueFrom === valueTo)) {
          val = "up to " + prefix + this.formatWithCommas(valueTo);
        }
        return val;
      }
    };

    this.download = function (self) {
      SA.Logger.Mone.event("pro", "pro_article_financials", "click_to_download", {
        data: {"filename": $(self).attr('title')}
      });
    };
  };
}(SA, jQuery));
(function (h, o, t, j, a, r) {

  'use strict';

  h.hj = h.hj || function () {
    (h.hj.q = h.hj.q || []).push(arguments);
  };
  h._hjSettings = {hjid: 65666, hjsv: 5};
  a = o.getElementsByTagName('head')[0];
  r = o.createElement('script');
  r.async = 1;
  r.src = t + h._hjSettings.hjid + j + h._hjSettings.hjsv;
  a.appendChild(r);
}(window, document, 'https://static.hotjar.com/c/hotjar-', '.js?sv='));
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/pro/ticker_snapshot/sa_info"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('');  if (priceAtPublication || tickerLastPrice || tickerPriceChange || timeSincePublication || (authorSentiment!=null)  || tickerTotalReturn) { ; __p.push('\n    <div class="rail_header">About This Article</div>\n    <ul class="table">\n        ');  if (authorSentiment != null){ ; __p.push('\n          <li>\n            <div class="first_row">Author\'s rating at publication</div>\n            <div class="type ',  sentimentText.toLowerCase().split(' ').join('_') ,'">',  sentimentText ,'</div>\n          </li>\n        ');  } ; __p.push('\n\n        <li>\n          <div>',  identifier ,' price at publication</div>\n          ');  if (priceAtPublication){ ; __p.push('\n            <div>',  priceAtPublication ,'</div>\n          ');  } else { ; __p.push('\n            <div>-</div>\n          ');  } ; __p.push('\n        </li>\n\n        ');  if (tickerLastPrice) { ; __p.push('\n          <li>\n            <div>',  identifier ,' last price</div>\n            <div>',  tickerLastPrice ,'</div>\n          </li>\n        ');  } ; __p.push('\n\n          <li>\n            <div>',  identifier ,' change since publication</div>\n            ');  if (tickerPriceChange) { ; __p.push('\n             <div class="',  tickerChangeClass ,'">',  tickerPriceChange ,'</div>\n            ');  } else {; __p.push('\n              <div>-</div>\n            ');  } ; __p.push('\n          </li>\n          ');  if (tickerTotalReturn && (tickerTotalReturn != tickerPriceChange)) { ; __p.push('\n            <li>\n              <div>',  identifier ,' total return since publication</div>\n              ');  if (tickerTotalReturn != tickerPriceChange) { ; __p.push('\n                <div class="',  tickerTotalReturnClass ,'">',  tickerTotalReturn ,'</div>\n              ');  } else {; __p.push('\n                <div>-</div>\n              ');  } ; __p.push('\n            </li>\n        ');  } ; __p.push('\n\n        ');  if (spyChangeClass && spyPriceChange) { ; __p.push('\n          <li>\n            <div>S&P 500 change since publication</div>\n            <div class="',  spyChangeClass ,' right_div">',  spyPriceChange ,'</div>\n          </li>\n        ');  } ; __p.push('\n\n        ');  if (timeSincePublication) { ; __p.push('\n          <li>\n            <div>Days since publication</div>\n            <div>',  timeSincePublication ,' </div>\n          </li>\n        ');  } ; __p.push('\n        ');  } ; __p.push('\n\n        ');  if (author && displayAuthorLink) { ; __p.push('\n        <li>\n          <a class="rail_link about_article"\n             href="/author/',  author ,'#regular_articles&scroll=true&ticker=',  identifier.toLowerCase() ,'" sasource="about_this_author">Author\'s Rating History on ',  identifier ,'</a>\n          </a>\n        </li>\n    </ul>\n');  } ; __p.push('\n');}return __p.join('');};
}).call(this);





(function (w, SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Widgets.Pro');
  scope.InvestmentSnapshot = function (opt) {
    opt = opt || {};

    var slug,
      helper = SA.UsingNamespace('SA.Widgets.Pro').Helper,
      pageData = SA.pageConfig.Data || {},
      $tickerSnapshotTable = $('#pro-ticker-snapshot-wrapper').find('.snap-data').first(),
      mainPromise, data,
      formatter = SA.Utils.Formatter,
      closest_trading_day,
      isArticleInTradingTime,
      tickerType,
      article_datetime,
      SPY_SLUG = 'SP500.IND_SPF',
      histPrice = {
        'crypto':  getHistPriceCrypto,
        'index': getHistPriceIndex,
        'other': getHistPriceTicker
      },
      lastPrice = {
        'crypto': getLastPriceCrypto,
        'index': getLastPriceIndex,
        'other': getLastPriceTicker
      };

    this.promise = function () {
      return mainPromise;
    };

    function getHistPricePromise(symbol, date, tickerType, adjustmentMethod) {
      return histPrice[tickerType](symbol, date, adjustmentMethod);
    }

    function getHistPriceTicker(symbol, dates, adjustmentMethod) {
      var p = $.Deferred(),
        nextDay = new Date(dates.start);
      nextDay.setDate(dates.start.getDate() + 1);

      if(isToday(dates.start)) { p.resolve(null); return p}
      SA.Utils.SymbolData.getGlobalHistoricalQuotesRangeCDN({
        slug: symbol,
        startDate: format(dates.start),
        endDate: format(nextDay),
        adjustmentMethod: adjustmentMethod
      }, function (res) {
        if (res.Outcome === 'Success' && (res.HistoricalQuotes || []).length) {
          var last = res.HistoricalQuotes.length - 1,
            histPrice = isArticleInTradingTime ? res.HistoricalQuotes[last].Close : res.HistoricalQuotes[last].Open;
          if(isArticleInTradingTime && !histPrice) {
            histPrice = (res.HistoricalQuotes[last - 1] || {}).Open;
          }
          p.resolve(histPrice);
        } else {
          p.resolve(null);
        }
      });
      return p;
    }

    function getHistPriceCrypto(symbol, dates) {
      var p = $.Deferred();
      var cryptoSlug = symbol.split('-')[0].toUpperCase();
      var days = calculateDaysBetween(dates.start, dates.end);

      if(isToday(dates.start)) { p.resolve(null); return p}
      SA.Utils.cryptoAPI.historical('day', cryptoSlug, 'USD', days, 1).then(function (res) {
        if (res.Response === "Success") {
          var histPrice = isArticleInTradingTime ? res.Data[1].close : res.Data[1].open;
          if(isArticleInTradingTime && !histPrice) {
            histPrice = (res.Data[2] || {}).Open;
          }
          p.resolve(histPrice);
        } else {
          p.resolve(null);
        }
      });
      return p;
    }

    function getHistPriceIndex(symbol, dates) {
      var p = $.Deferred(),
        nextDay = new Date(dates.start),
        distinct = SPY_SLUG !== symbol;
      nextDay.setDate(dates.start.getDate() + 1);

      if(distinct && isToday(dates.start)) { p.resolve(null); return p }
      var url = SA.Utils.SymbolData.getCachedGlobalIndicesUrl({
        slug: symbol.toLowerCase(),
        startDate: format(dates.start),
        endDate: format(nextDay),
        fields: 'Outcome,Message,values.close,values.open,values.date'
      });

      $.get(url).then(function (res) {
        if (res.Outcome === 'Success') {
          var histPrice = isArticleInTradingTime ? res.Values[0].Close : res.Values[0].Open;
          if(isArticleInTradingTime && !histPrice) {
            histPrice = res.Data[1].open;
          }
          p.resolve(histPrice);
        } else {
          p.resolve(null);
        }
      });
      return p;
    }

    function getLastPricePromise(symbol, tickerType) {
      return lastPrice[tickerType](symbol);
    }

    function getLastPriceTicker(symbol) {
      var p = $.Deferred();
      SA.Utils.SymbolData.getFromSuperQuotes([symbol], function (res) {
        res = (res || {})[symbol.toLowerCase()];
        p.resolve((res || {}).Last);
      });
      return p;
    }

    function getLastPriceCrypto(symbol) {
      var p = $.Deferred();
      var cryptoSlug = symbol.split('-')[0].toUpperCase();
      SA.Utils.cryptoAPI.priceMultiFull([cryptoSlug], ["USD"]).then(function (res) {
        if (typeof res.RAW[cryptoSlug] === "object") {
          p.resolve(res.RAW[cryptoSlug].USD.PRICE);
        } else {
          p.resolve(null)
        }
      });
      return p;
    }

    function getLastPriceIndex(symbol) {
      var p = $.Deferred();
      SA.Utils.SymbolData.getCachedRealTimeIndices([symbol], function(res) {
        if(res || res[0].Outcome === 'Success' && res[0].Value.Last) {
          p.resolve(res[0].Value.Last);
        } else {
          p.resolve(null);
        }
      });
      return p;
    }

    function isToday(date) {
      var today = w.moment().tz('America/New_York').toDate();
      return date.getDate() === today.getDate() &&
        date.getMonth() === today.getMonth() &&
        date.getFullYear() === today.getFullYear();
    }

    function timeSincePublication() {
      var today = w.moment().tz('America/New_York')._d,
        lastMarketDate = w.moment(closest_trading_day || article_datetime).toDate(),
        publishDate = w.moment(article_datetime).toDate();

      return {
        publish: publishDate,
        start: lastMarketDate,
        end: today
      };
    }

    function getTickerType(opt) {
      var isCrypto = (pageData.article && pageData.article.primaryIsCrypto) || (pageData.qmChartData && pageData.qmChartData.isCrypto) || opt.isCrypto || false,
        isIndex = (pageData.qmChartData && pageData.qmChartData.isIndex) || opt.isIndex || false;
      if(isCrypto) return 'crypto';
      if(isIndex) return 'index';
      return 'other';
    }

    function format(date) {
      return [date.getMonth() + 1, date.getDate(), date.getFullYear()].join('/');
    }

    function calculateDaysBetween(start, end) {
      return Math.ceil((end.getTime() - start.getTime()) / (1000 * 3600 * 24))
    }

    function upDownClass(value) {
      var aClass = 'flat';
      if (value && !isNaN(value)){
        if (value < -0.009) {
          aClass = 'down';
        } else if (value > 0.009) {
          aClass = 'up';
        }
      }
      return aClass;
    }

    function getPercent(number, divideBy) {
      return (number / divideBy).toFixed(4) * 100;
    }

    function getSlugPriceChange() {
      var histPrices = data.tickerPrices || {},
        lastPrice = data.tickerLastPrice;
      return lastPriceChange(histPrices, lastPrice);
    }

    function getSpyPriceChange() {
      var histPrices = data.spyPrices || {},
        lastPrice = data.spyPrices && data.spyPrices.todayPrice || null;
      return lastPriceChange(histPrices, lastPrice);
    }

    function getSlugTotalPriceChange() {
      var histPrices = data.tickerTotalReturn || {},
        lastPrice = data.tickerLastPrice || null;
      return lastPriceChange(histPrices, lastPrice);
    }

    function lastPriceChange(histPrices, lastPrice) {
      var tickerPriceChange = null, tickerPriceDiff;
      if (histPrices) {
        var priceAtPublicationNumber = parseFloat(histPrices.histPrice);
        tickerPriceDiff = lastPrice - priceAtPublicationNumber;
        if (lastPrice && priceAtPublicationNumber)
          tickerPriceChange = formatter.number(getPercent(tickerPriceDiff, priceAtPublicationNumber), {
            decimals: 2,
            suffix: '%'
          });
      }
      return {change: tickerPriceChange, changeClass: upDownClass(tickerPriceDiff)};
    }

    this.show = function () {
      var tickerPrices = getSlugPriceChange();
      var spyPrices = getSpyPriceChange();
      var tickerTotalReturn = getSlugTotalPriceChange();
      var tickerLastPrice = formatter.number(parseFloat(data.tickerLastPrice), {decimals: 2, prefix: '$'});
      var priceAtPublicationNumber = data.tickerPrices && parseFloat(data.tickerPrices.histPrice) || null;
      var priceAtPublication = null;
      if (priceAtPublicationNumber) {
        priceAtPublication = formatter.number(parseFloat(priceAtPublicationNumber), {decimals: 2, prefix: '$'})
      }

      var slug = data.Identifier;
      var splitedSlug = slug.split('.');
      if (splitedSlug.length > 1) {
        splitedSlug.splice(-1, 1).join('.');
        slug = splitedSlug.join('.');
      }

      helper.html.populate($tickerSnapshotTable,
        'jst/widgets/pro/ticker_snapshot/sa_info',
        {
          priceAtPublication: priceAtPublication,
          tickerLastPrice: tickerLastPrice,
          tickerPriceChange: tickerPrices.change,
          tickerChangeClass: tickerPrices.changeClass,
          tickerTotalReturn: tickerTotalReturn.change,
          tickerTotalReturnClass: tickerTotalReturn.changeClass,
          spyPriceChange: spyPrices.change,
          spyChangeClass: spyPrices.changeClass,
          timeSincePublication: data.timeSincePublication,
          authorSentiment: data.authorSentiment,
          identifier: slug,
          sentimentText: ['Very Bullish', 'Bullish', 'Neutral', 'Bearish', 'Very Bearish'][data.authorSentiment],
          author: data.author,
          displayAuthorLink: !(data.isTranscript || data.isSlides)
        });
    };

    function init() {
      var tickerPrices, spyPrices;
      slug = opt.ticker;
      mainPromise = $.Deferred();
      isArticleInTradingTime = pageData.article && pageData.article.isArticleInTradingTime;
      article_datetime = opt.article_datetime;
      if (pageData.article && !opt.isArticlePage) {
        closest_trading_day = pageData.article.closest_trading_day;
        article_datetime = pageData.article.article_datetime;
      }
      tickerType = getTickerType(opt);

      var dates = timeSincePublication(),
        promises = [getLastPricePromise(slug, tickerType)];

      if (dates.start < dates.end) {
        promises.push(getHistPricePromise(slug, dates, tickerType, 'PriceReturn'));
        if (slug.toUpperCase() !== SPY_SLUG) {
          promises.push(getLastPricePromise(SPY_SLUG, 'index'));
          promises.push(getHistPriceIndex(SPY_SLUG, dates));
        }
        if(tickerType === 'other') promises.push(getHistPricePromise(slug, dates, tickerType, 'All'));
      }

      $.when.apply($, promises, this).done(function (tickerLastPrice, tickerHistPrice, spyLastPrice, spyHistPrice, tickerHistPriceDividends) {
        data = {
          timeSincePublication: calculateDaysBetween(dates.publish, dates.end),
          tickerLastPrice: tickerLastPrice,
          Identifier: slug.toUpperCase(),
          tickerPrices: {histPrice: tickerHistPrice, lastPrice: tickerLastPrice},
          tickerTotalReturn: {histPrice: tickerHistPriceDividends, lastPrice: tickerLastPrice},
          spyPrices: {histPrice: spyHistPrice, todayPrice: spyLastPrice}
        };

        if (pageData.article) {
          $.extend(data, pageData.article);
        }

        if (pageData.authorSentiment && pageData.authorSentiment.length) {
          $.extend(data, {authorSentiment: pageData.authorSentiment[0].type_id});
        }

        if (!!pageData.author) {
          $.extend(data, {author: pageData.author.slug});
        }
      }).fail(function () {
        helper.html.handleFailure($tickerSnapshotTable, 'ProSuperQuote: SuperQuote fail', data);
      }).always( function() {mainPromise.resolve();
        if (opt.clb){
          tickerPrices = getSlugPriceChange();
          spyPrices = getSpyPriceChange();
          opt.clb({tickerLastPrice: tickerPrices.change, tickerChangeClass: tickerPrices.changeClass, spyPriceChange: spyPrices.change, spyChangeClass: spyPrices.changeClass});
        }
      });

      return mainPromise;
    }

    init();

  };

}(window, window.SA, window.jQuery));

/*
 Highstock JS v6.1.4 (2018-09-25)

 (c) 2009-2016 Torstein Honsi

 License: www.highcharts.com/license
*/

(function(P,J){"object"===typeof module&&module.exports?module.exports=P.document?J(P):J:"function"===typeof define&&define.amd?define(function(){return J(P)}):P.Highcharts=J(P)})("undefined"!==typeof window?window:this,function(P){var J=function(){var a="undefined"===typeof P?window:P,E=a.document,F=a.navigator&&a.navigator.userAgent||"",G=E&&E.createElementNS&&!!E.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect,q=/(edge|msie|trident)/i.test(F)&&!a.opera,l=-1!==F.indexOf("Firefox"),
f=-1!==F.indexOf("Chrome"),u=l&&4>parseInt(F.split("Firefox/")[1],10);return a.Highcharts?a.Highcharts.error(16,!0):{product:"Highstock",version:"6.1.4",deg2rad:2*Math.PI/360,doc:E,hasBidiBug:u,hasTouch:E&&void 0!==E.documentElement.ontouchstart,isMS:q,isWebKit:-1!==F.indexOf("AppleWebKit"),isFirefox:l,isChrome:f,isSafari:!f&&-1!==F.indexOf("Safari"),isTouchDevice:/(Mobile|Android|Windows Phone)/.test(F),SVG_NS:"http://www.w3.org/2000/svg",chartCount:0,seriesTypes:{},symbolSizes:{},svg:G,win:a,marginNames:["plotTop",
"marginRight","marginBottom","plotLeft"],noop:function(){},charts:[]}}();(function(a){a.timers=[];var E=a.charts,F=a.doc,G=a.win;a.error=function(q,l){q=a.isNumber(q)?"Highcharts error #"+q+": www.highcharts.com/errors/"+q:q;if(l)throw Error(q);G.console&&console.log(q)};a.Fx=function(a,l,f){this.options=l;this.elem=a;this.prop=f};a.Fx.prototype={dSetter:function(){var a=this.paths[0],l=this.paths[1],f=[],u=this.now,C=a.length,r;if(1===u)f=this.toD;else if(C===l.length&&1>u)for(;C--;)r=parseFloat(a[C]),
f[C]=isNaN(r)?l[C]:u*parseFloat(l[C]-r)+r;else f=l;this.elem.attr("d",f,null,!0)},update:function(){var a=this.elem,l=this.prop,f=this.now,u=this.options.step;if(this[l+"Setter"])this[l+"Setter"]();else a.attr?a.element&&a.attr(l,f,null,!0):a.style[l]=f+this.unit;u&&u.call(a,f,this)},run:function(q,l,f){var u=this,C=u.options,r=function(a){return r.stopped?!1:u.step(a)},y=G.requestAnimationFrame||function(a){setTimeout(a,13)},p=function(){for(var d=0;d<a.timers.length;d++)a.timers[d]()||a.timers.splice(d--,
1);a.timers.length&&y(p)};q!==l||this.elem["forceAnimate:"+this.prop]?(this.startTime=+new Date,this.start=q,this.end=l,this.unit=f,this.now=this.start,this.pos=0,r.elem=this.elem,r.prop=this.prop,r()&&1===a.timers.push(r)&&y(p)):(delete C.curAnim[this.prop],C.complete&&0===a.keys(C.curAnim).length&&C.complete.call(this.elem))},step:function(q){var l=+new Date,f,u=this.options,C=this.elem,r=u.complete,y=u.duration,p=u.curAnim;C.attr&&!C.element?q=!1:q||l>=y+this.startTime?(this.now=this.end,this.pos=
1,this.update(),f=p[this.prop]=!0,a.objectEach(p,function(a){!0!==a&&(f=!1)}),f&&r&&r.call(C),q=!1):(this.pos=u.easing((l-this.startTime)/y),this.now=this.start+(this.end-this.start)*this.pos,this.update(),q=!0);return q},initPath:function(q,l,f){function u(a){var b,d;for(c=a.length;c--;)b="M"===a[c]||"L"===a[c],d=/[a-zA-Z]/.test(a[c+3]),b&&d&&a.splice(c+1,0,a[c+1],a[c+2],a[c+1],a[c+2])}function C(a,b){for(;a.length<m;){a[0]=b[m-a.length];var d=a.slice(0,g);[].splice.apply(a,[0,0].concat(d));x&&(d=
a.slice(a.length-g),[].splice.apply(a,[a.length,0].concat(d)),c--)}a[0]="M"}function r(a,c){for(var d=(m-a.length)/g;0<d&&d--;)b=a.slice().splice(a.length/B-g,g*B),b[0]=c[m-g-d*g],e&&(b[g-6]=b[g-2],b[g-5]=b[g-1]),[].splice.apply(a,[a.length/B,0].concat(b)),x&&d--}l=l||"";var y,p=q.startX,d=q.endX,e=-1<l.indexOf("C"),g=e?7:3,m,b,c;l=l.split(" ");f=f.slice();var x=q.isArea,B=x?2:1,t;e&&(u(l),u(f));if(p&&d){for(c=0;c<p.length;c++)if(p[c]===d[0]){y=c;break}else if(p[0]===d[d.length-p.length+c]){y=c;t=
!0;break}void 0===y&&(l=[])}l.length&&a.isNumber(y)&&(m=f.length+y*B*g,t?(C(l,f),r(f,l)):(C(f,l),r(l,f)));return[l,f]},fillSetter:function(){a.Fx.prototype.strokeSetter.apply(this,arguments)},strokeSetter:function(){this.elem.attr(this.prop,a.color(this.start).tweenTo(a.color(this.end),this.pos),null,!0)}};a.merge=function(){var q,l=arguments,f,u={},C=function(f,y){"object"!==typeof f&&(f={});a.objectEach(y,function(p,d){!a.isObject(p,!0)||a.isClass(p)||a.isDOMElement(p)?f[d]=y[d]:f[d]=C(f[d]||{},
p)});return f};!0===l[0]&&(u=l[1],l=Array.prototype.slice.call(l,2));f=l.length;for(q=0;q<f;q++)u=C(u,l[q]);return u};a.pInt=function(a,l){return parseInt(a,l||10)};a.isString=function(a){return"string"===typeof a};a.isArray=function(a){a=Object.prototype.toString.call(a);return"[object Array]"===a||"[object Array Iterator]"===a};a.isObject=function(q,l){return!!q&&"object"===typeof q&&(!l||!a.isArray(q))};a.isDOMElement=function(q){return a.isObject(q)&&"number"===typeof q.nodeType};a.isClass=function(q){var l=
q&&q.constructor;return!(!a.isObject(q,!0)||a.isDOMElement(q)||!l||!l.name||"Object"===l.name)};a.isNumber=function(a){return"number"===typeof a&&!isNaN(a)&&Infinity>a&&-Infinity<a};a.erase=function(a,l){for(var f=a.length;f--;)if(a[f]===l){a.splice(f,1);break}};a.defined=function(a){return void 0!==a&&null!==a};a.attr=function(q,l,f){var u;a.isString(l)?a.defined(f)?q.setAttribute(l,f):q&&q.getAttribute&&((u=q.getAttribute(l))||"class"!==l||(u=q.getAttribute(l+"Name"))):a.defined(l)&&a.isObject(l)&&
a.objectEach(l,function(a,f){q.setAttribute(f,a)});return u};a.splat=function(q){return a.isArray(q)?q:[q]};a.syncTimeout=function(a,l,f){if(l)return setTimeout(a,l,f);a.call(0,f)};a.clearTimeout=function(q){a.defined(q)&&clearTimeout(q)};a.extend=function(a,l){var f;a||(a={});for(f in l)a[f]=l[f];return a};a.pick=function(){var a=arguments,l,f,u=a.length;for(l=0;l<u;l++)if(f=a[l],void 0!==f&&null!==f)return f};a.css=function(q,l){a.isMS&&!a.svg&&l&&void 0!==l.opacity&&(l.filter="alpha(opacity\x3d"+
100*l.opacity+")");a.extend(q.style,l)};a.createElement=function(q,l,f,u,C){q=F.createElement(q);var r=a.css;l&&a.extend(q,l);C&&r(q,{padding:0,border:"none",margin:0});f&&r(q,f);u&&u.appendChild(q);return q};a.extendClass=function(q,l){var f=function(){};f.prototype=new q;a.extend(f.prototype,l);return f};a.pad=function(a,l,f){return Array((l||2)+1-String(a).replace("-","").length).join(f||0)+a};a.relativeLength=function(a,l,f){return/%$/.test(a)?l*parseFloat(a)/100+(f||0):parseFloat(a)};a.wrap=
function(a,l,f){var u=a[l];a[l]=function(){var a=Array.prototype.slice.call(arguments),r=arguments,y=this;y.proceed=function(){u.apply(y,arguments.length?arguments:r)};a.unshift(u);a=f.apply(this,a);y.proceed=null;return a}};a.formatSingle=function(q,l,f){var u=/\.([0-9])/,C=a.defaultOptions.lang;/f$/.test(q)?(f=(f=q.match(u))?f[1]:-1,null!==l&&(l=a.numberFormat(l,f,C.decimalPoint,-1<q.indexOf(",")?C.thousandsSep:""))):l=(f||a.time).dateFormat(q,l);return l};a.format=function(q,l,f){for(var u="{",
C=!1,r,y,p,d,e=[],g;q;){u=q.indexOf(u);if(-1===u)break;r=q.slice(0,u);if(C){r=r.split(":");y=r.shift().split(".");d=y.length;g=l;for(p=0;p<d;p++)g&&(g=g[y[p]]);r.length&&(g=a.formatSingle(r.join(":"),g,f));e.push(g)}else e.push(r);q=q.slice(u+1);u=(C=!C)?"}":"{"}e.push(q);return e.join("")};a.getMagnitude=function(a){return Math.pow(10,Math.floor(Math.log(a)/Math.LN10))};a.normalizeTickInterval=function(q,l,f,u,C){var r,y=q;f=a.pick(f,1);r=q/f;l||(l=C?[1,1.2,1.5,2,2.5,3,4,5,6,8,10]:[1,2,2.5,5,10],
!1===u&&(1===f?l=a.grep(l,function(a){return 0===a%1}):.1>=f&&(l=[1/f])));for(u=0;u<l.length&&!(y=l[u],C&&y*f>=q||!C&&r<=(l[u]+(l[u+1]||l[u]))/2);u++);return y=a.correctFloat(y*f,-Math.round(Math.log(.001)/Math.LN10))};a.stableSort=function(a,l){var f=a.length,u,C;for(C=0;C<f;C++)a[C].safeI=C;a.sort(function(a,f){u=l(a,f);return 0===u?a.safeI-f.safeI:u});for(C=0;C<f;C++)delete a[C].safeI};a.arrayMin=function(a){for(var l=a.length,f=a[0];l--;)a[l]<f&&(f=a[l]);return f};a.arrayMax=function(a){for(var l=
a.length,f=a[0];l--;)a[l]>f&&(f=a[l]);return f};a.destroyObjectProperties=function(q,l){a.objectEach(q,function(a,u){a&&a!==l&&a.destroy&&a.destroy();delete q[u]})};a.discardElement=function(q){var l=a.garbageBin;l||(l=a.createElement("div"));q&&l.appendChild(q);l.innerHTML=""};a.correctFloat=function(a,l){return parseFloat(a.toPrecision(l||14))};a.setAnimation=function(q,l){l.renderer.globalAnimation=a.pick(q,l.options.chart.animation,!0)};a.animObject=function(q){return a.isObject(q)?a.merge(q):
{duration:q?500:0}};a.timeUnits={millisecond:1,second:1E3,minute:6E4,hour:36E5,day:864E5,week:6048E5,month:24192E5,year:314496E5};a.numberFormat=function(q,l,f,u){q=+q||0;l=+l;var C=a.defaultOptions.lang,r=(q.toString().split(".")[1]||"").split("e")[0].length,y,p,d=q.toString().split("e");-1===l?l=Math.min(r,20):a.isNumber(l)?l&&d[1]&&0>d[1]&&(y=l+ +d[1],0<=y?(d[0]=(+d[0]).toExponential(y).split("e")[0],l=y):(d[0]=d[0].split(".")[0]||0,q=20>l?(d[0]*Math.pow(10,d[1])).toFixed(l):0,d[1]=0)):l=2;p=(Math.abs(d[1]?
d[0]:q)+Math.pow(10,-Math.max(l,r)-1)).toFixed(l);r=String(a.pInt(p));y=3<r.length?r.length%3:0;f=a.pick(f,C.decimalPoint);u=a.pick(u,C.thousandsSep);q=(0>q?"-":"")+(y?r.substr(0,y)+u:"");q+=r.substr(y).replace(/(\d{3})(?=\d)/g,"$1"+u);l&&(q+=f+p.slice(-l));d[1]&&0!==+q&&(q+="e"+d[1]);return q};Math.easeInOutSine=function(a){return-.5*(Math.cos(Math.PI*a)-1)};a.getStyle=function(q,l,f){if("width"===l)return Math.max(0,Math.min(q.offsetWidth,q.scrollWidth)-a.getStyle(q,"padding-left")-a.getStyle(q,
"padding-right"));if("height"===l)return Math.max(0,Math.min(q.offsetHeight,q.scrollHeight)-a.getStyle(q,"padding-top")-a.getStyle(q,"padding-bottom"));G.getComputedStyle||a.error(27,!0);if(q=G.getComputedStyle(q,void 0))q=q.getPropertyValue(l),a.pick(f,"opacity"!==l)&&(q=a.pInt(q));return q};a.inArray=function(q,l,f){return(a.indexOfPolyfill||Array.prototype.indexOf).call(l,q,f)};a.grep=function(q,l){return(a.filterPolyfill||Array.prototype.filter).call(q,l)};a.find=Array.prototype.find?function(a,
l){return a.find(l)}:function(a,l){var f,u=a.length;for(f=0;f<u;f++)if(l(a[f],f))return a[f]};a.some=function(q,l,f){return(a.somePolyfill||Array.prototype.some).call(q,l,f)};a.map=function(a,l){for(var f=[],u=0,C=a.length;u<C;u++)f[u]=l.call(a[u],a[u],u,a);return f};a.keys=function(q){return(a.keysPolyfill||Object.keys).call(void 0,q)};a.reduce=function(q,l,f){return(a.reducePolyfill||Array.prototype.reduce).apply(q,2<arguments.length?[l,f]:[l])};a.offset=function(a){var l=F.documentElement;a=a.parentElement||
a.parentNode?a.getBoundingClientRect():{top:0,left:0};return{top:a.top+(G.pageYOffset||l.scrollTop)-(l.clientTop||0),left:a.left+(G.pageXOffset||l.scrollLeft)-(l.clientLeft||0)}};a.stop=function(q,l){for(var f=a.timers.length;f--;)a.timers[f].elem!==q||l&&l!==a.timers[f].prop||(a.timers[f].stopped=!0)};a.each=function(q,l,f){return(a.forEachPolyfill||Array.prototype.forEach).call(q,l,f)};a.objectEach=function(a,l,f){for(var u in a)a.hasOwnProperty(u)&&l.call(f||a[u],a[u],u,a)};a.addEvent=function(q,
l,f,u){var C,r=q.addEventListener||a.addEventListenerPolyfill;C="function"===typeof q&&q.prototype?q.prototype.protoEvents=q.prototype.protoEvents||{}:q.hcEvents=q.hcEvents||{};a.Point&&q instanceof a.Point&&q.series&&q.series.chart&&(q.series.chart.runTrackerClick=!0);r&&r.call(q,l,f,!1);C[l]||(C[l]=[]);C[l].push(f);u&&a.isNumber(u.order)&&(f.order=u.order,C[l].sort(function(a,p){return a.order-p.order}));return function(){a.removeEvent(q,l,f)}};a.removeEvent=function(q,l,f){function u(p,d){var e=
q.removeEventListener||a.removeEventListenerPolyfill;e&&e.call(q,p,d,!1)}function C(p){var d,e;q.nodeName&&(l?(d={},d[l]=!0):d=p,a.objectEach(d,function(a,d){if(p[d])for(e=p[d].length;e--;)u(d,p[d][e])}))}var r,y;a.each(["protoEvents","hcEvents"],function(p){var d=q[p];d&&(l?(r=d[l]||[],f?(y=a.inArray(f,r),-1<y&&(r.splice(y,1),d[l]=r),u(l,f)):(C(d),d[l]=[])):(C(d),q[p]={}))})};a.fireEvent=function(q,l,f,u){var C,r,y,p,d;f=f||{};F.createEvent&&(q.dispatchEvent||q.fireEvent)?(C=F.createEvent("Events"),
C.initEvent(l,!0,!0),a.extend(C,f),q.dispatchEvent?q.dispatchEvent(C):q.fireEvent(l,C)):a.each(["protoEvents","hcEvents"],function(e){if(q[e])for(r=q[e][l]||[],y=r.length,f.target||a.extend(f,{preventDefault:function(){f.defaultPrevented=!0},target:q,type:l}),p=0;p<y;p++)(d=r[p])&&!1===d.call(q,f)&&f.preventDefault()});u&&!f.defaultPrevented&&u.call(q,f)};a.animate=function(q,l,f){var u,C="",r,y,p;a.isObject(f)||(p=arguments,f={duration:p[2],easing:p[3],complete:p[4]});a.isNumber(f.duration)||(f.duration=
400);f.easing="function"===typeof f.easing?f.easing:Math[f.easing]||Math.easeInOutSine;f.curAnim=a.merge(l);a.objectEach(l,function(d,e){a.stop(q,e);y=new a.Fx(q,f,e);r=null;"d"===e?(y.paths=y.initPath(q,q.d,l.d),y.toD=l.d,u=0,r=1):q.attr?u=q.attr(e):(u=parseFloat(a.getStyle(q,e))||0,"opacity"!==e&&(C="px"));r||(r=d);r&&r.match&&r.match("px")&&(r=r.replace(/px/g,""));y.run(u,r,C)})};a.seriesType=function(q,l,f,u,C){var r=a.getOptions(),y=a.seriesTypes;r.plotOptions[q]=a.merge(r.plotOptions[l],f);
y[q]=a.extendClass(y[l]||function(){},u);y[q].prototype.type=q;C&&(y[q].prototype.pointClass=a.extendClass(a.Point,C));return y[q]};a.uniqueKey=function(){var a=Math.random().toString(36).substring(2,9),l=0;return function(){return"highcharts-"+a+"-"+l++}}();G.jQuery&&(G.jQuery.fn.highcharts=function(){var q=[].slice.call(arguments);if(this[0])return q[0]?(new (a[a.isString(q[0])?q.shift():"Chart"])(this[0],q[0],q[1]),this):E[a.attr(this[0],"data-highcharts-chart")]})})(J);(function(a){var E=a.each,
F=a.isNumber,G=a.map,q=a.merge,l=a.pInt;a.Color=function(f){if(!(this instanceof a.Color))return new a.Color(f);this.init(f)};a.Color.prototype={parsers:[{regex:/rgba\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]?(?:\.[0-9]+)?)\s*\)/,parse:function(a){return[l(a[1]),l(a[2]),l(a[3]),parseFloat(a[4],10)]}},{regex:/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/,parse:function(a){return[l(a[1]),l(a[2]),l(a[3]),1]}}],names:{white:"#ffffff",black:"#000000"},init:function(f){var l,
C,r,y;if((this.input=f=this.names[f&&f.toLowerCase?f.toLowerCase():""]||f)&&f.stops)this.stops=G(f.stops,function(p){return new a.Color(p[1])});else if(f&&f.charAt&&"#"===f.charAt()&&(l=f.length,f=parseInt(f.substr(1),16),7===l?C=[(f&16711680)>>16,(f&65280)>>8,f&255,1]:4===l&&(C=[(f&3840)>>4|(f&3840)>>8,(f&240)>>4|f&240,(f&15)<<4|f&15,1])),!C)for(r=this.parsers.length;r--&&!C;)y=this.parsers[r],(l=y.regex.exec(f))&&(C=y.parse(l));this.rgba=C||[]},get:function(a){var f=this.input,l=this.rgba,r;this.stops?
(r=q(f),r.stops=[].concat(r.stops),E(this.stops,function(f,p){r.stops[p]=[r.stops[p][0],f.get(a)]})):r=l&&F(l[0])?"rgb"===a||!a&&1===l[3]?"rgb("+l[0]+","+l[1]+","+l[2]+")":"a"===a?l[3]:"rgba("+l.join(",")+")":f;return r},brighten:function(a){var f,C=this.rgba;if(this.stops)E(this.stops,function(f){f.brighten(a)});else if(F(a)&&0!==a)for(f=0;3>f;f++)C[f]+=l(255*a),0>C[f]&&(C[f]=0),255<C[f]&&(C[f]=255);return this},setOpacity:function(a){this.rgba[3]=a;return this},tweenTo:function(a,l){var f=this.rgba,
r=a.rgba;r.length&&f&&f.length?(a=1!==r[3]||1!==f[3],l=(a?"rgba(":"rgb(")+Math.round(r[0]+(f[0]-r[0])*(1-l))+","+Math.round(r[1]+(f[1]-r[1])*(1-l))+","+Math.round(r[2]+(f[2]-r[2])*(1-l))+(a?","+(r[3]+(f[3]-r[3])*(1-l)):"")+")"):l=a.input||"none";return l}};a.color=function(f){return new a.Color(f)}})(J);(function(a){var E,F,G=a.addEvent,q=a.animate,l=a.attr,f=a.charts,u=a.color,C=a.css,r=a.createElement,y=a.defined,p=a.deg2rad,d=a.destroyObjectProperties,e=a.doc,g=a.each,m=a.extend,b=a.erase,c=a.grep,
x=a.hasTouch,B=a.inArray,t=a.isArray,n=a.isFirefox,L=a.isMS,z=a.isObject,D=a.isString,h=a.isWebKit,I=a.merge,H=a.noop,v=a.objectEach,w=a.pick,k=a.pInt,A=a.removeEvent,Q=a.stop,T=a.svg,K=a.SVG_NS,O=a.symbolSizes,N=a.win;E=a.SVGElement=function(){return this};m(E.prototype,{opacity:1,SVG_NS:K,textProps:"direction fontSize fontWeight fontFamily fontStyle color lineHeight width textAlign textDecoration textOverflow textOutline cursor".split(" "),init:function(a,b){this.element="span"===b?r(b):e.createElementNS(this.SVG_NS,
b);this.renderer=a},animate:function(b,k,c){k=a.animObject(w(k,this.renderer.globalAnimation,!0));0!==k.duration?(c&&(k.complete=c),q(this,b,k)):(this.attr(b,null,c),k.step&&k.step.call(this));return this},complexColor:function(b,k,c){var M=this.renderer,A,d,h,m,K,w,e,x,n,B,z,D=[],H;a.fireEvent(this.renderer,"complexColor",{args:arguments},function(){b.radialGradient?d="radialGradient":b.linearGradient&&(d="linearGradient");d&&(h=b[d],K=M.gradients,e=b.stops,B=c.radialReference,t(h)&&(b[d]=h={x1:h[0],
y1:h[1],x2:h[2],y2:h[3],gradientUnits:"userSpaceOnUse"}),"radialGradient"===d&&B&&!y(h.gradientUnits)&&(m=h,h=I(h,M.getRadialAttr(B,m),{gradientUnits:"userSpaceOnUse"})),v(h,function(a,b){"id"!==b&&D.push(b,a)}),v(e,function(a){D.push(a)}),D=D.join(","),K[D]?z=K[D].attr("id"):(h.id=z=a.uniqueKey(),K[D]=w=M.createElement(d).attr(h).add(M.defs),w.radAttr=m,w.stops=[],g(e,function(b){0===b[1].indexOf("rgba")?(A=a.color(b[1]),x=A.get("rgb"),n=A.get("a")):(x=b[1],n=1);b=M.createElement("stop").attr({offset:b[0],
"stop-color":x,"stop-opacity":n}).add(w);w.stops.push(b)})),H="url("+M.url+"#"+z+")",c.setAttribute(k,H),c.gradient=D,b.toString=function(){return H})})},applyTextOutline:function(k){var c=this.element,M,A,d,h,m;-1!==k.indexOf("contrast")&&(k=k.replace(/contrast/g,this.renderer.getContrast(c.style.fill)));k=k.split(" ");A=k[k.length-1];if((d=k[0])&&"none"!==d&&a.svg){this.fakeTS=!0;k=[].slice.call(c.getElementsByTagName("tspan"));this.ySetter=this.xSetter;d=d.replace(/(^[\d\.]+)(.*?)$/g,function(a,
b,k){return 2*b+k});for(m=k.length;m--;)M=k[m],"highcharts-text-outline"===M.getAttribute("class")&&b(k,c.removeChild(M));h=c.firstChild;g(k,function(a,b){0===b&&(a.setAttribute("x",c.getAttribute("x")),b=c.getAttribute("y"),a.setAttribute("y",b||0),null===b&&c.setAttribute("y",0));a=a.cloneNode(1);l(a,{"class":"highcharts-text-outline",fill:A,stroke:A,"stroke-width":d,"stroke-linejoin":"round"});c.insertBefore(a,h)})}},attr:function(a,b,k,c){var M,A=this.element,d,h=this,m,K;"string"===typeof a&&
void 0!==b&&(M=a,a={},a[M]=b);"string"===typeof a?h=(this[a+"Getter"]||this._defaultGetter).call(this,a,A):(v(a,function(b,k){m=!1;c||Q(this,k);this.symbolName&&/^(x|y|width|height|r|start|end|innerR|anchorX|anchorY)$/.test(k)&&(d||(this.symbolAttr(a),d=!0),m=!0);!this.rotation||"x"!==k&&"y"!==k||(this.doTransform=!0);m||(K=this[k+"Setter"]||this._defaultSetter,K.call(this,b,k,A),this.shadows&&/^(width|height|visibility|x|y|d|transform|cx|cy|r)$/.test(k)&&this.updateShadows(k,b,K))},this),this.afterSetters());
k&&k.call(this);return h},afterSetters:function(){this.doTransform&&(this.updateTransform(),this.doTransform=!1)},updateShadows:function(a,b,k){for(var c=this.shadows,M=c.length;M--;)k.call(c[M],"height"===a?Math.max(b-(c[M].cutHeight||0),0):"d"===a?this.d:b,a,c[M])},addClass:function(a,b){var k=this.attr("class")||"";-1===k.indexOf(a)&&(b||(a=(k+(k?" ":"")+a).replace("  "," ")),this.attr("class",a));return this},hasClass:function(a){return-1!==B(a,(this.attr("class")||"").split(" "))},removeClass:function(a){return this.attr("class",
(this.attr("class")||"").replace(a,""))},symbolAttr:function(a){var b=this;g("x y r start end width height innerR anchorX anchorY".split(" "),function(k){b[k]=w(a[k],b[k])});b.attr({d:b.renderer.symbols[b.symbolName](b.x,b.y,b.width,b.height,b)})},clip:function(a){return this.attr("clip-path",a?"url("+this.renderer.url+"#"+a.id+")":"none")},crisp:function(a,b){var k;b=b||a.strokeWidth||0;k=Math.round(b)%2/2;a.x=Math.floor(a.x||this.x||0)+k;a.y=Math.floor(a.y||this.y||0)+k;a.width=Math.floor((a.width||
this.width||0)-2*k);a.height=Math.floor((a.height||this.height||0)-2*k);y(a.strokeWidth)&&(a.strokeWidth=b);return a},css:function(a){var b=this.styles,c={},A=this.element,d,M="",h,K=!b,w=["textOutline","textOverflow","width"];a&&a.color&&(a.fill=a.color);b&&v(a,function(a,k){a!==b[k]&&(c[k]=a,K=!0)});K&&(b&&(a=m(b,c)),a&&(null===a.width||"auto"===a.width?delete this.textWidth:"text"===A.nodeName.toLowerCase()&&a.width&&(d=this.textWidth=k(a.width))),this.styles=a,d&&!T&&this.renderer.forExport&&
delete a.width,A.namespaceURI===this.SVG_NS?(h=function(a,b){return"-"+b.toLowerCase()},v(a,function(a,b){-1===B(b,w)&&(M+=b.replace(/([A-Z])/g,h)+":"+a+";")}),M&&l(A,"style",M)):C(A,a),this.added&&("text"===this.element.nodeName&&this.renderer.buildText(this),a&&a.textOutline&&this.applyTextOutline(a.textOutline)));return this},strokeWidth:function(){return this["stroke-width"]||0},on:function(a,b){var k=this,c=k.element;x&&"click"===a?(c.ontouchstart=function(a){k.touchEventFired=Date.now();a.preventDefault();
b.call(c,a)},c.onclick=function(a){(-1===N.navigator.userAgent.indexOf("Android")||1100<Date.now()-(k.touchEventFired||0))&&b.call(c,a)}):c["on"+a]=b;return this},setRadialReference:function(a){var b=this.renderer.gradients[this.element.gradient];this.element.radialReference=a;b&&b.radAttr&&b.animate(this.renderer.getRadialAttr(a,b.radAttr));return this},translate:function(a,b){return this.attr({translateX:a,translateY:b})},invert:function(a){this.inverted=a;this.updateTransform();return this},updateTransform:function(){var a=
this.translateX||0,b=this.translateY||0,k=this.scaleX,c=this.scaleY,A=this.inverted,d=this.rotation,h=this.matrix,m=this.element;A&&(a+=this.width,b+=this.height);a=["translate("+a+","+b+")"];y(h)&&a.push("matrix("+h.join(",")+")");A?a.push("rotate(90) scale(-1,1)"):d&&a.push("rotate("+d+" "+w(this.rotationOriginX,m.getAttribute("x"),0)+" "+w(this.rotationOriginY,m.getAttribute("y")||0)+")");(y(k)||y(c))&&a.push("scale("+w(k,1)+" "+w(c,1)+")");a.length&&m.setAttribute("transform",a.join(" "))},toFront:function(){var a=
this.element;a.parentNode.appendChild(a);return this},align:function(a,k,c){var A,d,h,M,m={};d=this.renderer;h=d.alignedObjects;var K,v;if(a){if(this.alignOptions=a,this.alignByTranslate=k,!c||D(c))this.alignTo=A=c||"renderer",b(h,this),h.push(this),c=null}else a=this.alignOptions,k=this.alignByTranslate,A=this.alignTo;c=w(c,d[A],d);A=a.align;d=a.verticalAlign;h=(c.x||0)+(a.x||0);M=(c.y||0)+(a.y||0);"right"===A?K=1:"center"===A&&(K=2);K&&(h+=(c.width-(a.width||0))/K);m[k?"translateX":"x"]=Math.round(h);
"bottom"===d?v=1:"middle"===d&&(v=2);v&&(M+=(c.height-(a.height||0))/v);m[k?"translateY":"y"]=Math.round(M);this[this.placed?"animate":"attr"](m);this.placed=!0;this.alignAttr=m;return this},getBBox:function(a,b){var k,c=this.renderer,A,d=this.element,h=this.styles,M,K=this.textStr,v,e=c.cache,x=c.cacheKeys,n;b=w(b,this.rotation);A=b*p;M=h&&h.fontSize;y(K)&&(n=K.toString(),-1===n.indexOf("\x3c")&&(n=n.replace(/[0-9]/g,"0")),n+=["",b||0,M,this.textWidth,h&&h.textOverflow].join());n&&!a&&(k=e[n]);if(!k){if(d.namespaceURI===
this.SVG_NS||c.forExport){try{(v=this.fakeTS&&function(a){g(d.querySelectorAll(".highcharts-text-outline"),function(b){b.style.display=a})})&&v("none"),k=d.getBBox?m({},d.getBBox()):{width:d.offsetWidth,height:d.offsetHeight},v&&v("")}catch(U){}if(!k||0>k.width)k={width:0,height:0}}else k=this.htmlGetBBox();c.isSVG&&(a=k.width,c=k.height,h&&"11px"===h.fontSize&&17===Math.round(c)&&(k.height=c=14),b&&(k.width=Math.abs(c*Math.sin(A))+Math.abs(a*Math.cos(A)),k.height=Math.abs(c*Math.cos(A))+Math.abs(a*
Math.sin(A))));if(n&&0<k.height){for(;250<x.length;)delete e[x.shift()];e[n]||x.push(n);e[n]=k}}return k},show:function(a){return this.attr({visibility:a?"inherit":"visible"})},hide:function(){return this.attr({visibility:"hidden"})},fadeOut:function(a){var b=this;b.animate({opacity:0},{duration:a||150,complete:function(){b.attr({y:-9999})}})},add:function(a){var b=this.renderer,k=this.element,c;a&&(this.parentGroup=a);this.parentInverted=a&&a.inverted;void 0!==this.textStr&&b.buildText(this);this.added=
!0;if(!a||a.handleZ||this.zIndex)c=this.zIndexSetter();c||(a?a.element:b.box).appendChild(k);if(this.onAdd)this.onAdd();return this},safeRemoveChild:function(a){var b=a.parentNode;b&&b.removeChild(a)},destroy:function(){var a=this,k=a.element||{},c=a.renderer.isSVG&&"SPAN"===k.nodeName&&a.parentGroup,A=k.ownerSVGElement,d=a.clipPath;k.onclick=k.onmouseout=k.onmouseover=k.onmousemove=k.point=null;Q(a);d&&A&&(g(A.querySelectorAll("[clip-path],[CLIP-PATH]"),function(a){var b=a.getAttribute("clip-path"),
k=d.element.id;(-1<b.indexOf("(#"+k+")")||-1<b.indexOf('("#'+k+'")'))&&a.removeAttribute("clip-path")}),a.clipPath=d.destroy());if(a.stops){for(A=0;A<a.stops.length;A++)a.stops[A]=a.stops[A].destroy();a.stops=null}a.safeRemoveChild(k);for(a.destroyShadows();c&&c.div&&0===c.div.childNodes.length;)k=c.parentGroup,a.safeRemoveChild(c.div),delete c.div,c=k;a.alignTo&&b(a.renderer.alignedObjects,a);v(a,function(b,k){delete a[k]});return null},shadow:function(a,b,k){var c=[],A,d,h=this.element,m,v,K,M;
if(!a)this.destroyShadows();else if(!this.shadows){v=w(a.width,3);K=(a.opacity||.15)/v;M=this.parentInverted?"(-1,-1)":"("+w(a.offsetX,1)+", "+w(a.offsetY,1)+")";for(A=1;A<=v;A++)d=h.cloneNode(0),m=2*v+1-2*A,l(d,{stroke:a.color||"#000000","stroke-opacity":K*A,"stroke-width":m,transform:"translate"+M,fill:"none"}),d.setAttribute("class",(d.getAttribute("class")||"")+" highcharts-shadow"),k&&(l(d,"height",Math.max(l(d,"height")-m,0)),d.cutHeight=m),b?b.element.appendChild(d):h.parentNode&&h.parentNode.insertBefore(d,
h),c.push(d);this.shadows=c}return this},destroyShadows:function(){g(this.shadows||[],function(a){this.safeRemoveChild(a)},this);this.shadows=void 0},xGetter:function(a){"circle"===this.element.nodeName&&("x"===a?a="cx":"y"===a&&(a="cy"));return this._defaultGetter(a)},_defaultGetter:function(a){a=w(this[a+"Value"],this[a],this.element?this.element.getAttribute(a):null,0);/^[\-0-9\.]+$/.test(a)&&(a=parseFloat(a));return a},dSetter:function(a,b,k){a&&a.join&&(a=a.join(" "));/(NaN| {2}|^$)/.test(a)&&
(a="M 0 0");this[b]!==a&&(k.setAttribute(b,a),this[b]=a)},dashstyleSetter:function(a){var b,c=this["stroke-width"];"inherit"===c&&(c=1);if(a=a&&a.toLowerCase()){a=a.replace("shortdashdotdot","3,1,1,1,1,1,").replace("shortdashdot","3,1,1,1").replace("shortdot","1,1,").replace("shortdash","3,1,").replace("longdash","8,3,").replace(/dot/g,"1,3,").replace("dash","4,3,").replace(/,$/,"").split(",");for(b=a.length;b--;)a[b]=k(a[b])*c;a=a.join(",").replace(/NaN/g,"none");this.element.setAttribute("stroke-dasharray",
a)}},alignSetter:function(a){this.alignValue=a;this.element.setAttribute("text-anchor",{left:"start",center:"middle",right:"end"}[a])},opacitySetter:function(a,b,k){this[b]=a;k.setAttribute(b,a)},titleSetter:function(a){var b=this.element.getElementsByTagName("title")[0];b||(b=e.createElementNS(this.SVG_NS,"title"),this.element.appendChild(b));b.firstChild&&b.removeChild(b.firstChild);b.appendChild(e.createTextNode(String(w(a),"").replace(/<[^>]*>/g,"").replace(/&lt;/g,"\x3c").replace(/&gt;/g,"\x3e")))},
textSetter:function(a){a!==this.textStr&&(delete this.bBox,this.textStr=a,this.added&&this.renderer.buildText(this))},fillSetter:function(a,b,k){"string"===typeof a?k.setAttribute(b,a):a&&this.complexColor(a,b,k)},visibilitySetter:function(a,b,k){"inherit"===a?k.removeAttribute(b):this[b]!==a&&k.setAttribute(b,a);this[b]=a},zIndexSetter:function(a,b){var c=this.renderer,A=this.parentGroup,d=(A||c).element||c.box,h,m=this.element,v,K,c=d===c.box;h=this.added;var w;y(a)?(m.setAttribute("data-z-index",
a),a=+a,this[b]===a&&(h=!1)):y(this[b])&&m.removeAttribute("data-z-index");this[b]=a;if(h){(a=this.zIndex)&&A&&(A.handleZ=!0);b=d.childNodes;for(w=b.length-1;0<=w&&!v;w--)if(A=b[w],h=A.getAttribute("data-z-index"),K=!y(h),A!==m)if(0>a&&K&&!c&&!w)d.insertBefore(m,b[w]),v=!0;else if(k(h)<=a||K&&(!y(a)||0<=a))d.insertBefore(m,b[w+1]||null),v=!0;v||(d.insertBefore(m,b[c?3:0]||null),v=!0)}return v},_defaultSetter:function(a,b,k){k.setAttribute(b,a)}});E.prototype.yGetter=E.prototype.xGetter;E.prototype.translateXSetter=
E.prototype.translateYSetter=E.prototype.rotationSetter=E.prototype.verticalAlignSetter=E.prototype.rotationOriginXSetter=E.prototype.rotationOriginYSetter=E.prototype.scaleXSetter=E.prototype.scaleYSetter=E.prototype.matrixSetter=function(a,b){this[b]=a;this.doTransform=!0};E.prototype["stroke-widthSetter"]=E.prototype.strokeSetter=function(a,b,k){this[b]=a;this.stroke&&this["stroke-width"]?(E.prototype.fillSetter.call(this,this.stroke,"stroke",k),k.setAttribute("stroke-width",this["stroke-width"]),
this.hasStroke=!0):"stroke-width"===b&&0===a&&this.hasStroke&&(k.removeAttribute("stroke"),this.hasStroke=!1)};F=a.SVGRenderer=function(){this.init.apply(this,arguments)};m(F.prototype,{Element:E,SVG_NS:K,init:function(a,b,k,c,A,d){var m;c=this.createElement("svg").attr({version:"1.1","class":"highcharts-root"}).css(this.getStyle(c));m=c.element;a.appendChild(m);l(a,"dir","ltr");-1===a.innerHTML.indexOf("xmlns")&&l(m,"xmlns",this.SVG_NS);this.isSVG=!0;this.box=m;this.boxWrapper=c;this.alignedObjects=
[];this.url=(n||h)&&e.getElementsByTagName("base").length?N.location.href.split("#")[0].replace(/<[^>]*>/g,"").replace(/([\('\)])/g,"\\$1").replace(/ /g,"%20"):"";this.createElement("desc").add().element.appendChild(e.createTextNode("Created with Highstock 6.1.4"));this.defs=this.createElement("defs").add();this.allowHTML=d;this.forExport=A;this.gradients={};this.cache={};this.cacheKeys=[];this.imgCount=0;this.setSize(b,k,!1);var v;n&&a.getBoundingClientRect&&(b=function(){C(a,{left:0,top:0});v=a.getBoundingClientRect();
C(a,{left:Math.ceil(v.left)-v.left+"px",top:Math.ceil(v.top)-v.top+"px"})},b(),this.unSubPixelFix=G(N,"resize",b))},getStyle:function(a){return this.style=m({fontFamily:'"Lucida Grande", "Lucida Sans Unicode", Arial, Helvetica, sans-serif',fontSize:"12px"},a)},setStyle:function(a){this.boxWrapper.css(this.getStyle(a))},isHidden:function(){return!this.boxWrapper.getBBox().width},destroy:function(){var a=this.defs;this.box=null;this.boxWrapper=this.boxWrapper.destroy();d(this.gradients||{});this.gradients=
null;a&&(this.defs=a.destroy());this.unSubPixelFix&&this.unSubPixelFix();return this.alignedObjects=null},createElement:function(a){var b=new this.Element;b.init(this,a);return b},draw:H,getRadialAttr:function(a,b){return{cx:a[0]-a[2]/2+b.cx*a[2],cy:a[1]-a[2]/2+b.cy*a[2],r:b.r*a[2]}},truncate:function(a,b,k,c,A,d,h){var m=this,v=a.rotation,K,w=c?1:0,n=(k||c).length,g=n,x=[],B=function(a){b.firstChild&&b.removeChild(b.firstChild);a&&b.appendChild(e.createTextNode(a))},z=function(d,v){v=v||d;if(void 0===
x[v])if(b.getSubStringLength)try{x[v]=A+b.getSubStringLength(0,c?v+1:v)}catch(ga){}else B(h(k||c,d)),x[v]=A+m.getSpanWidth(a,b);return x[v]},t,D;a.rotation=0;t=z(b.textContent.length);if(D=A+t>d){for(;w<=n;)g=Math.ceil((w+n)/2),c&&(K=h(c,g)),t=z(g,K&&K.length-1),w===n?w=n+1:t>d?n=g-1:w=g;0===n?B(""):k&&n===k.length-1||B(K||h(k||c,g))}c&&c.splice(0,g);a.actualWidth=t;a.rotation=v;return D},escapes:{"\x26":"\x26amp;","\x3c":"\x26lt;","\x3e":"\x26gt;","'":"\x26#39;",'"':"\x26quot;"},buildText:function(a){var b=
a.element,A=this,d=A.forExport,h=w(a.textStr,"").toString(),m=-1!==h.indexOf("\x3c"),n=b.childNodes,x,z=l(b,"x"),t=a.styles,D=a.textWidth,H=t&&t.lineHeight,Q=t&&t.textOutline,p=t&&"ellipsis"===t.textOverflow,I=t&&"nowrap"===t.whiteSpace,M=t&&t.fontSize,O,f,L=n.length,t=D&&!a.added&&this.box,r=function(a){var c;c=/(px|em)$/.test(a&&a.style.fontSize)?a.style.fontSize:M||A.style.fontSize||12;return H?k(H):A.fontMetrics(c,a.getAttribute("style")?a:b).h},y=function(a,b){v(A.escapes,function(k,c){b&&-1!==
B(k,b)||(a=a.toString().replace(new RegExp(k,"g"),c))});return a},N=function(a,b){var k;k=a.indexOf("\x3c");a=a.substring(k,a.indexOf("\x3e")-k);k=a.indexOf(b+"\x3d");if(-1!==k&&(k=k+b.length+1,b=a.charAt(k),'"'===b||"'"===b))return a=a.substring(k+1),a.substring(0,a.indexOf(b))};O=[h,p,I,H,Q,M,D].join();if(O!==a.textCache){for(a.textCache=O;L--;)b.removeChild(n[L]);m||Q||p||D||-1!==h.indexOf(" ")?(t&&t.appendChild(b),h=m?h.replace(/<(b|strong)>/g,'\x3cspan style\x3d"font-weight:bold"\x3e').replace(/<(i|em)>/g,
'\x3cspan style\x3d"font-style:italic"\x3e').replace(/<a/g,"\x3cspan").replace(/<\/(b|strong|i|em|a)>/g,"\x3c/span\x3e").split(/<br.*?>/g):[h],h=c(h,function(a){return""!==a}),g(h,function(k,c){var h,m=0,v=0;k=k.replace(/^\s+|\s+$/g,"").replace(/<span/g,"|||\x3cspan").replace(/<\/span>/g,"\x3c/span\x3e|||");h=k.split("|||");g(h,function(k){if(""!==k||1===h.length){var w={},n=e.createElementNS(A.SVG_NS,"tspan"),g,t;(g=N(k,"class"))&&l(n,"class",g);if(g=N(k,"style"))g=g.replace(/(;| |^)color([ :])/,
"$1fill$2"),l(n,"style",g);(t=N(k,"href"))&&!d&&(l(n,"onclick",'location.href\x3d"'+t+'"'),l(n,"class","highcharts-anchor"),C(n,{cursor:"pointer"}));k=y(k.replace(/<[a-zA-Z\/](.|\n)*?>/g,"")||" ");if(" "!==k){n.appendChild(e.createTextNode(k));m?w.dx=0:c&&null!==z&&(w.x=z);l(n,w);b.appendChild(n);!m&&f&&(!T&&d&&C(n,{display:"block"}),l(n,"dy",r(n)));if(D){var B=k.replace(/([^\^])-/g,"$1- ").split(" "),w=!I&&(1<h.length||c||1<B.length);t=0;var H=r(n);if(p)x=A.truncate(a,n,k,void 0,0,Math.max(0,D-parseInt(M||
12,10)),function(a,b){return a.substring(0,b)+"\u2026"});else if(w)for(;B.length;)B.length&&!I&&0<t&&(n=e.createElementNS(K,"tspan"),l(n,{dy:H,x:z}),g&&l(n,"style",g),n.appendChild(e.createTextNode(B.join(" ").replace(/- /g,"-"))),b.appendChild(n)),A.truncate(a,n,null,B,0===t?v:0,D,function(a,b){return B.slice(0,b).join(" ").replace(/- /g,"-")}),v=a.actualWidth,t++}m++}}});f=f||b.childNodes.length}),p&&x&&a.attr("title",y(a.textStr,["\x26lt;","\x26gt;"])),t&&t.removeChild(b),Q&&a.applyTextOutline&&
a.applyTextOutline(Q)):b.appendChild(e.createTextNode(y(h)))}},getContrast:function(a){a=u(a).rgba;a[0]*=1;a[1]*=1.2;a[2]*=.5;return 459<a[0]+a[1]+a[2]?"#000000":"#FFFFFF"},button:function(a,b,k,c,A,d,h,v,K){var w=this.label(a,b,k,K,null,null,null,null,"button"),e=0;w.attr(I({padding:8,r:2},A));var n,g,x,t;A=I({fill:"#f7f7f7",stroke:"#cccccc","stroke-width":1,style:{color:"#333333",cursor:"pointer",fontWeight:"normal"}},A);n=A.style;delete A.style;d=I(A,{fill:"#e6e6e6"},d);g=d.style;delete d.style;
h=I(A,{fill:"#e6ebf5",style:{color:"#000000",fontWeight:"bold"}},h);x=h.style;delete h.style;v=I(A,{style:{color:"#cccccc"}},v);t=v.style;delete v.style;G(w.element,L?"mouseover":"mouseenter",function(){3!==e&&w.setState(1)});G(w.element,L?"mouseout":"mouseleave",function(){3!==e&&w.setState(e)});w.setState=function(a){1!==a&&(w.state=e=a);w.removeClass(/highcharts-button-(normal|hover|pressed|disabled)/).addClass("highcharts-button-"+["normal","hover","pressed","disabled"][a||0]);w.attr([A,d,h,v][a||
0]).css([n,g,x,t][a||0])};w.attr(A).css(m({cursor:"default"},n));return w.on("click",function(a){3!==e&&c.call(w,a)})},crispLine:function(a,b){a[1]===a[4]&&(a[1]=a[4]=Math.round(a[1])-b%2/2);a[2]===a[5]&&(a[2]=a[5]=Math.round(a[2])+b%2/2);return a},path:function(a){var b={fill:"none"};t(a)?b.d=a:z(a)&&m(b,a);return this.createElement("path").attr(b)},circle:function(a,b,k){a=z(a)?a:{x:a,y:b,r:k};b=this.createElement("circle");b.xSetter=b.ySetter=function(a,b,k){k.setAttribute("c"+b,a)};return b.attr(a)},
arc:function(a,b,k,c,A,d){z(a)?(c=a,b=c.y,k=c.r,a=c.x):c={innerR:c,start:A,end:d};a=this.symbol("arc",a,b,k,k,c);a.r=k;return a},rect:function(a,b,k,c,A,d){A=z(a)?a.r:A;var h=this.createElement("rect");a=z(a)?a:void 0===a?{}:{x:a,y:b,width:Math.max(k,0),height:Math.max(c,0)};void 0!==d&&(a.strokeWidth=d,a=h.crisp(a));a.fill="none";A&&(a.r=A);h.rSetter=function(a,b,k){l(k,{rx:a,ry:a})};return h.attr(a)},setSize:function(a,b,k){var c=this.alignedObjects,A=c.length;this.width=a;this.height=b;for(this.boxWrapper.animate({width:a,
height:b},{step:function(){this.attr({viewBox:"0 0 "+this.attr("width")+" "+this.attr("height")})},duration:w(k,!0)?void 0:0});A--;)c[A].align()},g:function(a){var b=this.createElement("g");return a?b.attr({"class":"highcharts-"+a}):b},image:function(a,b,k,c,A,d){var h={preserveAspectRatio:"none"},v,K=function(a,b){a.setAttributeNS?a.setAttributeNS("http://www.w3.org/1999/xlink","href",b):a.setAttribute("hc-svg-href",b)},w=function(b){K(v.element,a);d.call(v,b)};1<arguments.length&&m(h,{x:b,y:k,width:c,
height:A});v=this.createElement("image").attr(h);d?(K(v.element,"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw\x3d\x3d"),h=new N.Image,G(h,"load",w),h.src=a,h.complete&&w({})):K(v.element,a);return v},symbol:function(a,b,k,c,A,d){var h=this,v,K=/^url\((.*?)\)$/,n=K.test(a),x=!n&&(this.symbols[a]?a:"circle"),t=x&&this.symbols[x],B=y(b)&&t&&t.call(this.symbols,Math.round(b),Math.round(k),c,A,d),z,D;t?(v=this.path(B),v.attr("fill","none"),m(v,{symbolName:x,x:b,y:k,width:c,
height:A}),d&&m(v,d)):n&&(z=a.match(K)[1],v=this.image(z),v.imgwidth=w(O[z]&&O[z].width,d&&d.width),v.imgheight=w(O[z]&&O[z].height,d&&d.height),D=function(){v.attr({width:v.width,height:v.height})},g(["width","height"],function(a){v[a+"Setter"]=function(a,b){var k={},c=this["img"+b],A="width"===b?"translateX":"translateY";this[b]=a;y(c)&&(this.element&&this.element.setAttribute(b,c),this.alignByTranslate||(k[A]=((this[b]||0)-c)/2,this.attr(k)))}}),y(b)&&v.attr({x:b,y:k}),v.isImg=!0,y(v.imgwidth)&&
y(v.imgheight)?D():(v.attr({width:0,height:0}),r("img",{onload:function(){var a=f[h.chartIndex];0===this.width&&(C(this,{position:"absolute",top:"-999em"}),e.body.appendChild(this));O[z]={width:this.width,height:this.height};v.imgwidth=this.width;v.imgheight=this.height;v.element&&D();this.parentNode&&this.parentNode.removeChild(this);h.imgCount--;if(!h.imgCount&&a&&a.onload)a.onload()},src:z}),this.imgCount++));return v},symbols:{circle:function(a,b,k,c){return this.arc(a+k/2,b+c/2,k/2,c/2,{start:0,
end:2*Math.PI,open:!1})},square:function(a,b,k,c){return["M",a,b,"L",a+k,b,a+k,b+c,a,b+c,"Z"]},triangle:function(a,b,k,c){return["M",a+k/2,b,"L",a+k,b+c,a,b+c,"Z"]},"triangle-down":function(a,b,k,c){return["M",a,b,"L",a+k,b,a+k/2,b+c,"Z"]},diamond:function(a,b,k,c){return["M",a+k/2,b,"L",a+k,b+c/2,a+k/2,b+c,a,b+c/2,"Z"]},arc:function(a,b,k,c,A){var d=A.start,h=A.r||k,v=A.r||c||k,m=A.end-.001;k=A.innerR;c=w(A.open,.001>Math.abs(A.end-A.start-2*Math.PI));var K=Math.cos(d),e=Math.sin(d),n=Math.cos(m),
m=Math.sin(m);A=.001>A.end-d-Math.PI?0:1;h=["M",a+h*K,b+v*e,"A",h,v,0,A,1,a+h*n,b+v*m];y(k)&&h.push(c?"M":"L",a+k*n,b+k*m,"A",k,k,0,A,0,a+k*K,b+k*e);h.push(c?"":"Z");return h},callout:function(a,b,k,c,A){var d=Math.min(A&&A.r||0,k,c),h=d+6,v=A&&A.anchorX;A=A&&A.anchorY;var m;m=["M",a+d,b,"L",a+k-d,b,"C",a+k,b,a+k,b,a+k,b+d,"L",a+k,b+c-d,"C",a+k,b+c,a+k,b+c,a+k-d,b+c,"L",a+d,b+c,"C",a,b+c,a,b+c,a,b+c-d,"L",a,b+d,"C",a,b,a,b,a+d,b];v&&v>k?A>b+h&&A<b+c-h?m.splice(13,3,"L",a+k,A-6,a+k+6,A,a+k,A+6,a+k,
b+c-d):m.splice(13,3,"L",a+k,c/2,v,A,a+k,c/2,a+k,b+c-d):v&&0>v?A>b+h&&A<b+c-h?m.splice(33,3,"L",a,A+6,a-6,A,a,A-6,a,b+d):m.splice(33,3,"L",a,c/2,v,A,a,c/2,a,b+d):A&&A>c&&v>a+h&&v<a+k-h?m.splice(23,3,"L",v+6,b+c,v,b+c+6,v-6,b+c,a+d,b+c):A&&0>A&&v>a+h&&v<a+k-h&&m.splice(3,3,"L",v-6,b,v,b-6,v+6,b,k-d,b);return m}},clipRect:function(b,k,c,A){var d=a.uniqueKey(),h=this.createElement("clipPath").attr({id:d}).add(this.defs);b=this.rect(b,k,c,A,0).add(h);b.id=d;b.clipPath=h;b.count=0;return b},text:function(a,
b,k,c){var A={};if(c&&(this.allowHTML||!this.forExport))return this.html(a,b,k);A.x=Math.round(b||0);k&&(A.y=Math.round(k));if(a||0===a)A.text=a;a=this.createElement("text").attr(A);c||(a.xSetter=function(a,b,k){var c=k.getElementsByTagName("tspan"),A,d=k.getAttribute(b),h;for(h=0;h<c.length;h++)A=c[h],A.getAttribute(b)===d&&A.setAttribute(b,a);k.setAttribute(b,a)});return a},fontMetrics:function(a,b){a=a||b&&b.style&&b.style.fontSize||this.style&&this.style.fontSize;a=/px/.test(a)?k(a):/em/.test(a)?
parseFloat(a)*(b?this.fontMetrics(null,b.parentNode).f:16):12;b=24>a?a+3:Math.round(1.2*a);return{h:b,b:Math.round(.8*b),f:a}},rotCorr:function(a,b,k){var c=a;b&&k&&(c=Math.max(c*Math.cos(b*p),4));return{x:-a/3*Math.sin(b*p),y:c}},label:function(b,k,c,d,h,v,K,w,e){var n=this,x=n.g("button"!==e&&"label"),t=x.text=n.text("",0,0,K).attr({zIndex:1}),B,z,D=0,H=3,Q=0,p,T,O,f,L,r={},l,N,M=/^url\((.*?)\)$/.test(d),C=M,u,q,S,W;e&&x.addClass("highcharts-"+e);C=M;u=function(){return(l||0)%2/2};q=function(){var a=
t.element.style,b={};z=(void 0===p||void 0===T||L)&&y(t.textStr)&&t.getBBox();x.width=(p||z.width||0)+2*H+Q;x.height=(T||z.height||0)+2*H;N=H+n.fontMetrics(a&&a.fontSize,t).b;C&&(B||(x.box=B=n.symbols[d]||M?n.symbol(d):n.rect(),B.addClass(("button"===e?"":"highcharts-label-box")+(e?" highcharts-"+e+"-box":"")),B.add(x),a=u(),b.x=a,b.y=(w?-N:0)+a),b.width=Math.round(x.width),b.height=Math.round(x.height),B.attr(m(b,r)),r={})};S=function(){var a=Q+H,b;b=w?0:N;y(p)&&z&&("center"===L||"right"===L)&&(a+=
{center:.5,right:1}[L]*(p-z.width));if(a!==t.x||b!==t.y)t.attr("x",a),t.hasBoxWidthChanged&&(z=t.getBBox(!0),q()),void 0!==b&&t.attr("y",b);t.x=a;t.y=b};W=function(a,b){B?B.attr(a,b):r[a]=b};x.onAdd=function(){t.add(x);x.attr({text:b||0===b?b:"",x:k,y:c});B&&y(h)&&x.attr({anchorX:h,anchorY:v})};x.widthSetter=function(b){p=a.isNumber(b)?b:null};x.heightSetter=function(a){T=a};x["text-alignSetter"]=function(a){L=a};x.paddingSetter=function(a){y(a)&&a!==H&&(H=x.padding=a,S())};x.paddingLeftSetter=function(a){y(a)&&
a!==Q&&(Q=a,S())};x.alignSetter=function(a){a={left:0,center:.5,right:1}[a];a!==D&&(D=a,z&&x.attr({x:O}))};x.textSetter=function(a){void 0!==a&&t.textSetter(a);q();S()};x["stroke-widthSetter"]=function(a,b){a&&(C=!0);l=this["stroke-width"]=a;W(b,a)};x.strokeSetter=x.fillSetter=x.rSetter=function(a,b){"r"!==b&&("fill"===b&&a&&(C=!0),x[b]=a);W(b,a)};x.anchorXSetter=function(a,b){h=x.anchorX=a;W(b,Math.round(a)-u()-O)};x.anchorYSetter=function(a,b){v=x.anchorY=a;W(b,a-f)};x.xSetter=function(a){x.x=a;
D&&(a-=D*((p||z.width)+2*H),x["forceAnimate:x"]=!0);O=Math.round(a);x.attr("translateX",O)};x.ySetter=function(a){f=x.y=Math.round(a);x.attr("translateY",f)};var R=x.css;return m(x,{css:function(a){if(a){var b={};a=I(a);g(x.textProps,function(k){void 0!==a[k]&&(b[k]=a[k],delete a[k])});t.css(b);"width"in b&&q()}return R.call(x,a)},getBBox:function(){return{width:z.width+2*H,height:z.height+2*H,x:z.x-H,y:z.y-H}},shadow:function(a){a&&(q(),B&&B.shadow(a));return x},destroy:function(){A(x.element,"mouseenter");
A(x.element,"mouseleave");t&&(t=t.destroy());B&&(B=B.destroy());E.prototype.destroy.call(x);x=n=q=S=W=null}})}});a.Renderer=F})(J);(function(a){var E=a.attr,F=a.createElement,G=a.css,q=a.defined,l=a.each,f=a.extend,u=a.isFirefox,C=a.isMS,r=a.isWebKit,y=a.pick,p=a.pInt,d=a.SVGRenderer,e=a.win,g=a.wrap;f(a.SVGElement.prototype,{htmlCss:function(a){var b="SPAN"===this.element.tagName&&a&&"width"in a,c=y(b&&a.width,void 0);b&&(delete a.width,this.textWidth=c,this.htmlUpdateTransform());a&&"ellipsis"===
a.textOverflow&&(a.whiteSpace="nowrap",a.overflow="hidden");this.styles=f(this.styles,a);G(this.element,a);return this},htmlGetBBox:function(){var a=this.element;return{x:a.offsetLeft,y:a.offsetTop,width:a.offsetWidth,height:a.offsetHeight}},htmlUpdateTransform:function(){if(this.added){var a=this.renderer,b=this.element,c=this.translateX||0,d=this.translateY||0,e=this.x||0,t=this.y||0,n=this.textAlign||"left",g={left:0,center:.5,right:1}[n],z=this.styles,D=z&&z.whiteSpace;G(b,{marginLeft:c,marginTop:d});
this.shadows&&l(this.shadows,function(a){G(a,{marginLeft:c+1,marginTop:d+1})});this.inverted&&l(b.childNodes,function(c){a.invertChild(c,b)});if("SPAN"===b.tagName){var z=this.rotation,h=this.textWidth&&p(this.textWidth),I=[z,n,b.innerHTML,this.textWidth,this.textAlign].join(),H;(H=h!==this.oldTextWidth)&&!(H=h>this.oldTextWidth)&&((H=this.textPxLength)||(G(b,{width:"",whiteSpace:D||"nowrap"}),H=b.offsetWidth),H=H>h);H&&/[ \-]/.test(b.textContent||b.innerText)?(G(b,{width:h+"px",display:"block",whiteSpace:D||
"normal"}),this.oldTextWidth=h,this.hasBoxWidthChanged=!0):this.hasBoxWidthChanged=!1;I!==this.cTT&&(D=a.fontMetrics(b.style.fontSize).b,!q(z)||z===(this.oldRotation||0)&&n===this.oldAlign||this.setSpanRotation(z,g,D),this.getSpanCorrection(!q(z)&&this.textPxLength||b.offsetWidth,D,g,z,n));G(b,{left:e+(this.xCorr||0)+"px",top:t+(this.yCorr||0)+"px"});this.cTT=I;this.oldRotation=z;this.oldAlign=n}}else this.alignOnAdd=!0},setSpanRotation:function(a,b,c){var d={},m=this.renderer.getTransformKey();d[m]=
d.transform="rotate("+a+"deg)";d[m+(u?"Origin":"-origin")]=d.transformOrigin=100*b+"% "+c+"px";G(this.element,d)},getSpanCorrection:function(a,b,c){this.xCorr=-a*c;this.yCorr=-b}});f(d.prototype,{getTransformKey:function(){return C&&!/Edge/.test(e.navigator.userAgent)?"-ms-transform":r?"-webkit-transform":u?"MozTransform":e.opera?"-o-transform":""},html:function(a,b,c){var d=this.createElement("span"),m=d.element,e=d.renderer,n=e.isSVG,p=function(a,b){l(["opacity","visibility"],function(c){g(a,c+
"Setter",function(a,c,d,h){a.call(this,c,d,h);b[d]=c})});a.addedSetters=!0};d.textSetter=function(a){a!==m.innerHTML&&delete this.bBox;this.textStr=a;m.innerHTML=y(a,"");d.doTransform=!0};n&&p(d,d.element.style);d.xSetter=d.ySetter=d.alignSetter=d.rotationSetter=function(a,b){"align"===b&&(b="textAlign");d[b]=a;d.doTransform=!0};d.afterSetters=function(){this.doTransform&&(this.htmlUpdateTransform(),this.doTransform=!1)};d.attr({text:a,x:Math.round(b),y:Math.round(c)}).css({fontFamily:this.style.fontFamily,
fontSize:this.style.fontSize,position:"absolute"});m.style.whiteSpace="nowrap";d.css=d.htmlCss;n&&(d.add=function(a){var b,c=e.box.parentNode,n=[];if(this.parentGroup=a){if(b=a.div,!b){for(;a;)n.push(a),a=a.parentGroup;l(n.reverse(),function(a){function h(b,k){a[k]=b;"translateX"===k?m.left=b+"px":m.top=b+"px";a.doTransform=!0}var m,k=E(a.element,"class");k&&(k={className:k});b=a.div=a.div||F("div",k,{position:"absolute",left:(a.translateX||0)+"px",top:(a.translateY||0)+"px",display:a.display,opacity:a.opacity,
pointerEvents:a.styles&&a.styles.pointerEvents},b||c);m=b.style;f(a,{classSetter:function(a){return function(b){this.element.setAttribute("class",b);a.className=b}}(b),on:function(){n[0].div&&d.on.apply({element:n[0].div},arguments);return a},translateXSetter:h,translateYSetter:h});a.addedSetters||p(a,m)})}}else b=c;b.appendChild(m);d.added=!0;d.alignOnAdd&&d.htmlUpdateTransform();return d});return d}})})(J);(function(a){var E=a.defined,F=a.each,G=a.extend,q=a.merge,l=a.pick,f=a.timeUnits,u=a.win;
a.Time=function(a){this.update(a,!1)};a.Time.prototype={defaultOptions:{},update:function(a){var f=l(a&&a.useUTC,!0),y=this;this.options=a=q(!0,this.options||{},a);this.Date=a.Date||u.Date;this.timezoneOffset=(this.useUTC=f)&&a.timezoneOffset;this.getTimezoneOffset=this.timezoneOffsetFunction();(this.variableTimezone=!(f&&!a.getTimezoneOffset&&!a.timezone))||this.timezoneOffset?(this.get=function(a,d){var e=d.getTime(),g=e-y.getTimezoneOffset(d);d.setTime(g);a=d["getUTC"+a]();d.setTime(e);return a},
this.set=function(a,d,e){var g;if("Milliseconds"===a||"Seconds"===a||"Minutes"===a&&0===d.getTimezoneOffset()%60)d["set"+a](e);else g=y.getTimezoneOffset(d),g=d.getTime()-g,d.setTime(g),d["setUTC"+a](e),a=y.getTimezoneOffset(d),g=d.getTime()+a,d.setTime(g)}):f?(this.get=function(a,d){return d["getUTC"+a]()},this.set=function(a,d,e){return d["setUTC"+a](e)}):(this.get=function(a,d){return d["get"+a]()},this.set=function(a,d,e){return d["set"+a](e)})},makeTime:function(f,r,y,p,d,e){var g,m,b;this.useUTC?
(g=this.Date.UTC.apply(0,arguments),m=this.getTimezoneOffset(g),g+=m,b=this.getTimezoneOffset(g),m!==b?g+=b-m:m-36E5!==this.getTimezoneOffset(g-36E5)||a.isSafari||(g-=36E5)):g=(new this.Date(f,r,l(y,1),l(p,0),l(d,0),l(e,0))).getTime();return g},timezoneOffsetFunction:function(){var f=this,r=this.options,l=u.moment;if(!this.useUTC)return function(a){return 6E4*(new Date(a)).getTimezoneOffset()};if(r.timezone){if(l)return function(a){return 6E4*-l.tz(a,r.timezone).utcOffset()};a.error(25)}return this.useUTC&&
r.getTimezoneOffset?function(a){return 6E4*r.getTimezoneOffset(a)}:function(){return 6E4*(f.timezoneOffset||0)}},dateFormat:function(f,l,y){if(!a.defined(l)||isNaN(l))return a.defaultOptions.lang.invalidDate||"";f=a.pick(f,"%Y-%m-%d %H:%M:%S");var p=this,d=new this.Date(l),e=this.get("Hours",d),g=this.get("Day",d),m=this.get("Date",d),b=this.get("Month",d),c=this.get("FullYear",d),x=a.defaultOptions.lang,B=x.weekdays,t=x.shortWeekdays,n=a.pad,d=a.extend({a:t?t[g]:B[g].substr(0,3),A:B[g],d:n(m),e:n(m,
2," "),w:g,b:x.shortMonths[b],B:x.months[b],m:n(b+1),o:b+1,y:c.toString().substr(2,2),Y:c,H:n(e),k:e,I:n(e%12||12),l:e%12||12,M:n(p.get("Minutes",d)),p:12>e?"AM":"PM",P:12>e?"am":"pm",S:n(d.getSeconds()),L:n(Math.floor(l%1E3),3)},a.dateFormats);a.objectEach(d,function(a,b){for(;-1!==f.indexOf("%"+b);)f=f.replace("%"+b,"function"===typeof a?a.call(p,l):a)});return y?f.substr(0,1).toUpperCase()+f.substr(1):f},getTimeTicks:function(a,r,y,p){var d=this,e=[],g,m={},b;g=new d.Date(r);var c=a.unitRange,
x=a.count||1,B;p=l(p,1);if(E(r)){d.set("Milliseconds",g,c>=f.second?0:x*Math.floor(d.get("Milliseconds",g)/x));c>=f.second&&d.set("Seconds",g,c>=f.minute?0:x*Math.floor(d.get("Seconds",g)/x));c>=f.minute&&d.set("Minutes",g,c>=f.hour?0:x*Math.floor(d.get("Minutes",g)/x));c>=f.hour&&d.set("Hours",g,c>=f.day?0:x*Math.floor(d.get("Hours",g)/x));c>=f.day&&d.set("Date",g,c>=f.month?1:x*Math.floor(d.get("Date",g)/x));c>=f.month&&(d.set("Month",g,c>=f.year?0:x*Math.floor(d.get("Month",g)/x)),b=d.get("FullYear",
g));c>=f.year&&d.set("FullYear",g,b-b%x);c===f.week&&(b=d.get("Day",g),d.set("Date",g,d.get("Date",g)-b+p+(b<p?-7:0)));b=d.get("FullYear",g);p=d.get("Month",g);var t=d.get("Date",g),n=d.get("Hours",g);r=g.getTime();d.variableTimezone&&(B=y-r>4*f.month||d.getTimezoneOffset(r)!==d.getTimezoneOffset(y));r=g.getTime();for(g=1;r<y;)e.push(r),r=c===f.year?d.makeTime(b+g*x,0):c===f.month?d.makeTime(b,p+g*x):!B||c!==f.day&&c!==f.week?B&&c===f.hour&&1<x?d.makeTime(b,p,t,n+g*x):r+c*x:d.makeTime(b,p,t+g*x*(c===
f.day?1:7)),g++;e.push(r);c<=f.hour&&1E4>e.length&&F(e,function(a){0===a%18E5&&"000000000"===d.dateFormat("%H%M%S%L",a)&&(m[a]="day")})}e.info=G(a,{higherRanks:m,totalRange:c*x});return e}}})(J);(function(a){var E=a.color,F=a.merge;a.defaultOptions={colors:"#7cb5ec #434348 #90ed7d #f7a35c #8085e9 #f15c80 #e4d354 #2b908f #f45b5b #91e8e1".split(" "),symbols:["circle","diamond","square","triangle","triangle-down"],lang:{loading:"Loading...",months:"January February March April May June July August September October November December".split(" "),
shortMonths:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),weekdays:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),decimalPoint:".",numericSymbols:"kMGTPE".split(""),resetZoom:"Reset zoom",resetZoomTitle:"Reset zoom level 1:1",thousandsSep:" "},global:{},time:a.Time.prototype.defaultOptions,chart:{borderRadius:0,defaultSeriesType:"line",ignoreHiddenSeries:!0,spacing:[10,10,15,10],resetZoomButton:{theme:{zIndex:6},position:{align:"right",x:-10,y:10}},width:null,
height:null,borderColor:"#335cad",backgroundColor:"#ffffff",plotBorderColor:"#cccccc"},title:{text:"Chart title",align:"center",margin:15,widthAdjust:-44},subtitle:{text:"",align:"center",widthAdjust:-44},plotOptions:{},labels:{style:{position:"absolute",color:"#333333"}},legend:{enabled:!0,align:"center",alignColumns:!0,layout:"horizontal",labelFormatter:function(){return this.name},borderColor:"#999999",borderRadius:0,navigation:{activeColor:"#003399",inactiveColor:"#cccccc"},itemStyle:{color:"#333333",
fontSize:"12px",fontWeight:"bold",textOverflow:"ellipsis"},itemHoverStyle:{color:"#000000"},itemHiddenStyle:{color:"#cccccc"},shadow:!1,itemCheckboxStyle:{position:"absolute",width:"13px",height:"13px"},squareSymbol:!0,symbolPadding:5,verticalAlign:"bottom",x:0,y:0,title:{style:{fontWeight:"bold"}}},loading:{labelStyle:{fontWeight:"bold",position:"relative",top:"45%"},style:{position:"absolute",backgroundColor:"#ffffff",opacity:.5,textAlign:"center"}},tooltip:{enabled:!0,animation:a.svg,borderRadius:3,
dateTimeLabelFormats:{millisecond:"%A, %b %e, %H:%M:%S.%L",second:"%A, %b %e, %H:%M:%S",minute:"%A, %b %e, %H:%M",hour:"%A, %b %e, %H:%M",day:"%A, %b %e, %Y",week:"Week from %A, %b %e, %Y",month:"%B %Y",year:"%Y"},footerFormat:"",padding:8,snap:a.isTouchDevice?25:10,backgroundColor:E("#f7f7f7").setOpacity(.85).get(),borderWidth:1,headerFormat:'\x3cspan style\x3d"font-size: 10px"\x3e{point.key}\x3c/span\x3e\x3cbr/\x3e',pointFormat:'\x3cspan style\x3d"color:{point.color}"\x3e\u25cf\x3c/span\x3e {series.name}: \x3cb\x3e{point.y}\x3c/b\x3e\x3cbr/\x3e',
shadow:!0,style:{color:"#333333",cursor:"default",fontSize:"12px",pointerEvents:"none",whiteSpace:"nowrap"}},credits:{enabled:!0,href:"https://www.highcharts.com",position:{align:"right",x:-10,verticalAlign:"bottom",y:-5},style:{cursor:"pointer",color:"#999999",fontSize:"9px"},text:"Highcharts.com"}};a.setOptions=function(E){a.defaultOptions=F(!0,a.defaultOptions,E);a.time.update(F(a.defaultOptions.global,a.defaultOptions.time),!1);return a.defaultOptions};a.getOptions=function(){return a.defaultOptions};
a.defaultPlotOptions=a.defaultOptions.plotOptions;a.time=new a.Time(F(a.defaultOptions.global,a.defaultOptions.time));a.dateFormat=function(F,q,l){return a.time.dateFormat(F,q,l)}})(J);(function(a){var E=a.correctFloat,F=a.defined,G=a.destroyObjectProperties,q=a.fireEvent,l=a.isNumber,f=a.merge,u=a.pick,C=a.deg2rad;a.Tick=function(a,f,p,d){this.axis=a;this.pos=f;this.type=p||"";this.isNewLabel=this.isNew=!0;p||d||this.addLabel()};a.Tick.prototype={addLabel:function(){var a=this.axis,l=a.options,p=
a.chart,d=a.categories,e=a.names,g=this.pos,m=l.labels,b=a.tickPositions,c=g===b[0],x=g===b[b.length-1],e=d?u(d[g],e[g],g):g,d=this.label,b=b.info,B;a.isDatetimeAxis&&b&&(B=l.dateTimeLabelFormats[b.higherRanks[g]||b.unitName]);this.isFirst=c;this.isLast=x;l={axis:a,chart:p,isFirst:c,isLast:x,dateTimeLabelFormat:B,value:a.isLog?E(a.lin2log(e)):e,pos:g};l=a.labelFormatter.call(l,l);if(F(d))d&&d.textStr!==l&&(!d.textWidth||m.style&&m.style.width||d.styles.width||d.css({width:null}),d.attr({text:l}));
else{if(this.label=d=F(l)&&m.enabled?p.renderer.text(l,0,0,m.useHTML).css(f(m.style)).add(a.labelGroup):null)d.textPxLength=d.getBBox().width;this.rotation=0}},getLabelSize:function(){return this.label?this.label.getBBox()[this.axis.horiz?"height":"width"]:0},handleOverflow:function(a){var f=this.axis,p=f.options.labels,d=a.x,e=f.chart.chartWidth,g=f.chart.spacing,m=u(f.labelLeft,Math.min(f.pos,g[3])),g=u(f.labelRight,Math.max(f.isRadial?0:f.pos+f.len,e-g[1])),b=this.label,c=this.rotation,x={left:0,
center:.5,right:1}[f.labelAlign||b.attr("align")],B=b.getBBox().width,t=f.getSlotWidth(this),n=t,l=1,z,D={};if(c||"justify"!==u(p.overflow,"justify"))0>c&&d-x*B<m?z=Math.round(d/Math.cos(c*C)-m):0<c&&d+x*B>g&&(z=Math.round((e-d)/Math.cos(c*C)));else if(e=d+(1-x)*B,d-x*B<m?n=a.x+n*(1-x)-m:e>g&&(n=g-a.x+n*x,l=-1),n=Math.min(t,n),n<t&&"center"===f.labelAlign&&(a.x+=l*(t-n-x*(t-Math.min(B,n)))),B>n||f.autoRotation&&(b.styles||{}).width)z=n;z&&(D.width=z,(p.style||{}).textOverflow||(D.textOverflow="ellipsis"),
b.css(D))},getPosition:function(f,l,p,d){var e=this.axis,g=e.chart,m=d&&g.oldChartHeight||g.chartHeight;f={x:f?a.correctFloat(e.translate(l+p,null,null,d)+e.transB):e.left+e.offset+(e.opposite?(d&&g.oldChartWidth||g.chartWidth)-e.right-e.left:0),y:f?m-e.bottom+e.offset-(e.opposite?e.height:0):a.correctFloat(m-e.translate(l+p,null,null,d)-e.transB)};q(this,"afterGetPosition",{pos:f});return f},getLabelPosition:function(a,f,p,d,e,g,m,b){var c=this.axis,x=c.transA,B=c.reversed,t=c.staggerLines,n=c.tickRotCorr||
{x:0,y:0},l=e.y,z=d||c.reserveSpaceDefault?0:-c.labelOffset*("center"===c.labelAlign?.5:1),D={};F(l)||(l=0===c.side?p.rotation?-8:-p.getBBox().height:2===c.side?n.y+8:Math.cos(p.rotation*C)*(n.y-p.getBBox(!1,0).height/2));a=a+e.x+z+n.x-(g&&d?g*x*(B?-1:1):0);f=f+l-(g&&!d?g*x*(B?1:-1):0);t&&(p=m/(b||1)%t,c.opposite&&(p=t-p-1),f+=c.labelOffset/t*p);D.x=a;D.y=Math.round(f);q(this,"afterGetLabelPosition",{pos:D});return D},getMarkPath:function(a,f,p,d,e,g){return g.crispLine(["M",a,f,"L",a+(e?0:-p),f+
(e?p:0)],d)},renderGridLine:function(a,f,p){var d=this.axis,e=d.options,g=this.gridLine,m={},b=this.pos,c=this.type,x=d.tickmarkOffset,B=d.chart.renderer,t=c?c+"Grid":"grid",n=e[t+"LineWidth"],l=e[t+"LineColor"],e=e[t+"LineDashStyle"];g||(m.stroke=l,m["stroke-width"]=n,e&&(m.dashstyle=e),c||(m.zIndex=1),a&&(m.opacity=0),this.gridLine=g=B.path().attr(m).addClass("highcharts-"+(c?c+"-":"")+"grid-line").add(d.gridGroup));if(!a&&g&&(a=d.getPlotLinePath(b+x,g.strokeWidth()*p,a,!0)))g[this.isNew?"attr":
"animate"]({d:a,opacity:f})},renderMark:function(a,f,p){var d=this.axis,e=d.options,g=d.chart.renderer,m=this.type,b=m?m+"Tick":"tick",c=d.tickSize(b),x=this.mark,B=!x,t=a.x;a=a.y;var n=u(e[b+"Width"],!m&&d.isXAxis?1:0),e=e[b+"Color"];c&&(d.opposite&&(c[0]=-c[0]),B&&(this.mark=x=g.path().addClass("highcharts-"+(m?m+"-":"")+"tick").add(d.axisGroup),x.attr({stroke:e,"stroke-width":n})),x[B?"attr":"animate"]({d:this.getMarkPath(t,a,c[0],x.strokeWidth()*p,d.horiz,g),opacity:f}))},renderLabel:function(a,
f,p,d){var e=this.axis,g=e.horiz,m=e.options,b=this.label,c=m.labels,x=c.step,e=e.tickmarkOffset,B=!0,t=a.x;a=a.y;b&&l(t)&&(b.xy=a=this.getLabelPosition(t,a,b,g,c,e,d,x),this.isFirst&&!this.isLast&&!u(m.showFirstLabel,1)||this.isLast&&!this.isFirst&&!u(m.showLastLabel,1)?B=!1:!g||c.step||c.rotation||f||0===p||this.handleOverflow(a),x&&d%x&&(B=!1),B&&l(a.y)?(a.opacity=p,b[this.isNewLabel?"attr":"animate"](a),this.isNewLabel=!1):(b.attr("y",-9999),this.isNewLabel=!0))},render:function(f,l,p){var d=
this.axis,e=d.horiz,g=this.getPosition(e,this.pos,d.tickmarkOffset,l),m=g.x,b=g.y,d=e&&m===d.pos+d.len||!e&&b===d.pos?-1:1;p=u(p,1);this.isActive=!0;this.renderGridLine(l,p,d);this.renderMark(g,p,d);this.renderLabel(g,l,p,f);this.isNew=!1;a.fireEvent(this,"afterRender")},destroy:function(){G(this,this.axis)}}})(J);var ea=function(a){var E=a.addEvent,F=a.animObject,G=a.arrayMax,q=a.arrayMin,l=a.color,f=a.correctFloat,u=a.defaultOptions,C=a.defined,r=a.deg2rad,y=a.destroyObjectProperties,p=a.each,d=
a.extend,e=a.fireEvent,g=a.format,m=a.getMagnitude,b=a.grep,c=a.inArray,x=a.isArray,B=a.isNumber,t=a.isString,n=a.merge,L=a.normalizeTickInterval,z=a.objectEach,D=a.pick,h=a.removeEvent,I=a.splat,H=a.syncTimeout,v=a.Tick,w=function(){this.init.apply(this,arguments)};a.extend(w.prototype,{defaultOptions:{dateTimeLabelFormats:{millisecond:"%H:%M:%S.%L",second:"%H:%M:%S",minute:"%H:%M",hour:"%H:%M",day:"%e. %b",week:"%e. %b",month:"%b '%y",year:"%Y"},endOnTick:!1,labels:{enabled:!0,x:0,style:{color:"#666666",
cursor:"default",fontSize:"11px"}},maxPadding:.01,minorTickLength:2,minorTickPosition:"outside",minPadding:.01,startOfWeek:1,startOnTick:!1,tickLength:10,tickPixelInterval:100,tickmarkPlacement:"between",tickPosition:"outside",title:{align:"middle",style:{color:"#666666"}},type:"linear",minorGridLineColor:"#f2f2f2",minorGridLineWidth:1,minorTickColor:"#999999",lineColor:"#ccd6eb",lineWidth:1,gridLineColor:"#e6e6e6",tickColor:"#ccd6eb"},defaultYAxisOptions:{endOnTick:!0,maxPadding:.05,minPadding:.05,
tickPixelInterval:72,showLastLabel:!0,labels:{x:-8},startOnTick:!0,title:{rotation:270,text:"Values"},stackLabels:{allowOverlap:!1,enabled:!1,formatter:function(){return a.numberFormat(this.total,-1)},style:{color:"#000000",fontSize:"11px",fontWeight:"bold",textOutline:"1px contrast"}},gridLineWidth:1,lineWidth:0},defaultLeftAxisOptions:{labels:{x:-15},title:{rotation:270}},defaultRightAxisOptions:{labels:{x:15},title:{rotation:90}},defaultBottomAxisOptions:{labels:{autoRotation:[-45],x:0},title:{rotation:0}},
defaultTopAxisOptions:{labels:{autoRotation:[-45],x:0},title:{rotation:0}},init:function(a,b){var k=b.isX,A=this;A.chart=a;A.horiz=a.inverted&&!A.isZAxis?!k:k;A.isXAxis=k;A.coll=A.coll||(k?"xAxis":"yAxis");e(this,"init",{userOptions:b});A.opposite=b.opposite;A.side=b.side||(A.horiz?A.opposite?0:2:A.opposite?1:3);A.setOptions(b);var d=this.options,h=d.type;A.labelFormatter=d.labels.formatter||A.defaultLabelFormatter;A.userOptions=b;A.minPixelPadding=0;A.reversed=d.reversed;A.visible=!1!==d.visible;
A.zoomEnabled=!1!==d.zoomEnabled;A.hasNames="category"===h||!0===d.categories;A.categories=d.categories||A.hasNames;A.names||(A.names=[],A.names.keys={});A.plotLinesAndBandsGroups={};A.isLog="logarithmic"===h;A.isDatetimeAxis="datetime"===h;A.positiveValuesOnly=A.isLog&&!A.allowNegativeLog;A.isLinked=C(d.linkedTo);A.ticks={};A.labelEdge=[];A.minorTicks={};A.plotLinesAndBands=[];A.alternateBands={};A.len=0;A.minRange=A.userMinRange=d.minRange||d.maxZoom;A.range=d.range;A.offset=d.offset||0;A.stacks=
{};A.oldStacks={};A.stacksTouched=0;A.max=null;A.min=null;A.crosshair=D(d.crosshair,I(a.options.tooltip.crosshairs)[k?0:1],!1);b=A.options.events;-1===c(A,a.axes)&&(k?a.axes.splice(a.xAxis.length,0,A):a.axes.push(A),a[A.coll].push(A));A.series=A.series||[];a.inverted&&!A.isZAxis&&k&&void 0===A.reversed&&(A.reversed=!0);z(b,function(a,b){E(A,b,a)});A.lin2log=d.linearToLogConverter||A.lin2log;A.isLog&&(A.val2lin=A.log2lin,A.lin2val=A.lin2log);e(this,"afterInit")},setOptions:function(a){this.options=
n(this.defaultOptions,"yAxis"===this.coll&&this.defaultYAxisOptions,[this.defaultTopAxisOptions,this.defaultRightAxisOptions,this.defaultBottomAxisOptions,this.defaultLeftAxisOptions][this.side],n(u[this.coll],a));e(this,"afterSetOptions",{userOptions:a})},defaultLabelFormatter:function(){var b=this.axis,c=this.value,d=b.chart.time,h=b.categories,v=this.dateTimeLabelFormat,m=u.lang,w=m.numericSymbols,m=m.numericSymbolMagnitude||1E3,e=w&&w.length,n,t=b.options.labels.format,b=b.isLog?Math.abs(c):b.tickInterval;
if(t)n=g(t,this,d);else if(h)n=c;else if(v)n=d.dateFormat(v,c);else if(e&&1E3<=b)for(;e--&&void 0===n;)d=Math.pow(m,e+1),b>=d&&0===10*c%d&&null!==w[e]&&0!==c&&(n=a.numberFormat(c/d,-1)+w[e]);void 0===n&&(n=1E4<=Math.abs(c)?a.numberFormat(c,-1):a.numberFormat(c,-1,void 0,""));return n},getSeriesExtremes:function(){var a=this,c=a.chart;e(this,"getSeriesExtremes",null,function(){a.hasVisibleSeries=!1;a.dataMin=a.dataMax=a.threshold=null;a.softThreshold=!a.isXAxis;a.buildStacks&&a.buildStacks();p(a.series,
function(k){if(k.visible||!c.options.chart.ignoreHiddenSeries){var A=k.options,d=A.threshold,h;a.hasVisibleSeries=!0;a.positiveValuesOnly&&0>=d&&(d=null);if(a.isXAxis)A=k.xData,A.length&&(k=q(A),h=G(A),B(k)||k instanceof Date||(A=b(A,B),k=q(A),h=G(A)),A.length&&(a.dataMin=Math.min(D(a.dataMin,A[0],k),k),a.dataMax=Math.max(D(a.dataMax,A[0],h),h)));else if(k.getExtremes(),h=k.dataMax,k=k.dataMin,C(k)&&C(h)&&(a.dataMin=Math.min(D(a.dataMin,k),k),a.dataMax=Math.max(D(a.dataMax,h),h)),C(d)&&(a.threshold=
d),!A.softThreshold||a.positiveValuesOnly)a.softThreshold=!1}})});e(this,"afterGetSeriesExtremes")},translate:function(a,b,c,d,h,v){var k=this.linkedParent||this,A=1,m=0,w=d?k.oldTransA:k.transA;d=d?k.oldMin:k.min;var n=k.minPixelPadding;h=(k.isOrdinal||k.isBroken||k.isLog&&h)&&k.lin2val;w||(w=k.transA);c&&(A*=-1,m=k.len);k.reversed&&(A*=-1,m-=A*(k.sector||k.len));b?(a=(a*A+m-n)/w+d,h&&(a=k.lin2val(a))):(h&&(a=k.val2lin(a)),a=B(d)?A*(a-d)*w+m+A*n+(B(v)?w*v:0):void 0);return a},toPixels:function(a,
b){return this.translate(a,!1,!this.horiz,null,!0)+(b?0:this.pos)},toValue:function(a,b){return this.translate(a-(b?0:this.pos),!0,!this.horiz,null,!0)},getPlotLinePath:function(a,b,c,d,h){var k=this.chart,A=this.left,v=this.top,m,w,n=c&&k.oldChartHeight||k.chartHeight,e=c&&k.oldChartWidth||k.chartWidth,K;m=this.transB;var t=function(a,b,k){if(a<b||a>k)d?a=Math.min(Math.max(b,a),k):K=!0;return a};h=D(h,this.translate(a,null,null,c));h=Math.min(Math.max(-1E5,h),1E5);a=c=Math.round(h+m);m=w=Math.round(n-
h-m);B(h)?this.horiz?(m=v,w=n-this.bottom,a=c=t(a,A,A+this.width)):(a=A,c=e-this.right,m=w=t(m,v,v+this.height)):(K=!0,d=!1);return K&&!d?null:k.renderer.crispLine(["M",a,m,"L",c,w],b||1)},getLinearTickPositions:function(a,b,c){var k,A=f(Math.floor(b/a)*a);c=f(Math.ceil(c/a)*a);var d=[],h;f(A+a)===A&&(h=20);if(this.single)return[b];for(b=A;b<=c;){d.push(b);b=f(b+a,h);if(b===k)break;k=b}return d},getMinorTickInterval:function(){var a=this.options;return!0===a.minorTicks?D(a.minorTickInterval,"auto"):
!1===a.minorTicks?null:a.minorTickInterval},getMinorTickPositions:function(){var a=this,b=a.options,c=a.tickPositions,d=a.minorTickInterval,h=[],v=a.pointRangePadding||0,m=a.min-v,v=a.max+v,w=v-m;if(w&&w/d<a.len/3)if(a.isLog)p(this.paddedTicks,function(b,k,c){k&&h.push.apply(h,a.getLogTickPositions(d,c[k-1],c[k],!0))});else if(a.isDatetimeAxis&&"auto"===this.getMinorTickInterval())h=h.concat(a.getTimeTicks(a.normalizeTimeTickInterval(d),m,v,b.startOfWeek));else for(b=m+(c[0]-m)%d;b<=v&&b!==h[0];b+=
d)h.push(b);0!==h.length&&a.trimTicks(h);return h},adjustForMinRange:function(){var a=this.options,b=this.min,c=this.max,d,h,v,m,w,n,e,t;this.isXAxis&&void 0===this.minRange&&!this.isLog&&(C(a.min)||C(a.max)?this.minRange=null:(p(this.series,function(a){n=a.xData;for(m=e=a.xIncrement?1:n.length-1;0<m;m--)if(w=n[m]-n[m-1],void 0===v||w<v)v=w}),this.minRange=Math.min(5*v,this.dataMax-this.dataMin)));c-b<this.minRange&&(h=this.dataMax-this.dataMin>=this.minRange,t=this.minRange,d=(t-c+b)/2,d=[b-d,D(a.min,
b-d)],h&&(d[2]=this.isLog?this.log2lin(this.dataMin):this.dataMin),b=G(d),c=[b+t,D(a.max,b+t)],h&&(c[2]=this.isLog?this.log2lin(this.dataMax):this.dataMax),c=q(c),c-b<t&&(d[0]=c-t,d[1]=D(a.min,c-t),b=G(d)));this.min=b;this.max=c},getClosest:function(){var a;this.categories?a=1:p(this.series,function(b){var c=b.closestPointRange,k=b.visible||!b.chart.options.chart.ignoreHiddenSeries;!b.noSharedTooltip&&C(c)&&k&&(a=C(a)?Math.min(a,c):c)});return a},nameToX:function(a){var b=x(this.categories),k=b?this.categories:
this.names,d=a.options.x,h;a.series.requireSorting=!1;C(d)||(d=!1===this.options.uniqueNames?a.series.autoIncrement():b?c(a.name,k):D(k.keys[a.name],-1));-1===d?b||(h=k.length):h=d;void 0!==h&&(this.names[h]=a.name,this.names.keys[a.name]=h);return h},updateNames:function(){var b=this,c=this.names;0<c.length&&(p(a.keys(c.keys),function(a){delete c.keys[a]}),c.length=0,this.minRange=this.userMinRange,p(this.series||[],function(a){a.xIncrement=null;if(!a.points||a.isDirtyData)a.processData(),a.generatePoints();
p(a.points,function(c,k){var d;c.options&&(d=b.nameToX(c),void 0!==d&&d!==c.x&&(c.x=d,a.xData[k]=d))})}))},setAxisTranslation:function(a){var b=this,c=b.max-b.min,k=b.axisPointRange||0,d,h=0,v=0,m=b.linkedParent,w=!!b.categories,n=b.transA,g=b.isXAxis;if(g||w||k)d=b.getClosest(),m?(h=m.minPointOffset,v=m.pointRangePadding):p(b.series,function(a){var c=w?1:g?D(a.options.pointRange,d,0):b.axisPointRange||0;a=a.options.pointPlacement;k=Math.max(k,c);b.single||(h=Math.max(h,t(a)?0:c/2),v=Math.max(v,"on"===
a?0:c))}),m=b.ordinalSlope&&d?b.ordinalSlope/d:1,b.minPointOffset=h*=m,b.pointRangePadding=v*=m,b.pointRange=Math.min(k,c),g&&(b.closestPointRange=d);a&&(b.oldTransA=n);b.translationSlope=b.transA=n=b.options.staticScale||b.len/(c+v||1);b.transB=b.horiz?b.left:b.bottom;b.minPixelPadding=n*h;e(this,"afterSetAxisTranslation")},minFromRange:function(){return this.max-this.range},setTickInterval:function(b){var c=this,k=c.chart,d=c.options,h=c.isLog,v=c.isDatetimeAxis,w=c.isXAxis,n=c.isLinked,t=d.maxPadding,
g=d.minPadding,x=d.tickInterval,z=d.tickPixelInterval,H=c.categories,I=B(c.threshold)?c.threshold:null,l=c.softThreshold,r,y,u,q;v||H||n||this.getTickAmount();u=D(c.userMin,d.min);q=D(c.userMax,d.max);n?(c.linkedParent=k[c.coll][d.linkedTo],k=c.linkedParent.getExtremes(),c.min=D(k.min,k.dataMin),c.max=D(k.max,k.dataMax),d.type!==c.linkedParent.options.type&&a.error(11,1)):(!l&&C(I)&&(c.dataMin>=I?(r=I,g=0):c.dataMax<=I&&(y=I,t=0)),c.min=D(u,r,c.dataMin),c.max=D(q,y,c.dataMax));h&&(c.positiveValuesOnly&&
!b&&0>=Math.min(c.min,D(c.dataMin,c.min))&&a.error(10,1),c.min=f(c.log2lin(c.min),15),c.max=f(c.log2lin(c.max),15));c.range&&C(c.max)&&(c.userMin=c.min=u=Math.max(c.dataMin,c.minFromRange()),c.userMax=q=c.max,c.range=null);e(c,"foundExtremes");c.beforePadding&&c.beforePadding();c.adjustForMinRange();!(H||c.axisPointRange||c.usePercentage||n)&&C(c.min)&&C(c.max)&&(k=c.max-c.min)&&(!C(u)&&g&&(c.min-=k*g),!C(q)&&t&&(c.max+=k*t));B(d.softMin)&&!B(c.userMin)&&(c.min=Math.min(c.min,d.softMin));B(d.softMax)&&
!B(c.userMax)&&(c.max=Math.max(c.max,d.softMax));B(d.floor)&&(c.min=Math.max(c.min,d.floor));B(d.ceiling)&&(c.max=Math.min(c.max,d.ceiling));l&&C(c.dataMin)&&(I=I||0,!C(u)&&c.min<I&&c.dataMin>=I?c.min=I:!C(q)&&c.max>I&&c.dataMax<=I&&(c.max=I));c.tickInterval=c.min===c.max||void 0===c.min||void 0===c.max?1:n&&!x&&z===c.linkedParent.options.tickPixelInterval?x=c.linkedParent.tickInterval:D(x,this.tickAmount?(c.max-c.min)/Math.max(this.tickAmount-1,1):void 0,H?1:(c.max-c.min)*z/Math.max(c.len,z));w&&
!b&&p(c.series,function(a){a.processData(c.min!==c.oldMin||c.max!==c.oldMax)});c.setAxisTranslation(!0);c.beforeSetTickPositions&&c.beforeSetTickPositions();c.postProcessTickInterval&&(c.tickInterval=c.postProcessTickInterval(c.tickInterval));c.pointRange&&!x&&(c.tickInterval=Math.max(c.pointRange,c.tickInterval));b=D(d.minTickInterval,c.isDatetimeAxis&&c.closestPointRange);!x&&c.tickInterval<b&&(c.tickInterval=b);v||h||x||(c.tickInterval=L(c.tickInterval,null,m(c.tickInterval),D(d.allowDecimals,
!(.5<c.tickInterval&&5>c.tickInterval&&1E3<c.max&&9999>c.max)),!!this.tickAmount));this.tickAmount||(c.tickInterval=c.unsquish());this.setTickPositions()},setTickPositions:function(){var b=this.options,c,d=b.tickPositions;c=this.getMinorTickInterval();var h=b.tickPositioner,v=b.startOnTick,m=b.endOnTick;this.tickmarkOffset=this.categories&&"between"===b.tickmarkPlacement&&1===this.tickInterval?.5:0;this.minorTickInterval="auto"===c&&this.tickInterval?this.tickInterval/5:c;this.single=this.min===this.max&&
C(this.min)&&!this.tickAmount&&(parseInt(this.min,10)===this.min||!1!==b.allowDecimals);this.tickPositions=c=d&&d.slice();!c&&(!this.ordinalPositions&&(this.max-this.min)/this.tickInterval>Math.max(2*this.len,200)?(c=[this.min,this.max],a.error(19)):c=this.isDatetimeAxis?this.getTimeTicks(this.normalizeTimeTickInterval(this.tickInterval,b.units),this.min,this.max,b.startOfWeek,this.ordinalPositions,this.closestPointRange,!0):this.isLog?this.getLogTickPositions(this.tickInterval,this.min,this.max):
this.getLinearTickPositions(this.tickInterval,this.min,this.max),c.length>this.len&&(c=[c[0],c.pop()],c[0]===c[1]&&(c.length=1)),this.tickPositions=c,h&&(h=h.apply(this,[this.min,this.max])))&&(this.tickPositions=c=h);this.paddedTicks=c.slice(0);this.trimTicks(c,v,m);this.isLinked||(this.single&&2>c.length&&(this.min-=.5,this.max+=.5),d||h||this.adjustTickAmount());e(this,"afterSetTickPositions")},trimTicks:function(a,b,c){var k=a[0],d=a[a.length-1],h=this.minPointOffset||0;if(!this.isLinked){if(b&&
-Infinity!==k)this.min=k;else for(;this.min-h>a[0];)a.shift();if(c)this.max=d;else for(;this.max+h<a[a.length-1];)a.pop();0===a.length&&C(k)&&!this.options.tickPositions&&a.push((d+k)/2)}},alignToOthers:function(){var a={},b,c=this.options;!1===this.chart.options.chart.alignTicks||!1===c.alignTicks||!1===c.startOnTick||!1===c.endOnTick||this.isLog||p(this.chart[this.coll],function(c){var k=c.options,k=[c.horiz?k.left:k.top,k.width,k.height,k.pane].join();c.series.length&&(a[k]?b=!0:a[k]=1)});return b},
getTickAmount:function(){var a=this.options,b=a.tickAmount,c=a.tickPixelInterval;!C(a.tickInterval)&&this.len<c&&!this.isRadial&&!this.isLog&&a.startOnTick&&a.endOnTick&&(b=2);!b&&this.alignToOthers()&&(b=Math.ceil(this.len/c)+1);4>b&&(this.finalTickAmt=b,b=5);this.tickAmount=b},adjustTickAmount:function(){var a=this.tickInterval,b=this.tickPositions,c=this.tickAmount,d=this.finalTickAmt,h=b&&b.length,v=D(this.threshold,this.softThreshold?0:null);if(this.hasData()){if(h<c){for(;b.length<c;)b.length%
2||this.min===v?b.push(f(b[b.length-1]+a)):b.unshift(f(b[0]-a));this.transA*=(h-1)/(c-1);this.min=b[0];this.max=b[b.length-1]}else h>c&&(this.tickInterval*=2,this.setTickPositions());if(C(d)){for(a=c=b.length;a--;)(3===d&&1===a%2||2>=d&&0<a&&a<c-1)&&b.splice(a,1);this.finalTickAmt=void 0}}},setScale:function(){var a,b;this.oldMin=this.min;this.oldMax=this.max;this.oldAxisLength=this.len;this.setAxisSize();b=this.len!==this.oldAxisLength;p(this.series,function(b){if(b.isDirtyData||b.isDirty||b.xAxis.isDirty)a=
!0});b||a||this.isLinked||this.forceRedraw||this.userMin!==this.oldUserMin||this.userMax!==this.oldUserMax||this.alignToOthers()?(this.resetStacks&&this.resetStacks(),this.forceRedraw=!1,this.getSeriesExtremes(),this.setTickInterval(),this.oldUserMin=this.userMin,this.oldUserMax=this.userMax,this.isDirty||(this.isDirty=b||this.min!==this.oldMin||this.max!==this.oldMax)):this.cleanStacks&&this.cleanStacks();e(this,"afterSetScale")},setExtremes:function(a,b,c,h,v){var k=this,m=k.chart;c=D(c,!0);p(k.series,
function(a){delete a.kdTree});v=d(v,{min:a,max:b});e(k,"setExtremes",v,function(){k.userMin=a;k.userMax=b;k.eventArgs=v;c&&m.redraw(h)})},zoom:function(a,b){var c=this.dataMin,k=this.dataMax,d=this.options,h=Math.min(c,D(d.min,c)),d=Math.max(k,D(d.max,k));if(a!==this.min||b!==this.max)this.allowZoomOutside||(C(c)&&(a<h&&(a=h),a>d&&(a=d)),C(k)&&(b<h&&(b=h),b>d&&(b=d))),this.displayBtn=void 0!==a||void 0!==b,this.setExtremes(a,b,!1,void 0,{trigger:"zoom"});return!0},setAxisSize:function(){var b=this.chart,
c=this.options,d=c.offsets||[0,0,0,0],h=this.horiz,v=this.width=Math.round(a.relativeLength(D(c.width,b.plotWidth-d[3]+d[1]),b.plotWidth)),m=this.height=Math.round(a.relativeLength(D(c.height,b.plotHeight-d[0]+d[2]),b.plotHeight)),w=this.top=Math.round(a.relativeLength(D(c.top,b.plotTop+d[0]),b.plotHeight,b.plotTop)),c=this.left=Math.round(a.relativeLength(D(c.left,b.plotLeft+d[3]),b.plotWidth,b.plotLeft));this.bottom=b.chartHeight-m-w;this.right=b.chartWidth-v-c;this.len=Math.max(h?v:m,0);this.pos=
h?c:w},getExtremes:function(){var a=this.isLog;return{min:a?f(this.lin2log(this.min)):this.min,max:a?f(this.lin2log(this.max)):this.max,dataMin:this.dataMin,dataMax:this.dataMax,userMin:this.userMin,userMax:this.userMax}},getThreshold:function(a){var b=this.isLog,c=b?this.lin2log(this.min):this.min,b=b?this.lin2log(this.max):this.max;null===a||-Infinity===a?a=c:Infinity===a?a=b:c>a?a=c:b<a&&(a=b);return this.translate(a,0,1,0,1)},autoLabelAlign:function(a){a=(D(a,0)-90*this.side+720)%360;return 15<
a&&165>a?"right":195<a&&345>a?"left":"center"},tickSize:function(a){var b=this.options,c=b[a+"Length"],k=D(b[a+"Width"],"tick"===a&&this.isXAxis?1:0);if(k&&c)return"inside"===b[a+"Position"]&&(c=-c),[c,k]},labelMetrics:function(){var a=this.tickPositions&&this.tickPositions[0]||0;return this.chart.renderer.fontMetrics(this.options.labels.style&&this.options.labels.style.fontSize,this.ticks[a]&&this.ticks[a].label)},unsquish:function(){var a=this.options.labels,b=this.horiz,c=this.tickInterval,d=c,
h=this.len/(((this.categories?1:0)+this.max-this.min)/c),v,m=a.rotation,w=this.labelMetrics(),n,e=Number.MAX_VALUE,t,g=function(a){a/=h||1;a=1<a?Math.ceil(a):1;return f(a*c)};b?(t=!a.staggerLines&&!a.step&&(C(m)?[m]:h<D(a.autoRotationLimit,80)&&a.autoRotation))&&p(t,function(a){var b;if(a===m||a&&-90<=a&&90>=a)n=g(Math.abs(w.h/Math.sin(r*a))),b=n+Math.abs(a/360),b<e&&(e=b,v=a,d=n)}):a.step||(d=g(w.h));this.autoRotation=t;this.labelRotation=D(v,m);return d},getSlotWidth:function(){var a=this.chart,
b=this.horiz,c=this.options.labels,d=Math.max(this.tickPositions.length-(this.categories?0:1),1),h=a.margin[3];return b&&2>(c.step||0)&&!c.rotation&&(this.staggerLines||1)*this.len/d||!b&&(c.style&&parseInt(c.style.width,10)||h&&h-a.spacing[3]||.33*a.chartWidth)},renderUnsquish:function(){var a=this.chart,b=a.renderer,c=this.tickPositions,d=this.ticks,h=this.options.labels,v=h&&h.style||{},m=this.horiz,w=this.getSlotWidth(),n=Math.max(1,Math.round(w-2*(h.padding||5))),e={},g=this.labelMetrics(),x=
h.style&&h.style.textOverflow,B,z,D=0,H;t(h.rotation)||(e.rotation=h.rotation||0);p(c,function(a){(a=d[a])&&a.label&&a.label.textPxLength>D&&(D=a.label.textPxLength)});this.maxLabelLength=D;if(this.autoRotation)D>n&&D>g.h?e.rotation=this.labelRotation:this.labelRotation=0;else if(w&&(B=n,!x))for(z="clip",n=c.length;!m&&n--;)if(H=c[n],H=d[H].label)H.styles&&"ellipsis"===H.styles.textOverflow?H.css({textOverflow:"clip"}):H.textPxLength>w&&H.css({width:w+"px"}),H.getBBox().height>this.len/c.length-(g.h-
g.f)&&(H.specificTextOverflow="ellipsis");e.rotation&&(B=D>.5*a.chartHeight?.33*a.chartHeight:D,x||(z="ellipsis"));if(this.labelAlign=h.align||this.autoLabelAlign(this.labelRotation))e.align=this.labelAlign;p(c,function(a){var b=(a=d[a])&&a.label,c=v.width,k={};b&&(b.attr(e),B&&!c&&"nowrap"!==v.whiteSpace&&(B<b.textPxLength||"SPAN"===b.element.tagName)?(k.width=B,x||(k.textOverflow=b.specificTextOverflow||z),b.css(k)):b.styles&&b.styles.width&&!k.width&&!c&&b.css({width:null}),delete b.specificTextOverflow,
a.rotation=e.rotation)});this.tickRotCorr=b.rotCorr(g.b,this.labelRotation||0,0!==this.side)},hasData:function(){return this.hasVisibleSeries||C(this.min)&&C(this.max)&&this.tickPositions&&0<this.tickPositions.length},addTitle:function(a){var b=this.chart.renderer,c=this.horiz,d=this.opposite,k=this.options.title,h;this.axisTitle||((h=k.textAlign)||(h=(c?{low:"left",middle:"center",high:"right"}:{low:d?"right":"left",middle:"center",high:d?"left":"right"})[k.align]),this.axisTitle=b.text(k.text,0,
0,k.useHTML).attr({zIndex:7,rotation:k.rotation||0,align:h}).addClass("highcharts-axis-title").css(n(k.style)).add(this.axisGroup),this.axisTitle.isNew=!0);k.style.width||this.isRadial||this.axisTitle.css({width:this.len});this.axisTitle[a?"show":"hide"](!0)},generateTick:function(a){var b=this.ticks;b[a]?b[a].addLabel():b[a]=new v(this,a)},getOffset:function(){var a=this,b=a.chart,c=b.renderer,d=a.options,h=a.tickPositions,v=a.ticks,m=a.horiz,w=a.side,n=b.inverted&&!a.isZAxis?[1,0,3,2][w]:w,t,g,
x=0,B,H=0,I=d.title,f=d.labels,l=0,L=b.axisOffset,b=b.clipOffset,r=[-1,1,1,-1][w],y=d.className,u=a.axisParent,q=this.tickSize("tick");t=a.hasData();a.showAxis=g=t||D(d.showEmpty,!0);a.staggerLines=a.horiz&&f.staggerLines;a.axisGroup||(a.gridGroup=c.g("grid").attr({zIndex:d.gridZIndex||1}).addClass("highcharts-"+this.coll.toLowerCase()+"-grid "+(y||"")).add(u),a.axisGroup=c.g("axis").attr({zIndex:d.zIndex||2}).addClass("highcharts-"+this.coll.toLowerCase()+" "+(y||"")).add(u),a.labelGroup=c.g("axis-labels").attr({zIndex:f.zIndex||
7}).addClass("highcharts-"+a.coll.toLowerCase()+"-labels "+(y||"")).add(u));t||a.isLinked?(p(h,function(b,c){a.generateTick(b,c)}),a.renderUnsquish(),a.reserveSpaceDefault=0===w||2===w||{1:"left",3:"right"}[w]===a.labelAlign,D(f.reserveSpace,"center"===a.labelAlign?!0:null,a.reserveSpaceDefault)&&p(h,function(a){l=Math.max(v[a].getLabelSize(),l)}),a.staggerLines&&(l*=a.staggerLines),a.labelOffset=l*(a.opposite?-1:1)):z(v,function(a,b){a.destroy();delete v[b]});I&&I.text&&!1!==I.enabled&&(a.addTitle(g),
g&&!1!==I.reserveSpace&&(a.titleOffset=x=a.axisTitle.getBBox()[m?"height":"width"],B=I.offset,H=C(B)?0:D(I.margin,m?5:10)));a.renderLine();a.offset=r*D(d.offset,L[w]);a.tickRotCorr=a.tickRotCorr||{x:0,y:0};c=0===w?-a.labelMetrics().h:2===w?a.tickRotCorr.y:0;H=Math.abs(l)+H;l&&(H=H-c+r*(m?D(f.y,a.tickRotCorr.y+8*r):f.x));a.axisTitleMargin=D(B,H);L[w]=Math.max(L[w],a.axisTitleMargin+x+r*a.offset,H,t&&h.length&&q?q[0]+r*a.offset:0);d=d.offset?0:2*Math.floor(a.axisLine.strokeWidth()/2);b[n]=Math.max(b[n],
d);e(this,"afterGetOffset")},getLinePath:function(a){var b=this.chart,c=this.opposite,d=this.offset,k=this.horiz,h=this.left+(c?this.width:0)+d,d=b.chartHeight-this.bottom-(c?this.height:0)+d;c&&(a*=-1);return b.renderer.crispLine(["M",k?this.left:h,k?d:this.top,"L",k?b.chartWidth-this.right:h,k?d:b.chartHeight-this.bottom],a)},renderLine:function(){this.axisLine||(this.axisLine=this.chart.renderer.path().addClass("highcharts-axis-line").add(this.axisGroup),this.axisLine.attr({stroke:this.options.lineColor,
"stroke-width":this.options.lineWidth,zIndex:7}))},getTitlePosition:function(){var a=this.horiz,b=this.left,c=this.top,d=this.len,h=this.options.title,v=a?b:c,m=this.opposite,w=this.offset,n=h.x||0,e=h.y||0,t=this.axisTitle,g=this.chart.renderer.fontMetrics(h.style&&h.style.fontSize,t),t=Math.max(t.getBBox(null,0).height-g.h-1,0),d={low:v+(a?0:d),middle:v+d/2,high:v+(a?d:0)}[h.align],b=(a?c+this.height:b)+(a?1:-1)*(m?-1:1)*this.axisTitleMargin+[-t,t,g.f,-t][this.side];return{x:a?d+n:b+(m?this.width:
0)+w+n,y:a?b+e-(m?this.height:0)+w:d+e}},renderMinorTick:function(a){var b=this.chart.hasRendered&&B(this.oldMin),c=this.minorTicks;c[a]||(c[a]=new v(this,a,"minor"));b&&c[a].isNew&&c[a].render(null,!0);c[a].render(null,!1,1)},renderTick:function(a,b){var c=this.isLinked,d=this.ticks,h=this.chart.hasRendered&&B(this.oldMin);if(!c||a>=this.min&&a<=this.max)d[a]||(d[a]=new v(this,a)),h&&d[a].isNew&&d[a].render(b,!0,.1),d[a].render(b)},render:function(){var b=this,c=b.chart,d=b.options,h=b.isLog,m=b.isLinked,
w=b.tickPositions,n=b.axisTitle,t=b.ticks,g=b.minorTicks,x=b.alternateBands,D=d.stackLabels,I=d.alternateGridColor,f=b.tickmarkOffset,l=b.axisLine,L=b.showAxis,r=F(c.renderer.globalAnimation),y,u;b.labelEdge.length=0;b.overlap=!1;p([t,g,x],function(a){z(a,function(a){a.isActive=!1})});if(b.hasData()||m)b.minorTickInterval&&!b.categories&&p(b.getMinorTickPositions(),function(a){b.renderMinorTick(a)}),w.length&&(p(w,function(a,c){b.renderTick(a,c)}),f&&(0===b.min||b.single)&&(t[-1]||(t[-1]=new v(b,
-1,null,!0)),t[-1].render(-1))),I&&p(w,function(d,k){u=void 0!==w[k+1]?w[k+1]+f:b.max-f;0===k%2&&d<b.max&&u<=b.max+(c.polar?-f:f)&&(x[d]||(x[d]=new a.PlotLineOrBand(b)),y=d+f,x[d].options={from:h?b.lin2log(y):y,to:h?b.lin2log(u):u,color:I},x[d].render(),x[d].isActive=!0)}),b._addedPlotLB||(p((d.plotLines||[]).concat(d.plotBands||[]),function(a){b.addPlotBandOrLine(a)}),b._addedPlotLB=!0);p([t,g,x],function(a){var b,d=[],h=r.duration;z(a,function(a,b){a.isActive||(a.render(b,!1,0),a.isActive=!1,d.push(b))});
H(function(){for(b=d.length;b--;)a[d[b]]&&!a[d[b]].isActive&&(a[d[b]].destroy(),delete a[d[b]])},a!==x&&c.hasRendered&&h?h:0)});l&&(l[l.isPlaced?"animate":"attr"]({d:this.getLinePath(l.strokeWidth())}),l.isPlaced=!0,l[L?"show":"hide"](!0));n&&L&&(d=b.getTitlePosition(),B(d.y)?(n[n.isNew?"attr":"animate"](d),n.isNew=!1):(n.attr("y",-9999),n.isNew=!0));D&&D.enabled&&b.renderStackTotals();b.isDirty=!1;e(this,"afterRender")},redraw:function(){this.visible&&(this.render(),p(this.plotLinesAndBands,function(a){a.render()}));
p(this.series,function(a){a.isDirty=!0})},keepProps:"extKey hcEvents names series userMax userMin".split(" "),destroy:function(a){var b=this,d=b.stacks,k=b.plotLinesAndBands,v;e(this,"destroy",{keepEvents:a});a||h(b);z(d,function(a,b){y(a);d[b]=null});p([b.ticks,b.minorTicks,b.alternateBands],function(a){y(a)});if(k)for(a=k.length;a--;)k[a].destroy();p("stackTotalGroup axisLine axisTitle axisGroup gridGroup labelGroup cross scrollbar".split(" "),function(a){b[a]&&(b[a]=b[a].destroy())});for(v in b.plotLinesAndBandsGroups)b.plotLinesAndBandsGroups[v]=
b.plotLinesAndBandsGroups[v].destroy();z(b,function(a,d){-1===c(d,b.keepProps)&&delete b[d]})},drawCrosshair:function(a,b){var c,d=this.crosshair,h=D(d.snap,!0),k,v=this.cross;e(this,"drawCrosshair",{e:a,point:b});a||(a=this.cross&&this.cross.e);if(this.crosshair&&!1!==(C(b)||!h)){h?C(b)&&(k=D(b.crosshairPos,this.isXAxis?b.plotX:this.len-b.plotY)):k=a&&(this.horiz?a.chartX-this.pos:this.len-a.chartY+this.pos);C(k)&&(c=this.getPlotLinePath(b&&(this.isXAxis?b.x:D(b.stackY,b.y)),null,null,null,k)||null);
if(!C(c)){this.hideCrosshair();return}h=this.categories&&!this.isRadial;v||(this.cross=v=this.chart.renderer.path().addClass("highcharts-crosshair highcharts-crosshair-"+(h?"category ":"thin ")+d.className).attr({zIndex:D(d.zIndex,2)}).add(),v.attr({stroke:d.color||(h?l("#ccd6eb").setOpacity(.25).get():"#cccccc"),"stroke-width":D(d.width,1)}).css({"pointer-events":"none"}),d.dashStyle&&v.attr({dashstyle:d.dashStyle}));v.show().attr({d:c});h&&!d.width&&v.attr({"stroke-width":this.transA});this.cross.e=
a}else this.hideCrosshair();e(this,"afterDrawCrosshair",{e:a,point:b})},hideCrosshair:function(){this.cross&&this.cross.hide()}});return a.Axis=w}(J);(function(a){var E=a.Axis,F=a.getMagnitude,G=a.normalizeTickInterval,q=a.timeUnits;E.prototype.getTimeTicks=function(){return this.chart.time.getTimeTicks.apply(this.chart.time,arguments)};E.prototype.normalizeTimeTickInterval=function(a,f){var l=f||[["millisecond",[1,2,5,10,20,25,50,100,200,500]],["second",[1,2,5,10,15,30]],["minute",[1,2,5,10,15,30]],
["hour",[1,2,3,4,6,8,12]],["day",[1,2]],["week",[1,2]],["month",[1,2,3,4,6]],["year",null]];f=l[l.length-1];var C=q[f[0]],r=f[1],y;for(y=0;y<l.length&&!(f=l[y],C=q[f[0]],r=f[1],l[y+1]&&a<=(C*r[r.length-1]+q[l[y+1][0]])/2);y++);C===q.year&&a<5*C&&(r=[1,2,5]);a=G(a/C,r,"year"===f[0]?Math.max(F(a/C),1):1);return{unitRange:C,count:a,unitName:f[0]}}})(J);(function(a){var E=a.Axis,F=a.getMagnitude,G=a.map,q=a.normalizeTickInterval,l=a.pick;E.prototype.getLogTickPositions=function(a,u,C,r){var f=this.options,
p=this.len,d=[];r||(this._minorAutoInterval=null);if(.5<=a)a=Math.round(a),d=this.getLinearTickPositions(a,u,C);else if(.08<=a)for(var p=Math.floor(u),e,g,m,b,c,f=.3<a?[1,2,4]:.15<a?[1,2,4,6,8]:[1,2,3,4,5,6,7,8,9];p<C+1&&!c;p++)for(g=f.length,e=0;e<g&&!c;e++)m=this.log2lin(this.lin2log(p)*f[e]),m>u&&(!r||b<=C)&&void 0!==b&&d.push(b),b>C&&(c=!0),b=m;else u=this.lin2log(u),C=this.lin2log(C),a=r?this.getMinorTickInterval():f.tickInterval,a=l("auto"===a?null:a,this._minorAutoInterval,f.tickPixelInterval/
(r?5:1)*(C-u)/((r?p/this.tickPositions.length:p)||1)),a=q(a,null,F(a)),d=G(this.getLinearTickPositions(a,u,C),this.log2lin),r||(this._minorAutoInterval=a/5);r||(this.tickInterval=a);return d};E.prototype.log2lin=function(a){return Math.log(a)/Math.LN10};E.prototype.lin2log=function(a){return Math.pow(10,a)}})(J);(function(a,E){var F=a.arrayMax,G=a.arrayMin,q=a.defined,l=a.destroyObjectProperties,f=a.each,u=a.erase,C=a.merge,r=a.pick;a.PlotLineOrBand=function(a,p){this.axis=a;p&&(this.options=p,this.id=
p.id)};a.PlotLineOrBand.prototype={render:function(){var f=this,p=f.axis,d=p.horiz,e=f.options,g=e.label,m=f.label,b=e.to,c=e.from,x=e.value,B=q(c)&&q(b),t=q(x),n=f.svgElem,l=!n,z=[],D=e.color,h=r(e.zIndex,0),I=e.events,z={"class":"highcharts-plot-"+(B?"band ":"line ")+(e.className||"")},H={},v=p.chart.renderer,w=B?"bands":"lines";p.isLog&&(c=p.log2lin(c),b=p.log2lin(b),x=p.log2lin(x));t?(z.stroke=D,z["stroke-width"]=e.width,e.dashStyle&&(z.dashstyle=e.dashStyle)):B&&(D&&(z.fill=D),e.borderWidth&&
(z.stroke=e.borderColor,z["stroke-width"]=e.borderWidth));H.zIndex=h;w+="-"+h;(D=p.plotLinesAndBandsGroups[w])||(p.plotLinesAndBandsGroups[w]=D=v.g("plot-"+w).attr(H).add());l&&(f.svgElem=n=v.path().attr(z).add(D));if(t)z=p.getPlotLinePath(x,n.strokeWidth());else if(B)z=p.getPlotBandPath(c,b,e);else return;l&&z&&z.length?(n.attr({d:z}),I&&a.objectEach(I,function(a,b){n.on(b,function(a){I[b].apply(f,[a])})})):n&&(z?(n.show(),n.animate({d:z})):(n.hide(),m&&(f.label=m=m.destroy())));g&&q(g.text)&&z&&
z.length&&0<p.width&&0<p.height&&!z.isFlat?(g=C({align:d&&B&&"center",x:d?!B&&4:10,verticalAlign:!d&&B&&"middle",y:d?B?16:10:B?6:-4,rotation:d&&!B&&90},g),this.renderLabel(g,z,B,h)):m&&m.hide();return f},renderLabel:function(a,p,d,e){var g=this.label,m=this.axis.chart.renderer;g||(g={align:a.textAlign||a.align,rotation:a.rotation,"class":"highcharts-plot-"+(d?"band":"line")+"-label "+(a.className||"")},g.zIndex=e,this.label=g=m.text(a.text,0,0,a.useHTML).attr(g).add(),g.css(a.style));e=p.xBounds||
[p[1],p[4],d?p[6]:p[1]];p=p.yBounds||[p[2],p[5],d?p[7]:p[2]];d=G(e);m=G(p);g.align(a,!1,{x:d,y:m,width:F(e)-d,height:F(p)-m});g.show()},destroy:function(){u(this.axis.plotLinesAndBands,this);delete this.axis;l(this)}};a.extend(E.prototype,{getPlotBandPath:function(a,p){var d=this.getPlotLinePath(p,null,null,!0),e=this.getPlotLinePath(a,null,null,!0),g=[],m=this.horiz,b=1,c;a=a<this.min&&p<this.min||a>this.max&&p>this.max;if(e&&d)for(a&&(c=e.toString()===d.toString(),b=0),a=0;a<e.length;a+=6)m&&d[a+
1]===e[a+1]?(d[a+1]+=b,d[a+4]+=b):m||d[a+2]!==e[a+2]||(d[a+2]+=b,d[a+5]+=b),g.push("M",e[a+1],e[a+2],"L",e[a+4],e[a+5],d[a+4],d[a+5],d[a+1],d[a+2],"z"),g.isFlat=c;return g},addPlotBand:function(a){return this.addPlotBandOrLine(a,"plotBands")},addPlotLine:function(a){return this.addPlotBandOrLine(a,"plotLines")},addPlotBandOrLine:function(f,p){var d=(new a.PlotLineOrBand(this,f)).render(),e=this.userOptions;d&&(p&&(e[p]=e[p]||[],e[p].push(f)),this.plotLinesAndBands.push(d));return d},removePlotBandOrLine:function(a){for(var p=
this.plotLinesAndBands,d=this.options,e=this.userOptions,g=p.length;g--;)p[g].id===a&&p[g].destroy();f([d.plotLines||[],e.plotLines||[],d.plotBands||[],e.plotBands||[]],function(d){for(g=d.length;g--;)d[g].id===a&&u(d,d[g])})},removePlotBand:function(a){this.removePlotBandOrLine(a)},removePlotLine:function(a){this.removePlotBandOrLine(a)}})})(J,ea);(function(a){var E=a.doc,F=a.each,G=a.extend,q=a.format,l=a.isNumber,f=a.map,u=a.merge,C=a.pick,r=a.splat,y=a.syncTimeout,p=a.timeUnits;a.Tooltip=function(){this.init.apply(this,
arguments)};a.Tooltip.prototype={init:function(a,e){this.chart=a;this.options=e;this.crosshairs=[];this.now={x:0,y:0};this.isHidden=!0;this.split=e.split&&!a.inverted;this.shared=e.shared||this.split;this.outside=e.outside&&!this.split},cleanSplit:function(a){F(this.chart.series,function(d){var e=d&&d.tt;e&&(!e.isActive||a?d.tt=e.destroy():e.isActive=!1)})},getLabel:function(){var d=this.chart.renderer,e=this.options,g;this.label||(this.outside&&(this.container=g=a.doc.createElement("div"),g.className=
"highcharts-tooltip-container",a.css(g,{position:"absolute",top:"1px",pointerEvents:e.style&&e.style.pointerEvents}),a.doc.body.appendChild(g),this.renderer=d=new a.Renderer(g,0,0)),this.split?this.label=d.g("tooltip"):(this.label=d.label("",0,0,e.shape||"callout",null,null,e.useHTML,null,"tooltip").attr({padding:e.padding,r:e.borderRadius}),this.label.attr({fill:e.backgroundColor,"stroke-width":e.borderWidth}).css(e.style).shadow(e.shadow)),this.outside&&(this.label.attr({x:this.distance,y:this.distance}),
this.label.xSetter=function(a){g.style.left=a+"px"},this.label.ySetter=function(a){g.style.top=a+"px"}),this.label.attr({zIndex:8}).add());return this.label},update:function(a){this.destroy();u(!0,this.chart.options.tooltip.userOptions,a);this.init(this.chart,u(!0,this.options,a))},destroy:function(){this.label&&(this.label=this.label.destroy());this.split&&this.tt&&(this.cleanSplit(this.chart,!0),this.tt=this.tt.destroy());this.renderer&&(this.renderer=this.renderer.destroy(),a.discardElement(this.container));
a.clearTimeout(this.hideTimer);a.clearTimeout(this.tooltipTimeout)},move:function(d,e,g,m){var b=this,c=b.now,x=!1!==b.options.animation&&!b.isHidden&&(1<Math.abs(d-c.x)||1<Math.abs(e-c.y)),B=b.followPointer||1<b.len;G(c,{x:x?(2*c.x+d)/3:d,y:x?(c.y+e)/2:e,anchorX:B?void 0:x?(2*c.anchorX+g)/3:g,anchorY:B?void 0:x?(c.anchorY+m)/2:m});b.getLabel().attr(c);x&&(a.clearTimeout(this.tooltipTimeout),this.tooltipTimeout=setTimeout(function(){b&&b.move(d,e,g,m)},32))},hide:function(d){var e=this;a.clearTimeout(this.hideTimer);
d=C(d,this.options.hideDelay,500);this.isHidden||(this.hideTimer=y(function(){e.getLabel()[d?"fadeOut":"hide"]();e.isHidden=!0},d))},getAnchor:function(a,e){var d=this.chart,m=d.pointer,b=d.inverted,c=d.plotTop,x=d.plotLeft,B=0,t=0,n,p;a=r(a);this.followPointer&&e?(void 0===e.chartX&&(e=m.normalize(e)),a=[e.chartX-d.plotLeft,e.chartY-c]):a[0].tooltipPos?a=a[0].tooltipPos:(F(a,function(a){n=a.series.yAxis;p=a.series.xAxis;B+=a.plotX+(!b&&p?p.left-x:0);t+=(a.plotLow?(a.plotLow+a.plotHigh)/2:a.plotY)+
(!b&&n?n.top-c:0)}),B/=a.length,t/=a.length,a=[b?d.plotWidth-t:B,this.shared&&!b&&1<a.length&&e?e.chartY-c:b?d.plotHeight-B:t]);return f(a,Math.round)},getPosition:function(a,e,g){var d=this.chart,b=this.distance,c={},x=d.inverted&&g.h||0,B,t=this.outside,n=t?E.documentElement.clientWidth-2*b:d.chartWidth,p=t?Math.max(E.body.scrollHeight,E.documentElement.scrollHeight,E.body.offsetHeight,E.documentElement.offsetHeight,E.documentElement.clientHeight):d.chartHeight,z=d.pointer.chartPosition,D=["y",
p,e,(t?z.top-b:0)+g.plotY+d.plotTop,t?0:d.plotTop,t?p:d.plotTop+d.plotHeight],h=["x",n,a,(t?z.left-b:0)+g.plotX+d.plotLeft,t?0:d.plotLeft,t?n:d.plotLeft+d.plotWidth],I=!this.followPointer&&C(g.ttBelow,!d.inverted===!!g.negative),H=function(a,d,h,k,v,m){var w=h<k-b,n=k+b+h<d,e=k-b-h;k+=b;if(I&&n)c[a]=k;else if(!I&&w)c[a]=e;else if(w)c[a]=Math.min(m-h,0>e-x?e:e-x);else if(n)c[a]=Math.max(v,k+x+h>d?k:k+x);else return!1},v=function(a,d,h,k){var v;k<b||k>d-b?v=!1:c[a]=k<h/2?1:k>d-h/2?d-h-2:k-h/2;return v},
w=function(a){var b=D;D=h;h=b;B=a},k=function(){!1!==H.apply(0,D)?!1!==v.apply(0,h)||B||(w(!0),k()):B?c.x=c.y=0:(w(!0),k())};(d.inverted||1<this.len)&&w();k();return c},defaultFormatter:function(a){var d=this.points||r(this),g;g=[a.tooltipFooterHeaderFormatter(d[0])];g=g.concat(a.bodyFormatter(d));g.push(a.tooltipFooterHeaderFormatter(d[0],!0));return g},refresh:function(d,e){var g,m=this.options,b,c=d,x,B={},t=[];g=m.formatter||this.defaultFormatter;var B=this.shared,n;m.enabled&&(a.clearTimeout(this.hideTimer),
this.followPointer=r(c)[0].series.tooltipOptions.followPointer,x=this.getAnchor(c,e),e=x[0],b=x[1],!B||c.series&&c.series.noSharedTooltip?B=c.getLabelConfig():(F(c,function(a){a.setState("hover");t.push(a.getLabelConfig())}),B={x:c[0].category,y:c[0].y},B.points=t,c=c[0]),this.len=t.length,B=g.call(B,this),n=c.series,this.distance=C(n.tooltipOptions.distance,16),!1===B?this.hide():(g=this.getLabel(),this.isHidden&&g.attr({opacity:1}).show(),this.split?this.renderSplit(B,r(d)):(m.style.width||g.css({width:this.chart.spacingBox.width}),
g.attr({text:B&&B.join?B.join(""):B}),g.removeClass(/highcharts-color-[\d]+/g).addClass("highcharts-color-"+C(c.colorIndex,n.colorIndex)),g.attr({stroke:m.borderColor||c.color||n.color||"#666666"}),this.updatePosition({plotX:e,plotY:b,negative:c.negative,ttBelow:c.ttBelow,h:x[2]||0})),this.isHidden=!1))},renderSplit:function(d,e){var g=this,m=[],b=this.chart,c=b.renderer,x=!0,B=this.options,t=0,n,p=this.getLabel(),z=b.plotTop;a.isString(d)&&(d=[!1,d]);F(d.slice(0,e.length+1),function(a,d){if(!1!==
a){d=e[d-1]||{isHeader:!0,plotX:e[0].plotX};var h=d.series||g,H=h.tt,v=d.series||{},w="highcharts-color-"+C(d.colorIndex,v.colorIndex,"none");H||(h.tt=H=c.label(null,null,null,"callout",null,null,B.useHTML).addClass("highcharts-tooltip-box "+w+(d.isHeader?" highcharts-tooltip-header":"")).attr({padding:B.padding,r:B.borderRadius,fill:B.backgroundColor,stroke:B.borderColor||d.color||v.color||"#333333","stroke-width":B.borderWidth}).add(p));H.isActive=!0;H.attr({text:a});H.css(B.style).shadow(B.shadow);
a=H.getBBox();v=a.width+H.strokeWidth();d.isHeader?(t=a.height,b.xAxis[0].opposite&&(n=!0,z-=t),v=Math.max(0,Math.min(d.plotX+b.plotLeft-v/2,b.chartWidth+(b.scrollablePixels?b.scrollablePixels-b.marginRight:0)-v))):v=d.plotX+b.plotLeft-C(B.distance,16)-v;0>v&&(x=!1);a=(d.series&&d.series.yAxis&&d.series.yAxis.pos)+(d.plotY||0);a-=z;d.isHeader&&(a=n?-t:b.plotHeight+t);m.push({target:a,rank:d.isHeader?1:0,size:h.tt.getBBox().height+1,point:d,x:v,tt:H})}});this.cleanSplit();a.distribute(m,b.plotHeight+
t);F(m,function(a){var c=a.point,d=c.series;a.tt.attr({visibility:void 0===a.pos?"hidden":"inherit",x:x||c.isHeader?a.x:c.plotX+b.plotLeft+C(B.distance,16),y:a.pos+z,anchorX:c.isHeader?c.plotX+b.plotLeft:c.plotX+d.xAxis.pos,anchorY:c.isHeader?b.plotTop+b.plotHeight/2:c.plotY+d.yAxis.pos})})},updatePosition:function(a){var d=this.chart,g=this.getLabel(),m=(this.options.positioner||this.getPosition).call(this,g.width,g.height,a),b=a.plotX+d.plotLeft;a=a.plotY+d.plotTop;var c;this.outside&&(c=(this.options.borderWidth||
0)+2*this.distance,this.renderer.setSize(g.width+c,g.height+c,!1),b+=d.pointer.chartPosition.left-m.x,a+=d.pointer.chartPosition.top-m.y);this.move(Math.round(m.x),Math.round(m.y||0),b,a)},getDateFormat:function(a,e,g,m){var b=this.chart.time,c=b.dateFormat("%m-%d %H:%M:%S.%L",e),d,B,t={millisecond:15,second:12,minute:9,hour:6,day:3},n="millisecond";for(B in p){if(a===p.week&&+b.dateFormat("%w",e)===g&&"00:00:00.000"===c.substr(6)){B="week";break}if(p[B]>a){B=n;break}if(t[B]&&c.substr(t[B])!=="01-01 00:00:00.000".substr(t[B]))break;
"week"!==B&&(n=B)}B&&(d=m[B]);return d},getXDateFormat:function(a,e,g){e=e.dateTimeLabelFormats;var d=g&&g.closestPointRange;return(d?this.getDateFormat(d,a.x,g.options.startOfWeek,e):e.day)||e.year},tooltipFooterHeaderFormatter:function(a,e){e=e?"footer":"header";var d=a.series,m=d.tooltipOptions,b=m.xDateFormat,c=d.xAxis,x=c&&"datetime"===c.options.type&&l(a.key),B=m[e+"Format"];x&&!b&&(b=this.getXDateFormat(a,m,c));x&&b&&F(a.point&&a.point.tooltipDateKeys||["key"],function(a){B=B.replace("{point."+
a+"}","{point."+a+":"+b+"}")});return q(B,{point:a,series:d},this.chart.time)},bodyFormatter:function(a){return f(a,function(a){var d=a.series.tooltipOptions;return(d[(a.point.formatPrefix||"point")+"Formatter"]||a.point.tooltipFormatter).call(a.point,d[(a.point.formatPrefix||"point")+"Format"])})}}})(J);(function(a){var E=a.addEvent,F=a.attr,G=a.charts,q=a.color,l=a.css,f=a.defined,u=a.each,C=a.extend,r=a.find,y=a.fireEvent,p=a.isNumber,d=a.isObject,e=a.offset,g=a.pick,m=a.splat,b=a.Tooltip;a.Pointer=
function(a,b){this.init(a,b)};a.Pointer.prototype={init:function(a,d){this.options=d;this.chart=a;this.runChartClick=d.chart.events&&!!d.chart.events.click;this.pinchDown=[];this.lastValidTouch={};b&&(a.tooltip=new b(a,d.tooltip),this.followTouchMove=g(d.tooltip.followTouchMove,!0));this.setDOMEvents()},zoomOption:function(a){var b=this.chart,c=b.options.chart,d=c.zoomType||"",b=b.inverted;/touch/.test(a.type)&&(d=g(c.pinchType,d));this.zoomX=a=/x/.test(d);this.zoomY=d=/y/.test(d);this.zoomHor=a&&
!b||d&&b;this.zoomVert=d&&!b||a&&b;this.hasZoom=a||d},normalize:function(a,b){var c;c=a.touches?a.touches.length?a.touches.item(0):a.changedTouches[0]:a;b||(this.chartPosition=b=e(this.chart.container));return C(a,{chartX:Math.round(c.pageX-b.left),chartY:Math.round(c.pageY-b.top)})},getCoordinates:function(a){var b={xAxis:[],yAxis:[]};u(this.chart.axes,function(c){b[c.isXAxis?"xAxis":"yAxis"].push({axis:c,value:c.toValue(a[c.horiz?"chartX":"chartY"])})});return b},findNearestKDPoint:function(a,b,
m){var c;u(a,function(a){var n=!(a.noSharedTooltip&&b)&&0>a.options.findNearestPointBy.indexOf("y");a=a.searchPoint(m,n);if((n=d(a,!0))&&!(n=!d(c,!0)))var n=c.distX-a.distX,e=c.dist-a.dist,t=(a.series.group&&a.series.group.zIndex)-(c.series.group&&c.series.group.zIndex),n=0<(0!==n&&b?n:0!==e?e:0!==t?t:c.series.index>a.series.index?-1:1);n&&(c=a)});return c},getPointFromEvent:function(a){a=a.target;for(var b;a&&!b;)b=a.point,a=a.parentNode;return b},getChartCoordinatesFromPoint:function(a,b){var c=
a.series,d=c.xAxis,c=c.yAxis,m=g(a.clientX,a.plotX),e=a.shapeArgs;if(d&&c)return b?{chartX:d.len+d.pos-m,chartY:c.len+c.pos-a.plotY}:{chartX:m+d.pos,chartY:a.plotY+c.pos};if(e&&e.x&&e.y)return{chartX:e.x,chartY:e.y}},getHoverData:function(b,m,e,t,n,p,z){var c,h=[],x=z&&z.isBoosting;t=!(!t||!b);z=m&&!m.stickyTracking?[m]:a.grep(e,function(a){return a.visible&&!(!n&&a.directTouch)&&g(a.options.enableMouseTracking,!0)&&a.stickyTracking});m=(c=t?b:this.findNearestKDPoint(z,n,p))&&c.series;c&&(n&&!m.noSharedTooltip?
(z=a.grep(e,function(a){return a.visible&&!(!n&&a.directTouch)&&g(a.options.enableMouseTracking,!0)&&!a.noSharedTooltip}),u(z,function(a){var b=r(a.points,function(a){return a.x===c.x&&!a.isNull});d(b)&&(x&&(b=a.getPoint(b)),h.push(b))})):h.push(c));return{hoverPoint:c,hoverSeries:m,hoverPoints:h}},runPointActions:function(b,d){var c=this.chart,m=c.tooltip&&c.tooltip.options.enabled?c.tooltip:void 0,n=m?m.shared:!1,e=d||c.hoverPoint,x=e&&e.series||c.hoverSeries,x=this.getHoverData(e,x,c.series,"touchmove"!==
b.type&&(!!d||x&&x.directTouch&&this.isDirectTouch),n,b,{isBoosting:c.isBoosting}),D,e=x.hoverPoint;D=x.hoverPoints;d=(x=x.hoverSeries)&&x.tooltipOptions.followPointer;n=n&&x&&!x.noSharedTooltip;if(e&&(e!==c.hoverPoint||m&&m.isHidden)){u(c.hoverPoints||[],function(b){-1===a.inArray(b,D)&&b.setState()});u(D||[],function(a){a.setState("hover")});if(c.hoverSeries!==x)x.onMouseOver();c.hoverPoint&&c.hoverPoint.firePointEvent("mouseOut");if(!e.series)return;e.firePointEvent("mouseOver");c.hoverPoints=
D;c.hoverPoint=e;m&&m.refresh(n?D:e,b)}else d&&m&&!m.isHidden&&(e=m.getAnchor([{}],b),m.updatePosition({plotX:e[0],plotY:e[1]}));this.unDocMouseMove||(this.unDocMouseMove=E(c.container.ownerDocument,"mousemove",function(b){var c=G[a.hoverChartIndex];if(c)c.pointer.onDocumentMouseMove(b)}));u(c.axes,function(c){var d=g(c.crosshair.snap,!0),h=d?a.find(D,function(a){return a.series[c.coll]===c}):void 0;h||!d?c.drawCrosshair(b,h):c.hideCrosshair()})},reset:function(a,b){var c=this.chart,d=c.hoverSeries,
n=c.hoverPoint,e=c.hoverPoints,g=c.tooltip,x=g&&g.shared?e:n;a&&x&&u(m(x),function(b){b.series.isCartesian&&void 0===b.plotX&&(a=!1)});if(a)g&&x&&(g.refresh(x),g.shared&&e?u(e,function(a){a.setState(a.state,!0);a.series.xAxis.crosshair&&a.series.xAxis.drawCrosshair(null,a);a.series.yAxis.crosshair&&a.series.yAxis.drawCrosshair(null,a)}):n&&(n.setState(n.state,!0),u(c.axes,function(a){a.crosshair&&a.drawCrosshair(null,n)})));else{if(n)n.onMouseOut();e&&u(e,function(a){a.setState()});if(d)d.onMouseOut();
g&&g.hide(b);this.unDocMouseMove&&(this.unDocMouseMove=this.unDocMouseMove());u(c.axes,function(a){a.hideCrosshair()});this.hoverX=c.hoverPoints=c.hoverPoint=null}},scaleGroups:function(a,b){var c=this.chart,d;u(c.series,function(m){d=a||m.getPlotBox();m.xAxis&&m.xAxis.zoomEnabled&&m.group&&(m.group.attr(d),m.markerGroup&&(m.markerGroup.attr(d),m.markerGroup.clip(b?c.clipRect:null)),m.dataLabelsGroup&&m.dataLabelsGroup.attr(d))});c.clipRect.attr(b||c.clipBox)},dragStart:function(a){var b=this.chart;
b.mouseIsDown=a.type;b.cancelClick=!1;b.mouseDownX=this.mouseDownX=a.chartX;b.mouseDownY=this.mouseDownY=a.chartY},drag:function(a){var b=this.chart,c=b.options.chart,d=a.chartX,m=a.chartY,e=this.zoomHor,g=this.zoomVert,D=b.plotLeft,h=b.plotTop,p=b.plotWidth,H=b.plotHeight,v,w=this.selectionMarker,k=this.mouseDownX,A=this.mouseDownY,f=c.panKey&&a[c.panKey+"Key"];w&&w.touch||(d<D?d=D:d>D+p&&(d=D+p),m<h?m=h:m>h+H&&(m=h+H),this.hasDragged=Math.sqrt(Math.pow(k-d,2)+Math.pow(A-m,2)),10<this.hasDragged&&
(v=b.isInsidePlot(k-D,A-h),b.hasCartesianSeries&&(this.zoomX||this.zoomY)&&v&&!f&&!w&&(this.selectionMarker=w=b.renderer.rect(D,h,e?1:p,g?1:H,0).attr({fill:c.selectionMarkerFill||q("#335cad").setOpacity(.25).get(),"class":"highcharts-selection-marker",zIndex:7}).add()),w&&e&&(d-=k,w.attr({width:Math.abs(d),x:(0<d?0:d)+k})),w&&g&&(d=m-A,w.attr({height:Math.abs(d),y:(0<d?0:d)+A})),v&&!w&&c.panning&&b.pan(a,c.panning)))},drop:function(a){var b=this,c=this.chart,d=this.hasPinched;if(this.selectionMarker){var m=
{originalEvent:a,xAxis:[],yAxis:[]},e=this.selectionMarker,g=e.attr?e.attr("x"):e.x,D=e.attr?e.attr("y"):e.y,h=e.attr?e.attr("width"):e.width,I=e.attr?e.attr("height"):e.height,H;if(this.hasDragged||d)u(c.axes,function(c){if(c.zoomEnabled&&f(c.min)&&(d||b[{xAxis:"zoomX",yAxis:"zoomY"}[c.coll]])){var v=c.horiz,k="touchend"===a.type?c.minPixelPadding:0,e=c.toValue((v?g:D)+k),v=c.toValue((v?g+h:D+I)-k);m[c.coll].push({axis:c,min:Math.min(e,v),max:Math.max(e,v)});H=!0}}),H&&y(c,"selection",m,function(a){c.zoom(C(a,
d?{animation:!1}:null))});p(c.index)&&(this.selectionMarker=this.selectionMarker.destroy());d&&this.scaleGroups()}c&&p(c.index)&&(l(c.container,{cursor:c._cursor}),c.cancelClick=10<this.hasDragged,c.mouseIsDown=this.hasDragged=this.hasPinched=!1,this.pinchDown=[])},onContainerMouseDown:function(a){a=this.normalize(a);2!==a.button&&(this.zoomOption(a),a.preventDefault&&a.preventDefault(),this.dragStart(a))},onDocumentMouseUp:function(b){G[a.hoverChartIndex]&&G[a.hoverChartIndex].pointer.drop(b)},onDocumentMouseMove:function(a){var b=
this.chart,c=this.chartPosition;a=this.normalize(a,c);!c||this.inClass(a.target,"highcharts-tracker")||b.isInsidePlot(a.chartX-b.plotLeft,a.chartY-b.plotTop)||this.reset()},onContainerMouseLeave:function(b){var c=G[a.hoverChartIndex];c&&(b.relatedTarget||b.toElement)&&(c.pointer.reset(),c.pointer.chartPosition=null)},onContainerMouseMove:function(b){var c=this.chart;f(a.hoverChartIndex)&&G[a.hoverChartIndex]&&G[a.hoverChartIndex].mouseIsDown||(a.hoverChartIndex=c.index);b=this.normalize(b);b.returnValue=
!1;"mousedown"===c.mouseIsDown&&this.drag(b);!this.inClass(b.target,"highcharts-tracker")&&!c.isInsidePlot(b.chartX-c.plotLeft,b.chartY-c.plotTop)||c.openMenu||this.runPointActions(b)},inClass:function(a,b){for(var c;a;){if(c=F(a,"class")){if(-1!==c.indexOf(b))return!0;if(-1!==c.indexOf("highcharts-container"))return!1}a=a.parentNode}},onTrackerMouseOut:function(a){var b=this.chart.hoverSeries;a=a.relatedTarget||a.toElement;this.isDirectTouch=!1;if(!(!b||!a||b.stickyTracking||this.inClass(a,"highcharts-tooltip")||
this.inClass(a,"highcharts-series-"+b.index)&&this.inClass(a,"highcharts-tracker")))b.onMouseOut()},onContainerClick:function(a){var b=this.chart,c=b.hoverPoint,d=b.plotLeft,m=b.plotTop;a=this.normalize(a);b.cancelClick||(c&&this.inClass(a.target,"highcharts-tracker")?(y(c.series,"click",C(a,{point:c})),b.hoverPoint&&c.firePointEvent("click",a)):(C(a,this.getCoordinates(a)),b.isInsidePlot(a.chartX-d,a.chartY-m)&&y(b,"click",a)))},setDOMEvents:function(){var b=this,d=b.chart.container,m=d.ownerDocument;
d.onmousedown=function(a){b.onContainerMouseDown(a)};d.onmousemove=function(a){b.onContainerMouseMove(a)};d.onclick=function(a){b.onContainerClick(a)};this.unbindContainerMouseLeave=E(d,"mouseleave",b.onContainerMouseLeave);a.unbindDocumentMouseUp||(a.unbindDocumentMouseUp=E(m,"mouseup",b.onDocumentMouseUp));a.hasTouch&&(d.ontouchstart=function(a){b.onContainerTouchStart(a)},d.ontouchmove=function(a){b.onContainerTouchMove(a)},a.unbindDocumentTouchEnd||(a.unbindDocumentTouchEnd=E(m,"touchend",b.onDocumentTouchEnd)))},
destroy:function(){var b=this;b.unDocMouseMove&&b.unDocMouseMove();this.unbindContainerMouseLeave();a.chartCount||(a.unbindDocumentMouseUp&&(a.unbindDocumentMouseUp=a.unbindDocumentMouseUp()),a.unbindDocumentTouchEnd&&(a.unbindDocumentTouchEnd=a.unbindDocumentTouchEnd()));clearInterval(b.tooltipTimeout);a.objectEach(b,function(a,c){b[c]=null})}}})(J);(function(a){var E=a.charts,F=a.each,G=a.extend,q=a.map,l=a.noop,f=a.pick;G(a.Pointer.prototype,{pinchTranslate:function(a,f,l,q,p,d){this.zoomHor&&
this.pinchTranslateDirection(!0,a,f,l,q,p,d);this.zoomVert&&this.pinchTranslateDirection(!1,a,f,l,q,p,d)},pinchTranslateDirection:function(a,f,l,q,p,d,e,g){var m=this.chart,b=a?"x":"y",c=a?"X":"Y",x="chart"+c,B=a?"width":"height",t=m["plot"+(a?"Left":"Top")],n,r,z=g||1,D=m.inverted,h=m.bounds[a?"h":"v"],I=1===f.length,H=f[0][x],v=l[0][x],w=!I&&f[1][x],k=!I&&l[1][x],A;l=function(){!I&&20<Math.abs(H-w)&&(z=g||Math.abs(v-k)/Math.abs(H-w));r=(t-v)/z+H;n=m["plot"+(a?"Width":"Height")]/z};l();f=r;f<h.min?
(f=h.min,A=!0):f+n>h.max&&(f=h.max-n,A=!0);A?(v-=.8*(v-e[b][0]),I||(k-=.8*(k-e[b][1])),l()):e[b]=[v,k];D||(d[b]=r-t,d[B]=n);d=D?1/z:z;p[B]=n;p[b]=f;q[D?a?"scaleY":"scaleX":"scale"+c]=z;q["translate"+c]=d*t+(v-d*H)},pinch:function(a){var u=this,r=u.chart,y=u.pinchDown,p=a.touches,d=p.length,e=u.lastValidTouch,g=u.hasZoom,m=u.selectionMarker,b={},c=1===d&&(u.inClass(a.target,"highcharts-tracker")&&r.runTrackerClick||u.runChartClick),x={};1<d&&(u.initiated=!0);g&&u.initiated&&!c&&a.preventDefault();
q(p,function(a){return u.normalize(a)});"touchstart"===a.type?(F(p,function(a,b){y[b]={chartX:a.chartX,chartY:a.chartY}}),e.x=[y[0].chartX,y[1]&&y[1].chartX],e.y=[y[0].chartY,y[1]&&y[1].chartY],F(r.axes,function(a){if(a.zoomEnabled){var b=r.bounds[a.horiz?"h":"v"],c=a.minPixelPadding,d=a.toPixels(f(a.options.min,a.dataMin)),m=a.toPixels(f(a.options.max,a.dataMax)),e=Math.max(d,m);b.min=Math.min(a.pos,Math.min(d,m)-c);b.max=Math.max(a.pos+a.len,e+c)}}),u.res=!0):u.followTouchMove&&1===d?this.runPointActions(u.normalize(a)):
y.length&&(m||(u.selectionMarker=m=G({destroy:l,touch:!0},r.plotBox)),u.pinchTranslate(y,p,b,m,x,e),u.hasPinched=g,u.scaleGroups(b,x),u.res&&(u.res=!1,this.reset(!1,0)))},touch:function(l,q){var r=this.chart,u,p;if(r.index!==a.hoverChartIndex)this.onContainerMouseLeave({relatedTarget:!0});a.hoverChartIndex=r.index;1===l.touches.length?(l=this.normalize(l),(p=r.isInsidePlot(l.chartX-r.plotLeft,l.chartY-r.plotTop))&&!r.openMenu?(q&&this.runPointActions(l),"touchmove"===l.type&&(q=this.pinchDown,u=q[0]?
4<=Math.sqrt(Math.pow(q[0].chartX-l.chartX,2)+Math.pow(q[0].chartY-l.chartY,2)):!1),f(u,!0)&&this.pinch(l)):q&&this.reset()):2===l.touches.length&&this.pinch(l)},onContainerTouchStart:function(a){this.zoomOption(a);this.touch(a,!0)},onContainerTouchMove:function(a){this.touch(a)},onDocumentTouchEnd:function(f){E[a.hoverChartIndex]&&E[a.hoverChartIndex].pointer.drop(f)}})})(J);(function(a){var E=a.addEvent,F=a.charts,G=a.css,q=a.doc,l=a.extend,f=a.noop,u=a.Pointer,C=a.removeEvent,r=a.win,y=a.wrap;
if(!a.hasTouch&&(r.PointerEvent||r.MSPointerEvent)){var p={},d=!!r.PointerEvent,e=function(){var d=[];d.item=function(a){return this[a]};a.objectEach(p,function(a){d.push({pageX:a.pageX,pageY:a.pageY,target:a.target})});return d},g=function(d,b,c,g){"touch"!==d.pointerType&&d.pointerType!==d.MSPOINTER_TYPE_TOUCH||!F[a.hoverChartIndex]||(g(d),g=F[a.hoverChartIndex].pointer,g[b]({type:c,target:d.currentTarget,preventDefault:f,touches:e()}))};l(u.prototype,{onContainerPointerDown:function(a){g(a,"onContainerTouchStart",
"touchstart",function(a){p[a.pointerId]={pageX:a.pageX,pageY:a.pageY,target:a.currentTarget}})},onContainerPointerMove:function(a){g(a,"onContainerTouchMove","touchmove",function(a){p[a.pointerId]={pageX:a.pageX,pageY:a.pageY};p[a.pointerId].target||(p[a.pointerId].target=a.currentTarget)})},onDocumentPointerUp:function(a){g(a,"onDocumentTouchEnd","touchend",function(a){delete p[a.pointerId]})},batchMSEvents:function(a){a(this.chart.container,d?"pointerdown":"MSPointerDown",this.onContainerPointerDown);
a(this.chart.container,d?"pointermove":"MSPointerMove",this.onContainerPointerMove);a(q,d?"pointerup":"MSPointerUp",this.onDocumentPointerUp)}});y(u.prototype,"init",function(a,b,c){a.call(this,b,c);this.hasZoom&&G(b.container,{"-ms-touch-action":"none","touch-action":"none"})});y(u.prototype,"setDOMEvents",function(a){a.apply(this);(this.hasZoom||this.followTouchMove)&&this.batchMSEvents(E)});y(u.prototype,"destroy",function(a){this.batchMSEvents(C);a.call(this)})}})(J);(function(a){var E=a.addEvent,
F=a.css,G=a.discardElement,q=a.defined,l=a.each,f=a.fireEvent,u=a.isFirefox,C=a.marginNames,r=a.merge,y=a.pick,p=a.setAnimation,d=a.stableSort,e=a.win,g=a.wrap;a.Legend=function(a,b){this.init(a,b)};a.Legend.prototype={init:function(a,b){this.chart=a;this.setOptions(b);b.enabled&&(this.render(),E(this.chart,"endResize",function(){this.legend.positionCheckboxes()}),this.proximate?this.unchartrender=E(this.chart,"render",function(){this.legend.proximatePositions();this.legend.positionItems()}):this.unchartrender&&
this.unchartrender())},setOptions:function(a){var b=y(a.padding,8);this.options=a;this.itemStyle=a.itemStyle;this.itemHiddenStyle=r(this.itemStyle,a.itemHiddenStyle);this.itemMarginTop=a.itemMarginTop||0;this.padding=b;this.initialItemY=b-5;this.symbolWidth=y(a.symbolWidth,16);this.pages=[];this.proximate="proximate"===a.layout&&!this.chart.inverted},update:function(a,b){var c=this.chart;this.setOptions(r(!0,this.options,a));this.destroy();c.isDirtyLegend=c.isDirtyBox=!0;y(b,!0)&&c.redraw();f(this,
"afterUpdate")},colorizeItem:function(a,b){a.legendGroup[b?"removeClass":"addClass"]("highcharts-legend-item-hidden");var c=this.options,d=a.legendItem,m=a.legendLine,e=a.legendSymbol,n=this.itemHiddenStyle.color,c=b?c.itemStyle.color:n,g=b?a.color||n:n,z=a.options&&a.options.marker,p={fill:g};d&&d.css({fill:c,color:c});m&&m.attr({stroke:g});e&&(z&&e.isMarker&&(p=a.pointAttribs(),b||(p.stroke=p.fill=n)),e.attr(p));f(this,"afterColorizeItem",{item:a,visible:b})},positionItems:function(){l(this.allItems,
this.positionItem,this);this.chart.isResizing||this.positionCheckboxes()},positionItem:function(a){var b=this.options,c=b.symbolPadding,b=!b.rtl,d=a._legendItemPos,m=d[0],d=d[1],e=a.checkbox;if((a=a.legendGroup)&&a.element)a[q(a.translateY)?"animate":"attr"]({translateX:b?m:this.legendWidth-m-2*c-4,translateY:d});e&&(e.x=m,e.y=d)},destroyItem:function(a){var b=a.checkbox;l(["legendItem","legendLine","legendSymbol","legendGroup"],function(b){a[b]&&(a[b]=a[b].destroy())});b&&G(a.checkbox)},destroy:function(){function a(a){this[a]&&
(this[a]=this[a].destroy())}l(this.getAllItems(),function(b){l(["legendItem","legendGroup"],a,b)});l("clipRect up down pager nav box title group".split(" "),a,this);this.display=null},positionCheckboxes:function(){var a=this.group&&this.group.alignAttr,b,c=this.clipHeight||this.legendHeight,d=this.titleHeight;a&&(b=a.translateY,l(this.allItems,function(e){var m=e.checkbox,n;m&&(n=b+d+m.y+(this.scrollOffset||0)+3,F(m,{left:a.translateX+e.checkboxOffset+m.x-20+"px",top:n+"px",display:n>b-6&&n<b+c-6?
"":"none"}))},this))},renderTitle:function(){var a=this.options,b=this.padding,c=a.title,d=0;c.text&&(this.title||(this.title=this.chart.renderer.label(c.text,b-3,b-4,null,null,null,a.useHTML,null,"legend-title").attr({zIndex:1}).css(c.style).add(this.group)),a=this.title.getBBox(),d=a.height,this.offsetWidth=a.width,this.contentGroup.attr({translateY:d}));this.titleHeight=d},setText:function(d){var b=this.options;d.legendItem.attr({text:b.labelFormat?a.format(b.labelFormat,d,this.chart.time):b.labelFormatter.call(d)})},
renderItem:function(a){var b=this.chart,c=b.renderer,d=this.options,e=this.symbolWidth,m=d.symbolPadding,n=this.itemStyle,g=this.itemHiddenStyle,z="horizontal"===d.layout?y(d.itemDistance,20):0,p=!d.rtl,h=a.legendItem,f=!a.series,H=!f&&a.series.drawLegendSymbol?a.series:a,v=H.options,v=this.createCheckboxForItem&&v&&v.showCheckbox,z=e+m+z+(v?20:0),w=d.useHTML,k=a.options.className;h||(a.legendGroup=c.g("legend-item").addClass("highcharts-"+H.type+"-series highcharts-color-"+a.colorIndex+(k?" "+k:
"")+(f?" highcharts-series-"+a.index:"")).attr({zIndex:1}).add(this.scrollGroup),a.legendItem=h=c.text("",p?e+m:-m,this.baseline||0,w).css(r(a.visible?n:g)).attr({align:p?"left":"right",zIndex:2}).add(a.legendGroup),this.baseline||(e=n.fontSize,this.fontMetrics=c.fontMetrics(e,h),this.baseline=this.fontMetrics.f+3+this.itemMarginTop,h.attr("y",this.baseline)),this.symbolHeight=d.symbolHeight||this.fontMetrics.f,H.drawLegendSymbol(this,a),this.setItemEvents&&this.setItemEvents(a,h,w),v&&this.createCheckboxForItem(a));
this.colorizeItem(a,a.visible);n.width||h.css({width:(d.itemWidth||d.width||b.spacingBox.width)-z});this.setText(a);b=h.getBBox();a.itemWidth=a.checkboxOffset=d.itemWidth||a.legendItemWidth||b.width+z;this.maxItemWidth=Math.max(this.maxItemWidth,a.itemWidth);this.totalItemWidth+=a.itemWidth;this.itemHeight=a.itemHeight=Math.round(a.legendItemHeight||b.height||this.symbolHeight)},layoutItem:function(a){var b=this.options,c=this.padding,d="horizontal"===b.layout,e=a.itemHeight,m=b.itemMarginBottom||
0,n=this.itemMarginTop,g=d?y(b.itemDistance,20):0,z=b.width,p=z||this.chart.spacingBox.width-2*c-b.x,b=b.alignColumns&&this.totalItemWidth>p?this.maxItemWidth:a.itemWidth;d&&this.itemX-c+b>p&&(this.itemX=c,this.itemY+=n+this.lastLineHeight+m,this.lastLineHeight=0);this.lastItemY=n+this.itemY+m;this.lastLineHeight=Math.max(e,this.lastLineHeight);a._legendItemPos=[this.itemX,this.itemY];d?this.itemX+=b:(this.itemY+=n+e+m,this.lastLineHeight=e);this.offsetWidth=z||Math.max((d?this.itemX-c-(a.checkbox?
0:g):b)+c,this.offsetWidth)},getAllItems:function(){var a=[];l(this.chart.series,function(b){var c=b&&b.options;b&&y(c.showInLegend,q(c.linkedTo)?!1:void 0,!0)&&(a=a.concat(b.legendItems||("point"===c.legendType?b.data:b)))});f(this,"afterGetAllItems",{allItems:a});return a},getAlignment:function(){var a=this.options;return this.proximate?a.align.charAt(0)+"tv":a.floating?"":a.align.charAt(0)+a.verticalAlign.charAt(0)+a.layout.charAt(0)},adjustMargins:function(a,b){var c=this.chart,d=this.options,
e=this.getAlignment();e&&l([/(lth|ct|rth)/,/(rtv|rm|rbv)/,/(rbh|cb|lbh)/,/(lbv|lm|ltv)/],function(m,n){m.test(e)&&!q(a[n])&&(c[C[n]]=Math.max(c[C[n]],c.legend[(n+1)%2?"legendHeight":"legendWidth"]+[1,-1,-1,1][n]*d[n%2?"x":"y"]+y(d.margin,12)+b[n]+(0===n&&void 0!==c.options.title.margin?c.titleOffset+c.options.title.margin:0)))})},proximatePositions:function(){var d=this.chart,b=[],c="left"===this.options.align;l(this.allItems,function(e){var m,g;m=c;e.xAxis&&e.points&&(e.xAxis.options.reversed&&(m=
!m),m=a.find(m?e.points:e.points.slice(0).reverse(),function(b){return a.isNumber(b.plotY)}),g=e.legendGroup.getBBox().height,b.push({target:e.visible?(m?m.plotY:e.xAxis.height)-.3*g:d.plotHeight,size:g,item:e}))},this);a.distribute(b,d.plotHeight);l(b,function(a){a.item._legendItemPos[1]=d.plotTop-d.spacing[0]+a.pos})},render:function(){var a=this.chart,b=a.renderer,c=this.group,e,g,t,n=this.box,p=this.options,z=this.padding;this.itemX=z;this.itemY=this.initialItemY;this.lastItemY=this.offsetWidth=
0;c||(this.group=c=b.g("legend").attr({zIndex:7}).add(),this.contentGroup=b.g().attr({zIndex:1}).add(c),this.scrollGroup=b.g().add(this.contentGroup));this.renderTitle();e=this.getAllItems();d(e,function(a,b){return(a.options&&a.options.legendIndex||0)-(b.options&&b.options.legendIndex||0)});p.reversed&&e.reverse();this.allItems=e;this.display=g=!!e.length;this.itemHeight=this.totalItemWidth=this.maxItemWidth=this.lastLineHeight=0;l(e,this.renderItem,this);l(e,this.layoutItem,this);e=(p.width||this.offsetWidth)+
z;t=this.lastItemY+this.lastLineHeight+this.titleHeight;t=this.handleOverflow(t);t+=z;n||(this.box=n=b.rect().addClass("highcharts-legend-box").attr({r:p.borderRadius}).add(c),n.isNew=!0);n.attr({stroke:p.borderColor,"stroke-width":p.borderWidth||0,fill:p.backgroundColor||"none"}).shadow(p.shadow);0<e&&0<t&&(n[n.isNew?"attr":"animate"](n.crisp.call({},{x:0,y:0,width:e,height:t},n.strokeWidth())),n.isNew=!1);n[g?"show":"hide"]();this.legendWidth=e;this.legendHeight=t;g&&(b=a.spacingBox,/(lth|ct|rth)/.test(this.getAlignment())&&
(b=r(b,{y:b.y+a.titleOffset+a.options.title.margin})),c.align(r(p,{width:e,height:t,verticalAlign:this.proximate?"top":p.verticalAlign}),!0,b));this.proximate||this.positionItems()},handleOverflow:function(a){var b=this,c=this.chart,d=c.renderer,e=this.options,m=e.y,n=this.padding,c=c.spacingBox.height+("top"===e.verticalAlign?-m:m)-n,m=e.maxHeight,g,p=this.clipRect,f=e.navigation,h=y(f.animation,!0),I=f.arrowSize||12,H=this.nav,v=this.pages,w,k=this.allItems,A=function(a){"number"===typeof a?p.attr({height:a}):
p&&(b.clipRect=p.destroy(),b.contentGroup.clip());b.contentGroup.div&&(b.contentGroup.div.style.clip=a?"rect("+n+"px,9999px,"+(n+a)+"px,0)":"auto")};"horizontal"!==e.layout||"middle"===e.verticalAlign||e.floating||(c/=2);m&&(c=Math.min(c,m));v.length=0;a>c&&!1!==f.enabled?(this.clipHeight=g=Math.max(c-20-this.titleHeight-n,0),this.currentPage=y(this.currentPage,1),this.fullHeight=a,l(k,function(a,b){var c=a._legendItemPos[1],d=Math.round(a.legendItem.getBBox().height),h=v.length;if(!h||c-v[h-1]>g&&
(w||c)!==v[h-1])v.push(w||c),h++;a.pageIx=h-1;w&&(k[b-1].pageIx=h-1);b===k.length-1&&c+d-v[h-1]>g&&(v.push(c),a.pageIx=h);c!==w&&(w=c)}),p||(p=b.clipRect=d.clipRect(0,n,9999,0),b.contentGroup.clip(p)),A(g),H||(this.nav=H=d.g().attr({zIndex:1}).add(this.group),this.up=d.symbol("triangle",0,0,I,I).on("click",function(){b.scroll(-1,h)}).add(H),this.pager=d.text("",15,10).addClass("highcharts-legend-navigation").css(f.style).add(H),this.down=d.symbol("triangle-down",0,0,I,I).on("click",function(){b.scroll(1,
h)}).add(H)),b.scroll(0),a=c):H&&(A(),this.nav=H.destroy(),this.scrollGroup.attr({translateY:1}),this.clipHeight=0);return a},scroll:function(a,b){var c=this.pages,d=c.length;a=this.currentPage+a;var e=this.clipHeight,m=this.options.navigation,n=this.pager,g=this.padding;a>d&&(a=d);0<a&&(void 0!==b&&p(b,this.chart),this.nav.attr({translateX:g,translateY:e+this.padding+7+this.titleHeight,visibility:"visible"}),this.up.attr({"class":1===a?"highcharts-legend-nav-inactive":"highcharts-legend-nav-active"}),
n.attr({text:a+"/"+d}),this.down.attr({x:18+this.pager.getBBox().width,"class":a===d?"highcharts-legend-nav-inactive":"highcharts-legend-nav-active"}),this.up.attr({fill:1===a?m.inactiveColor:m.activeColor}).css({cursor:1===a?"default":"pointer"}),this.down.attr({fill:a===d?m.inactiveColor:m.activeColor}).css({cursor:a===d?"default":"pointer"}),this.scrollOffset=-c[a-1]+this.initialItemY,this.scrollGroup.animate({translateY:this.scrollOffset}),this.currentPage=a,this.positionCheckboxes())}};a.LegendSymbolMixin=
{drawRectangle:function(a,b){var c=a.symbolHeight,d=a.options.squareSymbol;b.legendSymbol=this.chart.renderer.rect(d?(a.symbolWidth-c)/2:0,a.baseline-c+1,d?c:a.symbolWidth,c,y(a.options.symbolRadius,c/2)).addClass("highcharts-point").attr({zIndex:3}).add(b.legendGroup)},drawLineMarker:function(a){var b=this.options,c=b.marker,d=a.symbolWidth,e=a.symbolHeight,g=e/2,n=this.chart.renderer,m=this.legendGroup;a=a.baseline-Math.round(.3*a.fontMetrics.b);var p;p={"stroke-width":b.lineWidth||0};b.dashStyle&&
(p.dashstyle=b.dashStyle);this.legendLine=n.path(["M",0,a,"L",d,a]).addClass("highcharts-graph").attr(p).add(m);c&&!1!==c.enabled&&d&&(b=Math.min(y(c.radius,g),g),0===this.symbol.indexOf("url")&&(c=r(c,{width:e,height:e}),b=0),this.legendSymbol=c=n.symbol(this.symbol,d/2-b,a-b,2*b,2*b,c).addClass("highcharts-point").add(m),c.isMarker=!0)}};(/Trident\/7\.0/.test(e.navigator.userAgent)||u)&&g(a.Legend.prototype,"positionItem",function(a,b){var c=this,d=function(){b._legendItemPos&&a.call(c,b)};d();
setTimeout(d)})})(J);(function(a){var E=a.addEvent,F=a.animate,G=a.animObject,q=a.attr,l=a.doc,f=a.Axis,u=a.createElement,C=a.defaultOptions,r=a.discardElement,y=a.charts,p=a.css,d=a.defined,e=a.each,g=a.extend,m=a.find,b=a.fireEvent,c=a.grep,x=a.isNumber,B=a.isObject,t=a.isString,n=a.Legend,L=a.marginNames,z=a.merge,D=a.objectEach,h=a.Pointer,I=a.pick,H=a.pInt,v=a.removeEvent,w=a.seriesTypes,k=a.splat,A=a.syncTimeout,Q=a.win,T=a.Chart=function(){this.getArgs.apply(this,arguments)};a.chart=function(a,
b,c){return new T(a,b,c)};g(T.prototype,{callbacks:[],getArgs:function(){var a=[].slice.call(arguments);if(t(a[0])||a[0].nodeName)this.renderTo=a.shift();this.init(a[0],a[1])},init:function(c,d){var h,k,v=c.series,e=c.plotOptions||{};b(this,"init",{args:arguments},function(){c.series=null;h=z(C,c);for(k in h.plotOptions)h.plotOptions[k].tooltip=e[k]&&z(e[k].tooltip)||void 0;h.tooltip.userOptions=c.chart&&c.chart.forExport&&c.tooltip.userOptions||c.tooltip;h.series=c.series=v;this.userOptions=c;var w=
h.chart,n=w.events;this.margin=[];this.spacing=[];this.bounds={h:{},v:{}};this.labelCollectors=[];this.callback=d;this.isResizing=0;this.options=h;this.axes=[];this.series=[];this.time=c.time&&a.keys(c.time).length?new a.Time(c.time):a.time;this.hasCartesianSeries=w.showAxes;var g=this;g.index=y.length;y.push(g);a.chartCount++;n&&D(n,function(a,b){E(g,b,a)});g.xAxis=[];g.yAxis=[];g.pointCount=g.colorCounter=g.symbolCounter=0;b(g,"afterInit");g.firstRender()})},initSeries:function(b){var c=this.options.chart;
(c=w[b.type||c.type||c.defaultSeriesType])||a.error(17,!0);c=new c;c.init(this,b);return c},orderSeries:function(a){var b=this.series;for(a=a||0;a<b.length;a++)b[a]&&(b[a].index=a,b[a].name=b[a].getName())},isInsidePlot:function(a,b,c){var d=c?b:a;a=c?a:b;return 0<=d&&d<=this.plotWidth&&0<=a&&a<=this.plotHeight},redraw:function(c){b(this,"beforeRedraw");var d=this.axes,h=this.series,k=this.pointer,v=this.legend,w=this.userOptions.legend,n=this.isDirtyLegend,m,p,A=this.hasCartesianSeries,H=this.isDirtyBox,
z,t=this.renderer,f=t.isHidden(),D=[];this.setResponsive&&this.setResponsive(!1);a.setAnimation(c,this);f&&this.temporaryDisplay();this.layOutTitles();for(c=h.length;c--;)if(z=h[c],z.options.stacking&&(m=!0,z.isDirty)){p=!0;break}if(p)for(c=h.length;c--;)z=h[c],z.options.stacking&&(z.isDirty=!0);e(h,function(a){a.isDirty&&("point"===a.options.legendType?(a.updateTotals&&a.updateTotals(),n=!0):w&&(w.labelFormatter||w.labelFormat)&&(n=!0));a.isDirtyData&&b(a,"updatedData")});n&&v&&v.options.enabled&&
(v.render(),this.isDirtyLegend=!1);m&&this.getStacks();A&&e(d,function(a){a.updateNames();a.setScale()});this.getMargins();A&&(e(d,function(a){a.isDirty&&(H=!0)}),e(d,function(a){var c=a.min+","+a.max;a.extKey!==c&&(a.extKey=c,D.push(function(){b(a,"afterSetExtremes",g(a.eventArgs,a.getExtremes()));delete a.eventArgs}));(H||m)&&a.redraw()}));H&&this.drawChartBox();b(this,"predraw");e(h,function(a){(H||a.isDirty)&&a.visible&&a.redraw();a.isDirtyData=!1});k&&k.reset(!0);t.draw();b(this,"redraw");b(this,
"render");f&&this.temporaryDisplay(!0);e(D,function(a){a.call()})},get:function(a){function b(b){return b.id===a||b.options&&b.options.id===a}var c,d=this.series,h;c=m(this.axes,b)||m(this.series,b);for(h=0;!c&&h<d.length;h++)c=m(d[h].points||[],b);return c},getAxes:function(){var a=this,c=this.options,d=c.xAxis=k(c.xAxis||{}),c=c.yAxis=k(c.yAxis||{});b(this,"getAxes");e(d,function(a,b){a.index=b;a.isX=!0});e(c,function(a,b){a.index=b});d=d.concat(c);e(d,function(b){new f(a,b)});b(this,"afterGetAxes")},
getSelectedPoints:function(){var a=[];e(this.series,function(b){a=a.concat(c(b.data||[],function(a){return a.selected}))});return a},getSelectedSeries:function(){return c(this.series,function(a){return a.selected})},setTitle:function(a,b,c){var d=this,h=d.options,k;k=h.title=z({style:{color:"#333333",fontSize:h.isStock?"16px":"18px"}},h.title,a);h=h.subtitle=z({style:{color:"#666666"}},h.subtitle,b);e([["title",a,k],["subtitle",b,h]],function(a,b){var c=a[0],h=d[c],k=a[1];a=a[2];h&&k&&(d[c]=h=h.destroy());
a&&!h&&(d[c]=d.renderer.text(a.text,0,0,a.useHTML).attr({align:a.align,"class":"highcharts-"+c,zIndex:a.zIndex||4}).add(),d[c].update=function(a){d.setTitle(!b&&a,b&&a)},d[c].css(a.style))});d.layOutTitles(c)},layOutTitles:function(a){var b=0,c,d=this.renderer,h=this.spacingBox;e(["title","subtitle"],function(a){var c=this[a],k=this.options[a];a="title"===a?-3:k.verticalAlign?0:b+2;var v;c&&(v=k.style.fontSize,v=d.fontMetrics(v,c).b,c.css({width:(k.width||h.width+k.widthAdjust)+"px"}).align(g({y:a+
v},k),!1,"spacingBox"),k.floating||k.verticalAlign||(b=Math.ceil(b+c.getBBox(k.useHTML).height)))},this);c=this.titleOffset!==b;this.titleOffset=b;!this.isDirtyBox&&c&&(this.isDirtyBox=this.isDirtyLegend=c,this.hasRendered&&I(a,!0)&&this.isDirtyBox&&this.redraw())},getChartSize:function(){var b=this.options.chart,c=b.width,b=b.height,h=this.renderTo;d(c)||(this.containerWidth=a.getStyle(h,"width"));d(b)||(this.containerHeight=a.getStyle(h,"height"));this.chartWidth=Math.max(0,c||this.containerWidth||
600);this.chartHeight=Math.max(0,a.relativeLength(b,this.chartWidth)||(1<this.containerHeight?this.containerHeight:400))},temporaryDisplay:function(b){var c=this.renderTo;if(b)for(;c&&c.style;)c.hcOrigStyle&&(a.css(c,c.hcOrigStyle),delete c.hcOrigStyle),c.hcOrigDetached&&(l.body.removeChild(c),c.hcOrigDetached=!1),c=c.parentNode;else for(;c&&c.style;){l.body.contains(c)||c.parentNode||(c.hcOrigDetached=!0,l.body.appendChild(c));if("none"===a.getStyle(c,"display",!1)||c.hcOricDetached)c.hcOrigStyle=
{display:c.style.display,height:c.style.height,overflow:c.style.overflow},b={display:"block",overflow:"hidden"},c!==this.renderTo&&(b.height=0),a.css(c,b),c.offsetWidth||c.style.setProperty("display","block","important");c=c.parentNode;if(c===l.body)break}},setClassName:function(a){this.container.className="highcharts-container "+(a||"")},getContainer:function(){var c,d=this.options,h=d.chart,k,v;c=this.renderTo;var e=a.uniqueKey(),w;c||(this.renderTo=c=h.renderTo);t(c)&&(this.renderTo=c=l.getElementById(c));
c||a.error(13,!0);k=H(q(c,"data-highcharts-chart"));x(k)&&y[k]&&y[k].hasRendered&&y[k].destroy();q(c,"data-highcharts-chart",this.index);c.innerHTML="";h.skipClone||c.offsetWidth||this.temporaryDisplay();this.getChartSize();k=this.chartWidth;v=this.chartHeight;w=g({position:"relative",overflow:"hidden",width:k+"px",height:v+"px",textAlign:"left",lineHeight:"normal",zIndex:0,"-webkit-tap-highlight-color":"rgba(0,0,0,0)"},h.style);this.container=c=u("div",{id:e},w,c);this._cursor=c.style.cursor;this.renderer=
new (a[h.renderer]||a.Renderer)(c,k,v,null,h.forExport,d.exporting&&d.exporting.allowHTML);this.setClassName(h.className);this.renderer.setStyle(h.style);this.renderer.chartIndex=this.index;b(this,"afterGetContainer")},getMargins:function(a){var c=this.spacing,h=this.margin,k=this.titleOffset;this.resetMargins();k&&!d(h[0])&&(this.plotTop=Math.max(this.plotTop,k+this.options.title.margin+c[0]));this.legend&&this.legend.display&&this.legend.adjustMargins(h,c);b(this,"getMargins");a||this.getAxisMargins()},
getAxisMargins:function(){var a=this,b=a.axisOffset=[0,0,0,0],c=a.margin;a.hasCartesianSeries&&e(a.axes,function(a){a.visible&&a.getOffset()});e(L,function(h,k){d(c[k])||(a[h]+=b[k])});a.setChartSize()},reflow:function(b){var c=this,h=c.options.chart,k=c.renderTo,v=d(h.width)&&d(h.height),e=h.width||a.getStyle(k,"width"),h=h.height||a.getStyle(k,"height"),k=b?b.target:Q;if(!v&&!c.isPrinting&&e&&h&&(k===Q||k===l)){if(e!==c.containerWidth||h!==c.containerHeight)a.clearTimeout(c.reflowTimeout),c.reflowTimeout=
A(function(){c.container&&c.setSize(void 0,void 0,!1)},b?100:0);c.containerWidth=e;c.containerHeight=h}},setReflow:function(a){var b=this;!1===a||this.unbindReflow?!1===a&&this.unbindReflow&&(this.unbindReflow=this.unbindReflow()):(this.unbindReflow=E(Q,"resize",function(a){b.reflow(a)}),E(this,"destroy",this.unbindReflow))},setSize:function(c,d,h){var k=this,v=k.renderer;k.isResizing+=1;a.setAnimation(h,k);k.oldChartHeight=k.chartHeight;k.oldChartWidth=k.chartWidth;void 0!==c&&(k.options.chart.width=
c);void 0!==d&&(k.options.chart.height=d);k.getChartSize();c=v.globalAnimation;(c?F:p)(k.container,{width:k.chartWidth+"px",height:k.chartHeight+"px"},c);k.setChartSize(!0);v.setSize(k.chartWidth,k.chartHeight,h);e(k.axes,function(a){a.isDirty=!0;a.setScale()});k.isDirtyLegend=!0;k.isDirtyBox=!0;k.layOutTitles();k.getMargins();k.redraw(h);k.oldChartHeight=null;b(k,"resize");A(function(){k&&b(k,"endResize",null,function(){--k.isResizing})},G(c).duration)},setChartSize:function(a){var c=this.inverted,
d=this.renderer,h=this.chartWidth,k=this.chartHeight,v=this.options.chart,w=this.spacing,n=this.clipOffset,g,m,p,A;this.plotLeft=g=Math.round(this.plotLeft);this.plotTop=m=Math.round(this.plotTop);this.plotWidth=p=Math.max(0,Math.round(h-g-this.marginRight));this.plotHeight=A=Math.max(0,Math.round(k-m-this.marginBottom));this.plotSizeX=c?A:p;this.plotSizeY=c?p:A;this.plotBorderWidth=v.plotBorderWidth||0;this.spacingBox=d.spacingBox={x:w[3],y:w[0],width:h-w[3]-w[1],height:k-w[0]-w[2]};this.plotBox=
d.plotBox={x:g,y:m,width:p,height:A};h=2*Math.floor(this.plotBorderWidth/2);c=Math.ceil(Math.max(h,n[3])/2);d=Math.ceil(Math.max(h,n[0])/2);this.clipBox={x:c,y:d,width:Math.floor(this.plotSizeX-Math.max(h,n[1])/2-c),height:Math.max(0,Math.floor(this.plotSizeY-Math.max(h,n[2])/2-d))};a||e(this.axes,function(a){a.setAxisSize();a.setAxisTranslation()});b(this,"afterSetChartSize",{skipAxes:a})},resetMargins:function(){var a=this,b=a.options.chart;e(["margin","spacing"],function(c){var d=b[c],h=B(d)?d:
[d,d,d,d];e(["Top","Right","Bottom","Left"],function(d,k){a[c][k]=I(b[c+d],h[k])})});e(L,function(b,c){a[b]=I(a.margin[c],a.spacing[c])});a.axisOffset=[0,0,0,0];a.clipOffset=[0,0,0,0]},drawChartBox:function(){var a=this.options.chart,c=this.renderer,d=this.chartWidth,h=this.chartHeight,k=this.chartBackground,v=this.plotBackground,e=this.plotBorder,w,n=this.plotBGImage,g=a.backgroundColor,m=a.plotBackgroundColor,p=a.plotBackgroundImage,A,H=this.plotLeft,z=this.plotTop,t=this.plotWidth,f=this.plotHeight,
D=this.plotBox,I=this.clipRect,l=this.clipBox,x="animate";k||(this.chartBackground=k=c.rect().addClass("highcharts-background").add(),x="attr");w=a.borderWidth||0;A=w+(a.shadow?8:0);g={fill:g||"none"};if(w||k["stroke-width"])g.stroke=a.borderColor,g["stroke-width"]=w;k.attr(g).shadow(a.shadow);k[x]({x:A/2,y:A/2,width:d-A-w%2,height:h-A-w%2,r:a.borderRadius});x="animate";v||(x="attr",this.plotBackground=v=c.rect().addClass("highcharts-plot-background").add());v[x](D);v.attr({fill:m||"none"}).shadow(a.plotShadow);
p&&(n?n.animate(D):this.plotBGImage=c.image(p,H,z,t,f).add());I?I.animate({width:l.width,height:l.height}):this.clipRect=c.clipRect(l);x="animate";e||(x="attr",this.plotBorder=e=c.rect().addClass("highcharts-plot-border").attr({zIndex:1}).add());e.attr({stroke:a.plotBorderColor,"stroke-width":a.plotBorderWidth||0,fill:"none"});e[x](e.crisp({x:H,y:z,width:t,height:f},-e.strokeWidth()));this.isDirtyBox=!1;b(this,"afterDrawChartBox")},propFromSeries:function(){var a=this,b=a.options.chart,c,d=a.options.series,
h,k;e(["inverted","angular","polar"],function(v){c=w[b.type||b.defaultSeriesType];k=b[v]||c&&c.prototype[v];for(h=d&&d.length;!k&&h--;)(c=w[d[h].type])&&c.prototype[v]&&(k=!0);a[v]=k})},linkSeries:function(){var a=this,c=a.series;e(c,function(a){a.linkedSeries.length=0});e(c,function(b){var c=b.options.linkedTo;t(c)&&(c=":previous"===c?a.series[b.index-1]:a.get(c))&&c.linkedParent!==b&&(c.linkedSeries.push(b),b.linkedParent=c,b.visible=I(b.options.visible,c.options.visible,b.visible))});b(this,"afterLinkSeries")},
renderSeries:function(){e(this.series,function(a){a.translate();a.render()})},renderLabels:function(){var a=this,b=a.options.labels;b.items&&e(b.items,function(c){var d=g(b.style,c.style),h=H(d.left)+a.plotLeft,k=H(d.top)+a.plotTop+12;delete d.left;delete d.top;a.renderer.text(c.html,h,k).attr({zIndex:2}).css(d).add()})},render:function(){var a=this.axes,b=this.renderer,c=this.options,d,h,k;this.setTitle();this.legend=new n(this,c.legend);this.getStacks&&this.getStacks();this.getMargins(!0);this.setChartSize();
c=this.plotWidth;d=this.plotHeight=Math.max(this.plotHeight-21,0);e(a,function(a){a.setScale()});this.getAxisMargins();h=1.1<c/this.plotWidth;k=1.05<d/this.plotHeight;if(h||k)e(a,function(a){(a.horiz&&h||!a.horiz&&k)&&a.setTickInterval(!0)}),this.getMargins();this.drawChartBox();this.hasCartesianSeries&&e(a,function(a){a.visible&&a.render()});this.seriesGroup||(this.seriesGroup=b.g("series-group").attr({zIndex:3}).add());this.renderSeries();this.renderLabels();this.addCredits();this.setResponsive&&
this.setResponsive();this.hasRendered=!0},addCredits:function(a){var b=this;a=z(!0,this.options.credits,a);a.enabled&&!this.credits&&(this.credits=this.renderer.text(a.text+(this.mapCredits||""),0,0).addClass("highcharts-credits").on("click",function(){a.href&&(Q.location.href=a.href)}).attr({align:a.position.align,zIndex:8}).css(a.style).add().align(a.position),this.credits.update=function(a){b.credits=b.credits.destroy();b.addCredits(a)})},destroy:function(){var c=this,d=c.axes,h=c.series,k=c.container,
w,g=k&&k.parentNode;b(c,"destroy");c.renderer.forExport?a.erase(y,c):y[c.index]=void 0;a.chartCount--;c.renderTo.removeAttribute("data-highcharts-chart");v(c);for(w=d.length;w--;)d[w]=d[w].destroy();this.scroller&&this.scroller.destroy&&this.scroller.destroy();for(w=h.length;w--;)h[w]=h[w].destroy();e("title subtitle chartBackground plotBackground plotBGImage plotBorder seriesGroup clipRect credits pointer rangeSelector legend resetZoomButton tooltip renderer".split(" "),function(a){var b=c[a];b&&
b.destroy&&(c[a]=b.destroy())});k&&(k.innerHTML="",v(k),g&&r(k));D(c,function(a,b){delete c[b]})},firstRender:function(){var a=this,c=a.options;if(!a.isReadyToRender||a.isReadyToRender()){a.getContainer();a.resetMargins();a.setChartSize();a.propFromSeries();a.getAxes();e(c.series||[],function(b){a.initSeries(b)});a.linkSeries();b(a,"beforeRender");h&&(a.pointer=new h(a,c));a.render();if(!a.renderer.imgCount&&a.onload)a.onload();a.temporaryDisplay(!0)}},onload:function(){e([this.callback].concat(this.callbacks),
function(a){a&&void 0!==this.index&&a.apply(this,[this])},this);b(this,"load");b(this,"render");d(this.index)&&this.setReflow(this.options.chart.reflow);this.onload=null}})})(J);(function(a){var E=a.addEvent,F=a.Chart,G=a.each;E(F,"afterSetChartSize",function(q){var l=this.options.chart.scrollablePlotArea;(l=l&&l.minWidth)&&!this.renderer.forExport&&(this.scrollablePixels=l=Math.max(0,l-this.chartWidth))&&(this.plotWidth+=l,this.clipBox.width+=l,q.skipAxes||G(this.axes,function(f){1===f.side?f.getPlotLinePath=
function(){var l=this.right,q;this.right=l-f.chart.scrollablePixels;q=a.Axis.prototype.getPlotLinePath.apply(this,arguments);this.right=l;return q}:(f.setAxisSize(),f.setAxisTranslation())}))});E(F,"render",function(){this.scrollablePixels?(this.setUpScrolling&&this.setUpScrolling(),this.applyFixed()):this.fixedDiv&&this.applyFixed()});F.prototype.setUpScrolling=function(){this.scrollingContainer=a.createElement("div",{className:"highcharts-scrolling"},{overflowX:"auto",WebkitOverflowScrolling:"touch"},
this.renderTo);this.innerContainer=a.createElement("div",{className:"highcharts-inner-container"},null,this.scrollingContainer);this.innerContainer.appendChild(this.container);this.setUpScrolling=null};F.prototype.applyFixed=function(){var q=this.container,l,f,u=!this.fixedDiv;u&&(this.fixedDiv=a.createElement("div",{className:"highcharts-fixed"},{position:"absolute",overflow:"hidden",pointerEvents:"none",zIndex:2},null,!0),this.renderTo.insertBefore(this.fixedDiv,this.renderTo.firstChild),this.fixedRenderer=
l=new a.Renderer(this.fixedDiv,0,0),this.scrollableMask=l.path().attr({fill:a.color(this.options.chart.backgroundColor||"#fff").setOpacity(.85).get(),zIndex:-1}).addClass("highcharts-scrollable-mask").add(),a.each([this.inverted?".highcharts-xaxis":".highcharts-yaxis",this.inverted?".highcharts-xaxis-labels":".highcharts-yaxis-labels",".highcharts-contextbutton",".highcharts-credits",".highcharts-legend",".highcharts-subtitle",".highcharts-title",".highcharts-legend-checkbox"],function(f){a.each(q.querySelectorAll(f),
function(a){(a.namespaceURI===l.SVG_NS?l.box:l.box.parentNode).appendChild(a);a.style.pointerEvents="auto"})}));this.fixedRenderer.setSize(this.chartWidth,this.chartHeight);f=this.chartWidth+this.scrollablePixels;a.stop(this.container);this.container.style.width=f+"px";this.renderer.boxWrapper.attr({width:f,height:this.chartHeight,viewBox:[0,0,f,this.chartHeight].join(" ")});this.chartBackground.attr({width:f});u&&(f=this.options.chart.scrollablePlotArea,f.scrollPositionX&&(this.scrollingContainer.scrollLeft=
this.scrollablePixels*f.scrollPositionX));u=this.axisOffset;f=this.plotTop-u[0]-1;var u=this.plotTop+this.plotHeight+u[2],C=this.plotLeft+this.plotWidth-this.scrollablePixels;this.scrollableMask.attr({d:this.scrollablePixels?["M",0,f,"L",this.plotLeft-1,f,"L",this.plotLeft-1,u,"L",0,u,"Z","M",C,f,"L",this.chartWidth,f,"L",this.chartWidth,u,"L",C,u,"Z"]:["M",0,0]})}})(J);(function(a){var E,F=a.each,G=a.extend,q=a.erase,l=a.fireEvent,f=a.format,u=a.isArray,C=a.isNumber,r=a.pick,y=a.removeEvent;a.Point=
E=function(){};a.Point.prototype={init:function(a,d,e){this.series=a;this.color=a.color;this.applyOptions(d,e);a.options.colorByPoint?(d=a.options.colors||a.chart.options.colors,this.color=this.color||d[a.colorCounter],d=d.length,e=a.colorCounter,a.colorCounter++,a.colorCounter===d&&(a.colorCounter=0)):e=a.colorIndex;this.colorIndex=r(this.colorIndex,e);a.chart.pointCount++;l(this,"afterInit");return this},applyOptions:function(a,d){var e=this.series,g=e.options.pointValKey||e.pointValKey;a=E.prototype.optionsToObject.call(this,
a);G(this,a);this.options=this.options?G(this.options,a):a;a.group&&delete this.group;g&&(this.y=this[g]);this.isNull=r(this.isValid&&!this.isValid(),null===this.x||!C(this.y,!0));this.selected&&(this.state="select");"name"in this&&void 0===d&&e.xAxis&&e.xAxis.hasNames&&(this.x=e.xAxis.nameToX(this));void 0===this.x&&e&&(this.x=void 0===d?e.autoIncrement(this):d);return this},setNestedProperty:function(p,d,e){e=e.split(".");a.reduce(e,function(e,m,b,c){e[m]=c.length-1===b?d:a.isObject(e[m],!0)?e[m]:
{};return e[m]},p);return p},optionsToObject:function(p){var d={},e=this.series,g=e.options.keys,m=g||e.pointArrayMap||["y"],b=m.length,c=0,f=0;if(C(p)||null===p)d[m[0]]=p;else if(u(p))for(!g&&p.length>b&&(e=typeof p[0],"string"===e?d.name=p[0]:"number"===e&&(d.x=p[0]),c++);f<b;)g&&void 0===p[c]||(0<m[f].indexOf(".")?a.Point.prototype.setNestedProperty(d,p[c],m[f]):d[m[f]]=p[c]),c++,f++;else"object"===typeof p&&(d=p,p.dataLabels&&(e._hasPointLabels=!0),p.marker&&(e._hasPointMarkers=!0));return d},
getClassName:function(){return"highcharts-point"+(this.selected?" highcharts-point-select":"")+(this.negative?" highcharts-negative":"")+(this.isNull?" highcharts-null-point":"")+(void 0!==this.colorIndex?" highcharts-color-"+this.colorIndex:"")+(this.options.className?" "+this.options.className:"")+(this.zone&&this.zone.className?" "+this.zone.className.replace("highcharts-negative",""):"")},getZone:function(){var a=this.series,d=a.zones,a=a.zoneAxis||"y",e=0,g;for(g=d[e];this[a]>=g.value;)g=d[++e];
this.nonZonedColor||(this.nonZonedColor=this.color);this.color=g&&g.color&&!this.options.color?g.color:this.nonZonedColor;return g},destroy:function(){var a=this.series.chart,d=a.hoverPoints,e;a.pointCount--;d&&(this.setState(),q(d,this),d.length||(a.hoverPoints=null));if(this===a.hoverPoint)this.onMouseOut();if(this.graphic||this.dataLabel)y(this),this.destroyElements();this.legendItem&&a.legend.destroyItem(this);for(e in this)this[e]=null},destroyElements:function(){for(var a=["graphic","dataLabel",
"dataLabelUpper","connector","shadowGroup"],d,e=6;e--;)d=a[e],this[d]&&(this[d]=this[d].destroy())},getLabelConfig:function(){return{x:this.category,y:this.y,color:this.color,colorIndex:this.colorIndex,key:this.name||this.category,series:this.series,point:this,percentage:this.percentage,total:this.total||this.stackTotal}},tooltipFormatter:function(a){var d=this.series,e=d.tooltipOptions,g=r(e.valueDecimals,""),m=e.valuePrefix||"",b=e.valueSuffix||"";F(d.pointArrayMap||["y"],function(c){c="{point."+
c;if(m||b)a=a.replace(RegExp(c+"}","g"),m+c+"}"+b);a=a.replace(RegExp(c+"}","g"),c+":,."+g+"f}")});return f(a,{point:this,series:this.series},d.chart.time)},firePointEvent:function(a,d,e){var g=this,m=this.series.options;(m.point.events[a]||g.options&&g.options.events&&g.options.events[a])&&this.importEvents();"click"===a&&m.allowPointSelect&&(e=function(a){g.select&&g.select(null,a.ctrlKey||a.metaKey||a.shiftKey)});l(this,a,d,e)},visible:!0}})(J);(function(a){var E=a.addEvent,F=a.animObject,G=a.arrayMax,
q=a.arrayMin,l=a.correctFloat,f=a.defaultOptions,u=a.defaultPlotOptions,C=a.defined,r=a.each,y=a.erase,p=a.extend,d=a.fireEvent,e=a.grep,g=a.isArray,m=a.isNumber,b=a.isString,c=a.merge,x=a.objectEach,B=a.pick,t=a.removeEvent,n=a.splat,L=a.SVGElement,z=a.syncTimeout,D=a.win;a.Series=a.seriesType("line",null,{lineWidth:2,allowPointSelect:!1,showCheckbox:!1,animation:{duration:1E3},events:{},marker:{lineWidth:0,lineColor:"#ffffff",enabledThreshold:2,radius:4,states:{normal:{animation:!0},hover:{animation:{duration:50},
enabled:!0,radiusPlus:2,lineWidthPlus:1},select:{fillColor:"#cccccc",lineColor:"#000000",lineWidth:2}}},point:{events:{}},dataLabels:{align:"center",formatter:function(){return null===this.y?"":a.numberFormat(this.y,-1)},style:{fontSize:"11px",fontWeight:"bold",color:"contrast",textOutline:"1px contrast"},verticalAlign:"bottom",x:0,y:0,padding:5},cropThreshold:300,pointRange:0,softThreshold:!0,states:{normal:{animation:!0},hover:{animation:{duration:50},lineWidthPlus:1,marker:{},halo:{size:10,opacity:.25}},
select:{}},stickyTracking:!0,turboThreshold:1E3,findNearestPointBy:"x"},{isCartesian:!0,pointClass:a.Point,sorted:!0,requireSorting:!0,directTouch:!1,axisTypes:["xAxis","yAxis"],colorCounter:0,parallelArrays:["x","y"],coll:"series",init:function(a,b){var c=this,h,e=a.series,k;c.chart=a;c.options=b=c.setOptions(b);c.linkedSeries=[];c.bindAxes();p(c,{name:b.name,state:"",visible:!1!==b.visible,selected:!0===b.selected});h=b.events;x(h,function(a,b){E(c,b,a)});if(h&&h.click||b.point&&b.point.events&&
b.point.events.click||b.allowPointSelect)a.runTrackerClick=!0;c.getColor();c.getSymbol();r(c.parallelArrays,function(a){c[a+"Data"]=[]});c.setData(b.data,!1);c.isCartesian&&(a.hasCartesianSeries=!0);e.length&&(k=e[e.length-1]);c._i=B(k&&k._i,-1)+1;a.orderSeries(this.insert(e));d(this,"afterInit")},insert:function(a){var b=this.options.index,c;if(m(b)){for(c=a.length;c--;)if(b>=B(a[c].options.index,a[c]._i)){a.splice(c+1,0,this);break}-1===c&&a.unshift(this);c+=1}else a.push(this);return B(c,a.length-
1)},bindAxes:function(){var b=this,c=b.options,d=b.chart,v;r(b.axisTypes||[],function(h){r(d[h],function(a){v=a.options;if(c[h]===v.index||void 0!==c[h]&&c[h]===v.id||void 0===c[h]&&0===v.index)b.insert(a.series),b[h]=a,a.isDirty=!0});b[h]||b.optionalAxis===h||a.error(18,!0)})},updateParallelArrays:function(a,b){var c=a.series,d=arguments,h=m(b)?function(d){var h="y"===d&&c.toYData?c.toYData(a):a[d];c[d+"Data"][b]=h}:function(a){Array.prototype[b].apply(c[a+"Data"],Array.prototype.slice.call(d,2))};
r(c.parallelArrays,h)},autoIncrement:function(){var a=this.options,b=this.xIncrement,c,d=a.pointIntervalUnit,e=this.chart.time,b=B(b,a.pointStart,0);this.pointInterval=c=B(this.pointInterval,a.pointInterval,1);d&&(a=new e.Date(b),"day"===d?e.set("Date",a,e.get("Date",a)+c):"month"===d?e.set("Month",a,e.get("Month",a)+c):"year"===d&&e.set("FullYear",a,e.get("FullYear",a)+c),c=a.getTime()-b);this.xIncrement=b+c;return b},setOptions:function(a){var b=this.chart,h=b.options,v=h.plotOptions,e=(b.userOptions||
{}).plotOptions||{},k=v[this.type];this.userOptions=a;b=c(k,v.series,a);this.tooltipOptions=c(f.tooltip,f.plotOptions.series&&f.plotOptions.series.tooltip,f.plotOptions[this.type].tooltip,h.tooltip.userOptions,v.series&&v.series.tooltip,v[this.type].tooltip,a.tooltip);this.stickyTracking=B(a.stickyTracking,e[this.type]&&e[this.type].stickyTracking,e.series&&e.series.stickyTracking,this.tooltipOptions.shared&&!this.noSharedTooltip?!0:b.stickyTracking);null===k.marker&&delete b.marker;this.zoneAxis=
b.zoneAxis;a=this.zones=(b.zones||[]).slice();!b.negativeColor&&!b.negativeFillColor||b.zones||a.push({value:b[this.zoneAxis+"Threshold"]||b.threshold||0,className:"highcharts-negative",color:b.negativeColor,fillColor:b.negativeFillColor});a.length&&C(a[a.length-1].value)&&a.push({color:this.color,fillColor:this.fillColor});d(this,"afterSetOptions",{options:b});return b},getName:function(){return this.name||"Series "+(this.index+1)},getCyclic:function(a,b,c){var d,h=this.chart,k=this.userOptions,
e=a+"Index",n=a+"Counter",g=c?c.length:B(h.options.chart[a+"Count"],h[a+"Count"]);b||(d=B(k[e],k["_"+e]),C(d)||(h.series.length||(h[n]=0),k["_"+e]=d=h[n]%g,h[n]+=1),c&&(b=c[d]));void 0!==d&&(this[e]=d);this[a]=b},getColor:function(){this.options.colorByPoint?this.options.color=null:this.getCyclic("color",this.options.color||u[this.type].color,this.chart.options.colors)},getSymbol:function(){this.getCyclic("symbol",this.options.marker.symbol,this.chart.options.symbols)},drawLegendSymbol:a.LegendSymbolMixin.drawLineMarker,
updateData:function(b){var c=this.options,d=this.points,h=[],e,k,n,g=this.requireSorting;r(b,function(b){var k;k=a.defined(b)&&this.pointClass.prototype.optionsToObject.call({series:this},b).x;m(k)&&(k=a.inArray(k,this.xData,n),-1===k||d[k].touched?h.push(b):b!==c.data[k]?(d[k].update(b,!1,null,!1),d[k].touched=!0,g&&(n=k+1)):d[k]&&(d[k].touched=!0),e=!0)},this);if(e)for(b=d.length;b--;)k=d[b],k.touched||k.remove(!1),k.touched=!1;else if(b.length===d.length)r(b,function(a,b){d[b].update&&a!==c.data[b]&&
d[b].update(a,!1,null,!1)});else return!1;r(h,function(a){this.addPoint(a,!1)},this);return!0},setData:function(c,d,e,v){var h=this,k=h.points,n=k&&k.length||0,z,t=h.options,f=h.chart,p=null,D=h.xAxis,l=t.turboThreshold,x=this.xData,H=this.yData,I=(z=h.pointArrayMap)&&z.length,q;c=c||[];z=c.length;d=B(d,!0);!1!==v&&z&&n&&!h.cropped&&!h.hasGroupedData&&h.visible&&!h.isSeriesBoosting&&(q=this.updateData(c));if(!q){h.xIncrement=null;h.colorCounter=0;r(this.parallelArrays,function(a){h[a+"Data"].length=
0});if(l&&z>l){for(e=0;null===p&&e<z;)p=c[e],e++;if(m(p))for(e=0;e<z;e++)x[e]=this.autoIncrement(),H[e]=c[e];else if(g(p))if(I)for(e=0;e<z;e++)p=c[e],x[e]=p[0],H[e]=p.slice(1,I+1);else for(e=0;e<z;e++)p=c[e],x[e]=p[0],H[e]=p[1];else a.error(12)}else for(e=0;e<z;e++)void 0!==c[e]&&(p={series:h},h.pointClass.prototype.applyOptions.apply(p,[c[e]]),h.updateParallelArrays(p,e));H&&b(H[0])&&a.error(14,!0);h.data=[];h.options.data=h.userOptions.data=c;for(e=n;e--;)k[e]&&k[e].destroy&&k[e].destroy();D&&(D.minRange=
D.userMinRange);h.isDirty=f.isDirtyBox=!0;h.isDirtyData=!!k;e=!1}"point"===t.legendType&&(this.processData(),this.generatePoints());d&&f.redraw(e)},processData:function(b){var c=this.xData,d=this.yData,h=c.length,e;e=0;var k,n,g=this.xAxis,m,z=this.options;m=z.cropThreshold;var p=this.getExtremesFromAll||z.getExtremesFromAll,t=this.isCartesian,z=g&&g.val2lin,f=g&&g.isLog,D=this.requireSorting,l,x;if(t&&!this.isDirty&&!g.isDirty&&!this.yAxis.isDirty&&!b)return!1;g&&(b=g.getExtremes(),l=b.min,x=b.max);
t&&this.sorted&&!p&&(!m||h>m||this.forceCrop)&&(c[h-1]<l||c[0]>x?(c=[],d=[]):this.yData&&(c[0]<l||c[h-1]>x)&&(e=this.cropData(this.xData,this.yData,l,x),c=e.xData,d=e.yData,e=e.start,k=!0));for(m=c.length||1;--m;)h=f?z(c[m])-z(c[m-1]):c[m]-c[m-1],0<h&&(void 0===n||h<n)?n=h:0>h&&D&&(a.error(15),D=!1);this.cropped=k;this.cropStart=e;this.processedXData=c;this.processedYData=d;this.closestPointRange=n},cropData:function(a,b,c,d,e){var k=a.length,h=0,v=k,n;e=B(e,this.cropShoulder,1);for(n=0;n<k;n++)if(a[n]>=
c){h=Math.max(0,n-e);break}for(c=n;c<k;c++)if(a[c]>d){v=c+e;break}return{xData:a.slice(h,v),yData:b.slice(h,v),start:h,end:v}},generatePoints:function(){var a=this.options,b=a.data,c=this.data,d,e=this.processedXData,k=this.processedYData,g=this.pointClass,m=e.length,z=this.cropStart||0,t,f=this.hasGroupedData,a=a.keys,D,l=[],x;c||f||(c=[],c.length=b.length,c=this.data=c);a&&f&&(this.options.keys=!1);for(x=0;x<m;x++)t=z+x,f?(D=(new g).init(this,[e[x]].concat(n(k[x]))),D.dataGroup=this.groupMap[x],
D.dataGroup.options&&(D.options=D.dataGroup.options,p(D,D.dataGroup.options))):(D=c[t])||void 0===b[t]||(c[t]=D=(new g).init(this,b[t],e[x])),D&&(D.index=t,l[x]=D);this.options.keys=a;if(c&&(m!==(d=c.length)||f))for(x=0;x<d;x++)x!==z||f||(x+=m),c[x]&&(c[x].destroyElements(),c[x].plotX=void 0);this.data=c;this.points=l},getExtremes:function(a){var b=this.yAxis,c=this.processedXData,d,h=[],k=0;d=this.xAxis.getExtremes();var e=d.min,n=d.max,z,t,f=this.requireSorting?1:0,p,D;a=a||this.stackedYData||this.processedYData||
[];d=a.length;for(D=0;D<d;D++)if(t=c[D],p=a[D],z=(m(p,!0)||g(p))&&(!b.positiveValuesOnly||p.length||0<p),t=this.getExtremesFromAll||this.options.getExtremesFromAll||this.cropped||(c[D+f]||t)>=e&&(c[D-f]||t)<=n,z&&t)if(z=p.length)for(;z--;)"number"===typeof p[z]&&(h[k++]=p[z]);else h[k++]=p;this.dataMin=q(h);this.dataMax=G(h)},translate:function(){this.processedXData||this.processData();this.generatePoints();var a=this.options,b=a.stacking,c=this.xAxis,e=c.categories,n=this.yAxis,k=this.points,g=k.length,
z=!!this.modifyValue,p=a.pointPlacement,t="between"===p||m(p),f=a.threshold,D=a.startFromThreshold?f:0,x,r,q,u,L=Number.MAX_VALUE;"between"===p&&(p=.5);m(p)&&(p*=B(a.pointRange||c.pointRange));for(a=0;a<g;a++){var y=k[a],F=y.x,E=y.y;r=y.low;var G=b&&n.stacks[(this.negStacks&&E<(D?0:f)?"-":"")+this.stackKey],J;n.positiveValuesOnly&&null!==E&&0>=E&&(y.isNull=!0);y.plotX=x=l(Math.min(Math.max(-1E5,c.translate(F,0,0,0,1,p,"flags"===this.type)),1E5));b&&this.visible&&!y.isNull&&G&&G[F]&&(u=this.getStackIndicator(u,
F,this.index),J=G[F],E=J.points[u.key],r=E[0],E=E[1],r===D&&u.key===G[F].base&&(r=B(m(f)&&f,n.min)),n.positiveValuesOnly&&0>=r&&(r=null),y.total=y.stackTotal=J.total,y.percentage=J.total&&y.y/J.total*100,y.stackY=E,J.setOffset(this.pointXOffset||0,this.barW||0));y.yBottom=C(r)?Math.min(Math.max(-1E5,n.translate(r,0,1,0,1)),1E5):null;z&&(E=this.modifyValue(E,y));y.plotY=r="number"===typeof E&&Infinity!==E?Math.min(Math.max(-1E5,n.translate(E,0,1,0,1)),1E5):void 0;y.isInside=void 0!==r&&0<=r&&r<=n.len&&
0<=x&&x<=c.len;y.clientX=t?l(c.translate(F,0,0,0,1,p)):x;y.negative=y.y<(f||0);y.category=e&&void 0!==e[y.x]?e[y.x]:y.x;y.isNull||(void 0!==q&&(L=Math.min(L,Math.abs(x-q))),q=x);y.zone=this.zones.length&&y.getZone()}this.closestPointRangePx=L;d(this,"afterTranslate")},getValidPoints:function(a,b){var c=this.chart;return e(a||this.points||[],function(a){return b&&!c.isInsidePlot(a.plotX,a.plotY,c.inverted)?!1:!a.isNull})},setClip:function(a){var b=this.chart,c=this.options,d=b.renderer,h=b.inverted,
k=this.clipBox,e=k||b.clipBox,n=this.sharedClipKey||["_sharedClip",a&&a.duration,a&&a.easing,e.height,c.xAxis,c.yAxis].join(),g=b[n],m=b[n+"m"];g||(a&&(e.width=0,h&&(e.x=b.plotSizeX),b[n+"m"]=m=d.clipRect(h?b.plotSizeX+99:-99,h?-b.plotLeft:-b.plotTop,99,h?b.chartWidth:b.chartHeight)),b[n]=g=d.clipRect(e),g.count={length:0});a&&!g.count[this.index]&&(g.count[this.index]=!0,g.count.length+=1);!1!==c.clip&&(this.group.clip(a||k?g:b.clipRect),this.markerGroup.clip(m),this.sharedClipKey=n);a||(g.count[this.index]&&
(delete g.count[this.index],--g.count.length),0===g.count.length&&n&&b[n]&&(k||(b[n]=b[n].destroy()),b[n+"m"]&&(b[n+"m"]=b[n+"m"].destroy())))},animate:function(a){var b=this.chart,c=F(this.options.animation),d;a?this.setClip(c):(d=this.sharedClipKey,(a=b[d])&&a.animate({width:b.plotSizeX,x:0},c),b[d+"m"]&&b[d+"m"].animate({width:b.plotSizeX+99,x:0},c),this.animate=null)},afterAnimate:function(){this.setClip();d(this,"afterAnimate");this.finishedAnimating=!0},drawPoints:function(){var a=this.points,
b=this.chart,c,d,e,k,n=this.options.marker,g,m,z,p=this[this.specialGroup]||this.markerGroup,t,f=B(n.enabled,this.xAxis.isRadial?!0:null,this.closestPointRangePx>=n.enabledThreshold*n.radius);if(!1!==n.enabled||this._hasPointMarkers)for(c=0;c<a.length;c++)d=a[c],k=d.graphic,g=d.marker||{},m=!!d.marker,e=f&&void 0===g.enabled||g.enabled,z=d.isInside,e&&!d.isNull?(e=B(g.symbol,this.symbol),t=this.markerAttribs(d,d.selected&&"select"),k?k[z?"show":"hide"](!0).animate(t):z&&(0<t.width||d.hasImage)&&(d.graphic=
k=b.renderer.symbol(e,t.x,t.y,t.width,t.height,m?g:n).add(p)),k&&k.attr(this.pointAttribs(d,d.selected&&"select")),k&&k.addClass(d.getClassName(),!0)):k&&(d.graphic=k.destroy())},markerAttribs:function(a,b){var c=this.options.marker,d=a.marker||{},h=d.symbol||c.symbol,k=B(d.radius,c.radius);b&&(c=c.states[b],b=d.states&&d.states[b],k=B(b&&b.radius,c&&c.radius,k+(c&&c.radiusPlus||0)));a.hasImage=h&&0===h.indexOf("url");a.hasImage&&(k=0);a={x:Math.floor(a.plotX)-k,y:a.plotY-k};k&&(a.width=a.height=
2*k);return a},pointAttribs:function(a,b){var c=this.options.marker,d=a&&a.options,h=d&&d.marker||{},k=this.color,e=d&&d.color,n=a&&a.color,d=B(h.lineWidth,c.lineWidth);a=a&&a.zone&&a.zone.color;k=e||a||n||k;a=h.fillColor||c.fillColor||k;k=h.lineColor||c.lineColor||k;b&&(c=c.states[b],b=h.states&&h.states[b]||{},d=B(b.lineWidth,c.lineWidth,d+B(b.lineWidthPlus,c.lineWidthPlus,0)),a=b.fillColor||c.fillColor||a,k=b.lineColor||c.lineColor||k);return{stroke:k,"stroke-width":d,fill:a}},destroy:function(){var b=
this,c=b.chart,e=/AppleWebKit\/533/.test(D.navigator.userAgent),v,n,k=b.data||[],g,m;d(b,"destroy");t(b);r(b.axisTypes||[],function(a){(m=b[a])&&m.series&&(y(m.series,b),m.isDirty=m.forceRedraw=!0)});b.legendItem&&b.chart.legend.destroyItem(b);for(n=k.length;n--;)(g=k[n])&&g.destroy&&g.destroy();b.points=null;a.clearTimeout(b.animationTimeout);x(b,function(a,b){a instanceof L&&!a.survive&&(v=e&&"group"===b?"hide":"destroy",a[v]())});c.hoverSeries===b&&(c.hoverSeries=null);y(c.series,b);c.orderSeries();
x(b,function(a,c){delete b[c]})},getGraphPath:function(a,b,c){var d=this,e=d.options,k=e.step,h,n=[],g=[],m;a=a||d.points;(h=a.reversed)&&a.reverse();(k={right:1,center:2}[k]||k&&3)&&h&&(k=4-k);!e.connectNulls||b||c||(a=this.getValidPoints(a));r(a,function(h,v){var w=h.plotX,z=h.plotY,p=a[v-1];(h.leftCliff||p&&p.rightCliff)&&!c&&(m=!0);h.isNull&&!C(b)&&0<v?m=!e.connectNulls:h.isNull&&!b?m=!0:(0===v||m?v=["M",h.plotX,h.plotY]:d.getPointSpline?v=d.getPointSpline(a,h,v):k?(v=1===k?["L",p.plotX,z]:2===
k?["L",(p.plotX+w)/2,p.plotY,"L",(p.plotX+w)/2,z]:["L",w,p.plotY],v.push("L",w,z)):v=["L",w,z],g.push(h.x),k&&(g.push(h.x),2===k&&g.push(h.x)),n.push.apply(n,v),m=!1)});n.xMap=g;return d.graphPath=n},drawGraph:function(){var a=this,b=this.options,c=(this.gappedPath||this.getGraphPath).call(this),d=[["graph","highcharts-graph",b.lineColor||this.color,b.dashStyle]],d=a.getZonesGraphs(d);r(d,function(d,k){var e=d[0],h=a[e];h?(h.endX=a.preventGraphAnimation?null:c.xMap,h.animate({d:c})):c.length&&(a[e]=
a.chart.renderer.path(c).addClass(d[1]).attr({zIndex:1}).add(a.group),h={stroke:d[2],"stroke-width":b.lineWidth,fill:a.fillGraph&&a.color||"none"},d[3]?h.dashstyle=d[3]:"square"!==b.linecap&&(h["stroke-linecap"]=h["stroke-linejoin"]="round"),h=a[e].attr(h).shadow(2>k&&b.shadow));h&&(h.startX=c.xMap,h.isArea=c.isArea)})},getZonesGraphs:function(a){r(this.zones,function(b,c){a.push(["zone-graph-"+c,"highcharts-graph highcharts-zone-graph-"+c+" "+(b.className||""),b.color||this.color,b.dashStyle||this.options.dashStyle])},
this);return a},applyZones:function(){var a=this,b=this.chart,c=b.renderer,d=this.zones,e,k,n=this.clips||[],g,m=this.graph,z=this.area,p=Math.max(b.chartWidth,b.chartHeight),t=this[(this.zoneAxis||"y")+"Axis"],f,D,l=b.inverted,x,q,u,L,y=!1;d.length&&(m||z)&&t&&void 0!==t.min&&(D=t.reversed,x=t.horiz,m&&!this.showLine&&m.hide(),z&&z.hide(),f=t.getExtremes(),r(d,function(d,h){e=D?x?b.plotWidth:0:x?0:t.toPixels(f.min);e=Math.min(Math.max(B(k,e),0),p);k=Math.min(Math.max(Math.round(t.toPixels(B(d.value,
f.max),!0)),0),p);y&&(e=k=t.toPixels(f.max));q=Math.abs(e-k);u=Math.min(e,k);L=Math.max(e,k);t.isXAxis?(g={x:l?L:u,y:0,width:q,height:p},x||(g.x=b.plotHeight-g.x)):(g={x:0,y:l?L:u,width:p,height:q},x&&(g.y=b.plotWidth-g.y));l&&c.isVML&&(g=t.isXAxis?{x:0,y:D?u:L,height:g.width,width:b.chartWidth}:{x:g.y-b.plotLeft-b.spacingBox.x,y:0,width:g.height,height:b.chartHeight});n[h]?n[h].animate(g):(n[h]=c.clipRect(g),m&&a["zone-graph-"+h].clip(n[h]),z&&a["zone-area-"+h].clip(n[h]));y=d.value>f.max;a.resetZones&&
0===k&&(k=void 0)}),this.clips=n)},invertGroups:function(a){function b(){r(["group","markerGroup"],function(b){c[b]&&(d.renderer.isVML&&c[b].attr({width:c.yAxis.len,height:c.xAxis.len}),c[b].width=c.yAxis.len,c[b].height=c.xAxis.len,c[b].invert(a))})}var c=this,d=c.chart,e;c.xAxis&&(e=E(d,"resize",b),E(c,"destroy",e),b(a),c.invertGroups=b)},plotGroup:function(a,b,c,d,e){var k=this[a],h=!k;h&&(this[a]=k=this.chart.renderer.g().attr({zIndex:d||.1}).add(e));k.addClass("highcharts-"+b+" highcharts-series-"+
this.index+" highcharts-"+this.type+"-series "+(C(this.colorIndex)?"highcharts-color-"+this.colorIndex+" ":"")+(this.options.className||"")+(k.hasClass("highcharts-tracker")?" highcharts-tracker":""),!0);k.attr({visibility:c})[h?"attr":"animate"](this.getPlotBox());return k},getPlotBox:function(){var a=this.chart,b=this.xAxis,c=this.yAxis;a.inverted&&(b=c,c=this.xAxis);return{translateX:b?b.left:a.plotLeft,translateY:c?c.top:a.plotTop,scaleX:1,scaleY:1}},render:function(){var a=this,b=a.chart,c,e=
a.options,n=!!a.animate&&b.renderer.isSVG&&F(e.animation).duration,k=a.visible?"inherit":"hidden",g=e.zIndex,m=a.hasRendered,p=b.seriesGroup,t=b.inverted;c=a.plotGroup("group","series",k,g,p);a.markerGroup=a.plotGroup("markerGroup","markers",k,g,p);n&&a.animate(!0);c.inverted=a.isCartesian?t:!1;a.drawGraph&&(a.drawGraph(),a.applyZones());a.drawDataLabels&&a.drawDataLabels();a.visible&&a.drawPoints();a.drawTracker&&!1!==a.options.enableMouseTracking&&a.drawTracker();a.invertGroups(t);!1===e.clip||
a.sharedClipKey||m||c.clip(b.clipRect);n&&a.animate();m||(a.animationTimeout=z(function(){a.afterAnimate()},n));a.isDirty=!1;a.hasRendered=!0;d(a,"afterRender")},redraw:function(){var a=this.chart,b=this.isDirty||this.isDirtyData,c=this.group,d=this.xAxis,e=this.yAxis;c&&(a.inverted&&c.attr({width:a.plotWidth,height:a.plotHeight}),c.animate({translateX:B(d&&d.left,a.plotLeft),translateY:B(e&&e.top,a.plotTop)}));this.translate();this.render();b&&delete this.kdTree},kdAxisArray:["clientX","plotY"],
searchPoint:function(a,b){var c=this.xAxis,d=this.yAxis,e=this.chart.inverted;return this.searchKDTree({clientX:e?c.len-a.chartY+c.pos:a.chartX-c.pos,plotY:e?d.len-a.chartX+d.pos:a.chartY-d.pos},b)},buildKDTree:function(){function a(c,d,k){var e,h;if(h=c&&c.length)return e=b.kdAxisArray[d%k],c.sort(function(a,b){return a[e]-b[e]}),h=Math.floor(h/2),{point:c[h],left:a(c.slice(0,h),d+1,k),right:a(c.slice(h+1),d+1,k)}}this.buildingKdTree=!0;var b=this,c=-1<b.options.findNearestPointBy.indexOf("y")?2:
1;delete b.kdTree;z(function(){b.kdTree=a(b.getValidPoints(null,!b.directTouch),c,c);b.buildingKdTree=!1},b.options.kdNow?0:1)},searchKDTree:function(a,b){function c(a,b,n,g){var v=b.point,m=d.kdAxisArray[n%g],w,z,p=v;z=C(a[e])&&C(v[e])?Math.pow(a[e]-v[e],2):null;w=C(a[k])&&C(v[k])?Math.pow(a[k]-v[k],2):null;w=(z||0)+(w||0);v.dist=C(w)?Math.sqrt(w):Number.MAX_VALUE;v.distX=C(z)?Math.sqrt(z):Number.MAX_VALUE;m=a[m]-v[m];w=0>m?"left":"right";z=0>m?"right":"left";b[w]&&(w=c(a,b[w],n+1,g),p=w[h]<p[h]?
w:v);b[z]&&Math.sqrt(m*m)<p[h]&&(a=c(a,b[z],n+1,g),p=a[h]<p[h]?a:p);return p}var d=this,e=this.kdAxisArray[0],k=this.kdAxisArray[1],h=b?"distX":"dist";b=-1<d.options.findNearestPointBy.indexOf("y")?2:1;this.kdTree||this.buildingKdTree||this.buildKDTree();if(this.kdTree)return c(a,this.kdTree,b,b)}})})(J);(function(a){var E=a.Axis,F=a.Chart,G=a.correctFloat,q=a.defined,l=a.destroyObjectProperties,f=a.each,u=a.format,C=a.objectEach,r=a.pick,y=a.Series;a.StackItem=function(a,d,e,g,m){var b=a.chart.inverted;
this.axis=a;this.isNegative=e;this.options=d;this.x=g;this.total=null;this.points={};this.stack=m;this.rightCliff=this.leftCliff=0;this.alignOptions={align:d.align||(b?e?"left":"right":"center"),verticalAlign:d.verticalAlign||(b?"middle":e?"bottom":"top"),y:r(d.y,b?4:e?14:-6),x:r(d.x,b?e?-6:6:0)};this.textAlign=d.textAlign||(b?e?"right":"left":"center")};a.StackItem.prototype={destroy:function(){l(this,this.axis)},render:function(a){var d=this.axis.chart,e=this.options,g=e.format,g=g?u(g,this,d.time):
e.formatter.call(this);this.label?this.label.attr({text:g,visibility:"hidden"}):this.label=d.renderer.text(g,null,null,e.useHTML).css(e.style).attr({align:this.textAlign,rotation:e.rotation,visibility:"hidden"}).add(a);this.label.labelrank=d.plotHeight},setOffset:function(a,d){var e=this.axis,g=e.chart,m=e.translate(e.usePercentage?100:this.total,0,0,0,1),b=e.translate(0),b=q(m)&&Math.abs(m-b);a=g.xAxis[0].translate(this.x)+a;e=q(m)&&this.getStackBox(g,this,a,m,d,b,e);(d=this.label)&&e&&(d.align(this.alignOptions,
null,e),e=d.alignAttr,d[!1===this.options.crop||g.isInsidePlot(e.x,e.y)?"show":"hide"](!0))},getStackBox:function(a,d,e,g,m,b,c){var p=d.axis.reversed,f=a.inverted;a=c.height+c.pos-(f?a.plotLeft:a.plotTop);d=d.isNegative&&!p||!d.isNegative&&p;return{x:f?d?g:g-b:e,y:f?a-e-m:d?a-g-b:a-g,width:f?b:m,height:f?m:b}}};F.prototype.getStacks=function(){var a=this;f(a.yAxis,function(a){a.stacks&&a.hasVisibleSeries&&(a.oldStacks=a.stacks)});f(a.series,function(d){!d.options.stacking||!0!==d.visible&&!1!==a.options.chart.ignoreHiddenSeries||
(d.stackKey=d.type+r(d.options.stack,""))})};E.prototype.buildStacks=function(){var a=this.series,d=r(this.options.reversedStacks,!0),e=a.length,g;if(!this.isXAxis){this.usePercentage=!1;for(g=e;g--;)a[d?g:e-g-1].setStackedPoints();for(g=0;g<e;g++)a[g].modifyStacks()}};E.prototype.renderStackTotals=function(){var a=this.chart,d=a.renderer,e=this.stacks,g=this.stackTotalGroup;g||(this.stackTotalGroup=g=d.g("stack-labels").attr({visibility:"visible",zIndex:6}).add());g.translate(a.plotLeft,a.plotTop);
C(e,function(a){C(a,function(a){a.render(g)})})};E.prototype.resetStacks=function(){var a=this,d=a.stacks;a.isXAxis||C(d,function(d){C(d,function(e,m){e.touched<a.stacksTouched?(e.destroy(),delete d[m]):(e.total=null,e.cumulative=null)})})};E.prototype.cleanStacks=function(){var a;this.isXAxis||(this.oldStacks&&(a=this.stacks=this.oldStacks),C(a,function(a){C(a,function(a){a.cumulative=a.total})}))};y.prototype.setStackedPoints=function(){if(this.options.stacking&&(!0===this.visible||!1===this.chart.options.chart.ignoreHiddenSeries)){var f=
this.processedXData,d=this.processedYData,e=[],g=d.length,m=this.options,b=m.threshold,c=r(m.startFromThreshold&&b,0),l=m.stack,m=m.stacking,B=this.stackKey,t="-"+B,n=this.negStacks,u=this.yAxis,z=u.stacks,D=u.oldStacks,h,I,H,v,w,k,A;u.stacksTouched+=1;for(w=0;w<g;w++)k=f[w],A=d[w],h=this.getStackIndicator(h,k,this.index),v=h.key,H=(I=n&&A<(c?0:b))?t:B,z[H]||(z[H]={}),z[H][k]||(D[H]&&D[H][k]?(z[H][k]=D[H][k],z[H][k].total=null):z[H][k]=new a.StackItem(u,u.options.stackLabels,I,k,l)),H=z[H][k],null!==
A?(H.points[v]=H.points[this.index]=[r(H.cumulative,c)],q(H.cumulative)||(H.base=v),H.touched=u.stacksTouched,0<h.index&&!1===this.singleStacks&&(H.points[v][0]=H.points[this.index+","+k+",0"][0])):H.points[v]=H.points[this.index]=null,"percent"===m?(I=I?B:t,n&&z[I]&&z[I][k]?(I=z[I][k],H.total=I.total=Math.max(I.total,H.total)+Math.abs(A)||0):H.total=G(H.total+(Math.abs(A)||0))):H.total=G(H.total+(A||0)),H.cumulative=r(H.cumulative,c)+(A||0),null!==A&&(H.points[v].push(H.cumulative),e[w]=H.cumulative);
"percent"===m&&(u.usePercentage=!0);this.stackedYData=e;u.oldStacks={}}};y.prototype.modifyStacks=function(){var a=this,d=a.stackKey,e=a.yAxis.stacks,g=a.processedXData,m,b=a.options.stacking;a[b+"Stacker"]&&f([d,"-"+d],function(c){for(var d=g.length,f,t;d--;)if(f=g[d],m=a.getStackIndicator(m,f,a.index,c),t=(f=e[c]&&e[c][f])&&f.points[m.key])a[b+"Stacker"](t,f,d)})};y.prototype.percentStacker=function(a,d,e){d=d.total?100/d.total:0;a[0]=G(a[0]*d);a[1]=G(a[1]*d);this.stackedYData[e]=a[1]};y.prototype.getStackIndicator=
function(a,d,e,g){!q(a)||a.x!==d||g&&a.key!==g?a={x:d,index:0,key:g}:a.index++;a.key=[e,d,a.index].join();return a}})(J);(function(a){var E=a.addEvent,F=a.animate,G=a.Axis,q=a.createElement,l=a.css,f=a.defined,u=a.each,C=a.erase,r=a.extend,y=a.fireEvent,p=a.inArray,d=a.isNumber,e=a.isObject,g=a.isArray,m=a.merge,b=a.objectEach,c=a.pick,x=a.Point,B=a.Series,t=a.seriesTypes,n=a.setAnimation,L=a.splat;r(a.Chart.prototype,{addSeries:function(a,b,d){var e,h=this;a&&(b=c(b,!0),y(h,"addSeries",{options:a},
function(){e=h.initSeries(a);h.isDirtyLegend=!0;h.linkSeries();y(h,"afterAddSeries");b&&h.redraw(d)}));return e},addAxis:function(a,b,d,e){var h=b?"xAxis":"yAxis",n=this.options;a=m(a,{index:this[h].length,isX:b});b=new G(this,a);n[h]=L(n[h]||{});n[h].push(a);c(d,!0)&&this.redraw(e);return b},showLoading:function(a){var b=this,c=b.options,d=b.loadingDiv,e=c.loading,n=function(){d&&l(d,{left:b.plotLeft+"px",top:b.plotTop+"px",width:b.plotWidth+"px",height:b.plotHeight+"px"})};d||(b.loadingDiv=d=q("div",
{className:"highcharts-loading highcharts-loading-hidden"},null,b.container),b.loadingSpan=q("span",{className:"highcharts-loading-inner"},null,d),E(b,"redraw",n));d.className="highcharts-loading";b.loadingSpan.innerHTML=a||c.lang.loading;l(d,r(e.style,{zIndex:10}));l(b.loadingSpan,e.labelStyle);b.loadingShown||(l(d,{opacity:0,display:""}),F(d,{opacity:e.style.opacity||.5},{duration:e.showDuration||0}));b.loadingShown=!0;n()},hideLoading:function(){var a=this.options,b=this.loadingDiv;b&&(b.className=
"highcharts-loading highcharts-loading-hidden",F(b,{opacity:0},{duration:a.loading.hideDuration||100,complete:function(){l(b,{display:"none"})}}));this.loadingShown=!1},propsRequireDirtyBox:"backgroundColor borderColor borderWidth margin marginTop marginRight marginBottom marginLeft spacing spacingTop spacingRight spacingBottom spacingLeft borderRadius plotBackgroundColor plotBackgroundImage plotBorderColor plotBorderWidth plotShadow shadow".split(" "),propsRequireUpdateSeries:"chart.inverted chart.polar chart.ignoreHiddenSeries chart.type colors plotOptions time tooltip".split(" "),
update:function(a,e,h,n){var g=this,v={credits:"addCredits",title:"setTitle",subtitle:"setSubtitle"},w=a.chart,k,t,z=[];y(g,"update",{options:a});if(w){m(!0,g.options.chart,w);"className"in w&&g.setClassName(w.className);"reflow"in w&&g.setReflow(w.reflow);if("inverted"in w||"polar"in w||"type"in w)g.propFromSeries(),k=!0;"alignTicks"in w&&(k=!0);b(w,function(a,b){-1!==p("chart."+b,g.propsRequireUpdateSeries)&&(t=!0);-1!==p(b,g.propsRequireDirtyBox)&&(g.isDirtyBox=!0)});"style"in w&&g.renderer.setStyle(w.style)}a.colors&&
(this.options.colors=a.colors);a.plotOptions&&m(!0,this.options.plotOptions,a.plotOptions);b(a,function(a,b){if(g[b]&&"function"===typeof g[b].update)g[b].update(a,!1);else if("function"===typeof g[v[b]])g[v[b]](a);"chart"!==b&&-1!==p(b,g.propsRequireUpdateSeries)&&(t=!0)});u("xAxis yAxis zAxis series colorAxis pane".split(" "),function(b){var c;a[b]&&("series"===b&&(c=[],u(g[b],function(a,b){a.options.isInternal||c.push(b)})),u(L(a[b]),function(a,d){(d=f(a.id)&&g.get(a.id)||g[b][c?c[d]:d])&&d.coll===
b&&(d.update(a,!1),h&&(d.touched=!0));if(!d&&h)if("series"===b)g.addSeries(a,!1).touched=!0;else if("xAxis"===b||"yAxis"===b)g.addAxis(a,"xAxis"===b,!1).touched=!0}),h&&u(g[b],function(a){a.touched||a.options.isInternal?delete a.touched:z.push(a)}))});u(z,function(a){a.remove(!1)});k&&u(g.axes,function(a){a.update({},!1)});t&&u(g.series,function(a){a.update({},!1)});a.loading&&m(!0,g.options.loading,a.loading);k=w&&w.width;w=w&&w.height;d(k)&&k!==g.chartWidth||d(w)&&w!==g.chartHeight?g.setSize(k,
w,n):c(e,!0)&&g.redraw(n);y(g,"afterUpdate",{options:a})},setSubtitle:function(a){this.setTitle(void 0,a)}});r(x.prototype,{update:function(a,b,d,g){function h(){n.applyOptions(a);null===n.y&&k&&(n.graphic=k.destroy());e(a,!0)&&(k&&k.element&&a&&a.marker&&void 0!==a.marker.symbol&&(n.graphic=k.destroy()),a&&a.dataLabels&&n.dataLabel&&(n.dataLabel=n.dataLabel.destroy()),n.connector&&(n.connector=n.connector.destroy()));t=n.index;m.updateParallelArrays(n,t);z.data[t]=e(z.data[t],!0)||e(a,!0)?n.options:
c(a,z.data[t]);m.isDirty=m.isDirtyData=!0;!m.fixedBox&&m.hasCartesianSeries&&(f.isDirtyBox=!0);"point"===z.legendType&&(f.isDirtyLegend=!0);b&&f.redraw(d)}var n=this,m=n.series,k=n.graphic,t,f=m.chart,z=m.options;b=c(b,!0);!1===g?h():n.firePointEvent("update",{options:a},h)},remove:function(a,b){this.series.removePoint(p(this,this.series.data),a,b)}});r(B.prototype,{addPoint:function(a,b,d,e){var h=this.options,n=this.data,g=this.chart,k=this.xAxis,k=k&&k.hasNames&&k.names,m=h.data,t,f,z=this.xData,
p,l;b=c(b,!0);t={series:this};this.pointClass.prototype.applyOptions.apply(t,[a]);l=t.x;p=z.length;if(this.requireSorting&&l<z[p-1])for(f=!0;p&&z[p-1]>l;)p--;this.updateParallelArrays(t,"splice",p,0,0);this.updateParallelArrays(t,p);k&&t.name&&(k[l]=t.name);m.splice(p,0,a);f&&(this.data.splice(p,0,null),this.processData());"point"===h.legendType&&this.generatePoints();d&&(n[0]&&n[0].remove?n[0].remove(!1):(n.shift(),this.updateParallelArrays(t,"shift"),m.shift()));this.isDirtyData=this.isDirty=!0;
b&&g.redraw(e)},removePoint:function(a,b,d){var e=this,h=e.data,g=h[a],m=e.points,k=e.chart,t=function(){m&&m.length===h.length&&m.splice(a,1);h.splice(a,1);e.options.data.splice(a,1);e.updateParallelArrays(g||{series:e},"splice",a,1);g&&g.destroy();e.isDirty=!0;e.isDirtyData=!0;b&&k.redraw()};n(d,k);b=c(b,!0);g?g.firePointEvent("remove",null,t):t()},remove:function(a,b,d){function e(){h.destroy();n.isDirtyLegend=n.isDirtyBox=!0;n.linkSeries();c(a,!0)&&n.redraw(b)}var h=this,n=h.chart;!1!==d?y(h,
"remove",null,e):e()},update:function(b,d){var e=this,n=e.chart,g=e.userOptions,v=e.oldType||e.type,w=b.type||g.type||n.options.chart.type,k=t[v].prototype,f,z=["group","markerGroup","dataLabelsGroup"],l=["navigatorSeries","baseSeries"],D=e.finishedAnimating&&{animation:!1},x=["data","name","turboThreshold"],B=a.keys(b),q=0<B.length;u(B,function(a){-1===p(a,x)&&(q=!1)});if(q)b.data&&this.setData(b.data,!1),b.name&&this.setName(b.name,!1);else{l=z.concat(l);u(l,function(a){l[a]=e[a];delete e[a]});
b=m(g,D,{index:e.index,pointStart:c(g.pointStart,e.xData[0])},{data:e.options.data},b);e.remove(!1,null,!1);for(f in k)e[f]=void 0;t[w||v]?r(e,t[w||v].prototype):a.error(17,!0);u(l,function(a){e[a]=l[a]});e.init(n,b);b.zIndex!==g.zIndex&&u(z,function(a){e[a]&&e[a].attr({zIndex:b.zIndex})});e.oldType=v;n.linkSeries()}y(this,"afterUpdate");c(d,!0)&&n.redraw(q?void 0:!1)},setName:function(a){this.name=this.options.name=this.userOptions.name=a;this.chart.isDirtyLegend=!0}});r(G.prototype,{update:function(a,
d){var e=this.chart,n=a&&a.events||{};a=m(this.userOptions,a);e.options[this.coll].indexOf&&(e.options[this.coll][e.options[this.coll].indexOf(this.userOptions)]=a);b(e.options[this.coll].events,function(a,b){"undefined"===typeof n[b]&&(n[b]=void 0)});this.destroy(!0);this.init(e,r(a,{events:n}));e.isDirtyBox=!0;c(d,!0)&&e.redraw()},remove:function(a){for(var b=this.chart,d=this.coll,e=this.series,n=e.length;n--;)e[n]&&e[n].remove(!1);C(b.axes,this);C(b[d],this);g(b.options[d])?b.options[d].splice(this.options.index,
1):delete b.options[d];u(b[d],function(a,b){a.options.index=a.userOptions.index=b});this.destroy();b.isDirtyBox=!0;c(a,!0)&&b.redraw()},setTitle:function(a,b){this.update({title:a},b)},setCategories:function(a,b){this.update({categories:a},b)}})})(J);(function(a){var E=a.color,F=a.each,G=a.map,q=a.pick,l=a.Series,f=a.seriesType;f("area","line",{softThreshold:!1,threshold:0},{singleStacks:!1,getStackPoints:function(f){var l=[],r=[],u=this.xAxis,p=this.yAxis,d=p.stacks[this.stackKey],e={},g=this.index,
m=p.series,b=m.length,c,x=q(p.options.reversedStacks,!0)?1:-1,B;f=f||this.points;if(this.options.stacking){for(B=0;B<f.length;B++)f[B].leftNull=f[B].rightNull=null,e[f[B].x]=f[B];a.objectEach(d,function(a,b){null!==a.total&&r.push(b)});r.sort(function(a,b){return a-b});c=G(m,function(){return this.visible});F(r,function(a,n){var m=0,f,t;if(e[a]&&!e[a].isNull)l.push(e[a]),F([-1,1],function(h){var m=1===h?"rightNull":"leftNull",p=0,v=d[r[n+h]];if(v)for(B=g;0<=B&&B<b;)f=v.points[B],f||(B===g?e[a][m]=
!0:c[B]&&(t=d[a].points[B])&&(p-=t[1]-t[0])),B+=x;e[a][1===h?"rightCliff":"leftCliff"]=p});else{for(B=g;0<=B&&B<b;){if(f=d[a].points[B]){m=f[1];break}B+=x}m=p.translate(m,0,1,0,1);l.push({isNull:!0,plotX:u.translate(a,0,0,0,1),x:a,plotY:m,yBottom:m})}})}return l},getGraphPath:function(a){var f=l.prototype.getGraphPath,r=this.options,u=r.stacking,p=this.yAxis,d,e,g=[],m=[],b=this.index,c,x=p.stacks[this.stackKey],B=r.threshold,t=p.getThreshold(r.threshold),n,r=r.connectNulls||"percent"===u,L=function(d,
e,h){var n=a[d];d=u&&x[n.x].points[b];var f=n[h+"Null"]||0;h=n[h+"Cliff"]||0;var v,w,n=!0;h||f?(v=(f?d[0]:d[1])+h,w=d[0]+h,n=!!f):!u&&a[e]&&a[e].isNull&&(v=w=B);void 0!==v&&(m.push({plotX:c,plotY:null===v?t:p.getThreshold(v),isNull:n,isCliff:!0}),g.push({plotX:c,plotY:null===w?t:p.getThreshold(w),doCurve:!1}))};a=a||this.points;u&&(a=this.getStackPoints(a));for(d=0;d<a.length;d++)if(e=a[d].isNull,c=q(a[d].rectPlotX,a[d].plotX),n=q(a[d].yBottom,t),!e||r)r||L(d,d-1,"left"),e&&!u&&r||(m.push(a[d]),g.push({x:d,
plotX:c,plotY:n})),r||L(d,d+1,"right");d=f.call(this,m,!0,!0);g.reversed=!0;e=f.call(this,g,!0,!0);e.length&&(e[0]="L");e=d.concat(e);f=f.call(this,m,!1,r);e.xMap=d.xMap;this.areaPath=e;return f},drawGraph:function(){this.areaPath=[];l.prototype.drawGraph.apply(this);var a=this,f=this.areaPath,r=this.options,y=[["area","highcharts-area",this.color,r.fillColor]];F(this.zones,function(f,d){y.push(["zone-area-"+d,"highcharts-area highcharts-zone-area-"+d+" "+f.className,f.color||a.color,f.fillColor||
r.fillColor])});F(y,function(p){var d=p[0],e=a[d];e?(e.endX=a.preventGraphAnimation?null:f.xMap,e.animate({d:f})):(e=a[d]=a.chart.renderer.path(f).addClass(p[1]).attr({fill:q(p[3],E(p[2]).setOpacity(q(r.fillOpacity,.75)).get()),zIndex:0}).add(a.group),e.isArea=!0);e.startX=f.xMap;e.shiftUnit=r.step?2:1})},drawLegendSymbol:a.LegendSymbolMixin.drawRectangle})})(J);(function(a){var E=a.pick;a=a.seriesType;a("spline","line",{},{getPointSpline:function(a,G,q){var l=G.plotX,f=G.plotY,u=a[q-1];q=a[q+1];
var C,r,y,p;if(u&&!u.isNull&&!1!==u.doCurve&&!G.isCliff&&q&&!q.isNull&&!1!==q.doCurve&&!G.isCliff){a=u.plotY;y=q.plotX;q=q.plotY;var d=0;C=(1.5*l+u.plotX)/2.5;r=(1.5*f+a)/2.5;y=(1.5*l+y)/2.5;p=(1.5*f+q)/2.5;y!==C&&(d=(p-r)*(y-l)/(y-C)+f-p);r+=d;p+=d;r>a&&r>f?(r=Math.max(a,f),p=2*f-r):r<a&&r<f&&(r=Math.min(a,f),p=2*f-r);p>q&&p>f?(p=Math.max(q,f),r=2*f-p):p<q&&p<f&&(p=Math.min(q,f),r=2*f-p);G.rightContX=y;G.rightContY=p}G=["C",E(u.rightContX,u.plotX),E(u.rightContY,u.plotY),E(C,l),E(r,f),l,f];u.rightContX=
u.rightContY=null;return G}})})(J);(function(a){var E=a.seriesTypes.area.prototype,F=a.seriesType;F("areaspline","spline",a.defaultPlotOptions.area,{getStackPoints:E.getStackPoints,getGraphPath:E.getGraphPath,drawGraph:E.drawGraph,drawLegendSymbol:a.LegendSymbolMixin.drawRectangle})})(J);(function(a){var E=a.animObject,F=a.color,G=a.each,q=a.extend,l=a.isNumber,f=a.merge,u=a.pick,C=a.Series,r=a.seriesType,y=a.svg;r("column","line",{borderRadius:0,crisp:!0,groupPadding:.2,marker:null,pointPadding:.1,
minPointLength:0,cropThreshold:50,pointRange:null,states:{hover:{halo:!1,brightness:.1},select:{color:"#cccccc",borderColor:"#000000"}},dataLabels:{align:null,verticalAlign:null,y:null},softThreshold:!1,startFromThreshold:!0,stickyTracking:!1,tooltip:{distance:6},threshold:0,borderColor:"#ffffff"},{cropShoulder:0,directTouch:!0,trackerGroups:["group","dataLabelsGroup"],negStacks:!0,init:function(){C.prototype.init.apply(this,arguments);var a=this,d=a.chart;d.hasRendered&&G(d.series,function(d){d.type===
a.type&&(d.isDirty=!0)})},getColumnMetrics:function(){var a=this,d=a.options,e=a.xAxis,g=a.yAxis,m=e.options.reversedStacks,m=e.reversed&&!m||!e.reversed&&m,b,c={},f=0;!1===d.grouping?f=1:G(a.chart.series,function(d){var e=d.options,n=d.yAxis,h;d.type!==a.type||!d.visible&&a.chart.options.chart.ignoreHiddenSeries||g.len!==n.len||g.pos!==n.pos||(e.stacking?(b=d.stackKey,void 0===c[b]&&(c[b]=f++),h=c[b]):!1!==e.grouping&&(h=f++),d.columnIndex=h)});var l=Math.min(Math.abs(e.transA)*(e.ordinalSlope||
d.pointRange||e.closestPointRange||e.tickInterval||1),e.len),t=l*d.groupPadding,n=(l-2*t)/(f||1),d=Math.min(d.maxPointWidth||e.len,u(d.pointWidth,n*(1-2*d.pointPadding)));a.columnMetrics={width:d,offset:(n-d)/2+(t+((a.columnIndex||0)+(m?1:0))*n-l/2)*(m?-1:1)};return a.columnMetrics},crispCol:function(a,d,e,g){var m=this.chart,b=this.borderWidth,c=-(b%2?.5:0),b=b%2?.5:1;m.inverted&&m.renderer.isVML&&(b+=1);this.options.crisp&&(e=Math.round(a+e)+c,a=Math.round(a)+c,e-=a);g=Math.round(d+g)+b;c=.5>=Math.abs(d)&&
.5<g;d=Math.round(d)+b;g-=d;c&&g&&(--d,g+=1);return{x:a,y:d,width:e,height:g}},translate:function(){var a=this,d=a.chart,e=a.options,g=a.dense=2>a.closestPointRange*a.xAxis.transA,g=a.borderWidth=u(e.borderWidth,g?0:1),m=a.yAxis,b=e.threshold,c=a.translatedThreshold=m.getThreshold(b),f=u(e.minPointLength,5),l=a.getColumnMetrics(),t=l.width,n=a.barW=Math.max(t,1+2*g),r=a.pointXOffset=l.offset;d.inverted&&(c-=.5);e.pointPadding&&(n=Math.ceil(n));C.prototype.translate.apply(a);G(a.points,function(e){var g=
u(e.yBottom,c),h=999+Math.abs(g),h=Math.min(Math.max(-h,e.plotY),m.len+h),l=e.plotX+r,p=n,v=Math.min(h,g),w,k=Math.max(h,g)-v;f&&Math.abs(k)<f&&(k=f,w=!m.reversed&&!e.negative||m.reversed&&e.negative,e.y===b&&a.dataMax<=b&&m.min<b&&(w=!w),v=Math.abs(v-c)>f?g-f:c-(w?f:0));e.barX=l;e.pointWidth=t;e.tooltipPos=d.inverted?[m.len+m.pos-d.plotLeft-h,a.xAxis.len-l-p/2,k]:[l+p/2,h+m.pos-d.plotTop,k];e.shapeType="rect";e.shapeArgs=a.crispCol.apply(a,e.isNull?[l,c,p,0]:[l,v,p,k])})},getSymbol:a.noop,drawLegendSymbol:a.LegendSymbolMixin.drawRectangle,
drawGraph:function(){this.group[this.dense?"addClass":"removeClass"]("highcharts-dense-data")},pointAttribs:function(a,d){var e=this.options,g,m=this.pointAttrToOptions||{};g=m.stroke||"borderColor";var b=m["stroke-width"]||"borderWidth",c=a&&a.color||this.color,l=a&&a[g]||e[g]||this.color||c,p=a&&a[b]||e[b]||this[b]||0,m=e.dashStyle;a&&this.zones.length&&(c=a.getZone(),c=a.options.color||c&&c.color||this.color);d&&(a=f(e.states[d],a.options.states&&a.options.states[d]||{}),d=a.brightness,c=a.color||
void 0!==d&&F(c).brighten(a.brightness).get()||c,l=a[g]||l,p=a[b]||p,m=a.dashStyle||m);g={fill:c,stroke:l,"stroke-width":p};m&&(g.dashstyle=m);return g},drawPoints:function(){var a=this,d=this.chart,e=a.options,g=d.renderer,m=e.animationLimit||250,b;G(a.points,function(c){var p=c.graphic,B=p&&d.pointCount<m?"animate":"attr";if(l(c.plotY)&&null!==c.y){b=c.shapeArgs;if(p)p[B](f(b));else c.graphic=p=g[c.shapeType](b).add(c.group||a.group);e.borderRadius&&p.attr({r:e.borderRadius});p[B](a.pointAttribs(c,
c.selected&&"select")).shadow(e.shadow,null,e.stacking&&!e.borderRadius);p.addClass(c.getClassName(),!0)}else p&&(c.graphic=p.destroy())})},animate:function(a){var d=this,e=this.yAxis,g=d.options,m=this.chart.inverted,b={},c=m?"translateX":"translateY",f;y&&(a?(b.scaleY=.001,a=Math.min(e.pos+e.len,Math.max(e.pos,e.toPixels(g.threshold))),m?b.translateX=a-e.len:b.translateY=a,d.group.attr(b)):(f=d.group.attr(c),d.group.animate({scaleY:1},q(E(d.options.animation),{step:function(a,g){b[c]=f+g.pos*(e.pos-
f);d.group.attr(b)}})),d.animate=null))},remove:function(){var a=this,d=a.chart;d.hasRendered&&G(d.series,function(d){d.type===a.type&&(d.isDirty=!0)});C.prototype.remove.apply(a,arguments)}})})(J);(function(a){a=a.seriesType;a("bar","column",null,{inverted:!0})})(J);(function(a){var E=a.Series;a=a.seriesType;a("scatter","line",{lineWidth:0,findNearestPointBy:"xy",marker:{enabled:!0},tooltip:{headerFormat:'\x3cspan style\x3d"color:{point.color}"\x3e\u25cf\x3c/span\x3e \x3cspan style\x3d"font-size: 0.85em"\x3e {series.name}\x3c/span\x3e\x3cbr/\x3e',
pointFormat:"x: \x3cb\x3e{point.x}\x3c/b\x3e\x3cbr/\x3ey: \x3cb\x3e{point.y}\x3c/b\x3e\x3cbr/\x3e"}},{sorted:!1,requireSorting:!1,noSharedTooltip:!0,trackerGroups:["group","markerGroup","dataLabelsGroup"],takeOrdinalPosition:!1,drawGraph:function(){this.options.lineWidth&&E.prototype.drawGraph.call(this)}})})(J);(function(a){var E=a.deg2rad,F=a.isNumber,G=a.pick,q=a.relativeLength;a.CenteredSeriesMixin={getCenter:function(){var a=this.options,f=this.chart,u=2*(a.slicedOffset||0),C=f.plotWidth-2*u,
f=f.plotHeight-2*u,r=a.center,r=[G(r[0],"50%"),G(r[1],"50%"),a.size||"100%",a.innerSize||0],y=Math.min(C,f),p,d;for(p=0;4>p;++p)d=r[p],a=2>p||2===p&&/%$/.test(d),r[p]=q(d,[C,f,y,r[2]][p])+(a?u:0);r[3]>r[2]&&(r[3]=r[2]);return r},getStartAndEndRadians:function(a,f){a=F(a)?a:0;f=F(f)&&f>a&&360>f-a?f:a+360;return{start:E*(a+-90),end:E*(f+-90)}}}})(J);(function(a){var E=a.addEvent,F=a.CenteredSeriesMixin,G=a.defined,q=a.each,l=a.extend,f=F.getStartAndEndRadians,u=a.inArray,C=a.noop,r=a.pick,y=a.Point,
p=a.Series,d=a.seriesType,e=a.setAnimation;d("pie","line",{center:[null,null],clip:!1,colorByPoint:!0,dataLabels:{allowOverlap:!0,distance:30,enabled:!0,formatter:function(){return this.point.isNull?void 0:this.point.name},x:0},ignoreHiddenPoint:!0,legendType:"point",marker:null,size:null,showInLegend:!1,slicedOffset:10,stickyTracking:!1,tooltip:{followPointer:!0},borderColor:"#ffffff",borderWidth:1,states:{hover:{brightness:.1}}},{isCartesian:!1,requireSorting:!1,directTouch:!0,noSharedTooltip:!0,
trackerGroups:["group","dataLabelsGroup"],axisTypes:[],pointAttribs:a.seriesTypes.column.prototype.pointAttribs,animate:function(a){var d=this,b=d.points,c=d.startAngleRad;a||(q(b,function(a){var b=a.graphic,e=a.shapeArgs;b&&(b.attr({r:a.startR||d.center[3]/2,start:c,end:c}),b.animate({r:e.r,start:e.start,end:e.end},d.options.animation))}),d.animate=null)},updateTotals:function(){var a,d=0,b=this.points,c=b.length,e,f=this.options.ignoreHiddenPoint;for(a=0;a<c;a++)e=b[a],d+=f&&!e.visible?0:e.isNull?
0:e.y;this.total=d;for(a=0;a<c;a++)e=b[a],e.percentage=0<d&&(e.visible||!f)?e.y/d*100:0,e.total=d},generatePoints:function(){p.prototype.generatePoints.call(this);this.updateTotals()},translate:function(a){this.generatePoints();var d=0,b=this.options,c=b.slicedOffset,e=c+(b.borderWidth||0),g,t,n,l=f(b.startAngle,b.endAngle),z=this.startAngleRad=l.start,l=(this.endAngleRad=l.end)-z,p=this.points,h,q=b.dataLabels.distance,b=b.ignoreHiddenPoint,u,v=p.length,w;a||(this.center=a=this.getCenter());this.getX=
function(b,c,d){n=Math.asin(Math.min((b-a[1])/(a[2]/2+d.labelDistance),1));return a[0]+(c?-1:1)*Math.cos(n)*(a[2]/2+d.labelDistance)};for(u=0;u<v;u++){w=p[u];w.labelDistance=r(w.options.dataLabels&&w.options.dataLabels.distance,q);this.maxLabelDistance=Math.max(this.maxLabelDistance||0,w.labelDistance);g=z+d*l;if(!b||w.visible)d+=w.percentage/100;t=z+d*l;w.shapeType="arc";w.shapeArgs={x:a[0],y:a[1],r:a[2]/2,innerR:a[3]/2,start:Math.round(1E3*g)/1E3,end:Math.round(1E3*t)/1E3};n=(t+g)/2;n>1.5*Math.PI?
n-=2*Math.PI:n<-Math.PI/2&&(n+=2*Math.PI);w.slicedTranslation={translateX:Math.round(Math.cos(n)*c),translateY:Math.round(Math.sin(n)*c)};t=Math.cos(n)*a[2]/2;h=Math.sin(n)*a[2]/2;w.tooltipPos=[a[0]+.7*t,a[1]+.7*h];w.half=n<-Math.PI/2||n>Math.PI/2?1:0;w.angle=n;g=Math.min(e,w.labelDistance/5);w.labelPos=[a[0]+t+Math.cos(n)*w.labelDistance,a[1]+h+Math.sin(n)*w.labelDistance,a[0]+t+Math.cos(n)*g,a[1]+h+Math.sin(n)*g,a[0]+t,a[1]+h,0>w.labelDistance?"center":w.half?"right":"left",n]}},drawGraph:null,
drawPoints:function(){var a=this,d=a.chart.renderer,b,c,e,f,t=a.options.shadow;t&&!a.shadowGroup&&(a.shadowGroup=d.g("shadow").add(a.group));q(a.points,function(n){c=n.graphic;if(n.isNull)c&&(n.graphic=c.destroy());else{f=n.shapeArgs;b=n.getTranslate();var g=n.shadowGroup;t&&!g&&(g=n.shadowGroup=d.g("shadow").add(a.shadowGroup));g&&g.attr(b);e=a.pointAttribs(n,n.selected&&"select");c?c.setRadialReference(a.center).attr(e).animate(l(f,b)):(n.graphic=c=d[n.shapeType](f).setRadialReference(a.center).attr(b).add(a.group),
c.attr(e).attr({"stroke-linejoin":"round"}).shadow(t,g));c.attr({visibility:n.visible?"inherit":"hidden"});c.addClass(n.getClassName())}})},searchPoint:C,sortByAngle:function(a,d){a.sort(function(a,c){return void 0!==a.angle&&(c.angle-a.angle)*d})},drawLegendSymbol:a.LegendSymbolMixin.drawRectangle,getCenter:F.getCenter,getSymbol:C},{init:function(){y.prototype.init.apply(this,arguments);var a=this,d;a.name=r(a.name,"Slice");d=function(b){a.slice("select"===b.type)};E(a,"select",d);E(a,"unselect",
d);return a},isValid:function(){return a.isNumber(this.y,!0)&&0<=this.y},setVisible:function(a,d){var b=this,c=b.series,e=c.chart,g=c.options.ignoreHiddenPoint;d=r(d,g);a!==b.visible&&(b.visible=b.options.visible=a=void 0===a?!b.visible:a,c.options.data[u(b,c.data)]=b.options,q(["graphic","dataLabel","connector","shadowGroup"],function(c){if(b[c])b[c][a?"show":"hide"](!0)}),b.legendItem&&e.legend.colorizeItem(b,a),a||"hover"!==b.state||b.setState(""),g&&(c.isDirty=!0),d&&e.redraw())},slice:function(a,
d,b){var c=this.series;e(b,c.chart);r(d,!0);this.sliced=this.options.sliced=G(a)?a:!this.sliced;c.options.data[u(this,c.data)]=this.options;this.graphic.animate(this.getTranslate());this.shadowGroup&&this.shadowGroup.animate(this.getTranslate())},getTranslate:function(){return this.sliced?this.slicedTranslation:{translateX:0,translateY:0}},haloPath:function(a){var d=this.shapeArgs;return this.sliced||!this.visible?[]:this.series.chart.renderer.symbols.arc(d.x,d.y,d.r+a,d.r+a,{innerR:this.shapeArgs.r-
1,start:d.start,end:d.end})}})})(J);(function(a){var E=a.addEvent,F=a.arrayMax,G=a.defined,q=a.each,l=a.extend,f=a.format,u=a.map,C=a.merge,r=a.noop,y=a.pick,p=a.relativeLength,d=a.Series,e=a.seriesTypes,g=a.some,m=a.stableSort;a.distribute=function(b,c,d){function e(a,b){return a.target-b.target}var f,n=!0,l=b,z=[],p;p=0;var h=l.reducedLen||c;for(f=b.length;f--;)p+=b[f].size;if(p>h){m(b,function(a,b){return(b.rank||0)-(a.rank||0)});for(p=f=0;p<=h;)p+=b[f].size,f++;z=b.splice(f-1,b.length)}m(b,e);
for(b=u(b,function(a){return{size:a.size,targets:[a.target],align:y(a.align,.5)}});n;){for(f=b.length;f--;)n=b[f],p=(Math.min.apply(0,n.targets)+Math.max.apply(0,n.targets))/2,n.pos=Math.min(Math.max(0,p-n.size*n.align),c-n.size);f=b.length;for(n=!1;f--;)0<f&&b[f-1].pos+b[f-1].size>b[f].pos&&(b[f-1].size+=b[f].size,b[f-1].targets=b[f-1].targets.concat(b[f].targets),b[f-1].align=.5,b[f-1].pos+b[f-1].size>c&&(b[f-1].pos=c-b[f-1].size),b.splice(f,1),n=!0)}l.push.apply(l,z);f=0;g(b,function(b){var e=
0;if(g(b.targets,function(){l[f].pos=b.pos+e;if(Math.abs(l[f].pos-l[f].target)>d)return q(l.slice(0,f+1),function(a){delete a.pos}),l.reducedLen=(l.reducedLen||c)-.1*c,l.reducedLen>.1*c&&a.distribute(l,c,d),!0;e+=l[f].size;f++}))return!0});m(l,e)};d.prototype.drawDataLabels=function(){function b(a,b){var c=b.filter;return c?(b=c.operator,a=a[c.property],c=c.value,"\x3e"===b&&a>c||"\x3c"===b&&a<c||"\x3e\x3d"===b&&a>=c||"\x3c\x3d"===b&&a<=c||"\x3d\x3d"===b&&a==c||"\x3d\x3d\x3d"===b&&a===c?!0:!1):!0}
var c=this,d=c.chart,e=c.options,g=e.dataLabels,n=c.points,m,l,p=c.hasRendered||0,h,r,u=y(g.defer,!!e.animation),v=d.renderer;if(g.enabled||c._hasPointLabels)c.dlProcessOptions&&c.dlProcessOptions(g),r=c.plotGroup("dataLabelsGroup","data-labels",u&&!p?"hidden":"visible",g.zIndex||6),u&&(r.attr({opacity:+p}),p||E(c,"afterAnimate",function(){c.visible&&r.show(!0);r[e.animation?"animate":"attr"]({opacity:1},{duration:200})})),l=g,q(n,function(n){var k,w=n.dataLabel,t,p,z=n.connector,D=!w,x;m=n.dlOptions||
n.options&&n.options.dataLabels;(k=y(m&&m.enabled,l.enabled)&&!n.isNull)&&(k=!0===b(n,m||g));k&&(g=C(l,m),t=n.getLabelConfig(),x=g[n.formatPrefix+"Format"]||g.format,h=G(x)?f(x,t,d.time):(g[n.formatPrefix+"Formatter"]||g.formatter).call(t,g),x=g.style,t=g.rotation,x.color=y(g.color,x.color,c.color,"#000000"),"contrast"===x.color&&(n.contrastColor=v.getContrast(n.color||c.color),x.color=g.inside||0>y(n.labelDistance,g.distance)||e.stacking?n.contrastColor:"#000000"),e.cursor&&(x.cursor=e.cursor),p=
{fill:g.backgroundColor,stroke:g.borderColor,"stroke-width":g.borderWidth,r:g.borderRadius||0,rotation:t,padding:g.padding,zIndex:1},a.objectEach(p,function(a,b){void 0===a&&delete p[b]}));!w||k&&G(h)?k&&G(h)&&(w?p.text=h:(w=n.dataLabel=t?v.text(h,0,-9999,g.useHTML).addClass("highcharts-data-label"):v.label(h,0,-9999,g.shape,null,null,g.useHTML,null,"data-label"),w.addClass(" highcharts-data-label-color-"+n.colorIndex+" "+(g.className||"")+(g.useHTML?" highcharts-tracker":""))),w.attr(p),w.css(x).shadow(g.shadow),
w.added||w.add(r),c.alignDataLabel(n,w,g,null,D)):(n.dataLabel=w=w.destroy(),z&&(n.connector=z.destroy()))});a.fireEvent(this,"afterDrawDataLabels")};d.prototype.alignDataLabel=function(a,c,d,e,g){var b=this.chart,m=b.inverted,f=y(a.dlBox&&a.dlBox.centerX,a.plotX,-9999),t=y(a.plotY,-9999),h=c.getBBox(),p,x=d.rotation,v=d.align,w=this.visible&&(a.series.forceDL||b.isInsidePlot(f,Math.round(t),m)||e&&b.isInsidePlot(f,m?e.x+1:e.y+e.height-1,m)),k="justify"===y(d.overflow,"justify");if(w&&(p=d.style.fontSize,
p=b.renderer.fontMetrics(p,c).b,e=l({x:m?this.yAxis.len-t:f,y:Math.round(m?this.xAxis.len-f:t),width:0,height:0},e),l(d,{width:h.width,height:h.height}),x?(k=!1,f=b.renderer.rotCorr(p,x),f={x:e.x+d.x+e.width/2+f.x,y:e.y+d.y+{top:0,middle:.5,bottom:1}[d.verticalAlign]*e.height},c[g?"attr":"animate"](f).attr({align:v}),t=(x+720)%360,t=180<t&&360>t,"left"===v?f.y-=t?h.height:0:"center"===v?(f.x-=h.width/2,f.y-=h.height/2):"right"===v&&(f.x-=h.width,f.y-=t?0:h.height),c.placed=!0,c.alignAttr=f):(c.align(d,
null,e),f=c.alignAttr),k&&0<=e.height?a.isLabelJustified=this.justifyDataLabel(c,d,f,h,e,g):y(d.crop,!0)&&(w=b.isInsidePlot(f.x,f.y)&&b.isInsidePlot(f.x+h.width,f.y+h.height)),d.shape&&!x))c[g?"attr":"animate"]({anchorX:m?b.plotWidth-a.plotY:a.plotX,anchorY:m?b.plotHeight-a.plotX:a.plotY});w||(c.attr({y:-9999}),c.placed=!1)};d.prototype.justifyDataLabel=function(a,c,d,e,g,n){var b=this.chart,f=c.align,m=c.verticalAlign,h,l,t=a.box?0:a.padding||0;h=d.x+t;0>h&&("right"===f?c.align="left":c.x=-h,l=!0);
h=d.x+e.width-t;h>b.plotWidth&&("left"===f?c.align="right":c.x=b.plotWidth-h,l=!0);h=d.y+t;0>h&&("bottom"===m?c.verticalAlign="top":c.y=-h,l=!0);h=d.y+e.height-t;h>b.plotHeight&&("top"===m?c.verticalAlign="bottom":c.y=b.plotHeight-h,l=!0);l&&(a.placed=!n,a.align(c,null,g));return l};e.pie&&(e.pie.prototype.drawDataLabels=function(){var b=this,c=b.data,e,g=b.chart,f=b.options.dataLabels,n=y(f.connectorPadding,10),m=y(f.connectorWidth,1),l=g.plotWidth,p=g.plotHeight,h=Math.round(g.chartWidth/3),r,u=
b.center,v=u[2]/2,w=u[1],k,A,C,E,K=[[],[]],O,N,M,S,R=[0,0,0,0];b.visible&&(f.enabled||b._hasPointLabels)&&(q(c,function(a){a.dataLabel&&a.visible&&a.dataLabel.shortened&&(a.dataLabel.attr({width:"auto"}).css({width:"auto",textOverflow:"clip"}),a.dataLabel.shortened=!1)}),d.prototype.drawDataLabels.apply(b),q(c,function(a){a.dataLabel&&(a.visible?(K[a.half].push(a),a.dataLabel._pos=null,!G(f.style.width)&&!G(a.options.dataLabels&&a.options.dataLabels.style&&a.options.dataLabels.style.width)&&a.dataLabel.getBBox().width>
h&&(a.dataLabel.css({width:.7*h}),a.dataLabel.shortened=!0)):a.dataLabel=a.dataLabel.destroy())}),q(K,function(c,d){var h,m,t=c.length,z=[],D;if(t)for(b.sortByAngle(c,d-.5),0<b.maxLabelDistance&&(h=Math.max(0,w-v-b.maxLabelDistance),m=Math.min(w+v+b.maxLabelDistance,g.plotHeight),q(c,function(a){0<a.labelDistance&&a.dataLabel&&(a.top=Math.max(0,w-v-a.labelDistance),a.bottom=Math.min(w+v+a.labelDistance,g.plotHeight),D=a.dataLabel.getBBox().height||21,a.distributeBox={target:a.labelPos[1]-a.top+D/
2,size:D,rank:a.y},z.push(a.distributeBox))}),h=m+D-h,a.distribute(z,h,h/5)),S=0;S<t;S++)e=c[S],C=e.labelPos,k=e.dataLabel,M=!1===e.visible?"hidden":"inherit",N=h=C[1],z&&G(e.distributeBox)&&(void 0===e.distributeBox.pos?M="hidden":(E=e.distributeBox.size,N=e.top+e.distributeBox.pos)),delete e.positionIndex,O=f.justify?u[0]+(d?-1:1)*(v+e.labelDistance):b.getX(N<e.top+2||N>e.bottom-2?h:N,d,e),k._attr={visibility:M,align:C[6]},k._pos={x:O+f.x+({left:n,right:-n}[C[6]]||0),y:N+f.y-10},C.x=O,C.y=N,y(f.crop,
!0)&&(A=k.getBBox().width,h=null,O-A<n&&1===d?(h=Math.round(A-O+n),R[3]=Math.max(h,R[3])):O+A>l-n&&0===d&&(h=Math.round(O+A-l+n),R[1]=Math.max(h,R[1])),0>N-E/2?R[0]=Math.max(Math.round(-N+E/2),R[0]):N+E/2>p&&(R[2]=Math.max(Math.round(N+E/2-p),R[2])),k.sideOverflow=h)}),0===F(R)||this.verifyDataLabelOverflow(R))&&(this.placeDataLabels(),m&&q(this.points,function(a){var c;r=a.connector;if((k=a.dataLabel)&&k._pos&&a.visible&&0<a.labelDistance){M=k._attr.visibility;if(c=!r)a.connector=r=g.renderer.path().addClass("highcharts-data-label-connector  highcharts-color-"+
a.colorIndex+(a.className?" "+a.className:"")).add(b.dataLabelsGroup),r.attr({"stroke-width":m,stroke:f.connectorColor||a.color||"#666666"});r[c?"attr":"animate"]({d:b.connectorPath(a.labelPos)});r.attr("visibility",M)}else r&&(a.connector=r.destroy())}))},e.pie.prototype.connectorPath=function(a){var b=a.x,d=a.y;return y(this.options.dataLabels.softConnector,!0)?["M",b+("left"===a[6]?5:-5),d,"C",b,d,2*a[2]-a[4],2*a[3]-a[5],a[2],a[3],"L",a[4],a[5]]:["M",b+("left"===a[6]?5:-5),d,"L",a[2],a[3],"L",
a[4],a[5]]},e.pie.prototype.placeDataLabels=function(){q(this.points,function(a){var b=a.dataLabel;b&&a.visible&&((a=b._pos)?(b.sideOverflow&&(b._attr.width=b.getBBox().width-b.sideOverflow,b.css({width:b._attr.width+"px",textOverflow:(this.options.dataLabels.style||{}).textOverflow||"ellipsis"}),b.shortened=!0),b.attr(b._attr),b[b.moved?"animate":"attr"](a),b.moved=!0):b&&b.attr({y:-9999}))},this)},e.pie.prototype.alignDataLabel=r,e.pie.prototype.verifyDataLabelOverflow=function(a){var b=this.center,
d=this.options,e=d.center,g=d.minSize||80,n,f=null!==d.size;f||(null!==e[0]?n=Math.max(b[2]-Math.max(a[1],a[3]),g):(n=Math.max(b[2]-a[1]-a[3],g),b[0]+=(a[3]-a[1])/2),null!==e[1]?n=Math.max(Math.min(n,b[2]-Math.max(a[0],a[2])),g):(n=Math.max(Math.min(n,b[2]-a[0]-a[2]),g),b[1]+=(a[0]-a[2])/2),n<b[2]?(b[2]=n,b[3]=Math.min(p(d.innerSize||0,n),n),this.translate(b),this.drawDataLabels&&this.drawDataLabels()):f=!0);return f});e.column&&(e.column.prototype.alignDataLabel=function(a,c,e,g,f){var b=this.chart.inverted,
m=a.series,l=a.dlBox||a.shapeArgs,p=y(a.below,a.plotY>y(this.translatedThreshold,m.yAxis.len)),h=y(e.inside,!!this.options.stacking);l&&(g=C(l),0>g.y&&(g.height+=g.y,g.y=0),l=g.y+g.height-m.yAxis.len,0<l&&(g.height-=l),b&&(g={x:m.yAxis.len-g.y-g.height,y:m.xAxis.len-g.x-g.width,width:g.height,height:g.width}),h||(b?(g.x+=p?0:g.width,g.width=0):(g.y+=p?g.height:0,g.height=0)));e.align=y(e.align,!b||h?"center":p?"right":"left");e.verticalAlign=y(e.verticalAlign,b||h?"middle":p?"top":"bottom");d.prototype.alignDataLabel.call(this,
a,c,e,g,f);a.isLabelJustified&&a.contrastColor&&a.dataLabel.css({color:a.contrastColor})})})(J);(function(a){var E=a.Chart,F=a.each,G=a.objectEach,q=a.pick;a=a.addEvent;a(E,"render",function(){var a=[];F(this.labelCollectors||[],function(f){a=a.concat(f())});F(this.yAxis||[],function(f){f.options.stackLabels&&!f.options.stackLabels.allowOverlap&&G(f.stacks,function(f){G(f,function(f){a.push(f.label)})})});F(this.series||[],function(f){var l=f.options.dataLabels,C=f.dataLabelCollections||["dataLabel"];
(l.enabled||f._hasPointLabels)&&!l.allowOverlap&&f.visible&&F(C,function(l){F(f.points,function(f){f[l]&&f.visible&&(f[l].labelrank=q(f.labelrank,f.shapeArgs&&f.shapeArgs.height),a.push(f[l]))})})});this.hideOverlappingLabels(a)});E.prototype.hideOverlappingLabels=function(a){var f=a.length,l=this.renderer,q,r,y,p,d,e,g=function(a,b,c,d,e,g,n,f){return!(e>a+c||e+n<a||g>b+d||g+f<b)};y=function(a){var b,c,d,e=2*(a.box?0:a.padding||0);d=0;if(a&&(!a.alignAttr||a.placed))return b=a.alignAttr||{x:a.attr("x"),
y:a.attr("y")},c=a.parentGroup,a.width||(d=a.getBBox(),a.width=d.width,a.height=d.height,d=l.fontMetrics(null,a.element).h),{x:b.x+(c.translateX||0),y:b.y+(c.translateY||0)-d,width:a.width-e,height:a.height-e}};for(r=0;r<f;r++)if(q=a[r])q.oldOpacity=q.opacity,q.newOpacity=1,q.absoluteBox=y(q);a.sort(function(a,b){return(b.labelrank||0)-(a.labelrank||0)});for(r=0;r<f;r++)for(e=(y=a[r])&&y.absoluteBox,q=r+1;q<f;++q)if(d=(p=a[q])&&p.absoluteBox,e&&d&&y!==p&&0!==y.newOpacity&&0!==p.newOpacity&&(d=g(e.x,
e.y,e.width,e.height,d.x,d.y,d.width,d.height)))(y.labelrank<p.labelrank?y:p).newOpacity=0;F(a,function(a){var b,c;a&&(c=a.newOpacity,a.oldOpacity!==c&&(a.alignAttr&&a.placed?(c?a.show(!0):b=function(){a.hide()},a.alignAttr.opacity=c,a[a.isOld?"animate":"attr"](a.alignAttr,null,b)):a.attr({opacity:c})),a.isOld=!0)})}})(J);(function(a){var E=a.addEvent,F=a.Chart,G=a.createElement,q=a.css,l=a.defaultOptions,f=a.defaultPlotOptions,u=a.each,C=a.extend,r=a.fireEvent,y=a.hasTouch,p=a.inArray,d=a.isObject,
e=a.Legend,g=a.merge,m=a.pick,b=a.Point,c=a.Series,x=a.seriesTypes,B=a.svg,t;t=a.TrackerMixin={drawTrackerPoint:function(){var a=this,b=a.chart.pointer,c=function(a){var c=b.getPointFromEvent(a);void 0!==c&&(b.isDirectTouch=!0,c.onMouseOver(a))};u(a.points,function(a){a.graphic&&(a.graphic.element.point=a);a.dataLabel&&(a.dataLabel.div?a.dataLabel.div.point=a:a.dataLabel.element.point=a)});a._hasTracking||(u(a.trackerGroups,function(d){if(a[d]){a[d].addClass("highcharts-tracker").on("mouseover",c).on("mouseout",
function(a){b.onTrackerMouseOut(a)});if(y)a[d].on("touchstart",c);a.options.cursor&&a[d].css(q).css({cursor:a.options.cursor})}}),a._hasTracking=!0);r(this,"afterDrawTracker")},drawTrackerGraph:function(){var a=this,b=a.options,c=b.trackByArea,d=[].concat(c?a.areaPath:a.graphPath),e=d.length,g=a.chart,f=g.pointer,m=g.renderer,w=g.options.tooltip.snap,k=a.tracker,l,p=function(){if(g.hoverSeries!==a)a.onMouseOver()},t="rgba(192,192,192,"+(B?.0001:.002)+")";if(e&&!c)for(l=e+1;l--;)"M"===d[l]&&d.splice(l+
1,0,d[l+1]-w,d[l+2],"L"),(l&&"M"===d[l]||l===e)&&d.splice(l,0,"L",d[l-2]+w,d[l-1]);k?k.attr({d:d}):a.graph&&(a.tracker=m.path(d).attr({"stroke-linejoin":"round",stroke:t,fill:c?t:"none","stroke-width":a.graph.strokeWidth()+(c?0:2*w),visibility:a.visible?"visible":"hidden",zIndex:2}).addClass(c?"highcharts-tracker-area":"highcharts-tracker-line").add(a.group),u([a.tracker,a.markerGroup],function(a){a.addClass("highcharts-tracker").on("mouseover",p).on("mouseout",function(a){f.onTrackerMouseOut(a)});
b.cursor&&a.css({cursor:b.cursor});if(y)a.on("touchstart",p)}));r(this,"afterDrawTracker")}};x.column&&(x.column.prototype.drawTracker=t.drawTrackerPoint);x.pie&&(x.pie.prototype.drawTracker=t.drawTrackerPoint);x.scatter&&(x.scatter.prototype.drawTracker=t.drawTrackerPoint);C(e.prototype,{setItemEvents:function(a,c,d){var e=this,h=e.chart.renderer.boxWrapper,n="highcharts-legend-"+(a instanceof b?"point":"series")+"-active";(d?c:a.legendGroup).on("mouseover",function(){a.setState("hover");h.addClass(n);
c.css(e.options.itemHoverStyle)}).on("mouseout",function(){c.css(g(a.visible?e.itemStyle:e.itemHiddenStyle));h.removeClass(n);a.setState()}).on("click",function(b){var c=function(){a.setVisible&&a.setVisible()};h.removeClass(n);b={browserEvent:b};a.firePointEvent?a.firePointEvent("legendItemClick",b,c):r(a,"legendItemClick",b,c)})},createCheckboxForItem:function(a){a.checkbox=G("input",{type:"checkbox",className:"highcharts-legend-checkbox",checked:a.selected,defaultChecked:a.selected},this.options.itemCheckboxStyle,
this.chart.container);E(a.checkbox,"click",function(b){r(a.series||a,"checkboxClick",{checked:b.target.checked,item:a},function(){a.select()})})}});l.legend.itemStyle.cursor="pointer";C(F.prototype,{showResetZoom:function(){function a(){b.zoomOut()}var b=this,c=l.lang,d=b.options.chart.resetZoomButton,e=d.theme,g=e.states,f="chart"===d.relativeTo?null:"plotBox";r(this,"beforeShowResetZoom",null,function(){b.resetZoomButton=b.renderer.button(c.resetZoom,null,null,a,e,g&&g.hover).attr({align:d.position.align,
title:c.resetZoomTitle}).addClass("highcharts-reset-zoom").add().align(d.position,!1,f)})},zoomOut:function(){r(this,"selection",{resetSelection:!0},this.zoom)},zoom:function(a){var b,c=this.pointer,e=!1,h;!a||a.resetSelection?(u(this.axes,function(a){b=a.zoom()}),c.initiated=!1):u(a.xAxis.concat(a.yAxis),function(a){var d=a.axis;c[d.isXAxis?"zoomX":"zoomY"]&&(b=d.zoom(a.min,a.max),d.displayBtn&&(e=!0))});h=this.resetZoomButton;e&&!h?this.showResetZoom():!e&&d(h)&&(this.resetZoomButton=h.destroy());
b&&this.redraw(m(this.options.chart.animation,a&&a.animation,100>this.pointCount))},pan:function(a,b){var c=this,d=c.hoverPoints,e;d&&u(d,function(a){a.setState()});u("xy"===b?[1,0]:[1],function(b){b=c[b?"xAxis":"yAxis"][0];var d=b.horiz,h=a[d?"chartX":"chartY"],d=d?"mouseDownX":"mouseDownY",g=c[d],k=(b.pointRange||0)/2,n=b.reversed&&!c.inverted||!b.reversed&&c.inverted?-1:1,f=b.getExtremes(),m=b.toValue(g-h,!0)+k*n,n=b.toValue(g+b.len-h,!0)-k*n,l=n<m,g=l?n:m,m=l?m:n,n=Math.min(f.dataMin,k?f.min:
b.toValue(b.toPixels(f.min)-b.minPixelPadding)),k=Math.max(f.dataMax,k?f.max:b.toValue(b.toPixels(f.max)+b.minPixelPadding)),l=n-g;0<l&&(m+=l,g=n);l=m-k;0<l&&(m=k,g-=l);b.series.length&&g!==f.min&&m!==f.max&&(b.setExtremes(g,m,!1,!1,{trigger:"pan"}),e=!0);c[d]=h});e&&c.redraw(!1);q(c.container,{cursor:"move"})}});C(b.prototype,{select:function(a,b){var c=this,d=c.series,e=d.chart;a=m(a,!c.selected);c.firePointEvent(a?"select":"unselect",{accumulate:b},function(){c.selected=c.options.selected=a;d.options.data[p(c,
d.data)]=c.options;c.setState(a&&"select");b||u(e.getSelectedPoints(),function(a){a.selected&&a!==c&&(a.selected=a.options.selected=!1,d.options.data[p(a,d.data)]=a.options,a.setState(""),a.firePointEvent("unselect"))})})},onMouseOver:function(a){var b=this.series.chart,c=b.pointer;a=a?c.normalize(a):c.getChartCoordinatesFromPoint(this,b.inverted);c.runPointActions(a,this)},onMouseOut:function(){var a=this.series.chart;this.firePointEvent("mouseOut");u(a.hoverPoints||[],function(a){a.setState()});
a.hoverPoints=a.hoverPoint=null},importEvents:function(){if(!this.hasImportedEvents){var b=this,c=g(b.series.options.point,b.options).events;b.events=c;a.objectEach(c,function(a,c){E(b,c,a)});this.hasImportedEvents=!0}},setState:function(a,b){var c=Math.floor(this.plotX),d=this.plotY,e=this.series,g=e.options.states[a||"normal"]||{},n=f[e.type].marker&&e.options.marker,v=n&&!1===n.enabled,l=n&&n.states&&n.states[a||"normal"]||{},k=!1===l.enabled,p=e.stateMarkerGraphic,t=this.marker||{},x=e.chart,
q=e.halo,B,u=n&&e.markerAttribs;a=a||"";if(!(a===this.state&&!b||this.selected&&"select"!==a||!1===g.enabled||a&&(k||v&&!1===l.enabled)||a&&t.states&&t.states[a]&&!1===t.states[a].enabled)){u&&(B=e.markerAttribs(this,a));if(this.graphic)this.state&&this.graphic.removeClass("highcharts-point-"+this.state),a&&this.graphic.addClass("highcharts-point-"+a),this.graphic.animate(e.pointAttribs(this,a),m(x.options.chart.animation,g.animation)),B&&this.graphic.animate(B,m(x.options.chart.animation,l.animation,
n.animation)),p&&p.hide();else{if(a&&l){n=t.symbol||e.symbol;p&&p.currentSymbol!==n&&(p=p.destroy());if(p)p[b?"animate":"attr"]({x:B.x,y:B.y});else n&&(e.stateMarkerGraphic=p=x.renderer.symbol(n,B.x,B.y,B.width,B.height).add(e.markerGroup),p.currentSymbol=n);p&&p.attr(e.pointAttribs(this,a))}p&&(p[a&&x.isInsidePlot(c,d,x.inverted)?"show":"hide"](),p.element.point=this)}(c=g.halo)&&c.size?(q||(e.halo=q=x.renderer.path().add((this.graphic||p).parentGroup)),q.show()[b?"animate":"attr"]({d:this.haloPath(c.size)}),
q.attr({"class":"highcharts-halo highcharts-color-"+m(this.colorIndex,e.colorIndex)+(this.className?" "+this.className:""),zIndex:-1}),q.point=this,q.attr(C({fill:this.color||e.color,"fill-opacity":c.opacity},c.attributes))):q&&q.point&&q.point.haloPath&&q.animate({d:q.point.haloPath(0)},null,q.hide);this.state=a;r(this,"afterSetState")}},haloPath:function(a){return this.series.chart.renderer.symbols.circle(Math.floor(this.plotX)-a,this.plotY-a,2*a,2*a)}});C(c.prototype,{onMouseOver:function(){var a=
this.chart,b=a.hoverSeries;if(b&&b!==this)b.onMouseOut();this.options.events.mouseOver&&r(this,"mouseOver");this.setState("hover");a.hoverSeries=this},onMouseOut:function(){var a=this.options,b=this.chart,c=b.tooltip,d=b.hoverPoint;b.hoverSeries=null;if(d)d.onMouseOut();this&&a.events.mouseOut&&r(this,"mouseOut");!c||this.stickyTracking||c.shared&&!this.noSharedTooltip||c.hide();this.setState()},setState:function(a){var b=this,c=b.options,d=b.graph,e=c.states,g=c.lineWidth,c=0;a=a||"";if(b.state!==
a&&(u([b.group,b.markerGroup,b.dataLabelsGroup],function(c){c&&(b.state&&c.removeClass("highcharts-series-"+b.state),a&&c.addClass("highcharts-series-"+a))}),b.state=a,!e[a]||!1!==e[a].enabled)&&(a&&(g=e[a].lineWidth||g+(e[a].lineWidthPlus||0)),d&&!d.dashstyle))for(g={"stroke-width":g},d.animate(g,m(e[a||"normal"]&&e[a||"normal"].animation,b.chart.options.chart.animation));b["zone-graph-"+c];)b["zone-graph-"+c].attr(g),c+=1},setVisible:function(a,b){var c=this,d=c.chart,e=c.legendItem,g,f=d.options.chart.ignoreHiddenSeries,
n=c.visible;g=(c.visible=a=c.options.visible=c.userOptions.visible=void 0===a?!n:a)?"show":"hide";u(["group","dataLabelsGroup","markerGroup","tracker","tt"],function(a){if(c[a])c[a][g]()});if(d.hoverSeries===c||(d.hoverPoint&&d.hoverPoint.series)===c)c.onMouseOut();e&&d.legend.colorizeItem(c,a);c.isDirty=!0;c.options.stacking&&u(d.series,function(a){a.options.stacking&&a.visible&&(a.isDirty=!0)});u(c.linkedSeries,function(b){b.setVisible(a,!1)});f&&(d.isDirtyBox=!0);r(c,g);!1!==b&&d.redraw()},show:function(){this.setVisible(!0)},
hide:function(){this.setVisible(!1)},select:function(a){this.selected=a=void 0===a?!this.selected:a;this.checkbox&&(this.checkbox.checked=a);r(this,a?"select":"unselect")},drawTracker:t.drawTrackerGraph})})(J);(function(a){var E=a.Chart,F=a.each,G=a.inArray,q=a.isArray,l=a.isObject,f=a.pick,u=a.splat;E.prototype.setResponsive=function(f){var l=this.options.responsive,q=[],p=this.currentResponsive;l&&l.rules&&F(l.rules,function(d){void 0===d._id&&(d._id=a.uniqueKey());this.matchResponsiveRule(d,q,
f)},this);var d=a.merge.apply(0,a.map(q,function(d){return a.find(l.rules,function(a){return a._id===d}).chartOptions})),q=q.toString()||void 0;q!==(p&&p.ruleIds)&&(p&&this.update(p.undoOptions,f),q?(this.currentResponsive={ruleIds:q,mergedOptions:d,undoOptions:this.currentOptions(d)},this.update(d,f)):this.currentResponsive=void 0)};E.prototype.matchResponsiveRule=function(a,l){var q=a.condition;(q.callback||function(){return this.chartWidth<=f(q.maxWidth,Number.MAX_VALUE)&&this.chartHeight<=f(q.maxHeight,
Number.MAX_VALUE)&&this.chartWidth>=f(q.minWidth,0)&&this.chartHeight>=f(q.minHeight,0)}).call(this)&&l.push(a._id)};E.prototype.currentOptions=function(f){function r(f,d,e,g){var m;a.objectEach(f,function(a,c){if(!g&&-1<G(c,["series","xAxis","yAxis"]))for(a=u(a),e[c]=[],m=0;m<a.length;m++)d[c][m]&&(e[c][m]={},r(a[m],d[c][m],e[c][m],g+1));else l(a)?(e[c]=q(a)?[]:{},r(a,d[c]||{},e[c],g+1)):e[c]=d[c]||null})}var y={};r(f,this.options,y,0);return y}})(J);(function(a){var E=a.addEvent,F=a.Axis,G=a.Chart,
q=a.css,l=a.defined,f=a.each,u=a.extend,C=a.noop,r=a.pick,y=a.timeUnits,p=a.wrap;p(a.Series.prototype,"init",function(a){var d;a.apply(this,Array.prototype.slice.call(arguments,1));(d=this.xAxis)&&d.options.ordinal&&E(this,"updatedData",function(){delete d.ordinalIndex})});p(F.prototype,"getTimeTicks",function(a,e,g,f,b,c,p,q){var d=0,n,m,x={},r,h,B,u=[],v=-Number.MAX_VALUE,w=this.options.tickPixelInterval,k=this.chart.time;if(!this.options.ordinal&&!this.options.breaks||!c||3>c.length||void 0===
g)return a.call(this,e,g,f,b);h=c.length;for(n=0;n<h;n++){B=n&&c[n-1]>f;c[n]<g&&(d=n);if(n===h-1||c[n+1]-c[n]>5*p||B){if(c[n]>v){for(m=a.call(this,e,c[d],c[n],b);m.length&&m[0]<=v;)m.shift();m.length&&(v=m[m.length-1]);u=u.concat(m)}d=n+1}if(B)break}a=m.info;if(q&&a.unitRange<=y.hour){n=u.length-1;for(d=1;d<n;d++)k.dateFormat("%d",u[d])!==k.dateFormat("%d",u[d-1])&&(x[u[d]]="day",r=!0);r&&(x[u[0]]="day");a.higherRanks=x}u.info=a;if(q&&l(w)){q=k=u.length;n=[];var A;for(r=[];q--;)d=this.translate(u[q]),
A&&(r[q]=A-d),n[q]=A=d;r.sort();r=r[Math.floor(r.length/2)];r<.6*w&&(r=null);q=u[k-1]>f?k-1:k;for(A=void 0;q--;)d=n[q],f=Math.abs(A-d),A&&f<.8*w&&(null===r||f<.8*r)?(x[u[q]]&&!x[u[q+1]]?(f=q+1,A=d):f=q,u.splice(f,1)):A=d}return u});u(F.prototype,{beforeSetTickPositions:function(){var a,e=[],g,m=!1,b,c=this.getExtremes(),p=c.min,q=c.max,t,n=this.isXAxis&&!!this.options.breaks,c=this.options.ordinal,u=Number.MAX_VALUE,z=this.chart.options.chart.ignoreHiddenSeries;b="highcharts-navigator-xaxis"===this.options.className;
var D;!this.options.overscroll||this.max!==this.dataMax||this.chart.mouseIsDown&&!b||this.eventArgs&&(!this.eventArgs||"navigator"===this.eventArgs.trigger)||(this.max+=this.options.overscroll,!b&&l(this.userMin)&&(this.min+=this.options.overscroll));if(c||n){f(this.series,function(b,c){g=[];if(!(z&&!1===b.visible||!1===b.takeOrdinalPosition&&!n)&&(e=e.concat(b.processedXData),a=e.length,e.sort(function(a,b){return a-b}),u=Math.min(u,r(b.closestPointRange,u)),a)){for(c=0;c<a-1;)e[c]!==e[c+1]&&g.push(e[c+
1]),c++;g[0]!==e[0]&&g.unshift(e[0]);e=g}b.isSeriesBoosting&&(D=!0)});D&&(e.length=0);a=e.length;if(2<a){b=e[1]-e[0];for(t=a-1;t--&&!m;)e[t+1]-e[t]!==b&&(m=!0);!this.options.keepOrdinalPadding&&(e[0]-p>b||q-e[e.length-1]>b)&&(m=!0)}else this.options.overscroll&&(2===a?u=e[1]-e[0]:1===a?(u=this.options.overscroll,e=[e[0],e[0]+u]):u=this.overscrollPointsRange);m?(this.options.overscroll&&(this.overscrollPointsRange=u,e=e.concat(this.getOverscrollPositions())),this.ordinalPositions=e,b=this.ordinal2lin(Math.max(p,
e[0]),!0),t=Math.max(this.ordinal2lin(Math.min(q,e[e.length-1]),!0),1),this.ordinalSlope=q=(q-p)/(t-b),this.ordinalOffset=p-b*q):(this.overscrollPointsRange=r(this.closestPointRange,this.overscrollPointsRange),this.ordinalPositions=this.ordinalSlope=this.ordinalOffset=void 0)}this.isOrdinal=c&&m;this.groupIntervalFactor=null},val2lin:function(a,e){var d=this.ordinalPositions;if(d){var f=d.length,b,c;for(b=f;b--;)if(d[b]===a){c=b;break}for(b=f-1;b--;)if(a>d[b]||0===b){a=(a-d[b])/(d[b+1]-d[b]);c=b+
a;break}e=e?c:this.ordinalSlope*(c||0)+this.ordinalOffset}else e=a;return e},lin2val:function(a,e){var d=this.ordinalPositions;if(d){var f=this.ordinalSlope,b=this.ordinalOffset,c=d.length-1,l;if(e)0>a?a=d[0]:a>c?a=d[c]:(c=Math.floor(a),l=a-c);else for(;c--;)if(e=f*c+b,a>=e){f=f*(c+1)+b;l=(a-e)/(f-e);break}return void 0!==l&&void 0!==d[c]?d[c]+(l?l*(d[c+1]-d[c]):0):a}return a},getExtendedPositions:function(){var a=this,e=a.chart,g=a.series[0].currentDataGrouping,m=a.ordinalIndex,b=g?g.count+g.unitName:
"raw",c=a.options.overscroll,l=a.getExtremes(),p,t;m||(m=a.ordinalIndex={});m[b]||(p={series:[],chart:e,getExtremes:function(){return{min:l.dataMin,max:l.dataMax+c}},options:{ordinal:!0},val2lin:F.prototype.val2lin,ordinal2lin:F.prototype.ordinal2lin},f(a.series,function(b){t={xAxis:p,xData:b.xData.slice(),chart:e,destroyGroupedData:C};t.xData=t.xData.concat(a.getOverscrollPositions());t.options={dataGrouping:g?{enabled:!0,forced:!0,approximation:"open",units:[[g.unitName,[g.count]]]}:{enabled:!1}};
b.processData.apply(t);p.series.push(t)}),a.beforeSetTickPositions.apply(p),m[b]=p.ordinalPositions);return m[b]},getOverscrollPositions:function(){var d=this.options.overscroll,e=this.overscrollPointsRange,g=[],f=this.dataMax;if(a.defined(e))for(g.push(f);f<=this.dataMax+d;)f+=e,g.push(f);return g},getGroupIntervalFactor:function(a,e,g){var d;g=g.processedXData;var b=g.length,c=[];d=this.groupIntervalFactor;if(!d){for(d=0;d<b-1;d++)c[d]=g[d+1]-g[d];c.sort(function(a,b){return a-b});c=c[Math.floor(b/
2)];a=Math.max(a,g[0]);e=Math.min(e,g[b-1]);this.groupIntervalFactor=d=b*c/(e-a)}return d},postProcessTickInterval:function(a){var d=this.ordinalSlope;return d?this.options.breaks?this.closestPointRange||a:a/(d/this.closestPointRange):a}});F.prototype.ordinal2lin=F.prototype.val2lin;p(G.prototype,"pan",function(a,e){var d=this.xAxis[0],m=d.options.overscroll,b=e.chartX,c=!1;if(d.options.ordinal&&d.series.length){var l=this.mouseDownX,p=d.getExtremes(),t=p.dataMax,n=p.min,r=p.max,z=this.hoverPoints,
D=d.closestPointRange||d.overscrollPointsRange,l=(l-b)/(d.translationSlope*(d.ordinalSlope||D)),h={ordinalPositions:d.getExtendedPositions()},D=d.lin2val,u=d.val2lin,y;h.ordinalPositions?1<Math.abs(l)&&(z&&f(z,function(a){a.setState()}),0>l?(z=h,y=d.ordinalPositions?d:h):(z=d.ordinalPositions?d:h,y=h),h=y.ordinalPositions,t>h[h.length-1]&&h.push(t),this.fixedRange=r-n,l=d.toFixedRange(null,null,D.apply(z,[u.apply(z,[n,!0])+l,!0]),D.apply(y,[u.apply(y,[r,!0])+l,!0])),l.min>=Math.min(p.dataMin,n)&&
l.max<=Math.max(t,r)+m&&d.setExtremes(l.min,l.max,!0,!1,{trigger:"pan"}),this.mouseDownX=b,q(this.container,{cursor:"move"})):c=!0}else c=!0;c&&(m&&(d.max=d.dataMax+m),a.apply(this,Array.prototype.slice.call(arguments,1)))})})(J);(function(a){function E(){return Array.prototype.slice.call(arguments,1)}function F(a){a.apply(this);this.drawBreaks(this.xAxis,["x"]);this.drawBreaks(this.yAxis,q(this.pointArrayMap,["y"]))}var G=a.addEvent,q=a.pick,l=a.wrap,f=a.each,u=a.extend,C=a.isArray,r=a.fireEvent,
y=a.Axis,p=a.Series;u(y.prototype,{isInBreak:function(a,e){var d=a.repeat||Infinity,f=a.from,b=a.to-a.from;e=e>=f?(e-f)%d:d-(f-e)%d;return a.inclusive?e<=b:e<b&&0!==e},isInAnyBreak:function(a,e){var d=this.options.breaks,f=d&&d.length,b,c,l;if(f){for(;f--;)this.isInBreak(d[f],a)&&(b=!0,c||(c=q(d[f].showPoints,this.isXAxis?!1:!0)));l=b&&e?b&&!c:b}return l}});G(y,"afterSetTickPositions",function(){if(this.options.breaks){var a=this.tickPositions,e=this.tickPositions.info,g=[],f;for(f=0;f<a.length;f++)this.isInAnyBreak(a[f])||
g.push(a[f]);this.tickPositions=g;this.tickPositions.info=e}});G(y,"afterSetOptions",function(){this.options.breaks&&this.options.breaks.length&&(this.options.ordinal=!1)});G(y,"afterInit",function(){var a=this,e;e=this.options.breaks;a.isBroken=C(e)&&!!e.length;a.isBroken&&(a.val2lin=function(d){var e=d,b,c;for(c=0;c<a.breakArray.length;c++)if(b=a.breakArray[c],b.to<=d)e-=b.len;else if(b.from>=d)break;else if(a.isInBreak(b,d)){e-=d-b.from;break}return e},a.lin2val=function(d){var e,b;for(b=0;b<a.breakArray.length&&
!(e=a.breakArray[b],e.from>=d);b++)e.to<d?d+=e.len:a.isInBreak(e,d)&&(d+=e.len);return d},a.setExtremes=function(a,d,b,c,e){for(;this.isInAnyBreak(a);)a-=this.closestPointRange;for(;this.isInAnyBreak(d);)d-=this.closestPointRange;y.prototype.setExtremes.call(this,a,d,b,c,e)},a.setAxisTranslation=function(d){y.prototype.setAxisTranslation.call(this,d);d=a.options.breaks;var e=[],b=[],c=0,g,l,p=a.userMin||a.min,n=a.userMax||a.max,u=q(a.pointRangePadding,0),z,D;f(d,function(b){l=b.repeat||Infinity;a.isInBreak(b,
p)&&(p+=b.to%l-p%l);a.isInBreak(b,n)&&(n-=n%l-b.from%l)});f(d,function(a){z=a.from;for(l=a.repeat||Infinity;z-l>p;)z-=l;for(;z<p;)z+=l;for(D=z;D<n;D+=l)e.push({value:D,move:"in"}),e.push({value:D+(a.to-a.from),move:"out",size:a.breakSize})});e.sort(function(a,b){return a.value===b.value?("in"===a.move?0:1)-("in"===b.move?0:1):a.value-b.value});g=0;z=p;f(e,function(a){g+="in"===a.move?1:-1;1===g&&"in"===a.move&&(z=a.value);0===g&&(b.push({from:z,to:a.value,len:a.value-z-(a.size||0)}),c+=a.value-z-
(a.size||0))});a.breakArray=b;a.unitLength=n-p-c+u;r(a,"afterBreaks");a.options.staticScale?a.transA=a.options.staticScale:a.unitLength&&(a.transA*=(n-a.min+u)/a.unitLength);u&&(a.minPixelPadding=a.transA*a.minPointOffset);a.min=p;a.max=n})});l(p.prototype,"generatePoints",function(a){a.apply(this,E(arguments));var d=this.xAxis,f=this.yAxis,m=this.points,b,c=m.length,l=this.options.connectNulls,p;if(d&&f&&(d.options.breaks||f.options.breaks))for(;c--;)b=m[c],p=null===b.y&&!1===l,p||!d.isInAnyBreak(b.x,
!0)&&!f.isInAnyBreak(b.y,!0)||(m.splice(c,1),this.data[c]&&this.data[c].destroyElements())});a.Series.prototype.drawBreaks=function(a,e){var d=this,m=d.points,b,c,l,p;a&&f(e,function(e){b=a.breakArray||[];c=a.isXAxis?a.min:q(d.options.threshold,a.min);f(m,function(d){p=q(d["stack"+e.toUpperCase()],d[e]);f(b,function(b){l=!1;if(c<b.from&&p>b.to||c>b.from&&p<b.from)l="pointBreak";else if(c<b.from&&p>b.from&&p<b.to||c>b.from&&p>b.to&&p<b.from)l="pointInBreak";l&&r(a,l,{point:d,brk:b})})})})};a.Series.prototype.gappedPath=
function(){var d=this.currentDataGrouping,e=d&&d.totalRange,d=this.options.gapSize,f=this.points.slice(),l=f.length-1,b=this.yAxis;if(d&&0<l)for("value"!==this.options.gapUnit&&(d*=this.closestPointRange),e&&e>d&&(d=e);l--;)f[l+1].x-f[l].x>d&&(e=(f[l].x+f[l+1].x)/2,f.splice(l+1,0,{isNull:!0,x:e}),this.options.stacking&&(e=b.stacks[this.stackKey][e]=new a.StackItem(b,b.options.stackLabels,!1,e,this.stack),e.total=0));return this.getGraphPath(f)};l(a.seriesTypes.column.prototype,"drawPoints",F);l(a.Series.prototype,
"drawPoints",F)})(J);(function(a){var E=a.addEvent,F=a.arrayMax,G=a.arrayMin,q=a.Axis,l=a.defaultPlotOptions,f=a.defined,u=a.each,C=a.extend,r=a.format,y=a.isNumber,p=a.merge,d=a.pick,e=a.Point,g=a.Series,m=a.Tooltip,b=a.wrap,c=g.prototype,x=c.processData,B=c.generatePoints,t={approximation:"average",groupPixelWidth:2,dateTimeLabelFormats:{millisecond:["%A, %b %e, %H:%M:%S.%L","%A, %b %e, %H:%M:%S.%L","-%H:%M:%S.%L"],second:["%A, %b %e, %H:%M:%S","%A, %b %e, %H:%M:%S","-%H:%M:%S"],minute:["%A, %b %e, %H:%M",
"%A, %b %e, %H:%M","-%H:%M"],hour:["%A, %b %e, %H:%M","%A, %b %e, %H:%M","-%H:%M"],day:["%A, %b %e, %Y","%A, %b %e","-%A, %b %e, %Y"],week:["Week from %A, %b %e, %Y","%A, %b %e","-%A, %b %e, %Y"],month:["%B %Y","%B","-%B %Y"],year:["%Y","%Y","-%Y"]}},n={line:{},spline:{},area:{},areaspline:{},column:{approximation:"sum",groupPixelWidth:10},arearange:{approximation:"range"},areasplinerange:{approximation:"range"},columnrange:{approximation:"range",groupPixelWidth:10},candlestick:{approximation:"ohlc",
groupPixelWidth:10},ohlc:{approximation:"ohlc",groupPixelWidth:5}},L=a.defaultDataGroupingUnits=[["millisecond",[1,2,5,10,20,25,50,100,200,500]],["second",[1,2,5,10,15,30]],["minute",[1,2,5,10,15,30]],["hour",[1,2,3,4,6,8,12]],["day",[1]],["week",[1]],["month",[1,3,6]],["year",null]],z=a.approximations={sum:function(a){var b=a.length,c;if(!b&&a.hasNulls)c=null;else if(b)for(c=0;b--;)c+=a[b];return c},average:function(a){var b=a.length;a=z.sum(a);y(a)&&b&&(a/=b);return a},averages:function(){var a=
[];u(arguments,function(b){a.push(z.average(b))});return void 0===a[0]?void 0:a},open:function(a){return a.length?a[0]:a.hasNulls?null:void 0},high:function(a){return a.length?F(a):a.hasNulls?null:void 0},low:function(a){return a.length?G(a):a.hasNulls?null:void 0},close:function(a){return a.length?a[a.length-1]:a.hasNulls?null:void 0},ohlc:function(a,b,c,d){a=z.open(a);b=z.high(b);c=z.low(c);d=z.close(d);if(y(a)||y(b)||y(c)||y(d))return[a,b,c,d]},range:function(a,b){a=z.low(a);b=z.high(b);if(y(a)||
y(b))return[a,b];if(null===a&&null===b)return null}};c.groupData=function(a,b,c,d){var e=this,g=e.data,k=e.options.data,h=[],l=[],m=[],p=a.length,q,r,x=!!b,D=[];d="function"===typeof d?d:z[d]||n[e.type]&&z[n[e.type].approximation]||z[t.approximation];var B=e.pointArrayMap,C=B&&B.length,H=["x"].concat(B||["y"]),E=0,L=0,F,I;C?u(B,function(){D.push([])}):D.push([]);F=C||1;for(I=0;I<=p&&!(a[I]>=c[0]);I++);for(I;I<=p;I++){for(;void 0!==c[E+1]&&a[I]>=c[E+1]||I===p;){q=c[E];e.dataGroupInfo={start:L,length:D[0].length};
r=d.apply(e,D);f(e.dataGroupInfo.options)||(e.dataGroupInfo.options=e.pointClass.prototype.optionsToObject.call({series:e},e.options.data[L]),u(H,function(a){delete e.dataGroupInfo.options[a]}));void 0!==r&&(h.push(q),l.push(r),m.push(e.dataGroupInfo));L=I;for(q=0;q<F;q++)D[q].length=0,D[q].hasNulls=!1;E+=1;if(I===p)break}if(I===p)break;if(B){q=e.cropStart+I;r=g&&g[q]||e.pointClass.prototype.applyOptions.apply({series:e},[k[q]]);var G;for(q=0;q<C;q++)G=r[B[q]],y(G)?D[q].push(G):null===G&&(D[q].hasNulls=
!0)}else q=x?b[I]:null,y(q)?D[0].push(q):null===q&&(D[0].hasNulls=!0)}return[h,l,m]};c.processData=function(){var a=this.chart,b=this.options.dataGrouping,e=!1!==this.allowDG&&b&&d(b.enabled,a.options.isStock),g=this.visible||!a.options.chart.ignoreHiddenSeries,n,l=this.currentDataGrouping,k;this.forceCrop=e;this.groupPixelWidth=null;this.hasProcessed=!0;if(!1!==x.apply(this,arguments)&&e){this.destroyGroupedData();var m,p=b.groupAll?this.xData:this.processedXData,t=b.groupAll?this.yData:this.processedYData,
q=a.plotSizeX,a=this.xAxis,r=a.options.ordinal,z=this.groupPixelWidth=a.getGroupPixelWidth&&a.getGroupPixelWidth();if(z){this.isDirty=n=!0;this.points=null;e=a.getExtremes();k=e.min;e=e.max;r=r&&a.getGroupIntervalFactor(k,e,this)||1;z=z*(e-k)/q*r;q=a.getTimeTicks(a.normalizeTimeTickInterval(z,b.units||L),Math.min(k,p[0]),Math.max(e,p[p.length-1]),a.options.startOfWeek,p,this.closestPointRange);t=c.groupData.apply(this,[p,t,q,b.approximation]);p=t[0];r=t[1];if(b.smoothed&&p.length){m=p.length-1;for(p[m]=
Math.min(p[m],e);m--&&0<m;)p[m]+=z/2;p[0]=Math.max(p[0],k)}k=q.info;this.closestPointRange=q.info.totalRange;this.groupMap=t[2];if(f(p[0])&&p[0]<a.dataMin&&g){if(!f(a.options.min)&&a.min<=a.dataMin||a.min===a.dataMin)a.min=p[0];a.dataMin=p[0]}b.groupAll&&(b=this.cropData(p,r,a.min,a.max,1),p=b.xData,r=b.yData);this.processedXData=p;this.processedYData=r}else this.groupMap=null;this.hasGroupedData=n;this.currentDataGrouping=k;this.preventGraphAnimation=(l&&l.totalRange)!==(k&&k.totalRange)}};c.destroyGroupedData=
function(){var a=this.groupedData;u(a||[],function(b,c){b&&(a[c]=b.destroy?b.destroy():null)});this.groupedData=null};c.generatePoints=function(){B.apply(this);this.destroyGroupedData();this.groupedData=this.hasGroupedData?this.points:null};E(e,"update",function(){if(this.dataGroup)return a.error(24),!1});b(m.prototype,"tooltipFooterHeaderFormatter",function(a,b,c){var d=this.chart.time,e=b.series,f=e.tooltipOptions,k=e.options.dataGrouping,g=f.xDateFormat,h,n=e.xAxis;return n&&"datetime"===n.options.type&&
k&&y(b.key)?(a=e.currentDataGrouping,k=k.dateTimeLabelFormats,a?(n=k[a.unitName],1===a.count?g=n[0]:(g=n[1],h=n[2])):!g&&k&&(g=this.getXDateFormat(b,f,n)),g=d.dateFormat(g,b.key),h&&(g+=d.dateFormat(h,b.key+a.totalRange-1)),r(f[(c?"footer":"header")+"Format"],{point:C(b.point,{key:g}),series:e},d)):a.call(this,b,c)});E(g,"destroy",c.destroyGroupedData);E(g,"afterSetOptions",function(a){a=a.options;var b=this.type,c=this.chart.options.plotOptions,d=l[b].dataGrouping,e=this.useCommonDataGrouping&&t;
if(n[b]||e)d||(d=p(t,n[b])),a.dataGrouping=p(e,d,c.series&&c.series.dataGrouping,c[b].dataGrouping,this.userOptions.dataGrouping);this.chart.options.isStock&&(this.requireSorting=!0)});E(q,"afterSetScale",function(){u(this.series,function(a){a.hasProcessed=!1})});q.prototype.getGroupPixelWidth=function(){var a=this.series,b=a.length,c,d=0,e=!1,f;for(c=b;c--;)(f=a[c].options.dataGrouping)&&(d=Math.max(d,f.groupPixelWidth));for(c=b;c--;)(f=a[c].options.dataGrouping)&&a[c].hasProcessed&&(b=(a[c].processedXData||
a[c].data).length,a[c].groupPixelWidth||b>this.chart.plotSizeX/d||b&&f.forced)&&(e=!0);return e?d:0};q.prototype.setDataGrouping=function(a,b){var c;b=d(b,!0);a||(a={forced:!1,units:null});if(this instanceof q)for(c=this.series.length;c--;)this.series[c].update({dataGrouping:a},!1);else u(this.chart.options.series,function(b){b.dataGrouping=a},!1);this.ordinalSlope=null;b&&this.chart.redraw()}})(J);(function(a){var E=a.each,F=a.Point,G=a.seriesType,q=a.seriesTypes;G("ohlc","column",{lineWidth:1,tooltip:{pointFormat:'\x3cspan style\x3d"color:{point.color}"\x3e\u25cf\x3c/span\x3e \x3cb\x3e {series.name}\x3c/b\x3e\x3cbr/\x3eOpen: {point.open}\x3cbr/\x3eHigh: {point.high}\x3cbr/\x3eLow: {point.low}\x3cbr/\x3eClose: {point.close}\x3cbr/\x3e'},
threshold:null,states:{hover:{lineWidth:3}},stickyTracking:!0},{directTouch:!1,pointArrayMap:["open","high","low","close"],toYData:function(a){return[a.open,a.high,a.low,a.close]},pointValKey:"close",pointAttrToOptions:{stroke:"color","stroke-width":"lineWidth"},init:function(){q.column.prototype.init.apply(this,arguments);this.options.stacking=!1},pointAttribs:function(a,f){f=q.column.prototype.pointAttribs.call(this,a,f);var l=this.options;delete f.fill;!a.options.color&&l.upColor&&a.open<a.close&&
(f.stroke=l.upColor);return f},translate:function(){var a=this,f=a.yAxis,u=!!a.modifyValue,C=["plotOpen","plotHigh","plotLow","plotClose","yBottom"];q.column.prototype.translate.apply(a);E(a.points,function(l){E([l.open,l.high,l.low,l.close,l.low],function(q,p){null!==q&&(u&&(q=a.modifyValue(q)),l[C[p]]=f.toPixels(q,!0))});l.tooltipPos[1]=l.plotHigh+f.pos-a.chart.plotTop})},drawPoints:function(){var a=this,f=a.chart;E(a.points,function(l){var q,r,u,p,d=l.graphic,e,g=!d;void 0!==l.plotY&&(d||(l.graphic=
d=f.renderer.path().add(a.group)),d.attr(a.pointAttribs(l,l.selected&&"select")),r=d.strokeWidth()%2/2,e=Math.round(l.plotX)-r,u=Math.round(l.shapeArgs.width/2),p=["M",e,Math.round(l.yBottom),"L",e,Math.round(l.plotHigh)],null!==l.open&&(q=Math.round(l.plotOpen)+r,p.push("M",e,q,"L",e-u,q)),null!==l.close&&(q=Math.round(l.plotClose)+r,p.push("M",e,q,"L",e+u,q)),d[g?"attr":"animate"]({d:p}).addClass(l.getClassName(),!0))})},animate:null},{getClassName:function(){return F.prototype.getClassName.call(this)+
(this.open<this.close?" highcharts-point-up":" highcharts-point-down")}})})(J);(function(a){var E=a.defaultPlotOptions,F=a.each,G=a.merge,q=a.seriesType,l=a.seriesTypes;q("candlestick","ohlc",G(E.column,{states:{hover:{lineWidth:2}},tooltip:E.ohlc.tooltip,threshold:null,lineColor:"#000000",lineWidth:1,upColor:"#ffffff",stickyTracking:!0}),{pointAttribs:function(a,q){var f=l.column.prototype.pointAttribs.call(this,a,q),r=this.options,u=a.open<a.close,p=r.lineColor||this.color;f["stroke-width"]=r.lineWidth;
f.fill=a.options.color||(u?r.upColor||this.color:this.color);f.stroke=a.lineColor||(u?r.upLineColor||p:p);q&&(a=r.states[q],f.fill=a.color||f.fill,f.stroke=a.lineColor||f.stroke,f["stroke-width"]=a.lineWidth||f["stroke-width"]);return f},drawPoints:function(){var a=this,l=a.chart,q=a.yAxis.reversed;F(a.points,function(f){var r=f.graphic,p,d,e,g,m,b,c,x=!r;void 0!==f.plotY&&(r||(f.graphic=r=l.renderer.path().add(a.group)),r.attr(a.pointAttribs(f,f.selected&&"select")).shadow(a.options.shadow),m=r.strokeWidth()%
2/2,b=Math.round(f.plotX)-m,p=f.plotOpen,d=f.plotClose,e=Math.min(p,d),p=Math.max(p,d),c=Math.round(f.shapeArgs.width/2),d=q?p!==f.yBottom:Math.round(e)!==Math.round(f.plotHigh),g=q?Math.round(e)!==Math.round(f.plotHigh):p!==f.yBottom,e=Math.round(e)+m,p=Math.round(p)+m,m=[],m.push("M",b-c,p,"L",b-c,e,"L",b+c,e,"L",b+c,p,"Z","M",b,e,"L",b,d?Math.round(q?f.yBottom:f.plotHigh):e,"M",b,p,"L",b,g?Math.round(q?f.plotHigh:f.yBottom):p),r[x?"attr":"animate"]({d:m}).addClass(f.getClassName(),!0))})}})})(J);
ea=function(a){var E=a.each,F=a.defined,G=a.seriesTypes,q=a.stableSort;return{getPlotBox:function(){return a.Series.prototype.getPlotBox.call(this.options.onSeries&&this.chart.get(this.options.onSeries)||this)},translate:function(){G.column.prototype.translate.apply(this);var a=this.options,f=this.chart,u=this.points,C=u.length-1,r,y,p=a.onSeries,p=p&&f.get(p),a=a.onKey||"y",d=p&&p.options.step,e=p&&p.points,g=e&&e.length,m=f.inverted,b=this.xAxis,c=this.yAxis,x=0,B,t,n,L;if(p&&p.visible&&g)for(x=
(p.pointXOffset||0)+(p.barW||0)/2,r=p.currentDataGrouping,t=e[g-1].x+(r?r.totalRange:0),q(u,function(a,b){return a.x-b.x}),a="plot"+a[0].toUpperCase()+a.substr(1);g--&&u[C]&&!(B=e[g],r=u[C],r.y=B.y,B.x<=r.x&&void 0!==B[a]&&(r.x<=t&&(r.plotY=B[a],B.x<r.x&&!d&&(n=e[g+1])&&void 0!==n[a]&&(L=(r.x-B.x)/(n.x-B.x),r.plotY+=L*(n[a]-B[a]),r.y+=L*(n.y-B.y))),C--,g++,0>C)););E(u,function(a,d){var e;a.plotX+=x;if(void 0===a.plotY||m)0<=a.plotX&&a.plotX<=b.len?m?(a.plotY=b.translate(a.x,0,1,0,1),a.plotX=F(a.y)?
c.translate(a.y,0,0,0,1):0):a.plotY=f.chartHeight-b.bottom-(b.opposite?b.height:0)+b.offset-c.top:a.shapeArgs={};(y=u[d-1])&&y.plotX===a.plotX&&(void 0===y.stackIndex&&(y.stackIndex=0),e=y.stackIndex+1);a.stackIndex=e});this.onSeries=p}}}(J);(function(a,E){function F(a){d[a+"pin"]=function(e,f,b,c,l){var g=l&&l.anchorX;l=l&&l.anchorY;"circle"===a&&c>b&&(e-=Math.round((c-b)/2),b=c);e=d[a](e,f,b,c);g&&l&&(e.push("M","circle"===a?e[1]-e[4]:e[1]+e[4]/2,f>l?f:f+c,"L",g,l),e=e.concat(d.circle(g-1,l-1,2,
2)));return e}}var G=a.addEvent,q=a.each,l=a.merge,f=a.noop,u=a.Renderer,C=a.Series,r=a.seriesType,y=a.TrackerMixin,p=a.VMLRenderer,d=a.SVGRenderer.prototype.symbols;r("flags","column",{pointRange:0,allowOverlapX:!1,shape:"flag",stackDistance:12,textAlign:"center",tooltip:{pointFormat:"{point.text}\x3cbr/\x3e"},threshold:null,y:-30,fillColor:"#ffffff",lineWidth:1,states:{hover:{lineColor:"#000000",fillColor:"#ccd6eb"}},style:{fontSize:"11px",fontWeight:"bold"}},{sorted:!1,noSharedTooltip:!0,allowDG:!1,
takeOrdinalPosition:!1,trackerGroups:["markerGroup"],forceCrop:!0,init:C.prototype.init,pointAttribs:function(a,d){var e=this.options,b=a&&a.color||this.color,c=e.lineColor,f=a&&a.lineWidth;a=a&&a.fillColor||e.fillColor;d&&(a=e.states[d].fillColor,c=e.states[d].lineColor,f=e.states[d].lineWidth);return{fill:a||b,stroke:c||b,"stroke-width":f||e.lineWidth||0}},translate:E.translate,getPlotBox:E.getPlotBox,drawPoints:function(){var d=this.points,f=this.chart,m=f.renderer,b,c,p=f.inverted,r=this.options,
t=r.y,n,u,z,D,h,y,C=this.yAxis,v={},w=[];for(u=d.length;u--;)z=d[u],y=(p?z.plotY:z.plotX)>this.xAxis.len,b=z.plotX,D=z.stackIndex,n=z.options.shape||r.shape,c=z.plotY,void 0!==c&&(c=z.plotY+t-(void 0!==D&&D*r.stackDistance)),z.anchorX=D?void 0:z.plotX,h=D?void 0:z.plotY,D=z.graphic,void 0!==c&&0<=b&&!y?(D||(D=z.graphic=m.label("",null,null,n,null,null,r.useHTML).attr(this.pointAttribs(z)).css(l(r.style,z.style)).attr({align:"flag"===n?"left":"center",width:r.width,height:r.height,"text-align":r.textAlign}).addClass("highcharts-point").add(this.markerGroup),
z.graphic.div&&(z.graphic.div.point=z),D.shadow(r.shadow),D.isNew=!0),0<b&&(b-=D.strokeWidth()%2),n={y:c,anchorY:h},r.allowOverlapX&&(n.x=b,n.anchorX=z.anchorX),D.attr({text:z.options.title||r.title||"A"})[D.isNew?"attr":"animate"](n),r.allowOverlapX||(v[z.plotX]?v[z.plotX].size=Math.max(v[z.plotX].size,D.width):v[z.plotX]={align:0,size:D.width,target:b,anchorX:b}),z.tooltipPos=[b,c+C.pos-f.plotTop]):D&&(z.graphic=D.destroy());r.allowOverlapX||(a.objectEach(v,function(a){a.plotX=a.anchorX;w.push(a)}),
a.distribute(w,p?C.len:this.xAxis.len,100),q(d,function(a){var b=a.graphic&&v[a.plotX];b&&(a.graphic[a.graphic.isNew?"attr":"animate"]({x:b.pos,anchorX:a.anchorX}),b.pos?a.graphic.isNew=!1:(a.graphic.attr({x:-9999,anchorX:-9999}),a.graphic.isNew=!0))}));r.useHTML&&a.wrap(this.markerGroup,"on",function(b){return a.SVGElement.prototype.on.apply(b.apply(this,[].slice.call(arguments,1)),[].slice.call(arguments,1))})},drawTracker:function(){var a=this.points;y.drawTrackerPoint.apply(this);q(a,function(d){var e=
d.graphic;e&&G(e.element,"mouseover",function(){0<d.stackIndex&&!d.raised&&(d._y=e.y,e.attr({y:d._y-8}),d.raised=!0);q(a,function(a){a!==d&&a.raised&&a.graphic&&(a.graphic.attr({y:a._y}),a.raised=!1)})})})},animate:function(a){a?this.setClip():this.animate=null},setClip:function(){C.prototype.setClip.apply(this,arguments);!1!==this.options.clip&&this.sharedClipKey&&this.markerGroup.clip(this.chart[this.sharedClipKey])},buildKDTree:f,invertGroups:f});d.flag=function(a,f,l,b,c){var e=c&&c.anchorX||
a;c=c&&c.anchorY||f;return d.circle(e-1,c-1,2,2).concat(["M",e,c,"L",a,f+b,a,f,a+l,f,a+l,f+b,a,f+b,"Z"])};F("circle");F("square");u===p&&q(["flag","circlepin","squarepin"],function(a){p.prototype.symbols[a]=d[a]})})(J,ea);(function(a){function E(a,c,d){this.init(a,c,d)}var F=a.addEvent,G=a.Axis,q=a.correctFloat,l=a.defaultOptions,f=a.defined,u=a.destroyObjectProperties,C=a.each,r=a.fireEvent,y=a.hasTouch,p=a.merge,d=a.pick,e=a.removeEvent,g,m={height:a.isTouchDevice?20:14,barBorderRadius:0,buttonBorderRadius:0,
liveRedraw:void 0,margin:10,minWidth:6,step:.2,zIndex:3,barBackgroundColor:"#cccccc",barBorderWidth:1,barBorderColor:"#cccccc",buttonArrowColor:"#333333",buttonBackgroundColor:"#e6e6e6",buttonBorderColor:"#cccccc",buttonBorderWidth:1,rifleColor:"#333333",trackBackgroundColor:"#f2f2f2",trackBorderColor:"#f2f2f2",trackBorderWidth:1};l.scrollbar=p(!0,m,l.scrollbar);a.swapXY=g=function(a,c){var b=a.length,d;if(c)for(c=0;c<b;c+=3)d=a[c+1],a[c+1]=a[c+2],a[c+2]=d;return a};E.prototype={init:function(a,c,
e){this.scrollbarButtons=[];this.renderer=a;this.userOptions=c;this.options=p(m,c);this.chart=e;this.size=d(this.options.size,this.options.height);c.enabled&&(this.render(),this.initEvents(),this.addEvents())},render:function(){var a=this.renderer,c=this.options,d=this.size,e;this.group=e=a.g("scrollbar").attr({zIndex:c.zIndex,translateY:-99999}).add();this.track=a.rect().addClass("highcharts-scrollbar-track").attr({x:0,r:c.trackBorderRadius||0,height:d,width:d}).add(e);this.track.attr({fill:c.trackBackgroundColor,
stroke:c.trackBorderColor,"stroke-width":c.trackBorderWidth});this.trackBorderWidth=this.track.strokeWidth();this.track.attr({y:-this.trackBorderWidth%2/2});this.scrollbarGroup=a.g().add(e);this.scrollbar=a.rect().addClass("highcharts-scrollbar-thumb").attr({height:d,width:d,r:c.barBorderRadius||0}).add(this.scrollbarGroup);this.scrollbarRifles=a.path(g(["M",-3,d/4,"L",-3,2*d/3,"M",0,d/4,"L",0,2*d/3,"M",3,d/4,"L",3,2*d/3],c.vertical)).addClass("highcharts-scrollbar-rifles").add(this.scrollbarGroup);
this.scrollbar.attr({fill:c.barBackgroundColor,stroke:c.barBorderColor,"stroke-width":c.barBorderWidth});this.scrollbarRifles.attr({stroke:c.rifleColor,"stroke-width":1});this.scrollbarStrokeWidth=this.scrollbar.strokeWidth();this.scrollbarGroup.translate(-this.scrollbarStrokeWidth%2/2,-this.scrollbarStrokeWidth%2/2);this.drawScrollbarButton(0);this.drawScrollbarButton(1)},position:function(a,c,d,e){var b=this.options.vertical,f=0,g=this.rendered?"animate":"attr";this.x=a;this.y=c+this.trackBorderWidth;
this.width=d;this.xOffset=this.height=e;this.yOffset=f;b?(this.width=this.yOffset=d=f=this.size,this.xOffset=c=0,this.barWidth=e-2*d,this.x=a+=this.options.margin):(this.height=this.xOffset=e=c=this.size,this.barWidth=d-2*e,this.y+=this.options.margin);this.group[g]({translateX:a,translateY:this.y});this.track[g]({width:d,height:e});this.scrollbarButtons[1][g]({translateX:b?0:d-c,translateY:b?e-f:0})},drawScrollbarButton:function(a){var b=this.renderer,d=this.scrollbarButtons,e=this.options,f=this.size,
n;n=b.g().add(this.group);d.push(n);n=b.rect().addClass("highcharts-scrollbar-button").add(n);n.attr({stroke:e.buttonBorderColor,"stroke-width":e.buttonBorderWidth,fill:e.buttonBackgroundColor});n.attr(n.crisp({x:-.5,y:-.5,width:f+1,height:f+1,r:e.buttonBorderRadius},n.strokeWidth()));n=b.path(g(["M",f/2+(a?-1:1),f/2-3,"L",f/2+(a?-1:1),f/2+3,"L",f/2+(a?2:-2),f/2],e.vertical)).addClass("highcharts-scrollbar-arrow").add(d[a]);n.attr({fill:e.buttonArrowColor})},setRange:function(a,c){var b=this.options,
d=b.vertical,e=b.minWidth,g=this.barWidth,l,m,p=!this.rendered||this.hasDragged||this.chart.navigator&&this.chart.navigator.hasDragged?"attr":"animate";f(g)&&(a=Math.max(a,0),l=Math.ceil(g*a),this.calculatedWidth=m=q(g*Math.min(c,1)-l),m<e&&(l=(g-e+m)*a,m=e),e=Math.floor(l+this.xOffset+this.yOffset),g=m/2-.5,this.from=a,this.to=c,d?(this.scrollbarGroup[p]({translateY:e}),this.scrollbar[p]({height:m}),this.scrollbarRifles[p]({translateY:g}),this.scrollbarTop=e,this.scrollbarLeft=0):(this.scrollbarGroup[p]({translateX:e}),
this.scrollbar[p]({width:m}),this.scrollbarRifles[p]({translateX:g}),this.scrollbarLeft=e,this.scrollbarTop=0),12>=m?this.scrollbarRifles.hide():this.scrollbarRifles.show(!0),!1===b.showFull&&(0>=a&&1<=c?this.group.hide():this.group.show()),this.rendered=!0)},initEvents:function(){var a=this;a.mouseMoveHandler=function(b){var c=a.chart.pointer.normalize(b),d=a.options.vertical?"chartY":"chartX",e=a.initPositions;!a.grabbedCenter||b.touches&&0===b.touches[0][d]||(c=a.cursorToScrollbarPosition(c)[d],
d=a[d],d=c-d,a.hasDragged=!0,a.updatePosition(e[0]+d,e[1]+d),a.hasDragged&&r(a,"changed",{from:a.from,to:a.to,trigger:"scrollbar",DOMType:b.type,DOMEvent:b}))};a.mouseUpHandler=function(b){a.hasDragged&&r(a,"changed",{from:a.from,to:a.to,trigger:"scrollbar",DOMType:b.type,DOMEvent:b});a.grabbedCenter=a.hasDragged=a.chartX=a.chartY=null};a.mouseDownHandler=function(b){b=a.chart.pointer.normalize(b);b=a.cursorToScrollbarPosition(b);a.chartX=b.chartX;a.chartY=b.chartY;a.initPositions=[a.from,a.to];a.grabbedCenter=
!0};a.buttonToMinClick=function(b){var c=q(a.to-a.from)*a.options.step;a.updatePosition(q(a.from-c),q(a.to-c));r(a,"changed",{from:a.from,to:a.to,trigger:"scrollbar",DOMEvent:b})};a.buttonToMaxClick=function(b){var c=(a.to-a.from)*a.options.step;a.updatePosition(a.from+c,a.to+c);r(a,"changed",{from:a.from,to:a.to,trigger:"scrollbar",DOMEvent:b})};a.trackClick=function(b){var c=a.chart.pointer.normalize(b),d=a.to-a.from,e=a.y+a.scrollbarTop,f=a.x+a.scrollbarLeft;a.options.vertical&&c.chartY>e||!a.options.vertical&&
c.chartX>f?a.updatePosition(a.from+d,a.to+d):a.updatePosition(a.from-d,a.to-d);r(a,"changed",{from:a.from,to:a.to,trigger:"scrollbar",DOMEvent:b})}},cursorToScrollbarPosition:function(a){var b=this.options,b=b.minWidth>this.calculatedWidth?b.minWidth:0;return{chartX:(a.chartX-this.x-this.xOffset)/(this.barWidth-b),chartY:(a.chartY-this.y-this.yOffset)/(this.barWidth-b)}},updatePosition:function(a,c){1<c&&(a=q(1-q(c-a)),c=1);0>a&&(c=q(c-a),a=0);this.from=a;this.to=c},update:function(a){this.destroy();
this.init(this.chart.renderer,p(!0,this.options,a),this.chart)},addEvents:function(){var a=this.options.inverted?[1,0]:[0,1],c=this.scrollbarButtons,d=this.scrollbarGroup.element,e=this.mouseDownHandler,f=this.mouseMoveHandler,g=this.mouseUpHandler,a=[[c[a[0]].element,"click",this.buttonToMinClick],[c[a[1]].element,"click",this.buttonToMaxClick],[this.track.element,"click",this.trackClick],[d,"mousedown",e],[d.ownerDocument,"mousemove",f],[d.ownerDocument,"mouseup",g]];y&&a.push([d,"touchstart",e],
[d.ownerDocument,"touchmove",f],[d.ownerDocument,"touchend",g]);C(a,function(a){F.apply(null,a)});this._events=a},removeEvents:function(){C(this._events,function(a){e.apply(null,a)});this._events.length=0},destroy:function(){var a=this.chart.scroller;this.removeEvents();C(["track","scrollbarRifles","scrollbar","scrollbarGroup","group"],function(a){this[a]&&this[a].destroy&&(this[a]=this[a].destroy())},this);a&&this===a.scrollbar&&(a.scrollbar=null,u(a.scrollbarButtons))}};F(G,"afterInit",function(){var a=
this;a.options.scrollbar&&a.options.scrollbar.enabled&&(a.options.scrollbar.vertical=!a.horiz,a.options.startOnTick=a.options.endOnTick=!1,a.scrollbar=new E(a.chart.renderer,a.options.scrollbar,a.chart),F(a.scrollbar,"changed",function(b){var c=Math.min(d(a.options.min,a.min),a.min,a.dataMin),e=Math.max(d(a.options.max,a.max),a.max,a.dataMax)-c,f;a.horiz&&!a.reversed||!a.horiz&&a.reversed?(f=c+e*this.to,c+=e*this.from):(f=c+e*(1-this.from),c+=e*(1-this.to));a.setExtremes(c,f,!0,!1,b)}))});F(G,"afterRender",
function(){var a=Math.min(d(this.options.min,this.min),this.min,d(this.dataMin,this.min)),c=Math.max(d(this.options.max,this.max),this.max,d(this.dataMax,this.max)),e=this.scrollbar,g=this.titleOffset||0;if(e){this.horiz?(e.position(this.left,this.top+this.height+2+this.chart.scrollbarsOffsets[1]+(this.opposite?0:g+this.axisTitleMargin+this.offset),this.width,this.height),g=1):(e.position(this.left+this.width+2+this.chart.scrollbarsOffsets[0]+(this.opposite?g+this.axisTitleMargin+this.offset:0),this.top,
this.width,this.height),g=0);if(!this.opposite&&!this.horiz||this.opposite&&this.horiz)this.chart.scrollbarsOffsets[g]+=this.scrollbar.size+this.scrollbar.options.margin;isNaN(a)||isNaN(c)||!f(this.min)||!f(this.max)?e.setRange(0,0):(g=(this.min-a)/(c-a),a=(this.max-a)/(c-a),this.horiz&&!this.reversed||!this.horiz&&this.reversed?e.setRange(g,a):e.setRange(1-a,1-g))}});F(G,"afterGetOffset",function(){var a=this.horiz?2:1,c=this.scrollbar;c&&(this.chart.scrollbarsOffsets=[0,0],this.chart.axisOffset[a]+=
c.size+c.options.margin)});a.Scrollbar=E})(J);(function(a){function E(a){this.init(a)}var F=a.addEvent,G=a.Axis,q=a.Chart,l=a.color,f=a.defaultOptions,u=a.defined,C=a.destroyObjectProperties,r=a.each,y=a.erase,p=a.error,d=a.extend,e=a.grep,g=a.hasTouch,m=a.isArray,b=a.isNumber,c=a.isObject,x=a.isTouchDevice,B=a.merge,t=a.pick,n=a.removeEvent,L=a.Scrollbar,z=a.Series,D=a.seriesTypes,h=a.wrap,I=[].concat(a.defaultDataGroupingUnits),H=function(a){var c=e(arguments,b);if(c.length)return Math[a].apply(0,
c)};I[4]=["day",[1,2,3,4]];I[5]=["week",[1,2,3]];D=void 0===D.areaspline?"line":"areaspline";d(f,{navigator:{height:40,margin:25,maskInside:!0,handles:{width:7,height:15,symbols:["navigator-handle","navigator-handle"],enabled:!0,lineWidth:1,backgroundColor:"#f2f2f2",borderColor:"#999999"},maskFill:l("#6685c2").setOpacity(.3).get(),outlineColor:"#cccccc",outlineWidth:1,series:{type:D,fillOpacity:.05,lineWidth:1,compare:null,dataGrouping:{approximation:"average",enabled:!0,groupPixelWidth:2,smoothed:!0,
units:I},dataLabels:{enabled:!1,zIndex:2},id:"highcharts-navigator-series",className:"highcharts-navigator-series",lineColor:null,marker:{enabled:!1},pointRange:0,threshold:null},xAxis:{overscroll:0,className:"highcharts-navigator-xaxis",tickLength:0,lineWidth:0,gridLineColor:"#e6e6e6",gridLineWidth:1,tickPixelInterval:200,labels:{align:"left",style:{color:"#999999"},x:3,y:-4},crosshair:!1},yAxis:{className:"highcharts-navigator-yaxis",gridLineWidth:0,startOnTick:!1,endOnTick:!1,minPadding:.1,maxPadding:.1,
labels:{enabled:!1},crosshair:!1,title:{text:null},tickLength:0,tickWidth:0}}});a.Renderer.prototype.symbols["navigator-handle"]=function(a,b,c,d,e){a=e.width/2;b=Math.round(a/3)+.5;e=e.height;return["M",-a-1,.5,"L",a,.5,"L",a,e+.5,"L",-a-1,e+.5,"L",-a-1,.5,"M",-b,4,"L",-b,e-3,"M",b-1,4,"L",b-1,e-3]};E.prototype={drawHandle:function(a,b,c,d){var e=this.navigatorOptions.handles.height;this.handles[b][d](c?{translateX:Math.round(this.left+this.height/2),translateY:Math.round(this.top+parseInt(a,10)+
.5-e)}:{translateX:Math.round(this.left+parseInt(a,10)),translateY:Math.round(this.top+this.height/2-e/2-1)})},drawOutline:function(a,b,c,d){var e=this.navigatorOptions.maskInside,k=this.outline.strokeWidth(),f=k/2,k=k%2/2,g=this.outlineHeight,h=this.scrollbarHeight,n=this.size,l=this.left-h,m=this.top;c?(l-=f,c=m+b+k,b=m+a+k,a=["M",l+g,m-h-k,"L",l+g,c,"L",l,c,"L",l,b,"L",l+g,b,"L",l+g,m+n+h].concat(e?["M",l+g,c-f,"L",l+g,b+f]:[])):(a+=l+h-k,b+=l+h-k,m+=f,a=["M",l,m,"L",a,m,"L",a,m+g,"L",b,m+g,"L",
b,m,"L",l+n+2*h,m].concat(e?["M",a-f,m,"L",b+f,m]:[]));this.outline[d]({d:a})},drawMasks:function(a,b,c,d){var e=this.left,k=this.top,f=this.height,g,h,n,l;c?(n=[e,e,e],l=[k,k+a,k+b],h=[f,f,f],g=[a,b-a,this.size-b]):(n=[e,e+a,e+b],l=[k,k,k],h=[a,b-a,this.size-b],g=[f,f,f]);r(this.shades,function(a,b){a[d]({x:n[b],y:l[b],width:h[b],height:g[b]})})},renderElements:function(){var a=this,b=a.navigatorOptions,c=b.maskInside,d=a.chart,e=d.inverted,f=d.renderer,g;a.navigatorGroup=g=f.g("navigator").attr({zIndex:8,
visibility:"hidden"}).add();var h={cursor:e?"ns-resize":"ew-resize"};r([!c,c,!c],function(c,d){a.shades[d]=f.rect().addClass("highcharts-navigator-mask"+(1===d?"-inside":"-outside")).attr({fill:c?b.maskFill:"rgba(0,0,0,0)"}).css(1===d&&h).add(g)});a.outline=f.path().addClass("highcharts-navigator-outline").attr({"stroke-width":b.outlineWidth,stroke:b.outlineColor}).add(g);b.handles.enabled&&r([0,1],function(c){b.handles.inverted=d.inverted;a.handles[c]=f.symbol(b.handles.symbols[c],-b.handles.width/
2-1,0,b.handles.width,b.handles.height,b.handles);a.handles[c].attr({zIndex:7-c}).addClass("highcharts-navigator-handle highcharts-navigator-handle-"+["left","right"][c]).add(g);var e=b.handles;a.handles[c].attr({fill:e.backgroundColor,stroke:e.borderColor,"stroke-width":e.lineWidth}).css(h)})},update:function(a){r(this.series||[],function(a){a.baseSeries&&delete a.baseSeries.navigatorSeries});this.destroy();B(!0,this.chart.options.navigator,this.options,a);this.init(this.chart)},render:function(c,
d,e,f){var k=this.chart,g,h,n=this.scrollbarHeight,l,m=this.xAxis;g=m.fake?k.xAxis[0]:m;var p=this.navigatorEnabled,v,w=this.rendered;h=k.inverted;var q,r=k.xAxis[0].minRange,z=k.xAxis[0].options.maxRange;if(!this.hasDragged||u(e)){if(!b(c)||!b(d))if(w)e=0,f=t(m.width,g.width);else return;this.left=t(m.left,k.plotLeft+n+(h?k.plotWidth:0));this.size=v=l=t(m.len,(h?k.plotHeight:k.plotWidth)-2*n);k=h?n:l+2*n;e=t(e,m.toPixels(c,!0));f=t(f,m.toPixels(d,!0));b(e)&&Infinity!==Math.abs(e)||(e=0,f=k);c=m.toValue(e,
!0);d=m.toValue(f,!0);q=Math.abs(a.correctFloat(d-c));q<r?this.grabbedLeft?e=m.toPixels(d-r,!0):this.grabbedRight&&(f=m.toPixels(c+r,!0)):u(z)&&q>z&&(this.grabbedLeft?e=m.toPixels(d-z,!0):this.grabbedRight&&(f=m.toPixels(c+z,!0)));this.zoomedMax=Math.min(Math.max(e,f,0),v);this.zoomedMin=Math.min(Math.max(this.fixedWidth?this.zoomedMax-this.fixedWidth:Math.min(e,f),0),v);this.range=this.zoomedMax-this.zoomedMin;v=Math.round(this.zoomedMax);e=Math.round(this.zoomedMin);p&&(this.navigatorGroup.attr({visibility:"visible"}),
w=w&&!this.hasDragged?"animate":"attr",this.drawMasks(e,v,h,w),this.drawOutline(e,v,h,w),this.navigatorOptions.handles.enabled&&(this.drawHandle(e,0,h,w),this.drawHandle(v,1,h,w)));this.scrollbar&&(h?(h=this.top-n,g=this.left-n+(p||!g.opposite?0:(g.titleOffset||0)+g.axisTitleMargin),n=l+2*n):(h=this.top+(p?this.height:-n),g=this.left-n),this.scrollbar.position(g,h,k,n),this.scrollbar.setRange(this.zoomedMin/(l||1),this.zoomedMax/(l||1)));this.rendered=!0}},addMouseEvents:function(){var a=this,b=a.chart,
c=b.container,d=[],e,f;a.mouseMoveHandler=e=function(b){a.onMouseMove(b)};a.mouseUpHandler=f=function(b){a.onMouseUp(b)};d=a.getPartsEvents("mousedown");d.push(F(c,"mousemove",e),F(c.ownerDocument,"mouseup",f));g&&(d.push(F(c,"touchmove",e),F(c.ownerDocument,"touchend",f)),d.concat(a.getPartsEvents("touchstart")));a.eventsToUnbind=d;a.series&&a.series[0]&&d.push(F(a.series[0].xAxis,"foundExtremes",function(){b.navigator.modifyNavigatorAxisExtremes()}))},getPartsEvents:function(a){var b=this,c=[];
r(["shades","handles"],function(d){r(b[d],function(e,k){c.push(F(e.element,a,function(a){b[d+"Mousedown"](a,k)}))})});return c},shadesMousedown:function(a,b){a=this.chart.pointer.normalize(a);var c=this.chart,d=this.xAxis,e=this.zoomedMin,f=this.left,g=this.size,h=this.range,n=a.chartX,l,m;c.inverted&&(n=a.chartY,f=this.top);1===b?(this.grabbedCenter=n,this.fixedWidth=h,this.dragOffset=n-e):(a=n-f-h/2,0===b?a=Math.max(0,a):2===b&&a+h>=g&&(a=g-h,this.reversedExtremes?(a-=h,m=this.getUnionExtremes().dataMin):
l=this.getUnionExtremes().dataMax),a!==e&&(this.fixedWidth=h,b=d.toFixedRange(a,a+h,m,l),u(b.min)&&c.xAxis[0].setExtremes(Math.min(b.min,b.max),Math.max(b.min,b.max),!0,null,{trigger:"navigator"})))},handlesMousedown:function(a,b){this.chart.pointer.normalize(a);a=this.chart;var c=a.xAxis[0],d=this.reversedExtremes;0===b?(this.grabbedLeft=!0,this.otherHandlePos=this.zoomedMax,this.fixedExtreme=d?c.min:c.max):(this.grabbedRight=!0,this.otherHandlePos=this.zoomedMin,this.fixedExtreme=d?c.max:c.min);
a.fixedRange=null},onMouseMove:function(b){var c=this,d=c.chart,e=c.left,f=c.navigatorSize,g=c.range,h=c.dragOffset,n=d.inverted;b.touches&&0===b.touches[0].pageX||(b=d.pointer.normalize(b),d=b.chartX,n&&(e=c.top,d=b.chartY),c.grabbedLeft?(c.hasDragged=!0,c.render(0,0,d-e,c.otherHandlePos)):c.grabbedRight?(c.hasDragged=!0,c.render(0,0,c.otherHandlePos,d-e)):c.grabbedCenter&&(c.hasDragged=!0,d<h?d=h:d>f+h-g&&(d=f+h-g),c.render(0,0,d-h,d-h+g)),c.hasDragged&&c.scrollbar&&t(c.scrollbar.options.liveRedraw,
a.svg&&!x&&!this.chart.isBoosting)&&(b.DOMType=b.type,setTimeout(function(){c.onMouseUp(b)},0)))},onMouseUp:function(a){var b=this.chart,c=this.xAxis,d=this.scrollbar,e,f,g=a.DOMEvent||a;(!this.hasDragged||d&&d.hasDragged)&&"scrollbar"!==a.trigger||(d=this.getUnionExtremes(),this.zoomedMin===this.otherHandlePos?e=this.fixedExtreme:this.zoomedMax===this.otherHandlePos&&(f=this.fixedExtreme),this.zoomedMax===this.size&&(f=this.reversedExtremes?d.dataMin:d.dataMax),0===this.zoomedMin&&(e=this.reversedExtremes?
d.dataMax:d.dataMin),c=c.toFixedRange(this.zoomedMin,this.zoomedMax,e,f),u(c.min)&&b.xAxis[0].setExtremes(Math.min(c.min,c.max),Math.max(c.min,c.max),!0,this.hasDragged?!1:null,{trigger:"navigator",triggerOp:"navigator-drag",DOMEvent:g}));"mousemove"!==a.DOMType&&(this.grabbedLeft=this.grabbedRight=this.grabbedCenter=this.fixedWidth=this.fixedExtreme=this.otherHandlePos=this.hasDragged=this.dragOffset=null)},removeEvents:function(){this.eventsToUnbind&&(r(this.eventsToUnbind,function(a){a()}),this.eventsToUnbind=
void 0);this.removeBaseSeriesEvents()},removeBaseSeriesEvents:function(){var a=this.baseSeries||[];this.navigatorEnabled&&a[0]&&(!1!==this.navigatorOptions.adaptToUpdatedData&&r(a,function(a){n(a,"updatedData",this.updatedDataHandler)},this),a[0].xAxis&&n(a[0].xAxis,"foundExtremes",this.modifyBaseAxisExtremes))},init:function(a){var b=a.options,c=b.navigator,d=c.enabled,e=b.scrollbar,f=e.enabled,b=d?c.height:0,g=f?e.height:0;this.handles=[];this.shades=[];this.chart=a;this.setBaseSeries();this.height=
b;this.scrollbarHeight=g;this.scrollbarEnabled=f;this.navigatorEnabled=d;this.navigatorOptions=c;this.scrollbarOptions=e;this.outlineHeight=b+g;this.opposite=t(c.opposite,!d&&a.inverted);var h=this,d=h.baseSeries,e=a.xAxis.length,f=a.yAxis.length,n=d&&d[0]&&d[0].xAxis||a.xAxis[0]||{options:{}};a.isDirtyBox=!0;h.navigatorEnabled?(h.xAxis=new G(a,B({breaks:n.options.breaks,ordinal:n.options.ordinal},c.xAxis,{id:"navigator-x-axis",yAxis:"navigator-y-axis",isX:!0,type:"datetime",index:e,isInternal:!0,
offset:0,keepOrdinalPadding:!0,startOnTick:!1,endOnTick:!1,minPadding:0,maxPadding:0,zoomEnabled:!1},a.inverted?{offsets:[g,0,-g,0],width:b}:{offsets:[0,-g,0,g],height:b})),h.yAxis=new G(a,B(c.yAxis,{id:"navigator-y-axis",alignTicks:!1,offset:0,index:f,isInternal:!0,zoomEnabled:!1},a.inverted?{width:b}:{height:b})),d||c.series.data?h.updateNavigatorSeries(!1):0===a.series.length&&(h.unbindRedraw=F(a,"beforeRedraw",function(){0<a.series.length&&!h.series&&(h.setBaseSeries(),h.unbindRedraw())})),h.reversedExtremes=
a.inverted&&!h.xAxis.reversed||!a.inverted&&h.xAxis.reversed,h.renderElements(),h.addMouseEvents()):h.xAxis={translate:function(b,c){var d=a.xAxis[0],e=d.getExtremes(),f=d.len-2*g,k=H("min",d.options.min,e.dataMin),d=H("max",d.options.max,e.dataMax)-k;return c?b*d/f+k:f*(b-k)/d},toPixels:function(a){return this.translate(a)},toValue:function(a){return this.translate(a,!0)},toFixedRange:G.prototype.toFixedRange,fake:!0};a.options.scrollbar.enabled&&(a.scrollbar=h.scrollbar=new L(a.renderer,B(a.options.scrollbar,
{margin:h.navigatorEnabled?0:10,vertical:a.inverted}),a),F(h.scrollbar,"changed",function(b){var c=h.size,d=c*this.to,c=c*this.from;h.hasDragged=h.scrollbar.hasDragged;h.render(0,0,c,d);(a.options.scrollbar.liveRedraw||"mousemove"!==b.DOMType&&"touchmove"!==b.DOMType)&&setTimeout(function(){h.onMouseUp(b)})}));h.addBaseSeriesEvents();h.addChartEvents()},getUnionExtremes:function(a){var b=this.chart.xAxis[0],c=this.xAxis,d=c.options,e=b.options,f;a&&null===b.dataMin||(f={dataMin:t(d&&d.min,H("min",
e.min,b.dataMin,c.dataMin,c.min)),dataMax:t(d&&d.max,H("max",e.max,b.dataMax,c.dataMax,c.max))});return f},setBaseSeries:function(a,b){var c=this.chart,d=this.baseSeries=[];a=a||c.options&&c.options.navigator.baseSeries||0;r(c.series||[],function(b,c){b.options.isInternal||!b.options.showInNavigator&&(c!==a&&b.options.id!==a||!1===b.options.showInNavigator)||d.push(b)});this.xAxis&&!this.xAxis.fake&&this.updateNavigatorSeries(!0,b)},updateNavigatorSeries:function(b,c){var e=this,g=e.chart,h=e.baseSeries,
l,p,v=e.navigatorOptions.series,t,q={enableMouseTracking:!1,index:null,linkedTo:null,group:"nav",padXAxis:!1,xAxis:"navigator-x-axis",yAxis:"navigator-y-axis",showInLegend:!1,stacking:!1,isInternal:!0},w=e.series=a.grep(e.series||[],function(b){var c=b.baseSeries;return 0>a.inArray(c,h)?(c&&(n(c,"updatedData",e.updatedDataHandler),delete c.navigatorSeries),b.chart&&b.destroy(),!1):!0});h&&h.length&&r(h,function(a){var b=a.navigatorSeries,k=d({color:a.color,visible:a.visible},m(v)?f.navigator.series:
v);b&&!1===e.navigatorOptions.adaptToUpdatedData||(q.name="Navigator "+h.length,l=a.options||{},t=l.navigatorOptions||{},p=B(l,q,k,t),k=t.data||k.data,e.hasNavigatorData=e.hasNavigatorData||!!k,p.data=k||l.data&&l.data.slice(0),b&&b.options?b.update(p,c):(a.navigatorSeries=g.initSeries(p),a.navigatorSeries.baseSeries=a,w.push(a.navigatorSeries)))});if(v.data&&(!h||!h.length)||m(v))e.hasNavigatorData=!1,v=a.splat(v),r(v,function(a,b){q.name="Navigator "+(w.length+1);p=B(f.navigator.series,{color:g.series[b]&&
!g.series[b].options.isInternal&&g.series[b].color||g.options.colors[b]||g.options.colors[0]},q,a);p.data=a.data;p.data&&(e.hasNavigatorData=!0,w.push(g.initSeries(p)))});b&&this.addBaseSeriesEvents()},addBaseSeriesEvents:function(){var a=this,b=a.baseSeries||[];b[0]&&b[0].xAxis&&F(b[0].xAxis,"foundExtremes",this.modifyBaseAxisExtremes);r(b,function(b){F(b,"show",function(){this.navigatorSeries&&this.navigatorSeries.setVisible(!0,!1)});F(b,"hide",function(){this.navigatorSeries&&this.navigatorSeries.setVisible(!1,
!1)});!1!==this.navigatorOptions.adaptToUpdatedData&&b.xAxis&&F(b,"updatedData",this.updatedDataHandler);F(b,"remove",function(){this.navigatorSeries&&(y(a.series,this.navigatorSeries),u(this.navigatorSeries.options)&&this.navigatorSeries.remove(!1),delete this.navigatorSeries)})},this)},modifyNavigatorAxisExtremes:function(){var a=this.xAxis,b;a.getExtremes&&(!(b=this.getUnionExtremes(!0))||b.dataMin===a.min&&b.dataMax===a.max||(a.min=b.dataMin,a.max=b.dataMax))},modifyBaseAxisExtremes:function(){var a=
this.chart.navigator,c=this.getExtremes(),d=c.dataMin,e=c.dataMax,c=c.max-c.min,f=a.stickToMin,g=a.stickToMax,h=t(this.options.overscroll,0),n,l,m=a.series&&a.series[0],p=!!this.setExtremes;this.eventArgs&&"rangeSelectorButton"===this.eventArgs.trigger||(f&&(l=d,n=l+c),g&&(n=e+h,f||(l=Math.max(n-c,m&&m.xData?m.xData[0]:-Number.MAX_VALUE))),p&&(f||g)&&b(l)&&(this.min=this.userMin=l,this.max=this.userMax=n));a.stickToMin=a.stickToMax=null},updatedDataHandler:function(){var a=this.chart.navigator,c=
this.navigatorSeries;a.stickToMax=a.reversedExtremes?0===Math.round(a.zoomedMin):Math.round(a.zoomedMax)>=Math.round(a.size);a.stickToMin=b(this.xAxis.min)&&this.xAxis.min<=this.xData[0]&&(!this.chart.fixedRange||!a.stickToMax);c&&!a.hasNavigatorData&&(c.options.pointStart=this.xData[0],c.setData(this.options.data,!1,null,!1))},addChartEvents:function(){this.eventsToUnbind||(this.eventsToUnbind=[]);this.eventsToUnbind.push(F(this.chart,"redraw",function(){var a=this.navigator,b=a&&(a.baseSeries&&
a.baseSeries[0]&&a.baseSeries[0].xAxis||a.scrollbar&&this.xAxis[0]);b&&a.render(b.min,b.max)}),F(this.chart,"getMargins",function(){var a=this.navigator,b=a.opposite?"plotTop":"marginBottom";this.inverted&&(b=a.opposite?"marginRight":"plotLeft");this[b]=(this[b]||0)+(a.navigatorEnabled||!this.inverted?a.outlineHeight:0)+a.navigatorOptions.margin}))},destroy:function(){this.removeEvents();this.xAxis&&(y(this.chart.xAxis,this.xAxis),y(this.chart.axes,this.xAxis));this.yAxis&&(y(this.chart.yAxis,this.yAxis),
y(this.chart.axes,this.yAxis));r(this.series||[],function(a){a.destroy&&a.destroy()});r("series xAxis yAxis shades outline scrollbarTrack scrollbarRifles scrollbarGroup scrollbar navigatorGroup rendered".split(" "),function(a){this[a]&&this[a].destroy&&this[a].destroy();this[a]=null},this);r([this.handles],function(a){C(a)},this)}};a.Navigator=E;h(G.prototype,"zoom",function(a,b,c){var d=this.chart,e=d.options,f=e.chart.zoomType,k=e.chart.pinchType,g=e.navigator,e=e.rangeSelector,h;this.isXAxis&&
(g&&g.enabled||e&&e.enabled)&&(!x&&"x"===f||x&&"x"===k?d.resetZoomButton="blocked":"y"===f?h=!1:(!x&&"xy"===f||x&&"xy"===k)&&this.options.range&&(d=this.previousZoom,u(b)?this.previousZoom=[this.min,this.max]:d&&(b=d[0],c=d[1],delete this.previousZoom)));return void 0!==h?h:a.call(this,b,c)});F(q,"beforeRender",function(){var a=this.options;if(a.navigator.enabled||a.scrollbar.enabled)this.scroller=this.navigator=new E(this)});F(q,"afterSetChartSize",function(){var a=this.legend,b=this.navigator,c,
d,e,f;b&&(d=a&&a.options,e=b.xAxis,f=b.yAxis,c=b.scrollbarHeight,this.inverted?(b.left=b.opposite?this.chartWidth-c-b.height:this.spacing[3]+c,b.top=this.plotTop+c):(b.left=this.plotLeft+c,b.top=b.navigatorOptions.top||this.chartHeight-b.height-c-this.spacing[2]-(this.rangeSelector&&this.extraBottomMargin?this.rangeSelector.getHeight():0)-(d&&"bottom"===d.verticalAlign&&d.enabled&&!d.floating?a.legendHeight+t(d.margin,10):0)),e&&f&&(this.inverted?e.options.left=f.options.left=b.left:e.options.top=
f.options.top=b.top,e.setAxisSize(),f.setAxisSize()))});F(q,"update",function(a){var b=a.options.navigator||{},c=a.options.scrollbar||{};this.navigator||this.scroller||!b.enabled&&!c.enabled||(B(!0,this.options.navigator,b),B(!0,this.options.scrollbar,c),delete a.options.navigator,delete a.options.scrollbar)});F(q,"afterUpdate",function(){this.navigator||this.scroller||!this.options.navigator.enabled&&!this.options.scrollbar.enabled||(this.scroller=this.navigator=new E(this))});h(z.prototype,"addPoint",
function(a,b,d,e,f){var k=this.options.turboThreshold;k&&this.xData.length>k&&c(b,!0)&&this.chart.navigator&&p(20,!0);a.call(this,b,d,e,f)});F(q,"afterAddSeries",function(){this.navigator&&this.navigator.setBaseSeries(null,!1)});F(z,"afterUpdate",function(){this.chart.navigator&&!this.options.isInternal&&this.chart.navigator.setBaseSeries(null,!1)});q.prototype.callbacks.push(function(a){var b=a.navigator;b&&a.xAxis[0]&&(a=a.xAxis[0].getExtremes(),b.render(a.min,a.max))})})(J);(function(a){function E(a){this.init(a)}
var F=a.addEvent,G=a.Axis,q=a.Chart,l=a.css,f=a.createElement,u=a.defaultOptions,C=a.defined,r=a.destroyObjectProperties,y=a.discardElement,p=a.each,d=a.extend,e=a.fireEvent,g=a.isNumber,m=a.merge,b=a.pick,c=a.pInt,x=a.splat,B=a.wrap;d(u,{rangeSelector:{verticalAlign:"top",buttonTheme:{"stroke-width":0,width:28,height:18,padding:2,zIndex:7},floating:!1,x:0,y:0,height:void 0,inputPosition:{align:"right",x:0,y:0},buttonPosition:{align:"left",x:0,y:0},labelStyle:{color:"#666666"}}});u.lang=m(u.lang,
{rangeSelectorZoom:"Zoom",rangeSelectorFrom:"From",rangeSelectorTo:"To"});E.prototype={clickButton:function(a,c){var d=this,e=d.chart,f=d.buttonOptions[a],h=e.xAxis[0],n=e.scroller&&e.scroller.getUnionExtremes()||h||{},l=n.dataMin,m=n.dataMax,t,k=h&&Math.round(Math.min(h.max,b(m,h.max))),q=f.type,r,n=f._range,u,y,B,C=f.dataGrouping;if(null!==l&&null!==m){e.fixedRange=n;C&&(this.forcedDataGrouping=!0,G.prototype.setDataGrouping.call(h||{chart:this.chart},C,!1),this.frozenStates=f.preserveDataGrouping);
if("month"===q||"year"===q)h?(q={range:f,max:k,chart:e,dataMin:l,dataMax:m},t=h.minFromRange.call(q),g(q.newMax)&&(k=q.newMax)):n=f;else if(n)t=Math.max(k-n,l),k=Math.min(t+n,m);else if("ytd"===q)if(h)void 0===m&&(l=Number.MAX_VALUE,m=Number.MIN_VALUE,p(e.series,function(a){a=a.xData;l=Math.min(a[0],l);m=Math.max(a[a.length-1],m)}),c=!1),k=d.getYTDExtremes(m,l,e.time.useUTC),t=u=k.min,k=k.max;else{F(e,"beforeRender",function(){d.clickButton(a)});return}else"all"===q&&h&&(t=l,k=m);t+=f._offsetMin;
k+=f._offsetMax;d.setSelected(a);h?h.setExtremes(t,k,b(c,1),null,{trigger:"rangeSelectorButton",rangeSelectorButton:f}):(r=x(e.options.xAxis)[0],B=r.range,r.range=n,y=r.min,r.min=u,F(e,"load",function(){r.range=B;r.min=y}))}},setSelected:function(a){this.selected=this.options.selected=a},defaultButtons:[{type:"month",count:1,text:"1m"},{type:"month",count:3,text:"3m"},{type:"month",count:6,text:"6m"},{type:"ytd",text:"YTD"},{type:"year",count:1,text:"1y"},{type:"all",text:"All"}],init:function(a){var b=
this,c=a.options.rangeSelector,d=c.buttons||[].concat(b.defaultButtons),f=c.selected,g=function(){var a=b.minInput,c=b.maxInput;a&&a.blur&&e(a,"blur");c&&c.blur&&e(c,"blur")};b.chart=a;b.options=c;b.buttons=[];a.extraTopMargin=c.height;b.buttonOptions=d;this.unMouseDown=F(a.container,"mousedown",g);this.unResize=F(a,"resize",g);p(d,b.computeButtonRange);void 0!==f&&d[f]&&this.clickButton(f,!1);F(a,"load",function(){a.xAxis&&a.xAxis[0]&&F(a.xAxis[0],"setExtremes",function(c){this.max-this.min!==a.fixedRange&&
"rangeSelectorButton"!==c.trigger&&"updatedData"!==c.trigger&&b.forcedDataGrouping&&!b.frozenStates&&this.setDataGrouping(!1,!1)})})},updateButtonStates:function(){var a=this,b=this.chart,c=b.xAxis[0],d=Math.round(c.max-c.min),e=!c.hasVisibleSeries,f=b.scroller&&b.scroller.getUnionExtremes()||c,l=f.dataMin,m=f.dataMax,b=a.getYTDExtremes(m,l,b.time.useUTC),q=b.min,r=b.max,k=a.selected,u=g(k),x=a.options.allButtonsEnabled,y=a.buttons;p(a.buttonOptions,function(b,f){var g=b._range,h=b.type,n=b.count||
1,p=y[f],t=0;b=b._offsetMax-b._offsetMin;f=f===k;var v=g>m-l,w=g<c.minRange,z=!1,A=!1,g=g===d;("month"===h||"year"===h)&&d+36E5>=864E5*{month:28,year:365}[h]*n-b&&d-36E5<=864E5*{month:31,year:366}[h]*n+b?g=!0:"ytd"===h?(g=r-q+b===d,z=!f):"all"===h&&(g=c.max-c.min>=m-l,A=!f&&u&&g);h=!x&&(v||w||A||e);n=f&&g||g&&!u&&!z||f&&a.frozenStates;h?t=3:n&&(u=!0,t=2);p.state!==t&&p.setState(t)})},computeButtonRange:function(a){var c=a.type,d=a.count||1,e={millisecond:1,second:1E3,minute:6E4,hour:36E5,day:864E5,
week:6048E5};if(e[c])a._range=e[c]*d;else if("month"===c||"year"===c)a._range=864E5*{month:30,year:365}[c]*d;a._offsetMin=b(a.offsetMin,0);a._offsetMax=b(a.offsetMax,0);a._range+=a._offsetMax-a._offsetMin},setInputValue:function(a,b){var c=this.chart.options.rangeSelector,d=this.chart.time,e=this[a+"Input"];C(b)&&(e.previousValue=e.HCTime,e.HCTime=b);e.value=d.dateFormat(c.inputEditDateFormat||"%Y-%m-%d",e.HCTime);this[a+"DateBox"].attr({text:d.dateFormat(c.inputDateFormat||"%b %e, %Y",e.HCTime)})},
showInput:function(a){var b=this.inputGroup,c=this[a+"DateBox"];l(this[a+"Input"],{left:b.translateX+c.x+"px",top:b.translateY+"px",width:c.width-2+"px",height:c.height-2+"px",border:"2px solid silver"})},hideInput:function(a){l(this[a+"Input"],{border:0,width:"1px",height:"1px"});this.setInputValue(a)},drawInput:function(a){function b(){var a=w.value,b=(t.inputDateParser||Date.parse)(a),d=p.xAxis[0],f=p.scroller&&p.scroller.xAxis?p.scroller.xAxis:d,k=f.dataMin,f=f.dataMax;b!==w.previousValue&&(w.previousValue=
b,g(b)||(b=a.split("-"),b=Date.UTC(c(b[0]),c(b[1])-1,c(b[2]))),g(b)&&(p.time.useUTC||(b+=6E4*(new Date).getTimezoneOffset()),v?b>e.maxInput.HCTime?b=void 0:b<k&&(b=k):b<e.minInput.HCTime?b=void 0:b>f&&(b=f),void 0!==b&&d.setExtremes(v?b:d.min,v?d.max:b,void 0,void 0,{trigger:"rangeSelectorInput"})))}var e=this,p=e.chart,q=p.renderer.style||{},h=p.renderer,t=p.options.rangeSelector,r=e.div,v="min"===a,w,k,A=this.inputGroup;this[a+"Label"]=k=h.label(u.lang[v?"rangeSelectorFrom":"rangeSelectorTo"],this.inputGroup.offset).addClass("highcharts-range-label").attr({padding:2}).add(A);
A.offset+=k.width+5;this[a+"DateBox"]=h=h.label("",A.offset).addClass("highcharts-range-input").attr({padding:2,width:t.inputBoxWidth||90,height:t.inputBoxHeight||17,"text-align":"center",stroke:t.inputBoxBorderColor||"#cccccc","stroke-width":1}).on("click",function(){e.showInput(a);e[a+"Input"].focus()}).add(A);A.offset+=h.width+(v?10:0);this[a+"Input"]=w=f("input",{name:a,className:"highcharts-range-selector",type:"text"},{top:p.plotTop+"px"},r);k.css(m(q,t.labelStyle));h.css(m({color:"#333333"},
q,t.inputStyle));l(w,d({position:"absolute",border:0,width:"1px",height:"1px",padding:0,textAlign:"center",fontSize:q.fontSize,fontFamily:q.fontFamily,top:"-9999em"},t.inputStyle));w.onfocus=function(){e.showInput(a)};w.onblur=function(){e.hideInput(a)};w.onchange=b;w.onkeypress=function(a){13===a.keyCode&&b()}},getPosition:function(){var a=this.chart,b=a.options.rangeSelector,a="top"===b.verticalAlign?a.plotTop-a.axisOffset[0]:0;return{buttonTop:a+b.buttonPosition.y,inputTop:a+b.inputPosition.y-
10}},getYTDExtremes:function(a,b,c){var d=this.chart.time,e=new d.Date(a),f=d.get("FullYear",e);c=c?d.Date.UTC(f,0,1):+new d.Date(f,0,1);b=Math.max(b||0,c);e=e.getTime();return{max:Math.min(a||e,e),min:b}},render:function(a,c){var d=this,e=d.chart,g=e.renderer,h=e.container,l=e.options,n=l.exporting&&!1!==l.exporting.enabled&&l.navigation&&l.navigation.buttonOptions,m=u.lang,q=d.div,k=l.rangeSelector,t=b(l.chart.style&&l.chart.style.zIndex,0)+1,l=k.floating,r=d.buttons,q=d.inputGroup,x=k.buttonTheme,
y=k.buttonPosition,B=k.inputPosition,C=k.inputEnabled,E=x&&x.states,F=e.plotLeft,G,J=d.buttonGroup,X;X=d.rendered;var Y=d.options.verticalAlign,aa=e.legend,ba=aa&&aa.options,ca=y.y,Z=B.y,da=X||!1,fa=da?"animate":"attr",V=0,U=0,P;if(!1!==k.enabled){X||(d.group=X=g.g("range-selector-group").attr({zIndex:7}).add(),d.buttonGroup=J=g.g("range-selector-buttons").add(X),d.zoomText=g.text(m.rangeSelectorZoom,0,15).css(k.labelStyle).add(J),p(d.buttonOptions,function(a,b){r[b]=g.button(a.text,0,0,function(){var c=
a.events&&a.events.click,e;c&&(e=c.call(a));!1!==e&&d.clickButton(b);d.isActive=!0},x,E&&E.hover,E&&E.select,E&&E.disabled).attr({"text-align":"center"}).add(J)}),!1!==C&&(d.div=q=f("div",null,{position:"relative",height:0,zIndex:t}),h.parentNode.insertBefore(q,h),d.inputGroup=q=g.g("input-group").add(X),q.offset=0,d.drawInput("min"),d.drawInput("max")));d.zoomText[fa]({x:b(F+y.x,F)});G=b(F+y.x,F)+d.zoomText.getBBox().width+5;p(d.buttonOptions,function(a,c){r[c][fa]({x:G});G+=r[c].width+b(k.buttonSpacing,
5)});F=e.plotLeft-e.spacing[3];d.updateButtonStates();n&&this.titleCollision(e)&&"top"===Y&&"right"===y.align&&y.y+J.getBBox().height-12<(n.y||0)+n.height&&(V=-40);"left"===y.align?P=y.x-e.spacing[3]:"right"===y.align&&(P=y.x+V-e.spacing[1]);J.align({y:y.y,width:J.getBBox().width,align:y.align,x:P},!0,e.spacingBox);d.group.placed=da;d.buttonGroup.placed=da;!1!==C&&(V=n&&this.titleCollision(e)&&"top"===Y&&"right"===B.align&&B.y-q.getBBox().height-12<(n.y||0)+n.height+e.spacing[0]?-40:0,"left"===B.align?
P=F:"right"===B.align&&(P=-Math.max(e.axisOffset[1],-V)),q.align({y:B.y,width:q.getBBox().width,align:B.align,x:B.x+P-2},!0,e.spacingBox),h=q.alignAttr.translateX+q.alignOptions.x-V+q.getBBox().x+2,n=q.alignOptions.width,m=J.alignAttr.translateX+J.getBBox().x,P=J.getBBox().width+20,(B.align===y.align||m+P>h&&h+n>m&&ca<Z+q.getBBox().height)&&q.attr({translateX:q.alignAttr.translateX+(e.axisOffset[1]>=-V?0:-V),translateY:q.alignAttr.translateY+J.getBBox().height+10}),d.setInputValue("min",a),d.setInputValue("max",
c),d.inputGroup.placed=da);d.group.align({verticalAlign:Y},!0,e.spacingBox);a=d.group.getBBox().height+20;c=d.group.alignAttr.translateY;"bottom"===Y&&(aa=ba&&"bottom"===ba.verticalAlign&&ba.enabled&&!ba.floating?aa.legendHeight+b(ba.margin,10):0,a=a+aa-20,U=c-a-(l?0:k.y)-10);if("top"===Y)l&&(U=0),e.titleOffset&&(U=e.titleOffset+e.options.title.margin),U+=e.margin[0]-e.spacing[0]||0;else if("middle"===Y)if(Z===ca)U=0>Z?c+void 0:c;else if(Z||ca)U=0>Z||0>ca?U-Math.min(Z,ca):c-a+NaN;d.group.translate(k.x,
k.y+Math.floor(U));!1!==C&&(d.minInput.style.marginTop=d.group.translateY+"px",d.maxInput.style.marginTop=d.group.translateY+"px");d.rendered=!0}},getHeight:function(){var a=this.options,b=this.group,c=a.y,d=a.buttonPosition.y,a=a.inputPosition.y,b=b?b.getBBox(!0).height+13+c:0,c=Math.min(a,d);if(0>a&&0>d||0<a&&0<d)b+=Math.abs(c);return b},titleCollision:function(a){return!(a.options.title.text||a.options.subtitle.text)},update:function(a){var b=this.chart;m(!0,b.options.rangeSelector,a);this.destroy();
this.init(b);b.rangeSelector.render()},destroy:function(){var b=this,c=b.minInput,d=b.maxInput;b.unMouseDown();b.unResize();r(b.buttons);c&&(c.onfocus=c.onblur=c.onchange=null);d&&(d.onfocus=d.onblur=d.onchange=null);a.objectEach(b,function(a,c){a&&"chart"!==c&&(a.destroy?a.destroy():a.nodeType&&y(this[c]));a!==E.prototype[c]&&(b[c]=null)},this)}};G.prototype.toFixedRange=function(a,c,d,e){var f=this.chart&&this.chart.fixedRange;a=b(d,this.translate(a,!0,!this.horiz));c=b(e,this.translate(c,!0,!this.horiz));
d=f&&(c-a)/f;.7<d&&1.3>d&&(e?a=c-f:c=a+f);g(a)&&g(c)||(a=c=void 0);return{min:a,max:c}};G.prototype.minFromRange=function(){var a=this.range,c={month:"Month",year:"FullYear"}[a.type],d,e=this.max,f,h,l=function(a,b){var d=new Date(a),e=d["get"+c]();d["set"+c](e+b);e===d["get"+c]()&&d.setDate(0);return d.getTime()-a};g(a)?(d=e-a,h=a):(d=e+l(e,-a.count),this.chart&&(this.chart.fixedRange=e-d));f=b(this.dataMin,Number.MIN_VALUE);g(d)||(d=f);d<=f&&(d=f,void 0===h&&(h=l(d,a.count)),this.newMax=Math.min(d+
h,this.dataMax));g(e)||(d=void 0);return d};F(q,"afterGetContainer",function(){this.options.rangeSelector.enabled&&(this.rangeSelector=new E(this))});B(q.prototype,"render",function(a,b,c){var d=this.axes,e=this.rangeSelector;e&&(p(d,function(a){a.updateNames();a.setScale()}),this.getAxisMargins(),e.render(),d=e.options.verticalAlign,e.options.floating||("bottom"===d?this.extraBottomMargin=!0:"middle"!==d&&(this.extraTopMargin=!0)));a.call(this,b,c)});F(q,"update",function(a){var b=a.options.rangeSelector;
a=this.rangeSelector;var c=this.extraBottomMargin,d=this.extraTopMargin;b&&b.enabled&&!C(a)&&(this.options.rangeSelector.enabled=!0,this.rangeSelector=new E(this));this.extraTopMargin=this.extraBottomMargin=!1;a&&(a.render(),b=b&&b.verticalAlign||a.options&&a.options.verticalAlign,a.options.floating||("bottom"===b?this.extraBottomMargin=!0:"middle"!==b&&(this.extraTopMargin=!0)),this.extraBottomMargin!==c||this.extraTopMargin!==d)&&(this.isDirtyBox=!0)});B(q.prototype,"redraw",function(a,b,c){var d=
this.rangeSelector;d&&!d.options.floating&&(d.render(),d=d.options.verticalAlign,"bottom"===d?this.extraBottomMargin=!0:"middle"!==d&&(this.extraTopMargin=!0));a.call(this,b,c)});F(q,"getMargins",function(){var a=this.rangeSelector;a&&(a=a.getHeight(),this.extraTopMargin&&(this.plotTop+=a),this.extraBottomMargin&&(this.marginBottom+=a))});q.prototype.callbacks.push(function(a){function b(){c=a.xAxis[0].getExtremes();g(c.min)&&d.render(c.min,c.max)}var c,d=a.rangeSelector,e,f;d&&(f=F(a.xAxis[0],"afterSetExtremes",
function(a){d.render(a.min,a.max)}),e=F(a,"redraw",b),b());F(a,"destroy",function(){d&&(e(),f())})});a.RangeSelector=E})(J);(function(a){var E=a.addEvent,F=a.arrayMax,G=a.arrayMin,q=a.Axis,l=a.Chart,f=a.defined,u=a.each,C=a.extend,r=a.format,y=a.grep,p=a.inArray,d=a.isNumber,e=a.isString,g=a.map,m=a.merge,b=a.pick,c=a.Point,x=a.Renderer,B=a.Series,t=a.splat,n=a.SVGRenderer,J=a.VMLRenderer,z=a.wrap,D=B.prototype,h=D.init,I=D.processData,H=c.prototype.tooltipFormatter;a.StockChart=a.stockChart=function(c,
d,f){var k=e(c)||c.nodeName,h=arguments[k?1:0],n=h.series,p=a.getOptions(),q,r=b(h.navigator&&h.navigator.enabled,p.navigator.enabled,!0),v=r?{startOnTick:!1,endOnTick:!1}:null,u={marker:{enabled:!1,radius:2}},w={shadow:!1,borderWidth:0};h.xAxis=g(t(h.xAxis||{}),function(a,b){return m({minPadding:0,maxPadding:0,overscroll:0,ordinal:!0,title:{text:null},labels:{overflow:"justify"},showLastLabel:!0},p.xAxis,p.xAxis&&p.xAxis[b],a,{type:"datetime",categories:null},v)});h.yAxis=g(t(h.yAxis||{}),function(a,
c){q=b(a.opposite,!0);return m({labels:{y:-2},opposite:q,showLastLabel:!(!a.categories&&"category"!==a.type),title:{text:null}},p.yAxis,p.yAxis&&p.yAxis[c],a)});h.series=null;h=m({chart:{panning:!0,pinchType:"x"},navigator:{enabled:r},scrollbar:{enabled:b(p.scrollbar.enabled,!0)},rangeSelector:{enabled:b(p.rangeSelector.enabled,!0)},title:{text:null},tooltip:{split:b(p.tooltip.split,!0),crosshairs:!0},legend:{enabled:!1},plotOptions:{line:u,spline:u,area:u,areaspline:u,arearange:u,areasplinerange:u,
column:w,columnrange:w,candlestick:w,ohlc:w}},h,{isStock:!0});h.series=n;return k?new l(c,h,f):new l(h,d)};z(q.prototype,"autoLabelAlign",function(a){var b=this.chart,c=this.options,b=b._labelPanes=b._labelPanes||{},d=this.options.labels;return this.chart.options.isStock&&"yAxis"===this.coll&&(c=c.top+","+c.height,!b[c]&&d.enabled)?(15===d.x&&(d.x=0),void 0===d.align&&(d.align="right"),b[c]=this,"right"):a.apply(this,[].slice.call(arguments,1))});E(q,"destroy",function(){var a=this.chart,b=this.options&&
this.options.top+","+this.options.height;b&&a._labelPanes&&a._labelPanes[b]===this&&delete a._labelPanes[b]});z(q.prototype,"getPlotLinePath",function(c,h,k,l,m,n){var q=this,r=this.isLinked&&!this.series?this.linkedParent.series:this.series,v=q.chart,t=v.renderer,w=q.left,x=q.top,y,A,z,B,C=[],D=[],E,F;if("xAxis"!==q.coll&&"yAxis"!==q.coll)return c.apply(this,[].slice.call(arguments,1));D=function(a){var b="xAxis"===a?"yAxis":"xAxis";a=q.options[b];return d(a)?[v[b][a]]:e(a)?[v.get(a)]:g(r,function(a){return a[b]})}(q.coll);
u(q.isXAxis?v.yAxis:v.xAxis,function(a){if(f(a.options.id)?-1===a.options.id.indexOf("navigator"):1){var b=a.isXAxis?"yAxis":"xAxis",b=f(a.options[b])?v[b][a.options[b]]:v[b][0];q===b&&D.push(a)}});E=D.length?[]:[q.isXAxis?v.yAxis[0]:v.xAxis[0]];u(D,function(b){-1!==p(b,E)||a.find(E,function(a){return a.pos===b.pos&&a.len===b.len})||E.push(b)});F=b(n,q.translate(h,null,null,l));d(F)&&(q.horiz?u(E,function(a){var b;A=a.pos;B=A+a.len;y=z=Math.round(F+q.transB);if(y<w||y>w+q.width)m?y=z=Math.min(Math.max(w,
y),w+q.width):b=!0;b||C.push("M",y,A,"L",z,B)}):u(E,function(a){var b;y=a.pos;z=y+a.len;A=B=Math.round(x+q.height-F);if(A<x||A>x+q.height)m?A=B=Math.min(Math.max(x,A),q.top+q.height):b=!0;b||C.push("M",y,A,"L",z,B)}));return 0<C.length?t.crispPolyLine(C,k||1):null});n.prototype.crispPolyLine=function(a,b){var c;for(c=0;c<a.length;c+=6)a[c+1]===a[c+4]&&(a[c+1]=a[c+4]=Math.round(a[c+1])-b%2/2),a[c+2]===a[c+5]&&(a[c+2]=a[c+5]=Math.round(a[c+2])+b%2/2);return a};x===J&&(J.prototype.crispPolyLine=n.prototype.crispPolyLine);
z(q.prototype,"hideCrosshair",function(a,b){a.call(this,b);this.crossLabel&&(this.crossLabel=this.crossLabel.hide())});E(q,"afterDrawCrosshair",function(a){var c,d;if(f(this.crosshair.label)&&this.crosshair.label.enabled&&this.cross){var e=this.chart,g=this.options.crosshair.label,h=this.horiz;c=this.opposite;d=this.left;var l=this.top,m=this.crossLabel,n=g.format,p="",q="inside"===this.options.tickPosition,v=!1!==this.crosshair.snap,t=0,u=a.e||this.cross&&this.cross.e,x=a.point;a=this.lin2log;var y,
z;this.isLog?(y=a(this.min),z=a(this.max)):(y=this.min,z=this.max);a=h?"center":c?"right"===this.labelAlign?"right":"left":"left"===this.labelAlign?"left":"center";m||(m=this.crossLabel=e.renderer.label(null,null,null,g.shape||"callout").addClass("highcharts-crosshair-label"+(this.series[0]&&" highcharts-color-"+this.series[0].colorIndex)).attr({align:g.align||a,padding:b(g.padding,8),r:b(g.borderRadius,3),zIndex:2}).add(this.labelGroup),m.attr({fill:g.backgroundColor||this.series[0]&&this.series[0].color||
"#666666",stroke:g.borderColor||"","stroke-width":g.borderWidth||0}).css(C({color:"#ffffff",fontWeight:"normal",fontSize:"11px",textAlign:"center"},g.style)));h?(a=v?x.plotX+d:u.chartX,l+=c?0:this.height):(a=c?this.width+d:0,l=v?x.plotY+l:u.chartY);n||g.formatter||(this.isDatetimeAxis&&(p="%b %d, %Y"),n="{value"+(p?":"+p:"")+"}");p=v?x[this.isXAxis?"x":"y"]:this.toValue(h?u.chartX:u.chartY);m.attr({text:n?r(n,{value:p},e.time):g.formatter.call(this,p),x:a,y:l,visibility:p<y||p>z?"hidden":"visible"});
g=m.getBBox();if(h){if(q&&!c||!q&&c)l=m.y-g.height}else l=m.y-g.height/2;h?(c=d-g.x,d=d+this.width-g.x):(c="left"===this.labelAlign?d:0,d="right"===this.labelAlign?d+this.width:e.chartWidth);m.translateX<c&&(t=c-m.translateX);m.translateX+g.width>=d&&(t=-(m.translateX+g.width-d));m.attr({x:a+t,y:l,anchorX:h?a:this.opposite?0:e.chartWidth,anchorY:h?this.opposite?e.chartHeight:0:l+g.height/2})}});D.init=function(){h.apply(this,arguments);this.setCompare(this.options.compare)};D.setCompare=function(a){this.modifyValue=
"value"===a||"percent"===a?function(b,c){var d=this.compareValue;if(void 0!==b&&void 0!==d)return b="value"===a?b-d:b/d*100-(100===this.options.compareBase?0:100),c&&(c.change=b),b}:null;this.userOptions.compare=a;this.chart.hasRendered&&(this.isDirty=!0)};D.processData=function(){var a,b=-1,c,e,f=!0===this.options.compareStart?0:1,g,h;I.apply(this,arguments);if(this.xAxis&&this.processedYData)for(c=this.processedXData,e=this.processedYData,g=e.length,this.pointArrayMap&&(b=p("close",this.pointArrayMap),
-1===b&&(b=p(this.pointValKey||"y",this.pointArrayMap))),a=0;a<g-f;a++)if(h=e[a]&&-1<b?e[a][b]:e[a],d(h)&&c[a+f]>=this.xAxis.min&&0!==h){this.compareValue=h;break}};z(D,"getExtremes",function(a){var b;a.apply(this,[].slice.call(arguments,1));this.modifyValue&&(b=[this.modifyValue(this.dataMin),this.modifyValue(this.dataMax)],this.dataMin=G(b),this.dataMax=F(b))});q.prototype.setCompare=function(a,c){this.isXAxis||(u(this.series,function(b){b.setCompare(a)}),b(c,!0)&&this.chart.redraw())};c.prototype.tooltipFormatter=
function(c){c=c.replace("{point.change}",(0<this.change?"+":"")+a.numberFormat(this.change,b(this.series.tooltipOptions.changeDecimals,2)));return H.apply(this,[c])};z(B.prototype,"render",function(a){var b;this.chart.is3d&&this.chart.is3d()||this.chart.polar||!this.xAxis||this.xAxis.isRadial||(b=this.yAxis.len-(this.xAxis.axisLine?Math.floor(this.xAxis.axisLine.strokeWidth()/2):0),!this.clipBox&&this.animate?(this.clipBox=m(this.chart.clipBox),this.clipBox.width=this.xAxis.len,this.clipBox.height=
b):this.chart[this.sharedClipKey]?this.chart[this.sharedClipKey].attr({width:this.xAxis.len,height:b}):this.clipBox&&(this.clipBox.width=this.xAxis.len,this.clipBox.height=b));a.call(this)});z(l.prototype,"getSelectedPoints",function(a){var b=a.call(this);u(this.series,function(a){a.hasGroupedData&&(b=b.concat(y(a.points||[],function(a){return a.selected})))});return b});E(l,"update",function(a){a=a.options;"scrollbar"in a&&this.navigator&&(m(!0,this.options.scrollbar,a.scrollbar),this.navigator.update({},
!1),delete a.scrollbar)})})(J);return J});
//# sourceMappingURL=highstock.js.map
;
/*
 Highcharts JS v6.1.4 (2018-09-25)
 Exporting module

 (c) 2010-2017 Torstein Honsi

 License: www.highcharts.com/license
*/

(function(g){"object"===typeof module&&module.exports?module.exports=g:"function"===typeof define&&define.amd?define(function(){return g}):g(Highcharts)})(function(g){(function(f){var g=f.defaultOptions,y=f.doc,z=f.Chart,q=f.addEvent,H=f.removeEvent,B=f.fireEvent,r=f.createElement,C=f.discardElement,u=f.css,p=f.merge,A=f.pick,l=f.each,E=f.objectEach,t=f.extend,I=f.isTouchDevice,D=f.win,F=D.navigator.userAgent,J=f.Renderer.prototype.symbols;/Edge\/|Trident\/|MSIE /.test(F);/firefox/i.test(F);t(g.lang,
{printChart:"Print chart",downloadPNG:"Download PNG image",downloadJPEG:"Download JPEG image",downloadPDF:"Download PDF document",downloadSVG:"Download SVG vector image",contextButtonTitle:"Chart context menu"});g.navigation={buttonOptions:{theme:{},symbolSize:14,symbolX:12.5,symbolY:10.5,align:"right",buttonSpacing:3,height:22,verticalAlign:"top",width:24}};p(!0,g.navigation,{menuStyle:{border:"1px solid #999999",background:"#ffffff",padding:"5px 0"},menuItemStyle:{padding:"0.5em 1em",background:"none",
color:"#333333",fontSize:I?"14px":"11px",transition:"background 250ms, color 250ms"},menuItemHoverStyle:{background:"#335cad",color:"#ffffff"},buttonOptions:{symbolFill:"#666666",symbolStroke:"#666666",symbolStrokeWidth:3,theme:{fill:"#ffffff",stroke:"none",padding:5}}});g.exporting={type:"image/png",url:"https://export.highcharts.com/",printMaxWidth:780,scale:2,buttons:{contextButton:{className:"highcharts-contextbutton",menuClassName:"highcharts-contextmenu",symbol:"menu",titleKey:"contextButtonTitle",
menuItems:"printChart separator downloadPNG downloadJPEG downloadPDF downloadSVG".split(" ")}},menuItemDefinitions:{printChart:{textKey:"printChart",onclick:function(){this.print()}},separator:{separator:!0},downloadPNG:{textKey:"downloadPNG",onclick:function(){this.exportChart()}},downloadJPEG:{textKey:"downloadJPEG",onclick:function(){this.exportChart({type:"image/jpeg"})}},downloadPDF:{textKey:"downloadPDF",onclick:function(){this.exportChart({type:"application/pdf"})}},downloadSVG:{textKey:"downloadSVG",
onclick:function(){this.exportChart({type:"image/svg+xml"})}}}};f.post=function(a,b,e){var c=r("form",p({method:"post",action:a,enctype:"multipart/form-data"},e),{display:"none"},y.body);E(b,function(a,b){r("input",{type:"hidden",name:b,value:a},null,c)});c.submit();C(c)};t(z.prototype,{sanitizeSVG:function(a,b){if(b&&b.exporting&&b.exporting.allowHTML){var e=a.match(/<\/svg>(.*?$)/);e&&e[1]&&(e='\x3cforeignObject x\x3d"0" y\x3d"0" width\x3d"'+b.chart.width+'" height\x3d"'+b.chart.height+'"\x3e\x3cbody xmlns\x3d"http://www.w3.org/1999/xhtml"\x3e'+
e[1]+"\x3c/body\x3e\x3c/foreignObject\x3e",a=a.replace("\x3c/svg\x3e",e+"\x3c/svg\x3e"))}a=a.replace(/zIndex="[^"]+"/g,"").replace(/symbolName="[^"]+"/g,"").replace(/jQuery[0-9]+="[^"]+"/g,"").replace(/url\(("|&quot;)(\S+)("|&quot;)\)/g,"url($2)").replace(/url\([^#]+#/g,"url(#").replace(/<svg /,'\x3csvg xmlns:xlink\x3d"http://www.w3.org/1999/xlink" ').replace(/ (|NS[0-9]+\:)href=/g," xlink:href\x3d").replace(/\n/," ").replace(/<\/svg>.*?$/,"\x3c/svg\x3e").replace(/(fill|stroke)="rgba\(([ 0-9]+,[ 0-9]+,[ 0-9]+),([ 0-9\.]+)\)"/g,
'$1\x3d"rgb($2)" $1-opacity\x3d"$3"').replace(/&nbsp;/g,"\u00a0").replace(/&shy;/g,"\u00ad");this.ieSanitizeSVG&&(a=this.ieSanitizeSVG(a));return a},getChartHTML:function(){return this.container.innerHTML},getSVG:function(a){var b,e,c,v,m,h=p(this.options,a);e=r("div",null,{position:"absolute",top:"-9999em",width:this.chartWidth+"px",height:this.chartHeight+"px"},y.body);c=this.renderTo.style.width;m=this.renderTo.style.height;c=h.exporting.sourceWidth||h.chart.width||/px$/.test(c)&&parseInt(c,10)||
600;m=h.exporting.sourceHeight||h.chart.height||/px$/.test(m)&&parseInt(m,10)||400;t(h.chart,{animation:!1,renderTo:e,forExport:!0,renderer:"SVGRenderer",width:c,height:m});h.exporting.enabled=!1;delete h.data;h.series=[];l(this.series,function(a){v=p(a.userOptions,{animation:!1,enableMouseTracking:!1,showCheckbox:!1,visible:a.visible});v.isInternal||h.series.push(v)});l(this.axes,function(a){a.userOptions.internalKey||(a.userOptions.internalKey=f.uniqueKey())});b=new f.Chart(h,this.callback);a&&
l(["xAxis","yAxis","series"],function(c){var d={};a[c]&&(d[c]=a[c],b.update(d))});l(this.axes,function(a){var c=f.find(b.axes,function(b){return b.options.internalKey===a.userOptions.internalKey}),d=a.getExtremes(),e=d.userMin,d=d.userMax;c&&(void 0!==e&&e!==c.min||void 0!==d&&d!==c.max)&&c.setExtremes(e,d,!0,!1)});c=b.getChartHTML();B(this,"getSVG",{chartCopy:b});c=this.sanitizeSVG(c,h);h=null;b.destroy();C(e);return c},getSVGForExport:function(a,b){var e=this.options.exporting;return this.getSVG(p({chart:{borderRadius:0}},
e.chartOptions,b,{exporting:{sourceWidth:a&&a.sourceWidth||e.sourceWidth,sourceHeight:a&&a.sourceHeight||e.sourceHeight}}))},exportChart:function(a,b){b=this.getSVGForExport(a,b);a=p(this.options.exporting,a);f.post(a.url,{filename:a.filename||"chart",type:a.type,width:a.width||0,scale:a.scale,svg:b},a.formAttributes)},print:function(){var a=this,b=a.container,e=[],c=b.parentNode,f=y.body,m=f.childNodes,h=a.options.exporting.printMaxWidth,d,n;if(!a.isPrinting){a.isPrinting=!0;a.pointer.reset(null,
0);B(a,"beforePrint");if(n=h&&a.chartWidth>h)d=[a.options.chart.width,void 0,!1],a.setSize(h,void 0,!1);l(m,function(a,b){1===a.nodeType&&(e[b]=a.style.display,a.style.display="none")});f.appendChild(b);setTimeout(function(){D.focus();D.print();setTimeout(function(){c.appendChild(b);l(m,function(a,b){1===a.nodeType&&(a.style.display=e[b])});a.isPrinting=!1;n&&a.setSize.apply(a,d);B(a,"afterPrint")},1E3)},1)}},contextMenu:function(a,b,e,c,v,m,h){var d=this,n=d.options.navigation,g=d.chartWidth,G=d.chartHeight,
p="cache-"+a,k=d[p],w=Math.max(v,m),x;k||(d.exportContextMenu=d[p]=k=r("div",{className:a},{position:"absolute",zIndex:1E3,padding:w+"px",pointerEvents:"auto"},d.fixedDiv||d.container),x=r("div",{className:"highcharts-menu"},null,k),u(x,t({MozBoxShadow:"3px 3px 10px #888",WebkitBoxShadow:"3px 3px 10px #888",boxShadow:"3px 3px 10px #888"},n.menuStyle)),k.hideMenu=function(){u(k,{display:"none"});h&&h.setState(0);d.openMenu=!1;f.clearTimeout(k.hideTimer)},d.exportEvents.push(q(k,"mouseleave",function(){k.hideTimer=
setTimeout(k.hideMenu,500)}),q(k,"mouseenter",function(){f.clearTimeout(k.hideTimer)}),q(y,"mouseup",function(b){d.pointer.inClass(b.target,a)||k.hideMenu()}),q(k,"click",function(){d.openMenu&&k.hideMenu()})),l(b,function(a){"string"===typeof a&&(a=d.options.exporting.menuItemDefinitions[a]);if(f.isObject(a,!0)){var b;a.separator?b=r("hr",null,null,x):(b=r("div",{className:"highcharts-menu-item",onclick:function(b){b&&b.stopPropagation();k.hideMenu();a.onclick&&a.onclick.apply(d,arguments)},innerHTML:a.text||
d.options.lang[a.textKey]},null,x),b.onmouseover=function(){u(this,n.menuItemHoverStyle)},b.onmouseout=function(){u(this,n.menuItemStyle)},u(b,t({cursor:"pointer"},n.menuItemStyle)));d.exportDivElements.push(b)}}),d.exportDivElements.push(x,k),d.exportMenuWidth=k.offsetWidth,d.exportMenuHeight=k.offsetHeight);b={display:"block"};e+d.exportMenuWidth>g?b.right=g-e-v-w+"px":b.left=e-w+"px";c+m+d.exportMenuHeight>G&&"top"!==h.alignOptions.verticalAlign?b.bottom=G-c-w+"px":b.top=c+m-w+"px";u(k,b);d.openMenu=
!0},addButton:function(a){var b=this,e=b.renderer,c=p(b.options.navigation.buttonOptions,a),f=c.onclick,m=c.menuItems,h,d,n=c.symbolSize||12;b.btnCount||(b.btnCount=0);b.exportDivElements||(b.exportDivElements=[],b.exportSVGElements=[]);if(!1!==c.enabled){var g=c.theme,l=g.states,q=l&&l.hover,l=l&&l.select,k;delete g.states;f?k=function(a){a&&a.stopPropagation();f.call(b,a)}:m&&(k=function(a){a&&a.stopPropagation();b.contextMenu(d.menuClassName,m,d.translateX,d.translateY,d.width,d.height,d);d.setState(2)});
c.text&&c.symbol?g.paddingLeft=A(g.paddingLeft,25):c.text||t(g,{width:c.width,height:c.height,padding:0});d=e.button(c.text,0,0,k,g,q,l).addClass(a.className).attr({"stroke-linecap":"round",title:A(b.options.lang[c._titleKey||c.titleKey],"")});d.menuClassName=a.menuClassName||"highcharts-menu-"+b.btnCount++;c.symbol&&(h=e.symbol(c.symbol,c.symbolX-n/2,c.symbolY-n/2,n,n,{width:n,height:n}).addClass("highcharts-button-symbol").attr({zIndex:1}).add(d),h.attr({stroke:c.symbolStroke,fill:c.symbolFill,
"stroke-width":c.symbolStrokeWidth||1}));d.add(b.exportingGroup).align(t(c,{width:d.width,x:A(c.x,b.buttonOffset)}),!0,"spacingBox");b.buttonOffset+=(d.width+c.buttonSpacing)*("right"===c.align?-1:1);b.exportSVGElements.push(d,h)}},destroyExport:function(a){var b=a?a.target:this;a=b.exportSVGElements;var e=b.exportDivElements,c=b.exportEvents,g;a&&(l(a,function(a,c){a&&(a.onclick=a.ontouchstart=null,g="cache-"+a.menuClassName,b[g]&&delete b[g],b.exportSVGElements[c]=a.destroy())}),a.length=0);b.exportingGroup&&
(b.exportingGroup.destroy(),delete b.exportingGroup);e&&(l(e,function(a,c){f.clearTimeout(a.hideTimer);H(a,"mouseleave");b.exportDivElements[c]=a.onmouseout=a.onmouseover=a.ontouchstart=a.onclick=null;C(a)}),e.length=0);c&&(l(c,function(a){a()}),c.length=0)}});J.menu=function(a,b,e,c){return["M",a,b+2.5,"L",a+e,b+2.5,"M",a,b+c/2+.5,"L",a+e,b+c/2+.5,"M",a,b+c-1.5,"L",a+e,b+c-1.5]};z.prototype.renderExporting=function(){var a=this,b=a.options.exporting,e=b.buttons,c=a.isDirtyExporting||!a.exportSVGElements;
a.buttonOffset=0;a.isDirtyExporting&&a.destroyExport();c&&!1!==b.enabled&&(a.exportEvents=[],a.exportingGroup=a.exportingGroup||a.renderer.g("exporting-group").attr({zIndex:3}).add(),E(e,function(b){a.addButton(b)}),a.isDirtyExporting=!1);q(a,"destroy",a.destroyExport)};q(z,"init",function(){var a=this;l(["exporting","navigation"],function(b){a[b]={update:function(e,c){a.isDirtyExporting=!0;p(!0,a.options[b],e);A(c,!0)&&a.redraw()}}})});z.prototype.callbacks.push(function(a){a.renderExporting();q(a,
"redraw",a.renderExporting)})})(g)});
//# sourceMappingURL=exporting.js.map
;
/*
 Highcharts JS v6.1.4 (2018-09-25)
 Highcharts funnel module

 (c) 2010-2017 Torstein Honsi

 License: www.highcharts.com/license
*/

(function(a){"object"===typeof module&&module.exports?module.exports=a:"function"===typeof define&&define.amd?define(function(){return a}):a(Highcharts)})(function(a){(function(a){var p=a.seriesType,D=a.seriesTypes,H=a.noop,E=a.pick,I=a.each;p("funnel","pie",{animation:!1,center:["50%","50%"],width:"90%",neckWidth:"30%",height:"100%",neckHeight:"25%",reversed:!1,size:!0,dataLabels:{connectorWidth:1},states:{select:{color:"#cccccc",borderColor:"#000000"}}},{animate:H,translate:function(){var d=function(b,
a){return/%$/.test(b)?a*parseInt(b,10)/100:parseInt(b,10)},a=0,f=this.chart,e=this.options,c=e.reversed,v=e.ignoreHiddenPoint,t=f.plotWidth,f=f.plotHeight,q=0,p=e.center,g=d(p[0],t),r=d(p[1],f),D=d(e.width,t),k,w,l=d(e.height,f),x=d(e.neckWidth,t),F=d(e.neckHeight,f),y=r-l/2+l-F,d=this.data,A,B,E="left"===e.dataLabels.position?1:0,C,m,G,u,h,z,n;this.getWidthAt=w=function(b){var a=r-l/2;return b>y||l===F?x:x+(D-x)*(1-(b-a)/(l-F))};this.getX=function(b,a,d){return g+(a?-1:1)*(w(c?2*r-b:b)/2+d.labelDistance)};
this.center=[g,r,l];this.centerX=g;I(d,function(b){v&&!1===b.visible||(a+=b.y)});I(d,function(b){n=null;B=a?b.y/a:0;m=r-l/2+q*l;h=m+B*l;k=w(m);C=g-k/2;G=C+k;k=w(h);u=g-k/2;z=u+k;m>y?(C=u=g-x/2,G=z=g+x/2):h>y&&(n=h,k=w(y),u=g-k/2,z=u+k,h=y);c&&(m=2*r-m,h=2*r-h,null!==n&&(n=2*r-n));A=["M",C,m,"L",G,m,z,h];null!==n&&A.push(z,n,u,n);A.push(u,h,"Z");b.shapeType="path";b.shapeArgs={d:A};b.percentage=100*B;b.plotX=g;b.plotY=(m+(n||h))/2;b.tooltipPos=[g,b.plotY];b.slice=H;b.half=E;v&&!1===b.visible||(q+=
B)})},sortByAngle:function(a){a.sort(function(a,d){return a.plotY-d.plotY})},drawDataLabels:function(){var a=this.data,p=this.options.dataLabels.distance,f,e,c,v=a.length,t,q;for(this.center[2]-=2*p;v--;)c=a[v],e=(f=c.half)?1:-1,q=c.plotY,c.labelDistance=E(c.options.dataLabels&&c.options.dataLabels.distance,p),this.maxLabelDistance=Math.max(c.labelDistance,this.maxLabelDistance||0),t=this.getX(q,f,c),c.labelPos=[0,q,t+(c.labelDistance-5)*e,q,t+c.labelDistance*e,q,f?"right":"left",0];D.pie.prototype.drawDataLabels.call(this)}});
p("pyramid","funnel",{neckWidth:"0%",neckHeight:"0%",reversed:!0})})(a)});
//# sourceMappingURL=funnel.js.map
;
/*
 Highcharts JS v6.1.4 (2018-09-25)
 Data module

 (c) 2012-2017 Torstein Honsi

 License: www.highcharts.com/license
*/

(function(q){"object"===typeof module&&module.exports?module.exports=q:"function"===typeof define&&define.amd?define(function(){return q}):q(Highcharts)})(function(q){(function(h){h.ajax=function(q){var m=h.merge(!0,{url:!1,type:"GET",dataType:"json",success:!1,error:!1,data:!1,headers:{}},q);q={json:"application/json",xml:"application/xml",text:"text/plain",octet:"application/octet-stream"};var p=new XMLHttpRequest;if(!m.url)return!1;p.open(m.type.toUpperCase(),m.url,!0);p.setRequestHeader("Content-Type",
q[m.dataType]||q.text);h.objectEach(m.headers,function(h,m){p.setRequestHeader(m,h)});p.onreadystatechange=function(){var h;if(4===p.readyState){if(200===p.status){h=p.responseText;if("json"===m.dataType)try{h=JSON.parse(h)}catch(C){m.error&&m.error(p,C);return}return m.success&&m.success(h)}m.error&&m.error(p,p.responseText)}};try{m.data=JSON.stringify(m.data)}catch(u){}p.send(m.data||!0)}})(q);(function(h){var q=h.addEvent,m=h.Chart,p=h.win.document,u=h.each,C=h.objectEach,H=h.pick,E=h.inArray,
F=h.isNumber,z=h.merge,I=h.splat,J=h.fireEvent,K=h.some,x,A=function(a,b,c){this.init(a,b,c)};h.extend(A.prototype,{init:function(a,b,c){var f=a.decimalPoint,e;b&&(this.chartOptions=b);c&&(this.chart=c);"."!==f&&","!==f&&(f=void 0);this.options=a;this.columns=a.columns||this.rowsToColumns(a.rows)||[];this.firstRowAsNames=H(a.firstRowAsNames,this.firstRowAsNames,!0);this.decimalRegex=f&&new RegExp("^(-?[0-9]+)"+f+"([0-9]+)$");this.rawColumns=[];this.columns.length&&(this.dataFound(),e=!0);e||(e=this.fetchLiveData());
e||(e=!!this.parseCSV().length);e||(e=!!this.parseTable().length);e||(e=this.parseGoogleSpreadsheet());!e&&a.afterComplete&&a.afterComplete()},getColumnDistribution:function(){var a=this.chartOptions,b=this.options,c=[],f=function(a){return(h.seriesTypes[a||"line"].prototype.pointArrayMap||[0]).length},e=a&&a.chart&&a.chart.type,d=[],l=[],w=0,b=b&&b.seriesMapping||a&&a.series&&h.map(a.series,function(){return{x:0}})||[],g;u(a&&a.series||[],function(a){d.push(f(a.type||e))});u(b,function(a){c.push(a.x||
0)});0===c.length&&c.push(0);u(b,function(b){var c=new x,D=d[w]||f(e),n=h.seriesTypes[((a&&a.series||[])[w]||{}).type||e||"line"].prototype.pointArrayMap||["y"];c.addColumnReader(b.x,"x");C(b,function(a,b){"x"!==b&&c.addColumnReader(a,b)});for(g=0;g<D;g++)c.hasReader(n[g])||c.addColumnReader(void 0,n[g]);l.push(c);w++});b=h.seriesTypes[e||"line"].prototype.pointArrayMap;void 0===b&&(b=["y"]);this.valueCount={global:f(e),xColumns:c,individual:d,seriesBuilders:l,globalPointArrayMap:b}},dataFound:function(){this.options.switchRowsAndColumns&&
(this.columns=this.rowsToColumns(this.columns));this.getColumnDistribution();this.parseTypes();!1!==this.parsed()&&this.complete()},parseCSV:function(a){function b(a,b,c,d){function e(b){k=a[b];r=a[b-1];w=a[b+1]}function f(a){v.length<t+1&&v.push([a]);v[t][v[t].length-1]!==a&&v[t].push(a)}function g(){D>B||B>m?(++B,n=""):(!isNaN(parseFloat(n))&&isFinite(n)?(n=parseFloat(n),f("number")):isNaN(Date.parse(n))?f("string"):(n=n.replace(/\//g,"-"),f("date")),h.length<t+1&&h.push([]),c||(h[t][b]=n),n="",
++t,++B)}var l=0,k="",r="",w="",n="",B=0,t=0;if(a.trim().length&&"#"!==a.trim()[0]){for(;l<a.length;l++){e(l);if("#"===k){g();return}if('"'===k)for(e(++l);l<a.length&&('"'!==k||'"'===r||'"'===w);){if('"'!==k||'"'===k&&'"'!==r)n+=k;e(++l)}else d&&d[k]?d[k](k,n)&&g():k===y?g():n+=k}g()}}function c(a){var b=0,c=0,f=!1;K(a,function(a,d){var e=!1,f,k,g="";if(13<d)return!0;for(var l=0;l<a.length;l++){d=a[l];f=a[l+1];k=a[l-1];if("#"===d)break;else if('"'===d)if(e){if('"'!==k&&'"'!==f){for(;" "===f&&l<a.length;)f=
a[++l];"undefined"!==typeof t[f]&&t[f]++;e=!1}}else e=!0;else"undefined"!==typeof t[d]?(g=g.trim(),isNaN(Date.parse(g))?!isNaN(g)&&isFinite(g)||t[d]++:t[d]++,g=""):g+=d;","===d&&c++;"."===d&&b++}});f=t[";"]>t[","]?";":",";d.decimalPoint||(d.decimalPoint=b>c?".":",",e.decimalRegex=new RegExp("^(-?[0-9]+)"+d.decimalPoint+"([0-9]+)$"));return f}function f(a,b){var c,f,g=0,l=!1,h=[],n=[],k;if(!b||b>a.length)b=a.length;for(;g<b;g++)if("undefined"!==typeof a[g]&&a[g]&&a[g].length)for(c=a[g].trim().replace(/\//g,
" ").replace(/\-/g," ").split(" "),f=["","",""],k=0;k<c.length;k++)k<f.length&&(c[k]=parseInt(c[k],10),c[k]&&(n[k]=!n[k]||n[k]<c[k]?c[k]:n[k],"undefined"!==typeof h[k]?h[k]!==c[k]&&(h[k]=!1):h[k]=c[k],31<c[k]?f[k]=100>c[k]?"YY":"YYYY":12<c[k]&&31>=c[k]?(f[k]="dd",l=!0):f[k].length||(f[k]="mm")));if(l){for(k=0;k<h.length;k++)!1!==h[k]?12<n[k]&&"YY"!==f[k]&&"YYYY"!==f[k]&&(f[k]="YY"):12<n[k]&&"mm"===f[k]&&(f[k]="dd");3===f.length&&"dd"===f[1]&&"dd"===f[2]&&(f[2]="YY");a=f.join("/");return(d.dateFormats||
e.dateFormats)[a]?a:(J("deduceDateFailed"),"YYYY/mm/dd")}return"YYYY/mm/dd"}var e=this,d=a||this.options,l=d.csv,h;a="undefined"!==typeof d.startRow&&d.startRow?d.startRow:0;var g=d.endRow||Number.MAX_VALUE,D="undefined"!==typeof d.startColumn&&d.startColumn?d.startColumn:0,m=d.endColumn||Number.MAX_VALUE,y,n=0,v=[],t={",":0,";":0,"\t":0};h=this.columns=[];l&&d.beforeParse&&(l=d.beforeParse.call(this,l));if(l){l=l.replace(/\r\n/g,"\n").replace(/\r/g,"\n").split(d.lineDelimiter||"\n");if(!a||0>a)a=
0;if(!g||g>=l.length)g=l.length-1;d.itemDelimiter?y=d.itemDelimiter:(y=null,y=c(l));for(var G=0,n=a;n<=g;n++)"#"===l[n][0]?G++:b(l[n],n-a-G);d.columnTypes&&0!==d.columnTypes.length||!v.length||!v[0].length||"date"!==v[0][1]||d.dateFormat||(d.dateFormat=f(h[0]));this.dataFound()}return h},parseTable:function(){var a=this.options,b=a.table,c=this.columns,f=a.startRow||0,e=a.endRow||Number.MAX_VALUE,d=a.startColumn||0,l=a.endColumn||Number.MAX_VALUE;b&&("string"===typeof b&&(b=p.getElementById(b)),u(b.getElementsByTagName("tr"),
function(a,b){b>=f&&b<=e&&u(a.children,function(a,e){("TD"===a.tagName||"TH"===a.tagName)&&e>=d&&e<=l&&(c[e-d]||(c[e-d]=[]),c[e-d][b-f]=a.innerHTML)})}),this.dataFound());return c},fetchLiveData:function(){function a(w){function g(g,l,y){function n(){e&&b.liveDataURL===g&&(b.liveDataTimeout=setTimeout(a,d))}if(!g||0!==g.indexOf("http"))return g&&c.error&&c.error("Invalid URL"),!1;w&&(clearTimeout(b.liveDataTimeout),b.liveDataURL=g);h.ajax({url:g,dataType:y||"json",success:function(a){b&&b.series&&
l(a);n()},error:function(a,b){3>++f&&n();return c.error&&c.error(b,a)}});return!0}g(l.csvURL,function(a){b.update({data:{csv:a}})},"text")||g(l.rowsURL,function(a){b.update({data:{rows:a}})})||g(l.columnsURL,function(a){b.update({data:{columns:a}})})}var b=this.chart,c=this.options,f=0,e=c.enablePolling,d=1E3*(c.dataRefreshRate||2),l=z(c);if(!c||!c.csvURL&&!c.rowsURL&&!c.columnsURL)return!1;1E3>d&&(d=1E3);delete c.csvURL;delete c.rowsURL;delete c.columnsURL;a(!0);return c&&(c.csvURL||c.rowsURL||c.columnsURL)},
parseGoogleSpreadsheet:function(){function a(b){var e=["https://spreadsheets.google.com/feeds/cells",f,d,"public/values?alt\x3djson"].join("/");h.ajax({url:e,dataType:"json",success:function(d){b(d);c.enablePolling&&setTimeout(function(){a(b)},c.dataRefreshRate)},error:function(a,b){return c.error&&c.error(b,a)}})}var b=this,c=this.options,f=c.googleSpreadsheetKey,e=this.chart,d=c.googleSpreadsheetWorksheet||1,l=c.startRow||0,w=c.endRow||Number.MAX_VALUE,g=c.startColumn||0,m=c.endColumn||Number.MAX_VALUE,
q=1E3*(c.dataRefreshRate||2);4E3>q&&(q=4E3);f&&(delete c.googleSpreadsheetKey,a(function(a){var c=[];a=a.feed.entry;var d,f=(a||[]).length,h=0,q,p,r;if(!a||0===a.length)return!1;for(r=0;r<f;r++)d=a[r],h=Math.max(h,d.gs$cell.col);for(r=0;r<h;r++)r>=g&&r<=m&&(c[r-g]=[]);for(r=0;r<f;r++)d=a[r],h=d.gs$cell.row-1,q=d.gs$cell.col-1,q>=g&&q<=m&&h>=l&&h<=w&&(p=d.gs$cell||d.content,d=null,p.numericValue?d=0<=p.$t.indexOf("/")||0<=p.$t.indexOf("-")?p.$t:0<p.$t.indexOf("%")?100*parseFloat(p.numericValue):parseFloat(p.numericValue):
p.$t&&p.$t.length&&(d=p.$t),c[q-g][h-l]=d);u(c,function(a){for(r=0;r<a.length;r++)void 0===a[r]&&(a[r]=null)});e&&e.series?e.update({data:{columns:c}}):(b.columns=c,b.dataFound())}));return!1},trim:function(a,b){"string"===typeof a&&(a=a.replace(/^\s+|\s+$/g,""),b&&/^[0-9\s]+$/.test(a)&&(a=a.replace(/\s/g,"")),this.decimalRegex&&(a=a.replace(this.decimalRegex,"$1.$2")));return a},parseTypes:function(){for(var a=this.columns,b=a.length;b--;)this.parseColumn(a[b],b)},parseColumn:function(a,b){var c=
this.rawColumns,f=this.columns,e=a.length,d,l,h,g,p=this.firstRowAsNames,m=-1!==E(b,this.valueCount.xColumns),q,n=[],v=this.chartOptions,t,u=(this.options.columnTypes||[])[b],v=m&&(v&&v.xAxis&&"category"===I(v.xAxis)[0].type||"string"===u);for(c[b]||(c[b]=[]);e--;)d=n[e]||a[e],h=this.trim(d),g=this.trim(d,!0),l=parseFloat(g),void 0===c[b][e]&&(c[b][e]=h),v||0===e&&p?a[e]=""+h:+g===l?(a[e]=l,31536E6<l&&"float"!==u?a.isDatetime=!0:a.isNumeric=!0,void 0!==a[e+1]&&(t=l>a[e+1])):(h&&h.length&&(q=this.parseDate(d)),
m&&F(q)&&"float"!==u?(n[e]=d,a[e]=q,a.isDatetime=!0,void 0!==a[e+1]&&(d=q>a[e+1],d!==t&&void 0!==t&&(this.alternativeFormat?(this.dateFormat=this.alternativeFormat,e=a.length,this.alternativeFormat=this.dateFormats[this.dateFormat].alternative):a.unsorted=!0),t=d)):(a[e]=""===h?null:h,0!==e&&(a.isDatetime||a.isNumeric)&&(a.mixed=!0)));m&&a.mixed&&(f[b]=c[b]);if(m&&t&&this.options.sort)for(b=0;b<f.length;b++)f[b].reverse(),p&&f[b].unshift(f[b].pop())},dateFormats:{"YYYY/mm/dd":{regex:/^([0-9]{4})[\-\/\.]([0-9]{1,2})[\-\/\.]([0-9]{1,2})$/,
parser:function(a){return Date.UTC(+a[1],a[2]-1,+a[3])}},"dd/mm/YYYY":{regex:/^([0-9]{1,2})[\-\/\.]([0-9]{1,2})[\-\/\.]([0-9]{4})$/,parser:function(a){return Date.UTC(+a[3],a[2]-1,+a[1])},alternative:"mm/dd/YYYY"},"mm/dd/YYYY":{regex:/^([0-9]{1,2})[\-\/\.]([0-9]{1,2})[\-\/\.]([0-9]{4})$/,parser:function(a){return Date.UTC(+a[3],a[1]-1,+a[2])}},"dd/mm/YY":{regex:/^([0-9]{1,2})[\-\/\.]([0-9]{1,2})[\-\/\.]([0-9]{2})$/,parser:function(a){var b=+a[3],b=b>(new Date).getFullYear()-2E3?b+1900:b+2E3;return Date.UTC(b,
a[2]-1,+a[1])},alternative:"mm/dd/YY"},"mm/dd/YY":{regex:/^([0-9]{1,2})[\-\/\.]([0-9]{1,2})[\-\/\.]([0-9]{2})$/,parser:function(a){return Date.UTC(+a[3]+2E3,a[1]-1,+a[2])}}},parseDate:function(a){var b=this.options.parseDate,c,f,e=this.options.dateFormat||this.dateFormat,d;if(b)c=b(a);else if("string"===typeof a){if(e)(b=this.dateFormats[e])||(b=this.dateFormats["YYYY/mm/dd"]),(d=a.match(b.regex))&&(c=b.parser(d));else for(f in this.dateFormats)if(b=this.dateFormats[f],d=a.match(b.regex)){this.dateFormat=
f;this.alternativeFormat=b.alternative;c=b.parser(d);break}d||(d=Date.parse(a),"object"===typeof d&&null!==d&&d.getTime?c=d.getTime()-6E4*d.getTimezoneOffset():F(d)&&(c=d-6E4*(new Date(d)).getTimezoneOffset()))}return c},rowsToColumns:function(a){var b,c,f,e,d;if(a)for(d=[],c=a.length,b=0;b<c;b++)for(e=a[b].length,f=0;f<e;f++)d[f]||(d[f]=[]),d[f][b]=a[b][f];return d},parsed:function(){if(this.options.parsed)return this.options.parsed.call(this,this.columns)},getFreeIndexes:function(a,b){var c,f=[],
e=[],d;for(c=0;c<a;c+=1)f.push(!0);for(a=0;a<b.length;a+=1)for(d=b[a].getReferencedColumnIndexes(),c=0;c<d.length;c+=1)f[d[c]]=!1;for(c=0;c<f.length;c+=1)f[c]&&e.push(c);return e},complete:function(){var a=this.columns,b,c=this.options,f,e,d,h,m=[],g;if(c.complete||c.afterComplete){if(this.firstRowAsNames)for(d=0;d<a.length;d++)a[d].name=a[d].shift();f=[];e=this.getFreeIndexes(a.length,this.valueCount.seriesBuilders);for(d=0;d<this.valueCount.seriesBuilders.length;d++)g=this.valueCount.seriesBuilders[d],
g.populateColumns(e)&&m.push(g);for(;0<e.length;){g=new x;g.addColumnReader(0,"x");d=E(0,e);-1!==d&&e.splice(d,1);for(d=0;d<this.valueCount.global;d++)g.addColumnReader(void 0,this.valueCount.globalPointArrayMap[d]);g.populateColumns(e)&&m.push(g)}0<m.length&&0<m[0].readers.length&&(g=a[m[0].readers[0].columnIndex],void 0!==g&&(g.isDatetime?b="datetime":g.isNumeric||(b="category")));if("category"===b)for(d=0;d<m.length;d++)for(g=m[d],e=0;e<g.readers.length;e++)"x"===g.readers[e].configName&&(g.readers[e].configName=
"name");for(d=0;d<m.length;d++){g=m[d];e=[];for(h=0;h<a[0].length;h++)e[h]=g.read(a,h);f[d]={data:e};g.name&&(f[d].name=g.name);"category"===b&&(f[d].turboThreshold=0)}a={series:f};b&&(a.xAxis={type:b},"category"===b&&(a.xAxis.uniqueNames=!1));c.complete&&c.complete(a);c.afterComplete&&c.afterComplete(a)}},update:function(a,b){var c=this.chart;a&&(a.afterComplete=function(a){a.xAxis&&c.xAxis[0]&&a.xAxis.type===c.xAxis[0].options.type&&delete a.xAxis;c.update(a,b,!0)},z(!0,this.options,a),this.init(this.options))}});
h.Data=A;h.data=function(a,b){return new A(a,b)};q(m,"init",function(a){var b=this,c=a.args[0],f=a.args[1];c&&c.data&&!b.hasDataDef&&(b.hasDataDef=!0,b.data=new A(h.extend(c.data,{afterComplete:function(a){var d,e;if(c.hasOwnProperty("series"))if("object"===typeof c.series)for(d=Math.max(c.series.length,a&&a.series?a.series.length:0);d--;)e=c.series[d]||{},c.series[d]=z(e,a&&a.series?a.series[d]:{});else delete c.series;c=z(a,c);b.init(c,f)}}),c,b),a.preventDefault())});x=function(){this.readers=
[];this.pointIsArray=!0};x.prototype.populateColumns=function(a){var b=!0;u(this.readers,function(b){void 0===b.columnIndex&&(b.columnIndex=a.shift())});u(this.readers,function(a){void 0===a.columnIndex&&(b=!1)});return b};x.prototype.read=function(a,b){var c=this.pointIsArray,f=c?[]:{},e;u(this.readers,function(d){var e=a[d.columnIndex][b];c?f.push(e):0<d.configName.indexOf(".")?h.Point.prototype.setNestedProperty(f,e,d.configName):f[d.configName]=e});void 0===this.name&&2<=this.readers.length&&
(e=this.getReferencedColumnIndexes(),2<=e.length&&(e.shift(),e.sort(function(a,b){return a-b}),this.name=a[e.shift()].name));return f};x.prototype.addColumnReader=function(a,b){this.readers.push({columnIndex:a,configName:b});"x"!==b&&"y"!==b&&void 0!==b&&(this.pointIsArray=!1)};x.prototype.getReferencedColumnIndexes=function(){var a,b=[],c;for(a=0;a<this.readers.length;a+=1)c=this.readers[a],void 0!==c.columnIndex&&b.push(c.columnIndex);return b};x.prototype.hasReader=function(a){var b,c;for(b=0;b<
this.readers.length;b+=1)if(c=this.readers[b],c.configName===a)return!0}})(q)});
//# sourceMappingURL=data.js.map
;
/*
  Highcharts JS v6.1.4 (2018-09-25)
 Solid angular gauge module

 (c) 2010-2017 Torstein Honsi

 License: www.highcharts.com/license
*/

(function(l){"object"===typeof module&&module.exports?module.exports=l:"function"===typeof define&&define.amd?define(function(){return l}):l(Highcharts)})(function(l){(function(e){var l=e.pInt,u=e.pick,m=e.each,v=e.isNumber,x=e.wrap,w;x(e.Renderer.prototype.symbols,"arc",function(a,g,d,c,e,b){a=a(g,d,c,e,b);b.rounded&&(c=((b.r||c)-b.innerR)/2,b=["A",c,c,0,1,1,a[12],a[13]],a.splice.apply(a,[a.length-1,0].concat(["A",c,c,0,1,1,a[1],a[2]])),a.splice.apply(a,[11,3].concat(b)));return a});w={initDataClasses:function(a){var g=
this.chart,d,c=0,r=this.options;this.dataClasses=d=[];m(a.dataClasses,function(b,h){b=e.merge(b);d.push(b);b.color||("category"===r.dataClassColor?(h=g.options.colors,b.color=h[c++],c===h.length&&(c=0)):b.color=e.color(r.minColor).tweenTo(e.color(r.maxColor),h/(a.dataClasses.length-1)))})},initStops:function(a){this.stops=a.stops||[[0,this.options.minColor],[1,this.options.maxColor]];m(this.stops,function(a){a.color=e.color(a[1])})},toColor:function(a,g){var d=this.stops,c,e,b=this.dataClasses,h,
f;if(b)for(f=b.length;f--;){if(h=b[f],c=h.from,d=h.to,(void 0===c||a>=c)&&(void 0===d||a<=d)){e=h.color;g&&(g.dataClass=f);break}}else{this.isLog&&(a=this.val2lin(a));a=1-(this.max-a)/(this.max-this.min);for(f=d.length;f--&&!(a>d[f][0]););c=d[f]||d[f+1];d=d[f+1]||c;a=1-(d[0]-a)/(d[0]-c[0]||1);e=c.color.tweenTo(d.color,a)}return e}};e.seriesType("solidgauge","gauge",{colorByPoint:!0},{translate:function(){var a=this.yAxis;e.extend(a,w);!a.dataClasses&&a.options.dataClasses&&a.initDataClasses(a.options);
a.initStops(a.options);e.seriesTypes.gauge.prototype.translate.call(this)},drawPoints:function(){var a=this,g=a.yAxis,d=g.center,c=a.options,r=a.chart.renderer,b=c.overshoot,h=v(b)?b/180*Math.PI:0,f;v(c.threshold)&&(f=g.startAngleRad+g.translate(c.threshold,null,null,null,!0));this.thresholdAngleRad=u(f,g.startAngleRad);m(a.points,function(b){var f=b.graphic,k=g.startAngleRad+g.translate(b.y,null,null,null,!0),t=l(u(b.options.radius,c.radius,100))*d[2]/200,n=l(u(b.options.innerRadius,c.innerRadius,
60))*d[2]/200,p=g.toColor(b.y,b),q=Math.min(g.startAngleRad,g.endAngleRad),m=Math.max(g.startAngleRad,g.endAngleRad);"none"===p&&(p=b.color||a.color||"none");"none"!==p&&(b.color=p);k=Math.max(q-h,Math.min(m+h,k));!1===c.wrap&&(k=Math.max(q,Math.min(m,k)));q=Math.min(k,a.thresholdAngleRad);k=Math.max(k,a.thresholdAngleRad);k-q>2*Math.PI&&(k=q+2*Math.PI);b.shapeArgs=n={x:d[0],y:d[1],r:t,innerR:n,start:q,end:k,rounded:c.rounded};b.startR=t;f?(t=n.d,f.animate(e.extend({fill:p},n)),t&&(n.d=t)):(b.graphic=
f=r.arc(n).attr({fill:p,"sweep-flag":0}).add(a.group),"square"!==c.linecap&&f.attr({"stroke-linecap":"round","stroke-linejoin":"round"}),f.attr({stroke:c.borderColor||"none","stroke-width":c.borderWidth||0}));f&&f.addClass(b.getClassName(),!0)})},animate:function(a){a||(this.startAngleRad=this.thresholdAngleRad,e.seriesTypes.pie.prototype.animate.call(this,a))}})})(l)});
//# sourceMappingURL=solid-gauge.js.map
;
/*
 Highcharts JS v6.1.4 (2018-09-25)
 Plugin for displaying a message when there is no data visible in chart.

 (c) 2010-2017 Highsoft AS
 Author: Oystein Moseng

 License: www.highcharts.com/license
*/

(function(c){"object"===typeof module&&module.exports?module.exports=c:"function"===typeof define&&define.amd?define(function(){return c}):c(Highcharts)})(function(c){(function(d){var c=d.seriesTypes,e=d.Chart.prototype,f=d.getOptions(),g=d.extend,h=d.each;g(f.lang,{noData:"No data to display"});f.noData={position:{x:0,y:0,align:"center",verticalAlign:"middle"}};f.noData.style={fontWeight:"bold",fontSize:"12px",color:"#666666"};h("bubble gauge heatmap pie sankey treemap waterfall".split(" "),function(b){c[b]&&
(c[b].prototype.hasData=function(){return!!this.points.length})});d.Series.prototype.hasData=function(){return this.visible&&void 0!==this.dataMax&&void 0!==this.dataMin};e.showNoData=function(b){var a=this.options;b=b||a&&a.lang.noData;a=a&&a.noData;!this.noDataLabel&&this.renderer&&(this.noDataLabel=this.renderer.label(b,0,0,null,null,null,a.useHTML,null,"no-data"),this.noDataLabel.attr(a.attr).css(a.style),this.noDataLabel.add(),this.noDataLabel.align(g(this.noDataLabel.getBBox(),a.position),!1,
"plotBox"))};e.hideNoData=function(){this.noDataLabel&&(this.noDataLabel=this.noDataLabel.destroy())};e.hasData=function(){for(var b=this.series||[],a=b.length;a--;)if(b[a].hasData()&&!b[a].options.isInternal)return!0;return this.loadingShown};d.addEvent(d.Chart,"render",function(){this.hasData()?this.hideNoData():this.showNoData()})})(c)});
//# sourceMappingURL=no-data-to-display.js.map
;
/*
  Highcharts JS v6.1.4 (2018-09-25)

 Indicator series type for Highstock

 (c) 2010-2017 Pawel Fus, Sebastian Bochan

 License: www.highcharts.com/license
*/

(function(e){"object"===typeof module&&module.exports?module.exports=e:"function"===typeof define&&define.amd?define(function(){return e}):e(Highcharts)})(function(e){(function(d){var e=d.pick,h=d.each,p=d.error,k=d.Series,q=d.isArray,l=d.addEvent;d=d.seriesType;d("sma","line",{name:void 0,tooltip:{valueDecimals:4},linkedTo:void 0,params:{index:0,period:14}},{bindTo:{series:!0,eventName:"updatedData"},useCommonDataGrouping:!0,nameComponents:["period"],nameSuffixes:[],calculateOn:"init",init:function(b,
c){function d(){var b=(a.xData||[]).length,c=a.getValues(a.linkedParent,a.options.params)||{values:[],xData:[],yData:[]};b&&b===c.xData.length&&!a.cropped&&!a.hasGroupedData&&a.visible&&a.points?a.updateData(c.values):(a.xData=c.xData,a.yData=c.yData,a.options.data=c.values);!1===a.bindTo.series&&(delete a.processedXData,a.isDirty=!0,a.redraw());a.isDirtyData=!1}var a=this;k.prototype.init.call(a,b,c);b.linkSeries();a.dataEventsToUnbind=[];if(!a.linkedParent)return p("Series "+a.options.linkedTo+
" not found! Check `linkedTo`.");a.dataEventsToUnbind.push(l(a.bindTo.series?a.linkedParent:a.linkedParent.xAxis,a.bindTo.eventName,d));if("init"===a.calculateOn)d();else var e=l(a.chart,a.calculateOn,function(){d();e()});return a},getName:function(){var b=this.name,c=[];b||(h(this.nameComponents,function(b,a){c.push(this.options.params[b]+e(this.nameSuffixes[a],""))},this),b=(this.nameBase||this.type.toUpperCase())+(this.nameComponents?" ("+c.join(", ")+")":""));return b},getValues:function(b,c){var d=
c.period,a=b.xData;b=b.yData;var e=b.length,f=0,m=0,h=[],k=[],l=[],g=-1,n;if(a.length<d)return!1;for(q(b[0])&&(g=c.index?c.index:0);f<d-1;)m+=0>g?b[f]:b[f][g],f++;for(c=f;c<e;c++)m+=0>g?b[c]:b[c][g],n=[a[c],m/d],h.push(n),k.push(n[0]),l.push(n[1]),m-=0>g?b[c-f]:b[c-f][g];return{values:h,xData:k,yData:l}},destroy:function(){h(this.dataEventsToUnbind,function(b){b()});k.prototype.destroy.call(this)}})})(e)});
//# sourceMappingURL=indicators.js.map
;
/*
  Highcharts JS v6.1.4 (2018-09-25)

 Indicator series type for Highstock

 (c) 2010-2017 Pawe Fus

 License: www.highcharts.com/license
*/

(function(a){"object"===typeof module&&module.exports?module.exports=a:"function"===typeof define&&define.amd?define(function(){return a}):a(Highcharts)})(function(a){(function(a){var q=a.isArray;a.seriesType("rsi","sma",{params:{period:14,decimals:4}},{getValues:function(b,c){var a=c.period,l=b.xData,r=(b=b.yData)?b.length:0;c=c.decimals;var d=1,m=[],n=[],p=[],e=0,g=0,f,h,k;if(l.length<a||!q(b[0])||4!==b[0].length)return!1;for(;d<a;)f=parseFloat((b[d][3]-b[d-1][3]).toFixed(c)),0<f?e+=f:g+=Math.abs(f),
d++;h=parseFloat((e/(a-1)).toFixed(c));for(k=parseFloat((g/(a-1)).toFixed(c));d<r;d++)f=parseFloat((b[d][3]-b[d-1][3]).toFixed(c)),0<f?(e=f,g=0):(e=0,g=Math.abs(f)),h=parseFloat(((h*(a-1)+e)/a).toFixed(c)),k=parseFloat(((k*(a-1)+g)/a).toFixed(c)),e=0===k?100:0===h?0:parseFloat((100-100/(1+h/k)).toFixed(c)),m.push([l[d],e]),n.push(l[d]),p.push(e);return{values:m,xData:n,yData:p}}})})(a)});
//# sourceMappingURL=rsi.js.map
;
'use strict';
(function (factory) {
	if (typeof module === 'object' && module.exports) {
		module.exports = factory;
	} else if (typeof define === 'function' && define.amd) {
		define(function () {
			return factory;
		});
	} else {
		factory(Highcharts);
	}
}(function (Highcharts) {
	(function (Highcharts) {

		Highcharts.theme = {
        colors: ['#ff7200', '#1a98ff', '#fb463e', '#fcc131', '#d354a5', '#46c65f', '#ae5a3f', '#F3E796', '#95C471', '#35729E', '#251735'],

		    colorAxis: {
		        maxColor: '#05426E',
		        minColor: '#F3E796'
		    },
        xAxis:{
          lineColor: '#999999',
        },
		    plotOptions: {
          series:{
            states: {hover: {enabled: true, lineWidthPlus: 0, color: '#ff7200'}},
            marker: {
              enabled: false,
              symbol: 'circle'
            }
          },
          line: {
            lineWidth: 2,
            marker: {
              enabled: false,
              symbol: 'circle'
            }
          },
          column:{
            color: '#999999',
            borderWidth: 0
          },
          flags:{
            shape: 'circlepin',
            borderColor: '#999',
            textAlign: 'center',
            color:'#A1CCFA',
            useHTML: true,
            width: 14,
            height: 14,
            states:{
              hover: { enabled:true, fillColor:'#A1CCFA', lineColor:'#A1CCFA', style: { color: 'white'} },
              selected: { enabled:true, fillColor:'#A1CCFA', lineColor:'#A1CCFA', style: { color: 'white'} },
            }
          },
          ohlc: {
            color: '#ff7200'
          },
          rsi: {
            color: '#999999'
          },
          sma: {
            color: '#999999',
            marker: {
              enabled: false,
              symbol: 'circle'
            }
          },
          map: {
		            nullColor: '#fcfefe'
		        }
		    },
		    navigator: {
		        maskFill: 'rgba(170, 205, 170, 0.5)',
		        series: {
		            color: '#000000',
		            lineColor: '#999'
		        }
		    },
        rangeSelector: {
          buttonTheme: {
            fill: 'none', stroke: '#dbdbdb', 'stroke-width': 1, r: 2, height: 15, width: 26,
            style: {color: '#555555', backgroundColor: 'white'},
            states: {
              hover: {fill: '#ff7200', 'stroke-width': 0, style: {fontWeight: 'normal', color: 'white'}},
              select: {fill: '#ff7200', stroke: '#ff7200', style: {fontWeight: 'normal', color: 'white'}}
            }
          }
        },
        tooltip:{
          padding: 8,
          backgroundColor: '#FFFFFF',
        },
        noData: {
          style: {
            fontWeight: 'bold', fontSize: '20px', color: '#555'
          }
        }
		};

		// Apply the theme
		Highcharts.setOptions(Highcharts.theme);

	}(Highcharts));
	return (function () {

	}());
}));
(function() { this.JST || (this.JST = {}); this.JST["jst/inline_svg/key"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<svg xmlns="http://www.w3.org/2000/svg" height="',  width / 1.9 ,'" width="',  width ,'" version="1.1" viewBox="-6.167 5.5 41 20.833" x="0px" y="0px">\n  <path fill="'); var keyColor = (typeof color !== 'undefined') ? color : '#BCBCBC'; __p.push('', keyColor,'" d="M-2.786 23.07c3.905 3.906 10.236 3.906 14.143 0a9.994 9.994 0 0 0 1.986-2.828h3.67l2.829-2.828 2.828 2.828 2.829-2.828 2.828 2.828 2.828-2.828 1.414 1.414 1.414-1.414a1.999 1.999 0 0 0 0-2.828l-4.242-4.243H12.533a10.098 10.098 0 0 0-1.177-1.415c-3.905-3.905-10.237-3.905-14.143 0-3.904 3.906-3.904 10.238.001 14.142zm.713-4.949a3 3 0 1 1 4.241-4.242 3 3 0 0 1-4.241 4.242z"</path>\n</svg>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/sacharts/chart_layout_wide"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<h4 class="',  shrink ,'">',  sectionTitle ,'</h4>\n<div class="row sa-chart-wrapper">\n  <div class="col-xs-12">\n    <div class="sa-chart-input-container hidden">\n      <input autocomplete="off" id="',  chartId ,'-input" class="pull-right" placeholder="Add comparison ticker" spellcheck="false" type="search"/>\n      <div class="lock-key hidden">',  keyIcon ,'</div>\n    </div>\n    <div class="sa-chart-settings-container hidden" id="',  chartId ,'-setting-container">\n    </div>\n    <div class="sa-chart-range-container">\n      <div id="',  chartId ,'-range-btns-container" class="range-buttons-group"/>\n    </div>\n    <div class="sa-chart-legend-container">\n      <div id="',  chartId ,'-legend-container" class="legend-buttons-container"/>\n    </div>\n    <div id="',  chartId ,'-chart" class="sa-chart-container"',  style ,'>\n      <div id="',  chartId ,'-chart-container" class="loader"/>\n    </div>\n    <div class="chart-bottom-comment">',  bottomComment ,'</div>\n  <div>\n<div>\n');}return __p.join('');};
}).call(this);




(function (w, SA, $) {

  'use strict';

  // STYLES:
  //
  // Please do not add theme style here
  // Main theme file : sa_theme.js  - Default values can be overridden within page chart configuration
  // Css files : vendor/highcharts/highcharts + widgets/sacharts/charter


  //  CONFIGURATION:
  //
  //  id: unique id for chart container, legend, autocomplete input
  //
  //  title: H4 Chart title - If empty, separator will be auto generated
  //
  //  format: formatter type for legend
  //
  //  legend: if exist will show custom legend on top of chart
  //    legend enableCloseBtn : show / no-show close btn
  //    title: specific title for legend
  //    clb : for close button
  //
  //  changeIndicator - will display change percent start/end date (current state)
  //
  //  autocomplete:  // if exist will show autocomplete component
  //    symbols: Boolean,
  //    excludeCrypto: Boolean,
  //    excludeIndices: Boolean,
  //    stocksOnly: Boolean,
  //    clb: Selection Callback function
  //    showAllUsers: boolean -> default: false
  //    non-pro user callback
  //
  //  subscriptionPopup: {
  //    sasource:  Source name,
  //    moneType: Type name,
  //    moneSource: Source name,
  //    moneAction:  Action name,
  //    moneData:  Data object },
  //
  //  range - Using range in configurator will disable native Highcharts Range Selector
  //    and will display a custom one. Use range when pro/lock button is needed
  //
  //  bottomComment - To set bottom comment beneath the chart
  //
  //  Chart settings can be overridden in renderChart instantiation
  //  Please do not change chart config - Override only
  //
  // Mone Event for native range selector defined under ../widgets/sacharts/custom_range.js

  var scope = SA.UsingNamespace('SA.Widgets.SACharts');
  scope.Charter = function (_config) {

    var MONE_COMPARISON_INPUT = 'comparison_ticker',
      // MONE_LINK_MSG = 'link',
      instance,
      chartContainer = '',
      MAX_TICKERS = 6,
      formatter = SA.Utils.Formatter,
      isPro = SA.App.pro,
      config = _config,
      chartSettings;

    w.Highcharts.setOptions({
      lang: { rangeSelectorZoom: '' },
      global: { useUTC: false }
    });

    function tooltipCallBack(slug, value) {
      var legendContainer, formatted;
      legendContainer = $('#' + config.id + '-legend-container').find("[data-ticker-text='" + slug.toUpperCase() + "']");
      formatted = formatter.number(value, config.legend.format);
      legendContainer.html(formatted);
    }

    function generateRangeInstance() {
      return new SA.Widgets.SACharts.Range({
        id: config.id,
        range: config.range,
        fireMoneEvent: fireMoneEvent,
        handleSubscribeClick: handleSubscribeClick
      });
    }

    function generateChangeIndicator() {
      if (config.changeIndicator && config.changeIndicator.enabled) {
        var slug = SA.pageConfig.Data.slug.toUpperCase();
        return new SA.Widgets.SACharts.ChangeIndicator({
          slug: slug,
          key: config.id + '-' + slug + '-' + 'indicator'
        });
      }
      return null;
    }

    function generateLegendInstance() {
      if (config.legend) {
        return new SA.Widgets.SACharts.Legend({
          legend: config.legend,
          title: config.legend.title || config.title,
          mouseClb: legendMouseEventHandler
        });
      }
      return null;
    }

    function generateSettingsInstance() {
      if (config.settings && config.settings.enabled) {
        return new SA.Widgets.SACharts.Settings();
      }
    }

    function legendMouseEventHandler(action, id) {
      switch (action) {
        case 'mouseover':
          seriesHighlight(id, true);
          break;
        case 'mouseout':
          seriesHighlight(id, false);
          break;
        case 'click':
          removeSeries(instance.chart.series.find(function (item) {
            return item.name === id;
          }));
          seriesHighlight(null, false);
          break;
        default:

          break;
      }
    }

    function seriesHighlight(id, hide) {
      $.each(instance.chart.series, function (k, serie) {
        if (chartSettings.navigator.enabled && serie.name.match(/Navigator/)) {
          return true;
        }

        var strokeColor = serie.color;
        if (hide && serie.name && id && serie.name.toLowerCase() !== id.toLowerCase()) {
          strokeColor = "#D4D4D4";
        }
        return serie.graph && serie.graph.attr('stroke', strokeColor);
      });
    }

    function setNonProAutoComplete(input) {
      input.prop('disabled', true).addClass('non-pro');

      $('.lock-key').removeClass('hidden');

      input.parent().on('click', function () {
        fireMoneEvent(MONE_COMPARISON_INPUT, '', true);
        handleSubscribeClick();
      });
    }

    function repositionInputContainer() {
      var space = 30,
        inputBox = $('#' + config.id + '-input').parent();

      if (chartSettings.rangeSelector.enabled) {
        space += chartSettings.rangeSelector.buttons.length * 45;
        inputBox.css('left', space + 'px');
      } else if (config.range) {
        space += (isPro ? 70 : 80) * Object.keys(config.range.buttons || {}).length;
        inputBox.css('left', space + 'px');
      } else {
        inputBox.css('left', space + 'px');
      }

      inputBox.removeClass('hide hidden');
    }

    function generateAutocompleteInstance() {
      var $input = $('#' + config.id + '-input');

      if (!config.autocomplete) {
        $input.hide();
        return null;
      }

      if (!isPro && !config.autocomplete.showAllUsers) {
        setNonProAutoComplete($input);
        return true;
      }

      return new SA.Utils.Autocomplete($input, {
        symbols: config.autocomplete.symbols,
        pages: false,
        people: false,
        multiple: true,
        resultsLimit: 3,
        excludeCrypto: config.autocomplete.excludeCrypto,
        excludeIndices: config.autocomplete.excludeIndices,
        stocksOnly: config.autocomplete.stocksOnly,
        symbolSelectCallback: config.autocomplete.clb
      });
    }

    function handleSubscribeClick() {
      SA.Pages.Symbols.Common.handleClick({
        sasource: config.subscriptionAction.saSource
      });
    }

    function fireMoneEvent(moneRef, moneRefValue, locked) {
      SA.Logger.Mone.event(
        config.subscriptionAction.moneType,
        config.subscriptionAction.moneSource,
        config.subscriptionAction.moneAction,
        {
          data: {
            origin: config.subscriptionAction.moneData,
            ref: moneRef,
            value: moneRefValue || '',
            locked: locked || false
          }
        });
    }

    function yAxisLabelFormater() {
      return formatter.number(this.value, config.format);
    }

    function tooltipPositioner(labelWidth, labelHeight, point) {
      var xpos = point.plotX - (labelWidth / 3);
      if (xpos < labelWidth / 3) {
        xpos = 10;
      } else if (xpos > instance.chart.plotBox.width - labelWidth / 2) {
        xpos = instance.chart.plotBox.width - labelWidth / 2;
      }
      return { x: xpos, y: instance.chart.plotBox.y + instance.chart.plotBox.height - labelHeight };
    }

    function tooltipFormater() {
      $.each(this.points, function (k, v) {
        tooltipCallBack(this.series.name, v.point.change || v.y);
      });
      return '<b>' + w.moment(this.x).format('MM/DD/YYYY') + '</b>';
    }

    function plotMouseOver() {
    }

    function plotMouseOut() {
      if (config.legend) {
        instance.legend.render(instance);
      }
    }

    function customMessage(msg) {
      var label = this.chart.renderer.label(msg, 320, 180)
        .attr({
          stroke: '#FFFFFF',
          padding: 10,
          'stroke-width': 2,
          fill: '#ff7200',
          r: 3,
          zIndex: 30
        })
        .css({
          color: '#FFFFFF'
        })
        .add();

      setTimeout(function () {
        label.fadeOut();
      }, 3000);
    }

    function noDataMessage(msg, subscribersOnly) {
      this.chart.hideNoData();
      instance.chart.showNoData(msg);
      if (!!subscribersOnly) {
        $('#' + this.id).click(function () {
          handleSubscribeClick();
        });
      }
    }

    function calcTopPadding() {
      var topCustomRange = config.range ? 30 : 0,
        topCustomLegend = config.legend ? 60 : 0;

      if (config.legend && config.legend.height) {
        topCustomLegend = config.legend.height;
      }

      return topCustomRange + topCustomLegend;
    }

    function updateExtermes(e) {
      if (config.changeIndicator && config.changeIndicator.enabled) {
        instance.changeIndicator.setValue(e);
      }

      if (config.legend) {
        instance.legend.render(instance);
      }
    }

    function generateChartInstance(chartSettingsOverride) {
      var paddingLeft = 5,
        paddingRight = 5,
        paddingBottom = 15,
        paddingTop = calcTopPadding();

      chartSettings = {
        mone: {
          config: config.subscriptionAction,
          callback: fireMoneEvent
        },
        boost: {useGPUTranslations: false},
        navigator: {enabled: false},
        credits: {enabled: false},
        exporting: {enabled: false},
        scrollbar: {enabled: false},
        chart: {
          height: 350, width: 900, spacing: [paddingTop, paddingRight, paddingBottom, paddingLeft],
          events: {
            addSeries: function (opt) {
              // console.log('addSeries')
              if (instance.changeIndicator) {
                var key = opt.options.indicatorKey;
                instance.changeIndicator.render(opt.options.name.toUpperCase(), key);
              }
            },
            afterPrint: function () {
              // console.log('charter afterPrint')
            },
            beforePrint: function () {
              // console.log('charter beforePrint')
            },
            click: function () {
              // console.log('charter click')
            },
            load: function () {
              // console.log('charter load')
            },
            redraw: function () {
              // console.log('charter redraw')
            },
            render: function () {
              // console.log('charter render')
            }
          }
        },
        xAxis: {
          minRange: 2592000000,
          labels: {
            format: '{value:%b %Y}'
          },
          showEmpty: false,
          events: {
            setExtremes: function (e) {
              if (instance.range) {
                instance.range.onSetExtremes(e);
              }
            },
            afterSetExtremes: updateExtermes
          }
        },
        yAxis: {
          labels: {
            align: 'left', x: 5, y: 5,
            formatter: yAxisLabelFormater
          },
          showEmpty: false
        },
        legend: {
          enabled: false,
          layout: 'horizontal',
          align: 'right',
          verticalAlign: 'top',
          floating: false,
          y: -20
        },
        plotOptions: {
          series: {
            animation: {
              complete: function () {
                // console.log('complete')
              }
            },
            events: {
              mouseOver: plotMouseOver,
              mouseOut: plotMouseOut,
              afterAnimate: function () {
                // console.log('afterAnimate')
                if (instance && instance.range) {
                  instance.range.afterAddSeries(instance.chart);
                }
              },
              show: function () {
                // console.log('show');
              },
              beforeRender: function () {
                // console.log('beforeRender');
              },
              afterRender: function () {
                // console.log('afterRender');
              },
              afterSetOptions: function () {
                // console.log('afterSetOptions');
              },
              update: function () {
                // console.log('update');
              }
            }
          },
          column: {
            events: {
              legendItemClick: function () {
                return false;
              }
            }
          },
          area: {
            threshold: '-Infinity'
          }
        },
        tooltip: {
          split: false,
          shared: true,
          padding: (config.legend) ? 2 : 8,
          borderWidth: (config.legend) ? 0 : 1,
          xDateFormat: '%m/%d/%Y',
          valueDecimals: 2,
          headerFormat: '<small>{point.key}</small><table>',
          animation: (!config.legend),
          positioner: (config.legend) ? tooltipPositioner : null,
          formatter: (config.legend) ? tooltipFormater : null
        },
        rangeSelector: {
          enabled: !config.range,
          // Custom param: when true, after click range selector, it will end at datamax
          forceChangeFromMax: true,
          verticalAlign: 'top',
          buttonPosition: {
            x: -3,
            y: (config.legend) ? -60 : 0
          },
          allButtonsEnabled: true,
          inputEnabled: false,
          selected: 2,
          buttons: [
            {type: 'month', count: 1, text: '1M'},
            {type: 'month', count: 6, text: '6M'},
            {type: 'year', count: 1, text: '1Y'},
            {type: 'year', count: 5, text: '5Y'}
          ],
          buttonSpacing: 7
        },
        lang: { noData: "" },
        noData: { useHTML: true }
      };



      chartSettings = $.extend(true, chartSettings, chartSettingsOverride || {});
      return new w.Highcharts.stockChart(chartContainer, chartSettings);
    }

    function limitSeriesAmount(len, id) {
      if (isPro) {
        var input = $('#' + id + '-input');

        len = chartSettings.navigator.enabled ? len - 1 : len;

        if (len < MAX_TICKERS) {
          input.prop('disabled', false).prop('placeholder', 'Add comparison ticker');
        } else {
          input.prop('disabled', true).prop('placeholder', "You've reached the maximum tickers");
        }
      }
    }

    //Send Array of series, or single
    function addSeries(series) {
      if (Array.isArray(series)) {
        var len = series.length;
        $.map(series, function (serie, i) {
          var redraw = (len === i + 1);
          instance.chart.addSeries(serie, redraw);
        });
      } else {
        instance.chart.addSeries(series);
      }

      if (config.legend) {
        instance.legend.render(instance);
      }

      if (config.autocomplete) {
        limitSeriesAmount(instance.chart.series.length, config.id);
      }

      if (config.changeIndicator && config.changeIndicator.enabled) {
        if (series.addedItem) {
          var xAxis = instance.chart.xAxis[0],
            extreme = xAxis.getExtremes();

          xAxis.setExtremes(extreme.userMin, extreme.userMax + 1);
        }
      }
    }

    function removeSeries(series) {
      if (series) {
        series.remove();

        if (config.legend) {
          instance.legend.render(instance);
        }
      }

      if (config.autocomplete) {
        limitSeriesAmount(instance.chart.series.length, config.id);
      }
    }

    function isSlugExists(id, slug) {
      // check if exists already in series array
      var keep = true;
      $.each(instance.chart.series, function (k, v) {
        if (v.name.toLowerCase() === slug.toLowerCase()) {
          keep = false;
          return false;
        }
      });

      instance.legend.shake(id, slug);

      return keep;
    }

    function repositionLegendContainer() {
      var legendContainer = $('#' + config.id + '-legend-container');
      legendContainer.parent().css({ 'top': '0px' });
    }

    // Dependency function.
    // Update when components need to update each other.
    function update() {
      if (instance.changeIndicator) {
        instance.changeIndicator.update();
      }
    }

    this.renderChart = function (chartSettingsOverride) {
      instance = {
        id: config.id,
        chart: generateChartInstance(chartSettingsOverride),
        legend: generateLegendInstance(),
        autocomplete: generateAutocompleteInstance(),
        changeIndicator: generateChangeIndicator(),
        settings: generateSettingsInstance(),
        addSingleSeries: addSeries,
        removeSingleSeries: removeSeries,
        message: customMessage,
        isSlugExists: isSlugExists,
        noDataMessage: noDataMessage,
        fireMoneEvent: fireMoneEvent,
        update: update
      };

      // After init process

      if (config.range) {
        instance.range = generateRangeInstance();
      } else {
        $('#' + config.id + '-range-btns-container').empty();
      }

      if (config.changeIndicator) {
        instance.changeIndicator.render();
      }

      if (config.autocomplete) {
        repositionInputContainer();
      }

      if (config.legend && !config.range && !config.autocomplete && !chartSettingsOverride.rangeSelector.enabled) {
        repositionLegendContainer();
      }

      if (config.settings && config.settings.enabled) {
        instance.settings.render({instance: instance, config: config.settings.config});
      }

      return instance;
    };

    this.reflow = function() {
      w.Highcharts.charts.forEach(function (chart) {
        chart.reflow();
      });
    };

    function init() {
      chartContainer = config.id + '-chart-container';

      var $section;

      if (!$('#' + chartContainer).length && ($section = $('#' + config.id)).length) {
        $section.append(w.JST['jst/widgets/sacharts/chart_layout_wide']({
          chartId: config.id,
          keyIcon: w.JST['jst/inline_svg/key']({ width: 24 }),
          bottomComment: config.bottomComment,
          sectionTitle: config.title,
          shrink: config.title === '' ? 'shrink' : '',
          style: config.addCss ? ' style="' + config.addCss + '"' : ''
        })).removeClass('hide hidden');
      }
    }

    init();
  };

}(window, window.SA, window.jQuery));
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/sacharts/legend_item"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('');  jQuery.each(data, function (index) { ; __p.push('\n  ');  var multiple = (this.id.indexOf('MULTIPLE') > 0) ? 'multiple' : null ; __p.push('\n  <div class="legend-box ',  multiple ,'" data-id="',  this.id ,'">\n    ');  if (this.kpiDashboard) { ; __p.push('\n        ',  JST['jst/widgets/sacharts/kpi_legend_item']({data: this, multiple: multiple, index: index}) ,'\n    ');  } else {  ; __p.push('\n        ',  JST['jst/widgets/sacharts/standard_legend_item']({data: this, index: index}) ,'\n    ');  } ; __p.push('\n  </div>\n');  }); ; __p.push('\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/sacharts/kpi_legend_item"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div class="info-row ',  multiple ,'">\n  ');  if (multiple) { ; __p.push('\n    <div class="legend-tile multiple" style="border-left:2px solid ',  data.color ,';">',  data.kpiDashboard[index].data.label ,'</div>\n  ');  } ; __p.push('\n  <div class="legend-tile">Current</div>\n  <div class="legend-tile">Last month</div>\n  <div class="legend-tile">Rank (of ',  data.kpiDashboard[index].services ,' services)</div>\n  <div class="legend-tile">\n    <span data-ticker-text="',  data.id ,'" >',  data.value ,'</span>\n    <span class="',  data.hideDelta ,'" data-ticker-delta="',  data.id ,'" style="color:',  data.deltaColor ,'">',  data.delta ,'</span>\n  </div>\n  <div class="legend-tile"><span data-prev-text="',  data.id ,'" >',  data.prev ,'</span></div>\n  <div class="legend-tile"><span>',  data.kpiDashboard[index].data.rank ,'</span></div>\n</div>\n<div>&nbsp;</div>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/sacharts/standard_legend_item"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div class="text-container box-small" style="border-left-color:',  data.color ,';">\n  <div class="',  index != 0 && data.enableCloseBtn ? 'col-xs-10' : 'col-xs-12' ,'">\n    <div class="slug">',  data.id ,'<span class="ticker-value" id="',  data.id.split(' ').join('_') ,'-value" data-ticker-text="',  data.id ,'">',  data.value ,'</span></div>\n    <div class="text-muted">\n      <span class="title-text">',  data.title ,'</span>\n      <span class="ticker-indicator" id="',  data.chartId ,'-',  data.id.split(' ').join('_') ,'-indicator"></span>\n    </div>\n  </div>\n  ');  if (index != 0 && data.enableCloseBtn) { ; __p.push('\n    <div class="col-xs-2">\n      <div class="btn-container box-small" data-id="',  data.id ,'">\n        <div type="button" class="svg">\n          <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="8 0 8 24" style="fill:#555555"><path d="M12 2c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0-2c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6 16.538l-4.592-4.548 4.546-4.587-1.416-1.403-4.545 4.589-4.588-4.543-1.405 1.405 4.593 4.552-4.547 4.592 1.405 1.405 4.555-4.596 4.591 4.55 1.403-1.416z"/></svg>\n        </div>\n      </div>\n    </div>\n  ');  }; ; __p.push('\n</div>\n');}return __p.join('');};
}).call(this);




(function (w, SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Widgets.SACharts');
  scope.Legend = function (opt) {
    var legend = opt.legend,
      formatter = SA.Utils.Formatter,
      title = opt.title,
      mouseClb = opt.mouseClb,
      tickersAmount;

    function update(id, data) {
      tickersAmount = data.length;
      var html = w.JST['jst/widgets/sacharts/legend_item']({data: data});
      $('#' + id + '-legend-container').html(html).removeClass('hide hidden')
    }

    function setKpiLegends(v, value) {
      var preVvalue = '-', delta = 0, deltaColor = '', hideDelta = 'hidden';

      if (v.points.length > 30) {
        preVvalue = (v.userOptions.compare === 'percent' && v.points.length) ? v.points[v.points.length - 31].change : v.yData[v.yData.length - 31];
        if (preVvalue !== null) {
          delta = value - preVvalue;
          hideDelta = '';
          deltaColor = 'green';
          if (delta < 0) {
            deltaColor = 'red'
          } else if (delta === 0) {
            hideDelta = 'hidden';
          }
          delta = Math.abs(delta);
        }
      }
      return {preVvalue: preVvalue, delta: delta, deltaColor: deltaColor, hideDelta: hideDelta};
    }

    function attachEvents(id, clb) {
      var legendItem = $('#' + id + '-legend-container').find('.legend-box');
      $.each(legendItem, function (k, v) {
        var item = $(v);
        item.mouseenter('mouseover', function () {
          mouseClb('mouseover', item.data('id'));
        });
        item.mouseleave('mouseout', function () {
          mouseClb('mouseout', item.data('id'));
        });
      });

      if (legend.enableCloseBtn) {
        var btnItem = $('#' + id + '-legend-container').find('.btn-container');
        $.each(btnItem, function (k, v) {
          var item = $(v);
          item.one('click', function () {
            // configuration callback to extend close button functionality.
            clb(id, item.data('id'));
            // internal callback to remove series;
            mouseClb('click', item.data('id'));
          });
        });
      }
    }

    this.tickersAmount = function () {
      return tickersAmount;
    };

    this.shake = function (id, slug) {
      var interval = 50,
        distance = 5,
        times = 5,
        item;

      item = $('#' + id + '-legend-container').find("[data-id='" + slug + "']");

      item.css('position', 'relative');

      for (var iter = 0; iter < (times + 1); iter++) {
        item.animate({left: ((iter % 2 === 0 ? distance : distance * -1))}, interval);
      }
      item.animate({left: 0}, interval);
    };

    this.render = function (ref) {
      var value, format, data = [];
      var kpiLegend = {preVvalue: '-', delta: 0, deltaColor: '', hideDelta: 'hidden'};

      $.each(ref.chart.series, function (k, v) {
        if (v.name === 'Navigator 1' || legend.excludeSeriesById && $.inArray(v.userOptions.id, legend.excludeSeriesById) > -1) {
          return;
        }

        value = (v.userOptions.compare === 'percent' && v.points.length) ? v.points[v.points.length - 1].change : v.yData[v.yData.length - 1];
        if (legend.kpiDashboard) {
          kpiLegend = setKpiLegends(v, value);
        }
        format = v.userOptions.legendOverrideFormat ? $.extend(legend.format, v.userOptions.legendOverrideFormat) : legend.format;

        data.push({
          id: v.userOptions.name.toUpperCase(),
          title: v.userOptions.title || title,
          color: v.color,
          value: formatter.number(value, format),
          chartId: ref.id,
          enableCloseBtn: legend.enableCloseBtn,
          deltaColor: kpiLegend.deltaColor,
          prev: formatter.number(kpiLegend.preVvalue, format),
          delta: (kpiLegend.deltaColor === 'green' ? ' &and; ' : ' &or; ') + formatter.number(kpiLegend.delta, format),
          hideDelta : kpiLegend.hideDelta,
          kpiDashboard: legend.kpiDashboard
        });
      });

      update(ref.id, data);
      attachEvents(ref.id, legend.clb);
      ref.update();
    };
  };

})(window, window.SA, window.jQuery);
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/sacharts/range_item"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('');  buttons.forEach(function (btn) { ; __p.push('\n  <button range-type="',  btn.id ,'" range-reversed="',  btn.reversed ,'" mone="',  btn.mone ,'" class="range-btn',  btn.cssClass ,'" disabled="disabled">',  btn.label ,'</button>\n');  }); ; __p.push('\n');}return __p.join('');};
}).call(this);



(function (w, SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Widgets.SACharts');

  scope.Range = function (opt) {
    var config = opt || {};
    var $container, $buttons;
    var MONE_RANGE_BTN = 'range_btn';
    var DAY = 24 * 60 * 60 * 1000;
    var $selectedBtn = null;

    this.afterAddSeries = function (chart) {
      if (isValid() && !chart.series[0].userOptions.settingUpdate) {
        config.chart = chart;
        $.each($buttons, function (i, $elem) {
          if ($($elem).hasClass('selected')) {
            $selectedBtn = $($elem);
            updateExtremes($selectedBtn);
            toggleLoading(false);
            return false;
          }
        });
      }
    };

    //remove the selected class from button when manually dragging the navigator
    this.onSetExtremes = function (e) {
      if (e.triggerOp === "navigator-drag") {
        $selectedBtn.removeClass('selected');
      }
    }

    function isValid() {
      return config.id && config.range && Object.keys(config.range.buttons || {}).length;
    }

    function render() {
      var lockKey = w.JST['jst/inline_svg/key']({width: 20});
      $container
        .html(w.JST['jst/widgets/sacharts/range_item']({
          buttons: $.map(config.range.buttons, function (d, k) {
            return {
              id: k,
              reversed: !!d.reversed,
              cssClass: d.enabled ? (d.selected ? ' selected' : '') : ' disabled',
              label: d.label + (d.enabled ? '' : lockKey),
              mone: d.mone
            };
          })
        }))
        .removeClass('hide hidden');
    }

    function updateExtremes($btn) {
      var extremesX = config.chart.xAxis[0].getExtremes(),
        period = $btn.attr('range-type').split('-'),
        multi = 0, amount = parseInt(period[2]);

      if (period[3] === 'all') {
        multi = 480 * 30;
        amount = 1;
      } else if (period[3] === 'y') {
        multi = 12 * 30;
      } else if (period[3] === 'm') {
        multi = 30;
      } else if (period[3] === 'q') {
        multi = 3 * 30;
      }

      var delta = amount * multi * DAY;
      if ($btn.attr('range-reversed') === 'true') {
        config.chart.xAxis[0].setExtremes(extremesX.dataMin, extremesX.dataMin + delta);
      } else {
        config.chart.xAxis[0].setExtremes(extremesX.dataMax - delta, extremesX.dataMax);
      }
    }

    function events() {
      $buttons.on('click', function (e) {
        var $btn = $(e.currentTarget);
        if (!$btn.hasClass('selected'))
          makeClick($btn);
        });
    }

    function makeClick($btn) {
      if (!$btn.hasClass('disabled')) {
        updateExtremes($btn);
        setSelected($btn);
      } else {
        config.handleSubscribeClick();
      }

      config.fireMoneEvent(MONE_RANGE_BTN, $btn.attr('mone'), $btn.hasClass('disabled'));
    }

    function setSelected($btn) {
      toggleLoading(true);
      $selectedBtn.removeClass('selected');
      $selectedBtn = $btn;
      $selectedBtn.addClass('selected');
      toggleLoading(false);
    }

    function toggleLoading(isLoading) {
      $buttons.prop('disabled', isLoading);
      if (config.chart) {
        if (isLoading) {
          exec(config.chart.showLoading());
        } else {
          exec(config.chart.hideLoading());
        }
      }
    }

    function exec(method) {
      if ($.isFunction(method)) {
        method();
      }
    }

    function init() {
      if (isValid()) {
        $container = $('#' + config.id + '-range-btns-container');
        render();

        $buttons = $container.find('.range-btn');
        events();
      }
    }

    init();
  };

})(window, window.SA, window.jQuery);
(function (w, SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Widgets.SACharts');
  scope.ChangeIndicator = function (opt) {

    var config = opt, changeObject = [];

    function findClosestNumber(target, data) {
      var goal = Math.round(target);
      var closest = data.reduce(function (prev, curr) {
        return (Math.abs(curr - goal) < Math.abs(prev - goal) ? curr : prev);
      });

      return data.indexOf(closest);
    }

    function calcChange(slug, minValue, maxValue) {
      var ratio, value, direction;

      ratio = maxValue / minValue;

      if (maxValue > 0 && minValue > 0) {
        value = 100 * (ratio - 1);
        direction = (ratio < 1) ? 'down' : 'up';
      } else if (maxValue < 0 && minValue < 0) {
        value = -100 * (ratio - 1);
        direction = (ratio > 1) ? 'down' : 'up';
      } else {
        value = null;
        direction = null;
      }

      changeObject[slug] = $.extend({}, changeObject[slug], { value: SA.Utils.Formatter.number(value, { decimals: 2, suffix: '%', withCommas: true }), direction: direction });
    }

    this.setValue = function (data) {
      var minValue, maxValue, minIndex, maxIndex;
      if (data && data.min && data.max && data.target.series) {
        $.each(data.target.series, function (k, v) {
          if (v.xData.length > 0) {
            minIndex = findClosestNumber(data.min, v.xData);
            maxIndex = findClosestNumber(data.max, v.xData);

            minValue = v.yData[minIndex];
            maxValue = v.yData[maxIndex];

            calcChange(v.name.toUpperCase(), minValue, maxValue);
          }
        });

        this.update();
      }
    };

    this.update = function () {
      var txt, v;
      Object.keys(changeObject).forEach(function (k) {
        v = changeObject[k];
        if (v.value) {
          txt = parseFloat(v.value) > 0 ? '+' + v.value : v.value;
          $('#' + v.key).removeClass('up down').addClass(v.direction).html(txt);
        }
      });
    };

    this.render = function (slug, key) {
      slug = slug || config.slug;
      key = key || config.key;

      changeObject[slug] = $.extend({}, changeObject[slug], { key: key });
    };

    this.getObject = function () {
      return changeObject;
    }
  };
})(window, window.SA, window.jQuery);
/**
 * @version: 3.0.3
 * @author: Dan Grossman http://www.dangrossman.info/
 * @copyright: Copyright (c) 2012-2018 Dan Grossman. All rights reserved.
 * @license: Licensed under the MIT license. See http://www.opensource.org/licenses/mit-license.php
 * @website: http://www.daterangepicker.com/
 */
// Following the UMD template https://github.com/umdjs/umd/blob/master/templates/returnExportsGlobal.js
(function (root, factory) {
  if (typeof define === 'function' && define.amd) {
    // AMD. Make globaly available as well
    define(['moment', 'jquery'], function (moment, jquery) {
      if (!jquery.fn) jquery.fn = {}; // webpack server rendering
      if (typeof moment !== 'function' && moment.default) moment = moment.default
      return factory(moment, jquery);
    });
  } else if (typeof module === 'object' && module.exports) {
    // Node / Browserify
    //isomorphic issue
    var jQuery = (typeof window != 'undefined') ? window.jQuery : undefined;
    if (!jQuery) {
      jQuery = require('jquery');
      if (!jQuery.fn) jQuery.fn = {};
    }
    var moment = (typeof window != 'undefined' && typeof window.moment != 'undefined') ? window.moment : require('moment');
    module.exports = factory(moment, jQuery);
  } else {
    // Browser globals
    root.daterangepicker = factory(root.moment, root.jQuery);
  }
}(this, function(moment, $) {
  var DateRangePicker = function(element, options, cb) {

    //default settings for options
    this.parentEl = 'body';
    this.element = $(element);
    this.startDate = moment().startOf('day');
    this.endDate = moment().endOf('day');
    this.minDate = false;
    this.maxDate = false;
    this.maxSpan = false;
    this.autoApply = false;
    this.singleDatePicker = false;
    this.showDropdowns = false;
    this.minYear = moment().subtract(100, 'year').format('YYYY');
    this.maxYear = moment().add(100, 'year').format('YYYY');
    this.showWeekNumbers = false;
    this.showISOWeekNumbers = false;
    this.showCustomRangeLabel = true;
    this.timePicker = false;
    this.timePicker24Hour = false;
    this.timePickerIncrement = 1;
    this.timePickerSeconds = false;
    this.linkedCalendars = true;
    this.autoUpdateInput = true;
    this.alwaysShowCalendars = false;
    this.ranges = {};

    this.opens = 'right';
    if (this.element.hasClass('pull-right'))
      this.opens = 'left';

    this.drops = 'down';
    if (this.element.hasClass('dropup'))
      this.drops = 'up';

    this.buttonClasses = 'btn btn-sm';
    this.applyButtonClasses = 'btn-primary';
    this.cancelButtonClasses = 'btn-default';

    this.locale = {
      direction: 'ltr',
      format: moment.localeData().longDateFormat('L'),
      separator: ' - ',
      applyLabel: 'Apply',
      cancelLabel: 'Cancel',
      weekLabel: 'W',
      customRangeLabel: 'Custom Range',
      daysOfWeek: moment.weekdaysMin(),
      monthNames: moment.monthsShort(),
      firstDay: moment.localeData().firstDayOfWeek()
    };

    this.callback = function() { };

    //some state information
    this.isShowing = false;
    this.leftCalendar = {};
    this.rightCalendar = {};

    //custom options from user
    if (typeof options !== 'object' || options === null)
      options = {};

    //allow setting options with data attributes
    //data-api options will be overwritten with custom javascript options
    options = $.extend(this.element.data(), options);

    //html template for the picker UI
    if (typeof options.template !== 'string' && !(options.template instanceof $))
      options.template =
        '<div class="daterangepicker">' +
        '<div class="ranges"></div>' +
        '<div class="drp-calendar left">' +
        '<div class="calendar-table"></div>' +
        '<div class="calendar-time"></div>' +
        '</div>' +
        '<div class="drp-calendar right">' +
        '<div class="calendar-table"></div>' +
        '<div class="calendar-time"></div>' +
        '</div>' +
        '<div class="drp-buttons">' +
        '<span class="drp-selected"></span>' +
        '<button class="cancelBtn" type="button"></button>' +
        '<button class="applyBtn" disabled="disabled" type="button"></button> ' +
        '</div>' +
        '</div>';

    this.parentEl = (options.parentEl && $(options.parentEl).length) ? $(options.parentEl) : $(this.parentEl);
    this.container = $(options.template).appendTo(this.parentEl);

    //
    // handle all the possible options overriding defaults
    //

    if (typeof options.locale === 'object') {

      if (typeof options.locale.direction === 'string')
        this.locale.direction = options.locale.direction;

      if (typeof options.locale.format === 'string')
        this.locale.format = options.locale.format;

      if (typeof options.locale.separator === 'string')
        this.locale.separator = options.locale.separator;

      if (typeof options.locale.daysOfWeek === 'object')
        this.locale.daysOfWeek = options.locale.daysOfWeek.slice();

      if (typeof options.locale.monthNames === 'object')
        this.locale.monthNames = options.locale.monthNames.slice();

      if (typeof options.locale.firstDay === 'number')
        this.locale.firstDay = options.locale.firstDay;

      if (typeof options.locale.applyLabel === 'string')
        this.locale.applyLabel = options.locale.applyLabel;

      if (typeof options.locale.cancelLabel === 'string')
        this.locale.cancelLabel = options.locale.cancelLabel;

      if (typeof options.locale.weekLabel === 'string')
        this.locale.weekLabel = options.locale.weekLabel;

      if (typeof options.locale.customRangeLabel === 'string'){
        //Support unicode chars in the custom range name.
        var elem = document.createElement('textarea');
        elem.innerHTML = options.locale.customRangeLabel;
        var rangeHtml = elem.value;
        this.locale.customRangeLabel = rangeHtml;
      }
    }
    this.container.addClass(this.locale.direction);

    if (typeof options.startDate === 'string')
      this.startDate = moment(options.startDate, this.locale.format);

    if (typeof options.endDate === 'string')
      this.endDate = moment(options.endDate, this.locale.format);

    if (typeof options.minDate === 'string')
      this.minDate = moment(options.minDate, this.locale.format);

    if (typeof options.maxDate === 'string')
      this.maxDate = moment(options.maxDate, this.locale.format);

    if (typeof options.startDate === 'object')
      this.startDate = moment(options.startDate);

    if (typeof options.endDate === 'object')
      this.endDate = moment(options.endDate);

    if (typeof options.minDate === 'object')
      this.minDate = moment(options.minDate);

    if (typeof options.maxDate === 'object')
      this.maxDate = moment(options.maxDate);

    // sanity check for bad options
    if (this.minDate && this.startDate.isBefore(this.minDate))
      this.startDate = this.minDate.clone();

    // sanity check for bad options
    if (this.maxDate && this.endDate.isAfter(this.maxDate))
      this.endDate = this.maxDate.clone();

    if (typeof options.applyButtonClasses === 'string')
      this.applyButtonClasses = options.applyButtonClasses;

    if (typeof options.applyClass === 'string') //backwards compat
      this.applyButtonClasses = options.applyClass;

    if (typeof options.cancelButtonClasses === 'string')
      this.cancelButtonClasses = options.cancelButtonClasses;

    if (typeof options.cancelClass === 'string') //backwards compat
      this.cancelButtonClasses = options.cancelClass;

    if (typeof options.maxSpan === 'object')
      this.maxSpan = options.maxSpan;

    if (typeof options.dateLimit === 'object') //backwards compat
      this.maxSpan = options.dateLimit;

    if (typeof options.opens === 'string')
      this.opens = options.opens;

    if (typeof options.drops === 'string')
      this.drops = options.drops;

    if (typeof options.showWeekNumbers === 'boolean')
      this.showWeekNumbers = options.showWeekNumbers;

    if (typeof options.showISOWeekNumbers === 'boolean')
      this.showISOWeekNumbers = options.showISOWeekNumbers;

    if (typeof options.buttonClasses === 'string')
      this.buttonClasses = options.buttonClasses;

    if (typeof options.buttonClasses === 'object')
      this.buttonClasses = options.buttonClasses.join(' ');

    if (typeof options.showDropdowns === 'boolean')
      this.showDropdowns = options.showDropdowns;

    if (typeof options.minYear === 'number')
      this.minYear = options.minYear;

    if (typeof options.maxYear === 'number')
      this.maxYear = options.maxYear;

    if (typeof options.showCustomRangeLabel === 'boolean')
      this.showCustomRangeLabel = options.showCustomRangeLabel;

    if (typeof options.singleDatePicker === 'boolean') {
      this.singleDatePicker = options.singleDatePicker;
      if (this.singleDatePicker)
        this.endDate = this.startDate.clone();
    }

    if (typeof options.timePicker === 'boolean')
      this.timePicker = options.timePicker;

    if (typeof options.timePickerSeconds === 'boolean')
      this.timePickerSeconds = options.timePickerSeconds;

    if (typeof options.timePickerIncrement === 'number')
      this.timePickerIncrement = options.timePickerIncrement;

    if (typeof options.timePicker24Hour === 'boolean')
      this.timePicker24Hour = options.timePicker24Hour;

    if (typeof options.autoApply === 'boolean')
      this.autoApply = options.autoApply;

    if (typeof options.autoUpdateInput === 'boolean')
      this.autoUpdateInput = options.autoUpdateInput;

    if (typeof options.linkedCalendars === 'boolean')
      this.linkedCalendars = options.linkedCalendars;

    if (typeof options.isInvalidDate === 'function')
      this.isInvalidDate = options.isInvalidDate;

    if (typeof options.isCustomDate === 'function')
      this.isCustomDate = options.isCustomDate;

    if (typeof options.alwaysShowCalendars === 'boolean')
      this.alwaysShowCalendars = options.alwaysShowCalendars;

    // update day names order to firstDay
    if (this.locale.firstDay != 0) {
      var iterator = this.locale.firstDay;
      while (iterator > 0) {
        this.locale.daysOfWeek.push(this.locale.daysOfWeek.shift());
        iterator--;
      }
    }

    var start, end, range;

    //if no start/end dates set, check if an input element contains initial values
    if (typeof options.startDate === 'undefined' && typeof options.endDate === 'undefined') {
      if ($(this.element).is(':text')) {
        var val = $(this.element).val(),
          split = val.split(this.locale.separator);

        start = end = null;

        if (split.length == 2) {
          start = moment(split[0], this.locale.format);
          end = moment(split[1], this.locale.format);
        } else if (this.singleDatePicker && val !== "") {
          start = moment(val, this.locale.format);
          end = moment(val, this.locale.format);
        }
        if (start !== null && end !== null) {
          this.setStartDate(start);
          this.setEndDate(end);
        }
      }
    }

    if (typeof options.ranges === 'object') {
      for (range in options.ranges) {

        if (typeof options.ranges[range][0] === 'string')
          start = moment(options.ranges[range][0], this.locale.format);
        else
          start = moment(options.ranges[range][0]);

        if (typeof options.ranges[range][1] === 'string')
          end = moment(options.ranges[range][1], this.locale.format);
        else
          end = moment(options.ranges[range][1]);

        // If the start or end date exceed those allowed by the minDate or maxSpan
        // options, shorten the range to the allowable period.
        if (this.minDate && start.isBefore(this.minDate))
          start = this.minDate.clone();

        var maxDate = this.maxDate;
        if (this.maxSpan && maxDate && start.clone().add(this.maxSpan).isAfter(maxDate))
          maxDate = start.clone().add(this.maxSpan);
        if (maxDate && end.isAfter(maxDate))
          end = maxDate.clone();

        // If the end of the range is before the minimum or the start of the range is
        // after the maximum, don't display this range option at all.
        if ((this.minDate && end.isBefore(this.minDate, this.timepicker ? 'minute' : 'day'))
          || (maxDate && start.isAfter(maxDate, this.timepicker ? 'minute' : 'day')))
          continue;

        //Support unicode chars in the range names.
        var elem = document.createElement('textarea');
        elem.innerHTML = range;
        var rangeHtml = elem.value;

        this.ranges[rangeHtml] = [start, end];
      }

      var list = '<ul>';
      for (range in this.ranges) {
        list += '<li data-range-key="' + range + '">' + range + '</li>';
      }
      if (this.showCustomRangeLabel) {
        list += '<li data-range-key="' + this.locale.customRangeLabel + '">' + this.locale.customRangeLabel + '</li>';
      }
      list += '</ul>';
      this.container.find('.ranges').prepend(list);
    }

    if (typeof cb === 'function') {
      this.callback = cb;
    }

    if (!this.timePicker) {
      this.startDate = this.startDate.startOf('day');
      this.endDate = this.endDate.endOf('day');
      this.container.find('.calendar-time').hide();
    }

    //can't be used together for now
    if (this.timePicker && this.autoApply)
      this.autoApply = false;

    if (this.autoApply) {
      this.container.addClass('auto-apply');
    }

    if (typeof options.ranges === 'object')
      this.container.addClass('show-ranges');

    if (this.singleDatePicker) {
      this.container.addClass('single');
      this.container.find('.drp-calendar.left').addClass('single');
      this.container.find('.drp-calendar.left').show();
      this.container.find('.drp-calendar.right').hide();
      if (!this.timePicker) {
        this.container.addClass('auto-apply');
      }
    }

    if ((typeof options.ranges === 'undefined' && !this.singleDatePicker) || this.alwaysShowCalendars) {
      this.container.addClass('show-calendar');
    }

    this.container.addClass('opens' + this.opens);

    //apply CSS classes and labels to buttons
    this.container.find('.applyBtn, .cancelBtn').addClass(this.buttonClasses);
    if (this.applyButtonClasses.length)
      this.container.find('.applyBtn').addClass(this.applyButtonClasses);
    if (this.cancelButtonClasses.length)
      this.container.find('.cancelBtn').addClass(this.cancelButtonClasses);
    this.container.find('.applyBtn').html(this.locale.applyLabel);
    this.container.find('.cancelBtn').html(this.locale.cancelLabel);

    //
    // event listeners
    //

    this.container.find('.drp-calendar')
      .on('click.daterangepicker', '.prev', $.proxy(this.clickPrev, this))
      .on('click.daterangepicker', '.next', $.proxy(this.clickNext, this))
      .on('mousedown.daterangepicker', 'td.available', $.proxy(this.clickDate, this))
      .on('mouseenter.daterangepicker', 'td.available', $.proxy(this.hoverDate, this))
      .on('change.daterangepicker', 'select.yearselect', $.proxy(this.monthOrYearChanged, this))
      .on('change.daterangepicker', 'select.monthselect', $.proxy(this.monthOrYearChanged, this))
      .on('change.daterangepicker', 'select.hourselect,select.minuteselect,select.secondselect,select.ampmselect', $.proxy(this.timeChanged, this))

    this.container.find('.ranges')
      .on('click.daterangepicker', 'li', $.proxy(this.clickRange, this))

    this.container.find('.drp-buttons')
      .on('click.daterangepicker', 'button.applyBtn', $.proxy(this.clickApply, this))
      .on('click.daterangepicker', 'button.cancelBtn', $.proxy(this.clickCancel, this))

    if (this.element.is('input') || this.element.is('button')) {
      this.element.on({
        'click.daterangepicker': $.proxy(this.show, this),
        'focus.daterangepicker': $.proxy(this.show, this),
        'keyup.daterangepicker': $.proxy(this.elementChanged, this),
        'keydown.daterangepicker': $.proxy(this.keydown, this) //IE 11 compatibility
      });
    } else {
      this.element.on('click.daterangepicker', $.proxy(this.toggle, this));
      this.element.on('keydown.daterangepicker', $.proxy(this.toggle, this));
    }

    //
    // if attached to a text input, set the initial value
    //

    this.updateElement();

  };

  DateRangePicker.prototype = {

    constructor: DateRangePicker,

    setStartDate: function(startDate) {
      if (typeof startDate === 'string')
        this.startDate = moment(startDate, this.locale.format);

      if (typeof startDate === 'object')
        this.startDate = moment(startDate);

      if (!this.timePicker)
        this.startDate = this.startDate.startOf('day');

      if (this.timePicker && this.timePickerIncrement)
        this.startDate.minute(Math.round(this.startDate.minute() / this.timePickerIncrement) * this.timePickerIncrement);

      if (this.minDate && this.startDate.isBefore(this.minDate)) {
        this.startDate = this.minDate.clone();
        if (this.timePicker && this.timePickerIncrement)
          this.startDate.minute(Math.round(this.startDate.minute() / this.timePickerIncrement) * this.timePickerIncrement);
      }

      if (this.maxDate && this.startDate.isAfter(this.maxDate)) {
        this.startDate = this.maxDate.clone();
        if (this.timePicker && this.timePickerIncrement)
          this.startDate.minute(Math.floor(this.startDate.minute() / this.timePickerIncrement) * this.timePickerIncrement);
      }

      if (!this.isShowing)
        this.updateElement();

      this.updateMonthsInView();
    },

    setEndDate: function(endDate) {
      if (typeof endDate === 'string')
        this.endDate = moment(endDate, this.locale.format);

      if (typeof endDate === 'object')
        this.endDate = moment(endDate);

      if (!this.timePicker)
        this.endDate = this.endDate.add(1,'d').startOf('day').subtract(1,'second');

      if (this.timePicker && this.timePickerIncrement)
        this.endDate.minute(Math.round(this.endDate.minute() / this.timePickerIncrement) * this.timePickerIncrement);

      if (this.endDate.isBefore(this.startDate))
        this.endDate = this.startDate.clone();

      if (this.maxDate && this.endDate.isAfter(this.maxDate))
        this.endDate = this.maxDate.clone();

      if (this.maxSpan && this.startDate.clone().add(this.maxSpan).isBefore(this.endDate))
        this.endDate = this.startDate.clone().add(this.maxSpan);

      this.previousRightTime = this.endDate.clone();

      this.container.find('.drp-selected').html(this.startDate.format(this.locale.format) + this.locale.separator + this.endDate.format(this.locale.format));

      if (!this.isShowing)
        this.updateElement();

      this.updateMonthsInView();
    },

    isInvalidDate: function() {
      return false;
    },

    isCustomDate: function() {
      return false;
    },

    updateView: function() {
      if (this.timePicker) {
        this.renderTimePicker('left');
        this.renderTimePicker('right');
        if (!this.endDate) {
          this.container.find('.right .calendar-time select').attr('disabled', 'disabled').addClass('disabled');
        } else {
          this.container.find('.right .calendar-time select').removeAttr('disabled').removeClass('disabled');
        }
      }
      if (this.endDate)
        this.container.find('.drp-selected').html(this.startDate.format(this.locale.format) + this.locale.separator + this.endDate.format(this.locale.format));
      this.updateMonthsInView();
      this.updateCalendars();
      this.updateFormInputs();
    },

    updateMonthsInView: function() {
      if (this.endDate) {

        //if both dates are visible already, do nothing
        if (!this.singleDatePicker && this.leftCalendar.month && this.rightCalendar.month &&
          (this.startDate.format('YYYY-MM') == this.leftCalendar.month.format('YYYY-MM') || this.startDate.format('YYYY-MM') == this.rightCalendar.month.format('YYYY-MM'))
          &&
          (this.endDate.format('YYYY-MM') == this.leftCalendar.month.format('YYYY-MM') || this.endDate.format('YYYY-MM') == this.rightCalendar.month.format('YYYY-MM'))
        ) {
          return;
        }

        this.leftCalendar.month = this.startDate.clone().date(2);
        if (!this.linkedCalendars && (this.endDate.month() != this.startDate.month() || this.endDate.year() != this.startDate.year())) {
          this.rightCalendar.month = this.endDate.clone().date(2);
        } else {
          this.rightCalendar.month = this.startDate.clone().date(2).add(1, 'month');
        }

      } else {
        if (this.leftCalendar.month.format('YYYY-MM') != this.startDate.format('YYYY-MM') && this.rightCalendar.month.format('YYYY-MM') != this.startDate.format('YYYY-MM')) {
          this.leftCalendar.month = this.startDate.clone().date(2);
          this.rightCalendar.month = this.startDate.clone().date(2).add(1, 'month');
        }
      }
      if (this.maxDate && this.linkedCalendars && !this.singleDatePicker && this.rightCalendar.month > this.maxDate) {
        this.rightCalendar.month = this.maxDate.clone().date(2);
        this.leftCalendar.month = this.maxDate.clone().date(2).subtract(1, 'month');
      }
    },

    updateCalendars: function() {

      if (this.timePicker) {
        var hour, minute, second;
        if (this.endDate) {
          hour = parseInt(this.container.find('.left .hourselect').val(), 10);
          minute = parseInt(this.container.find('.left .minuteselect').val(), 10);
          second = this.timePickerSeconds ? parseInt(this.container.find('.left .secondselect').val(), 10) : 0;
          if (!this.timePicker24Hour) {
            var ampm = this.container.find('.left .ampmselect').val();
            if (ampm === 'PM' && hour < 12)
              hour += 12;
            if (ampm === 'AM' && hour === 12)
              hour = 0;
          }
        } else {
          hour = parseInt(this.container.find('.right .hourselect').val(), 10);
          minute = parseInt(this.container.find('.right .minuteselect').val(), 10);
          second = this.timePickerSeconds ? parseInt(this.container.find('.right .secondselect').val(), 10) : 0;
          if (!this.timePicker24Hour) {
            var ampm = this.container.find('.right .ampmselect').val();
            if (ampm === 'PM' && hour < 12)
              hour += 12;
            if (ampm === 'AM' && hour === 12)
              hour = 0;
          }
        }
        this.leftCalendar.month.hour(hour).minute(minute).second(second);
        this.rightCalendar.month.hour(hour).minute(minute).second(second);
      }

      this.renderCalendar('left');
      this.renderCalendar('right');

      //highlight any predefined range matching the current start and end dates
      this.container.find('.ranges li').removeClass('active');
      if (this.endDate == null) return;

      this.calculateChosenLabel();
    },

    renderCalendar: function(side) {

      //
      // Build the matrix of dates that will populate the calendar
      //

      var calendar = side == 'left' ? this.leftCalendar : this.rightCalendar;
      var month = calendar.month.month();
      var year = calendar.month.year();
      var hour = calendar.month.hour();
      var minute = calendar.month.minute();
      var second = calendar.month.second();
      var daysInMonth = moment([year, month]).daysInMonth();
      var firstDay = moment([year, month, 1]);
      var lastDay = moment([year, month, daysInMonth]);
      var lastMonth = moment(firstDay).subtract(1, 'month').month();
      var lastYear = moment(firstDay).subtract(1, 'month').year();
      var daysInLastMonth = moment([lastYear, lastMonth]).daysInMonth();
      var dayOfWeek = firstDay.day();

      //initialize a 6 rows x 7 columns array for the calendar
      var calendar = [];
      calendar.firstDay = firstDay;
      calendar.lastDay = lastDay;

      for (var i = 0; i < 6; i++) {
        calendar[i] = [];
      }

      //populate the calendar with date objects
      var startDay = daysInLastMonth - dayOfWeek + this.locale.firstDay + 1;
      if (startDay > daysInLastMonth)
        startDay -= 7;

      if (dayOfWeek == this.locale.firstDay)
        startDay = daysInLastMonth - 6;

      var curDate = moment([lastYear, lastMonth, startDay, 12, minute, second]);

      var col, row;
      for (var i = 0, col = 0, row = 0; i < 42; i++, col++, curDate = moment(curDate).add(24, 'hour')) {
        if (i > 0 && col % 7 === 0) {
          col = 0;
          row++;
        }
        calendar[row][col] = curDate.clone().hour(hour).minute(minute).second(second);
        curDate.hour(12);

        if (this.minDate && calendar[row][col].format('YYYY-MM-DD') == this.minDate.format('YYYY-MM-DD') && calendar[row][col].isBefore(this.minDate) && side == 'left') {
          calendar[row][col] = this.minDate.clone();
        }

        if (this.maxDate && calendar[row][col].format('YYYY-MM-DD') == this.maxDate.format('YYYY-MM-DD') && calendar[row][col].isAfter(this.maxDate) && side == 'right') {
          calendar[row][col] = this.maxDate.clone();
        }

      }

      //make the calendar object available to hoverDate/clickDate
      if (side == 'left') {
        this.leftCalendar.calendar = calendar;
      } else {
        this.rightCalendar.calendar = calendar;
      }

      //
      // Display the calendar
      //

      var minDate = side == 'left' ? this.minDate : this.startDate;
      var maxDate = this.maxDate;
      var selected = side == 'left' ? this.startDate : this.endDate;
      var arrow = this.locale.direction == 'ltr' ? {left: 'chevron-left', right: 'chevron-right'} : {left: 'chevron-right', right: 'chevron-left'};

      var html = '<table class="table-condensed">';
      html += '<thead>';
      html += '<tr>';

      // add empty cell for week number
      if (this.showWeekNumbers || this.showISOWeekNumbers)
        html += '<th></th>';

      if ((!minDate || minDate.isBefore(calendar.firstDay)) && (!this.linkedCalendars || side == 'left')) {
        html += '<th class="prev available"><span></span></th>';
      } else {
        html += '<th></th>';
      }

      var dateHtml = this.locale.monthNames[calendar[1][1].month()] + calendar[1][1].format(" YYYY");

      if (this.showDropdowns) {
        var currentMonth = calendar[1][1].month();
        var currentYear = calendar[1][1].year();
        var maxYear = (maxDate && maxDate.year()) || (this.maxYear);
        var minYear = (minDate && minDate.year()) || (this.minYear);
        var inMinYear = currentYear == minYear;
        var inMaxYear = currentYear == maxYear;

        var monthHtml = '<select class="monthselect">';
        for (var m = 0; m < 12; m++) {
          if ((!inMinYear || m >= minDate.month()) && (!inMaxYear || m <= maxDate.month())) {
            monthHtml += "<option value='" + m + "'" +
              (m === currentMonth ? " selected='selected'" : "") +
              ">" + this.locale.monthNames[m] + "</option>";
          } else {
            monthHtml += "<option value='" + m + "'" +
              (m === currentMonth ? " selected='selected'" : "") +
              " disabled='disabled'>" + this.locale.monthNames[m] + "</option>";
          }
        }
        monthHtml += "</select>";

        var yearHtml = '<select class="yearselect">';
        for (var y = minYear; y <= maxYear; y++) {
          yearHtml += '<option value="' + y + '"' +
            (y === currentYear ? ' selected="selected"' : '') +
            '>' + y + '</option>';
        }
        yearHtml += '</select>';

        dateHtml = monthHtml + yearHtml;
      }

      html += '<th colspan="5" class="month">' + dateHtml + '</th>';
      if ((!maxDate || maxDate.isAfter(calendar.lastDay)) && (!this.linkedCalendars || side == 'right' || this.singleDatePicker)) {
        html += '<th class="next available"><span></span></th>';
      } else {
        html += '<th></th>';
      }

      html += '</tr>';
      html += '<tr>';

      // add week number label
      if (this.showWeekNumbers || this.showISOWeekNumbers)
        html += '<th class="week">' + this.locale.weekLabel + '</th>';

      $.each(this.locale.daysOfWeek, function(index, dayOfWeek) {
        html += '<th>' + dayOfWeek + '</th>';
      });

      html += '</tr>';
      html += '</thead>';
      html += '<tbody>';

      //adjust maxDate to reflect the maxSpan setting in order to
      //grey out end dates beyond the maxSpan
      if (this.endDate == null && this.maxSpan) {
        var maxLimit = this.startDate.clone().add(this.maxSpan).endOf('day');
        if (!maxDate || maxLimit.isBefore(maxDate)) {
          maxDate = maxLimit;
        }
      }

      for (var row = 0; row < 6; row++) {
        html += '<tr>';

        // add week number
        if (this.showWeekNumbers)
          html += '<td class="week">' + calendar[row][0].week() + '</td>';
        else if (this.showISOWeekNumbers)
          html += '<td class="week">' + calendar[row][0].isoWeek() + '</td>';

        for (var col = 0; col < 7; col++) {

          var classes = [];

          //highlight today's date
          if (calendar[row][col].isSame(new Date(), "day"))
            classes.push('today');

          //highlight weekends
          if (calendar[row][col].isoWeekday() > 5)
            classes.push('weekend');

          //grey out the dates in other months displayed at beginning and end of this calendar
          if (calendar[row][col].month() != calendar[1][1].month())
            classes.push('off');

          //don't allow selection of dates before the minimum date
          if (this.minDate && calendar[row][col].isBefore(this.minDate, 'day'))
            classes.push('off', 'disabled');

          //don't allow selection of dates after the maximum date
          if (maxDate && calendar[row][col].isAfter(maxDate, 'day'))
            classes.push('off', 'disabled');

          //don't allow selection of date if a custom function decides it's invalid
          if (this.isInvalidDate(calendar[row][col]))
            classes.push('off', 'disabled');

          //highlight the currently selected start date
          if (calendar[row][col].format('YYYY-MM-DD') == this.startDate.format('YYYY-MM-DD'))
            classes.push('active', 'start-date');

          //highlight the currently selected end date
          if (this.endDate != null && calendar[row][col].format('YYYY-MM-DD') == this.endDate.format('YYYY-MM-DD'))
            classes.push('active', 'end-date');

          //highlight dates in-between the selected dates
          if (this.endDate != null && calendar[row][col] > this.startDate && calendar[row][col] < this.endDate)
            classes.push('in-range');

          //apply custom classes for this date
          var isCustom = this.isCustomDate(calendar[row][col]);
          if (isCustom !== false) {
            if (typeof isCustom === 'string')
              classes.push(isCustom);
            else
              Array.prototype.push.apply(classes, isCustom);
          }

          var cname = '', disabled = false;
          for (var i = 0; i < classes.length; i++) {
            cname += classes[i] + ' ';
            if (classes[i] == 'disabled')
              disabled = true;
          }
          if (!disabled)
            cname += 'available';

          html += '<td class="' + cname.replace(/^\s+|\s+$/g, '') + '" data-title="' + 'r' + row + 'c' + col + '">' + calendar[row][col].date() + '</td>';

        }
        html += '</tr>';
      }

      html += '</tbody>';
      html += '</table>';

      this.container.find('.drp-calendar.' + side + ' .calendar-table').html(html);

    },

    renderTimePicker: function(side) {

      // Don't bother updating the time picker if it's currently disabled
      // because an end date hasn't been clicked yet
      if (side == 'right' && !this.endDate) return;

      var html, selected, minDate, maxDate = this.maxDate;

      if (this.maxSpan && (!this.maxDate || this.startDate.clone().add(this.maxSpan).isAfter(this.maxDate)))
        maxDate = this.startDate.clone().add(this.maxSpan);

      if (side == 'left') {
        selected = this.startDate.clone();
        minDate = this.minDate;
      } else if (side == 'right') {
        selected = this.endDate.clone();
        minDate = this.startDate;

        //Preserve the time already selected
        var timeSelector = this.container.find('.drp-calendar.right .calendar-time');
        if (timeSelector.html() != '') {

          selected.hour(selected.hour() || timeSelector.find('.hourselect option:selected').val());
          selected.minute(selected.minute() || timeSelector.find('.minuteselect option:selected').val());
          selected.second(selected.second() || timeSelector.find('.secondselect option:selected').val());

          if (!this.timePicker24Hour) {
            var ampm = timeSelector.find('.ampmselect option:selected').val();
            if (ampm === 'PM' && selected.hour() < 12)
              selected.hour(selected.hour() + 12);
            if (ampm === 'AM' && selected.hour() === 12)
              selected.hour(0);
          }

        }

        if (selected.isBefore(this.startDate))
          selected = this.startDate.clone();

        if (maxDate && selected.isAfter(maxDate))
          selected = maxDate.clone();

      }

      //
      // hours
      //

      html = '<select class="hourselect">';

      var start = this.timePicker24Hour ? 0 : 1;
      var end = this.timePicker24Hour ? 23 : 12;

      for (var i = start; i <= end; i++) {
        var i_in_24 = i;
        if (!this.timePicker24Hour)
          i_in_24 = selected.hour() >= 12 ? (i == 12 ? 12 : i + 12) : (i == 12 ? 0 : i);

        var time = selected.clone().hour(i_in_24);
        var disabled = false;
        if (minDate && time.minute(59).isBefore(minDate))
          disabled = true;
        if (maxDate && time.minute(0).isAfter(maxDate))
          disabled = true;

        if (i_in_24 == selected.hour() && !disabled) {
          html += '<option value="' + i + '" selected="selected">' + i + '</option>';
        } else if (disabled) {
          html += '<option value="' + i + '" disabled="disabled" class="disabled">' + i + '</option>';
        } else {
          html += '<option value="' + i + '">' + i + '</option>';
        }
      }

      html += '</select> ';

      //
      // minutes
      //

      html += ': <select class="minuteselect">';

      for (var i = 0; i < 60; i += this.timePickerIncrement) {
        var padded = i < 10 ? '0' + i : i;
        var time = selected.clone().minute(i);

        var disabled = false;
        if (minDate && time.second(59).isBefore(minDate))
          disabled = true;
        if (maxDate && time.second(0).isAfter(maxDate))
          disabled = true;

        if (selected.minute() == i && !disabled) {
          html += '<option value="' + i + '" selected="selected">' + padded + '</option>';
        } else if (disabled) {
          html += '<option value="' + i + '" disabled="disabled" class="disabled">' + padded + '</option>';
        } else {
          html += '<option value="' + i + '">' + padded + '</option>';
        }
      }

      html += '</select> ';

      //
      // seconds
      //

      if (this.timePickerSeconds) {
        html += ': <select class="secondselect">';

        for (var i = 0; i < 60; i++) {
          var padded = i < 10 ? '0' + i : i;
          var time = selected.clone().second(i);

          var disabled = false;
          if (minDate && time.isBefore(minDate))
            disabled = true;
          if (maxDate && time.isAfter(maxDate))
            disabled = true;

          if (selected.second() == i && !disabled) {
            html += '<option value="' + i + '" selected="selected">' + padded + '</option>';
          } else if (disabled) {
            html += '<option value="' + i + '" disabled="disabled" class="disabled">' + padded + '</option>';
          } else {
            html += '<option value="' + i + '">' + padded + '</option>';
          }
        }

        html += '</select> ';
      }

      //
      // AM/PM
      //

      if (!this.timePicker24Hour) {
        html += '<select class="ampmselect">';

        var am_html = '';
        var pm_html = '';

        if (minDate && selected.clone().hour(12).minute(0).second(0).isBefore(minDate))
          am_html = ' disabled="disabled" class="disabled"';

        if (maxDate && selected.clone().hour(0).minute(0).second(0).isAfter(maxDate))
          pm_html = ' disabled="disabled" class="disabled"';

        if (selected.hour() >= 12) {
          html += '<option value="AM"' + am_html + '>AM</option><option value="PM" selected="selected"' + pm_html + '>PM</option>';
        } else {
          html += '<option value="AM" selected="selected"' + am_html + '>AM</option><option value="PM"' + pm_html + '>PM</option>';
        }

        html += '</select>';
      }

      this.container.find('.drp-calendar.' + side + ' .calendar-time').html(html);

    },

    updateFormInputs: function() {

      if (this.singleDatePicker || (this.endDate && (this.startDate.isBefore(this.endDate) || this.startDate.isSame(this.endDate)))) {
        this.container.find('button.applyBtn').removeAttr('disabled');
      } else {
        this.container.find('button.applyBtn').attr('disabled', 'disabled');
      }

    },

    move: function() {
      var parentOffset = { top: 0, left: 0 },
        containerTop;
      var parentRightEdge = $(window).width();
      if (!this.parentEl.is('body')) {
        parentOffset = {
          top: this.parentEl.offset().top - this.parentEl.scrollTop(),
          left: this.parentEl.offset().left - this.parentEl.scrollLeft()
        };
        parentRightEdge = this.parentEl[0].clientWidth + this.parentEl.offset().left;
      }

      if (this.drops == 'up')
        containerTop = this.element.offset().top - this.container.outerHeight() - parentOffset.top;
      else
        containerTop = this.element.offset().top + this.element.outerHeight() - parentOffset.top;
      this.container[this.drops == 'up' ? 'addClass' : 'removeClass']('drop-up');

      if (this.opens == 'left') {
        this.container.css({
          top: containerTop,
          right: parentRightEdge - this.element.offset().left - this.element.outerWidth(),
          left: 'auto'
        });
        if (this.container.offset().left < 0) {
          this.container.css({
            right: 'auto',
            left: 9
          });
        }
      } else if (this.opens == 'center') {
        this.container.css({
          top: containerTop,
          left: this.element.offset().left - parentOffset.left + this.element.outerWidth() / 2
          - this.container.outerWidth() / 2,
          right: 'auto'
        });
        if (this.container.offset().left < 0) {
          this.container.css({
            right: 'auto',
            left: 9
          });
        }
      } else {
        this.container.css({
          top: containerTop,
          left: this.element.offset().left - parentOffset.left,
          right: 'auto'
        });
        if (this.container.offset().left + this.container.outerWidth() > $(window).width()) {
          this.container.css({
            left: 'auto',
            right: 0
          });
        }
      }
    },

    show: function(e) {
      if (this.isShowing) return;

      // Create a click proxy that is private to this instance of datepicker, for unbinding
      this._outsideClickProxy = $.proxy(function(e) { this.outsideClick(e); }, this);

      // Bind global datepicker mousedown for hiding and
      $(document)
        .on('mousedown.daterangepicker', this._outsideClickProxy)
        // also support mobile devices
        .on('touchend.daterangepicker', this._outsideClickProxy)
        // also explicitly play nice with Bootstrap dropdowns, which stopPropagation when clicking them
        .on('click.daterangepicker', '[data-toggle=dropdown]', this._outsideClickProxy)
        // and also close when focus changes to outside the picker (eg. tabbing between controls)
        .on('focusin.daterangepicker', this._outsideClickProxy);

      // Reposition the picker if the window is resized while it's open
      $(window).on('resize.daterangepicker', $.proxy(function(e) { this.move(e); }, this));

      this.oldStartDate = this.startDate.clone();
      this.oldEndDate = this.endDate.clone();
      this.previousRightTime = this.endDate.clone();

      this.updateView();
      this.container.show();
      this.move();
      this.element.trigger('show.daterangepicker', this);
      this.isShowing = true;
    },

    hide: function(e) {
      if (!this.isShowing) return;

      //incomplete date selection, revert to last values
      if (!this.endDate) {
        this.startDate = this.oldStartDate.clone();
        this.endDate = this.oldEndDate.clone();
      }

      //if a new date range was selected, invoke the user callback function
      if (!this.startDate.isSame(this.oldStartDate) || !this.endDate.isSame(this.oldEndDate))
        this.callback(this.startDate.clone(), this.endDate.clone(), this.chosenLabel);

      //if picker is attached to a text input, update it
      this.updateElement();

      $(document).off('.daterangepicker');
      $(window).off('.daterangepicker');
      this.container.hide();
      this.element.trigger('hide.daterangepicker', this);
      this.isShowing = false;
    },

    toggle: function(e) {
      if (this.isShowing) {
        this.hide();
      } else {
        this.show();
      }
    },

    outsideClick: function(e) {
      var target = $(e.target);
      // if the page is clicked anywhere except within the daterangerpicker/button
      // itself then call this.hide()
      if (
        // ie modal dialog fix
        e.type == "focusin" ||
        target.closest(this.element).length ||
        target.closest(this.container).length ||
        target.closest('.calendar-table').length
      ) return;
      this.hide();
      this.element.trigger('outsideClick.daterangepicker', this);
    },

    showCalendars: function() {
      this.container.addClass('show-calendar');
      this.move();
      this.element.trigger('showCalendar.daterangepicker', this);
    },

    hideCalendars: function() {
      this.container.removeClass('show-calendar');
      this.element.trigger('hideCalendar.daterangepicker', this);
    },

    clickRange: function(e) {
      var label = e.target.getAttribute('data-range-key');
      this.chosenLabel = label;
      if (label == this.locale.customRangeLabel) {
        this.showCalendars();
      } else {
        var dates = this.ranges[label];
        this.startDate = dates[0];
        this.endDate = dates[1];

        if (!this.timePicker) {
          this.startDate.startOf('day');
          this.endDate.endOf('day');
        }

        if (!this.alwaysShowCalendars)
          this.hideCalendars();
        this.clickApply();
      }
    },

    clickPrev: function(e) {
      var cal = $(e.target).parents('.drp-calendar');
      if (cal.hasClass('left')) {
        this.leftCalendar.month.subtract(1, 'month');
        if (this.linkedCalendars)
          this.rightCalendar.month.subtract(1, 'month');
      } else {
        this.rightCalendar.month.subtract(1, 'month');
      }
      this.updateCalendars();
    },

    clickNext: function(e) {
      var cal = $(e.target).parents('.drp-calendar');
      if (cal.hasClass('left')) {
        this.leftCalendar.month.add(1, 'month');
      } else {
        this.rightCalendar.month.add(1, 'month');
        if (this.linkedCalendars)
          this.leftCalendar.month.add(1, 'month');
      }
      this.updateCalendars();
    },

    hoverDate: function(e) {

      //ignore dates that can't be selected
      if (!$(e.target).hasClass('available')) return;

      var title = $(e.target).attr('data-title');
      var row = title.substr(1, 1);
      var col = title.substr(3, 1);
      var cal = $(e.target).parents('.drp-calendar');
      var date = cal.hasClass('left') ? this.leftCalendar.calendar[row][col] : this.rightCalendar.calendar[row][col];

      //highlight the dates between the start date and the date being hovered as a potential end date
      var leftCalendar = this.leftCalendar;
      var rightCalendar = this.rightCalendar;
      var startDate = this.startDate;
      if (!this.endDate) {
        this.container.find('.drp-calendar tbody td').each(function(index, el) {

          //skip week numbers, only look at dates
          if ($(el).hasClass('week')) return;

          var title = $(el).attr('data-title');
          var row = title.substr(1, 1);
          var col = title.substr(3, 1);
          var cal = $(el).parents('.drp-calendar');
          var dt = cal.hasClass('left') ? leftCalendar.calendar[row][col] : rightCalendar.calendar[row][col];

          if ((dt.isAfter(startDate) && dt.isBefore(date)) || dt.isSame(date, 'day')) {
            $(el).addClass('in-range');
          } else {
            $(el).removeClass('in-range');
          }

        });
      }

    },

    clickDate: function(e) {

      if (!$(e.target).hasClass('available')) return;

      var title = $(e.target).attr('data-title');
      var row = title.substr(1, 1);
      var col = title.substr(3, 1);
      var cal = $(e.target).parents('.drp-calendar');
      var date = cal.hasClass('left') ? this.leftCalendar.calendar[row][col] : this.rightCalendar.calendar[row][col];

      //
      // this function needs to do a few things:
      // * alternate between selecting a start and end date for the range,
      // * if the time picker is enabled, apply the hour/minute/second from the select boxes to the clicked date
      // * if autoapply is enabled, and an end date was chosen, apply the selection
      // * if single date picker mode, and time picker isn't enabled, apply the selection immediately
      // * if one of the inputs above the calendars was focused, cancel that manual input
      //

      if (this.endDate || date.isBefore(this.startDate, 'day')) { //picking start
        if (this.timePicker) {
          var hour = parseInt(this.container.find('.left .hourselect').val(), 10);
          if (!this.timePicker24Hour) {
            var ampm = this.container.find('.left .ampmselect').val();
            if (ampm === 'PM' && hour < 12)
              hour += 12;
            if (ampm === 'AM' && hour === 12)
              hour = 0;
          }
          var minute = parseInt(this.container.find('.left .minuteselect').val(), 10);
          var second = this.timePickerSeconds ? parseInt(this.container.find('.left .secondselect').val(), 10) : 0;
          date = date.clone().hour(hour).minute(minute).second(second);
        }
        this.endDate = null;
        this.setStartDate(date.clone());
      } else if (!this.endDate && date.isBefore(this.startDate)) {
        //special case: clicking the same date for start/end,
        //but the time of the end date is before the start date
        this.setEndDate(this.startDate.clone());
      } else { // picking end
        if (this.timePicker) {
          var hour = parseInt(this.container.find('.right .hourselect').val(), 10);
          if (!this.timePicker24Hour) {
            var ampm = this.container.find('.right .ampmselect').val();
            if (ampm === 'PM' && hour < 12)
              hour += 12;
            if (ampm === 'AM' && hour === 12)
              hour = 0;
          }
          var minute = parseInt(this.container.find('.right .minuteselect').val(), 10);
          var second = this.timePickerSeconds ? parseInt(this.container.find('.right .secondselect').val(), 10) : 0;
          date = date.clone().hour(hour).minute(minute).second(second);
        }
        this.setEndDate(date.clone());
        if (this.autoApply) {
          this.calculateChosenLabel();
          this.clickApply();
        }
      }

      if (this.singleDatePicker) {
        this.setEndDate(this.startDate);
        if (!this.timePicker)
          this.clickApply();
      }

      this.updateView();

      //This is to cancel the blur event handler if the mouse was in one of the inputs
      e.stopPropagation();

    },

    calculateChosenLabel: function () {
      var customRange = true;
      var i = 0;
      for (var range in this.ranges) {
        if (this.timePicker) {
          var format = this.timePickerSeconds ? "YYYY-MM-DD HH:mm:ss" : "YYYY-MM-DD HH:mm";
          //ignore times when comparing dates if time picker seconds is not enabled
          if (this.startDate.format(format) == this.ranges[range][0].format(format) && this.endDate.format(format) == this.ranges[range][1].format(format)) {
            customRange = false;
            this.chosenLabel = this.container.find('.ranges li:eq(' + i + ')').addClass('active').attr('data-range-key');
            break;
          }
        } else {
          //ignore times when comparing dates if time picker is not enabled
          if (this.startDate.format('YYYY-MM-DD') == this.ranges[range][0].format('YYYY-MM-DD') && this.endDate.format('YYYY-MM-DD') == this.ranges[range][1].format('YYYY-MM-DD')) {
            customRange = false;
            this.chosenLabel = this.container.find('.ranges li:eq(' + i + ')').addClass('active').attr('data-range-key');
            break;
          }
        }
        i++;
      }
      if (customRange) {
        if (this.showCustomRangeLabel) {
          this.chosenLabel = this.container.find('.ranges li:last').addClass('active').attr('data-range-key');
        } else {
          this.chosenLabel = null;
        }
        this.showCalendars();
      }
    },

    clickApply: function(e) {
      this.hide();
      this.element.trigger('apply.daterangepicker', this);
    },

    clickCancel: function(e) {
      this.startDate = this.oldStartDate;
      this.endDate = this.oldEndDate;
      this.hide();
      this.element.trigger('cancel.daterangepicker', this);
    },

    monthOrYearChanged: function(e) {
      var isLeft = $(e.target).closest('.drp-calendar').hasClass('left'),
        leftOrRight = isLeft ? 'left' : 'right',
        cal = this.container.find('.drp-calendar.'+leftOrRight);

      // Month must be Number for new moment versions
      var month = parseInt(cal.find('.monthselect').val(), 10);
      var year = cal.find('.yearselect').val();

      if (!isLeft) {
        if (year < this.startDate.year() || (year == this.startDate.year() && month < this.startDate.month())) {
          month = this.startDate.month();
          year = this.startDate.year();
        }
      }

      if (this.minDate) {
        if (year < this.minDate.year() || (year == this.minDate.year() && month < this.minDate.month())) {
          month = this.minDate.month();
          year = this.minDate.year();
        }
      }

      if (this.maxDate) {
        if (year > this.maxDate.year() || (year == this.maxDate.year() && month > this.maxDate.month())) {
          month = this.maxDate.month();
          year = this.maxDate.year();
        }
      }

      if (isLeft) {
        this.leftCalendar.month.month(month).year(year);
        if (this.linkedCalendars)
          this.rightCalendar.month = this.leftCalendar.month.clone().add(1, 'month');
      } else {
        this.rightCalendar.month.month(month).year(year);
        if (this.linkedCalendars)
          this.leftCalendar.month = this.rightCalendar.month.clone().subtract(1, 'month');
      }
      this.updateCalendars();
    },

    timeChanged: function(e) {

      var cal = $(e.target).closest('.drp-calendar'),
        isLeft = cal.hasClass('left');

      var hour = parseInt(cal.find('.hourselect').val(), 10);
      var minute = parseInt(cal.find('.minuteselect').val(), 10);
      var second = this.timePickerSeconds ? parseInt(cal.find('.secondselect').val(), 10) : 0;

      if (!this.timePicker24Hour) {
        var ampm = cal.find('.ampmselect').val();
        if (ampm === 'PM' && hour < 12)
          hour += 12;
        if (ampm === 'AM' && hour === 12)
          hour = 0;
      }

      if (isLeft) {
        var start = this.startDate.clone();
        start.hour(hour);
        start.minute(minute);
        start.second(second);
        this.setStartDate(start);
        if (this.singleDatePicker) {
          this.endDate = this.startDate.clone();
        } else if (this.endDate && this.endDate.format('YYYY-MM-DD') == start.format('YYYY-MM-DD') && this.endDate.isBefore(start)) {
          this.setEndDate(start.clone());
        }
      } else if (this.endDate) {
        var end = this.endDate.clone();
        end.hour(hour);
        end.minute(minute);
        end.second(second);
        this.setEndDate(end);
      }

      //update the calendars so all clickable dates reflect the new time component
      this.updateCalendars();

      //update the form inputs above the calendars with the new time
      this.updateFormInputs();

      //re-render the time pickers because changing one selection can affect what's enabled in another
      this.renderTimePicker('left');
      this.renderTimePicker('right');

    },

    elementChanged: function() {
      if (!this.element.is('input')) return;
      if (!this.element.val().length) return;

      var dateString = this.element.val().split(this.locale.separator),
        start = null,
        end = null;

      if (dateString.length === 2) {
        start = moment(dateString[0], this.locale.format);
        end = moment(dateString[1], this.locale.format);
      }

      if (this.singleDatePicker || start === null || end === null) {
        start = moment(this.element.val(), this.locale.format);
        end = start;
      }

      if (!start.isValid() || !end.isValid()) return;

      this.setStartDate(start);
      this.setEndDate(end);
      this.updateView();
    },

    keydown: function(e) {
      //hide on tab or enter
      if ((e.keyCode === 9) || (e.keyCode === 13)) {
        this.hide();
      }

      //hide on esc and prevent propagation
      if (e.keyCode === 27) {
        e.preventDefault();
        e.stopPropagation();

        this.hide();
      }
    },

    updateElement: function() {
      if (this.element.is('input') && this.autoUpdateInput) {
        var newValue = this.startDate.format(this.locale.format);
        if (!this.singleDatePicker) {
          newValue += this.locale.separator + this.endDate.format(this.locale.format);
        }
        if (newValue !== this.element.val()) {
          this.element.val(newValue).trigger('change');
        }
      }
    },

    remove: function() {
      this.container.remove();
      this.element.off('.daterangepicker');
      this.element.removeData();
    }

  };

  $.fn.daterangepicker = function(options, callback) {
    var implementOptions = $.extend(true, {}, $.fn.daterangepicker.defaultOptions, options);
    this.each(function() {
      var el = $(this);
      if (el.data('daterangepicker'))
        el.data('daterangepicker').remove();
      el.data('daterangepicker', new DateRangePicker(el, implementOptions, callback));
    });
    return this;
  };

  return DateRangePicker;

}));
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/sacharts/settings_unit"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div class="btn-wrapper">\n  <div class="btn',  config && config.graphBtnDisabled ? ' disabled' : '' ,'" data-action="graph">',  areaGraphIcon ,'</div>\n  <div class="btn',  config && config.datesBtnDisabled ? ' disabled' : '' ,'" data-action="dates">',  datesIcon ,'</div>\n  <div class="btn',  config && config.generalBtnDisabled ? ' disabled' : '' ,'" data-action="general">',  generalIcon ,'</div>\n</div>\n<div class="graph-popup sa-with-arrow hidden">\n  <ul>\n    <li class=\'btn-li ',  config && config.defaultChartType == 'line' ? 'selected' : '' ,' ',  config && config.lineBtnDisabled ? 'disabled' : '' ,'\' data-action=\'line\'>\n      <label>\n        <div class="btn no-border ',  config && config.lineBtnDisabled ? 'disabled' : '' ,'">',  lineGraphIcon ,'</div>\n        <span>Line</span>\n      </label>\n    </li>\n    <li class=\'btn-li ',  config && config.defaultChartType == 'area' ? 'selected' : '' ,' ',  config && config.areaBtnDisabled ? 'disabled' : '' ,'\' data-action=\'area\'>\n      <label>\n        <div class="btn no-border ',  config && config.areaBtnDisabled ? 'disabled' : '' ,'">',  areaGraphIcon ,'</div>\n        <span>Area</span>\n      </label>\n    </li>\n    <li class=\'btn-li ',  config && config.defaultChartType == 'column' ? 'selected' : '' ,' ',  config && config.columnBtnDisabled ? 'disabled' : '' ,'\' data-action=\'column\'>\n      <label>\n        <div class="btn no-border ',  config && config.columnBtnDisabled ? 'disabled' : '' ,'">',  columnGraphIcon ,'</div>\n        <span>Column</span>\n      </label>\n    </li>\n  </ul>\n</div>\n<div class="general-popup sa-with-arrow hidden">\n  <div class="y-scale-title">\n    Y-Axis scale\n  </div>\n  <ul>\n    <li class=\'btn-li\' data-action=\'linear\'>\n      <label>\n        <input data-type="linear" data-compare="Value" type="radio" name="y-scale-radio">\n        <span>Linear</span>\n      </label>\n    </li>\n    <li class=\'btn-li\' data-action=\'percentage\'>\n      <label>\n        <input data-type="percentage" data-compare="percent" type="radio" name="y-scale-radio">\n        <span>Percentage</span>\n      </label>\n    </li>\n    <li class=\'btn-li\' data-action=\'log\'>\n      <label>\n        <input data-type="log" data-compare="Value" type="radio" name="y-scale-radio">\n        <span>Logarithmic</span>\n      </label>\n    </li>\n  </ul>\n</div>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/inline_svg/highchart/line_graph"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n\t height="',  height ,'" width="',  width ,'" viewBox="1.083 9.375 16.917 16.458" enable-background="new 1.083 9.375 16.917 16.458" xml:space="preserve">\n  <title>cogs</title>\n  <polyline fill="none" stroke="#555555" stroke-width="0.9903" stroke-miterlimit="10" points="2.083,24.5 7.055,14.827\n    11.281,21.025 16.912,12.667 "/>\n</svg>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/inline_svg/highchart/area_graph"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"\n\theight="',  height ,'" width="',  width ,'" viewBox="4.5 8.625 17.125 15.25">\n  <title>Chart Format</title>\n  <polyline fill="none" stroke="#555555" stroke-width="0.9903" stroke-miterlimit="10" points="5.456,22.834 11.682,11.493\n    15.908,17.691 20.956,10.25 "/>\n  <polygon fill="#757575" points="6.365,23.449 6.311,23.59 11.663,14.199 15.946,19.865 21.17,12.874 21.163,23.449 15.124,23.449\n    10.956,23.449"/>\n</svg>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/inline_svg/highchart/column_graph"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n\t width="',  width ,'" height="',  height ,'" viewBox="1.083 10.75 17.979 15.084" enable-background="new 1.083 10.75 17.979 15.084"\n\t xml:space="preserve">\n  <title>cogs</title>\n  <path stroke="#000000" stroke-linejoin="round" stroke-miterlimit="10" d="M-26.75-3.625c-1.105,0-2-0.895-2-2s0.895-2,2-2\n    s2,0.895,2,2S-25.645-3.625-26.75-3.625z M-1.75-18.625v-2l-2.105-0.383c-0.039-0.251-0.088-0.499-0.148-0.743l1.799-1.159\n    l-0.766-1.848l-2.092,0.452c-0.131-0.216-0.272-0.426-0.422-0.629l1.219-1.761L-5.68-28.11l-1.76,1.219\n    c-0.203-0.149-0.414-0.29-0.629-0.422l0.451-2.092l-1.848-0.765l-1.159,1.799c-0.244-0.059-0.492-0.109-0.743-0.148l-0.383-2.106h-2\n    l-0.383,2.106c-0.251,0.039-0.499,0.088-0.743,0.148l-1.159-1.799l-1.848,0.765l0.452,2.092c-0.216,0.132-0.426,0.273-0.629,0.422\n    l-1.761-1.219l-1.414,1.414l1.219,1.761c-0.149,0.203-0.29,0.413-0.422,0.629l-2.092-0.452l-0.765,1.848l1.799,1.159\n    c-0.059,0.244-0.109,0.492-0.148,0.743l-2.106,0.383v2l2.106,0.383c0.039,0.251,0.088,0.499,0.148,0.743l-1.799,1.159l0.765,1.848\n    l2.092-0.452c0.132,0.216,0.273,0.426,0.422,0.629l-1.219,1.76l1.414,1.414l1.761-1.219c0.203,0.149,0.413,0.291,0.629,0.422\n    l-0.452,2.092l1.848,0.766l1.159-1.799c0.244,0.059,0.492,0.109,0.743,0.148l0.383,2.105h2l0.383-2.105\n    c0.251-0.039,0.499-0.088,0.743-0.148l1.159,1.799l1.848-0.766l-0.451-2.092c0.215-0.131,0.426-0.272,0.629-0.422l1.76,1.219\n    l1.414-1.414l-1.219-1.76c0.149-0.203,0.291-0.413,0.422-0.629l2.092,0.452l0.766-1.848l-1.799-1.159\n    c0.059-0.244,0.109-0.492,0.148-0.743L-1.75-18.625z M-12.75-15.275c-2.402,0-4.35-1.948-4.35-4.35s1.947-4.35,4.35-4.35\n    s4.35,1.948,4.35,4.35S-10.348-15.275-12.75-15.275z"/>\n  <g>\n    <path fill="#555555" d="M-36.156,18.469h-2c-0.245,0-0.453-0.177-0.493-0.418l-0.314-1.888c-0.2-0.069-0.396-0.151-0.587-0.243\n      l-1.558,1.113c-0.199,0.141-0.471,0.118-0.644-0.054l-1.414-1.414c-0.173-0.173-0.195-0.445-0.053-0.644l1.112-1.558\n      c-0.092-0.19-0.173-0.386-0.243-0.587l-1.888-0.315c-0.241-0.04-0.418-0.249-0.418-0.493v-2c0-0.245,0.177-0.453,0.418-0.493\n      l1.887-0.315c0.069-0.2,0.15-0.396,0.243-0.586l-1.113-1.558c-0.142-0.199-0.12-0.471,0.053-0.644l1.414-1.414\n      c0.172-0.173,0.445-0.196,0.644-0.053l1.558,1.112c0.189-0.092,0.385-0.173,0.587-0.243l0.315-1.887\n      c0.04-0.241,0.249-0.418,0.493-0.418h2c0.245,0,0.453,0.177,0.493,0.418l0.315,1.888c0.2,0.07,0.396,0.151,0.586,0.243l1.558-1.113\n      c0.198-0.143,0.471-0.12,0.644,0.053l1.414,1.414c0.173,0.173,0.195,0.445,0.053,0.644l-1.112,1.558\n      c0.092,0.19,0.174,0.386,0.244,0.587l1.888,0.315c0.241,0.04,0.418,0.249,0.418,0.493v2c0,0.245-0.177,0.453-0.418,0.493\n      l-1.888,0.315c-0.07,0.2-0.151,0.396-0.243,0.586l1.113,1.558c0.142,0.199,0.12,0.471-0.053,0.644l-1.414,1.414\n      c-0.174,0.172-0.446,0.194-0.644,0.054l-1.557-1.113c-0.19,0.092-0.386,0.173-0.587,0.244l-0.315,1.887\n      C-35.703,18.292-35.911,18.469-36.156,18.469z M-37.732,17.469h1.153l0.295-1.771c0.032-0.191,0.17-0.346,0.356-0.399\n      c0.339-0.097,0.664-0.231,0.964-0.399c0.168-0.095,0.378-0.084,0.535,0.029l1.462,1.044l0.815-0.815l-1.045-1.463\n      c-0.113-0.158-0.124-0.366-0.029-0.535c0.169-0.301,0.303-0.625,0.398-0.961c0.052-0.187,0.208-0.326,0.399-0.357l1.772-0.295\n      v-1.153l-1.772-0.295c-0.191-0.032-0.347-0.171-0.399-0.357c-0.095-0.336-0.229-0.66-0.398-0.961\n      c-0.095-0.169-0.083-0.377,0.029-0.535l1.044-1.463l-0.815-0.815l-1.463,1.045c-0.158,0.113-0.367,0.124-0.534,0.03\n      c-0.304-0.17-0.628-0.305-0.964-0.4c-0.186-0.053-0.324-0.208-0.356-0.399l-0.295-1.771h-1.153l-0.295,1.771\n      c-0.032,0.191-0.17,0.346-0.356,0.399c-0.34,0.097-0.665,0.231-0.963,0.399c-0.168,0.094-0.378,0.084-0.536-0.029l-1.462-1.045\n      l-0.815,0.815l1.045,1.463c0.113,0.158,0.124,0.366,0.029,0.535c-0.17,0.304-0.304,0.627-0.397,0.961\n      c-0.053,0.187-0.208,0.326-0.399,0.358l-1.772,0.295v1.153l1.772,0.295c0.191,0.032,0.346,0.171,0.399,0.357\n      c0.096,0.339,0.23,0.662,0.398,0.961c0.095,0.169,0.084,0.378-0.029,0.536l-1.045,1.463l0.815,0.815l1.462-1.045\n      c0.157-0.112,0.366-0.123,0.534-0.03c0.306,0.171,0.631,0.305,0.965,0.4c0.186,0.053,0.325,0.208,0.356,0.399L-37.732,17.469z"/>\n  </g>\n  <g>\n    <path fill="#555555" d="M-37.156,13.594c-1.447,0-2.625-1.178-2.625-2.625s1.178-2.625,2.625-2.625s2.625,1.178,2.625,2.625\n      S-35.708,13.594-37.156,13.594z M-37.156,9.344c-0.896,0-1.625,0.729-1.625,1.625s0.729,1.625,1.625,1.625s1.625-0.729,1.625-1.625\n      S-36.26,9.344-37.156,9.344z"/>\n  </g>\n  <g>\n    <g>\n      <path fill="#555555" d="M-52.188-19.761v4.875v1h1h3.375h1v-1v-4.875c1.656,0.012,3,1.363,3,3.021v15.27\n        c0,1.666-1.355,3.021-3.021,3.021h-15.27c-1.666,0-3.021-1.355-3.021-3.021v-15.27c0-1.638,1.31-2.976,2.938-3.021v4.874v1h1\n        h3.375h1v-1v-4.875H-52.188 M-46.834-20.761h-0.979v5.875h-3.375v-5.875h-6.625v5.875h-3.375v-5.875h-0.916\n        c-2.221,0-4.021,1.801-4.021,4.021v15.27c0,2.221,1.801,4.021,4.021,4.021h15.27c2.221,0,4.021-1.801,4.021-4.021v-15.27\n        C-42.812-18.96-44.613-20.761-46.834-20.761L-46.834-20.761z"/>\n    </g>\n    <g>\n      <path fill="#555555" d="M-49.096-20.822v4.56h-0.846v-4.56H-49.096 M-48.25-21.668h-2.538v6.252h2.538V-21.668L-48.25-21.668z"/>\n    </g>\n    <g>\n      <path fill="#555555" d="M-59.058-20.822v4.56h-0.846v-4.56H-59.058 M-58.212-21.668h-2.538v6.252h2.538V-21.668L-58.212-21.668z"\n        />\n    </g>\n  </g>\n  <rect x="-62.921" y="-11.553" fill="#555555" width="3" height="3.108"/>\n  <rect x="-58.255" y="-11.553" fill="#555555" width="3" height="3.108"/>\n  <rect x="-53.588" y="-11.553" fill="#555555" width="3" height="3.108"/>\n  <rect x="-48.921" y="-11.553" fill="#555555" width="3" height="3.108"/>\n  <rect x="-62.921" y="-7.553" fill="#555555" width="3" height="3.108"/>\n  <rect x="-58.255" y="-7.553" fill="#555555" width="3" height="3.108"/>\n  <rect x="-53.588" y="-7.553" fill="#555555" width="3" height="3.108"/>\n  <rect x="-48.921" y="-7.553" fill="#555555" width="3" height="3.108"/>\n  <rect x="-62.921" y="-3.553" fill="#555555" width="3" height="3.108"/>\n  <rect x="-58.255" y="-3.553" fill="#555555" width="3" height="3.108"/>\n  <rect x="-53.588" y="-3.553" fill="#555555" width="3" height="3.108"/>\n  <rect x="-48.921" y="-3.553" fill="#555555" width="3" height="3.108"/>\n  <rect x="2.083" y="36.294" fill="#555555" width="14.834" height="4.833"/>\n  <g>\n    <path fill="#555555" d="M16.009,37.369v12.35H2.991v-12.35H16.009 M16.917,36.461H2.083v14.166h14.834V36.461L16.917,36.461z"/>\n  </g>\n  <rect x="11.718" y="39.919" fill="#555555" width="1" height="10.001"/>\n  <rect x="6.718" y="39.919" fill="#555555" width="1" height="10.001"/>\n  <rect x="2.884" y="45.133" fill="#555555" width="13.166" height="1.076"/>\n  <g>\n    <path fill="#555555" d="M-36.607,7.479v9.875h-12.625V7.479H-36.607 M-35.503,6.375h-14.833v12.083h14.833V6.375L-35.503,6.375z"/>\n  </g>\n  <rect x="-50.336" y="9.708" fill="#555555" width="14.833" height="1.25"/>\n  <rect x="-50.336" y="13.709" fill="#555555" width="14.833" height="1.25"/>\n  <rect x="-46.129" y="8.667" fill="#555555" width="1.25" height="7"/>\n  <rect x="-41.711" y="8.792" fill="#555555" width="1.25" height="6.999"/>\n  <polyline fill="none" stroke="#555555" stroke-width="0.9903" stroke-miterlimit="10" points="3.583,4.25 8.555,-5.423\n    12.781,0.775 18.412,-7.583 "/>\n  <polyline fill="none" stroke="#555555" stroke-width="0.9903" stroke-miterlimit="10" points="23.705,4.169 29.932,-7.173\n    34.157,-0.973 39.205,-8.416 "/>\n  <g>\n    <polygon fill="#757575" points="24.614,4.785 24.561,4.925 29.912,-4.467 34.195,1.201 39.42,-5.792 39.412,4.785 33.373,4.785\n      29.205,4.785 \t"/>\n  </g>\n  <rect x="2" y="15.267" fill="#757575" width="4" height="9.483"/>\n  <rect x="14" y="18.448" fill="#757575" width="4" height="6.302"/>\n  <rect x="8" y="11.176" fill="#757575" width="4" height="13.574"/>\n</svg>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/inline_svg/highchart/dates"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"\n\t height="',  height ,'" width="',  width ,'" viewBox="1.083 9.375 16.917 16.458">\n  <title>Date Range</title>\n  <path stroke="#000000" stroke-linejoin="round" stroke-miterlimit="10" d="M-26.75-3.625c-1.105,0-2-0.895-2-2s0.895-2,2-2\n    s2,0.895,2,2S-25.645-3.625-26.75-3.625z M-1.75-18.625v-2l-2.105-0.383c-0.039-0.251-0.088-0.499-0.148-0.743l1.799-1.159\n    l-0.766-1.848l-2.092,0.452c-0.131-0.216-0.272-0.426-0.422-0.629l1.219-1.761L-5.68-28.11l-1.76,1.219\n    c-0.203-0.149-0.414-0.29-0.629-0.422l0.451-2.092l-1.848-0.765l-1.159,1.799c-0.244-0.059-0.492-0.109-0.743-0.148l-0.383-2.106h-2\n    l-0.383,2.106c-0.251,0.039-0.499,0.088-0.743,0.148l-1.159-1.799l-1.848,0.765l0.452,2.092c-0.216,0.132-0.426,0.273-0.629,0.422\n    l-1.761-1.219l-1.414,1.414l1.219,1.761c-0.149,0.203-0.29,0.413-0.422,0.629l-2.092-0.452l-0.765,1.848l1.799,1.159\n    c-0.059,0.244-0.109,0.492-0.148,0.743l-2.106,0.383v2l2.106,0.383c0.039,0.251,0.088,0.499,0.148,0.743l-1.799,1.159l0.765,1.848\n    l2.092-0.452c0.132,0.216,0.273,0.426,0.422,0.629l-1.219,1.76l1.414,1.414l1.761-1.219c0.203,0.149,0.413,0.291,0.629,0.422\n    l-0.452,2.092l1.848,0.766l1.159-1.799c0.244,0.059,0.492,0.109,0.743,0.148l0.383,2.105h2l0.383-2.105\n    c0.251-0.039,0.499-0.088,0.743-0.148l1.159,1.799l1.848-0.766l-0.451-2.092c0.215-0.131,0.426-0.272,0.629-0.422l1.76,1.219\n    l1.414-1.414l-1.219-1.76c0.149-0.203,0.291-0.413,0.422-0.629l2.092,0.452l0.766-1.848l-1.799-1.159\n    c0.059-0.244,0.109-0.492,0.148-0.743L-1.75-18.625z M-12.75-15.275c-2.402,0-4.35-1.948-4.35-4.35s1.947-4.35,4.35-4.35\n    s4.35,1.948,4.35,4.35S-10.348-15.275-12.75-15.275z"/>\n  <path fill="#555555" d="M-36.156,18.469h-2c-0.245,0-0.453-0.177-0.493-0.418l-0.314-1.888c-0.2-0.069-0.396-0.151-0.587-0.243\n    l-1.558,1.113c-0.199,0.141-0.471,0.118-0.644-0.054l-1.414-1.414c-0.173-0.173-0.195-0.445-0.053-0.644l1.112-1.558\n    c-0.092-0.19-0.173-0.386-0.243-0.587l-1.888-0.315c-0.241-0.04-0.418-0.249-0.418-0.493v-2c0-0.245,0.177-0.453,0.418-0.493\n    l1.887-0.315c0.069-0.2,0.15-0.396,0.243-0.586l-1.113-1.558c-0.142-0.199-0.12-0.471,0.053-0.644l1.414-1.414\n    c0.172-0.173,0.445-0.196,0.644-0.053l1.558,1.112c0.189-0.092,0.385-0.173,0.587-0.243l0.315-1.887\n    c0.04-0.241,0.249-0.418,0.493-0.418h2c0.245,0,0.453,0.177,0.493,0.418l0.315,1.888c0.2,0.07,0.396,0.151,0.586,0.243l1.558-1.113\n    c0.198-0.143,0.471-0.12,0.644,0.053l1.414,1.414c0.173,0.173,0.195,0.445,0.053,0.644l-1.112,1.558\n    c0.092,0.19,0.174,0.386,0.244,0.587l1.888,0.315c0.241,0.04,0.418,0.249,0.418,0.493v2c0,0.245-0.177,0.453-0.418,0.493\n    l-1.888,0.315c-0.07,0.2-0.151,0.396-0.243,0.586l1.113,1.558c0.142,0.199,0.12,0.471-0.053,0.644l-1.414,1.414\n    c-0.174,0.172-0.446,0.194-0.644,0.054l-1.557-1.113c-0.19,0.092-0.386,0.173-0.587,0.244l-0.315,1.887\n    C-35.703,18.292-35.911,18.469-36.156,18.469z M-37.732,17.469h1.153l0.295-1.771c0.032-0.191,0.17-0.346,0.356-0.399\n    c0.339-0.097,0.664-0.231,0.964-0.399c0.168-0.095,0.378-0.084,0.535,0.029l1.462,1.044l0.815-0.815l-1.045-1.463\n    c-0.113-0.158-0.124-0.366-0.029-0.535c0.169-0.301,0.303-0.625,0.398-0.961c0.052-0.187,0.208-0.326,0.399-0.357l1.772-0.295\n    v-1.153l-1.772-0.295c-0.191-0.032-0.347-0.171-0.399-0.357c-0.095-0.336-0.229-0.66-0.398-0.961\n    c-0.095-0.169-0.083-0.377,0.029-0.535l1.044-1.463l-0.815-0.815l-1.463,1.045c-0.158,0.113-0.367,0.124-0.534,0.03\n    c-0.304-0.17-0.628-0.305-0.964-0.4c-0.186-0.053-0.324-0.208-0.356-0.399l-0.295-1.771h-1.153l-0.295,1.771\n    c-0.032,0.191-0.17,0.346-0.356,0.399c-0.34,0.097-0.665,0.231-0.963,0.399c-0.168,0.094-0.378,0.084-0.536-0.029l-1.462-1.045\n    l-0.815,0.815l1.045,1.463c0.113,0.158,0.124,0.366,0.029,0.535c-0.17,0.304-0.304,0.627-0.397,0.961\n    c-0.053,0.187-0.208,0.326-0.399,0.358l-1.772,0.295v1.153l1.772,0.295c0.191,0.032,0.346,0.171,0.399,0.357\n    c0.096,0.339,0.23,0.662,0.398,0.961c0.095,0.169,0.084,0.378-0.029,0.536l-1.045,1.463l0.815,0.815l1.462-1.045\n    c0.157-0.112,0.366-0.123,0.534-0.03c0.306,0.171,0.631,0.305,0.965,0.4c0.186,0.053,0.325,0.208,0.356,0.399L-37.732,17.469z"/>\n  <path fill="#555555" d="M-37.156,13.594c-1.447,0-2.625-1.178-2.625-2.625s1.178-2.625,2.625-2.625s2.625,1.178,2.625,2.625\n    S-35.708,13.594-37.156,13.594z M-37.156,9.344c-0.896,0-1.625,0.729-1.625,1.625s0.729,1.625,1.625,1.625s1.625-0.729,1.625-1.625\n    S-36.26,9.344-37.156,9.344z"/>\n  <path fill="#555555" d="M-52.188-19.761v4.875v1h1h3.375h1v-1v-4.875c1.656,0.012,3,1.363,3,3.021v15.27\n    c0,1.666-1.355,3.021-3.021,3.021h-15.27c-1.666,0-3.021-1.355-3.021-3.021v-15.27c0-1.638,1.31-2.976,2.938-3.021v4.874v1h1\n    h3.375h1v-1v-4.875H-52.188 M-46.834-20.761h-0.979v5.875h-3.375v-5.875h-6.625v5.875h-3.375v-5.875h-0.916\n    c-2.221,0-4.021,1.801-4.021,4.021v15.27c0,2.221,1.801,4.021,4.021,4.021h15.27c2.221,0,4.021-1.801,4.021-4.021v-15.27\n    C-42.812-18.96-44.613-20.761-46.834-20.761L-46.834-20.761z"/>\n  <path fill="#555555" d="M-49.096-20.822v4.56h-0.846v-4.56H-49.096 M-48.25-21.668h-2.538v6.252h2.538V-21.668L-48.25-21.668z"/>\n  <path fill="#555555" d="M-59.058-20.822v4.56h-0.846v-4.56H-59.058 M-58.212-21.668h-2.538v6.252h2.538V-21.668L-58.212-21.668z"/>\n  <rect x="-62.921" y="-11.553" fill="#555555" width="3" height="3.108"/>\n  <rect x="-58.255" y="-11.553" fill="#555555" width="3" height="3.108"/>\n  <rect x="-53.588" y="-11.553" fill="#555555" width="3" height="3.108"/>\n  <rect x="-48.921" y="-11.553" fill="#555555" width="3" height="3.108"/>\n  <rect x="-62.921" y="-7.553" fill="#555555" width="3" height="3.108"/>\n  <rect x="-58.255" y="-7.553" fill="#555555" width="3" height="3.108"/>\n  <rect x="-53.588" y="-7.553" fill="#555555" width="3" height="3.108"/>\n  <rect x="-48.921" y="-7.553" fill="#555555" width="3" height="3.108"/>\n  <rect x="-62.921" y="-3.553" fill="#555555" width="3" height="3.108"/>\n  <rect x="-58.255" y="-3.553" fill="#555555" width="3" height="3.108"/>\n  <rect x="-53.588" y="-3.553" fill="#555555" width="3" height="3.108"/>\n  <rect x="-48.921" y="-3.553" fill="#555555" width="3" height="3.108"/>\n  <rect x="2.083" y="10.293" fill="#555555" width="14.834" height="4.833"/>\n  <path fill="#555555" d="M16.009,11.369v12.35H2.991v-12.35H16.009 M16.917,10.461H2.083v14.166h14.834V10.461L16.917,10.461z"/>\n  <rect x="11.718" y="13.918" fill="#555555" width="1" height="10.001"/>\n  <rect x="6.718" y="13.918" fill="#555555" width="1" height="10.001"/>\n  <rect x="2.884" y="19.133" fill="#555555" width="13.166" height="1.076"/>\n  <path fill="#555555" d="M-36.607,7.479v9.875h-12.625V7.479H-36.607 M-35.503,6.375h-14.833v12.083h14.833V6.375L-35.503,6.375z"/>\n  <rect x="-50.336" y="9.708" fill="#555555" width="14.833" height="1.25"/>\n  <rect x="-50.336" y="13.709" fill="#555555" width="14.833" height="1.25"/>\n  <rect x="-46.129" y="8.667" fill="#555555" width="1.25" height="7"/>\n  <rect x="-41.711" y="8.792" fill="#555555" width="1.25" height="6.999"/>\n  <polyline fill="none" stroke="#555555" stroke-width="0.9903" stroke-miterlimit="10" points="2.085,-19.5 7.057,-29.173\n    11.283,-22.975 16.914,-31.333 "/>\n  <polyline fill="none" stroke="#555555" stroke-width="0.9903" stroke-miterlimit="10" points="23.705,4.169 29.932,-7.173\n    34.157,-0.973 39.205,-8.416 "/>\n  <polygon fill="#757575" points="24.614,4.785 24.561,4.925 29.912,-4.467 34.195,1.201 39.42,-5.792 39.412,4.785 33.373,4.785\n    29.205,4.785"/>\n  <rect x="9.269" y="-14.608" fill="#757575" width="4" height="9.483"/>\n  <rect x="21.27" y="-11.427" fill="#757575" width="4" height="6.302"/>\n  <rect x="15.27" y="-18.699" fill="#757575" width="4" height="13.574"/>\n</svg>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/inline_svg/highchart/general"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" height="',  height ,'" width="',  width ,'" viewBox="0 0 30 30">\n<title>More Chart Options</title>\n  <path fill="#555555" d="M15.208,10.226c-2.541,0-4.608,2.067-4.608,4.608s2.067,4.609,4.608,4.609c2.541,0,4.608-2.068,4.608-4.609\n    S17.749,10.226,15.208,10.226z M15.208,17.687c-1.573,0-2.853-1.28-2.853-2.853s1.28-2.853,2.853-2.853\n    c1.573,0,2.853,1.28,2.853,2.853S16.781,17.687,15.208,17.687z"/>\n  <path fill="#555555" d="M27.641,12.212l-3.314-0.553c-0.123-0.352-0.266-0.697-0.429-1.03l1.955-2.734\n    c0.248-0.349,0.209-0.827-0.095-1.13l-2.482-2.482c-0.303-0.304-0.783-0.344-1.13-0.093L19.41,6.142\n    c-0.336-0.162-0.68-0.305-1.029-0.427l-0.554-3.313c-0.07-0.424-0.436-0.734-0.865-0.734h-3.511c-0.429,0-0.795,0.31-0.866,0.734\n    l-0.553,3.313c-0.354,0.123-0.698,0.266-1.03,0.427L8.268,4.188c-0.35-0.25-0.829-0.211-1.131,0.093L4.655,6.764\n    c-0.304,0.303-0.343,0.782-0.094,1.13l1.954,2.735c-0.162,0.335-0.304,0.679-0.426,1.029l-3.313,0.553\n    c-0.423,0.07-0.734,0.436-0.734,0.866v3.511c0,0.43,0.311,0.796,0.734,0.866l3.313,0.553c0.123,0.353,0.265,0.697,0.426,1.03\n    l-1.953,2.734c-0.25,0.348-0.21,0.828,0.093,1.13l2.482,2.482c0.303,0.301,0.781,0.343,1.131,0.096l2.735-1.954\n    c0.335,0.161,0.68,0.305,1.03,0.425l0.552,3.315C12.657,27.688,13.023,28,13.453,28h3.511c0.429,0,0.795-0.312,0.865-0.733\n    l0.552-3.313c0.354-0.124,0.7-0.266,1.032-0.427l2.732,1.954c0.351,0.247,0.827,0.205,1.132-0.096l2.482-2.482\n    c0.304-0.302,0.343-0.782,0.093-1.13l-1.953-2.734c0.163-0.335,0.304-0.679,0.427-1.03l3.314-0.553\n    c0.423-0.07,0.733-0.437,0.733-0.866v-3.511C28.374,12.648,28.063,12.283,27.641,12.212z M26.618,15.846l-3.111,0.519\n    c-0.336,0.056-0.608,0.3-0.699,0.628c-0.168,0.59-0.404,1.157-0.699,1.688c-0.168,0.297-0.147,0.663,0.051,0.939l1.835,2.568\n    l-1.434,1.431l-2.564-1.834c-0.277-0.199-0.645-0.22-0.939-0.052c-0.528,0.295-1.097,0.532-1.693,0.701\n    c-0.325,0.095-0.568,0.365-0.624,0.701l-0.519,3.11h-2.023l-0.519-3.11c-0.056-0.336-0.299-0.608-0.625-0.701\n    c-0.586-0.166-1.156-0.402-1.694-0.702c-0.294-0.163-0.662-0.145-0.937,0.053l-2.567,1.834l-1.432-1.431l1.834-2.568\n    c0.198-0.276,0.218-0.643,0.05-0.941c-0.294-0.524-0.53-1.092-0.699-1.687c-0.093-0.327-0.365-0.571-0.7-0.627l-3.111-0.519v-2.024\n    l3.111-0.519c0.336-0.056,0.608-0.301,0.701-0.628c0.165-0.587,0.399-1.155,0.698-1.688c0.166-0.296,0.146-0.662-0.052-0.938\n    L6.421,7.48l1.431-1.432l2.567,1.834c0.276,0.198,0.645,0.216,0.94,0.05c0.523-0.294,1.093-0.53,1.69-0.7\n    c0.326-0.093,0.569-0.365,0.625-0.7l0.519-3.11h2.025l0.519,3.11c0.056,0.335,0.299,0.607,0.625,0.7\n    c0.589,0.167,1.158,0.404,1.69,0.702c0.295,0.165,0.662,0.146,0.939-0.052l2.568-1.834l1.43,1.432l-1.831,2.568\n    c-0.198,0.277-0.219,0.643-0.051,0.939c0.295,0.529,0.531,1.097,0.699,1.688c0.091,0.327,0.363,0.572,0.699,0.627l3.111,0.519\n    V15.846z"/>\n</svg>\n');}return __p.join('');};
}).call(this);
(function () {

  'use strict';

  // Formatter available options:
  // number:
  // - prefix (example: Formatter.number(12.34,{prefix:'$'}) => $12.34)
  // - suffix (example: Formatter.number(12.34,{suffix:'%'}) => 12.34%)
  // - decimals: setting decimals after the point, by default set to 2,
  //             force: when true, decimal max will be forced also for non significant values.
  //    * example: Formatter.number(12.34,{decimals:1}) => 12.3)
  //    * example: Formatter.number(12.34,{decimals:0}) => 12)
  //    * example: Formatter.number(0.0012,{decimalPositions: { min:2, max:4}}) => 0.0012),
  //    * example: Formatter.number(1.0012,{decimalPositions: { min:2, max:4}}) => 1.00), its not significant and not force decimals!
  //    * example: Formatter.number(1.0012,{decimalPositions: { min:2, max:4, force: true}}) => 1.0012),
  //    * example: Formatter.number(0.1234,{decimalPositions: { min:2, max:4, force: true}}) => 0.1234),
  // - default (example: Formatter.number('abc',{default:'0.00'}) => 0.00)
  // - limit: set max length of resulted string (example: Formatter.number(12.34,{prefix:'$',limit:5}) => $12.3)
  //
  // range: option applied for both values (from, to) same as for number
  //
  // dateTime:
  // - isUtc: format date and time for UTC time zone
  // - showDate: by default set to false

  var scope = SA.UsingNamespace('SA.Utils');
  scope.Formatter = {
    naValue: '-',
    nmValue: 'NM',
    infinityHtml: {
      positive: '&#8734',
      negative: '-&#8734'
    },
    number: function (num, opt) {
      opt = opt || {};

      if (num === 'NM') return this.nmValue;
      if ([null, undefined].indexOf(num) > -1 || isNaN(num)) return opt.default || this.naValue;

      var prefix = opt.prefix ? [opt.prefix] : [],
        suffix = opt.suffix ? [opt.suffix] : [],
        decimals = [false, 0].indexOf(opt.decimals) > -1 ? {show: false, count: 0} : {show: true, count: opt.decimals || 2};

      if (typeof(num) === 'string') num = parseFloat(num);

      if (num === Number.POSITIVE_INFINITY) return this.infinityHtml.positive;
      if (num === Number.NEGATIVE_INFINITY) return this.infinityHtml.negative;

      if (num < 0) {
        prefix.push('-');
        num = Math.abs(num);
      }

      var preParts = num;

      if (opt.convertKtoM) {
        var v = parseInt(preParts / 100000);
        if (v >= 1 && v < 10) {
          suffix.unshift('M');
          preParts = preParts / 1000000;
        }
      }

      if (opt.forceConvertKtoM) {
        var v = parseInt(preParts / 100000);
        suffix.unshift('M');
        preParts = preParts / 1000000;
      }

      if (!opt.withCommas) {
        if (opt.inMillions) {
          if (parseInt(preParts / 1000) > 0) {
            preParts = preParts / 1000;
            suffix.unshift('B');
          } else {
            suffix.unshift('M');
          }
        } else if (preParts / 1000000000 >= 1) {
          preParts = preParts / 1000000000;
          suffix.unshift('B');
        } else if (preParts / 1000000 >= 1) {
          preParts = preParts / 1000000;
          suffix.unshift('M');
        } else if (((preParts / 10000 >= 1) || (preParts / 1000 >= 1)) && opt.forceK) {
          preParts = preParts / 1000;
          suffix.unshift('K');
        }
      }

      var parts = preParts.toString().split('.'),
          remainder = parts[1] || '0',
          whole = parts[0] || '0';

      if (decimals.show) {
        var
          decimalMin = opt.decimalPositions ? opt.decimalPositions.min : decimals.count,
          decimalMax = opt.decimalPositions ? opt.decimalPositions.max : (decimals.count || 4),
          forceDecimal = !!opt.decimalPositions && !!opt.decimalPositions.force,
          isSignificant = preParts < 0.01,
          maxNonZero = decimalMin;
        decimals.count = decimalMin || 0;

        if (isSignificant || forceDecimal) {
          for (var i = decimalMax; i > decimalMin; i--) {
            if (remainder[i - 1] > 0) {
              maxNonZero = i;
              break;
            }
          }

          if (maxNonZero > decimalMin) {
            decimals.count = isSignificant ? decimalMax : maxNonZero;
          }
        }
      }

      preParts = preParts.toFixed(decimals.count);
      parts = preParts.toString().split('.');
      remainder = parts[1];
      whole = parts[0];

      preParts = whole.replace(/\B(?=(\d{3})+(?!\d))/g, ",") + (remainder ? "." + remainder : "");

      //preParts = preParts.toLocaleString('en',{minimumFractionDigits: decimals.count, maximumFractionDigits: decimals.count});
      if (opt.limit) {
        preParts = preParts.substr(0, opt.limit - (prefix.length + suffix.length));
        if (preParts.indexOf('.') === preParts.length - 1) preParts = preParts.slice(0, preParts.length - 1);
      }
      if (opt.nonSuffix) {
        suffix = '';
      }

      if (opt.reverseNegativePrefix) prefix = prefix.reverse();

      return prefix.concat(preParts).concat(suffix).join('');
    },
    getZeros: function(n){
      return new Array(n+1).join('0');
    },
    separatorNumber: function (n) {
      while (/(\d+)(\d{3})/.test(n.toString())) {
        n = n.toString().replace(/(\d+)(\d{3})/, '$1,$2');
      }
      return n;
    },
    range: function (from, to, opt) {
      return this.number(from, opt) + ' - ' + this.number(to, opt);
    },
    truncate: function (value, maxLength) {
      if (!value) return '';
      return (value.length > maxLength) ? value.substr(0, maxLength) + " ..." : value;
    },
    parseTime: function(value){
      // Safari and IE don't parse 2018-01-23 date format
      if (/^\d+-\d/.test(value)){
        value = value.replace(/-/g,'/');
      }
      return new Date(value);
    },
    dateTime: function (value, isUtc, showDate) {
      var date = this.parseTime(value), dateTime;
      if (!value || isNaN(date)) return '';

      var hr, min;

      if (isUtc) {
        hr = date.getUTCHours();
        min = date.getUTCMinutes();
      } else {
        if (date.getSeconds() > 55) date.setMinutes(date.getMinutes() + 1);
        hr = date.getHours();
        min = date.getMinutes();
      }

      dateTime = [hr % 12 ? hr % 12 : 12, ':', ('0' + min).slice(-2), ' ', (hr >= 12 && hr <= 23) ? 'PM' : 'AM'];

      if (showDate) {
        dateTime = dateTime.concat([' ', this.date(date, isUtc)]);
      }

      return dateTime.join('');
    },
    date: function (date, isUtc, showFullYear, nullValue) {
      nullValue = nullValue || '';
      if (!date) {
        return nullValue;
      }

      var month, day, year;

      if (isUtc) {
        month = date.getUTCMonth();
        day = date.getUTCDate();
        year = date.getUTCFullYear();
      } else {
        month = date.getMonth();
        day = date.getDate();
        year = date.getFullYear();
      }

      if (!showFullYear) {
        year = year % 1000;
      }

      return [month + 1, day, year].join('/');
    },
    capitalize: function (str) {
      str = str.toLowerCase();
      return str.replace(/(\b)([a-zA-Z])/g,
        function (firstLetter) {
          return firstLetter.toUpperCase();
        });
    },
    simpleNumber: function(value) {
      function fixFloat(value, decimals){
        value = value.toFixed(decimals);
        value = value.toString().replace(/\.?0+$/, '');
        return value;
      }

      if (isNaN(parseFloat(value))) return '';
      value = 1*value / 1000000;
      return (value < 0 ? '-' : '') + '$' + (Math.abs(value) >= 1000 ? fixFloat(Math.abs(value)/1000, 2) + 'B' : fixFloat(Math.abs(value), 2) + 'M');
    },
    changeDateFormat: function(dateStr, sourceFormat, destFormat){
      //for now source format will accept lowercase m,d,y letters only.
      if(!!!dateStr){
        return null;
      }
      var positions = {
            dayPosition: {source: {start: 0, end: 0}, dest: {start: 0, end: 0}},
            monthPosition: {source: {start: 0, end: 0}, dest: {start: 0, end: 0}},
            yearPosition: {source: {start: 0, end: 0}, dest: {start: 0, end: 0}}
          },
      result = [],
      seperator = destFormat.match('[^m,d,y]')[0] || '',
      firstSeperatorPos = destFormat.indexOf(seperator),
      lastSeperatorPos = destFormat.lastIndexOf(seperator);

      positions.dayPosition.source.start = sourceFormat.indexOf('d');
      positions.dayPosition.source.end = sourceFormat.lastIndexOf('d');
      positions.monthPosition.source.start = sourceFormat.indexOf('m');
      positions.monthPosition.source.end = sourceFormat.lastIndexOf('m');
      positions.yearPosition.source.start = sourceFormat.indexOf('y');
      positions.yearPosition.source.end = sourceFormat.lastIndexOf('y');

      positions.dayPosition.dest.start = destFormat.indexOf('d');
      positions.dayPosition.dest.end = destFormat.lastIndexOf('d');
      positions.monthPosition.dest.start = destFormat.indexOf('m');
      positions.monthPosition.dest.end = destFormat.lastIndexOf('m');
      positions.yearPosition.dest.start = destFormat.indexOf('y');
      positions.yearPosition.dest.end = destFormat.lastIndexOf('y');

      var idx = 0;
      $.each(Object.keys(positions), function(k){
        for(var i = positions[this].source.start; i <= positions[this].source.end; i++){
          result[positions[this].dest.start + idx] = dateStr[i];
          idx++;
        }
        idx = 0;
      });

      result[firstSeperatorPos] = seperator;
      result[lastSeperatorPos] = seperator;
      return result.join('')
    }
  };

})();











(function (w, SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Widgets.SACharts');
  scope.formatter = SA.Utils.Formatter;

  scope.Settings = function (){
    var ref,
      config,
      $container,
      generalBtnClicked = false;

    function update(id) {
      var areaGraphIcon = w.JST['jst/inline_svg/highchart/area_graph']({width: 17, height: 14}),
        lineGraphIcon = w.JST['jst/inline_svg/highchart/line_graph']({width: 16, height: 12}),
        columnGraphIcon = w.JST['jst/inline_svg/highchart/column_graph']({width: 17, height: 13}),
        datesIcon = w.JST['jst/inline_svg/highchart/dates']({width: 15, height: 14}),
        generalIcon = w.JST['jst/inline_svg/highchart/general']({width: 15, height: 15}),
        html = w.JST['jst/widgets/sacharts/settings_unit']({
          areaGraphIcon: areaGraphIcon,
          lineGraphIcon: lineGraphIcon,
          columnGraphIcon: columnGraphIcon,
          datesIcon: datesIcon,
          generalIcon: generalIcon,
          config: config
        });

      $('#' + id + '-setting-container').html(html).removeClass('hidden');
    }

    function generalChangeEvent(e) {
      var $this = $(e.currentTarget),
        seriesHash;

      switch ($this.data('action')) {
        case 'linear':
          seriesHash = {compare: 'Value', legendOverrideFormat: {suffix:''}, settingUpdate: true};
          ref.chart.update({
            yAxis: {
              type: 'linear',
              labels: {formatter: function() {return scope.formatter.number(this.value, { decimals:2 });}}
            }
          });
          break;

        case 'percentage':
          seriesHash = {compare: 'percent', legendOverrideFormat: {suffix:'%'}, settingUpdate: true};
          ref.chart.update({
            yAxis: {
              type: 'linear',
              labels: {formatter: function() {return scope.formatter.number(this.value, { decimals:2, suffix: '%' });}}
            }
          });
          break;

        case 'log':
          seriesHash = {compare: 'Value', legendOverrideFormat: {suffix:''}, settingUpdate: true};
          ref.chart.update({
            yAxis: {
              type: 'logarithmic',
              labels: {formatter: function() {return scope.formatter.number(this.value, { decimals:2 });}}
            }
          });
          break;
      }

      $.map(ref.chart.series, function(series){
        if (!series.name.match(/Navigator/)) {
          series.update(seriesHash);
        }
      });

      var xAxis = ref.chart.xAxis[0], extreme = xAxis.getExtremes();
      xAxis.setExtremes(extreme.userMin, extreme.userMax + 1);
    }

    function graphChangeEvent(e) {
      var $this = $(e.currentTarget);

      switch ($this.data('action')) {
        case 'line':
          ref.chart.update(
            {
              series: {type: 'line', states: {hover: {enabled: true}}, settingUpdate: true},
              xAxis: {
                crosshair:true,
                tickPositioner: function () {}
              }
            });
          break;

        case 'area':
          ref.chart.update(
            {
              series: {type: 'area', states: {hover: {enabled: true}}, settingUpdate: true},
              xAxis: {
                crosshair:true,
                tickPositioner: function () {}
              }
            });
          break;

        case 'column':
          ref.chart.update(
            {
              series: {type: 'column', states: {hover: {enabled: false}}, settingUpdate: true},
              xAxis: {crosshair:false}
            });
          break;
      }

      updateSeriesFlags($this.data('action'));
      $this.siblings('.btn-li').removeClass('selected');
      $this.addClass('selected');
    }

    function updateSeriesFlags(chartType) {
      var seriesId;
      $.map(ref.chart.series, function(series, i){
        if (!series.name.match(/Navigator/)) {
          if (series.userOptions.id) {
            seriesId = series.userOptions.id;
          }
          if (series.type === 'flags' && seriesId) {
            var onSeries = chartType === 'column' ? '' : seriesId;
            ref.chart.series[i].update({onSeries: onSeries});
          }
        }
      });
    }

    function attachEvents(id) {
      $container = $('#' + id + '-setting-container');

      if (!config.graphBtnDisabled) {
        $container.find('.btn-wrapper .btn[data-action="graph"]').click(function () {
          hidePopups();
          $container.find('.graph-popup').toggleClass('hidden');
          $container.on('click', '.graph-popup .btn-li:visible:not(.disabled)', graphChangeEvent);
        });
      }

      if (!config.datesBtnDisabled) {
        var $btnDates = $container.find('.btn-wrapper .btn[data-action="dates"]');
        $btnDates.click(function () {
          hidePopups();
        });

        initDateRangePicker($btnDates);
      }

      if (!config.generalBtnDisabled) {
        var $btnGeneral = $container.find('.btn-wrapper .btn[data-action="general"]');
        $btnGeneral.on('click', function () {
          var $generalPopup = $container.find('.general-popup');
          hidePopups();

          if (!generalBtnClicked) {
            generalBtnClicked = true;
            $btnGeneral.closest('.sa-chart-settings-container').find('.general-popup input[data-type=' + config.defaultYScale + ']').prop('checked', true);
          }

          $generalPopup.toggleClass('hidden');
          $container.on('click', '.general-popup .btn-li:visible', generalChangeEvent);
        });
      }

      $('body').on('click', function (e) {
        var $target = $(e.target);
        if (!$target.closest('.btn-wrapper').length && !$target.closest('.graph-popup').length && !$target.closest('.general-popup').length) {
          hidePopups();
        }
      });
    }

    function hidePopups() {
      $container.find('.graph-popup').addClass('hidden');
      $container.find('.general-popup').addClass('hidden');
    }

    function initDateRangePicker(dateRange) {
      dateRange.daterangepicker({
        startDate: moment().subtract(30, 'days').format('MM/DD/YYYY'),
        endDate: moment().format('MM/DD/YYYY'),
        ranges: {
          '1D': [moment().toDate(), moment().subtract(1, 'day').toDate()],
          '5D': [moment().toDate(), moment().subtract(5, 'days').toDate()],
          '3M': [moment().toDate(), moment().subtract(3, 'months').toDate()],
          '6M': [moment().toDate(), moment().subtract(6, 'months').toDate()],
          'YTD': [moment().toDate(), moment().startOf('year').toDate()],
          '1Y': [moment().toDate(), moment().subtract(1, 'year').toDate()],
          '5Y': [moment().toDate(), moment().subtract(5, 'years').toDate()]
        },
        opens: 'left',
        showDropdowns: true,
        minYear: moment().subtract(15, 'years').year(),
        maxYear: moment().year(),
        maxDate: moment().format('MM/DD/YYYY'),
        linkedCalendars: false
      });

      dateRange.on('apply.daterangepicker', function(ev, picker) {
        if (picker.chosenLabel === 'Custom Range') {
          ref.chart.xAxis[0].setExtremes(picker.startDate.toDate().getTime(), picker.endDate.toDate().getTime());
        } else {
          ref.chart.xAxis[0].setExtremes(picker.endDate.toDate().getTime(), picker.startDate.toDate().getTime());
        }
      });
    }

    this.render = function(opt) {
      ref = opt.instance;
      config = opt.config;

      if (SA.Utils.Env.isIE()) {
        config.datesBtnDisabled = true;
      }

      update(ref.id);
      attachEvents(ref.id);
    };
  };

}(window, window.SA, window.jQuery));
(function (H) {
  // Pass error messages
  H.Axis.prototype.allowNegativeLog = true;

  // Override conversions
  H.Axis.prototype.log2lin = function (num) {
    var isNegative = num < 0,
      adjustedNum = Math.abs(num),
      result;
    if (adjustedNum < 10) {
      adjustedNum += (10 - adjustedNum) / 10;
    }
    result = Math.log(adjustedNum) / Math.LN10;
    return isNegative ? -result : result;
  };
  H.Axis.prototype.lin2log = function (num) {
    var isNegative = num < 0,
      absNum = Math.abs(num),
      result = Math.pow(10, absNum);
    if (result < 10) {
      result = (10 * (result - 1)) / (10 - 1);
    }
    return isNegative ? -result : result;
  };
}(Highcharts));
'use strict';
function _toConsumableArray(arr) {
  if (Array.isArray(arr)) {
    for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) {
      arr2[i] = arr[i];
    }
    return arr2;
  } else {
    return Array.from(arr);
  }
}

var _window = window;
var _window$Highcharts = _window.Highcharts;
var wrap = _window$Highcharts.wrap;
var pick = _window$Highcharts.pick;
var splat = _window$Highcharts.splat;
var addEvent = _window$Highcharts.addEvent;
var isNumber = _window$Highcharts.isNumber;
var redraw = _window$Highcharts.redraw;


(function (factory) {
  "use strict";

  if (typeof module === "object" && module.exports) {
    module.exports = factory;
  } else {
    factory(Highcharts);
  }
}(function (H) {
  "use strict";

  // wrap(H.Series.prototype, 'drawGraph', function (proceed) {
  //
  //   // Before the original function
  //   // console.log("We are about to draw the graph:", this.graph);
  //
  //   // Now apply the original function with the original arguments,
  //   // which are sliced off this function's arguments
  //   proceed.apply(this, Array.prototype.slice.call(arguments, 1));
  //
  //   // Add some code after the original function
  //   // console.log("We just finished drawing the graph:", this.graph);
  //
  // });

  wrap(H.RangeSelector.prototype, 'clickButton', function (proceed) {

    var
      name = arguments[1],
      rangeSelector = this,
      chart = rangeSelector.chart,
      rangeOptions = rangeSelector.buttonOptions[name],
      baseAxis = chart.xAxis[0],
      unionExtremes = (
        chart.scroller && chart.scroller.getUnionExtremes()
      ) || baseAxis || {},
      dataMin = unionExtremes.dataMin,
      dataMax = unionExtremes.dataMax,
      newMin,
      newMax = baseAxis && Math.round(
        Math.min(baseAxis.max, pick(dataMax, baseAxis.max))
      ), // #1568
      type = rangeOptions.type,
      baseXAxisOptions,
      range = rangeOptions._range,
      rangeMin,
      minSetting,
      rangeSetting,
      ctx,
      ytdExtremes,
      dataGrouping = rangeOptions.dataGrouping;


    // chart has no data, base series is removed
    if (dataMin === null || dataMax === null) {
      return;
    }

    // Set the fixed range before range is altered
    chart.fixedRange = range;

    // Apply dataGrouping associated to button
    if (dataGrouping) {
      this.forcedDataGrouping = true;
      Axis.prototype.setDataGrouping.call(
        baseAxis || { chart: this.chart },
        dataGrouping,
        false
      );

      this.frozenStates = rangeOptions.preserveDataGrouping;
    }

    // Apply range
    if (type === 'month' || type === 'year') {
      if (!baseAxis) {
        // This is set to the user options and picked up later when the
        // axis is instantiated so that we know the min and max.
        range = rangeOptions;
      } else {

        if(rangeSelector.options.forceChangeFromMax){
          newMax = dataMax;
        }

        ctx = {
          range: rangeOptions,
          max: newMax,
          chart: chart,
          dataMin: dataMin,
          dataMax: dataMax
        };
        newMin = baseAxis.minFromRange.call(ctx);

        if (isNumber(ctx.newMax)) {
          newMax = ctx.newMax;
        }
      }

      // Fixed times like minutes, hours, days
    } else if (range) {

      newMin = Math.max(newMax - range, dataMin);
      newMax = Math.min(newMin + range, dataMax);

    } else if (type === 'ytd') {

      // On user clicks on the buttons, or a delayed action running from
      // the beforeRender event (below), the baseAxis is defined.
      if (baseAxis) {
        // When "ytd" is the pre-selected button for the initial view,
        // its calculation is delayed and rerun in the beforeRender
        // event (below). When the series are initialized, but before
        // the chart is rendered, we have access to the xData array
        // (#942).
        if (dataMax === undefined) {
          dataMin = Number.MAX_VALUE;
          dataMax = Number.MIN_VALUE;
          each(chart.series, function (series) {
            // reassign it to the last item
            var xData = series.xData;
            dataMin = Math.min(xData[0], dataMin);
            dataMax = Math.max(xData[xData.length - 1], dataMax);
          });
          redraw = false;
        }
        ytdExtremes = rangeSelector.getYTDExtremes(
          dataMax,
          dataMin,
          chart.time.useUTC
        );
        newMin = rangeMin = ytdExtremes.min;
        newMax = ytdExtremes.max;

        // "ytd" is pre-selected. We don't yet have access to processed
        // point and extremes data (things like pointStart and pointInterval
        // are missing), so we delay the process (#942)
      } else {
        addEvent(chart, 'beforeRender', function () {
          rangeSelector.clickButton(name);
        });
        return;
      }
    } else if (type === 'all' && baseAxis) {
      newMin = dataMin;
      newMax = dataMax;
    }

    newMin += rangeOptions._offsetMin;
    newMax += rangeOptions._offsetMax;

    // This update was removed to enable selection of default button (MAX)
    // in case of less data in axis against selected rangeSelector button

    // rangeSelector.setSelected(name);

    // Update the chart
    if (!baseAxis) {
      // Axis not yet instanciated. Temporarily set min and range
      // options and remove them on chart load (#4317).
      baseXAxisOptions = splat(chart.options.xAxis)[0];
      rangeSetting = baseXAxisOptions.range;
      baseXAxisOptions.range = range;
      minSetting = baseXAxisOptions.min;
      baseXAxisOptions.min = rangeMin;
      addEvent(chart, 'load', function resetMinAndRange() {
        baseXAxisOptions.range = rangeSetting;
        baseXAxisOptions.min = minSetting;
      });

    } else {
      // Existing axis object. Set extremes after render time.
      baseAxis.setExtremes(
        newMin,
        newMax,
        pick(redraw, 1),
        null, // auto animation
        {
          trigger: 'rangeSelectorButton',
          rangeSelectorButton: rangeOptions
        }
      );
    }

    //Mone Event Add subscriptionAction to charter configuration
    if(baseAxis && !!chart.userOptions.mone){
      chart.userOptions.mone.callback('RangeSelector', rangeOptions.text, false);
    }

  });

}));
// Highchart highstock source ref









// Custom components








// This class fix RangeSelector



//= //require widgets/sacharts/tester




;
(function (SA, $) {
  'use strict';

  var scope = SA.UsingNamespace('SA.Widgets.Pro');
  scope.TickerSentiment = function (opt) {
    if (!(this instanceof scope.TickerSentiment)) {
      return new scope.TickerSentiment(opt);
    }
  };

}(window.SA, window.jQuery));
(function() { this.JST || (this.JST = {}); this.JST["jst/pages/symbols/score_line_unit"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div class=\'h-title\'>',  scoreData.title ,'\n  ');  if (locker) { ; __p.push(' ',  locker ,'\n  ');  } else { ; __p.push('\n    <span class=\'rating\'>',  scoreData.averageScore ,'</span>\n  ');  } ; __p.push('\n</div>\n<div class="score-container clearfix">\n  <div class="slider-container score-slider">\n    ');  for (var i = 0; i < scoreValues.length; i++) { ; __p.push('\n      <div class="slider-point p',  scoreValues[i] ,'"></div>\n      <div class="slider-point p',  scoreValues[i] ,'-label"><p>',  scoreValues[i] ,'\n          <br/>',  (scoreTitles[i].short || scoreTitles[i].title) ,'\n        </p>\n      </div>\n    ');  } ; __p.push('\n    <div class="slider-point score-point" title="',  scoreData.averageScore ,'"></div>\n  </div>\n</div>\n');}return __p.join('');};
}).call(this);

(function (w, SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Widgets.Pro');

  scope.PieChartSideWidget = function (opt) {
    var $mainContainer, $sliderSectionContainer,
      chartsRef, locker,
      ticker, averageScoreObj, scoreTimeFrame, itemsInfo,
      chartsConfigs,customPieOpt, customLegend, customNativeLegend, scoreItems, formatter = SA.Utils.Formatter;


    init(opt);

    this.hide = function () {
      $mainContainer.addClass('hidden');
    };

    this.show = function () {
      $mainContainer.removeClass('hidden');
    };

    function init(opt) {
      initVars(opt);
      if (validate()) {
        // slider chart section:
        if ($sliderSectionContainer.length) {
          generateSliderSection();
          if (locker) $mainContainer.find('.slider-container.score-slider').find('.score-point').hide();
          else renderSliderData();
        }
        // pie chart section:
        if ($('#' + chartsConfigs.id).length) {
          generateChartContainer();
          addSeries();
          cleanZeroData();
        }
        if (customLegend) renderLegend();
      }
    }

    function initVars(data) {
      ticker = data.slug;
      locker = data.chartData.locker;
      $mainContainer = data.$mainContainer;
      if (data.isWide) $mainContainer.addClass('.wide');
      $sliderSectionContainer = data.$sliderSectionContainer || $mainContainer.find('.pie-chart-widget-header');
      var chartData = data.chartData;
      if (chartData){
        averageScoreObj = {
          title: chartData.averageScoreObj.title || '',
          value: chartData.averageScoreObj.value
        };
        customPieOpt = chartData.customPieOpt;
        customLegend = chartData.customLegend;
        customNativeLegend = chartData.nativeLegend;
        scoreTimeFrame = chartData.scoreTimeFrame;
        itemsInfo = chartData.itemsInfo;
        chartsConfigs = {
          id: chartData.chartId,
          title: ['<p class="breakdown-section">', chartData.chartTitle, '</p>'].join('')
        };
      }
      scoreItems = data.scoreClasses;
    }

    function validate() {
      return ticker &&
        $mainContainer.length;
    }

    function generateSliderSection() {
      var scoreValues = [], scoreTitles = [];
      if (scoreItems){
        $.each(scoreItems, function (k,v) {
          scoreValues.push(k);
          scoreTitles.push(v);
        });
      }
      var html = w.JST['jst/pages/symbols/score_line_unit']({
        name: ticker,
        scoreData: {
          title: averageScoreObj.title,
          averageScore: formatter.number(averageScoreObj.value, {decimals: 2})
        },
        scoreValues: scoreValues,
        scoreTitles: scoreTitles,
        locker: locker
      });
      $sliderSectionContainer.html(html);
    }

    function renderSliderData() {
      var container = $mainContainer.find('.slider-container.score-slider'),
        scorePosition,
        sections = Object.keys(scoreItems),
        ticksNum = sections.length - 1,
        tickWidth = container.width() / ticksNum,
        score = parseFloat(averageScoreObj.value);
      scorePosition = (score-1) * tickWidth - container.find('.score-point').width() / 2 - 1;
      container.find('.score-point').css('left', scorePosition + 'px');
    }

    function renderLegend() {
      $mainContainer.find('.sa-chart-wrapper').after(customLegend);
      $mainContainer.find('.highcharts-legend').remove();
    }

    function generateChartContainer() {
      var override = {
        chart: {
          type: 'pie',
          height: 160,
          width: 280,
          spacingLeft: -20
        },
        legend: customNativeLegend || {
          enabled: true,
          align: 'right',
          layout: 'vertical',
          verticalAlign: 'middle',
          itemMarginTop: 5, // Space between each category in the legend
          itemMarginBottom: 5,
          margin: 0,
          padding: 0,
          y: 0,
          x: -20,
          symbolRadius: 0,
          useHTML: true,
          labelFormatter: function () {
            return this.name + ': ' + this.y;
          }
        },
        rangeSelector: {enabled: false},
        plotOptions: {
          pie: $.extend({
            allowPointSelect: true,
            cursor: 'pointer',
            dataLabels: {enabled: false},
            showInLegend: true,
            borderWidth: 0
          }, customPieOpt || {}),
          series: {enableMouseTracking: false} //disable hover on pie
        },
        lang: {noData: noDataMessage()}
      };

      var charter = new SA.Widgets.SACharts.Charter(chartsConfigs);
      chartsRef = charter.renderChart(override);
    }

    function addSeries() {
      chartsRef.addSingleSeries({
        data: $.map(itemsInfo, function (obj, _) {
          return {name: obj.name, y: parseInt(obj.count)};
        }),
        type: 'pie',
        name: 'Count',
        colors: $.map(itemsInfo, function (obj, _) {
          return obj.color;
        })
      });
    }

    function noDataMessage() {
      return 'No Data Available.';
    }

    function cleanZeroData() {
      $.each($('#' + chartsConfigs.id + '-chart-container').highcharts().series[0].points, function (i, p) {
        if (!p.y) {
          p.graphic.destroy();
        }
      });
    }

  };

}(window, window.SA, window.jQuery));

(function (w, SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Pages.Symbols');

  scope.SentimentsWidget = new function () {
    var promise, $sentimentContainer, ticker,
      isValid, chartObj,
      tickerData = {}, isWide = false;

    this.promise = function (opt) {
      if (promise) return promise;
      promise = $.Deferred();
      initData(opt);
      isValid = validate();
      if (isValid) {
        init();
        promise.resolve();
      } else {
        $.get('/pro_sidebar', {items: ['sentiments'], slug: opt.slug}).done(function (res) {
          initData(res);
          isValid = validate();
          if (isValid)
            init();
        }).always(promise.resolve);
      }
      return promise;
    };

    this.show = function () {
      if (isValid && chartObj) {
        chartObj.show();
        SA.Logger.Mone.event('', SA.pageConfig.Data.pageType, 'author_sentiment_unit_shown', {data: {ticker: ticker}});
      }
    };

    this.hide = function () {
      chartObj.hide();
    };

    this.attachTo = function ($element) {
      if ($sentimentContainer)
        $sentimentContainer.detach().appendTo($($element));
    };

    this.sentimentsData = function () {
      return tickerData;
    };

    // private

    function initData(dataSource) {
      if (dataSource) {
        tickerData.ticker = tickerData.ticker || dataSource.slug || (dataSource.object || {}).name || dataSource.primaryTicker;
        $sentimentContainer = $sentimentContainer || dataSource.$sentimentContainer || $('#sentiments');
        tickerData.averageSentimentScore = tickerData.averageSentimentScore || dataSource.averageSentimentScore;
        tickerData.sentimentTimeFrame = tickerData.sentimentTimeFrame || dataSource.sentimentTimeFrame;
        tickerData.authorCount = tickerData.authorCount || dataSource.authorCount;
        tickerData.symbolSentimentData = tickerData.symbolSentimentData || dataSource.symbolSentimentInfo;
        tickerData.customLegend = prepareLegend(tickerData.symbolSentimentData);
        isWide = isWide || dataSource.isWide;
      }
    }

    function validate() {
      return (tickerData.ticker &&
        $sentimentContainer.length &&
        tickerData.averageSentimentScore &&
        tickerData.sentimentTimeFrame &&
        tickerData.authorCount &&
        tickerData.symbolSentimentData);
    }

    function prepareLegend(itemsInfo) {
      var html = $.map(itemsInfo, function (item) {
        return [
          '<li>',
          '<span style="background-color:', item.color, '"></span>',
          '<a href="/symbol/', tickerData.ticker, '/ratings/author-ratings#filter=', item.name.toLowerCase().replace(/ /g, '_'), '"',
          ' sasource="average_sentiment_', item.name, '">',
          item.name, ': ', item.count,
          '</a>',
          '</li>'
        ].join('');
      });
      return '<ul class="pie-chart-legend">' + html.join('') + '</ul>';
    }

    function init() {
      chartObj = new SA.Widgets.Pro.PieChartSideWidget({
        slug: tickerData.ticker,
        isWide: isWide,
        $mainContainer: $sentimentContainer,
        $sliderSectionContainer: $sentimentContainer.find('.pie-chart-widget-header'),
        chartData: {
          chartId: 'sentiments-pie',
          chartTitle: tickerData.authorCount + ' Author' + (tickerData.authorCount > 1 ? 's' : '') + ' in the ' + tickerData.sentimentTimeFrame,
          averageScoreObj: {title: 'Average Author Rating', value: tickerData.averageSentimentScore},
          scoreTimeFrame: tickerData.sentimentTimeFrame,
          analystsCount: tickerData.authorCount,
          itemsInfo: tickerData.symbolSentimentData,
          customLegend: tickerData.customLegend
        },
        scoreClasses: {
          1: {title: 'Very Bearish', short: 'V. Bearish'},
          2: {title: 'Bearish'},
          3: {title: 'Neutral'},
          4: {title: 'Bullish'},
          5: {title: 'Very Bullish', short: 'V. Bullish'}
        }
      });
    }
  };

}(window, window.SA, window.jQuery));

(function (w, SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Pages.Symbols');

  scope.SellSideRatings = new function () {
    var $sellSideContainer, isWide,
      ticker, averageScore, scoreTimeFrame,
      analystsCount, sellSideInfo, chartObj,
      isValid, promise, grades = ['Sell', 'Underperform', 'Hold', 'Outperform', 'Buy'];

    this.promise = function (opt) {
      if (promise) return promise;
      promise = $.Deferred();
      isValid = validate(opt);
      if (isValid) {
        init();
        promise.resolve();
      } else {
        $.get('/pro_sidebar', {items: ['sell_side_ratings'], slug: opt.slug}).done(function (res) {
          isValid = validate(res);
          if (isValid)
            init();
        }).always(promise.resolve);
      }
      return promise;
    };

    this.show = function () {
      if (isValid && chartObj) {
        chartObj.show();
        SA.Logger.Mone.event('', SA.pageConfig.Data.pageType, 'sell_side_unit_shown', {data: {ticker: ticker}});
      }
    };

    this.getData = function (){
      return {value: 5 - Math.round(averageScore), text: grades[Math.round(averageScore) - 1 ]};
    };

    this.hide = function () {
      chartObj.hide();
    };

    // private

    function validate(dataSource) {
      if (dataSource) {
        ticker = ticker || dataSource.slug || (dataSource.object || {}).name || dataSource.primaryTicker;
        $sellSideContainer = $sellSideContainer || dataSource.$sellSideContainer || $('#sell-side-ratings');
        averageScore = averageScore || dataSource.sellSideRating;
        scoreTimeFrame = 'Last 90 Days';
        sellSideInfo = sellSideInfo || dataSource.sellSideInfo;
        analystsCount = 0;
        if (sellSideInfo)
          sellSideInfo.forEach(function (item) {
            analystsCount += parseInt(item.count);
          });
        isWide = isWide || !!dataSource.isWide;

        return ticker &&
          $sellSideContainer.length &&
          averageScore &&
          scoreTimeFrame &&
          analystsCount &&
          sellSideInfo;
      }
    }

    function prepareLegend(itemsInfo) {
      var html = $.map(itemsInfo, function (item) {
        return [
          '<li>',
          '<span style="background-color:', item.color, '"></span>',
          '<p>', item.name, ': ', parseInt(item.count), '</p>',
          '</li>'
        ].join('');
      });
      return '<ul class="pie-chart-legend">' + html.join('') + '</ul>';
    }

    function init() {
      chartObj = new SA.Widgets.Pro.PieChartSideWidget({
        slug: ticker,
        isWide: isWide,
        $mainContainer: $sellSideContainer,
        $sliderSectionContainer: $sellSideContainer.find('.pie-chart-widget-header'),
        chartData: {
          chartId: 'sell-side-pie',
          chartTitle: analystsCount + ' Analyst' + (analystsCount > 1 ? 's' : '') + ' in the ' + scoreTimeFrame,
          averageScoreObj: {title: 'Sell Side Rating', value: averageScore},
          scoreTimeFrame: scoreTimeFrame,
          analystsCount: analystsCount,
          itemsInfo: sellSideInfo,
          customLegend: prepareLegend(sellSideInfo)
        },
        scoreClasses: {
          1: {title: 'Sell'},
          2: {title: 'Underperform'},
          3: {title: 'Hold'},
          4: {title: 'Outperform'},
          5: {title: 'Buy'}
        }
      });
    }
  };
}(window, window.SA, window.jQuery));
(function (w, SA, $) {

  'use strict';

  var $chartContainer = $('#price-chart-wrapper'),
    pageData = SA.pageConfig.Data,
    primaryTicker,
    tickerType,
    formatter = SA.Utils.Formatter,
    dataPromises = {
      'index': indexData,
      'crypto': cryptoData,
      'other': tickerData,
    },
    mappers = {
      'index': mapIndexData,
      'crypto': mapCryptoData,
      'other': mapTickerData,
    };

  function tickerData(slug) {
    var dfd = $.Deferred();
    SA.Utils.SymbolData.getFromSuperQuotes([slug], dfd.resolve);
    return dfd;
  }

  function indexData(slug) {
    var dfd = $.Deferred();
    SA.Utils.SymbolData.getCachedRealTimeIndices([slug], dfd.resolve);
    return dfd;
  }

  function cryptoData(slug) {
    var cryptoSlug = slug.split('-')[0].toUpperCase();
    var currency = slug.split('-')[1].toUpperCase();
    return SA.Utils.cryptoAPI.priceMultiFull([cryptoSlug], [currency])
  }

  function getQClass(num) {
    if (num < 0) {
      return 'down';
    } else if (num > 0) {
      return 'up';
    } else {
      return '';
    }
  }

  function overrideRealData(ticker) {
    $.when(dataPromises[tickerType](ticker).then(function(sqData) {
      var realData = mappers[tickerType](sqData);
      if(realData && realData.lastPrice) displayRealData(realData);
    }));
  }

  function mapTickerData(sqData) {
    var slug = SA.pageConfig.Data.object.slug;
    return extractData(sqData[slug], "Last", "Change", "PercentChange");
  }

  function mapCryptoData(sqData) {
    var cryptoSlug = pageData.object.slug.split('-')[0].toUpperCase(),
      currency = pageData.object.slug.split('-')[1].toUpperCase(),
      responseData = (sqData.RAW[cryptoSlug] || {})[currency];
    if(responseData) {
      return extractData(responseData, "PRICE", "CHANGE24HOUR", "CHANGEPCT24HOUR");
    }
    return {};
  }

  function mapIndexData(sqData) {
    if(sqData[0].Outcome === "Success" && sqData[0].Value) {
      return extractData(sqData[0].Value, "Last", "ChangeFromOpen", "PercentChangeFromOpen");
    } else if(sqData[0].Outcome === 'Success' && sqData[0]) {
      return extractData(sqData[0], "Last", "Change", "PercentChange");
    }
  }

  function extractData(source, last, change, percentChange) {
    var data = {};
    if(source == null) return data;
    data.lastPrice = formatter.number(source[last]);
    data.change = formatter.number(source[change]);
    data.percentChange = formatter.number(source[percentChange]);
    data.percentChangeText = '(' + formatter.number(data.percentChange, {suffix:'%'}) + ')';
    return data;
  }

  function displayRealData(data) {
    var $lastPrice = $chartContainer.find('.last-price');
    $lastPrice.text(data.lastPrice);
    if((data.lastPrice || {}).length > 7) $lastPrice.addClass('wide-price');
    $chartContainer.find('.change').text(data.change);
    $chartContainer.find('.change, .percent').removeClass('up down').addClass(getQClass(data.percentChange));
    $chartContainer.find('.percent').text(data.percentChangeText);
  }

  function getTickerType() {
    var isCrypto = ((pageData.qmChartData || {})['isCrypto'] || false),
      isIndex = ((pageData.qmChartData || {})['isIndex'] || false);
    if(isCrypto) return 'crypto';
    if(isIndex) return 'index';
    return 'other';
  }

  function setTickerVars() {
    tickerType = getTickerType();
    primaryTicker = (pageData.primaryTicker || (pageData.object || {})['slug'] || (pageData.article || {})['primaryTicker'] || '');
    var indexPrimaryTicker = (pageData.indexTickers || {})[primaryTicker.toUpperCase()];
    if (indexPrimaryTicker) {
      primaryTicker = indexPrimaryTicker;
    }
  }

  function init() {
    setTickerVars();
    if (pageData.object && primaryTicker) {
      overrideRealData(primaryTicker);
    }
  }

  function widgetIsAvaliable() {
    return ['single_news', 'article'].includes(SA.pageConfig.name || SA.pageConfig.Data.pageType);
  }

  if (widgetIsAvaliable()) init();

}(window, window.SA, window.jQuery));
(function() { this.JST || (this.JST = {}); this.JST["jst/pages/symbols/cress_cap_unit"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div class=\'h-title\'>Quant Rating <span class="rating">',  rankScore ,'</span></div>\n<div class="score-container clearfix">\n  <div class="slider-container score-slider">\n    <div class="slider-point very-bullish"></div>\n    <div class="slider-point very-bullish-label"><p>5<br/>V. Bullish</p></div>\n    <div class="slider-point bullish"></div>\n    <div class="slider-point bullish-label"><p>4<br/>Bullish</p></div>\n    <div class="slider-point neutral"></div>\n    <div class="slider-point neutral-label"><p>3<br/>Neutral</p></div>\n    <div class="slider-point bearish"></div>\n    <div class="slider-point bearish-label"><p>2<br/>Bearish</p></div>\n    <div class="slider-point very-bearish"></div>\n    <div class="slider-point very-bearish-label"><p>1<br/>V. Bearish</p></div>\n    <div class="slider-point score-point" title="',  rankScore ,'"></div>\n  </div>\n</div>\n<ul class="table">\n  ');  jQuery.each(categoryGradedDdata, function (index, item) {
      var $menu_item = $('a[data-cresscap-id=' + item.category_id + ']'),
        linkClass = ($menu_item.length) ? 'cresscap-category-link' : 'cresscap-category-link-disabled',
        class_name = item.is_default ? '-' : item.class,
        data_value = item.is_default ? '-' : item.grade;
    ; __p.push('\n    <li class="clearfix">\n      <div class="category-name pull-left"><a href=\'#\' class="', linkClass,'" data-category-id="',  item.category_id ,'">',  item.category_name ,'</a></div>\n      <div class="grade ',  class_name ,' pull-right" data-grade="',  data_value ,'">',  data_value ,'</div>\n    </li>\n  ');  }); ; __p.push('\n</ul>\n');}return __p.join('');};
}).call(this);

(function (w, SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Pages.Symbols.CresscapRatings');

  var $cresscapRatingsContainer = $('#cresscap-ratings'),
    $cresscapRatingsHeader = $cresscapRatingsContainer.find('.cresscap-ratings-header'),
    $cresscapCategoryRatings = $cresscapRatingsContainer.find('#cresscap-category-ratings'),
    ticker,
    chartsRef,
    dataPromise,
    pageData = SA.pageConfig.Data,
    chartsConfigs,
    categoryGradedDdata,
    rankScore,
    rankTitle,
    scoreList,
    explanations;

  scope.promise = function (opt) {
    if (dataPromise) return dataPromise;
    dataPromise = $.Deferred();
    $.get(SA.Pages.Symbols.Common.baseUrl + '/cresscap/categories_ratings', {slug: opt.slug}).always(function (res) {
      init(res);
      dataPromise.resolve();
    });
    return dataPromise;
  };

  scope.getData = function (){
    return {grades: categoryGradedDdata, score: rankScore, title: rankTitle, explanations: explanations}
  };

  scope.show = function () {
    if (!categoryGradedDdata.length) {
      return false;
    }

    $cresscapRatingsContainer.removeClass('hidden');
    SA.Logger.Mone.event('', pageData.pageType, 'cresscap_ratings_unit_shown', {data: {ticker: ticker}});
    generateRatingsSection();
    attachClickEvent();
  };

  function attachClickEvent() {
    $('.cresscap-category-link').on('click', function (e) {
      e.preventDefault();
      var category_id = $(this).data('category-id');
      if (category_id) {
        var $menu_item = $('a[data-cresscap-id=' + category_id + ']');
        if ($menu_item.length) {
          $menu_item.click();
          window.scrollTo(0, 0);
        }
      }
    });
  }

  function generateRatingsSection() {
    var html = w.JST['jst/pages/symbols/cress_cap_unit']({
      rankScore: rankScore,
      categoryGradedDdata: categoryGradedDdata
    });

    $cresscapRatingsHeader.html(html);
    renderSliderData(rankScore);
  }

  function renderSliderData(score) {
    var container = $('#cresscap-ratings-container .slider-container.score-slider'),
      scorePosition,
      sectionPosition,
      portionWidth = container.width() / 4,
      section = 1;

    while (score >= scoreList[section]) {
      section++;
    }
    section--;

    sectionPosition = (score - scoreList[section]) / (scoreList[section + 1] - scoreList[section]);
    scorePosition = (sectionPosition * portionWidth + section * portionWidth) - container.find('.score-point').width() / 2 ;
    container.find('.score-point').css('left', finalAdjustment(score, scorePosition) + 'px');
  }

  function finalAdjustment(score, scorePosition) {
    if (score == 1) {
      return scorePosition + 1;
    } else if (score == 5) {
      return scorePosition - 1;
    } else if (score == 4) {
      return scorePosition + 6;
    } else {
      return scorePosition;
    }
  }

  function init(res) {
    ticker = (pageData.object || {}).name || pageData.primaryTicker;
    categoryGradedDdata = res['category_graded_data'];
    rankScore = SA.Utils.Formatter.number(res['rank_score'], {withCommas: false, decimals: 2});
    rankTitle = res['rank_name'];
    chartsConfigs = {
      id: 'cresscap-ratings-pie'
    };
    scoreList = [1, 2, 3, 4, 5, 6];
    explanations = res.explanations;
  }

}(window, window.SA, window.jQuery));
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/pro/viewed_stocks"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div class="pro-stock-ticker-unit">\n  <div class="rail_header">Recently Viewed Stocks</div>\n\n  ');  jQuery.each(tickers, function (slug, name) { ; __p.push('\n    ');  var priceChange = 0; ; __p.push('\n    ');  if (priceChanges[slug.toLowerCase()]) { ; __p.push('\n    ');   priceChange = priceChanges[slug.toLowerCase()]['PercentChange'] ; __p.push('\n    ');  } ; __p.push('\n    <div class="row">\n      <div class="col-xs-3 ticker-slug-name">\n        <a href="/symbol/',  slug ,'" sasource="recently_viewed_stocks" title="',  name ,'">',  slug ,'</a>\n      </div>\n      <div class="col-xs-6">\n        <a href="/symbol/',  slug ,'" sasource="recently_viewed_stocks" title="',  name ,'">',  name ,'</a>\n      </div>\n      <div class="col-xs-3">\n        <div class="percent-change ',  (priceChange < 0 ? 'down' : 'up') ,'"\n             data-value="',  priceChange ,'"> ',  SA.Utils.Formatter.number(priceChange, {
              decimalPositions: {
                max: 4,
                min: 2
              },
              suffix: '%'
            }) ,'\n        </div>\n      </div>\n    </div>\n  ');  }); ; __p.push('\n\n  <a class="rail_link"\n     href="/account/recently-viewed-stocks" sasource="recently_viewed_stocks">All Recently Viewed Stocks\n  </a>\n</div>\n');}return __p.join('');};
}).call(this);

(function (SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Widgets.Pro');
  scope.RecentlyViewedStocks = function (opt) {

    opt = opt || {};

    var $container, promise, data;

    this.promise = function () {
      return promise;
    };

    this.show = function () {
      SA.Utils.SymbolData.getFromSuperQuotes(Object.keys((data || {}).tickers), buildUnit);
    };

    function buildUnit(priceChanges) {
      var tickers = (data || {}).tickers;

      if (tickers && Object.keys(tickers).length >= 3) {
        $container.find('#stock-units').append($(JST['jst/widgets/pro/viewed_stocks']({
          tickers: tickers,
          priceChanges: priceChanges
        })));

        $('#pro-sticky-units').sticky();
      }
    }

    function onDone(res) {
      data = res;
      promise.resolve();
    }

    function init() {
      if (($container = opt.$container).length) {
        promise = $.Deferred();
        $.get('/pro_sidebar', {items: ['viewed_stocks']}).done(onDone);
      }
    }

    init();
  };

}(window.SA, window.jQuery));

(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/pro/key_data"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('');  if (marketCap || revGrowth || forwardPERatio || trailingPERatio || dividendYield) { ; __p.push('\n  <div class="rail_header">',  slug ,' Key Data</div>\n  <ul class="table">\n    <li>\n      <div>Market Cap</div>\n      ');  if (marketCap) { ; __p.push('\n        <div>',  marketCap ,'</div>\n      ');  } else{ ; __p.push('\n        <div>-</div>\n      ');  } ; __p.push('\n    </li>\n\n    <li>\n      <div>Rev Growth (3Y CAGR)</div>\n      ');  if (revGrowth) { ; __p.push('\n        <div>',  revGrowth ,'</div>\n      ');  } else{ ; __p.push('\n        <div>-</div>\n      ');  } ; __p.push('\n    </li>\n\n    <li>\n      <div>Forward PE Ratio</div>\n      ');  if (forwardPERatio && parseFloat(forwardPERatio) > 0) { ; __p.push('\n        <div>',  forwardPERatio ,'</div>\n      ');  } else{ ; __p.push('\n        <div>-</div>\n      ');  } ; __p.push('\n    </li>\n\n    <li>\n      <div>Trailing PE Ratio</div>\n      ');  if (trailingPERatio && parseFloat(trailingPERatio) > 0) { ; __p.push('\n        <div>',  trailingPERatio ,'</div>\n      ');  } else{ ; __p.push('\n        <div>-</div>\n      ');  } ; __p.push('\n    </li>\n\n    <li>\n      <div>Dividend Yield</div>\n      ');  if (dividendYield) { ; __p.push('\n        <div>',  dividendYield ,'</div>\n      ');  } else{ ; __p.push('\n        <div>-</div>\n      ');  } ; __p.push('\n    </li>\n\n    <li>\n      <a class="rail_link key-data" href="/symbol/',  slug ,'/peers/comparison" sasource="key_data_right_rail">Compare to Peers</a>\n    </li>\n  </ul>\n');  } ; __p.push('\n\n\n');}return __p.join('');};
}).call(this);

(function (SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Widgets.Pro');
  scope.TickerKeyData = function (opt) {

    opt = opt || {};

    var promise, data,
      slug = opt.slug,
      $container = opt.container || $('#ticker-key-data-wrapper').find('.key-data').first(),
      showPermit;

    this.promise = function () {
      return promise;
    };

    this.show = function () {
      if (data) {
        $container.append($(JST['jst/widgets/pro/key_data']({
          slug: slug.toUpperCase(),
          marketCap: data.market_cap,
          revGrowth: data.revenue_growth3,
          forwardPERatio: data.pe_ratio_fwd,
          trailingPERatio: data.pe_ratio_trl,
          dividendYield: data.div_yield
        })));
      }
    };

    function onDone(res) {
      data = (res || {}).key_data;
      promise.resolve();
    }

    function init() {
      if ($container.length) {
        promise = $.Deferred();
        var chartData = SA.pageConfig.Data.qmChartData;
        if (chartData)
          showPermit = !(chartData.isCEF || chartData.isCrypto || chartData.isETF || chartData.isIndex || chartData.isMF);
        if (showPermit)
          $.get('/pro_sidebar', {items: ['ticker_key_data'], slug: slug}).done(onDone);
        else promise.resolve();
      }
    }

    init();
  };

}(window.SA, window.jQuery));
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/pro/ratings_summary"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<h4 class="rail_header">',  slug ,' Ratings Summary</h4>\n<ul class="table">\n\n  ');  for (var key in items){ ; __p.push('\n    <li class="ratings">\n      ');  if (items[key].link) { ; __p.push('\n        <a class="cover-name" href="',  items[key].link ,'">',  items[key].title ,'</a>\n      ');  } else { ; __p.push('\n          <div class="cover-name">',  items[key].title ,'</div>\n      ');  } ; __p.push('\n      <div class="type ratings ',  items[key].data.text.toLowerCase().split(' ').join('_') ,'">',  items[key].data.text ,'</div>\n    </li>\n  ');  } ; __p.push('\n\n</ul>\n');}return __p.join('');};
}).call(this);




(function (SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Widgets.Pro');
  scope.TickerRatingsSummary = function (opt) {

    opt = opt || {};

    var data = {},
      pageData = SA.pageConfig.Data,
      slug = opt.slug.toUpperCase(),
      $container = opt.container || $('#ticker-ratings-summary-wrapper');

    this.promise = function () {
    };

    this.show = function () {
      var content = {
        slug: slug, items: {
          quantRating: {
            data: {value: 'not_covered', text: 'Not Covered'},
            title: 'Quant Rating',
            link: '/symbol/' + slug + '/ratings/quant-ratings'
          },
          saAuthorRating: {
            data: {value: 'not_covered', text: 'Not Covered'},
            title: 'SA Authors Rating',
            link: '/symbol/' + slug + '/ratings/author-ratings'
          },
          sellSideRating: {
            data: {value: 'not_covered', text: 'Not Covered'},
            title: 'Sell Side Rating',
            link: '/symbol/' + slug + '/ratings/sell-side-ratings'
          }
        }
      };
      if (!isNaN(data.averageSentimentScore)) {
        content.items.saAuthorRating.data.value = data.averageSentimentScore;
        content.items.saAuthorRating.data.text = ['Very Bullish', 'Bullish', 'Neutral', 'Bearish', 'Very Bearish'][data.averageSentimentScore];
      }
      if (data.symbolScore && !isNaN(parseInt(data.symbolScore.value)) && parseInt(data.symbolScore.value) >= 0) {
        content.items.sellSideRating.data = data.symbolScore;
      }
      if (data.quantRating && !isNaN(parseInt(data.quantRating.value)) && parseInt(data.quantRating.value) >= 0) {
        content.items.quantRating.data = data.quantRating;
      }
      $container.append($(JST['jst/widgets/pro/ratings_summary'](content)));
    };


    function init() {

      if ($container.length) {
        $.when.apply($, [ SA.Pages.Symbols.SellSideRatings.promise({slug: slug}),
                          SA.Pages.Symbols.CresscapRatings.promise({slug: slug})], this)
          .then(function () {
            $.extend(data, {averageSentimentScore: 5 - Math.round(pageData.averageSentimentScore)});
            $.extend(data, {symbolScore: SA.Pages.Symbols.SellSideRatings.getData()});
            var cs_rait = SA.Pages.Symbols.CresscapRatings.getData();
            $.extend(data, {quantRating: {value: 5 - Math.round(cs_rait.score), text: cs_rait.title}});
          });
      }
    }

    init();
  };

}(window.SA, window.jQuery));
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/pro/author_covers"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push(''); 
    var count = 0;
    for (property in coveredStocks) count++;
  ; __p.push('\n\n');  if (count >= 2) { ; __p.push('\n  <div class="t-snap">\n    <div class="title">\n      <div class="rail_header">This Author Also Covers</div>\n    </div>\n  </div>\n  <ul class="table">\n    ');  jQuery.each(coveredStocks, function (k, v) { ; __p.push('\n      <li>\n        <div class="cover-name" title="',  v.name ,'">',  v.name ,'</div>\n        <div class="type ',  v.rating_text.toLowerCase().split(' ').join('_') ,'">',  v.rating_text ,'</div>\n      </li>\n    ');  }); ; __p.push('\n\n    <li>\n      <a class="rail_link about_article"\n         href="/author/',  authorSlug ,'/coverage?scroll=true" sasource="author_covered_stocks">Author\'s Full Rating History</a>\n      </a>\n    </li>\n  </ul>\n');  } ; __p.push('\n');}return __p.join('');};
}).call(this);

(function (SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Widgets.Pro');
  scope.AuthorCovers = function (opt) {

    opt = opt || {};

    var promise, data,
      slug = opt.slug,
      authorSlug,
      config = SA.pageConfig.Data,
      $container = opt.container || $('#author-covers-wrapper').first();

    this.promise = function () {
      return promise;
    };

    this.show = function () {
      if (data) {
        $container.append($(JST['jst/widgets/pro/author_covers']({
          authorSlug: authorSlug,
          coveredStocks: data.data || {}
        })));
      }
    };

    function onDone(res) {
      data = (res || {}).author_covers;
      promise.resolve();
    }

    function init() {
      if ($container.length) {
        promise = $.Deferred();
        if (config.article && config.author) {
          authorSlug = config.author.slug;
          $.get('/pro_sidebar', {items: ['author_covers'], slug: slug, author_slug: authorSlug}).done(onDone);
        } else {
          promise.resolve();
        }
      }
    }

    init();
  };

}(window.SA, window.jQuery));

(function (doc, SA, $){

  'use strict';

  var Crypto = SA.UsingNamespace('SA.Modules.Symbols.Crypto');

  var headerFields = {
    PRICE: 'Last',
    CHANGE24HOUR: 'Change',
    CHANGEPCT24HOUR: 'PercentChange'
  };

  var sideFields = [
    ['High 24h', 'HIGH24HOUR'],
    ['Low 24h', 'LOW24HOUR'],
    ['Supply', 'SUPPLY'],
    ['Market Cap', 'MKTCAP'],
    ['Volume 24h', 'TOTALVOLUME24H'],
    ['Volume $ 24h', 'TOTALVOLUME24HTO']
  ];

  var fromSym, toSym;

  function updateSide(data){
    var html = [], title, value, i;
    for (i=0; i<sideFields.length; i++){
      title = sideFields[i][0];
      value = data[sideFields[i][1]].replace(/ /g,'');
      html.push([
        '<div class="field">',
          '<span class="left">', title, ':</span>',
          '<span class="right">', value, '</span>',
        '</div>'].join(''));
    }

    $('#quotes-chart-data').html(html.join(''));
  }

  function updateHeader(data) {
    var headerData = {};
    for (var field in headerFields){
      if (data[field]) {
        headerData[headerFields[field]] = data[field];
      }
    }

    headerData.SourceAPI = 'CryptoCompare';
    headerData.DateTime = data.LASTUPDATE * 1000;
    SA.Pages.Symbols.SymbolData.set(headerData);
    SA.Utils.Observer.publish('pages/symbol/price/update', headerData);
  }

  function initIdleTab() {
    doc.addEventListener('visibilitychange', update);
  }

  function update() {
    if (!doc.hidden) {
      getDataFromCryptocompare([fromSym], [toSym], function (data) {
        if (data.RAW[fromSym]) {
          updateHeader(data.RAW[fromSym][toSym]);
          updateSide(data.DISPLAY[fromSym][toSym]);
        }
      })
    }
  }

  function getDataFromCryptocompare(fromSyms, toSyms, callback) {
    SA.Utils.cryptoAPI.priceMultiFull(fromSyms, toSyms).then(function (data) {
      if (data.Response === "Error") {
        return SA.exceptions.push(['Error loading cryptocompare price', {}, { message: data.Message }]);
      }
      callback(data);
    });
  }

  Crypto.init = function() {
    var name = SA.pageConfig.Data.object.name.split('-');
    fromSym = name[0];
    toSym = name[1];
    if (!fromSym || !toSym){
      throw "Invalid cryptocurrency name '" + name + "'";
    }

    update();
    initIdleTab();
    setInterval(update, 15000);
  };

  Crypto.update = update;
  Crypto.getDataFromCryptocompare = getDataFromCryptocompare;

}(window.document, window.SA, window.jQuery));

(function (w, SA, $) {

  'use strict';

  var Wrapper = SA.UsingNamespace('SA.Modules.Symbols.HCWrapper');
  var chart, lastPricePoint, isDrawing = false, pointAdded;

  function extendedOptions(rightRail) {
    if (rightRail) {
      return {
        xAxisFormat: '%e',
        tickPixelInterval: 60,
        plotOptions: {series: {animation: false}}
      };
    }

    return {
      xAxisFormat: '%b %e',
      tickPixelInterval: 120,
      plotOptions: {
        series: {
          states: {
            hover: {lineWidthPlus: 0}
          },
          events: {
            afterAnimate: function () {
              isDrawing = false;

              if (pointAdded) {
                chart.redraw();
                pointAdded = false;
              }
            }
          }
        }
      }
    };
  }

  function pricesMinMax(data) {
    if (!data.length) return [0,0];
    var minPrice = data[0][1],
      maxPrice = minPrice;

    data.forEach(function (d) {
      minPrice = Math.min(d[1], minPrice);
      maxPrice = Math.max(d[1], maxPrice);
    });

    return [minPrice, maxPrice];
  }

  function addLastPrice(e, data) {
    if (data.SourceAPI === 'GlobalIndicesRealtime') {
      return;
    }
    var time = SA.Utils.Formatter.parseTime(data.DateTime).getTime(), last = data.Last;
    if (chart) {
      if (time && last && (time >= chart.series[0].xAxis.dataMax)) {
        lastPricePoint = [time, last];
      }

      if (lastPricePoint) {
        // If point is added with "redraw=true" param, while the chart animation is on,
        // the animation is immediately finished, which creates weird effect.
        // So in this case, we're preventing immediate redraw and redrawing when animation ends.
        // If time of last price gets before last time of chart point (for some reason) - don't draw it !
        chart.series[0].addPoint(lastPricePoint, !isDrawing);
        if (isDrawing) {
          pointAdded = true;
        }
      }
    }
  }

  function drawPriceAtPublication(data, priceAtPublication) {
    for (var i = 0; i < data.length; i += 1) {
      var marketCloseTime = [Date.parse(priceAtPublication.date.replace(/-/g, '/') + ' 16:00'), Date.parse(priceAtPublication.date.replace(/-/g, '/') + ' 15:50')];
      if (!$.isEmptyObject(priceAtPublication.date) && marketCloseTime.includes(data[i][0])) {
        data[i] = {
          x: data[i][0],
          y: data[i][1],
          marker: {symbol: "circle", radius: 5, fillColor: "#4B4B4B", lineColor: "#fff", lineWidth: 2}
        };
        $('#chart-explain-wrapper').removeClass('hidden');
        return {index: i, data: data};
      }
    }
    return {data: data};
  }

  function calcAllBreaks(data, period) {
    var breaks             = [],
        minute             = 60 * 1000,
        maxTimeBetweenData = {
          '1D': minute,
          '5D': 10 * minute,
          '1M': 30 * minute
        }[period],
        prevItemTime       = data[0][0];

    data.forEach(function (item) {
      if ((item[0] - prevItemTime) > maxTimeBetweenData)
        breaks.push({
          from: prevItemTime,
          to  : item[0]
        });
      prevItemTime = item[0];
    });
    return breaks;
  }

  Wrapper.init = function () {
    SA.Utils.Observer.subscribe('pages/symbol/price/update', addLastPrice);
  };

  Wrapper.draw = function (opt) {
    w.Highcharts.setOptions({
      global: {useUTC: false},
      lang: {thousandsSep: ','}
    });

    var width, breaks, noData = !(opt.data || []).length;
    if (opt.width) {
      width = opt.width;
    } else if (opt.flags && opt.flags.length) {
      width = 900;
    } else {
      width = 720;
    }

    if (opt.breaks){
      breaks = noData ? [] : calcAllBreaks(opt.data, opt.period);
    }

    if (lastPricePoint && !noData) {
      opt.data.push(lastPricePoint);
    }

    var extended = extendedOptions(opt.source === 'pro_right_rail'),
      minMax = pricesMinMax(opt.data);

    if (chart) {
      chart.destroy();
    }

    isDrawing = true;

    var dataWithPublication = {};
    if (!$.isEmptyObject(opt.publicationInfo) && (opt.publicationInfo.price || opt.publicationInfo.date)) {
      dataWithPublication = drawPriceAtPublication(opt.data, opt.publicationInfo);
      opt.data = dataWithPublication.data;
    }

    chart = w.Highcharts.stockChart(opt.containerId, {
      chart: {
        type: 'area',
        height: opt.height || 192,
        width: width
      },

      navigator: {
        enabled: false,
        height: 24,
        maskFill: '#FE994822',
        series: {
          data: opt.data,
          id: 'dataseries',
          color: '#FE9948'
        }
      },

      exporting: {enabled: false},

      scrollbar: {enabled: false},

      rangeSelector: {enabled: false},

      yAxis: {
        floor: minMax[0],
        ceiling: minMax[1],
        tickPixelInterval: 40,
        labels: {
          align: 'left',
          x: 5,
          y: 5
        }
      },

      xAxis: {
        type: 'datetime',
        ordinal: false,
        gridLineWidth: 1,
        // minorGridLineWidth: 1,

        tickPositioner: opt.tickPositioner, // For 5D and 1M only
        tickPixelInterval: extended.tickPixelInterval,

        dateTimeLabelFormats: {
          minute: '%l %p',
          // HighStock might select 'hour' or 'minute' unit for label format
          hour: opt.period === '1D' ? '%l %p' : extended.xAxisFormat,
          day: extended.xAxisFormat
        },

        breaks: breaks
      },

      credits: {
        enabled: false,
        style: 'display: none'
      },

      plotOptions: extended.plotOptions,

      tooltip: {
        split: false,
        shared: true,
        padding: 8,
        borderWidth: 1,
        xDateFormat: '%m/%d/%Y %I:%M %p',
        pointFormatter: function () {
          return '<p><span style="color:#FF7200"> </span>' + (SA.pageConfig.Data.slug || SA.pageConfig.Data.primaryTicker || SA.pageConfig.Data.article.primaryTicker).toUpperCase() + ': <b>' + SA.Utils.Formatter.number(this.y, {decimalPositions: {min:2, max:4, force:true}}) + '</b></p>';
        },
        headerFormat: '<small>{point.key}</small><br>',
        animation: true
      },

      series: [
        {
          gapSize: 0,
          name: opt.name,
          data: opt.data,
          id: 'dataseries',
          dataGrouping: {enabled: false},
          marker: {enabled: true, radius: 0},

          // color: '#FE9948',
          // If fillColor ever changes to gradient, test on Edge,
          // currently it shows black instead of the gradient.
          // Also, Egde only accepts rgba with rgba(...) syntax and not #rgba
          fillColor: 'rgba(254,180,121,0.8)'
        },
        {
          data: opt.startGap,
          enableMouseTracking: false
        },
        {
          data: opt.endGap,
          enableMouseTracking: false,
          fillOpacity: 0,
          color: '#FE0000'
        },
        {
          type: 'flags',
          useHTML: true,
          data: opt.flags,
          title: '<span>D</span>',
          tooltip: {
            useHTML: true,
            xDateFormat: '%m/%d/%Y',
            headerFormat: '<p>Ex-Div Date: <b>{point.key}</b></p><br/>',
            pointFormat: '<p>Frequency: <b>{point.freq} </b></p><br/><p>Dividend: <b>{point.divRate}</b></p>'
          }
        }
      ]
    });

    if (!$.isEmptyObject(dataWithPublication) && dataWithPublication.index) {
      chart.series[0].data[dataWithPublication.index].graphic.toFront();
    }

    return chart;
  };

}(window, window.SA, window.jQuery));

(function (SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Modules.Symbols');
  scope.QuotesChart = function (options) {
    var chart,
      $container,
      chartTicker = options.ticker,
      iexSlug = options.iex_slug || options.ticker,
      serverTimes = options.chartTimes,
      marketOpenTS = serverTimes.MARKET_OPEN_TS,
      endTime = serverTimes.END_TIME,
      prev1D = serverTimes.PREV_1D,
      divFlags = options.dividendFlags,
      chartWidth = options.width,
      firstLoad = true,
      conf = SA.pageConfig.Data;

    var DefaultScale = '5Y';

    function renderChart(ticker, period) {

      $container.removeClass('error').addClass('loader');

      SA.Logger.Mone.event('qp_chart', '', period);

      var startTime = serverTimes[period],
        currentTS = Date.now() / 1000;

      function createChart(data, flagsData) {
        // draw empty chart if no data to display
        if (!(data || {}).length || (data || {}).length < 2) {
          return SA.Modules.Symbols.HCWrapper.draw({
            containerId: $container.attr('id'),
            name: ticker.split('.')[0].toUpperCase(),
            period: period,
            data: [],
            breaks: false,
            width: chartWidth,
            source: options.source
          });
        }
        // Add empty series so the stock chart isn't stretched horizontally if it's time scale is
        //  less than the +period+ interval
        var firstTS = data[0][0],
          lastTS = data[data.length - 1][0],
          startTS = Date.parse(startTime),
          endTS = Date.parse(endTime),
          startGap, endGap, tickPositioner;
        if (period.match(/20Y|10Y|5Y|1Y/)) {
          if (firstTS > startTS) {
            startGap = [
              [startTS, data[0][1]]
            ];
          }
        } else if (period.match(/1D|5D/)) {
          if (lastTS < endTS && currentTS > marketOpenTS) {
            endGap = [
              [endTS, data[data.length - 1][1]]
            ];
          }
        }

        if (period.match(/1D|5D|1M/)) {
          // Special positioner is needed here, because automatic ticks are falling exactly
          // on breaks and disappear, so we have to select existing points outside of breaks
          tickPositioner = function () {
            var h = 36e5,
              d = 24 * h,
              interval = {
                "1D": h,
                "5D": 24 * h,
                "1M": 4 * d,
                "6M": 30 * d
              } [period];

            var pos = [],
              prev = 0,
              start = data[0][0] + (period === '1D' ? h / 2 : 0);
            for (var i = 0; i < data.length; i += 1) {
              var tick = data[i][0];
              if (tick >= start && tick >= prev + interval) {
                prev = tick;
                pos.push(tick);
              }
            }

            // Add end-gap ticks - for some reason highchart doesn't show it automatically
            if (endGap) {
              while (pos[pos.length - 1] + interval <= endGap[0][0]) {
                pos.push(pos[pos.length - 1] + interval);
              }
            }

            pos.info = this.tickPositions.info;
            return pos;
          };
        }

        var publicationInfo = {};
        if (!$.isEmptyObject(conf.article)) {
          publicationInfo.price = conf.article.price_at_publication;
          publicationInfo.date = conf.article.closest_trading_day;
        } else if (!$.isEmptyObject(conf.mc)) {
          publicationInfo.date = conf.mc.closest_trading_day;
        }

        return SA.Modules.Symbols.HCWrapper.draw({
          containerId: $container.attr('id'),
          name: ticker.split('.')[0].toUpperCase(),
          period: period,
          data: data,
          publicationInfo: publicationInfo,
          tickPositioner: tickPositioner,
          startGap: startGap,
          endGap: endGap,
          breaks: period.match(/1D|5D|1M/),
          flags: flagsData,
          width: chartWidth,
          source: options.source
        });
      }

      function getDividendFlagData(quoteData) {
        var divData = [],
          dataLine;
        $.each(divFlags, function (k, v) {
          dataLine = $.grep(quoteData, function (val, index) {
            return (val[0] === k);
          });

          if (dataLine.length) {
            divData.push({
              x: Date.parse(dataLine[0][0].replace(/-/g, '/') + ' 16:00'),
              y: dataLine[0][1],
              divRate: v.rate,
              freq: v.freq
            });
          }
        });

        return divData;
      }

      function drawDailyMFData(xigData) {
        $container.removeClass('loader');
        if (xigData.Outcome !== 'Success' || !xigData.NAVs) {
          return handleBadOutcome(xigData);
        }
        var xdata = xigData.NAVs,
          data = [],
          divFlagData = [];
        for (var i = 0; i < xdata.length; i++) {
          // historical returns date in Y-M-D format, IE doesn't parse that
          var time = xdata[i].Date.replace(/-/g, '/') + ' 16:00';
          // historical data is in reverse order
          data.unshift([Date.parse(time), xdata[i].NAV]);
          divFlagData.unshift([xdata[i].Date, xdata[i].NAV]);
        }
        divFlagData = getDividendFlagData(divFlagData);
        chart = createChart(data, divFlagData);
      }

      function drawDailyIndexData(xigData) {
        $container.removeClass('loader');
        if (xigData.Outcome !== 'Success' || !xigData.Values) {
          return handleBadOutcome(xigData);
        }
        var xdata = xigData.Values,
          data = [],
          divFlagData = [];
        for (var i = 0; i < xdata.length; i++) {
          // historical returns date in Y-M-D format, IE doesn't parse that
          var time = xdata[i].Date.replace(/-/g, '/') + ' 16:00';
          // historical data is in reverse order
          data.unshift([Date.parse(time), xdata[i].Close]);
          divFlagData.unshift([xdata[i].Date, xdata[i].Close]);
        }
        divFlagData = getDividendFlagData(divFlagData);
        chart = createChart(data, divFlagData);
      }

      function drawDailyData(xigData) {
        $container.removeClass('loader');

        var xData = xigData.HistoricalQuotes;

        if (xigData.Outcome !== 'Success' || !xData) {
          if ($.isFunction(options.onRenderFail)) {
            options.onRenderFail();
          }

          handleBadOutcome(xigData);
        } else {
          if (firstLoad && xData.length < 140 && $('.chart-period.current').text() === '1y') {
            $('.chart-period[data-scale=5d]').click();
            firstLoad = false;
            return;
          }

          firstLoad = false;

          var data = [],
            divFlagData = [];
          $.each(xData, function (i, v) {
            // historical returns date in Y-M-D format, IE doesn't parse that
            // historical data is in reverse order
            data.unshift([Date.parse(v.Date.replace(/-/g, '/') + ' 16:00'), v.Close]);
            divFlagData.unshift([v.Date, v.Close]);
          });

          divFlagData = getDividendFlagData(divFlagData);
          chart = createChart(data, divFlagData);

          if ($.isFunction(options.onRenderSuccess)) {
            options.onRenderSuccess();
          }
        }
      }

      function drawIEXIntradayData(iexData) {
        $container.removeClass('loader');
        if (!iexData.length) {
          handleBadOutcome(iexData);
        }
        var divFlagData = [];
        var data = iexData.map(function (dataHash) {
          if (!dataHash.marketClose) {
            return;
          }
          var time = Date.parse(dataHash.date.replace(/-/g, '/') + ' ' + dataHash.minute),
            dataPoint = [time, dataHash.marketClose];
          divFlagData.unshift(dataPoint);
          return dataPoint;
        }).filter(function (el) {
          return el != null;
        });
        divFlagData = getDividendFlagData(divFlagData);
        chart = createChart(data, divFlagData);
      }

      function drawxIgniteIntradayData(xigData) {
        $container.removeClass('loader');
        if (xigData.Outcome !== 'Success' || !xigData.Bars) {
          return handleBadOutcome(xigData);
        }

        var xdata = xigData.Bars,
          data = [],
          divFlagData = [];
        for (var i = 0; i < xdata.length; i++) {
          var time = Date.parse(xdata[i].StartDate + ' ' + xdata[i].StartTime);
          data.push([time, xdata[i].Close]);
          divFlagData.unshift([xdata[i].StartDate, xdata[i].Close]);
        }
        divFlagData = getDividendFlagData(divFlagData);
        chart = createChart(data, divFlagData);
      }

      function showError() {
        $container.removeClass('loader').addClass('error');
      }

      function handleBadOutcome(xigData) {
        window.console.error('Xignite invalid response: ' + xigData.Outcome + ', ' + xigData.Message);
        showError();
      }

      function ajaxHost() {
        return SA.App.env.dev ? 'https://static-staging.seekingalpha.com' : SA.App.assetHost;
      }

      function buildMFDailyRequest(ticker) {
        return [
          ajaxHost(), '/cdn/xignite/navs/v2/xNAVs.json/GetHistoricalNAVs',
          '?IdentifierType=Symbol&Identifier=', ticker, '&IdentifierAsOfDate=&AdjustmentMethod=SplitOnly',
          '&StartDate=', date(startTime), '&EndDate=', date(endTime),
          '&_fields=Outcome,Message,NAVs.NAV,NAVs.Date'
        ].join('');
      }

      function getTimeParams(period) {
        var startT,
          endTimePlus = endTime.replace(/0$/, '1'), //Add extra minute to request to get tick for 16:00
          minutes = {
            '1D': 1,
            '5D': 10,
            '1M': 30
          } [period],
          ttl = {
            '1D': 30,
            '5D': 5 * 60,
            '1M': 30 * 60
          } [period];

        // For 1D until the market is open + 15m of globalquotes delay, take the data from previous day
        startT = period === '1D' && currentTS < (marketOpenTS + 15 * 60) ? prev1D : startTime;
        return {
          startT: startT,
          endTimePlus: endTimePlus,
          minutes: minutes,
          ttl: ttl
        };
      }

      function intradayRequest(ticker, period) {
        var SQsource = (SA.pageConfig || {}).useSQuoteSource,
          query,
          clb;

        switch (SQsource) {
          case 'iex':
            query = iexQuery(ticker, period);
            clb = drawIEXIntradayData;
            break;
          case 'xignite':
            query = xigniteQuery(ticker, period);
            clb = drawxIgniteIntradayData;
            break;
          default:
            query = xigniteQuery(ticker, period);
            clb = drawxIgniteIntradayData;
        }

        $.get(query, clb).fail(showError);

      }

      function xigniteQuery(ticker, period) {
        var timeParams = getTimeParams(period);

        return [
          ajaxHost(), '/cdn/xignite/globalquotes/v3/xGlobalQuotes.json/GetBars',
          '?IdentifierType=Symbol&Identifier=', ticker,
          '&StartTime=', timeParams.startT, '&EndTime=', timeParams.endTimePlus,
          '&Precision=Minutes&Period=', timeParams.minutes,
          '&_fields=Outcome,Message,Bars.StartDate,Bars.StartTime,Bars.Close',
          '&ttl=', timeParams.ttl
        ].join('');
      }

      function iexQuery(ticker, period) {
        return [SA.App.finance_api_host,'/chart?symbol=',ticker,'&period=',period].join('');
      }

      function date(time_str) {
        return time_str.split(' ')[0];
      }

      if (conf.qmChartData && conf.qmChartData.isMF) {
        $.get(buildMFDailyRequest(chartTicker), drawDailyMFData).fail(showError);
      } else if (conf.qmChartData && conf.qmChartData.isIndex) {
        if (period.match(/1D|5D|1M/)) {
          var timeParams = getTimeParams(period);
          SA.Utils.SymbolData.getCachedGlobalIndicesBars({
            slug: chartTicker,
            startTime: timeParams.startT,
            endTime: timeParams.endTimePlus,
            period: timeParams.minutes
          }, drawxIgniteIntradayData);
        } else {
          SA.Utils.SymbolData.getCachedGlobalIndices({
            slug: chartTicker,
            startDate: startTime,
            endDate: endTime
          }, drawDailyIndexData);
        }
      } else if (period.match(/1D|5D|1M/)) {
        intradayRequest(iexSlug, period);
      } else {
        SA.Utils.SymbolData.getGlobalHistoricalQuotesRangeCDN({
          slug: ticker,
          startDate: date(startTime),
          endDate: date(endTime),
          adjustmentMethod: 'PriceReturn'
        }, drawDailyData);
      }
    }

    function initRangeButtons() {
      $('.chart-period').on('click', function (e) {
        e.stopPropagation();
        $('.chart-period').removeClass('current');
        $(this).addClass('current');
        var scale = $(this).data('scale').toUpperCase();
        renderChart(chartTicker, scale);
      });
    }

    function init() {
      $container = options.$container;
      if ($container.length) {
        var selectedScale = options.selectedScale || $('.chart-period.current').data('scale') || DefaultScale;
        renderChart(chartTicker, selectedScale.toUpperCase());
        initRangeButtons();
        SA.Modules.Symbols.HCWrapper.init();
      }
    }

    init();

  };

}(window.SA, window.jQuery));



(function (SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Modules.Symbols');
  scope.CryptoChart = function(options){

    var $container,
        chart,
        ticker, fromSym, toSym,
        chartWidth = options.width;

    var pricesMinMax = function(data) {
      if (!data.length) return [0,0];
      var minPrice = data[0][1],
      maxPrice = minPrice;
      data.forEach(function(d) {
        minPrice = Math.min(d[1], minPrice);
        maxPrice = Math.max(d[1], maxPrice);
      });
      return [minPrice, maxPrice];
    };

    function renderChart(period) {
      $container.addClass('loader');
      $container.removeClass('error');
      var currentTS = Math.floor(Date.now() / 1000),
          startTS = getStartTS();

      callAPI();

      function getStartTS(){
        var h = 3600, d = 24*h, m = d*30, y = d*356;
        var interval = {'1D': d, '5D': d*5, '1M': m, '6M': m*6, '1Y': y, '5Y': 5*y, '10Y': 10*y}[period];
        return currentTS - interval;
      }


      function createChart(data) {
        var minMax = pricesMinMax(data);

        // Add empty series so the stock chart isn't stretched horizontally if it's time scale is
        //  less than the +period+ interval
        var firstTS = (data[0] || [])[0], startGap;

        if (period.match(/10Y|5Y|1Y/)) {
          if (firstTS > startTS*1000){
            startGap = [[startTS*1000, (data[0] || [])[0][1]]];
          }
        }

        return SA.Modules.Symbols.HCWrapper.draw({
          containerId: $container.attr('id'),
          name: ticker,
          period: period,
          data: data,
          startGap: startGap,
          width: chartWidth,
          source: options.source
        });
      }

      function showError(){
        $container.removeClass('loader');
        $container.addClass('error');
      }

      function parseAPI(data){
        $container.removeClass('loader');
        if (data.Response === "Error"){
          return SA.exceptions.push(['Error loading cryptocompare historical', {}, { message: data.Message }]);
        }

        var hist = [];
        $.each(data.Data, function(i, tick){
          hist.push([tick.time*1000, tick.close]);
        });

        chart = createChart(hist);
      }

      function callAPI(){
        var freq, interval, agg, limit;

        // CryptoCompare has max response time span:
        // 80 hours for 'minute' request and 80 days for 'hour'
        freq = {'1D': 'minute', '5D': 'hour', '1M': 'hour'}[period] || 'day';
        agg = {'1D': 5, '1M': 3, '5Y': 5, '10Y': 10}[period] || 1;
        interval = {"minute": 60, hour: 3600, 'day': 24*3600}[freq] * agg;
        limit = Math.ceil((currentTS - startTS)/interval);

        SA.Utils.cryptoAPI.historical(freq, fromSym, toSym, limit, agg).then(parseAPI).fail(showError);
      }
    }

    function initRangeButtons(){
      $('.chart-period').on('click', function(e) {
        e.stopPropagation();
        $('.chart-period').removeClass('current');
        $(this).addClass('current');
        var scale = $(this).data('scale').toUpperCase();
        renderChart(scale);
      });
    }

    function init(){
      $container = options.$container;
      if ($container.length) {
        ticker = options.ticker;
        fromSym = ticker.split('-');
        toSym = fromSym[1];
        fromSym = fromSym[0];
        if (!fromSym || !toSym) {
          throw "Invalid cryptocurrency name '" + name + "'";
        }
        renderChart('1Y');
        initRangeButtons();
        SA.Modules.Symbols.HCWrapper.init();
      }
    }

    init();

  };

})(window.SA, window.jQuery);
















(function (w, SA, $) {

    'use strict';
    var scope = SA.UsingNamespace('SA.Widgets.Pro'),
      $proSidebarContainer, slug,
      pageData = SA.pageConfig.Data || {},
      emptyWidget = {promise: function () {}, show: function () {}},
      sidebarInitFunc = {
        'sentiments': initSentiments,
        'viewed-stocks': initRecentlyViewStocks,
        'pro-ticker-snapshot': initProTickerSnapshot,
        'price-chart': initPriceChart,
        'ticker-key-data': initProTickerKeyData,
        'author-covers': initProAuthorCovers,
        'ratings-summary': initRatingsSummary,
        'sell-side-ratings': initSellSideRatings,
        'cresscap-ratings': initCresscapRatings
      };

    scope.ProSidebar = new function () {

      this.show = function () {
        if ($proSidebarContainer)
          $proSidebarContainer.removeClass('hidden');
      };

      this.hide = function () {
        if ($proSidebarContainer)
          $proSidebarContainer.addClass('hidden');
      };

      this.init = function (opt) {
        $proSidebarContainer = $(opt.container || '#pro-sidebar');
        if ($proSidebarContainer.length && SA.Data.User.id()) {
          slug = opt.slug || pageData.primaryTicker || (pageData.article || {}).primaryTicker;
          if (slug) {
            $('.pro-stock-ticker-unit').each(function () {
              SA.Logger.Mone.event($(this).data('sasource'), 'rightrail', 'shown');
            });
          }

        if (SA.Data.User.isCommonPro()) {
          loadFeatures(opt.sidebarItems, null);
        } else {
          loadFeatures(opt.sidebarItems, function () {
            w.hj('trigger', 'fcRecording');
          });
        }
      }
    };

      function loadFeatures(features, callback) {
        var promises = [],
          items = [];
        features.forEach(function (itemName) {
          if (sidebarInitFunc[itemName]) {
            var item = sidebarInitFunc[itemName]();
            items.push(item);
            try {
              promises.push(item.promise({ slug: slug }));
            } catch (e) {
              SA.Rollbar.error(itemName + ' promise error: ' + e.message);
            }
          }
        });
        $.when.apply($, promises).then(function () {
          items.forEach(function (item) {
            try {
              item.show();
            } catch (e) {
              SA.Rollbar.error('Widget show error: ' + e.message);
            }
          })
        }).always(function () {
          if ($.isFunction(callback)) {
            callback();
          }
          tempSolutionForFullRightRailLoadOff();
        });
      }
    };

    function tempSolutionForFullRightRailLoadOff() {
      var $rightRail = $('#right-rail-wrapper');
      $rightRail.removeClass('loading').find('.sticky-wrapper').removeClass('is-sticky').removeAttr('style');
      $rightRail.find('#pro-sticky-units').removeAttr('style');
    }

    function initCresscapRatings() {
      return SA.Pages.Symbols.CresscapRatings;
    }

    function initSentiments() {
      return SA.Pages.Symbols.SentimentsWidget;
    }

    function initSellSideRatings() {
      if ((pageData.qmChartData || {}).isCrypto)
        return emptyWidget;
      return SA.Pages.Symbols.SellSideRatings;
    }

    function initRecentlyViewStocks() {
      return new SA.Widgets.Pro.RecentlyViewedStocks({
        slug: slug,
        $container: $proSidebarContainer
      });
    }

    function initProTickerSnapshot() {
      return new SA.Widgets.Pro.InvestmentSnapshot({
        ticker: slug,
        container: $('#pro-ticker-snapshot-wrapper'),
        source: 'pro_sidebar'
      });
    }

    function initPriceChart() {
      return {
        promise: function () {
          try {
            var pageData = SA.pageConfig.Data,
              $chartContainer = $('#quotes-chart-container');
            if (slug) {
              if (pageData.qmChartData.isCrypto) {
                SA.Modules.Symbols.CryptoChart({
                  $container: $chartContainer,
                  ticker: slug.toUpperCase(),
                  width: 295,
                  source: 'pro_right_rail'
                });
              } else {
                SA.Modules.Symbols.QuotesChart({
                  $container: $chartContainer,
                  ticker: slug,
                  chartTimes: pageData.chartTimes,
                  width: 295,
                  source: 'pro_right_rail'
                });
              }
            }
          } catch (e) {
            SA.Rollbar.error('Error: initPriceChart:' + e.message);
            return true;
          }
        },
        show: function () {}
      };
    }

    function initProTickerKeyData() {
      return new SA.Widgets.Pro.TickerKeyData({
        slug: slug
      });
    }

    function initRatingsSummary() {
      return new SA.Widgets.Pro.TickerRatingsSummary({
        slug: slug
      });
    }

    function initProAuthorCovers() {
      return new SA.Widgets.Pro.AuthorCovers({
        slug: slug
      });
    }
  }(window, window.SA, window.jQuery)
);
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/sharing/email_share_popups/email_share_body"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<form autocomplete="on">\n  <div class="recipients">\n    <div><b>Send to (up to 10 recipients):</b></div>\n    <div class="error"></div>\n    <input type="text" name="email" autocomplete="on" x-autocomplete="email" autocorrect="off" autocapitalize="off" spellcheck="false" value="', recipients,'"/>\n    <div class="hard-gray-text">Enter the email address of the recipient. Separate multiple addresses with commas.</div>\n  </div>\n  <div class="message">\n    <div><b>Add your own personal message:</b></div>\n    <textarea placeholder="', placeholder,'">', placeholder,'</textarea>\n  </div>\n  ');  if(captcha){ ; __p.push('\n      <div class="enter-name">\n        <div><b>Enter your name: (required)</b></div>\n        <div class="error"></div>\n        <input type="text" />\n      </div>\n      <div class="captcha">\n        <div class="title"><b>To help us prevent spamming, please answer:</b></div>\n        <div><b>',  captcha.question ,'</b></div>\n        <div class="error"></div>\n        <input type="text" />\n      </div>\n      '); ;} ; __p.push('\n</form>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/sharing/email_share_popups/email_share_header"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<span><b>',  title ,'</b></span>\n<span>or\n<a target="_blank" href="mailto:',  recipients ,'?subject=',  title ,'&body=',  placeholder ,'%20',  url ,'"> click here to send it from your default email program </a><em class="hard-gray-text">e.g. Outlook</em>\n</span>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/sharing/email_share_popups/email_success_popup_body"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div><b>From: </b>Seeking Alpha</div>\n<div><b>Reply-to:: </b>',  replyTo ,'</div>\n<div><b>To: </b>',  to ,'</div>\n<div><b>Subject: </b>',  subject ,'</div>\n<div>',  text ,'</div>\n');}return __p.join('');};
}).call(this);
(function(){

  "use strict";

  var scope = SA.UsingNamespace("SA.Utils.Captcha");

  var captchas = [
    [0 ,'What is the opposite of "bad"?',4],
    [1, 'What is 20 divided by four (in words)?',4],
    [2, 'How much is 2 plus five (in words)?',5],
    [3, 'What is the first month of the year?',7],
    [4, 'How many minutes are in an hour (in numbers)?',2],
    [5, 'What is four plus 4 (in words)?',5],
    [6, 'What is twenty divided by 2 (in words)?',3],
    [7, 'What is two times 1 (in numbers)?',1],
    [8, 'How much is six plus 3 (in words)?',4],
    [9, 'What is two plus two (in numbers)?',1]
  ];

  scope.getRandomCaptcha = function(){
    var random = Math.round(1000*Math.random()) % captchas.length;
    return {id: captchas[random][0], question: captchas[random][1]};
  };

  scope.checkAnswer = function(id, answer){
    if(id && answer){
      return captchas[id][2] === answer.length;
    }
  };


})();





(function(SA, $){

  "use strict";

  var scope = SA.UsingNamespace('SA.Widgets.EmailSharePopup');

  var sharePopup = null,
    itemData = {}, captcha;

  var setPopupEvents = function() {
    var $modal = sharePopup.getModalObject(),
      $sendDefault = $modal.find('a:first'),
      $sendBtn = $modal.find('.orange-btn:first'),
      $errorMessages = $modal.find('.error'),
      $recipients = $modal.find('.recipients'),
      $emailError = $recipients.children('.error'),
      $emails = $recipients.children('input:first'), emailsString, emailsHash,
      $message = $modal.find('textarea:first'),
      $enterName, $name, name, $nameError,
      $captcha, $captchaAnswer, captchaAnswer, $captchaError, captchaId,
      detailsValid;

    $sendDefault.on('click', function(){
      //add event: SA.Logger.Mone.event('Share', SA.Utils.unifiedPath(), open_client', { data:{ type: 'Article', item_id: itemData.itemId}}); SA.Utils.unifiedPath()='/article'
      sharePopup.hide();
    });

    $sendBtn.on('click', function() {
      checkPopupEntries();
      if(detailsValid){
        sendEmail();
      }
    });

    $emails.on('keypress', function(event) {
      if (event.keyCode === 13) {
        event.preventDefault();
      }
    });

    function checkPopupEntries(){
      detailsValid = true;
      $errorMessages.text('');
      checkEmails();
      if(captcha) {
        checkUserDetails();
        checkCaptcha();
      }
    }

    function checkEmails(){
      emailsString = $emails.val();
      emailsHash = emailsString ? emailsString.split(',') : null;
      if(emailsString){
        var l = emailsHash.length;
        var emailsPassed = true,
          incorrectEmails = 0,
          errorMessage = [],
          email;
        if(l > 10){
          $emailError.text('Up to 10 recipients are allowed.');
          detailsValid = false;
          return;
        }
        for(var i= 0; i<l; i++){
          email = emailsHash[i].trim();
          if(!SA.Utils.Validate.email(email)){
            incorrectEmails > 0 ? errorMessage.push(email) : errorMessage.push('Please correct these emails: ' + email);
            incorrectEmails ++;
            emailsPassed = false;
          }
        }
        if(!emailsPassed){
          $emailError.text(errorMessage.join(','));
          detailsValid = false;
        }
      }else{
        $emailError.text('Please provide an email address.');
        detailsValid = false;
      }
    }

    function checkUserDetails(){
      $enterName = $modal.find('.enter-name');
      $name = $enterName.children('input:first');
      $nameError = $enterName.children('.error');
      name = $name.val().trim();

      if(!name){
        $nameError.text('Please provide your name.');
        detailsValid = false;
      }
    }

    function checkCaptcha(){
      $captcha = $modal.find('.captcha');
      $captchaAnswer = $captcha.children('input:first');
      $captchaError = $captcha.children('.error');
      captchaAnswer = $captchaAnswer.val().trim();
      captchaId = captcha.id;

      if(!captchaAnswer){
        $captchaError.text('Please answer the security question.');
        detailsValid = false;
      } else if(!SA.Utils.Captcha.checkAnswer(captchaId, captchaAnswer)){
        $captchaError.text('Try again, the answer is incorrect.');
        detailsValid = false;
      }
    }

    function sendEmail(){
      $sendBtn.addClass('sa-animated');
      $.ajax('/form/ajax_send_item_to_friends', {
        data: {
          item_name: itemData.type,
          item_url: itemData.shareUrl,
          captcha_id: captchaId,
          answer_captcha: captchaAnswer,
          article_id: itemData.itemId || 0,
          my_name: name,
          personal_message: $message.val().length ? $message.val() : $message.attr('placeholder'),
          friend_emails: emailsString
        },
        dataType: 'text',
        method: 'post'
      }).done(function(res){
        if(res === 'captcha failed'){
          $captchaError.text('Try again, the answer is incorrect.');
          $sendBtn.removeClass('sa-animated');
          SA.Logger.Mone.event(itemData.moneType || 'Share', itemData.moneSource || '/article', itemData.moneAction || 'captcha_error_server', {data: {type: itemData.type, item_id: itemData.item_id}});
        } else{
          sharePopup.hide();
          var respArray = res.split('@@@');
          SA.Logger.Mone.event(itemData.moneType || 'Share', itemData.moneSource || 'article', itemData.moneAction || 'email_article_share_sent');
          return buildSuccessPopup(respArray).show();
        }
      }).fail(function(){
        $sendBtn.removeClass('sa-animated');
      });
    }

  };

  var buildSharePopup = function(opt){
    var placeholder = opt.content || (itemData.type === "MarketCurrent" ? "I thought you might find this interesting, I saw it on Seeking Alpha:" :  "I thought you might like this article from Seeking Alpha");
    var title  = titleByType(itemData.type);
    sharePopup = SA.Widgets.Popup.build({
      headerContent: JST['jst/widgets/sharing/email_share_popups/email_share_header']({type: itemData.type, title: title, placeholder: encodeURI(placeholder), url: itemData.shareUrl ? encodeURIComponent((itemData.shareUrl + ((/\?/).test(itemData.shareUrl) ? '&' : '?')) + 'source=from_friend_client') : '', recipients: opt.recipients || '' }),
      bodyContent: JST['jst/widgets/sharing/email_share_popups/email_share_body']({captcha: captcha, placeholder: placeholder, recipients: opt.recipients || '' }),
      footerContent: '<div class="error"></div><button class="btn btn-primary orange-btn">Send</button>',
      showFooter: true,
      className: opt.className || 'e-sh-p',
      removeAfterClose: true,
      backdrop: true,
      keyboard: true
    });
    setPopupEvents();
  };

  var titleByType = function(shareType) {
    switch(shareType) {
      case "Article":
      case "AcquireStory":
        return "Send Article";
      case "InstablogPost":
        return "Send Instablog Post";
      case "MarketCurrent":
        return "Send via email";
      case "NewsTip":
        return "Send Us a News Tip";
      default:
        return "Send StockTalk";
    }
  };

  var buildSuccessPopup = function(respArray){

    return SA.Widgets.Popup.build({
      headerContent: '<div class="maroon">Success!</div><div class="green">Your Message has been sent</div> <div><em class="hard-gray-text">Quoted message</em></div>',
      bodyContent: JST['jst/widgets/sharing/email_share_popups/email_success_popup_body']({
        id: respArray[0],
        replyTo: respArray[1],
        to: respArray[2],
        subject: respArray[3],
        text: respArray[4]
      }),
      footerContent: '<div >This page was sent using our Send-to-Friend service</div><div><em>The Seeking Alpha Team.</em></div>',
      className: 'e-ss-p',
      removeAfterClose: true,
      keyboard: true,
      backdrop: true
    });
  };

  scope.init = function(opt){
    opt = opt || {};
    itemData = $.extend({}, itemData, opt);
    captcha = SA.Data.User.loggedIn() ? null : SA.Utils.Captcha.getRandomCaptcha();
    buildSharePopup(opt);
    return sharePopup.show();
  };

}(SA, jQuery));


/* ===========================================================
 * bootstrap-tooltip.js v2.3.2
 * http://twitter.github.com/bootstrap/javascript.html#tooltips
 * Inspired by the original jQuery.tipsy by Jason Frame
 * ===========================================================
 * Copyright 2012 Twitter, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ========================================================== */



!function ($) {

  "use strict"; // jshint ;_;


  /* TOOLTIP PUBLIC CLASS DEFINITION
   * =============================== */

  var Tooltip = function (element, options) {
    this.init('tooltip', element, options)
  }

  Tooltip.prototype = {

    constructor: Tooltip

    , init: function (type, element, options) {
      var eventIn
        , eventOut
        , triggers
        , trigger
        , i

      this.type = type
      this.$element = $(element)
      this.options = this.getOptions(options)
      this.enabled = true

      triggers = this.options.trigger.split(' ')

      for (i = triggers.length; i--;) {
        trigger = triggers[i]
        if (trigger == 'click') {
          this.$element.on('click.' + this.type, this.options.selector, $.proxy(this.toggle, this))
        } else if (trigger != 'manual') {
          eventIn = trigger == 'hover' ? 'mouseenter' : 'focus'
          eventOut = trigger == 'hover' ? 'mouseleave' : 'blur'
          this.$element.on(eventIn + '.' + this.type, this.options.selector, $.proxy(this.enter, this))
          this.$element.on(eventOut + '.' + this.type, this.options.selector, $.proxy(this.leave, this))
        }
      }

      this.options.selector ?
        (this._options = $.extend({}, this.options, { trigger: 'manual', selector: '' })) :
        this.fixTitle()
    }

    , getOptions: function (options) {
      options = $.extend({}, $.fn[this.type].defaults, this.$element.data(), options)

      if (options.delay && typeof options.delay == 'number') {
        options.delay = {
          show: options.delay
          , hide: options.delay
        }
      }

      return options
    }

    , enter: function (e) {
      var defaults = $.fn[this.type].defaults
        , options = {}
        , self

      this._options && $.each(this._options, function (key, value) {
        if (defaults[key] != value) options[key] = value
      }, this)

      self = $(e.currentTarget)[this.type](options).data(this.type)

      if (!self.options.delay || !self.options.delay.show) return self.show()

      clearTimeout(this.timeout)
      self.hoverState = 'in'
      this.timeout = setTimeout(function() {
        if (self.hoverState == 'in') self.show()
      }, self.options.delay.show)
    }

    , leave: function (e) {
      var self = $(e.currentTarget)[this.type](this._options).data(this.type)

      if (this.timeout) clearTimeout(this.timeout)
      if (!self.options.delay || !self.options.delay.hide) return self.hide()

      self.hoverState = 'out'
      this.timeout = setTimeout(function() {
        if (self.hoverState == 'out') self.hide()
      }, self.options.delay.hide)
    }

    , show: function () {
      var $tip
        , pos
        , actualWidth
        , actualHeight
        , placement
        , tp
        , e = $.Event('show')

      if (this.hasContent() && this.enabled) {
        this.$element.trigger(e)
        if (e.isDefaultPrevented()) return
        $tip = this.tip()
        this.setContent()

        if (this.options.animation) {
          $tip.addClass('fade')
        }

        placement = typeof this.options.placement == 'function' ?
          this.options.placement.call(this, $tip[0], this.$element[0]) :
          this.options.placement

        $tip
          .detach()
          .css({ top: 0, left: 0, display: 'block' })

        this.options.container ? $tip.appendTo(this.options.container) : $tip.insertAfter(this.$element)

        pos = this.getPosition()

        actualWidth = $tip[0].offsetWidth
        actualHeight = $tip[0].offsetHeight

        switch (placement) {
          case 'bottom':
            tp = {top: pos.top + pos.height, left: pos.left + pos.width / 2 - actualWidth / 2}
            break
          case 'top':
            tp = {top: pos.top - actualHeight, left: pos.left + pos.width / 2 - actualWidth / 2}
            break
          case 'left':
            tp = {top: pos.top + pos.height / 2 - actualHeight / 2, left: pos.left - actualWidth}
            break
          case 'right':
            tp = {top: pos.top + pos.height / 2 - actualHeight / 2, left: pos.left + pos.width}
            break
        }

        this.applyPlacement(tp, placement)
        this.$element.trigger('shown')
      }
    }

    , applyPlacement: function(offset, placement){
      var $tip = this.tip()
        , width = $tip[0].offsetWidth
        , height = $tip[0].offsetHeight
        , actualWidth
        , actualHeight
        , delta
        , replace

      $tip
        .offset(offset)
        .addClass(placement)
        .addClass('in')

      actualWidth = $tip[0].offsetWidth
      actualHeight = $tip[0].offsetHeight

      if (placement == 'top' && actualHeight != height) {
        offset.top = offset.top + height - actualHeight
        replace = true
      }

      if (placement == 'bottom' || placement == 'top') {
        delta = 0

        if (offset.left < 0){
          delta = offset.left * -2
          offset.left = 0
          $tip.offset(offset)
          actualWidth = $tip[0].offsetWidth
          actualHeight = $tip[0].offsetHeight
        }

        this.replaceArrow(delta - width + actualWidth, actualWidth, 'left')
      } else {
        this.replaceArrow(actualHeight - height, actualHeight, 'top')
      }

      if (replace) $tip.offset(offset)
    }

    , replaceArrow: function(delta, dimension, position){
      this
        .arrow()
        .css(position, delta ? (50 * (1 - delta / dimension) + "%") : '')
    }

    , setContent: function () {
      var $tip = this.tip()
        , title = this.getTitle()

      $tip.find('.tooltip-inner')[this.options.html ? 'html' : 'text'](title)
      $tip.removeClass('fade in top bottom left right')
    }

    , hide: function () {
      var that = this
        , $tip = this.tip()
        , e = $.Event('hide')

      this.$element.trigger(e)
      if (e.isDefaultPrevented()) return

      $tip.removeClass('in')

      function removeWithAnimation() {
        var timeout = setTimeout(function () {
          $tip.off($.support.transition.end).detach()
        }, 500)

        $tip.one($.support.transition.end, function () {
          clearTimeout(timeout)
          $tip.detach()
        })
      }

      $.support.transition && this.$tip.hasClass('fade') ?
        removeWithAnimation() :
        $tip.detach()

      this.$element.trigger('hidden')

      return this
    }

    , fixTitle: function () {
      var $e = this.$element
      if ($e.attr('title') || typeof($e.attr('data-original-title')) != 'string') {
        $e.attr('data-original-title', $e.attr('title') || '').attr('title', '')
      }
    }

    , hasContent: function () {
      return this.getTitle()
    }

    , getPosition: function () {
      var el = this.$element[0]
      return $.extend({}, (typeof el.getBoundingClientRect == 'function') ? el.getBoundingClientRect() : {
        width: el.offsetWidth
        , height: el.offsetHeight
      }, this.$element.offset())
    }

    , getTitle: function () {
      var title
        , $e = this.$element
        , o = this.options

      title = $e.attr('data-original-title')
        || (typeof o.title == 'function' ? o.title.call($e[0]) :  o.title)

      return title
    }

    , tip: function () {
      return this.$tip = this.$tip || $(this.options.template)
    }

    , arrow: function(){
      return this.$arrow = this.$arrow || this.tip().find(".tooltip-arrow")
    }

    , validate: function () {
      if (!this.$element[0].parentNode) {
        this.hide()
        this.$element = null
        this.options = null
      }
    }

    , enable: function () {
      this.enabled = true
    }

    , disable: function () {
      this.enabled = false
    }

    , toggleEnabled: function () {
      this.enabled = !this.enabled
    }

    , toggle: function (e) {
      var self = e ? $(e.currentTarget)[this.type](this._options).data(this.type) : this
      self.tip().hasClass('in') ? self.hide() : self.show()
    }

    , destroy: function () {
      this.hide().$element.off('.' + this.type).removeData(this.type)
    }

  }


  /* TOOLTIP PLUGIN DEFINITION
   * ========================= */

  var old = $.fn.tooltip

  $.fn.tooltip = function ( option ) {
    return this.each(function () {
      var $this = $(this)
        , data = $this.data('tooltip')
        , options = typeof option == 'object' && option
      if (!data) $this.data('tooltip', (data = new Tooltip(this, options)))
      if (typeof option == 'string') data[option]()
    })
  }

  $.fn.tooltip.Constructor = Tooltip

  $.fn.tooltip.defaults = {
    animation: true
    , placement: 'top'
    , selector: false
    , template: '<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>'
    , trigger: 'hover focus'
    , title: ''
    , delay: 0
    , html: false
    , container: false
  }


  /* TOOLTIP NO CONFLICT
   * =================== */

  $.fn.tooltip.noConflict = function () {
    $.fn.tooltip = old
    return this
  }

}(window.jQuery);
/* ===========================================================
 * bootstrap-confirmation.js v1.0.1
 * http://ethaizone.github.io/Bootstrap-Confirmation/
 * ===========================================================
 * Copyright 2013 Nimit Suwannagate <ethaizone@hotmail.com>
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =========================================================== */



!function ($) {

	"use strict"; // jshint ;_;


 /* CONFIRMATION PUBLIC CLASS DEFINITION
	* =============================== */

	//var for check event at body can have only one.
	var event_body = false;
  var $tooltip = $.fn.tooltip;

	var Confirmation = function (element, options) {
		var that = this;

		// remove href attribute of button
		$(element).removeAttr('href')

		this.init('confirmation', element, options)

		$(element).on('show', function(e) {
			var options = that.options;
			var all = options.all_selector;
			if(options.singleton) {
				$(all).not(that.$element).confirmation('hide');
			}
		});

		$(element).on('shown', function(e) {
			var options = that.options;
			var all = options.all_selector;
			$(this).next('.popover').one('click.dismiss.confirmation', '[data-dismiss="confirmation"]', $.proxy(that.hide, that))
			if(that.isPopout()) {
				if(!event_body) {
					event_body = $('body').on('click', function (e) {
						if($(all).is(e.target)) return;
						if($(all).has(e.target).length) return;
						if($(all).next('div').has(e.target).length) return;

						$(all).confirmation('hide');
						$('body').unbind(e);
						event_body = false;

						return;
					});
				}
			}
		});
	}


	/* NOTE: CONFIRMATION EXTENDS BOOTSTRAP-TOOLTIP.js
		 ========================================== */

	Confirmation.prototype = $.extend({}, $tooltip.Constructor.prototype, {

		constructor: Confirmation

		, setContent: function () {
				var $tip = this.tip()
					, $btnOk = this.btnOk()
					, $btnCancel = this.btnCancel()
					, title = this.getTitle()
					, href = this.getHref()
					, target = this.getTarget()
					, $e = this.$element
					, btnOkClass = this.getBtnOkClass()
					, btnCancelClass = this.getBtnCancelClass()
					, btnOkLabel = this.getBtnOkLabel()
					, btnCancelLabel = this.getBtnCancelLabel()
					, o = this.options

				$tip.find('.popover-title').text(title)

				$btnOk.addClass(btnOkClass).html(btnOkLabel).attr('href', href).attr('target', target).on('click', o.onConfirm)
				$btnCancel.addClass(btnCancelClass).html(btnCancelLabel).on('click', o.onCancel)

				$tip.removeClass('fade top bottom left right in')
			}

		, hasContent: function () {
				return this.getTitle()
			}

		, isPopout: function () {
				var popout
					, $e = this.$element
					, o = this.options

				popout = $e.attr('data-popout') || (typeof o.popout == 'function' ? o.popout.call($e[0]) :	o.popout)

				if(popout == 'false') popout = false;

				return popout
			}


		, getHref: function () {
				var href
					, $e = this.$element
					, o = this.options

				href = $e.attr('data-href') || (typeof o.href == 'function' ? o.href.call($e[0]) :	o.href)

				return href
			}

		, getTarget: function () {
				var target
					, $e = this.$element
					, o = this.options

				target = $e.attr('data-target') || (typeof o.target == 'function' ? o.target.call($e[0]) :	o.target)

				return target
			}

		, getBtnOkClass: function () {
				var btnOkClass
					, $e = this.$element
					, o = this.options

				btnOkClass = $e.attr('data-btnOkClass') || (typeof o.btnOkClass == 'function' ? o.btnOkClass.call($e[0]) :	o.btnOkClass)

				return btnOkClass
			}

		, getBtnCancelClass: function () {
				var btnCancelClass
					, $e = this.$element
					, o = this.options

				btnCancelClass = $e.attr('data-btnCancelClass') || (typeof o.btnCancelClass == 'function' ? o.btnCancelClass.call($e[0]) :	o.btnCancelClass)

				return btnCancelClass
			}

		, getBtnOkLabel: function () {
				var btnOkLabel
					, $e = this.$element
					, o = this.options

				btnOkLabel = $e.attr('data-btnOkLabel') || (typeof o.btnOkLabel == 'function' ? o.btnOkLabel.call($e[0]) :	o.btnOkLabel)

				return btnOkLabel
			}

		, getBtnCancelLabel: function () {
				var btnCancelLabel
					, $e = this.$element
					, o = this.options

				btnCancelLabel = $e.attr('data-btnCancelLabel') || (typeof o.btnCancelLabel == 'function' ? o.btnCancelLabel.call($e[0]) :	o.btnCancelLabel)

				return btnCancelLabel
			}

		, tip: function () {
				this.$tip = this.$tip || $(this.options.template)
				return this.$tip
			}

		, btnOk: function () {
				var $tip = this.tip()
				return $tip.find('.popover-content > div > a:not([data-dismiss="confirmation"])')
			}

		, btnCancel: function () {
				var $tip = this.tip()
				return $tip.find('.popover-content > div > a[data-dismiss="confirmation"]')
			}

		, hide: function () {
				var $btnOk = this.btnOk()
					, $btnCancel = this.btnCancel()

      $tooltip.Constructor.prototype.hide.call(this)

				$btnOk.off('click')
				$btnCancel.off('click')

				return this
			}

		, destroy: function () {
				this.hide().$element.off('.' + this.type).removeData(this.type)
			}

	})


 /* CONFIRMATION PLUGIN DEFINITION
	* ======================= */

	var old = $.fn.confirmation

	$.fn.confirmation = function (option) {
		var that = this
		return this.each(function () {
			var $this = $(this)
				, data = $this.data('confirmation')
				, options = typeof option == 'object' && option
			options = options || {}
			options.all_selector = that.selector
			if (!data) $this.data('confirmation', (data = new Confirmation(this, options)))
			if (typeof option == 'string') data[option]()
		})
	}

	$.fn.confirmation.Constructor = Confirmation

	$.fn.confirmation.defaults = $.extend({} , $tooltip.defaults, {
		placement: 'top'
		, trigger: 'click'
		, target : '_self'
		, href   : '#'
		, title: 'Are you sure?'
		, template: '<div class="popover">' +
				'<div class="arrow"></div>' +
				'<h3 class="popover-title"></h3>' +
				'<div class="popover-content text-center">' +
				'<div class="btn-group">' +
				'<a class="btn btn-small" href="" target=""></a>' +
				'<a class="btn btn-small" data-dismiss="confirmation"></a>' +
				'</div>' +
				'</div>' +
				'</div>'
		, btnOkClass:  'btn-primary'
		, btnCancelClass:  ''
		, btnOkLabel: '<i class="icon-ok-sign icon-white"></i> Yes'
		, btnCancelLabel: '<i class="icon-remove-sign"></i> No'
		, singleton: false
		, popout: false
		, onConfirm: function(){}
		, onCancel: function(){}
	})


 /* POPOVER NO CONFLICT
	* =================== */

	$.fn.confirmation.noConflict = function () {
		$.fn.confirmation = old
		return this
	}

}(window.jQuery);




(function (SA, $) {

  "use strict";

  var scope = SA.UsingNamespace('SA.Widgets.Sharing'),
    url,
    shareData,
    $shareUnit = $('#share-unit'),
    $confirmSelector = $("[data-toggle='print-share-confirm']");

  scope.getUrlWithSourceQueryParam = function (source, encodeUrl) {
    var outUrl = url + (source ? ((/\?/.test(url) ? "&" : "?") + "source=" + source) : "");
    if (encodeUrl) {
      return encodeURIComponent(outUrl);
    }
    return outUrl;
  };

  var trackSharing = function (socialSiteName) {
    // TODO: change location.pathname to SA.Utils.unifiedPath()
    var moneType = socialSiteName + ' Tracking';
    var moneAction = 'like';
    var opt = {};

    switch (socialSiteName) {
      case 'Email':
        moneType = 'Share';
        moneAction = 'email_share';
        opt = {data: {type: shareData.itemType, item_id: shareData.itemId}};
        break;

      case 'Twitter':
        moneAction = 'click';
        break;
    }

    SA.Logger.Mone.event(moneType, SA.App.moneSource(), moneAction, opt);
  };

  var initShareData = function (opt) {
    url = $('meta[property="og:url"]').attr('content');

    return {
      shareTitle: encodeURIComponent(opt.title || ''),
      itemType: opt.itemType,
      itemId: opt.itemId,
      twitterContent: encodeURIComponent(opt.twitterContent || '')
    };
  };

  var initTwitterBtn = function () {
    $('.p-share.twt-share').on('click', function (e) {
        e.preventDefault();
        window.open('https://twitter.com/intent/tweet?text=' + shareData.twitterContent, '_blank', 'width=500, height=500');
        trackSharing('Twitter');
      }
    );
  };

  var initFacebookBtn = function () {
    $('.p-share.fb-share').on('click', function (e) {
      e.preventDefault();
      FB.ui({
        method: 'share',
        display: 'popup',
        href: scope.getUrlWithSourceQueryParam('facebook', false)
      }, function (response) {
      });
      trackSharing('Facebook');
    });
  };

  var initLinkedInBtn = function () {
    $('.p-share.ldn-share').on('click', function (e) {
        e.preventDefault();
        window.open('https://www.linkedin.com/shareArticle?mini=true&url=' + scope.getUrlWithSourceQueryParam('linkedin', true) + '&title=' + shareData.shareTitle, '_blank', 'width=500, height=500');
        trackSharing('Linkedin');
      }
    );
  };

  var initRedditBtn = function () {
    $('.p-share.rdt-share').on('click', function (e) {
      e.preventDefault();
      window.open('//www.reddit.com/submit?url=' + scope.getUrlWithSourceQueryParam('reddit', true) + '&title=' + shareData.shareTitle, '_blank', 'width=950, height=950');
      trackSharing('Reddit');
    });
  };

  var initEmailBtn = function () {
    $('.p-share.email-share').on('click', function (e) {
      e.preventDefault();
      SA.Widgets.EmailSharePopup.init({
        type: shareData.itemType,
        itemId: shareData.itemId,
        shareUrl: scope.getUrlWithSourceQueryParam("email", true)
      });
      trackSharing("Email");
    });
  };

  var initPrintBtn = function (opt) {
    $confirmSelector.confirmation({
      placement: 'left',
      title: 'Print',
      trigger: 'click',
      btnOkClass: '',
      btnOkLabel: 'Print with comments',
      btnCancelClass: '',
      btnCancelLabel: 'Print without comments',
      popout: true,
      onConfirm: function () {
        return print(true);
      },
      onCancel: function () {
        return print(false);
      }
    });
  };

  var print = function (withComments) {

    $confirmSelector.confirmation('hide');

    var $comments = $('.sa-comment-block'),
      hiddenPrintClass = 'hidden-print',
      moreActionStr;

    if (withComments) {
      moreActionStr = 'print_with_comments';

      $comments.removeClass(hiddenPrintClass);
    } else {
      moreActionStr = 'print_without_comments';

      $comments.addClass(hiddenPrintClass);
    }

    SA.Logger.Mone.event('print', 'article_bottom', moreActionStr, {data: {user_id: SA.Data.User.id()}});

    window.print();

    return false;
  };

  var initUnit = function () {
    initTwitterBtn();
    initFacebookBtn();
    initLinkedInBtn();
    initRedditBtn();
    initEmailBtn();
    initPrintBtn();

    $shareUnit.removeClass('hidden');
  };

  scope.init = function (opt) {
    opt = opt || {};
    shareData = $.extend({}, shareData, initShareData(opt));

    setTimeout(initUnit);
  };

}(SA, jQuery));


/*! Magnific Popup - v1.0.0 - 2015-01-03
* http://dimsemenov.com/plugins/magnific-popup/
* Copyright (c) 2015 Dmitry Semenov; */

!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a("object"==typeof exports?require("jquery"):window.jQuery||window.Zepto)}(function(a){var b,c,d,e,f,g,h="Close",i="BeforeClose",j="AfterClose",k="BeforeAppend",l="MarkupParse",m="Open",n="Change",o="mfp",p="."+o,q="mfp-ready",r="mfp-removing",s="mfp-prevent-close",t=function(){},u=!!window.jQuery,v=a(window),w=function(a,c){b.ev.on(o+a+p,c)},x=function(b,c,d,e){var f=document.createElement("div");return f.className="mfp-"+b,d&&(f.innerHTML=d),e?c&&c.appendChild(f):(f=a(f),c&&f.appendTo(c)),f},y=function(c,d){b.ev.triggerHandler(o+c,d),b.st.callbacks&&(c=c.charAt(0).toLowerCase()+c.slice(1),b.st.callbacks[c]&&b.st.callbacks[c].apply(b,a.isArray(d)?d:[d]))},z=function(c){return c===g&&b.currTemplate.closeBtn||(b.currTemplate.closeBtn=a(b.st.closeMarkup.replace("%title%",b.st.tClose)),g=c),b.currTemplate.closeBtn},A=function(){a.magnificPopup.instance||(b=new t,b.init(),a.magnificPopup.instance=b)},B=function(){var a=document.createElement("p").style,b=["ms","O","Moz","Webkit"];if(void 0!==a.transition)return!0;for(;b.length;)if(b.pop()+"Transition"in a)return!0;return!1};t.prototype={constructor:t,init:function(){var c=navigator.appVersion;b.isIE7=-1!==c.indexOf("MSIE 7."),b.isIE8=-1!==c.indexOf("MSIE 8."),b.isLowIE=b.isIE7||b.isIE8,b.isAndroid=/android/gi.test(c),b.isIOS=/iphone|ipad|ipod/gi.test(c),b.supportsTransition=B(),b.probablyMobile=b.isAndroid||b.isIOS||/(Opera Mini)|Kindle|webOS|BlackBerry|(Opera Mobi)|(Windows Phone)|IEMobile/i.test(navigator.userAgent),d=a(document),b.popupsCache={}},open:function(c){var e;if(c.isObj===!1){b.items=c.items.toArray(),b.index=0;var g,h=c.items;for(e=0;e<h.length;e++)if(g=h[e],g.parsed&&(g=g.el[0]),g===c.el[0]){b.index=e;break}}else b.items=a.isArray(c.items)?c.items:[c.items],b.index=c.index||0;if(b.isOpen)return void b.updateItemHTML();b.types=[],f="",b.ev=c.mainEl&&c.mainEl.length?c.mainEl.eq(0):d,c.key?(b.popupsCache[c.key]||(b.popupsCache[c.key]={}),b.currTemplate=b.popupsCache[c.key]):b.currTemplate={},b.st=a.extend(!0,{},a.magnificPopup.defaults,c),b.fixedContentPos="auto"===b.st.fixedContentPos?!b.probablyMobile:b.st.fixedContentPos,b.st.modal&&(b.st.closeOnContentClick=!1,b.st.closeOnBgClick=!1,b.st.showCloseBtn=!1,b.st.enableEscapeKey=!1),b.bgOverlay||(b.bgOverlay=x("bg").on("click"+p,function(){b.close()}),b.wrap=x("wrap").attr("tabindex",-1).on("click"+p,function(a){b._checkIfClose(a.target)&&b.close()}),b.container=x("container",b.wrap)),b.contentContainer=x("content"),b.st.preloader&&(b.preloader=x("preloader",b.container,b.st.tLoading));var i=a.magnificPopup.modules;for(e=0;e<i.length;e++){var j=i[e];j=j.charAt(0).toUpperCase()+j.slice(1),b["init"+j].call(b)}y("BeforeOpen"),b.st.showCloseBtn&&(b.st.closeBtnInside?(w(l,function(a,b,c,d){c.close_replaceWith=z(d.type)}),f+=" mfp-close-btn-in"):b.wrap.append(z())),b.st.alignTop&&(f+=" mfp-align-top"),b.wrap.css(b.fixedContentPos?{overflow:b.st.overflowY,overflowX:"hidden",overflowY:b.st.overflowY}:{top:v.scrollTop(),position:"absolute"}),(b.st.fixedBgPos===!1||"auto"===b.st.fixedBgPos&&!b.fixedContentPos)&&b.bgOverlay.css({height:d.height(),position:"absolute"}),b.st.enableEscapeKey&&d.on("keyup"+p,function(a){27===a.keyCode&&b.close()}),v.on("resize"+p,function(){b.updateSize()}),b.st.closeOnContentClick||(f+=" mfp-auto-cursor"),f&&b.wrap.addClass(f);var k=b.wH=v.height(),n={};if(b.fixedContentPos&&b._hasScrollBar(k)){var o=b._getScrollbarSize();o&&(n.marginRight=o)}b.fixedContentPos&&(b.isIE7?a("body, html").css("overflow","hidden"):n.overflow="hidden");var r=b.st.mainClass;return b.isIE7&&(r+=" mfp-ie7"),r&&b._addClassToMFP(r),b.updateItemHTML(),y("BuildControls"),a("html").css(n),b.bgOverlay.add(b.wrap).prependTo(b.st.prependTo||a(document.body)),b._lastFocusedEl=document.activeElement,setTimeout(function(){b.content?(b._addClassToMFP(q),b._setFocus()):b.bgOverlay.addClass(q),d.on("focusin"+p,b._onFocusIn)},16),b.isOpen=!0,b.updateSize(k),y(m),c},close:function(){b.isOpen&&(y(i),b.isOpen=!1,b.st.removalDelay&&!b.isLowIE&&b.supportsTransition?(b._addClassToMFP(r),setTimeout(function(){b._close()},b.st.removalDelay)):b._close())},_close:function(){y(h);var c=r+" "+q+" ";if(b.bgOverlay.detach(),b.wrap.detach(),b.container.empty(),b.st.mainClass&&(c+=b.st.mainClass+" "),b._removeClassFromMFP(c),b.fixedContentPos){var e={marginRight:""};b.isIE7?a("body, html").css("overflow",""):e.overflow="",a("html").css(e)}d.off("keyup"+p+" focusin"+p),b.ev.off(p),b.wrap.attr("class","mfp-wrap").removeAttr("style"),b.bgOverlay.attr("class","mfp-bg"),b.container.attr("class","mfp-container"),!b.st.showCloseBtn||b.st.closeBtnInside&&b.currTemplate[b.currItem.type]!==!0||b.currTemplate.closeBtn&&b.currTemplate.closeBtn.detach(),b._lastFocusedEl&&a(b._lastFocusedEl).focus(),b.currItem=null,b.content=null,b.currTemplate=null,b.prevHeight=0,y(j)},updateSize:function(a){if(b.isIOS){var c=document.documentElement.clientWidth/window.innerWidth,d=window.innerHeight*c;b.wrap.css("height",d),b.wH=d}else b.wH=a||v.height();b.fixedContentPos||b.wrap.css("height",b.wH),y("Resize")},updateItemHTML:function(){var c=b.items[b.index];b.contentContainer.detach(),b.content&&b.content.detach(),c.parsed||(c=b.parseEl(b.index));var d=c.type;if(y("BeforeChange",[b.currItem?b.currItem.type:"",d]),b.currItem=c,!b.currTemplate[d]){var f=b.st[d]?b.st[d].markup:!1;y("FirstMarkupParse",f),b.currTemplate[d]=f?a(f):!0}e&&e!==c.type&&b.container.removeClass("mfp-"+e+"-holder");var g=b["get"+d.charAt(0).toUpperCase()+d.slice(1)](c,b.currTemplate[d]);b.appendContent(g,d),c.preloaded=!0,y(n,c),e=c.type,b.container.prepend(b.contentContainer),y("AfterChange")},appendContent:function(a,c){b.content=a,a?b.st.showCloseBtn&&b.st.closeBtnInside&&b.currTemplate[c]===!0?b.content.find(".mfp-close").length||b.content.append(z()):b.content=a:b.content="",y(k),b.container.addClass("mfp-"+c+"-holder"),b.contentContainer.append(b.content)},parseEl:function(c){var d,e=b.items[c];if(e.tagName?e={el:a(e)}:(d=e.type,e={data:e,src:e.src}),e.el){for(var f=b.types,g=0;g<f.length;g++)if(e.el.hasClass("mfp-"+f[g])){d=f[g];break}e.src=e.el.attr("data-mfp-src"),e.src||(e.src=e.el.attr("href"))}return e.type=d||b.st.type||"inline",e.index=c,e.parsed=!0,b.items[c]=e,y("ElementParse",e),b.items[c]},addGroup:function(a,c){var d=function(d){d.mfpEl=this,b._openClick(d,a,c)};c||(c={});var e="click.magnificPopup";c.mainEl=a,c.items?(c.isObj=!0,a.off(e).on(e,d)):(c.isObj=!1,c.delegate?a.off(e).on(e,c.delegate,d):(c.items=a,a.off(e).on(e,d)))},_openClick:function(c,d,e){var f=void 0!==e.midClick?e.midClick:a.magnificPopup.defaults.midClick;if(f||2!==c.which&&!c.ctrlKey&&!c.metaKey){var g=void 0!==e.disableOn?e.disableOn:a.magnificPopup.defaults.disableOn;if(g)if(a.isFunction(g)){if(!g.call(b))return!0}else if(v.width()<g)return!0;c.type&&(c.preventDefault(),b.isOpen&&c.stopPropagation()),e.el=a(c.mfpEl),e.delegate&&(e.items=d.find(e.delegate)),b.open(e)}},updateStatus:function(a,d){if(b.preloader){c!==a&&b.container.removeClass("mfp-s-"+c),d||"loading"!==a||(d=b.st.tLoading);var e={status:a,text:d};y("UpdateStatus",e),a=e.status,d=e.text,b.preloader.html(d),b.preloader.find("a").on("click",function(a){a.stopImmediatePropagation()}),b.container.addClass("mfp-s-"+a),c=a}},_checkIfClose:function(c){if(!a(c).hasClass(s)){var d=b.st.closeOnContentClick,e=b.st.closeOnBgClick;if(d&&e)return!0;if(!b.content||a(c).hasClass("mfp-close")||b.preloader&&c===b.preloader[0])return!0;if(c===b.content[0]||a.contains(b.content[0],c)){if(d)return!0}else if(e&&a.contains(document,c))return!0;return!1}},_addClassToMFP:function(a){b.bgOverlay.addClass(a),b.wrap.addClass(a)},_removeClassFromMFP:function(a){this.bgOverlay.removeClass(a),b.wrap.removeClass(a)},_hasScrollBar:function(a){return(b.isIE7?d.height():document.body.scrollHeight)>(a||v.height())},_setFocus:function(){(b.st.focus?b.content.find(b.st.focus).eq(0):b.wrap).focus()},_onFocusIn:function(c){return c.target===b.wrap[0]||a.contains(b.wrap[0],c.target)?void 0:(b._setFocus(),!1)},_parseMarkup:function(b,c,d){var e;d.data&&(c=a.extend(d.data,c)),y(l,[b,c,d]),a.each(c,function(a,c){if(void 0===c||c===!1)return!0;if(e=a.split("_"),e.length>1){var d=b.find(p+"-"+e[0]);if(d.length>0){var f=e[1];"replaceWith"===f?d[0]!==c[0]&&d.replaceWith(c):"img"===f?d.is("img")?d.attr("src",c):d.replaceWith('<img src="'+c+'" class="'+d.attr("class")+'" />'):d.attr(e[1],c)}}else b.find(p+"-"+a).html(c)})},_getScrollbarSize:function(){if(void 0===b.scrollbarSize){var a=document.createElement("div");a.style.cssText="width: 99px; height: 99px; overflow: scroll; position: absolute; top: -9999px;",document.body.appendChild(a),b.scrollbarSize=a.offsetWidth-a.clientWidth,document.body.removeChild(a)}return b.scrollbarSize}},a.magnificPopup={instance:null,proto:t.prototype,modules:[],open:function(b,c){return A(),b=b?a.extend(!0,{},b):{},b.isObj=!0,b.index=c||0,this.instance.open(b)},close:function(){return a.magnificPopup.instance&&a.magnificPopup.instance.close()},registerModule:function(b,c){c.options&&(a.magnificPopup.defaults[b]=c.options),a.extend(this.proto,c.proto),this.modules.push(b)},defaults:{disableOn:0,key:null,midClick:!1,mainClass:"",preloader:!0,focus:"",closeOnContentClick:!1,closeOnBgClick:!0,closeBtnInside:!0,showCloseBtn:!0,enableEscapeKey:!0,modal:!1,alignTop:!1,removalDelay:0,prependTo:null,fixedContentPos:"auto",fixedBgPos:"auto",overflowY:"auto",closeMarkup:'<button title="%title%" type="button" class="mfp-close">&times;</button>',tClose:"Close (Esc)",tLoading:"Loading..."}},a.fn.magnificPopup=function(c){A();var d=a(this);if("string"==typeof c)if("open"===c){var e,f=u?d.data("magnificPopup"):d[0].magnificPopup,g=parseInt(arguments[1],10)||0;f.items?e=f.items[g]:(e=d,f.delegate&&(e=e.find(f.delegate)),e=e.eq(g)),b._openClick({mfpEl:e},d,f)}else b.isOpen&&b[c].apply(b,Array.prototype.slice.call(arguments,1));else c=a.extend(!0,{},c),u?d.data("magnificPopup",c):d[0].magnificPopup=c,b.addGroup(d,c);return d};var C,D,E,F="inline",G=function(){E&&(D.after(E.addClass(C)).detach(),E=null)};a.magnificPopup.registerModule(F,{options:{hiddenClass:"hide",markup:"",tNotFound:"Content not found"},proto:{initInline:function(){b.types.push(F),w(h+"."+F,function(){G()})},getInline:function(c,d){if(G(),c.src){var e=b.st.inline,f=a(c.src);if(f.length){var g=f[0].parentNode;g&&g.tagName&&(D||(C=e.hiddenClass,D=x(C),C="mfp-"+C),E=f.after(D).detach().removeClass(C)),b.updateStatus("ready")}else b.updateStatus("error",e.tNotFound),f=a("<div>");return c.inlineElement=f,f}return b.updateStatus("ready"),b._parseMarkup(d,{},c),d}}});var H,I="ajax",J=function(){H&&a(document.body).removeClass(H)},K=function(){J(),b.req&&b.req.abort()};a.magnificPopup.registerModule(I,{options:{settings:null,cursor:"mfp-ajax-cur",tError:'<a href="%url%">The content</a> could not be loaded.'},proto:{initAjax:function(){b.types.push(I),H=b.st.ajax.cursor,w(h+"."+I,K),w("BeforeChange."+I,K)},getAjax:function(c){H&&a(document.body).addClass(H),b.updateStatus("loading");var d=a.extend({url:c.src,success:function(d,e,f){var g={data:d,xhr:f};y("ParseAjax",g),b.appendContent(a(g.data),I),c.finished=!0,J(),b._setFocus(),setTimeout(function(){b.wrap.addClass(q)},16),b.updateStatus("ready"),y("AjaxContentAdded")},error:function(){J(),c.finished=c.loadError=!0,b.updateStatus("error",b.st.ajax.tError.replace("%url%",c.src))}},b.st.ajax.settings);return b.req=a.ajax(d),""}}});var L,M=function(c){if(c.data&&void 0!==c.data.title)return c.data.title;var d=b.st.image.titleSrc;if(d){if(a.isFunction(d))return d.call(b,c);if(c.el)return c.el.attr(d)||""}return""};a.magnificPopup.registerModule("image",{options:{markup:'<div class="mfp-figure"><div class="mfp-close"></div><figure><div class="mfp-img"></div><figcaption><div class="mfp-bottom-bar"><div class="mfp-title"></div><div class="mfp-counter"></div></div></figcaption></figure></div>',cursor:"mfp-zoom-out-cur",titleSrc:"title",verticalFit:!0,tError:'<a href="%url%">The image</a> could not be loaded.'},proto:{initImage:function(){var c=b.st.image,d=".image";b.types.push("image"),w(m+d,function(){"image"===b.currItem.type&&c.cursor&&a(document.body).addClass(c.cursor)}),w(h+d,function(){c.cursor&&a(document.body).removeClass(c.cursor),v.off("resize"+p)}),w("Resize"+d,b.resizeImage),b.isLowIE&&w("AfterChange",b.resizeImage)},resizeImage:function(){var a=b.currItem;if(a&&a.img&&b.st.image.verticalFit){var c=0;b.isLowIE&&(c=parseInt(a.img.css("padding-top"),10)+parseInt(a.img.css("padding-bottom"),10)),a.img.css("max-height",b.wH-c)}},_onImageHasSize:function(a){a.img&&(a.hasSize=!0,L&&clearInterval(L),a.isCheckingImgSize=!1,y("ImageHasSize",a),a.imgHidden&&(b.content&&b.content.removeClass("mfp-loading"),a.imgHidden=!1))},findImageSize:function(a){var c=0,d=a.img[0],e=function(f){L&&clearInterval(L),L=setInterval(function(){return d.naturalWidth>0?void b._onImageHasSize(a):(c>200&&clearInterval(L),c++,void(3===c?e(10):40===c?e(50):100===c&&e(500)))},f)};e(1)},getImage:function(c,d){var e=0,f=function(){c&&(c.img[0].complete?(c.img.off(".mfploader"),c===b.currItem&&(b._onImageHasSize(c),b.updateStatus("ready")),c.hasSize=!0,c.loaded=!0,y("ImageLoadComplete")):(e++,200>e?setTimeout(f,100):g()))},g=function(){c&&(c.img.off(".mfploader"),c===b.currItem&&(b._onImageHasSize(c),b.updateStatus("error",h.tError.replace("%url%",c.src))),c.hasSize=!0,c.loaded=!0,c.loadError=!0)},h=b.st.image,i=d.find(".mfp-img");if(i.length){var j=document.createElement("img");j.className="mfp-img",c.el&&c.el.find("img").length&&(j.alt=c.el.find("img").attr("alt")),c.img=a(j).on("load.mfploader",f).on("error.mfploader",g),j.src=c.src,i.is("img")&&(c.img=c.img.clone()),j=c.img[0],j.naturalWidth>0?c.hasSize=!0:j.width||(c.hasSize=!1)}return b._parseMarkup(d,{title:M(c),img_replaceWith:c.img},c),b.resizeImage(),c.hasSize?(L&&clearInterval(L),c.loadError?(d.addClass("mfp-loading"),b.updateStatus("error",h.tError.replace("%url%",c.src))):(d.removeClass("mfp-loading"),b.updateStatus("ready")),d):(b.updateStatus("loading"),c.loading=!0,c.hasSize||(c.imgHidden=!0,d.addClass("mfp-loading"),b.findImageSize(c)),d)}}});var N,O=function(){return void 0===N&&(N=void 0!==document.createElement("p").style.MozTransform),N};a.magnificPopup.registerModule("zoom",{options:{enabled:!1,easing:"ease-in-out",duration:300,opener:function(a){return a.is("img")?a:a.find("img")}},proto:{initZoom:function(){var a,c=b.st.zoom,d=".zoom";if(c.enabled&&b.supportsTransition){var e,f,g=c.duration,j=function(a){var b=a.clone().removeAttr("style").removeAttr("class").addClass("mfp-animated-image"),d="all "+c.duration/1e3+"s "+c.easing,e={position:"fixed",zIndex:9999,left:0,top:0,"-webkit-backface-visibility":"hidden"},f="transition";return e["-webkit-"+f]=e["-moz-"+f]=e["-o-"+f]=e[f]=d,b.css(e),b},k=function(){b.content.css("visibility","visible")};w("BuildControls"+d,function(){if(b._allowZoom()){if(clearTimeout(e),b.content.css("visibility","hidden"),a=b._getItemToZoom(),!a)return void k();f=j(a),f.css(b._getOffset()),b.wrap.append(f),e=setTimeout(function(){f.css(b._getOffset(!0)),e=setTimeout(function(){k(),setTimeout(function(){f.remove(),a=f=null,y("ZoomAnimationEnded")},16)},g)},16)}}),w(i+d,function(){if(b._allowZoom()){if(clearTimeout(e),b.st.removalDelay=g,!a){if(a=b._getItemToZoom(),!a)return;f=j(a)}f.css(b._getOffset(!0)),b.wrap.append(f),b.content.css("visibility","hidden"),setTimeout(function(){f.css(b._getOffset())},16)}}),w(h+d,function(){b._allowZoom()&&(k(),f&&f.remove(),a=null)})}},_allowZoom:function(){return"image"===b.currItem.type},_getItemToZoom:function(){return b.currItem.hasSize?b.currItem.img:!1},_getOffset:function(c){var d;d=c?b.currItem.img:b.st.zoom.opener(b.currItem.el||b.currItem);var e=d.offset(),f=parseInt(d.css("padding-top"),10),g=parseInt(d.css("padding-bottom"),10);e.top-=a(window).scrollTop()-f;var h={width:d.width(),height:(u?d.innerHeight():d[0].offsetHeight)-g-f};return O()?h["-moz-transform"]=h.transform="translate("+e.left+"px,"+e.top+"px)":(h.left=e.left,h.top=e.top),h}}});var P="iframe",Q="//about:blank",R=function(a){if(b.currTemplate[P]){var c=b.currTemplate[P].find("iframe");c.length&&(a||(c[0].src=Q),b.isIE8&&c.css("display",a?"block":"none"))}};a.magnificPopup.registerModule(P,{options:{markup:'<div class="mfp-iframe-scaler"><div class="mfp-close"></div><iframe class="mfp-iframe" src="//about:blank" frameborder="0" allowfullscreen></iframe></div>',srcAction:"iframe_src",patterns:{youtube:{index:"youtube.com",id:"v=",src:"//www.youtube.com/embed/%id%?autoplay=1"},vimeo:{index:"vimeo.com/",id:"/",src:"//player.vimeo.com/video/%id%?autoplay=1"},gmaps:{index:"//maps.google.",src:"%id%&output=embed"}}},proto:{initIframe:function(){b.types.push(P),w("BeforeChange",function(a,b,c){b!==c&&(b===P?R():c===P&&R(!0))}),w(h+"."+P,function(){R()})},getIframe:function(c,d){var e=c.src,f=b.st.iframe;a.each(f.patterns,function(){return e.indexOf(this.index)>-1?(this.id&&(e="string"==typeof this.id?e.substr(e.lastIndexOf(this.id)+this.id.length,e.length):this.id.call(this,e)),e=this.src.replace("%id%",e),!1):void 0});var g={};return f.srcAction&&(g[f.srcAction]=e),b._parseMarkup(d,g,c),b.updateStatus("ready"),d}}});var S=function(a){var c=b.items.length;return a>c-1?a-c:0>a?c+a:a},T=function(a,b,c){return a.replace(/%curr%/gi,b+1).replace(/%total%/gi,c)};a.magnificPopup.registerModule("gallery",{options:{enabled:!1,arrowMarkup:'<button title="%title%" type="button" class="mfp-arrow mfp-arrow-%dir%"></button>',preload:[0,2],navigateByImgClick:!0,arrows:!0,tPrev:"Previous (Left arrow key)",tNext:"Next (Right arrow key)",tCounter:"%curr% of %total%"},proto:{initGallery:function(){var c=b.st.gallery,e=".mfp-gallery",g=Boolean(a.fn.mfpFastClick);return b.direction=!0,c&&c.enabled?(f+=" mfp-gallery",w(m+e,function(){c.navigateByImgClick&&b.wrap.on("click"+e,".mfp-img",function(){return b.items.length>1?(b.next(),!1):void 0}),d.on("keydown"+e,function(a){37===a.keyCode?b.prev():39===a.keyCode&&b.next()})}),w("UpdateStatus"+e,function(a,c){c.text&&(c.text=T(c.text,b.currItem.index,b.items.length))}),w(l+e,function(a,d,e,f){var g=b.items.length;e.counter=g>1?T(c.tCounter,f.index,g):""}),w("BuildControls"+e,function(){if(b.items.length>1&&c.arrows&&!b.arrowLeft){var d=c.arrowMarkup,e=b.arrowLeft=a(d.replace(/%title%/gi,c.tPrev).replace(/%dir%/gi,"left")).addClass(s),f=b.arrowRight=a(d.replace(/%title%/gi,c.tNext).replace(/%dir%/gi,"right")).addClass(s),h=g?"mfpFastClick":"click";e[h](function(){b.prev()}),f[h](function(){b.next()}),b.isIE7&&(x("b",e[0],!1,!0),x("a",e[0],!1,!0),x("b",f[0],!1,!0),x("a",f[0],!1,!0)),b.container.append(e.add(f))}}),w(n+e,function(){b._preloadTimeout&&clearTimeout(b._preloadTimeout),b._preloadTimeout=setTimeout(function(){b.preloadNearbyImages(),b._preloadTimeout=null},16)}),void w(h+e,function(){d.off(e),b.wrap.off("click"+e),b.arrowLeft&&g&&b.arrowLeft.add(b.arrowRight).destroyMfpFastClick(),b.arrowRight=b.arrowLeft=null})):!1},next:function(){b.direction=!0,b.index=S(b.index+1),b.updateItemHTML()},prev:function(){b.direction=!1,b.index=S(b.index-1),b.updateItemHTML()},goTo:function(a){b.direction=a>=b.index,b.index=a,b.updateItemHTML()},preloadNearbyImages:function(){var a,c=b.st.gallery.preload,d=Math.min(c[0],b.items.length),e=Math.min(c[1],b.items.length);for(a=1;a<=(b.direction?e:d);a++)b._preloadItem(b.index+a);for(a=1;a<=(b.direction?d:e);a++)b._preloadItem(b.index-a)},_preloadItem:function(c){if(c=S(c),!b.items[c].preloaded){var d=b.items[c];d.parsed||(d=b.parseEl(c)),y("LazyLoad",d),"image"===d.type&&(d.img=a('<img class="mfp-img" />').on("load.mfploader",function(){d.hasSize=!0}).on("error.mfploader",function(){d.hasSize=!0,d.loadError=!0,y("LazyLoadError",d)}).attr("src",d.src)),d.preloaded=!0}}}});var U="retina";a.magnificPopup.registerModule(U,{options:{replaceSrc:function(a){return a.src.replace(/\.\w+$/,function(a){return"@2x"+a})},ratio:1},proto:{initRetina:function(){if(window.devicePixelRatio>1){var a=b.st.retina,c=a.ratio;c=isNaN(c)?c():c,c>1&&(w("ImageHasSize."+U,function(a,b){b.img.css({"max-width":b.img[0].naturalWidth/c,width:"100%"})}),w("ElementParse."+U,function(b,d){d.src=a.replaceSrc(d,c)}))}}}}),function(){var b=1e3,c="ontouchstart"in window,d=function(){v.off("touchmove"+f+" touchend"+f)},e="mfpFastClick",f="."+e;a.fn.mfpFastClick=function(e){return a(this).each(function(){var g,h=a(this);if(c){var i,j,k,l,m,n;h.on("touchstart"+f,function(a){l=!1,n=1,m=a.originalEvent?a.originalEvent.touches[0]:a.touches[0],j=m.clientX,k=m.clientY,v.on("touchmove"+f,function(a){m=a.originalEvent?a.originalEvent.touches:a.touches,n=m.length,m=m[0],(Math.abs(m.clientX-j)>10||Math.abs(m.clientY-k)>10)&&(l=!0,d())}).on("touchend"+f,function(a){d(),l||n>1||(g=!0,a.preventDefault(),clearTimeout(i),i=setTimeout(function(){g=!1},b),e())})})}h.on("click"+f,function(){g||e()})})},a.fn.destroyMfpFastClick=function(){a(this).off("touchstart"+f+" click"+f),c&&v.off("touchmove"+f+" touchend"+f)}}(),A()});

(function($) {

  'use strict';

  var eTableClass = 'table-enlargeable', $articleContent;

  function tableWidth($t, bWidth) {
    var i = 13;
    while($t.width() >= bWidth) {
      $t.addClass('f-' + i);
      i -= 1;
      if(i === 7) {
        $t.closest('.table-responsive').addClass('no-scroll');
        break;
      }
    }
  }

  function findETables($tables) {
    var bodyWidth = $articleContent.width();
    $.each($tables, function() {
      var $t = $(this), $table = $t.find('table');
      if($table.width() > bodyWidth) {
        $t.addClass(eTableClass);
        tableWidth($table, bodyWidth);
      }
    });
  }

  function initETables() {
    $articleContent.on('click', '.' + eTableClass, function(e) {
      e.preventDefault();
      $.magnificPopup.open({
        items: {
          src: $(this).html(),
          type: 'inline'
        },
        mainClass: 'table-popup'
      }, 0);
    });
  }


  function tables() {
    var $tables = $articleContent.find('.table-responsive');
    if($tables.length) {
      findETables($tables);
      initETables();
    }
  }

  function images() {
    $articleContent.on('click', 'a[rel="lightbox"]', function(e) {
      e.preventDefault();
      var src = $(this).attr('href');
      if(src) {
        $.magnificPopup.open({
          items: {
            src: src,
            type: 'image'
          }
        }, 0);
      }
    });
  }

  function init() {
    $articleContent = $('.sa-art');
    tables();
    images();
  }

  init();

}(window.jQuery));
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/article_details/article_details"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div id="article_scoring_body_selections">\n  <div class="title">ARTICLE SCORING:</div>\n  <table id="scoring_table" class="table">\n    <tbody>\n    ');  for(var ind=0; ind < questions.length; ind++) { ; __p.push('\n        <tr data-id="',  questions[ind].id ,'">\n          <td data-column="selection_label">',  questions[ind].name ,'</td>\n          <td data-column="selection_score_combo">\n            <select class="form-control">\n              <option value=""></option>\n              <option value="1" ',  userScore[questions[ind].id]==1 ? "selected" : "notselected" ,'>1</option>\n              <option value="2" ',  userScore[questions[ind].id]==2 ? "selected" : "notselected" ,'>2</option>\n              <option value="3" ',  userScore[questions[ind].id]==3 ? "selected" : "notselected" ,'>3</option>\n              <option value="4" ',  userScore[questions[ind].id]==4 ? "selected" : "notselected" ,'>4</option>\n            </select>\n          </td>\n          <td class="score_btn ',  userScore[questions[ind].id]==1 ? 'active_score_button' : '','" data-column="selection_score_btn_1">1</td>\n          <td class="score_btn ',  userScore[questions[ind].id]==2 ? 'active_score_button' : '','" data-column="selection_score_btn_2">2</td>\n          <td class="score_btn ',  userScore[questions[ind].id]==3 ? 'active_score_button' : '','" data-column="selection_score_btn_3">3</td>\n          <td class="score_btn ',  userScore[questions[ind].id]==4 ? 'active_score_button' : '','" data-column="selection_score_btn_4">4</td>\n        </tr>\n    ');  } ; __p.push('\n      </tbody>\n  </table>\n</div>\n<div id="article_scoring_body_comment_wrapper">\n  <button class="btn btn-default" type="button">Enter Comment</button>\n  <textarea rows="4">',  userComment ,'</textarea>\n</div>\n<div id="article_scoring_body_buttons_row">\n  <button class="btn btn-primary" type="button" disabled="disabled">Score This!</button>&nbsp;\n  <a class="btn btn-link">Hide All Scores</a>\n</div>\n<div id="article_scoring_body_all_results_wrapper" class="active">\n  <div id="article_scoring_body_results">\n    <table class="table">\n      <thead>\n      <tr>\n        <th data-col="editor">\n          Editor\n        </th>\n        <th data-col="score">\n          Convincing\n        </th>\n        <th data-col="score">\n          Actionable\n        </th>\n        <th data-col="score">\n          Well-presented\n        </th>\n      </tr>\n      </thead>\n      <tbody>\n      ');  for(var ind = 0; ind<arrComments.length; ind++) { ; __p.push('\n          <tr>\n            <td rowspan=2 data-col="editor" class="text-center">',  arrComments[ind].editor ,'</td>\n            <td data-col="score" class="text-center">',  arrComments[ind].convincing ,'</td>\n            <td data-col="score" class="text-center">',  arrComments[ind].actionable ,'</td>\n            <td data-col="score" class="text-center">',  arrComments[ind].wellPresented ,'</td>\n          </tr>\n          <tr>\n            <td colspan="3" data-col="comment">\n              ',  arrComments[ind].comment ,'\n            </td>\n          </tr>\n          ');  } ; __p.push('\n          </tbody>\n          </table>\n          </div>\n          <div id="article_scoring_body_pageviews_row">\n            <span>PAGE VIEWS : </span><span> ',  totalPv ,' </span>\n          </div>\n          <div id="article_scoring_body_proof_row">\n            <span>PROOFREAD : </span><span class="',  isProofRead ? 'text-success' : 'text-danger' ,'">',  isProofRead ? "Yes" : "No" ,'</span>\n          </div>\n          <div id="article-tags">\n            <span>TAGS : </span><span class="tags">',  taggedUrlsHtml ,'</span>\n          </div>\n</div>\n');}return __p.join('');};
}).call(this);

(function (SA, $) {

  "use strict";

  var scope = SA.UsingNamespace('SA.Widgets.ArticleDetails'),
      $articleScoringWrapper = $('#article-scoring'),
      articleScoringWrapperHtml = [
        "<div id='article-scoring-wrapper'>" +
          "<button type='button' class='btn btn-default btn-primary' role='button' id='article_scoring_bttn'>",
            "Open Article Details",
          "</button>",
          "<div id='article_scoring_body'></div>" +
        "<div>"
      ].join(""),
      activeScoreBtnCls = 'active_score_button',
      pData,
      scrO,
      aId,
      scoringTableRows,
      rowScoreBtns,
      $openAreaBtn,
      $scrBtn,
      $saveBtn,
      $textArea,
      $showTextAreaBtn,
      $showAllResultsBtn,
      $allResults,
      $articleScoringBody,
      areaTemplate;

  function setActiveScoreButton($tr, newValue) {
    rowScoreBtns = $tr.find(".score_btn");
    $.each(rowScoreBtns, function (k, item) {
      $scrBtn = $(item);
      if (parseInt($scrBtn.html(), 10) === newValue) {
        $scrBtn.addClass(activeScoreBtnCls);
      } else {
        $scrBtn.removeClass(activeScoreBtnCls);
      }
    });
  }

  function bindEvents() {
    $openAreaBtn.one("click", function(){
      $articleScoringBody.html("");
      $openAreaBtn.html("Open Article Details");
      bindOpenAreaBtn();
    });
    $.each(scoringTableRows, function (k, value) {
      var $value = $(value);
      $value.find("select").on("change", function () {
        var $target = $(this), $tr = $target.closest("tr"), id = $tr.data("id"), newValue = parseInt($target.val(), 10);
        if(newValue>0 && newValue<5){
          scrO.userScore[id] = newValue;
          setActiveScoreButton($tr, newValue);
        } else{
          scrO.userScore[id] = undefined;
          setActiveScoreButton($tr, undefined);
        }
        if(scrO && scrO.userScore["2"] && scrO.userScore["3"] && scrO.userScore["4"]){
          $saveBtn.removeAttr("disabled");
        } else{
          $saveBtn.attr("disabled", "disabled");
        }
      });
      $value.find(".score_btn").on("click", function () {
        var $target = $(this), $tr = $target.closest("tr"), id = $tr.data("id"), newValue = parseInt($target.html(), 10);
        scrO.userScore[id] = newValue;
        setActiveScoreButton($tr, newValue);
        $tr.find("select").val(newValue);
        if(scrO && scrO.userScore["2"] && scrO.userScore["3"] && scrO.userScore["4"]){
          $saveBtn.removeAttr("disabled");
        } else{
          $saveBtn.attr("disabled", "disabled");
        }
      });
    });

    $showTextAreaBtn.on("click",function(){
      if($textArea.hasClass('active')){
        $textArea.removeClass('active');
        $showTextAreaBtn.html('Enter Comment');
      } else{
        $textArea.addClass('active');
        $showTextAreaBtn.html('Close Comment');
      }
    });

    $showAllResultsBtn.on("click",function(){
      if($allResults.hasClass('active')){
        $allResults.removeClass('active');
        $showAllResultsBtn.html('Show All Scores');
      } else{
        $allResults.addClass('active');
        $showAllResultsBtn.html('Hide All Scores');
      }
    });

    $textArea.on("change", function(){
      scrO.userComment = $textArea.val();
    });

    $saveBtn.on("click", saveUserScore);
  }

  function getDetailsData() {
    aId = pData.article.id;
    $.ajax(
        {
          url: '/article_scoring/ajax_get_score',
          method: 'POST',
          dataType: 'json',
          data: {
            article_id: aId
          }
        }).done(function (data) {
          getUserArticleScoreCb(data);
        }).fail(function () {
          callErrorAlert();
        });

    function callErrorAlert(){
      alert('Error in data retrieval process.');
    }

    function getUserArticleScoreCb(data) {

      if (!data || !data.user_article_scoring) {
        callErrorAlert();
        return;
      }

      scrO = {};
      scrO.postType = "article";
      scrO.userScore = data.user_article_scoring.scored || { "2": "", "3": "","4": ""};
      scrO.userComment = data.user_article_scoring.comment || "";
      scrO.totalPv = data.total_pv || 0;
      scrO.isProofRead = data.is_proofread || false;

      $.ajax(
          {
            url: '/article_scoring/all_article_scores',
            method: 'POST',
            dataType: 'json',
            data: {
              p_id: aId,
              post_type: scrO.postType
            }
          }).done(function (data) {
            getAllArticleScoresCb(data);
          }).fail(function(){
            callErrorAlert();
          });
    }

    function getAllArticleScoresCb(data) {
      if (!data || !data.hasOwnProperty('article_scoring')) {
        callErrorAlert();
        return;
      }
      scrO.arrComments = $.map(data.article_scoring, function (value) {
        return {
          editor: value && value.editor && value.editor.nick ? value.editor.nick : "",
          convincing: value && value.score2 !== null && value.score2 !== undefined ? value.score2 : 0,
          actionable: value && value.score3 !== null && value.score3 !== undefined ? value.score3 : 0,
          wellPresented: value && value.score4 !== null && value.score4 !== undefined ? value.score4 : 0,
          comment: value && value.comment ? value.comment : ""
        };
      });

      scrO.questions = [
        {
          id: "2",
          name: "Convincing"
        },
        {
          id: "3",
          name: "Actionable"
        },
        {
          id: "4",
          name: "well-presented"
        }
      ];
      scrO.taggedUrlsHtml = SA.pageConfig.Data.article.taggedUrlsHtml;

      areaTemplate = JST['jst/widgets/article_details/article_details'](scrO);
      $articleScoringBody.html(areaTemplate);
      setJqRefs();
      $openAreaBtn.html("Close Article Details");
      bindEvents();
    }

  }

  function saveUserScore(){
    $.ajax(
        {
          url: '/article_scoring/article_scoring',
          method: 'POST',
          dataType: 'json',
          data: {
            p_id: pData.article.id,
            post_type: scrO.postType,
            article_scoring: "2#"+scrO.userScore["2"]+",3#"+scrO.userScore["3"]+",4#"+scrO.userScore["4"],
            article_scoring_comment: scrO.userComment
          }
        }).done(function (data) {
          alert("Scores updated on server");
        }).fail(function (jqXHR, textStatus, errorThrown) {
          alert("Data save error");
        });
  }

  function bindOpenAreaBtn(){
    $openAreaBtn.one("click", function(){
      $openAreaBtn.html("Loading...");
      getDetailsData();
    });
  }

  function setJqRefs(){
    scoringTableRows = $articleScoringBody.find('#scoring_table tr');
    $saveBtn = $articleScoringBody.find('#article_scoring_body_buttons_row button');
    $textArea = $articleScoringBody.find('#article_scoring_body_comment_wrapper textarea');
    $showTextAreaBtn = $articleScoringBody.find('#article_scoring_body_comment_wrapper button');
    $showAllResultsBtn = $articleScoringBody.find('#article_scoring_body_buttons_row .btn-link');
    $allResults = $articleScoringBody.find('#article_scoring_body_all_results_wrapper');
  }

  scope.init = function (pageData) {
    pageData.article = pageData.article || {};
    if (pageData.article.id && !pageData.article.isTranscript && SA.Data.User.isSATeam() && /article scoring/.test(SA.Data.Cookies.get("user_perm"))) {
      pData = pageData;
      $articleScoringWrapper.replaceWith(articleScoringWrapperHtml);
      $openAreaBtn = $('#article_scoring_bttn');
      $articleScoringBody = $('#article_scoring_body');
      bindOpenAreaBtn();
    }
  };

}(SA, jQuery));

(function (SA, $) {

  "use strict";

  var ARTICLE_ID = 4270261;

  function init() {
    if (SA.pageConfig.Data.article.id === ARTICLE_ID) {
      SA.Utils.AbTests.init({
        'premium_vs_subscriptions_test': function (variation) {
          if (variation === 'test_v1') {
            $("#a-body a[href*='/subscriptions']").attr('href', '/premium');
          }
        }
      });
    }
  }

  init();

}(SA, jQuery));
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/comments/follow_btn/follow_author_btn"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<a href="#" class="sa-follow-btn" data-source="',  source ,'" data-following="',  following ,'" data-type="author" data-comment-id="',  commentId ,'" data-slug="',  slug ,'">',  following ? 'Following' : '+ Follow' ,'</a>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/comments/follow_btn/follow_user_btn"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<a href="#" class="sa-follow-btn" data-source="',  source ,'" data-following="',  following ,'" data-type="user" data-id="',  id ,'" data-comment-id="',  commentId ,'">',  following ? 'Following' : '+ Follow' ,'</a>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/comments/delivery_failure"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div class="no-c">Error while delivering comments</div>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/comments/no_comments"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div class="no-c hidden-print">Be the first to comment</div>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/comments/actions"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<a class="c-track-btn ',  tracking ? "tracking" : "track" ,'" ',  disabled ? "disabled" : "" ,'></a>\n<span class="divider"></span>\n<span class="sort_by">Sort by</span>\n<select class="c-sort-btn">\n  <option value="newest" ',  sortBy === 'newest' ? 'selected' : '' ,'>Newest</option>\n  <option value="oldest" ',  sortBy === 'oldest' ? 'selected' : '' ,'>Oldest</option>\n  <option value="mostLiked" ',  sortBy === 'mostLiked' ? 'selected' : '' ,'>Most liked</option>\n</select>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/comments/comment"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div class="media c-body',  muted ? ' hidden' : '','',  newComment ? ' new-comment' : '','" id="',  anchor ,'"\n  data-commentid="',  commentId ,'"\n  data-parent="',  isParent ,'"\n  data-timestamp="',  timestamp ,'"\n  data-top-parent-id="',  topParentId ,'">\n  ',  likes.top ,'\n  <div class="media-left">\n    <a rel="nofollow" href="',  authorLink ,'">\n      <img class="a-img img-circle" src="',  userImageLink ,'" width="32" height="32">\n    </a>\n  </div>\n  <div class="media-body"\n    data-userId="',  userId ,'"\n    data-user-id="',  userId ,'"\n    data-user-type="',  userType ,'"\n    data-id="',  commentId ,'"\n    data-nick="',  nick ,'"\n    data-author-slug="',  authorSlug ,'"\n    data-content-url="',  commentLink ,'">\n    ');  if (userLoggedIn) { ; __p.push('\n      <div class="c-content-popup-toggler c-content-popup-toggler--bottom js-content-popup-toggle hidden-print"></div>\n    ');  } ; __p.push('\n    <div class="b-hd">\n      <a rel="nofollow" href="',  authorLink ,'" class="c-nick">',  nick ,'</a>',  authorStatus ? ', ' + authorStatus : '' ,'\n        <div class="badges" data-user-id="',  userId ,'"></div>\n      <div class="b-util hidden-print">\n        <a rel="nofollow" href="',  authorLink ,'/comments" class="un">Comments<span class="u-com-c" data-id="',  userId ,'">',  commentsCount ,'</span></a>\n        <span class="sep">|</span>\n        ',  followBtn ,'\n      </div>\n    </div>\n    <div class="b-b">\n       ',  content ,'\n       ');  if(editedByOwner)  { ; __p.push('\n             <span class="b-edited">(edited)</span>\n       ');  } ; __p.push('\n    </div>\n    <div class="b-ft">\n      <span class="c-pub">\n      ');  if (newComment) { ; __p.push('\n        <span class="c-new">NEW</span>\n        <span class="new-nav">\n          <span class="up"></span>\n          <span class="sep">|</span>\n          <span class="down"></span>\n        </span>\n      ');  } ; __p.push('\n        <span>',  publishDate ,'</span>\n      </span>\n      ',  editDeleteBtn ,'\n      ');  if(editBtn) { ; __p.push('\n        <a href="#" class="c-edit" data-comment="',  commentId ,'">Edit Comment</a>\n      ');  } ; __p.push('\n      ');  if(deleteBtn) { ; __p.push('\n        <a href="#" class="c-delete" data-comment="',  commentId ,'">Delete Comment</a>\n      ');  } ; __p.push('\n      <a href="#" class="pull-right ct-reply hidden-print" data-comment="',  commentId ,'">Reply</a>\n      ',  likes.count ,'\n      ',  likes.btn ,'\n    </div>\n    ',  children ,'\n  </div>\n</div>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/comments/wrapper"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div class="c-wrap">\n  <div class="c-head">\n    <div class="pull-left">\n      <h3>Comments <span class="c-total">0</span></h3>\n      <a class="new-comments-link hidden"></a>\n    </div>\n    <div class="c-h-actions pull-right hidden-print"></div>\n    <div class="clearfix"></div>\n  </div>\n  <div class="c-comment-box hidden-print"></div>\n  <div class="c-list"></div>\n</div>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/comments/contributor_status"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/comments/comment_box"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div class="well com-box" id="com-box">\n  <div class="media">\n   ');  if (userLoggedIn) { ; __p.push('\n      <div class="media-left">\n        <a rel="nofollow" href="',  link ,'" target="_blank">\n          <img class="media-object img-circle" src="',  pic ,'" width="32" height="32">\n        </a>\n      </div>\n      <div class="media-body">\n        <a rel="nofollow" href="',  link ,'" class="c-nick" target="_blank">',  name ,'</a>\n        <button type="button" class="close box-close hidden"></button>\n        <div class="upload-link hidden">\n          Before you comment, why not <a href="#">add your picture</a>?\n        </div>\n        <div id="temp_nick_placeholder" class="hidden clearfix">\n          <a href="#" class="create-username">Update Username</a><span class="required">(*required)</span>\n          <input class="hidden" type="text" name="user[userNick]" title="username">\n        </div>\n        <div class="cb-txt">Add Your Comment: (NEW! Use @ to tag a user)</div>\n        ');  moderationText = (articleModeratedMsg || {}).moderation_text ; __p.push('\n        ',  moderationText ? "<div class='cb-moderated-msg'>" + moderationText + '</div>' : '' ,'\n      </div>\n    '); } else { ; __p.push('\n      <div class="media-left">\n        <img class="media-object img-circle" width="32" height="32">\n      </div>\n      <div class="media-body">\n        <div class="cb-txt-alt">Add Your Comment</div>\n      </div>\n    ');  }; __p.push('\n    <form class="c-box-form">\n      <div class="form-group">\n        <textarea class="form-control" rows="3"></textarea>\n        <div class="btm">\n          <div class="pull-left pre-comment-share">\n            Share your comment:\n            <label><input type="checkbox" value="twitter" id="social-comments-twitter"> <div class="social-icon icon-twitter">&nbsp;</div></label>\n            <label><input type="checkbox" value="facebook" id="social-comments-facebook"> <div class="social-icon icon-facebook">&nbsp;</div></label>\n            <label><input type="checkbox" value="linkedin" id="social-comments-linkedin"> <div class="social-icon icon-linkedin">&nbsp;</div></label>\n          </div>\n          <div class="error pull-left"></div>\n          <button class="btn orange-btn update-btn pull-right hidden" disabled="disabled">Update</button>\n          <button type="submit" class="btn orange-btn reply-btn pull-right" disabled="disabled">Publish</button>\n          <div class="clearfix"></div>\n        </div>\n      </div>\n    </form>\n  </div>\n</div>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/comments/author_reply"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div class="auth-rep">Authors reply </div>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/comments/duplicate_popup/header"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<h4>Comment Error</h4>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/comments/duplicate_popup/item_body"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<p>Sorry, you cannot post duplicate comments</p>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/comments/duplicate_popup/footer"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<a href="#" class="btn btn-primary orange-btn" data-dismiss="modal">OK</a>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/comments/failed_nick_popup/header"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<h4>Comment Error</h4>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/comments/failed_nick_popup/footer"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<a href="#" class="btn btn-primary orange-btn" data-dismiss="modal">OK</a>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/comments/failed_nick_popup/item_body"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<p>The username you entered is not available</p>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/comments/moderation_popup/header"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<h4>Thank you for your patience.</h4>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/comments/moderation_popup/user_body"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<p>Your comment is being reviewed by our moderators and will be posted shortly if it is approved.</p>\n<p>For more info about moderation on Seeking Alpha, click <a href="/page/comment_guidelines">here</a>.</p>\n<p class="small">Time to posting may be longer outside of US business hours and at times of high comment volume.\n    If your comment is not approved, you may not receive any notification.</p>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/comments/moderation_popup/item_body"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<p>All comments on this article are being reviewed by our moderators and your comment should be posted shortly.</p>\n<p>For more info about moderation on Seeking Alpha, click <a href="/page/comment_guidelines">here</a>.</p>\n<p class="small">Time to posting may be longer outside of US business hours and at times of high comment volume.</p>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/comments/moderation_popup/footer"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<a href="#" class="btn btn-primary orange-btn" data-dismiss="modal">OK</a>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/comments/delete_popup/header"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<h4>Delete Comment</h4>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/comments/delete_popup/body"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<p>Are you sure you want to delete this comment?</p>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/comments/delete_popup/moderation_body"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<p>Are you sure you want to delete this comment and any replies to it?</p>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/comments/delete_popup/footer"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>\n<button type="button" class="btn btn-primary orange-btn conf-com-delete">Delete</button>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/comments/comment_likes_top"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div class="ct-likes-top hidden-print">\n  ');  if(count > 0){ ; __p.push('\n    ',  authorLiked ? '<span class="user">You, </span>' + authorName : '<span class="user">You</span>' ,'\n    and\n    <span class="n-others" data-toggle="popover"> ', count,' other',  count > 1 ? 's' : '','</span>\n  '); } else { ; __p.push('\n    ',  authorLiked ? '<span class="user">You and </span>' + authorName : '<span class="user">You</span>' ,'\n  ');  }; __p.push('\n  like this\n</div>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/comments/likes_popup/user_link"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<li>\n  <div class="media-left">\n    <a href="',  userLink ,'" ><img class="a-img" src="',  userImgSrc ,'"></a>\n  </div>\n  <div class="media-body">\n    <a href="',  userLink ,'" class="c-nick">',  userName ,'</a>\n  </div>\n</li>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/navigation/green_circle_check"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<svg version=\'1.1\' x=\'0\' y=\'0\' width=\'',  size || 30 ,'\' height=\'',  size || 30 ,'\' viewBox=\'0 0 30 30\'>\n  <circle fill=\'none\' stroke=\'#57BA5F\' stroke-width=\'1.7336\' stroke-miterlimit=\'10\' cx=\'14.761\' cy=\'15.114\' r=\'13.761\'/>\n  <polyline fill=\'none\' stroke=\'#54B960\' stroke-width=\'1.7336\' stroke-linecap="round" stroke-linejoin=\'round\' stroke-miterlimit=\'10\' points=\'9.583,16.165 12.548,20.431 19.939,9.799\'/>\n</svg>\n');}return __p.join('');};
}).call(this);
/**
 * Copyright (c) 2007-2015 Ariel Flesler - aflesler<a>gmail<d>com | http://flesler.blogspot.com
 * Licensed under MIT
 * @author Ariel Flesler
 * @version 2.1.1
 */

;(function(f){"use strict";"function"===typeof define&&define.amd?define(["jquery"],f):"undefined"!==typeof module&&module.exports?module.exports=f(require("jquery")):f(jQuery)})(function($){"use strict";function n(a){return!a.nodeName||-1!==$.inArray(a.nodeName.toLowerCase(),["iframe","#document","html","body"])}function h(a){return $.isFunction(a)||$.isPlainObject(a)?a:{top:a,left:a}}var p=$.scrollTo=function(a,d,b){return $(window).scrollTo(a,d,b)};p.defaults={axis:"xy",duration:0,limit:!0};$.fn.scrollTo=function(a,d,b){"object"=== typeof d&&(b=d,d=0);"function"===typeof b&&(b={onAfter:b});"max"===a&&(a=9E9);b=$.extend({},p.defaults,b);d=d||b.duration;var u=b.queue&&1<b.axis.length;u&&(d/=2);b.offset=h(b.offset);b.over=h(b.over);return this.each(function(){function k(a){var k=$.extend({},b,{queue:!0,duration:d,complete:a&&function(){a.call(q,e,b)}});r.animate(f,k)}if(null!==a){var l=n(this),q=l?this.contentWindow||window:this,r=$(q),e=a,f={},t;switch(typeof e){case "number":case "string":if(/^([+-]=?)?\d+(\.\d+)?(px|%)?$/.test(e)){e= h(e);break}e=l?$(e):$(e,q);if(!e.length)return;case "object":if(e.is||e.style)t=(e=$(e)).offset()}var v=$.isFunction(b.offset)&&b.offset(q,e)||b.offset;$.each(b.axis.split(""),function(a,c){var d="x"===c?"Left":"Top",m=d.toLowerCase(),g="scroll"+d,h=r[g](),n=p.max(q,c);t?(f[g]=t[m]+(l?0:h-r.offset()[m]),b.margin&&(f[g]-=parseInt(e.css("margin"+d),10)||0,f[g]-=parseInt(e.css("border"+d+"Width"),10)||0),f[g]+=v[m]||0,b.over[m]&&(f[g]+=e["x"===c?"width":"height"]()*b.over[m])):(d=e[m],f[g]=d.slice&& "%"===d.slice(-1)?parseFloat(d)/100*n:d);b.limit&&/^\d+$/.test(f[g])&&(f[g]=0>=f[g]?0:Math.min(f[g],n));!a&&1<b.axis.length&&(h===f[g]?f={}:u&&(k(b.onAfterFirst),f={}))});k(b.onAfter)}})};p.max=function(a,d){var b="x"===d?"Width":"Height",h="scroll"+b;if(!n(a))return a[h]-$(a)[b.toLowerCase()]();var b="client"+b,k=a.ownerDocument||a.document,l=k.documentElement,k=k.body;return Math.max(l[h],k[h])-Math.min(l[b],k[b])};$.Tween.propHooks.scrollLeft=$.Tween.propHooks.scrollTop={get:function(a){return $(a.elem)[a.prop]()}, set:function(a){var d=this.get(a);if(a.options.interrupt&&a._last&&a._last!==d)return $(a.elem).stop();var b=Math.round(a.now);d!==b&&($(a.elem)[a.prop](b),a._last=this.get(a))}};return p});
/*! Select2 4.0.4 | https://github.com/select2/select2/blob/master/LICENSE.md */
!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof module&&module.exports?module.exports=function(b,c){return void 0===c&&(c="undefined"!=typeof window?require("jquery"):require("jquery")(b)),a(c),c}:a(jQuery)}(function(a){var b=function(){if(a&&a.fn&&a.fn.select2&&a.fn.select2.amd)var b=a.fn.select2.amd;var b;return function(){if(!b||!b.requirejs){b?c=b:b={};var a,c,d;!function(b){function e(a,b){return v.call(a,b)}function f(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o=b&&b.split("/"),p=t.map,q=p&&p["*"]||{};if(a){for(a=a.split("/"),g=a.length-1,t.nodeIdCompat&&x.test(a[g])&&(a[g]=a[g].replace(x,"")),"."===a[0].charAt(0)&&o&&(n=o.slice(0,o.length-1),a=n.concat(a)),k=0;k<a.length;k++)if("."===(m=a[k]))a.splice(k,1),k-=1;else if(".."===m){if(0===k||1===k&&".."===a[2]||".."===a[k-1])continue;k>0&&(a.splice(k-1,2),k-=2)}a=a.join("/")}if((o||q)&&p){for(c=a.split("/"),k=c.length;k>0;k-=1){if(d=c.slice(0,k).join("/"),o)for(l=o.length;l>0;l-=1)if((e=p[o.slice(0,l).join("/")])&&(e=e[d])){f=e,h=k;break}if(f)break;!i&&q&&q[d]&&(i=q[d],j=k)}!f&&i&&(f=i,h=j),f&&(c.splice(0,h,f),a=c.join("/"))}return a}function g(a,c){return function(){var d=w.call(arguments,0);return"string"!=typeof d[0]&&1===d.length&&d.push(null),o.apply(b,d.concat([a,c]))}}function h(a){return function(b){return f(b,a)}}function i(a){return function(b){r[a]=b}}function j(a){if(e(s,a)){var c=s[a];delete s[a],u[a]=!0,n.apply(b,c)}if(!e(r,a)&&!e(u,a))throw new Error("No "+a);return r[a]}function k(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function l(a){return a?k(a):[]}function m(a){return function(){return t&&t.config&&t.config[a]||{}}}var n,o,p,q,r={},s={},t={},u={},v=Object.prototype.hasOwnProperty,w=[].slice,x=/\.js$/;p=function(a,b){var c,d=k(a),e=d[0],g=b[1];return a=d[1],e&&(e=f(e,g),c=j(e)),e?a=c&&c.normalize?c.normalize(a,h(g)):f(a,g):(a=f(a,g),d=k(a),e=d[0],a=d[1],e&&(c=j(e))),{f:e?e+"!"+a:a,n:a,pr:e,p:c}},q={require:function(a){return g(a)},exports:function(a){var b=r[a];return void 0!==b?b:r[a]={}},module:function(a){return{id:a,uri:"",exports:r[a],config:m(a)}}},n=function(a,c,d,f){var h,k,m,n,o,t,v,w=[],x=typeof d;if(f=f||a,t=l(f),"undefined"===x||"function"===x){for(c=!c.length&&d.length?["require","exports","module"]:c,o=0;o<c.length;o+=1)if(n=p(c[o],t),"require"===(k=n.f))w[o]=q.require(a);else if("exports"===k)w[o]=q.exports(a),v=!0;else if("module"===k)h=w[o]=q.module(a);else if(e(r,k)||e(s,k)||e(u,k))w[o]=j(k);else{if(!n.p)throw new Error(a+" missing "+k);n.p.load(n.n,g(f,!0),i(k),{}),w[o]=r[k]}m=d?d.apply(r[a],w):void 0,a&&(h&&h.exports!==b&&h.exports!==r[a]?r[a]=h.exports:m===b&&v||(r[a]=m))}else a&&(r[a]=d)},a=c=o=function(a,c,d,e,f){if("string"==typeof a)return q[a]?q[a](c):j(p(a,l(c)).f);if(!a.splice){if(t=a,t.deps&&o(t.deps,t.callback),!c)return;c.splice?(a=c,c=d,d=null):a=b}return c=c||function(){},"function"==typeof d&&(d=e,e=f),e?n(b,a,c,d):setTimeout(function(){n(b,a,c,d)},4),o},o.config=function(a){return o(a)},a._defined=r,d=function(a,b,c){if("string"!=typeof a)throw new Error("See almond README: incorrect module build, no module name");b.splice||(c=b,b=[]),e(r,a)||e(s,a)||(s[a]=[a,b,c])},d.amd={jQuery:!0}}(),b.requirejs=a,b.require=c,b.define=d}}(),b.define("almond",function(){}),b.define("jquery",[],function(){var b=a||$;return null==b&&console&&console.error&&console.error("Select2: An instance of jQuery or a jQuery-compatible library was not found. Make sure that you are including jQuery before Select2 on your web page."),b}),b.define("select2/utils",["jquery"],function(a){function b(a){var b=a.prototype,c=[];for(var d in b){"function"==typeof b[d]&&("constructor"!==d&&c.push(d))}return c}var c={};c.Extend=function(a,b){function c(){this.constructor=a}var d={}.hasOwnProperty;for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},c.Decorate=function(a,c){function d(){var b=Array.prototype.unshift,d=c.prototype.constructor.length,e=a.prototype.constructor;d>0&&(b.call(arguments,a.prototype.constructor),e=c.prototype.constructor),e.apply(this,arguments)}function e(){this.constructor=d}var f=b(c),g=b(a);c.displayName=a.displayName,d.prototype=new e;for(var h=0;h<g.length;h++){var i=g[h];d.prototype[i]=a.prototype[i]}for(var j=(function(a){var b=function(){};a in d.prototype&&(b=d.prototype[a]);var e=c.prototype[a];return function(){return Array.prototype.unshift.call(arguments,b),e.apply(this,arguments)}}),k=0;k<f.length;k++){var l=f[k];d.prototype[l]=j(l)}return d};var d=function(){this.listeners={}};return d.prototype.on=function(a,b){this.listeners=this.listeners||{},a in this.listeners?this.listeners[a].push(b):this.listeners[a]=[b]},d.prototype.trigger=function(a){var b=Array.prototype.slice,c=b.call(arguments,1);this.listeners=this.listeners||{},null==c&&(c=[]),0===c.length&&c.push({}),c[0]._type=a,a in this.listeners&&this.invoke(this.listeners[a],b.call(arguments,1)),"*"in this.listeners&&this.invoke(this.listeners["*"],arguments)},d.prototype.invoke=function(a,b){for(var c=0,d=a.length;c<d;c++)a[c].apply(this,b)},c.Observable=d,c.generateChars=function(a){for(var b="",c=0;c<a;c++){b+=Math.floor(36*Math.random()).toString(36)}return b},c.bind=function(a,b){return function(){a.apply(b,arguments)}},c._convertData=function(a){for(var b in a){var c=b.split("-"),d=a;if(1!==c.length){for(var e=0;e<c.length;e++){var f=c[e];f=f.substring(0,1).toLowerCase()+f.substring(1),f in d||(d[f]={}),e==c.length-1&&(d[f]=a[b]),d=d[f]}delete a[b]}}return a},c.hasScroll=function(b,c){var d=a(c),e=c.style.overflowX,f=c.style.overflowY;return(e!==f||"hidden"!==f&&"visible"!==f)&&("scroll"===e||"scroll"===f||(d.innerHeight()<c.scrollHeight||d.innerWidth()<c.scrollWidth))},c.escapeMarkup=function(a){var b={"\\":"&#92;","&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#47;"};return"string"!=typeof a?a:String(a).replace(/[&<>"'\/\\]/g,function(a){return b[a]})},c.appendMany=function(b,c){if("1.7"===a.fn.jquery.substr(0,3)){var d=a();a.map(c,function(a){d=d.add(a)}),c=d}b.append(c)},c}),b.define("select2/results",["jquery","./utils"],function(a,b){function c(a,b,d){this.$element=a,this.data=d,this.options=b,c.__super__.constructor.call(this)}return b.Extend(c,b.Observable),c.prototype.render=function(){var b=a('<ul class="select2-results__options" role="tree"></ul>');return this.options.get("multiple")&&b.attr("aria-multiselectable","true"),this.$results=b,b},c.prototype.clear=function(){this.$results.empty()},c.prototype.displayMessage=function(b){var c=this.options.get("escapeMarkup");this.clear(),this.hideLoading();var d=a('<li role="treeitem" aria-live="assertive" class="select2-results__option"></li>'),e=this.options.get("translations").get(b.message);d.append(c(e(b.args))),d[0].className+=" select2-results__message",this.$results.append(d)},c.prototype.hideMessages=function(){this.$results.find(".select2-results__message").remove()},c.prototype.append=function(a){this.hideLoading();var b=[];if(null==a.results||0===a.results.length)return void(0===this.$results.children().length&&this.trigger("results:message",{message:"noResults"}));a.results=this.sort(a.results);for(var c=0;c<a.results.length;c++){var d=a.results[c],e=this.option(d);b.push(e)}this.$results.append(b)},c.prototype.position=function(a,b){b.find(".select2-results").append(a)},c.prototype.sort=function(a){return this.options.get("sorter")(a)},c.prototype.highlightFirstItem=function(){var a=this.$results.find(".select2-results__option[aria-selected]"),b=a.filter("[aria-selected=true]");b.length>0?b.first().trigger("mouseenter"):a.first().trigger("mouseenter"),this.ensureHighlightVisible()},c.prototype.setClasses=function(){var b=this;this.data.current(function(c){var d=a.map(c,function(a){return a.id.toString()});b.$results.find(".select2-results__option[aria-selected]").each(function(){var b=a(this),c=a.data(this,"data"),e=""+c.id;null!=c.element&&c.element.selected||null==c.element&&a.inArray(e,d)>-1?b.attr("aria-selected","true"):b.attr("aria-selected","false")})})},c.prototype.showLoading=function(a){this.hideLoading();var b=this.options.get("translations").get("searching"),c={disabled:!0,loading:!0,text:b(a)},d=this.option(c);d.className+=" loading-results",this.$results.prepend(d)},c.prototype.hideLoading=function(){this.$results.find(".loading-results").remove()},c.prototype.option=function(b){var c=document.createElement("li");c.className="select2-results__option";var d={role:"treeitem","aria-selected":"false"};b.disabled&&(delete d["aria-selected"],d["aria-disabled"]="true"),null==b.id&&delete d["aria-selected"],null!=b._resultId&&(c.id=b._resultId),b.title&&(c.title=b.title),b.children&&(d.role="group",d["aria-label"]=b.text,delete d["aria-selected"]);for(var e in d){var f=d[e];c.setAttribute(e,f)}if(b.children){var g=a(c),h=document.createElement("strong");h.className="select2-results__group";a(h);this.template(b,h);for(var i=[],j=0;j<b.children.length;j++){var k=b.children[j],l=this.option(k);i.push(l)}var m=a("<ul></ul>",{class:"select2-results__options select2-results__options--nested"});m.append(i),g.append(h),g.append(m)}else this.template(b,c);return a.data(c,"data",b),c},c.prototype.bind=function(b,c){var d=this,e=b.id+"-results";this.$results.attr("id",e),b.on("results:all",function(a){d.clear(),d.append(a.data),b.isOpen()&&(d.setClasses(),d.highlightFirstItem())}),b.on("results:append",function(a){d.append(a.data),b.isOpen()&&d.setClasses()}),b.on("query",function(a){d.hideMessages(),d.showLoading(a)}),b.on("select",function(){b.isOpen()&&(d.setClasses(),d.highlightFirstItem())}),b.on("unselect",function(){b.isOpen()&&(d.setClasses(),d.highlightFirstItem())}),b.on("open",function(){d.$results.attr("aria-expanded","true"),d.$results.attr("aria-hidden","false"),d.setClasses(),d.ensureHighlightVisible()}),b.on("close",function(){d.$results.attr("aria-expanded","false"),d.$results.attr("aria-hidden","true"),d.$results.removeAttr("aria-activedescendant")}),b.on("results:toggle",function(){var a=d.getHighlightedResults();0!==a.length&&a.trigger("mouseup")}),b.on("results:select",function(){var a=d.getHighlightedResults();if(0!==a.length){var b=a.data("data");"true"==a.attr("aria-selected")?d.trigger("close",{}):d.trigger("select",{data:b})}}),b.on("results:previous",function(){var a=d.getHighlightedResults(),b=d.$results.find("[aria-selected]"),c=b.index(a);if(0!==c){var e=c-1;0===a.length&&(e=0);var f=b.eq(e);f.trigger("mouseenter");var g=d.$results.offset().top,h=f.offset().top,i=d.$results.scrollTop()+(h-g);0===e?d.$results.scrollTop(0):h-g<0&&d.$results.scrollTop(i)}}),b.on("results:next",function(){var a=d.getHighlightedResults(),b=d.$results.find("[aria-selected]"),c=b.index(a),e=c+1;if(!(e>=b.length)){var f=b.eq(e);f.trigger("mouseenter");var g=d.$results.offset().top+d.$results.outerHeight(!1),h=f.offset().top+f.outerHeight(!1),i=d.$results.scrollTop()+h-g;0===e?d.$results.scrollTop(0):h>g&&d.$results.scrollTop(i)}}),b.on("results:focus",function(a){a.element.addClass("select2-results__option--highlighted")}),b.on("results:message",function(a){d.displayMessage(a)}),a.fn.mousewheel&&this.$results.on("mousewheel",function(a){var b=d.$results.scrollTop(),c=d.$results.get(0).scrollHeight-b+a.deltaY,e=a.deltaY>0&&b-a.deltaY<=0,f=a.deltaY<0&&c<=d.$results.height();e?(d.$results.scrollTop(0),a.preventDefault(),a.stopPropagation()):f&&(d.$results.scrollTop(d.$results.get(0).scrollHeight-d.$results.height()),a.preventDefault(),a.stopPropagation())}),this.$results.on("mouseup",".select2-results__option[aria-selected]",function(b){var c=a(this),e=c.data("data");if("true"===c.attr("aria-selected"))return void(d.options.get("multiple")?d.trigger("unselect",{originalEvent:b,data:e}):d.trigger("close",{}));d.trigger("select",{originalEvent:b,data:e})}),this.$results.on("mouseenter",".select2-results__option[aria-selected]",function(b){var c=a(this).data("data");d.getHighlightedResults().removeClass("select2-results__option--highlighted"),d.trigger("results:focus",{data:c,element:a(this)})})},c.prototype.getHighlightedResults=function(){return this.$results.find(".select2-results__option--highlighted")},c.prototype.destroy=function(){this.$results.remove()},c.prototype.ensureHighlightVisible=function(){var a=this.getHighlightedResults();if(0!==a.length){var b=this.$results.find("[aria-selected]"),c=b.index(a),d=this.$results.offset().top,e=a.offset().top,f=this.$results.scrollTop()+(e-d),g=e-d;f-=2*a.outerHeight(!1),c<=2?this.$results.scrollTop(0):(g>this.$results.outerHeight()||g<0)&&this.$results.scrollTop(f)}},c.prototype.template=function(b,c){var d=this.options.get("templateResult"),e=this.options.get("escapeMarkup"),f=d(b,c);null==f?c.style.display="none":"string"==typeof f?c.innerHTML=e(f):a(c).append(f)},c}),b.define("select2/keys",[],function(){return{BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46}}),b.define("select2/selection/base",["jquery","../utils","../keys"],function(a,b,c){function d(a,b){this.$element=a,this.options=b,d.__super__.constructor.call(this)}return b.Extend(d,b.Observable),d.prototype.render=function(){var b=a('<span class="select2-selection" role="combobox"  aria-haspopup="true" aria-expanded="false"></span>');return this._tabindex=0,null!=this.$element.data("old-tabindex")?this._tabindex=this.$element.data("old-tabindex"):null!=this.$element.attr("tabindex")&&(this._tabindex=this.$element.attr("tabindex")),b.attr("title",this.$element.attr("title")),b.attr("tabindex",this._tabindex),this.$selection=b,b},d.prototype.bind=function(a,b){var d=this,e=(a.id,a.id+"-results");this.container=a,this.$selection.on("focus",function(a){d.trigger("focus",a)}),this.$selection.on("blur",function(a){d._handleBlur(a)}),this.$selection.on("keydown",function(a){d.trigger("keypress",a),a.which===c.SPACE&&a.preventDefault()}),a.on("results:focus",function(a){d.$selection.attr("aria-activedescendant",a.data._resultId)}),a.on("selection:update",function(a){d.update(a.data)}),a.on("open",function(){d.$selection.attr("aria-expanded","true"),d.$selection.attr("aria-owns",e),d._attachCloseHandler(a)}),a.on("close",function(){d.$selection.attr("aria-expanded","false"),d.$selection.removeAttr("aria-activedescendant"),d.$selection.removeAttr("aria-owns"),d.$selection.focus(),d._detachCloseHandler(a)}),a.on("enable",function(){d.$selection.attr("tabindex",d._tabindex)}),a.on("disable",function(){d.$selection.attr("tabindex","-1")})},d.prototype._handleBlur=function(b){var c=this;window.setTimeout(function(){document.activeElement==c.$selection[0]||a.contains(c.$selection[0],document.activeElement)||c.trigger("blur",b)},1)},d.prototype._attachCloseHandler=function(b){a(document.body).on("mousedown.select2."+b.id,function(b){var c=a(b.target),d=c.closest(".select2");a(".select2.select2-container--open").each(function(){var b=a(this);this!=d[0]&&b.data("element").select2("close")})})},d.prototype._detachCloseHandler=function(b){a(document.body).off("mousedown.select2."+b.id)},d.prototype.position=function(a,b){b.find(".selection").append(a)},d.prototype.destroy=function(){this._detachCloseHandler(this.container)},d.prototype.update=function(a){throw new Error("The `update` method must be defined in child classes.")},d}),b.define("select2/selection/single",["jquery","./base","../utils","../keys"],function(a,b,c,d){function e(){e.__super__.constructor.apply(this,arguments)}return c.Extend(e,b),e.prototype.render=function(){var a=e.__super__.render.call(this);return a.addClass("select2-selection--single"),a.html('<span class="select2-selection__rendered"></span><span class="select2-selection__arrow" role="presentation"><b role="presentation"></b></span>'),a},e.prototype.bind=function(a,b){var c=this;e.__super__.bind.apply(this,arguments);var d=a.id+"-container";this.$selection.find(".select2-selection__rendered").attr("id",d),this.$selection.attr("aria-labelledby",d),this.$selection.on("mousedown",function(a){1===a.which&&c.trigger("toggle",{originalEvent:a})}),this.$selection.on("focus",function(a){}),this.$selection.on("blur",function(a){}),a.on("focus",function(b){a.isOpen()||c.$selection.focus()}),a.on("selection:update",function(a){c.update(a.data)})},e.prototype.clear=function(){this.$selection.find(".select2-selection__rendered").empty()},e.prototype.display=function(a,b){var c=this.options.get("templateSelection");return this.options.get("escapeMarkup")(c(a,b))},e.prototype.selectionContainer=function(){return a("<span></span>")},e.prototype.update=function(a){if(0===a.length)return void this.clear();var b=a[0],c=this.$selection.find(".select2-selection__rendered"),d=this.display(b,c);c.empty().append(d),c.prop("title",b.title||b.text)},e}),b.define("select2/selection/multiple",["jquery","./base","../utils"],function(a,b,c){function d(a,b){d.__super__.constructor.apply(this,arguments)}return c.Extend(d,b),d.prototype.render=function(){var a=d.__super__.render.call(this);return a.addClass("select2-selection--multiple"),a.html('<ul class="select2-selection__rendered"></ul>'),a},d.prototype.bind=function(b,c){var e=this;d.__super__.bind.apply(this,arguments),this.$selection.on("click",function(a){e.trigger("toggle",{originalEvent:a})}),this.$selection.on("click",".select2-selection__choice__remove",function(b){if(!e.options.get("disabled")){var c=a(this),d=c.parent(),f=d.data("data");e.trigger("unselect",{originalEvent:b,data:f})}})},d.prototype.clear=function(){this.$selection.find(".select2-selection__rendered").empty()},d.prototype.display=function(a,b){var c=this.options.get("templateSelection");return this.options.get("escapeMarkup")(c(a,b))},d.prototype.selectionContainer=function(){return a('<li class="select2-selection__choice"><span class="select2-selection__choice__remove" role="presentation">&times;</span></li>')},d.prototype.update=function(a){if(this.clear(),0!==a.length){for(var b=[],d=0;d<a.length;d++){var e=a[d],f=this.selectionContainer(),g=this.display(e,f);f.append(g),f.prop("title",e.title||e.text),f.data("data",e),b.push(f)}var h=this.$selection.find(".select2-selection__rendered");c.appendMany(h,b)}},d}),b.define("select2/selection/placeholder",["../utils"],function(a){function b(a,b,c){this.placeholder=this.normalizePlaceholder(c.get("placeholder")),a.call(this,b,c)}return b.prototype.normalizePlaceholder=function(a,b){return"string"==typeof b&&(b={id:"",text:b}),b},b.prototype.createPlaceholder=function(a,b){var c=this.selectionContainer();return c.html(this.display(b)),c.addClass("select2-selection__placeholder").removeClass("select2-selection__choice"),c},b.prototype.update=function(a,b){var c=1==b.length&&b[0].id!=this.placeholder.id;if(b.length>1||c)return a.call(this,b);this.clear();var d=this.createPlaceholder(this.placeholder);this.$selection.find(".select2-selection__rendered").append(d)},b}),b.define("select2/selection/allowClear",["jquery","../keys"],function(a,b){function c(){}return c.prototype.bind=function(a,b,c){var d=this;a.call(this,b,c),null==this.placeholder&&this.options.get("debug")&&window.console&&console.error&&console.error("Select2: The `allowClear` option should be used in combination with the `placeholder` option."),this.$selection.on("mousedown",".select2-selection__clear",function(a){d._handleClear(a)}),b.on("keypress",function(a){d._handleKeyboardClear(a,b)})},c.prototype._handleClear=function(a,b){if(!this.options.get("disabled")){var c=this.$selection.find(".select2-selection__clear");if(0!==c.length){b.stopPropagation();for(var d=c.data("data"),e=0;e<d.length;e++){var f={data:d[e]};if(this.trigger("unselect",f),f.prevented)return}this.$element.val(this.placeholder.id).trigger("change"),this.trigger("toggle",{})}}},c.prototype._handleKeyboardClear=function(a,c,d){d.isOpen()||c.which!=b.DELETE&&c.which!=b.BACKSPACE||this._handleClear(c)},c.prototype.update=function(b,c){if(b.call(this,c),!(this.$selection.find(".select2-selection__placeholder").length>0||0===c.length)){var d=a('<span class="select2-selection__clear">&times;</span>');d.data("data",c),this.$selection.find(".select2-selection__rendered").prepend(d)}},c}),b.define("select2/selection/search",["jquery","../utils","../keys"],function(a,b,c){function d(a,b,c){a.call(this,b,c)}return d.prototype.render=function(b){var c=a('<li class="select2-search select2-search--inline"><input class="select2-search__field" type="search" tabindex="-1" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" role="textbox" aria-autocomplete="list" /></li>');this.$searchContainer=c,this.$search=c.find("input");var d=b.call(this);return this._transferTabIndex(),d},d.prototype.bind=function(a,b,d){var e=this;a.call(this,b,d),b.on("open",function(){e.$search.trigger("focus")}),b.on("close",function(){e.$search.val(""),e.$search.removeAttr("aria-activedescendant"),e.$search.trigger("focus")}),b.on("enable",function(){e.$search.prop("disabled",!1),e._transferTabIndex()}),b.on("disable",function(){e.$search.prop("disabled",!0)}),b.on("focus",function(a){e.$search.trigger("focus")}),b.on("results:focus",function(a){e.$search.attr("aria-activedescendant",a.id)}),this.$selection.on("focusin",".select2-search--inline",function(a){e.trigger("focus",a)}),this.$selection.on("focusout",".select2-search--inline",function(a){e._handleBlur(a)}),this.$selection.on("keydown",".select2-search--inline",function(a){if(a.stopPropagation(),e.trigger("keypress",a),e._keyUpPrevented=a.isDefaultPrevented(),a.which===c.BACKSPACE&&""===e.$search.val()){var b=e.$searchContainer.prev(".select2-selection__choice");if(b.length>0){var d=b.data("data");e.searchRemoveChoice(d),a.preventDefault()}}});var f=document.documentMode,g=f&&f<=11;this.$selection.on("input.searchcheck",".select2-search--inline",function(a){if(g)return void e.$selection.off("input.search input.searchcheck");e.$selection.off("keyup.search")}),this.$selection.on("keyup.search input.search",".select2-search--inline",function(a){if(g&&"input"===a.type)return void e.$selection.off("input.search input.searchcheck");var b=a.which;b!=c.SHIFT&&b!=c.CTRL&&b!=c.ALT&&b!=c.TAB&&e.handleSearch(a)})},d.prototype._transferTabIndex=function(a){this.$search.attr("tabindex",this.$selection.attr("tabindex")),this.$selection.attr("tabindex","-1")},d.prototype.createPlaceholder=function(a,b){this.$search.attr("placeholder",b.text)},d.prototype.update=function(a,b){var c=this.$search[0]==document.activeElement;this.$search.attr("placeholder",""),a.call(this,b),this.$selection.find(".select2-selection__rendered").append(this.$searchContainer),this.resizeSearch(),c&&this.$search.focus()},d.prototype.handleSearch=function(){if(this.resizeSearch(),!this._keyUpPrevented){var a=this.$search.val();this.trigger("query",{term:a})}this._keyUpPrevented=!1},d.prototype.searchRemoveChoice=function(a,b){this.trigger("unselect",{data:b}),this.$search.val(b.text),this.handleSearch()},d.prototype.resizeSearch=function(){this.$search.css("width","25px");var a="";if(""!==this.$search.attr("placeholder"))a=this.$selection.find(".select2-selection__rendered").innerWidth();else{a=.75*(this.$search.val().length+1)+"em"}this.$search.css("width",a)},d}),b.define("select2/selection/eventRelay",["jquery"],function(a){function b(){}return b.prototype.bind=function(b,c,d){var e=this,f=["open","opening","close","closing","select","selecting","unselect","unselecting"],g=["opening","closing","selecting","unselecting"];b.call(this,c,d),c.on("*",function(b,c){if(-1!==a.inArray(b,f)){c=c||{};var d=a.Event("select2:"+b,{params:c});e.$element.trigger(d),-1!==a.inArray(b,g)&&(c.prevented=d.isDefaultPrevented())}})},b}),b.define("select2/translation",["jquery","require"],function(a,b){function c(a){this.dict=a||{}}return c.prototype.all=function(){return this.dict},c.prototype.get=function(a){return this.dict[a]},c.prototype.extend=function(b){this.dict=a.extend({},b.all(),this.dict)},c._cache={},c.loadPath=function(a){if(!(a in c._cache)){var d=b(a);c._cache[a]=d}return new c(c._cache[a])},c}),b.define("select2/diacritics",[],function(){return{"":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"AA","":"AE","":"AE","":"AE","":"AO","":"AU","":"AV","":"AV","":"AY","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"DZ","":"DZ","":"Dz","":"Dz","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"F","":"F","":"F","":"F","":"F","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"J","":"J","":"J","":"J","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"LJ","":"Lj","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"NJ","":"Nj","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"OI","":"OO","":"OU","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"Q","":"Q","":"Q","":"Q","":"Q","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"TZ","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"VY","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"X","":"X","":"X","":"X","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"aa","":"ae","":"ae","":"ae","":"ao","":"au","":"av","":"av","":"ay","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"dz","":"dz","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"f","":"f","":"f","":"f","":"f","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"hv","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"j","":"j","":"j","":"j","":"j","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"lj","":"m","":"m","":"m","":"m","":"m","":"m","":"m","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"nj","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"oi","":"ou","":"oo","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"q","":"q","":"q","":"q","":"q","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"tz","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"vy","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"x","":"x","":"x","":"x","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""}}),b.define("select2/data/base",["../utils"],function(a){function b(a,c){b.__super__.constructor.call(this)}return a.Extend(b,a.Observable),b.prototype.current=function(a){throw new Error("The `current` method must be defined in child classes.")},b.prototype.query=function(a,b){throw new Error("The `query` method must be defined in child classes.")},b.prototype.bind=function(a,b){},b.prototype.destroy=function(){},b.prototype.generateResultId=function(b,c){var d=b.id+"-result-";return d+=a.generateChars(4),null!=c.id?d+="-"+c.id.toString():d+="-"+a.generateChars(4),d},b}),b.define("select2/data/select",["./base","../utils","jquery"],function(a,b,c){function d(a,b){this.$element=a,this.options=b,d.__super__.constructor.call(this)}return b.Extend(d,a),d.prototype.current=function(a){var b=[],d=this;this.$element.find(":selected").each(function(){var a=c(this),e=d.item(a);b.push(e)}),a(b)},d.prototype.select=function(a){var b=this;if(a.selected=!0,c(a.element).is("option"))return a.element.selected=!0,void this.$element.trigger("change");if(this.$element.prop("multiple"))this.current(function(d){var e=[];a=[a],a.push.apply(a,d);for(var f=0;f<a.length;f++){var g=a[f].id;-1===c.inArray(g,e)&&e.push(g)}b.$element.val(e),b.$element.trigger("change")});else{var d=a.id;this.$element.val(d),this.$element.trigger("change")}},d.prototype.unselect=function(a){var b=this;if(this.$element.prop("multiple")){if(a.selected=!1,c(a.element).is("option"))return a.element.selected=!1,void this.$element.trigger("change");this.current(function(d){for(var e=[],f=0;f<d.length;f++){var g=d[f].id;g!==a.id&&-1===c.inArray(g,e)&&e.push(g)}b.$element.val(e),b.$element.trigger("change")})}},d.prototype.bind=function(a,b){var c=this;this.container=a,a.on("select",function(a){c.select(a.data)}),a.on("unselect",function(a){c.unselect(a.data)})},d.prototype.destroy=function(){this.$element.find("*").each(function(){c.removeData(this,"data")})},d.prototype.query=function(a,b){var d=[],e=this;this.$element.children().each(function(){var b=c(this);if(b.is("option")||b.is("optgroup")){var f=e.item(b),g=e.matches(a,f);null!==g&&d.push(g)}}),b({results:d})},d.prototype.addOptions=function(a){b.appendMany(this.$element,a)},d.prototype.option=function(a){var b;a.children?(b=document.createElement("optgroup"),b.label=a.text):(b=document.createElement("option"),void 0!==b.textContent?b.textContent=a.text:b.innerText=a.text),void 0!==a.id&&(b.value=a.id),a.disabled&&(b.disabled=!0),a.selected&&(b.selected=!0),a.title&&(b.title=a.title);var d=c(b),e=this._normalizeItem(a);return e.element=b,c.data(b,"data",e),d},d.prototype.item=function(a){var b={};if(null!=(b=c.data(a[0],"data")))return b;if(a.is("option"))b={id:a.val(),text:a.text(),disabled:a.prop("disabled"),selected:a.prop("selected"),title:a.prop("title")};else if(a.is("optgroup")){b={text:a.prop("label"),children:[],title:a.prop("title")};for(var d=a.children("option"),e=[],f=0;f<d.length;f++){var g=c(d[f]),h=this.item(g);e.push(h)}b.children=e}return b=this._normalizeItem(b),b.element=a[0],c.data(a[0],"data",b),b},d.prototype._normalizeItem=function(a){c.isPlainObject(a)||(a={id:a,text:a}),a=c.extend({},{text:""},a);var b={selected:!1,disabled:!1};return null!=a.id&&(a.id=a.id.toString()),null!=a.text&&(a.text=a.text.toString()),null==a._resultId&&a.id&&null!=this.container&&(a._resultId=this.generateResultId(this.container,a)),c.extend({},b,a)},d.prototype.matches=function(a,b){return this.options.get("matcher")(a,b)},d}),b.define("select2/data/array",["./select","../utils","jquery"],function(a,b,c){function d(a,b){var c=b.get("data")||[];d.__super__.constructor.call(this,a,b),this.addOptions(this.convertToOptions(c))}return b.Extend(d,a),d.prototype.select=function(a){var b=this.$element.find("option").filter(function(b,c){return c.value==a.id.toString()});0===b.length&&(b=this.option(a),this.addOptions(b)),d.__super__.select.call(this,a)},d.prototype.convertToOptions=function(a){function d(a){return function(){return c(this).val()==a.id}}for(var e=this,f=this.$element.find("option"),g=f.map(function(){return e.item(c(this)).id}).get(),h=[],i=0;i<a.length;i++){var j=this._normalizeItem(a[i]);if(c.inArray(j.id,g)>=0){var k=f.filter(d(j)),l=this.item(k),m=c.extend(!0,{},j,l),n=this.option(m);k.replaceWith(n)}else{var o=this.option(j);if(j.children){var p=this.convertToOptions(j.children);b.appendMany(o,p)}h.push(o)}}return h},d}),b.define("select2/data/ajax",["./array","../utils","jquery"],function(a,b,c){function d(a,b){this.ajaxOptions=this._applyDefaults(b.get("ajax")),null!=this.ajaxOptions.processResults&&(this.processResults=this.ajaxOptions.processResults),d.__super__.constructor.call(this,a,b)}return b.Extend(d,a),d.prototype._applyDefaults=function(a){var b={data:function(a){return c.extend({},a,{q:a.term})},transport:function(a,b,d){var e=c.ajax(a);return e.then(b),e.fail(d),e}};return c.extend({},b,a,!0)},d.prototype.processResults=function(a){return a},d.prototype.query=function(a,b){function d(){var d=f.transport(f,function(d){var f=e.processResults(d,a);e.options.get("debug")&&window.console&&console.error&&(f&&f.results&&c.isArray(f.results)||console.error("Select2: The AJAX results did not return an array in the `results` key of the response.")),b(f)},function(){d.status&&"0"===d.status||e.trigger("results:message",{message:"errorLoading"})});e._request=d}var e=this;null!=this._request&&(c.isFunction(this._request.abort)&&this._request.abort(),this._request=null);var f=c.extend({type:"GET"},this.ajaxOptions);"function"==typeof f.url&&(f.url=f.url.call(this.$element,a)),"function"==typeof f.data&&(f.data=f.data.call(this.$element,a)),this.ajaxOptions.delay&&null!=a.term?(this._queryTimeout&&window.clearTimeout(this._queryTimeout),this._queryTimeout=window.setTimeout(d,this.ajaxOptions.delay)):d()},d}),b.define("select2/data/tags",["jquery"],function(a){function b(b,c,d){var e=d.get("tags"),f=d.get("createTag");void 0!==f&&(this.createTag=f);var g=d.get("insertTag");if(void 0!==g&&(this.insertTag=g),b.call(this,c,d),a.isArray(e))for(var h=0;h<e.length;h++){var i=e[h],j=this._normalizeItem(i),k=this.option(j);this.$element.append(k)}}return b.prototype.query=function(a,b,c){function d(a,f){for(var g=a.results,h=0;h<g.length;h++){var i=g[h],j=null!=i.children&&!d({results:i.children},!0);if((i.text||"").toUpperCase()===(b.term||"").toUpperCase()||j)return!f&&(a.data=g,void c(a))}if(f)return!0;var k=e.createTag(b);if(null!=k){var l=e.option(k);l.attr("data-select2-tag",!0),e.addOptions([l]),e.insertTag(g,k)}a.results=g,c(a)}var e=this;if(this._removeOldTags(),null==b.term||null!=b.page)return void a.call(this,b,c);a.call(this,b,d)},b.prototype.createTag=function(b,c){var d=a.trim(c.term);return""===d?null:{id:d,text:d}},b.prototype.insertTag=function(a,b,c){b.unshift(c)},b.prototype._removeOldTags=function(b){this._lastTag;this.$element.find("option[data-select2-tag]").each(function(){this.selected||a(this).remove()})},b}),b.define("select2/data/tokenizer",["jquery"],function(a){function b(a,b,c){var d=c.get("tokenizer");void 0!==d&&(this.tokenizer=d),a.call(this,b,c)}return b.prototype.bind=function(a,b,c){a.call(this,b,c),this.$search=b.dropdown.$search||b.selection.$search||c.find(".select2-search__field")},b.prototype.query=function(b,c,d){function e(b){var c=g._normalizeItem(b);if(!g.$element.find("option").filter(function(){return a(this).val()===c.id}).length){var d=g.option(c);d.attr("data-select2-tag",!0),g._removeOldTags(),g.addOptions([d])}f(c)}function f(a){g.trigger("select",{data:a})}var g=this;c.term=c.term||"";var h=this.tokenizer(c,this.options,e);h.term!==c.term&&(this.$search.length&&(this.$search.val(h.term),this.$search.focus()),c.term=h.term),b.call(this,c,d)},b.prototype.tokenizer=function(b,c,d,e){for(var f=d.get("tokenSeparators")||[],g=c.term,h=0,i=this.createTag||function(a){return{id:a.term,text:a.term}};h<g.length;){var j=g[h];if(-1!==a.inArray(j,f)){var k=g.substr(0,h),l=a.extend({},c,{term:k}),m=i(l);null!=m?(e(m),g=g.substr(h+1)||"",h=0):h++}else h++}return{term:g}},b}),b.define("select2/data/minimumInputLength",[],function(){function a(a,b,c){this.minimumInputLength=c.get("minimumInputLength"),a.call(this,b,c)}return a.prototype.query=function(a,b,c){if(b.term=b.term||"",b.term.length<this.minimumInputLength)return void this.trigger("results:message",{message:"inputTooShort",args:{minimum:this.minimumInputLength,input:b.term,params:b}});a.call(this,b,c)},a}),b.define("select2/data/maximumInputLength",[],function(){function a(a,b,c){this.maximumInputLength=c.get("maximumInputLength"),a.call(this,b,c)}return a.prototype.query=function(a,b,c){if(b.term=b.term||"",this.maximumInputLength>0&&b.term.length>this.maximumInputLength)return void this.trigger("results:message",{message:"inputTooLong",args:{maximum:this.maximumInputLength,input:b.term,params:b}});a.call(this,b,c)},a}),b.define("select2/data/maximumSelectionLength",[],function(){function a(a,b,c){this.maximumSelectionLength=c.get("maximumSelectionLength"),a.call(this,b,c)}return a.prototype.query=function(a,b,c){var d=this;this.current(function(e){var f=null!=e?e.length:0;if(d.maximumSelectionLength>0&&f>=d.maximumSelectionLength)return void d.trigger("results:message",{message:"maximumSelected",args:{maximum:d.maximumSelectionLength}});a.call(d,b,c)})},a}),b.define("select2/dropdown",["jquery","./utils"],function(a,b){function c(a,b){this.$element=a,this.options=b,c.__super__.constructor.call(this)}return b.Extend(c,b.Observable),c.prototype.render=function(){var b=a('<span class="select2-dropdown"><span class="select2-results"></span></span>');return b.attr("dir",this.options.get("dir")),this.$dropdown=b,b},c.prototype.bind=function(){},c.prototype.position=function(a,b){},c.prototype.destroy=function(){this.$dropdown.remove()},c}),b.define("select2/dropdown/search",["jquery","../utils"],function(a,b){function c(){}return c.prototype.render=function(b){var c=b.call(this),d=a('<span class="select2-search select2-search--dropdown"><input class="select2-search__field" type="search" tabindex="-1" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" role="textbox" /></span>');return this.$searchContainer=d,this.$search=d.find("input"),c.prepend(d),c},c.prototype.bind=function(b,c,d){var e=this;b.call(this,c,d),this.$search.on("keydown",function(a){e.trigger("keypress",a),e._keyUpPrevented=a.isDefaultPrevented()}),this.$search.on("input",function(b){a(this).off("keyup")}),this.$search.on("keyup input",function(a){e.handleSearch(a)}),c.on("open",function(){e.$search.attr("tabindex",0),e.$search.focus(),window.setTimeout(function(){e.$search.focus()},0)}),c.on("close",function(){e.$search.attr("tabindex",-1),e.$search.val("")}),c.on("focus",function(){c.isOpen()||e.$search.focus()}),c.on("results:all",function(a){if(null==a.query.term||""===a.query.term){e.showSearch(a)?e.$searchContainer.removeClass("select2-search--hide"):e.$searchContainer.addClass("select2-search--hide")}})},c.prototype.handleSearch=function(a){if(!this._keyUpPrevented){var b=this.$search.val();this.trigger("query",{term:b})}this._keyUpPrevented=!1},c.prototype.showSearch=function(a,b){return!0},c}),b.define("select2/dropdown/hidePlaceholder",[],function(){function a(a,b,c,d){this.placeholder=this.normalizePlaceholder(c.get("placeholder")),a.call(this,b,c,d)}return a.prototype.append=function(a,b){b.results=this.removePlaceholder(b.results),a.call(this,b)},a.prototype.normalizePlaceholder=function(a,b){return"string"==typeof b&&(b={id:"",text:b}),b},a.prototype.removePlaceholder=function(a,b){for(var c=b.slice(0),d=b.length-1;d>=0;d--){var e=b[d];this.placeholder.id===e.id&&c.splice(d,1)}return c},a}),b.define("select2/dropdown/infiniteScroll",["jquery"],function(a){function b(a,b,c,d){this.lastParams={},a.call(this,b,c,d),this.$loadingMore=this.createLoadingMore(),this.loading=!1}return b.prototype.append=function(a,b){this.$loadingMore.remove(),this.loading=!1,a.call(this,b),this.showLoadingMore(b)&&this.$results.append(this.$loadingMore)},b.prototype.bind=function(b,c,d){var e=this;b.call(this,c,d),c.on("query",function(a){e.lastParams=a,e.loading=!0}),c.on("query:append",function(a){e.lastParams=a,e.loading=!0}),this.$results.on("scroll",function(){var b=a.contains(document.documentElement,e.$loadingMore[0]);if(!e.loading&&b){e.$results.offset().top+e.$results.outerHeight(!1)+50>=e.$loadingMore.offset().top+e.$loadingMore.outerHeight(!1)&&e.loadMore()}})},b.prototype.loadMore=function(){this.loading=!0;var b=a.extend({},{page:1},this.lastParams);b.page++,this.trigger("query:append",b)},b.prototype.showLoadingMore=function(a,b){return b.pagination&&b.pagination.more},b.prototype.createLoadingMore=function(){var b=a('<li class="select2-results__option select2-results__option--load-more"role="treeitem" aria-disabled="true"></li>'),c=this.options.get("translations").get("loadingMore");return b.html(c(this.lastParams)),b},b}),b.define("select2/dropdown/attachBody",["jquery","../utils"],function(a,b){function c(b,c,d){this.$dropdownParent=d.get("dropdownParent")||a(document.body),b.call(this,c,d)}return c.prototype.bind=function(a,b,c){var d=this,e=!1;a.call(this,b,c),b.on("open",function(){d._showDropdown(),d._attachPositioningHandler(b),e||(e=!0,b.on("results:all",function(){d._positionDropdown(),d._resizeDropdown()}),b.on("results:append",function(){d._positionDropdown(),d._resizeDropdown()}))}),b.on("close",function(){d._hideDropdown(),d._detachPositioningHandler(b)}),this.$dropdownContainer.on("mousedown",function(a){a.stopPropagation()})},c.prototype.destroy=function(a){a.call(this),this.$dropdownContainer.remove()},c.prototype.position=function(a,b,c){b.attr("class",c.attr("class")),b.removeClass("select2"),b.addClass("select2-container--open"),b.css({position:"absolute",top:-999999}),this.$container=c},c.prototype.render=function(b){var c=a("<span></span>"),d=b.call(this);return c.append(d),this.$dropdownContainer=c,c},c.prototype._hideDropdown=function(a){this.$dropdownContainer.detach()},c.prototype._attachPositioningHandler=function(c,d){var e=this,f="scroll.select2."+d.id,g="resize.select2."+d.id,h="orientationchange.select2."+d.id,i=this.$container.parents().filter(b.hasScroll);i.each(function(){a(this).data("select2-scroll-position",{x:a(this).scrollLeft(),y:a(this).scrollTop()})}),i.on(f,function(b){var c=a(this).data("select2-scroll-position");a(this).scrollTop(c.y)}),a(window).on(f+" "+g+" "+h,function(a){e._positionDropdown(),e._resizeDropdown()})},c.prototype._detachPositioningHandler=function(c,d){var e="scroll.select2."+d.id,f="resize.select2."+d.id,g="orientationchange.select2."+d.id;this.$container.parents().filter(b.hasScroll).off(e),a(window).off(e+" "+f+" "+g)},c.prototype._positionDropdown=function(){var b=a(window),c=this.$dropdown.hasClass("select2-dropdown--above"),d=this.$dropdown.hasClass("select2-dropdown--below"),e=null,f=this.$container.offset();f.bottom=f.top+this.$container.outerHeight(!1);var g={height:this.$container.outerHeight(!1)};g.top=f.top,g.bottom=f.top+g.height;var h={height:this.$dropdown.outerHeight(!1)},i={top:b.scrollTop(),bottom:b.scrollTop()+b.height()},j=i.top<f.top-h.height,k=i.bottom>f.bottom+h.height,l={left:f.left,top:g.bottom},m=this.$dropdownParent;"static"===m.css("position")&&(m=m.offsetParent());var n=m.offset();l.top-=n.top,l.left-=n.left,c||d||(e="below"),k||!j||c?!j&&k&&c&&(e="below"):e="above",("above"==e||c&&"below"!==e)&&(l.top=g.top-n.top-h.height),null!=e&&(this.$dropdown.removeClass("select2-dropdown--below select2-dropdown--above").addClass("select2-dropdown--"+e),this.$container.removeClass("select2-container--below select2-container--above").addClass("select2-container--"+e)),this.$dropdownContainer.css(l)},c.prototype._resizeDropdown=function(){var a={width:this.$container.outerWidth(!1)+"px"};this.options.get("dropdownAutoWidth")&&(a.minWidth=a.width,a.position="relative",a.width="auto"),this.$dropdown.css(a)},c.prototype._showDropdown=function(a){this.$dropdownContainer.appendTo(this.$dropdownParent),this._positionDropdown(),this._resizeDropdown()},c}),b.define("select2/dropdown/minimumResultsForSearch",[],function(){function a(b){for(var c=0,d=0;d<b.length;d++){var e=b[d];e.children?c+=a(e.children):c++}return c}function b(a,b,c,d){this.minimumResultsForSearch=c.get("minimumResultsForSearch"),this.minimumResultsForSearch<0&&(this.minimumResultsForSearch=1/0),a.call(this,b,c,d)}return b.prototype.showSearch=function(b,c){return!(a(c.data.results)<this.minimumResultsForSearch)&&b.call(this,c)},b}),b.define("select2/dropdown/selectOnClose",[],function(){function a(){}return a.prototype.bind=function(a,b,c){var d=this;a.call(this,b,c),b.on("close",function(a){d._handleSelectOnClose(a)})},a.prototype._handleSelectOnClose=function(a,b){if(b&&null!=b.originalSelect2Event){var c=b.originalSelect2Event;if("select"===c._type||"unselect"===c._type)return}var d=this.getHighlightedResults();if(!(d.length<1)){var e=d.data("data");null!=e.element&&e.element.selected||null==e.element&&e.selected||this.trigger("select",{data:e})}},a}),b.define("select2/dropdown/closeOnSelect",[],function(){function a(){}return a.prototype.bind=function(a,b,c){var d=this;a.call(this,b,c),b.on("select",function(a){d._selectTriggered(a)}),b.on("unselect",function(a){d._selectTriggered(a)})},a.prototype._selectTriggered=function(a,b){var c=b.originalEvent;c&&c.ctrlKey||this.trigger("close",{originalEvent:c,originalSelect2Event:b})},a}),b.define("select2/i18n/en",[],function(){return{errorLoading:function(){return"The results could not be loaded."},inputTooLong:function(a){var b=a.input.length-a.maximum,c="Please delete "+b+" character";return 1!=b&&(c+="s"),c},inputTooShort:function(a){return"Please enter "+(a.minimum-a.input.length)+" or more characters"},loadingMore:function(){return"Loading more results"},maximumSelected:function(a){var b="You can only select "+a.maximum+" item";return 1!=a.maximum&&(b+="s"),b},noResults:function(){return"No results found"},searching:function(){return"Searching"}}}),b.define("select2/defaults",["jquery","require","./results","./selection/single","./selection/multiple","./selection/placeholder","./selection/allowClear","./selection/search","./selection/eventRelay","./utils","./translation","./diacritics","./data/select","./data/array","./data/ajax","./data/tags","./data/tokenizer","./data/minimumInputLength","./data/maximumInputLength","./data/maximumSelectionLength","./dropdown","./dropdown/search","./dropdown/hidePlaceholder","./dropdown/infiniteScroll","./dropdown/attachBody","./dropdown/minimumResultsForSearch","./dropdown/selectOnClose","./dropdown/closeOnSelect","./i18n/en"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C){function D(){this.reset()}return D.prototype.apply=function(l){if(l=a.extend(!0,{},this.defaults,l),null==l.dataAdapter){if(null!=l.ajax?l.dataAdapter=o:null!=l.data?l.dataAdapter=n:l.dataAdapter=m,l.minimumInputLength>0&&(l.dataAdapter=j.Decorate(l.dataAdapter,r)),l.maximumInputLength>0&&(l.dataAdapter=j.Decorate(l.dataAdapter,s)),l.maximumSelectionLength>0&&(l.dataAdapter=j.Decorate(l.dataAdapter,t)),l.tags&&(l.dataAdapter=j.Decorate(l.dataAdapter,p)),null==l.tokenSeparators&&null==l.tokenizer||(l.dataAdapter=j.Decorate(l.dataAdapter,q)),null!=l.query){var C=b(l.amdBase+"compat/query");l.dataAdapter=j.Decorate(l.dataAdapter,C)}if(null!=l.initSelection){var D=b(l.amdBase+"compat/initSelection");l.dataAdapter=j.Decorate(l.dataAdapter,D)}}if(null==l.resultsAdapter&&(l.resultsAdapter=c,null!=l.ajax&&(l.resultsAdapter=j.Decorate(l.resultsAdapter,x)),null!=l.placeholder&&(l.resultsAdapter=j.Decorate(l.resultsAdapter,w)),l.selectOnClose&&(l.resultsAdapter=j.Decorate(l.resultsAdapter,A))),null==l.dropdownAdapter){if(l.multiple)l.dropdownAdapter=u;else{var E=j.Decorate(u,v);l.dropdownAdapter=E}if(0!==l.minimumResultsForSearch&&(l.dropdownAdapter=j.Decorate(l.dropdownAdapter,z)),l.closeOnSelect&&(l.dropdownAdapter=j.Decorate(l.dropdownAdapter,B)),null!=l.dropdownCssClass||null!=l.dropdownCss||null!=l.adaptDropdownCssClass){var F=b(l.amdBase+"compat/dropdownCss");l.dropdownAdapter=j.Decorate(l.dropdownAdapter,F)}l.dropdownAdapter=j.Decorate(l.dropdownAdapter,y)}if(null==l.selectionAdapter){if(l.multiple?l.selectionAdapter=e:l.selectionAdapter=d,null!=l.placeholder&&(l.selectionAdapter=j.Decorate(l.selectionAdapter,f)),l.allowClear&&(l.selectionAdapter=j.Decorate(l.selectionAdapter,g)),l.multiple&&(l.selectionAdapter=j.Decorate(l.selectionAdapter,h)),null!=l.containerCssClass||null!=l.containerCss||null!=l.adaptContainerCssClass){var G=b(l.amdBase+"compat/containerCss");l.selectionAdapter=j.Decorate(l.selectionAdapter,G)}l.selectionAdapter=j.Decorate(l.selectionAdapter,i)}if("string"==typeof l.language)if(l.language.indexOf("-")>0){var H=l.language.split("-"),I=H[0];l.language=[l.language,I]}else l.language=[l.language];if(a.isArray(l.language)){var J=new k;l.language.push("en");for(var K=l.language,L=0;L<K.length;L++){var M=K[L],N={};try{N=k.loadPath(M)}catch(a){try{M=this.defaults.amdLanguageBase+M,N=k.loadPath(M)}catch(a){l.debug&&window.console&&console.warn&&console.warn('Select2: The language file for "'+M+'" could not be automatically loaded. A fallback will be used instead.');continue}}J.extend(N)}l.translations=J}else{var O=k.loadPath(this.defaults.amdLanguageBase+"en"),P=new k(l.language);P.extend(O),l.translations=P}return l},D.prototype.reset=function(){function b(a){function b(a){return l[a]||a}return a.replace(/[^\u0000-\u007E]/g,b)}function c(d,e){if(""===a.trim(d.term))return e;if(e.children&&e.children.length>0){for(var f=a.extend(!0,{},e),g=e.children.length-1;g>=0;g--){null==c(d,e.children[g])&&f.children.splice(g,1)}return f.children.length>0?f:c(d,f)}var h=b(e.text).toUpperCase(),i=b(d.term).toUpperCase();return h.indexOf(i)>-1?e:null}this.defaults={amdBase:"./",amdLanguageBase:"./i18n/",closeOnSelect:!0,debug:!1,dropdownAutoWidth:!1,escapeMarkup:j.escapeMarkup,language:C,matcher:c,minimumInputLength:0,maximumInputLength:0,maximumSelectionLength:0,minimumResultsForSearch:0,selectOnClose:!1,sorter:function(a){return a},templateResult:function(a){return a.text},templateSelection:function(a){return a.text},theme:"default",width:"resolve"}},D.prototype.set=function(b,c){var d=a.camelCase(b),e={};e[d]=c;var f=j._convertData(e);a.extend(this.defaults,f)},new D}),b.define("select2/options",["require","jquery","./defaults","./utils"],function(a,b,c,d){function e(b,e){if(this.options=b,null!=e&&this.fromElement(e),this.options=c.apply(this.options),e&&e.is("input")){var f=a(this.get("amdBase")+"compat/inputData");this.options.dataAdapter=d.Decorate(this.options.dataAdapter,f)}}return e.prototype.fromElement=function(a){var c=["select2"];null==this.options.multiple&&(this.options.multiple=a.prop("multiple")),null==this.options.disabled&&(this.options.disabled=a.prop("disabled")),null==this.options.language&&(a.prop("lang")?this.options.language=a.prop("lang").toLowerCase():a.closest("[lang]").prop("lang")&&(this.options.language=a.closest("[lang]").prop("lang"))),null==this.options.dir&&(a.prop("dir")?this.options.dir=a.prop("dir"):a.closest("[dir]").prop("dir")?this.options.dir=a.closest("[dir]").prop("dir"):this.options.dir="ltr"),a.prop("disabled",this.options.disabled),a.prop("multiple",this.options.multiple),a.data("select2Tags")&&(this.options.debug&&window.console&&console.warn&&console.warn('Select2: The `data-select2-tags` attribute has been changed to use the `data-data` and `data-tags="true"` attributes and will be removed in future versions of Select2.'),a.data("data",a.data("select2Tags")),a.data("tags",!0)),a.data("ajaxUrl")&&(this.options.debug&&window.console&&console.warn&&console.warn("Select2: The `data-ajax-url` attribute has been changed to `data-ajax--url` and support for the old attribute will be removed in future versions of Select2."),a.attr("ajax--url",a.data("ajaxUrl")),a.data("ajax--url",a.data("ajaxUrl")));var e={};e=b.fn.jquery&&"1."==b.fn.jquery.substr(0,2)&&a[0].dataset?b.extend(!0,{},a[0].dataset,a.data()):a.data();var f=b.extend(!0,{},e);f=d._convertData(f);for(var g in f)b.inArray(g,c)>-1||(b.isPlainObject(this.options[g])?b.extend(this.options[g],f[g]):this.options[g]=f[g]);return this},e.prototype.get=function(a){return this.options[a]},e.prototype.set=function(a,b){this.options[a]=b},e}),b.define("select2/core",["jquery","./options","./utils","./keys"],function(a,b,c,d){var e=function(a,c){null!=a.data("select2")&&a.data("select2").destroy(),this.$element=a,this.id=this._generateId(a),c=c||{},this.options=new b(c,a),e.__super__.constructor.call(this);var d=a.attr("tabindex")||0;a.data("old-tabindex",d),a.attr("tabindex","-1");var f=this.options.get("dataAdapter");this.dataAdapter=new f(a,this.options);var g=this.render();this._placeContainer(g);var h=this.options.get("selectionAdapter");this.selection=new h(a,this.options),this.$selection=this.selection.render(),this.selection.position(this.$selection,g);var i=this.options.get("dropdownAdapter");this.dropdown=new i(a,this.options),this.$dropdown=this.dropdown.render(),this.dropdown.position(this.$dropdown,g);var j=this.options.get("resultsAdapter");this.results=new j(a,this.options,this.dataAdapter),this.$results=this.results.render(),this.results.position(this.$results,this.$dropdown);var k=this;this._bindAdapters(),this._registerDomEvents(),this._registerDataEvents(),this._registerSelectionEvents(),this._registerDropdownEvents(),this._registerResultsEvents(),this._registerEvents(),this.dataAdapter.current(function(a){k.trigger("selection:update",{data:a})}),a.addClass("select2-hidden-accessible"),a.attr("aria-hidden","true"),this._syncAttributes(),a.data("select2",this)};return c.Extend(e,c.Observable),e.prototype._generateId=function(a){var b="";return b=null!=a.attr("id")?a.attr("id"):null!=a.attr("name")?a.attr("name")+"-"+c.generateChars(2):c.generateChars(4),b=b.replace(/(:|\.|\[|\]|,)/g,""),b="select2-"+b},e.prototype._placeContainer=function(a){a.insertAfter(this.$element);var b=this._resolveWidth(this.$element,this.options.get("width"));null!=b&&a.css("width",b)},e.prototype._resolveWidth=function(a,b){var c=/^width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/i;if("resolve"==b){var d=this._resolveWidth(a,"style");return null!=d?d:this._resolveWidth(a,"element")}if("element"==b){var e=a.outerWidth(!1);return e<=0?"auto":e+"px"}if("style"==b){var f=a.attr("style");if("string"!=typeof f)return null;for(var g=f.split(";"),h=0,i=g.length;h<i;h+=1){var j=g[h].replace(/\s/g,""),k=j.match(c);if(null!==k&&k.length>=1)return k[1]}return null}return b},e.prototype._bindAdapters=function(){this.dataAdapter.bind(this,this.$container),this.selection.bind(this,this.$container),this.dropdown.bind(this,this.$container),this.results.bind(this,this.$container)},e.prototype._registerDomEvents=function(){var b=this;this.$element.on("change.select2",function(){b.dataAdapter.current(function(a){b.trigger("selection:update",{data:a})})}),this.$element.on("focus.select2",function(a){b.trigger("focus",a)}),this._syncA=c.bind(this._syncAttributes,this),this._syncS=c.bind(this._syncSubtree,this),this.$element[0].attachEvent&&this.$element[0].attachEvent("onpropertychange",this._syncA);var d=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;null!=d?(this._observer=new d(function(c){a.each(c,b._syncA),a.each(c,b._syncS)}),this._observer.observe(this.$element[0],{attributes:!0,childList:!0,subtree:!1})):this.$element[0].addEventListener&&(this.$element[0].addEventListener("DOMAttrModified",b._syncA,!1),this.$element[0].addEventListener("DOMNodeInserted",b._syncS,!1),this.$element[0].addEventListener("DOMNodeRemoved",b._syncS,!1))},e.prototype._registerDataEvents=function(){var a=this;this.dataAdapter.on("*",function(b,c){a.trigger(b,c)})},e.prototype._registerSelectionEvents=function(){var b=this,c=["toggle","focus"];this.selection.on("toggle",function(){b.toggleDropdown()}),this.selection.on("focus",function(a){b.focus(a)}),this.selection.on("*",function(d,e){-1===a.inArray(d,c)&&b.trigger(d,e)})},e.prototype._registerDropdownEvents=function(){var a=this;this.dropdown.on("*",function(b,c){a.trigger(b,c)})},e.prototype._registerResultsEvents=function(){var a=this;this.results.on("*",function(b,c){a.trigger(b,c)})},e.prototype._registerEvents=function(){var a=this;this.on("open",function(){a.$container.addClass("select2-container--open")}),this.on("close",function(){a.$container.removeClass("select2-container--open")}),this.on("enable",function(){a.$container.removeClass("select2-container--disabled")}),this.on("disable",function(){a.$container.addClass("select2-container--disabled")}),this.on("blur",function(){a.$container.removeClass("select2-container--focus")}),this.on("query",function(b){a.isOpen()||a.trigger("open",{}),this.dataAdapter.query(b,function(c){a.trigger("results:all",{data:c,query:b})})}),this.on("query:append",function(b){this.dataAdapter.query(b,function(c){a.trigger("results:append",{data:c,query:b})})}),this.on("keypress",function(b){var c=b.which;a.isOpen()?c===d.ESC||c===d.TAB||c===d.UP&&b.altKey?(a.close(),b.preventDefault()):c===d.ENTER?(a.trigger("results:select",{}),b.preventDefault()):c===d.SPACE&&b.ctrlKey?(a.trigger("results:toggle",{}),b.preventDefault()):c===d.UP?(a.trigger("results:previous",{}),b.preventDefault()):c===d.DOWN&&(a.trigger("results:next",{}),b.preventDefault()):(c===d.ENTER||c===d.SPACE||c===d.DOWN&&b.altKey)&&(a.open(),b.preventDefault())})},e.prototype._syncAttributes=function(){this.options.set("disabled",this.$element.prop("disabled")),this.options.get("disabled")?(this.isOpen()&&this.close(),this.trigger("disable",{})):this.trigger("enable",{})},e.prototype._syncSubtree=function(a,b){var c=!1,d=this;if(!a||!a.target||"OPTION"===a.target.nodeName||"OPTGROUP"===a.target.nodeName){if(b)if(b.addedNodes&&b.addedNodes.length>0)for(var e=0;e<b.addedNodes.length;e++){var f=b.addedNodes[e];f.selected&&(c=!0)}else b.removedNodes&&b.removedNodes.length>0&&(c=!0);else c=!0;c&&this.dataAdapter.current(function(a){d.trigger("selection:update",{data:a})})}},e.prototype.trigger=function(a,b){var c=e.__super__.trigger,d={open:"opening",close:"closing",select:"selecting",unselect:"unselecting"};if(void 0===b&&(b={}),a in d){var f=d[a],g={prevented:!1,name:a,args:b};if(c.call(this,f,g),g.prevented)return void(b.prevented=!0)}c.call(this,a,b)},e.prototype.toggleDropdown=function(){this.options.get("disabled")||(this.isOpen()?this.close():this.open())},e.prototype.open=function(){this.isOpen()||this.trigger("query",{})},e.prototype.close=function(){this.isOpen()&&this.trigger("close",{})},e.prototype.isOpen=function(){return this.$container.hasClass("select2-container--open")},e.prototype.hasFocus=function(){return this.$container.hasClass("select2-container--focus")},e.prototype.focus=function(a){this.hasFocus()||(this.$container.addClass("select2-container--focus"),this.trigger("focus",{}))},e.prototype.enable=function(a){this.options.get("debug")&&window.console&&console.warn&&console.warn('Select2: The `select2("enable")` method has been deprecated and will be removed in later Select2 versions. Use $element.prop("disabled") instead.'),null!=a&&0!==a.length||(a=[!0]);var b=!a[0];this.$element.prop("disabled",b)},e.prototype.data=function(){this.options.get("debug")&&arguments.length>0&&window.console&&console.warn&&console.warn('Select2: Data can no longer be set using `select2("data")`. You should consider setting the value instead using `$element.val()`.');var a=[];return this.dataAdapter.current(function(b){a=b}),a},e.prototype.val=function(b){if(this.options.get("debug")&&window.console&&console.warn&&console.warn('Select2: The `select2("val")` method has been deprecated and will be removed in later Select2 versions. Use $element.val() instead.'),null==b||0===b.length)return this.$element.val();var c=b[0];a.isArray(c)&&(c=a.map(c,function(a){return a.toString()})),this.$element.val(c).trigger("change")},e.prototype.destroy=function(){this.$container.remove(),this.$element[0].detachEvent&&this.$element[0].detachEvent("onpropertychange",this._syncA),null!=this._observer?(this._observer.disconnect(),this._observer=null):this.$element[0].removeEventListener&&(this.$element[0].removeEventListener("DOMAttrModified",this._syncA,!1),this.$element[0].removeEventListener("DOMNodeInserted",this._syncS,!1),this.$element[0].removeEventListener("DOMNodeRemoved",this._syncS,!1)),this._syncA=null,this._syncS=null,this.$element.off(".select2"),this.$element.attr("tabindex",this.$element.data("old-tabindex")),this.$element.removeClass("select2-hidden-accessible"),this.$element.attr("aria-hidden","false"),this.$element.removeData("select2"),this.dataAdapter.destroy(),this.selection.destroy(),this.dropdown.destroy(),this.results.destroy(),this.dataAdapter=null,this.selection=null,this.dropdown=null,this.results=null},e.prototype.render=function(){var b=a('<span class="select2 select2-container"><span class="selection"></span><span class="dropdown-wrapper" aria-hidden="true"></span></span>');return b.attr("dir",this.options.get("dir")),this.$container=b,this.$container.addClass("select2-container--"+this.options.get("theme")),b.data("element",this.$element),b},e}),b.define("select2/compat/utils",["jquery"],function(a){function b(b,c,d){var e,f,g=[];e=a.trim(b.attr("class")),e&&(e=""+e,a(e.split(/\s+/)).each(function(){0===this.indexOf("select2-")&&g.push(this)})),e=a.trim(c.attr("class")),e&&(e=""+e,a(e.split(/\s+/)).each(function(){0!==this.indexOf("select2-")&&null!=(f=d(this))&&g.push(f)})),b.attr("class",g.join(" "))}return{syncCssClasses:b}}),b.define("select2/compat/containerCss",["jquery","./utils"],function(a,b){function c(a){return null}function d(){}return d.prototype.render=function(d){var e=d.call(this),f=this.options.get("containerCssClass")||"";a.isFunction(f)&&(f=f(this.$element));var g=this.options.get("adaptContainerCssClass");if(g=g||c,-1!==f.indexOf(":all:")){f=f.replace(":all:","");var h=g;g=function(a){var b=h(a);return null!=b?b+" "+a:a}}var i=this.options.get("containerCss")||{};return a.isFunction(i)&&(i=i(this.$element)),b.syncCssClasses(e,this.$element,g),e.css(i),e.addClass(f),e},d}),b.define("select2/compat/dropdownCss",["jquery","./utils"],function(a,b){function c(a){return null}function d(){}return d.prototype.render=function(d){var e=d.call(this),f=this.options.get("dropdownCssClass")||"";a.isFunction(f)&&(f=f(this.$element));var g=this.options.get("adaptDropdownCssClass");if(g=g||c,-1!==f.indexOf(":all:")){f=f.replace(":all:","");var h=g;g=function(a){var b=h(a);return null!=b?b+" "+a:a}}var i=this.options.get("dropdownCss")||{};return a.isFunction(i)&&(i=i(this.$element)),b.syncCssClasses(e,this.$element,g),e.css(i),e.addClass(f),e},d}),b.define("select2/compat/initSelection",["jquery"],function(a){function b(a,b,c){c.get("debug")&&window.console&&console.warn&&console.warn("Select2: The `initSelection` option has been deprecated in favor of a custom data adapter that overrides the `current` method. This method is now called multiple times instead of a single time when the instance is initialized. Support will be removed for the `initSelection` option in future versions of Select2"),this.initSelection=c.get("initSelection"),this._isInitialized=!1,a.call(this,b,c)}return b.prototype.current=function(b,c){var d=this;if(this._isInitialized)return void b.call(this,c);this.initSelection.call(null,this.$element,function(b){d._isInitialized=!0,a.isArray(b)||(b=[b]),c(b)})},b}),b.define("select2/compat/inputData",["jquery"],function(a){function b(a,b,c){this._currentData=[],this._valueSeparator=c.get("valueSeparator")||",","hidden"===b.prop("type")&&c.get("debug")&&console&&console.warn&&console.warn("Select2: Using a hidden input with Select2 is no longer supported and may stop working in the future. It is recommended to use a `<select>` element instead."),a.call(this,b,c)}return b.prototype.current=function(b,c){function d(b,c){var e=[];return b.selected||-1!==a.inArray(b.id,c)?(b.selected=!0,e.push(b)):b.selected=!1,b.children&&e.push.apply(e,d(b.children,c)),e}for(var e=[],f=0;f<this._currentData.length;f++){var g=this._currentData[f];e.push.apply(e,d(g,this.$element.val().split(this._valueSeparator)))}c(e)},b.prototype.select=function(b,c){if(this.options.get("multiple")){var d=this.$element.val();d+=this._valueSeparator+c.id,this.$element.val(d),this.$element.trigger("change")}else this.current(function(b){a.map(b,function(a){a.selected=!1})}),this.$element.val(c.id),this.$element.trigger("change")},b.prototype.unselect=function(a,b){var c=this;b.selected=!1,this.current(function(a){for(var d=[],e=0;e<a.length;e++){var f=a[e];b.id!=f.id&&d.push(f.id)}c.$element.val(d.join(c._valueSeparator)),c.$element.trigger("change")})},b.prototype.query=function(a,b,c){for(var d=[],e=0;e<this._currentData.length;e++){var f=this._currentData[e],g=this.matches(b,f);null!==g&&d.push(g)}c({results:d})},b.prototype.addOptions=function(b,c){var d=a.map(c,function(b){return a.data(b[0],"data")});this._currentData.push.apply(this._currentData,d)},b}),b.define("select2/compat/matcher",["jquery"],function(a){function b(b){function c(c,d){var e=a.extend(!0,{},d);if(null==c.term||""===a.trim(c.term))return e;if(d.children){for(var f=d.children.length-1;f>=0;f--){var g=d.children[f];b(c.term,g.text,g)||e.children.splice(f,1)}if(e.children.length>0)return e}return b(c.term,d.text,d)?e:null}return c}return b}),b.define("select2/compat/query",[],function(){function a(a,b,c){c.get("debug")&&window.console&&console.warn&&console.warn("Select2: The `query` option has been deprecated in favor of a custom data adapter that overrides the `query` method. Support will be removed for the `query` option in future versions of Select2."),a.call(this,b,c)}return a.prototype.query=function(a,b,c){b.callback=c,this.options.get("query").call(null,b)},a}),b.define("select2/dropdown/attachContainer",[],function(){function a(a,b,c){a.call(this,b,c)}return a.prototype.position=function(a,b,c){c.find(".dropdown-wrapper").append(b),b.addClass("select2-dropdown--below"),c.addClass("select2-container--below")},a}),b.define("select2/dropdown/stopPropagation",[],function(){function a(){}return a.prototype.bind=function(a,b,c){a.call(this,b,c);var d=["blur","change","click","dblclick","focus","focusin","focusout","input","keydown","keyup","keypress","mousedown","mouseenter","mouseleave","mousemove","mouseover","mouseup","search","touchend","touchstart"];this.$dropdown.on(d.join(" "),function(a){a.stopPropagation()})},a}),b.define("select2/selection/stopPropagation",[],function(){function a(){}return a.prototype.bind=function(a,b,c){a.call(this,b,c);var d=["blur","change","click","dblclick","focus","focusin","focusout","input","keydown","keyup","keypress","mousedown","mouseenter","mouseleave","mousemove","mouseover","mouseup","search","touchend","touchstart"];this.$selection.on(d.join(" "),function(a){a.stopPropagation()})},a}),function(c){"function"==typeof b.define&&b.define.amd?b.define("jquery-mousewheel",["jquery"],c):"object"==typeof exports?module.exports=c:c(a)}(function(a){function b(b){var g=b||window.event,h=i.call(arguments,1),j=0,l=0,m=0,n=0,o=0,p=0;if(b=a.event.fix(g),b.type="mousewheel","detail"in g&&(m=-1*g.detail),"wheelDelta"in g&&(m=g.wheelDelta),"wheelDeltaY"in g&&(m=g.wheelDeltaY),"wheelDeltaX"in g&&(l=-1*g.wheelDeltaX),"axis"in g&&g.axis===g.HORIZONTAL_AXIS&&(l=-1*m,m=0),j=0===m?l:m,"deltaY"in g&&(m=-1*g.deltaY,j=m),"deltaX"in g&&(l=g.deltaX,0===m&&(j=-1*l)),0!==m||0!==l){if(1===g.deltaMode){var q=a.data(this,"mousewheel-line-height");j*=q,m*=q,l*=q}else if(2===g.deltaMode){var r=a.data(this,"mousewheel-page-height");j*=r,m*=r,l*=r}if(n=Math.max(Math.abs(m),Math.abs(l)),(!f||n<f)&&(f=n,d(g,n)&&(f/=40)),d(g,n)&&(j/=40,l/=40,m/=40),j=Math[j>=1?"floor":"ceil"](j/f),l=Math[l>=1?"floor":"ceil"](l/f),m=Math[m>=1?"floor":"ceil"](m/f),k.settings.normalizeOffset&&this.getBoundingClientRect){var s=this.getBoundingClientRect();o=b.clientX-s.left,p=b.clientY-s.top}return b.deltaX=l,b.deltaY=m,b.deltaFactor=f,b.offsetX=o,b.offsetY=p,b.deltaMode=0,h.unshift(b,j,l,m),e&&clearTimeout(e),e=setTimeout(c,200),(a.event.dispatch||a.event.handle).apply(this,h)}}function c(){f=null}function d(a,b){return k.settings.adjustOldDeltas&&"mousewheel"===a.type&&b%120==0}var e,f,g=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],h="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],i=Array.prototype.slice;if(a.event.fixHooks)for(var j=g.length;j;)a.event.fixHooks[g[--j]]=a.event.mouseHooks;var k=a.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var c=h.length;c;)this.addEventListener(h[--c],b,!1);else this.onmousewheel=b;a.data(this,"mousewheel-line-height",k.getLineHeight(this)),a.data(this,"mousewheel-page-height",k.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var c=h.length;c;)this.removeEventListener(h[--c],b,!1);else this.onmousewheel=null;a.removeData(this,"mousewheel-line-height"),a.removeData(this,"mousewheel-page-height")},getLineHeight:function(b){var c=a(b),d=c["offsetParent"in a.fn?"offsetParent":"parent"]();return d.length||(d=a("body")),parseInt(d.css("fontSize"),10)||parseInt(c.css("fontSize"),10)||16},getPageHeight:function(b){return a(b).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})}),b.define("jquery.select2",["jquery","jquery-mousewheel","./select2/core","./select2/defaults"],function(a,b,c,d){if(null==a.fn.select2){var e=["open","close","destroy"];a.fn.select2=function(b){if("object"==typeof(b=b||{}))return this.each(function(){var d=a.extend(!0,{},b);new c(a(this),d)}),this;if("string"==typeof b){var d,f=Array.prototype.slice.call(arguments,1);return this.each(function(){var c=a(this).data("select2");null==c&&window.console&&console.error&&console.error("The select2('"+b+"') method was called on an element that is not using Select2."),d=c[b].apply(c,f)}),a.inArray(b,e)>-1?this:d}throw new Error("Invalid arguments for Select2: "+b)}}return null==a.fn.select2.defaults&&(a.fn.select2.defaults=d),c}),{define:b.define,require:b.require}}(),c=b.require("jquery.select2");return a.fn.select2.amd=b,c});
(function (w, SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Widgets.Badges'),
    saUser = SA.Data.User;

  // Private methods

  function getBadges(data) {
    $.get('/badges', data).done(function (res) {
      workWithResponse(res);
      clientBasedUpdates();
    });
  }

  function workWithResponse(res) {
    $.each(res, function (userId, data) {
      var html = '';
      $.each(data, function () {
        html += '<a href="' + this.link + '" class="badge ' + this.badgeClass + '" data-badge-userid="' + userId + '" sasource="' + this.source + '">' + this.title + '</a>';
      });
      $('.c-list').find('.badges[data-user-id="' + userId + '"]:empty').html(html);
    });
  }

  function clientBasedUpdates() {
    if (saUser.isFp()) {
      SA.Utils.AbTests.init({
        'proplus_vs_subscriptions_test': function (variation) {
          if (variation === 'test_v1') {
            $('.pro-plus-link').attr('href', '/proplus');
          }
        }
      });
    } else {
      SA.Utils.AbTests.init({
        'premium_vs_subscriptions_test': function (variation) {
          if (variation === 'test_v1') {
            $('.premium-link').attr('href', '/premium');
          }
        }
      });
    }

    var userBadgesSelector = '[data-badge-userid="' + saUser.id() + '"]';
    if (saUser.isProPlus()) {
      $('.premium-link, .pro-plus-link').not(userBadgesSelector).removeAttr('href').addClass('no-click');
    } else if (saUser.isPro()) {
      $('.premium-link').not(userBadgesSelector).removeAttr('href').addClass('no-click');
    }
    $(userBadgesSelector).attr('href', '/account/user_settings');
  }

  // Public methods

  scope.init = function (data) {
    if (!saUser.loggedIn()) {
      return;
    }
    getBadges(data);
  }

})(window, window.SA, window.jQuery);

(function (SA, $) {

  'use strict';
  var scope = SA.UsingNamespace('SA.Models.Comments'),
    moderationDeleteCommentUrl = '/account/ajax_delete_instablog_comment',
    moderationDeleteArticleCommentUrl = '/account/ajax_delete_article_comment';

  var trackingDefaultOpt = {
    postId: null,
    postType: null,
    trackerId: null,
    status: false,
    commentsCount: 0
  };

  var submitDefaultOpt = {
    commentedElement: null,
    original: '',
    content: null,
    parentId: '',
    userNick: '',
    tagged: []
  };

  // Public methods

  scope.submit = function (opt) {
    opt = $.extend({}, submitDefaultOpt, opt || {});
    if (opt.commentedElement && opt.content) {
      submitComment(opt);
    }
  };

  scope.deleteComment = function (opt) {
    opt = opt || {};
    if (existNumeric(opt.id)) {
      deleteComment(opt);
    }
  };

  scope.update = function (opt) {
    opt = opt || {};
    if (existNumeric(opt.id) && opt.commentedElement && opt.content) {
      updateComment(opt);
    }
  };

  scope.getModelComments = function (opt) {
    opt = opt || {};
    if (existNumeric(opt.id)) {
      getModelComments(opt);
    }
  };

  scope.trackComments = function (opt) {
    opt = opt || {};
    opt = $.extend({}, trackingDefaultOpt, opt);
    if (existNumeric(opt.postId) && existNumeric(opt.postType)) {
      trackComments(opt);
    }
  };

  scope.moderationDelete = function (opt) {
    opt = opt || {};
    if (existNumeric(opt.id)) {
      moderationDeleteComment(opt);
    }
  };

  scope.getTrackingStatus = function (opt) {
    opt = opt || {};
    if (existNumeric(opt.typeId) && existNumeric(opt.id)) {
      getTrackingStatus(opt);
    }
  };

  // Private methods

  function existNumeric(val) {
    return val && $.isNumeric(val) && parseInt(val, 10);
  }

  function submitComment(opt) {
    if (SA.Data.User.isLimited()) {
      Rollbar.log('limited user is trying to publish a comment');
    } else {
      var data = {
        commented_element: opt.commentedElement,
        comment: {
          original: opt.original,
          content: opt.content,
          parent_id: opt.parentId,
          tagged: opt.tagged
        },
        user: {
          nick: opt.userNick || '',
          id: SA.Data.User.id()
        }
      };
      $.post('/account/json_submit_comment', data).done(function (response) {
        if ($.isFunction(opt.onSuccess)) {
          opt.onSuccess(response, opt);
        }
        SA.Widgets.Badges.init(data);
      }).fail(function (response) {
        if ($.isFunction(opt.onFailure)) {
          opt.onFailure(response);
        }
      });
    }
  }

  function getModelComments(opt) {
    var data = {
      id: opt.id || '',
      type: opt.type || 'InstablogPost',
      commentType: opt.commentType || ''
    };
    $.get('/account/ajax_get_comments', data).done(function (res) {
      if (res.status === 'success') {
        if ($.isFunction(opt.onSuccess)) {
          opt.onSuccess(res);
        }
        SA.Widgets.Badges.init(data);
      } else {
        if ($.isFunction(opt.onFailure)) {
          opt.onFailure(res);
        }
      }
    }).fail(function (res) {
      if ($.isFunction(opt.onFailure)) {
        opt.onFailure(res);
      }
    });
  }

  function trackComments(opt) {
    var data = {
      post_id: opt.postId,
      post_type: opt.postType,
      tracker_id: opt.trackerId,
      track_status: opt.status ? 1 : 0,
      comments_count: opt.commentsCount
    };
    $.post('/notifications/update_comments_tracking_status', data).done(function (response) {
      if ($.isFunction(opt.onSuccess)) {
        opt.onSuccess(response);
      }
    }).fail(function (response) {
      if ($.isFunction(opt.onFailure)) {
        opt.onFailure(response);
      }
    });
  }

  function deleteComment(opt) {
    $.ajax({
      method: 'POST',
      url: '/account/delete_comment',
      data: { id: opt.id },
      dataType: 'text'
    }).done(function (response) {
      if ($.isFunction(opt.onSuccess)) {
        opt.onSuccess(response, opt);
      }
    }).fail(function (response) {
      if ($.isFunction(opt.onFailure)) {
        opt.onFailure(response);
      }
    });
  }

  function moderationDeleteComment(opt) {
    $.ajax({
      method: 'POST',
      url: moderationUrl(opt.type),
      dataType: 'text',
      data: { id: opt.id }
    }).done(function (response) {
      if ($.isFunction(opt.onSuccess)) {
        opt.onSuccess(response, opt);
      }
    }).fail(function (response) {
      if ($.isFunction(opt.onFailure)) {
        opt.onFailure(response);
      }
    });
  }

  function moderationUrl(type) {
    return type === 'Article' ? moderationDeleteArticleCommentUrl : moderationDeleteCommentUrl
  }

  function updateComment(opt) {
    var data = {
      comment: { content: opt.content, tagged: opt.tagged },
      commented_element: opt.commentedElement,
      comment_id: opt.id
    };
    $.post('/account/json_submit_update_comment', data).done(function (response) {
      if ($.isFunction(opt.onSuccess)) {
        opt.onSuccess(response, opt);
      }
    }).fail(function (response) {
      if ($.isFunction(opt.onFailure)) {
        opt.onFailure(response, opt);
      }
    });
  }

  function getTrackingStatus(opt) {
    var data = {
      id: opt.id,
      type_id: opt.typeId
    };
    $.get('/account/get_tracking_status', data).done(function (response) {
      if ($.isFunction(opt.onSuccess)) {
        opt.onSuccess(response, opt);
      }
    }).fail(function (response) {
      if ($.isFunction(opt.onFailure)) {
        opt.onFailure(response, opt);
      }
    });
  }

}(window.SA, window.jQuery));
(function (SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Models');
  scope.Like = {
    // data: id, type
    // clb: {onComplete, onFailed}
    //    onSuccess = function(response)
    //    onFail = function(response, errorType)
    ajaxAddLike: function (data, onDone, onFail, onAlways) {
      SA.Logger.Mone.event(data.type, null, 'like', {data: data});
      $.post('/likes/ajax_like', data).done(onDone).fail(onFail).always(onAlways);
    },

    // data: {id, type}
    // onSuccess = function(response)
    // onFail = function(response, errorType)
    ajaxRemoveLike: function (data, onDone, onFail, onAlways) {
      SA.Logger.Mone.event(data.type, null, 'unlike', {data: data});
      $.post('/likes/ajax_unlike', data).done(onDone).fail(onFail).always(onAlways);
    },

    // data: id, type
    // onSuccess = function(response)
    // onFail = function(response, errorType)
    ajaxGetLatestLikers: function (data, onDone, onFail) {
      $.get('/likes/ajax_get_latest_likers', data).done(onDone).fail(onFail);
    },

    // data: id, type
    // onSuccess = function(response)
    // onFail = function(response, errorType)
    ajaxGetLatestLikersAndUrl: function (data, onDone, onFail) {
      $.get('/likes/ajax_get_latest_likers_url', data).done(onDone).fail(onFail);
    },

    // data: id, type
    // onSuccess = function(response)
    // onFail = function(response, errorType)
    ajaxGetLikers: function (data, onDone, onFail) {
      $.get('/likes/likers', data).done(onDone).fail(onFail);
    },

    // data: id, type
    // onSuccess = function(response)
    // onFail = function(response, errorType)
    ajaxGetLikerData: function (data, onDone, onFail) {
      $.get('/likes/liker_data', data).done(onDone).fail(onFail);
    }
  };

}(window.SA, window.jQuery));

(function (SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Models.Rating');

  scope.likeComment = function (commentId, onDone, onFail, onAlways) {
    if (commentId && $.isNumeric(commentId)) {
      SA.Models.Like.ajaxAddLike({id: commentId, type: 'Comment'}, onDone, onFail, onAlways);
    }
  };

  scope.unlikeComment = function (commentId, onDone, onFail, onAlways) {
    if (commentId && $.isNumeric(commentId)) {
      SA.Models.Like.ajaxRemoveLike({id: commentId, type: 'Comment'}, onDone, onFail, onAlways);
    }
  };

  scope.getLikers = function (opt) {
    opt = opt || {};
    if (opt.id && $.isNumeric(opt.id)) {
      getLikers(opt);
    }
  };

  function getLatestLikers(e) {
    var $target = $(e.target), id, type;
    if ($target.data('comment')) {
      id = $target.data('comment');
      type = 'Comment';
    } else {
      id = $target.parent().data('id');
      type = $target.parent().data('type');
    }

    if (id && $target.is(':hover')) {
      SA.Models.Like.ajaxGetLatestLikersAndUrl({id: id, type: type}, function (res) {
        if ($target.is(':hover')) {
          $target.attr('data-content', buildLikersHtml(res.likers, res.total_likes, id, type)).popover('show');
          $('.show-all-likers').on('click', SA.Widgets.LikersPopup.showAllLikers);
        }
      });
    }
  }

  function buildLikersHtml(list, totalLikers, id, type) {
    var result = [];
    $.each(list, function (key, obj) {
      var nick = !obj.nick ? 'User ' + obj.id : obj.nick;
      result.push('<div><a class="liker" href="' + obj.url + '" target="_self"> ' + nick + '</a></div>');
    });

    if (list.length < totalLikers) {
      result.push('<div class="show-all-likers" data-' + type + '=' + id + ' data-count=' + totalLikers + '>Show all</div>');
    }

    return result.join('');
  }

  function initPopOver(hoverOn) {
    var hideTimer = true;
    $(window.document).on('mouseover', hoverOn, function (e) {
      e.preventDefault();
      var $self = $(this);
      hideTimer = true;
      if (!$self.hasClass('inited')) {
        $self.popover({
          trigger: 'manual',
          placement: 'bottom',
          html: true,
          animation: true,
          title: ''
        }).addClass('inited');
      }
      $self.data('timeout', setTimeout(function () {
        getLatestLikers(e);
      }, 200));
    }).on('mouseenter mouseover', '.popover', function () {
      hideTimer = false;
    }).on('mouseleave', '.popover', function () {
      $(this).popover('hide');
    }).on('mouseout', hoverOn, function () {
      clearTimeout($(this).data('timeout'));
      var $self = $(this);
      $self.data('hider', setTimeout(function () {
        if (hideTimer) {
          $self.popover('hide');
        }
      }, 500));
    });
  }

  initPopOver('.ct-likes-count, .show-likers');

}(window.SA, window.jQuery));
(function(){

  "use strict";

  var scope = SA.UsingNamespace("SA.Models");
  scope.ReportAbuse = new function(){

    this.OnResponse = function() {
      this.beforeSend = function(){};
      this.onComplete = function(){};
      this.onFailed = function(){};
    };

    // data = {type: type, id: id, reason: reason, abuse_slug: abuse_slug}
    this.reportAbuse = function(data, onResponse) {
      onResponse.beforeSend();
      $.ajax({
        method: 'get',
        url: '/account/ajax_report_spam',
        data: data,
        dataType: 'text'
      }).done(function(response, status, data) {
        onResponse.onComplete(response, status, data);
      }).fail(function(response, errorType) {
        onResponse.onFailed(response, errorType);
      });
    };
  };

})();
(function(){

  "use strict";

  var scope = SA.UsingNamespace("SA.Widgets");

  scope.ReportAbusePopup  = new function() {

    var _modelCallbacks;
    var _eventSource, _reportAbuseId, _reportAbuseType, _isAuthor;
    var menu_type, _abuseSlug = '';

    var userData = {
      id: SA.Data.User.id()
    };

    var fields = {
      messageContent: {
        errors: {
          empty: 'You must explain your reason for reporting this comment or user.',
          emptyIsAuthor: "You must describe what you would like edited."
        }
      }
    };

    var abuse_data = {
      "Offensive": [
        {slug: 'personal_attack', name: "Personal attack", description: "We welcome disagreement with the perspectives offered on the site, but participation in the Seeking Alpha discussion community is contingent upon treating other community members with respect, especially when disagreeing with their arguments."},
        {slug: 'allegation', name: "Allegation of bad faith", description: "We ask that users provide evidence to support arguments for disagreeing with others, rather than impugning their motivation. This includes suggesting that they stand to gain financially by the change in a stock or ETFs value due to undisclosed investments or other dealings. Serious problems with articles should be filed as disputes."},
        {slug: 'language', name: "Obscenities or abusive language", description: "We welcome posts that contain a strong disagreement about the issues under discussion, but ask that they maintain the serious and polite tone that we aim to encourage on the site."},
        {slug: 'stereotyping', name: "Stereotyping, prejudiced or racist language", description: "The posting of racist, ethnic and similar slurs is grounds for being banned from Seeking Alpha. This includes criticizing commenters for their use of non-fluent English."}
      ],
      "Quality of Discussion": [
        {slug: 'unrelated', name: "Unrelated to the topic under discussion", description: "Seeking Alpha is a platform for investment research. It is natural for discussions to take tangents, but this is not a forum for general political or social dialogue."},
        {slug: 'blanket_dismissal', name: "Blanket dismissal of someone elses ideas", description: "We welcome disagreement with the perspectives offered on the site but we encourage users to focus their response on detailing why and how they disagree with the substance of the post being addressed."},
        {slug: 'non_standard', name: "Written in a non-standard form", description: "Using ALL CAPS, strange punctuation, no capital letters or languages other than English make it hard for other readers to follow and engage with posts."}
      ],
      "Promotional": [
        {slug: 'spam', name: "Contains a link to posters blog or business", description: "Users who wish to mention their own finance-related products or websites on Seeking Alpha may do so only once, by posting a single link on their user profile. Comments, Stocktalks and Instablogs are not an appropriate venue for marketing products or proprietary investment techniques."}
      ],
      "Other": [
        {slug: 'other', name: "Other", description: "We cannot fact-check comments, Stocktalks and Instablogs. If you think this contains incorrect information, politely explain why you disagree in a reply."}
      ]
    };

    var _resetAbuseReportData = function() {
      $("#send-report-popup-btn").addClass('disabled');
      _abuseSlug = '';
    };

    var _updateAbuseReportData = function() {
      $("#send-report-popup-btn").removeClass('disabled');
      _abuseSlug = $('.menu_wrap input[name=abuse_sub_category]:checked').val();
    };

    var _toggleMenu = function(radio_button) {
      var i, j, max;
      var sub_wraps = $('.report_abuse_lightbox .sub_wrap'), sub_checks = $('input[name="abuse_sub_category"]');
      for (i = 0, max = sub_wraps.length; i < max; i += 1) {
        $(sub_wraps[i]).addClass('no_show');
      }
      for (j = 0, max = sub_checks.length; j < max; j += 1) {
        sub_checks[j].checked = false;
      }
      if (radio_button[0].checked){
        var sub_cats = radio_button.nextAll('.sub_wrap').find('li input');
        if (sub_cats.length == 1) {
          sub_cats[0].checked = true;
          _updateAbuseReportData();
        }
        else if (sub_cats.length == 0) {
          _abuseSlug = '';
          $("#send-report-popup-btn").removeClass('disabled');
        }
        else {
          _resetAbuseReportData();
        }

        radio_button.nextAll('.sub_wrap').removeClass('no_show');
      }
    };

    var _getModalHtml = function() {
      var i, max;
      var boxHtml = '<div class="report_abuse_lightbox">', sub_menus;
      boxHtml += '<ul class="menu_wrap">';
      for (menu_type in abuse_data){
        if (menu_type == 'Other') continue;
        boxHtml += '<li>';
        boxHtml += '  <input type="radio" name="abuse_top_category" /> <span class="menu_item">'+ menu_type +'</span>';
        boxHtml += '  <ul class="sub_wrap no_show">';
        sub_menus = abuse_data[menu_type];
        for (i = 0, max = sub_menus.length; i < max; i += 1) {
          boxHtml += '  <li class="sub_category"><input type="radio" name="abuse_sub_category" value="'+ sub_menus[i].slug +'" /> <span class="sub_menu_item">'+ sub_menus[i].name +'</span><span class="info-popover">&nbsp;</span><span class="pop_description no_show">'+ sub_menus[i].description +'</span></li>';
        }
        boxHtml += '  </ul>';
        boxHtml += '</li>';
      }
      boxHtml += '<li>';
      boxHtml += '  <input type="radio" name="abuse_top_category" value="other" /> <span class="menu_item">Other</span><span class="info-popover">&nbsp;</span><span class="pop_description no_show">'+ abuse_data['Other'][0]['description'] +'</span>';
      boxHtml += '  <ul class="sub_wrap no_show">';
      boxHtml += '    <div id="report_reason_error_message" class="error_message"></div>';
      boxHtml += '    <div class="text_box_wrap"><textarea id="report_content" autocomplete="off" class="form-control" rows="3" placeholder="Please describe the problem"></textarea></div>';
      boxHtml += '  </ul>';
      boxHtml += '</li>';

      boxHtml += '</ul>';
      boxHtml += '<div class="bottom_description"><b class="red">Please note:</b> Reports are assessed by Seeking Alpha\'s moderation team, not by article authors. Please see our <a href="/page/comment_guidelines?source=reportabusebox" target="_blank">guidelines</a> for details on what constitutes inappropriate user behavior.</div>';
      boxHtml += '  <div id="moveable_popup" class="pop_description hidden"><span class="content"></span><span class="pop_bubble_pointer"></span></div>';
      boxHtml += '</div>';

      return boxHtml;
    };

    var _init = function(data) {
      var opt = {};
      _eventSource = data.eventSource || '';
      _reportAbuseId = data.reportAbuseId || '';
      _reportAbuseType = data.reportAbuseType || '';
      _isAuthor = data.isAuthor;
      var templates;
      if(_isAuthor){
        templates = {
          modalNewMessage: {
            header: '<p class="modal-message-header">Request Edit or Delete comment from Moderation Team</p>',
            body:   '<div class="text_box_wrap"><textarea id="report_content" autocomplete="off" class="form-control" rows="3" placeholder="Write precisely in this box what edits you want us to make for you on this comment (describe the changes in as much detail as required) / Write \'Delete\' in this box if you\'d like us to remove this comment"></textarea></div>',
            footer: '<div style="display: none" id="form-error" class="form-error" />' +
            '<button type="button" class="btn btn-primary orange-btn" id="send-report-popup-btn">Submit Request</button>'
          }
        };
      } else {
        templates = {
          modalNewMessage: {
            header: '<p class="modal-message-header">Please indicate the primary problem with this ' + _reportAbuseType + ':</p>',
            body:   _getModalHtml(),
            footer: '<div style="display: none" id="form-error" class="form-error" />' +
            '<button type="button" class="disabled btn btn-primary orange-btn" id="send-report-popup-btn">Submit Report</button>'
          }
        };
      }

      opt.className = 'sa-report-abuse-modal';
      opt.headerContent = templates.modalNewMessage.header;
      opt.bodyContent = templates.modalNewMessage.body;
      opt.footerContent = templates.modalNewMessage.footer;
      opt.keyboard = true;
      opt.backdrop = true;
      opt.removeAfterClose = true;

      opt.afterOpen = function(){
        var sendReportBtn = $("#send-report-popup-btn");
        sendReportBtn.on('click', function(){
          if (_validateMessageContent()) {
            _showLoader(sendReportBtn);
            _sendReportAbuse();
          }
        });

        if(!_isAuthor){
          $('input[type=radio][name=abuse_top_category]').on('change', function(){
            var btn = $(this);
            _hideError($('#form-error'));
            _toggleMenu(btn);
          });

          $('input[type=radio][name=abuse_sub_category]').on('change', function(){
            _updateAbuseReportData();
          });
        }

        var messageContent = $("#report_content");
        messageContent.on('change keyup paste', function() {
          _hideError($('#form-error'));
        });

        _initInfoPopover();
      };

      var _sendReportAbuse = function() {
        var data = {}, other = $('.menu_wrap input:checked').val() === 'other' || _isAuthor;
        data.type = _reportAbuseType; //'Comments';
        data.id = _reportAbuseId;
        data.reason = other ? $("#report_content").val() : '';
        data.abuse_slug = other ? 'other' : _abuseSlug;

        SA.Models.ReportAbuse.reportAbuse(data, _modelCallbacks);
      };

      var _buildModelCallbacks = function(popup){
        var callback = new SA.Models.ReportAbuse.OnResponse;
        callback.onComplete = function(response, status){
          if (status == 'success') {
            _sendReportEvent();
            _removeLoader($("#send-report-popup-btn"));
            popup.hide();
          }
          else {
            _handleModelFailure();
          }
        };
        callback.beforeSend = function(){
        };
        callback.onFailed = function(){
          _handleModelFailure();
        };
        return callback;
      };

      var _handleModelFailure = function(errorText) {
        _messageFailEvent(errorText);
        alert('There was an error while sending abuse report');
      };

      var _sendInvalidFieldEvent = function(field){
        SA.Logger.Mone.event('report-abuse', _eventSource, 'validation_error', {
          data: {
            invalid:field,
            user_id: userData.id.toString(),
            source: userData.source
          }
        });
      };

      var _validateMessageContent = function() {
        if ( ( _isAuthor || ($('.menu_wrap input:checked').val() == 'other' ) ) && $('#report_content').val().trim() == '') {
          var errorMsg = _isAuthor ? fields.messageContent.errors.emptyIsAuthor : fields.messageContent.errors.empty;
          _showError($('#form-error'), errorMsg);
          _sendInvalidFieldEvent('ta_content');
          return false;
        }
        _hideError($('#form-error'));
        return true;
      };

      var _showError = function(element, errorText) {
        element.text(errorText);
        element.show();
      };

      var _hideError = function(element) {
        element.text("");
        element.hide();
      };

      var popup = SA.Widgets.Popup.build(opt);
      _modelCallbacks = _buildModelCallbacks(popup);
      return popup;
    };

    var _initInfoPopover = function() {
      $('.info-popover').each( function(){
        $(this).popover({

          placement: 'top',
          trigger: 'hover',
          html: true,
          content: $(this).parent().find('.pop_description').html()
        });
      });
    };

    var _showLoader = function(btn) {
      btn.addClass('sa-animated');
    };

    var _removeLoader = function(btn){
      btn.removeClass('sa-animated');
    };

    var _sendReportEvent = function() {
      SA.Logger.Mone.event('report-abuse', _eventSource, 'report_sent');
    };

    var _messageFailEvent = function(errorText) {
      SA.Logger.Mone.event('report-abuse', _eventSource, 'error_message', {
        error: 'server_error: ' + errorText
      });
    };

    // ---------------------------------------------------------------------------
    // public methods

    this.buildReportAbusePopup = function (data) {
      if(!SA.Widgets.Popup.isRunning()) {
        var reportAbuseModal = _init(data);
        reportAbuseModal.show();
      }
    };

  };
})();



// Generic report abuse btn for comments module
// For users:
// <a href="#" class="sa-report-abuse-btn" data-type="Comment" data-source="{{source for mone}}" data-id="{{commentId}}""><span>!&nbsp</span>Report Abuse</a>

(function(window, SA, $){

  "use strict";

  var targetClass = '.sa-report-abuse-btn',
      source;

  var reportAbuse = function(btn) {
    var data = {};
    data.eventSource = btn.data('source');
    data.reportAbuseId = btn.data('id');
    data.reportAbuseType = btn.data('type');
    data.isAuthor = btn.data('is-author');

    SA.Widgets.ReportAbusePopup.buildReportAbusePopup(data);
  };

  var initialize = function() {
    $(document).on('click', targetClass, function (event) {
      event.preventDefault();

      var btn = $(this);

      if (SA.Data.User.loggedIn()) {
        reportAbuse(btn);
      } else {
        // TODO: Auth popup with after login callback
        window.location = SA.Models.Authentication.staticLoginLink + '?rt=' + encodeURI(window.location.href);
      }
    });
  };

  initialize();

}(window, SA, jQuery));


// Generic follow/unFollow btn for user and author subscription
// For users:
// <a href="#" class="sa-follow-btn" data-source="{{source for mone}}" data-following="{{true/false}}" data-type="user" data-id="{{userId}}">Following</a>
// For author:
// <a href="#" class="sa-follow-btn" data-source="{{source for mone}}" data-following="{{true/false}}" data-type="author" data-slug="{{authorSlug}}">+ Follow</a>

(function(window, SA, $){

  "use strict";

  var targetClass = '.sa-follow-btn',
      typeList = ['user', 'author'],
      followModel = SA.Models.AuthorModel || null,
      source;

  var isValidType = function(type) {
    return $.inArray(type, typeList) !== -1;
  };

  var validateOpt = function(btn) {
    return isValidType(btn.data('type'));
  };

  var followUserSuccess = function(id) {
    var btns = $(targetClass + '[data-type="user"][data-id="' + id + '"]');
    btns.each(function(index, btn){
      $(btn).data('following', true).text('Following');
    });
    SA.Logger.Mone.event('auth_follow', source, 'follow_user');
  };

  var followUser = function(btn) {
    followModel.followUser({
      id: btn.data('id'),
      onSuccess: followUserSuccess
    });
  };

  var followAuthorSuccess = function(slug) {
    var btns = $(targetClass + '[data-type="author"][data-slug="' + slug + '"]');
    btns.each(function(index, btn){
      $(btn).data('following', true).text('Following');
    });
    SA.Logger.Mone.event('auth_follow', source, 'follow_author');
  };

  var followAuthor = function(btn) {
    followModel.followAuthor({
      slug: btn.data('slug'),
      onSuccess: followAuthorSuccess
    });
  };

  var unFollowAuthorSuccess = function(slug) {
    var btns = $(targetClass + '[data-type="author"][data-slug="' + slug + '"]');
    btns.data('following', false).text('+ Follow');
    SA.Logger.Mone.event('auth_follow', source, 'stop_follow_author');
  };

  var unFollowAuthor = function(btn) {
    followModel.unFollowAuthor({
      slug: btn.data('slug'),
      onSuccess: unFollowAuthorSuccess,
    });
  };

  var unFollowUserSuccess = function(id) {
    var btns = $(targetClass + '[data-type="user"][data-id="' + id + '"]');
    btns.data('following', false).text('+ Follow');
    SA.Logger.Mone.event('auth_follow', source, 'stop_follow_user');
  };

  var unFollowUser = function(btn) {
    followModel.unFollowUser({
      id: btn.data('id'),
      onSuccess: unFollowUserSuccess
    });
  };

  var unFollowStrategy = function(btn) {
    if(btn.data('type') === 'user') {
      if(btn.data('id') && $.isNumeric(btn.data('id'))) {
        unFollowUser(btn);
      } else {
        SA.exceptions.push(['UserFollowBtn: user id not provided']);
      }
    }
    if(btn.data('type') === 'author') {
      if(btn.data('slug')) {
        unFollowAuthor(btn);
      } else {
        SA.exceptions.push(['UserFollowBtn: author slug not provided']);
      }
    }
  };

  var followStrategy = function(btn) {
    if(btn.data('type') === 'user') {
      if(btn.data('id') && $.isNumeric(btn.data('id'))) {
        followUser(btn);
      } else {
        SA.exceptions.push(['UserFollowBtn: user id not provided']);
      }
    }
    if(btn.data('type') === 'author') {
      if(btn.data('slug')) {
        followAuthor(btn);
      } else {
        SA.exceptions.push(['UserFollowBtn: author slug not provided']);
      }
    }
  };

  var selectStrategy = function(btn) {
    if(btn.data('following')) {
      unFollowStrategy(btn);
    } else {
      followStrategy(btn);
    }
  };

  var setHoverEvents = function() {
    var btn;
    $(document).on('mouseover', targetClass, function () {
      btn = $(this);
      if(btn.data('following')) {
        btn.text('- Unfollow');
      }
    });
    $(document).on('mouseout', targetClass, function () {
      btn = $(this);
      if(btn.data('following')) {
        btn.text('Following');
      }
    });
  };

  var initialize = function() {

    $(document).on('click', targetClass, function (event) {
      event.preventDefault();

      var btn = $(this);

      if (SA.Data.User.loggedIn()) {

        if (validateOpt(btn)) {
          source = btn.data('source') || window.location.pathname;
          selectStrategy(btn);
        } else {
          SA.exceptions.push(['UserFollowBtn: error parsing args:' + JSON.stringify($(this).data())]);
        }

      } else {
        SA.Logger.Mone.event('popup_registration', 'follow_commenter', 'shown');
        SA.Widgets.AuthenticationPopup.show(
          {
            id: 'user_id|' + btn.data('id'),
            activity: 'follow_me',
            urlHash: "#comment-"+btn.data('comment-id')
          }
        );
      }
    });

    setHoverEvents();

  };

  initialize();

}(window, SA, jQuery));
/*!
* flexibleArea.js v1.3
* A jQuery plugin that dynamically updates textarea's height to fit the content.
* http://flaviusmatis.github.com/flexibleArea.js/
*
* Copyright 2012, Flavius Matis
* Released under the MIT license.
* http://flaviusmatis.github.com/license.html
*/


(function($){
	var methods = {
		init : function() {

			var styles = [
				'paddingTop',
				'paddingRight',
				'paddingBottom',
				'paddingLeft',
				'fontSize',
				'lineHeight',
				'fontFamily',
				'width',
				'fontWeight',
				'border-top-width',
				'border-right-width',
				'border-bottom-width',
				'border-left-width',
				'-moz-box-sizing',
				'-webkit-box-sizing',
				'box-sizing'
			];

			return this.each(function(){

				if (this.type !== 'textarea')	return false;
					
				var $textarea = $(this).css({'resize': 'none', overflow: 'hidden'});
				
				var	$clone = $('<div></div>').css({
					'position' : 'absolute',
					'display' : 'none',
					'word-wrap' : 'break-word',
					'white-space' : 'pre-wrap',
					'border-style' : 'solid'
				}).appendTo(document.body);

				function copyStyles(){
					for (var i=0; i < styles.length; i++) {
						$clone.css(styles[i],$textarea.css(styles[i]));
					}
				}

				// Apply textarea styles to clone
				copyStyles();

				var hasBoxModel = $textarea.css('box-sizing') == 'border-box' || $textarea.css('-moz-box-sizing') == 'border-box' || $textarea.css('-webkit-box-sizing') == 'border-box';
				var heightCompensation = parseInt($textarea.css('border-top-width')) + parseInt($textarea.css('padding-top')) + parseInt($textarea.css('padding-bottom')) + parseInt($textarea.css('border-bottom-width'));
				var textareaHeight = parseInt($textarea.css('height'), 10);
				var lineHeight = parseInt($textarea.css('line-height'), 10) || parseInt($textarea.css('font-size'), 10);
				var minheight = lineHeight * 2 > textareaHeight ? lineHeight * 2 : textareaHeight;
				var maxheight = parseInt($textarea.css('max-height'), 10) > -1 ? parseInt($textarea.css('max-height'), 10) : Number.MAX_VALUE;

				function updateHeight() {
					var textareaContent = $textarea.val().replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/&/g, '&amp;').replace(/\n/g, '<br/>');
					// Adding an extra white space to make sure the last line is rendered.
					$clone.html(textareaContent + '&nbsp;').css({'width': parseInt($textarea.width(), 10) + 'px'});
					setHeightAndOverflow();
				}

				function setHeightAndOverflow(){
					var cloneHeight = $clone.height();
					var overflow = 'hidden';
					var height = hasBoxModel ? cloneHeight + lineHeight + heightCompensation : cloneHeight + lineHeight;
					if (height > maxheight) {
						height = maxheight;
						overflow = 'auto';
					} else if (height < minheight) {
						height = minheight;
					}
					if ($textarea.height() !== height) {
						$textarea.css({'overflow': overflow, 'height': height + 'px'});
					}
				}

				// Update textarea size on keyup, change, cut and paste
				$textarea.bind('keyup change cut paste', function(){
					updateHeight();
				});

				// Update textarea on window resize
				$(window).bind('resize', function(){
					if ($clone.width() !== parseInt($textarea.width(), 10)) {
						updateHeight();
					}
				});

				// Update textarea on blur
				$textarea.bind('blur',function(){
					setHeightAndOverflow();
				});

				// Update textarea when needed
				$textarea.bind('updateHeight', function(){
					copyStyles();
					updateHeight();
				});

				// Wait until DOM is ready to fix IE7+ stupid bug
				$(function(){
					updateHeight();
				});
			});
		}
	};

	$.fn.flexible = function(method) {
		// Method calling logic
		if (methods[method]) {
			return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
		} else if (typeof method === 'object' || ! method) {
			return methods.init.apply(this, arguments);
		} else {
			$.error('Method ' + method + ' does not exist on jQuery.flexible');
		}
	};

})(jQuery);
// jQuery tinyDraggable v1.0.2
// https://github.com/Pixabay/jQuery-tinyDraggable
!function(e){e.fn.tinyDraggable=function(n){var t=e.extend({handle:0,exclude:0},n);return this.each(function(){var n,o,u=e(this),a=t.handle?e(t.handle,u):u;a.on({mousedown:function(a){if(!t.exclude||!~e.inArray(a.target,e(t.exclude,u))){a.preventDefault();var f=u.offset();n=a.pageX-f.left,o=a.pageY-f.top,e(document).on("mousemove.drag",function(e){u.offset({top:e.pageY-o,left:e.pageX-n})})}},mouseup:function(){e(document).off("mousemove.drag")}})})}}(jQuery);
(function(SA, $){

  "use strict";

  var scope = SA.UsingNamespace('SA.Models.Messaging');

  var sendMessage = function(opt) {
    $.ajax({
      method: 'post',
      url: '/inbox/send_message',
      data: {
        recipient: opt.recipient,
        sender_id: opt.senderId,
        source: opt.eventSource || '',
        subject: opt.subject || '',
        content: opt.message
      },
      dataType: 'json'
    }).done(function(response) {
      if($.isFunction(opt.onSuccess)) {
        opt.onSuccess(response, opt);
      }
    }).fail(function(response) {
      if($.isFunction(opt.onFailure)) {
        opt.onFailure(response, opt);
      }
    });
  };

  scope.sendMessage = function(data) {
    data = data || {};
    if(data.senderId && data.recipient && data.message) {
      return sendMessage(data);
    }
  };

  scope.getStatus = function() {

  };

}(SA, jQuery));
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/messaging/modal"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div class="modal-dialog" id="sa-messaging-modal">\n  <div class="modal-content">\n    <div class="modal-header">\n      <button type="button" class="close"><span>&times;</span></button>\n      <h4>To: ',  to ,'</h4>\n    </div>\n    <div class="modal-body">\n      <input type="text" class="form-control msg-subject" placeholder="Subject" maxlength="300"/>\n      <hr>\n      <textarea class="form-control msg-text" rows="6" placeholder="Write a message..."></textarea>\n    </div>\n    <div class="modal-footer">\n      <button type="button" class="btn orange-btn send-btn">Send</button>\n    </div>\n  </div>\n</div>\n');}return __p.join('');};
}).call(this);





(function(SA, $){

  'use strict';

  var scope = SA.UsingNamespace('SA.Widgets.Messaging'), $messageModal, opt;
  var MODAL_HEIGHT = 280;
  var MODAL_WIDTH = 600;

  var showLoader = function($btn) {
    $btn.addClass('sa-animated');
  };

  var removeLoader = function(btn){
    btn.removeClass('sa-animated');
  };

  var closeModal = function() {
    $messageModal.fadeOut(200, function() {
      $messageModal.remove();
      $messageModal = null;
    });
  };

  function setCloseEvent() {
    $messageModal.on('click', '.close', function(){
      closeModal();
    });
  }

  function handleError() {
    closeModal();
    alert('An error has occurred, please try again later.');
  }

  function handleSendSuccess(resp) {
    if(resp.msg_sent) {
      removeLoader($messageModal.find('.send-btn'));
      closeModal();
      SA.Logger.Mone.event('message', opt.eventSource, 'message_sent');
    } else {
      handleError();
    }
  }

  function handleSendFailure(resp) {
    removeLoader($messageModal.find('.send-btn'));
    handleError();
    SA.Logger.Mone.event('message', opt.eventSource, 'error_message', {
      data: {
        error: resp.statusText
      }
    });
  }

  function handleSendMessage(message, subject) {
    SA.Models.Messaging.sendMessage({
      senderId: SA.Data.User.id(),
      recipient: opt.recipient,
      subject: subject || opt.subject,
      message: message,
      eventSource: opt.eventSource,
      onSuccess: handleSendSuccess,
      onFailure: handleSendFailure
    });
  }

  function setSendEvent() {
    $messageModal.on('click', '.send-btn', function() {
      var message = $messageModal.find('.msg-text').val().trim();
      var subject = $messageModal.find('.msg-subject').val().trim();
      if(message) {
        showLoader($(this));
        handleSendMessage(message, subject);
      } else {
        SA.Logger.Mone.event('message', opt.eventSource, 'validation_error', {
          data: {
            invalid: 'ta_content',
            user_id: SA.Data.User.id().toString(),
            source: SA.Utils.SASource.get()
          }
        });
      }
    });
  }

  function setEvents() {
    setCloseEvent();
    setSendEvent();
  }

  function getModal() {
    $messageModal = $(JST['jst/widgets/messaging/modal']({
      to: opt.recipient
    }));
    setEvents();
  }

  function positionModal() {
    if(opt.position === 'free') {
      return false;
    }

    if(opt.top !== undefined && opt.left !== undefined && opt.marginTop !== undefined) {
      //if has position calculations
      if (SA.pageConfig.Data.messageModalFixed || opt.position === 'fixed') {
        return $messageModal.css({
          'position': 'fixed',
          'top': '50%',
          'left': '50%',
          'margin-top': (-MODAL_HEIGHT / 2) + 'px',
          'margin-left': (-MODAL_WIDTH / 2) + 'px'
        });
      }
      return $messageModal.css({
        'top': opt.top,
        'left': opt.left,
        'marginTop': opt.marginTop
      });
    }
    $messageModal.addClass('default');
  }

  function buildMessageModal() {
    getModal();
    positionModal();
    $('body').append($messageModal);
    $messageModal.find('.msg-text').css('maxHeight', opt.maxHeight);
    $messageModal.fadeIn();
    $messageModal.find('textarea').flexible().focus();
    $messageModal.tinyDraggable({
      handle: '.modal-header',
      exclude: '.close'
    });

  }

  function switchModals() {
    $messageModal.fadeIn(200, function() {
      $messageModal.remove();
      buildMessageModal();
    });
  }

  function initModal() {
    $(document).off('mousemove.drag');
    if($messageModal) {
      return switchModals();
    }
    return buildMessageModal();
  }

  function init() {
    if(opt.recipient) {
      return initModal();
    }
    return SA.exceptions.push(['Messaging: no recipient']);
  }

  scope.buildNewMessagePopup = function(data) {
    if(SA.Data.User.loggedIn()) {
      opt = $.extend({}, {eventSource: SA.Utils.SASource.get()}, data || {});
      SA.Logger.Mone.event('message', opt.eventSource, 'popup_shown', {
        data: {
          subject_id: opt.subjectId || ''
        }
      });
      return init();
    }
    return SA.Widgets.AuthenticationPopup.show();
  };


}(window.SA, window.jQuery));

// Generic send message btn for comments module
// For users:
// <a href="#" class="sa-send-message-btn" data-subject="{{subject}}" data-source="{{source for mone}}" data-id="{{userId}}" data-nick="{{userNick}}" data-position="...">Send Message</a>

(function(w, SA, $){

  'use strict';

  var MODAL_HEIGHT = 252;
  var MODAL_MARGIN = 20;
  var MODAL_BODY_PADDING = 30;
  var MODAL_FOOTER_AND_HEAD_HEIGHT = 92;

  function getModalTop(top, windowHeight){
    var outVal = top;
    if(top && (top + MODAL_HEIGHT + MODAL_MARGIN >= windowHeight)){
      outVal = Math.max(windowHeight - MODAL_HEIGHT, 0);
    }
    return outVal;
  }

  function getModalMaxHeight(top, windowHeight){
    return top === 0 ? (windowHeight - MODAL_FOOTER_AND_HEAD_HEIGHT - MODAL_BODY_PADDING) : windowHeight - top - MODAL_FOOTER_AND_HEAD_HEIGHT - MODAL_MARGIN - MODAL_BODY_PADDING;
  }

  function displayModal($btn) {
    var top = 0, left = 0, el, windowHeight, maxHeight, marginTop;

    try {
      el  = $btn[0].getBoundingClientRect();
      windowHeight = $(window).height();
      top = getModalTop(el.top, windowHeight);
      maxHeight = getModalMaxHeight(top, windowHeight);
      marginTop = (top !== undefined && top === 0) ? 0 : MODAL_MARGIN;
      left = el.left;
    } catch(ignore) {}

    return SA.Widgets.Messaging.buildNewMessagePopup({
      subject: $btn.data('subject') || 'Regarding your comment',
      recipient: $btn.data('nick'),
      eventSource: $btn.data('source') || '',
      subjectId: $btn.data('subject-id') || '',
      top: top,
      left: left,
      maxHeight: maxHeight,
      marginTop: marginTop,
      position: $btn.data('position')
    });
  }

  function sendMessage($btn) {
    var n = $btn.data('nick');
    if(n && n !== SA.Data.User.nick()) {
      return displayModal($btn);
    }
    return SA.exceptions.push(['Msg btn: no nick']);
  }

  function handleResponse(res, $btn, id) {
    if(!res.errors) {
      if(res.redirect) {
        w.location.href = '/inbox/compose?to_id=' + id;
      } else {
        sendMessage($btn);
      }
    }
  }

  function tryToSend($btn) {
    var id = parseInt($btn.data('id'), 10) || 0;
    if(id) {
      $.ajax({
        url: '/users/ajax_send_msg_popup',
        data: {
          to_id: id,
          allow_no_nick: $btn.data('allow-no-nick')
        }
      }).done(function(res) {
        res = res || {};
        handleResponse(res, $btn, id);
      });
    }
  }

  function init() {
    $(document).on('click', '.sa-send-message-btn', function(e) {
      e.preventDefault();
      var $btn = $(this);
      SA.Logger.Mone.event('message_author', 'article_page', 'click', {
        data: {
          author_slug: $btn.data('slug'),
          author_id : $btn.data('id') || ''
        }
      });
      if (SA.Data.User.loggedIn()) {
        return tryToSend($btn);
      }
      SA.Widgets.AuthenticationPopup.show();
      SA.Logger.Mone.event('message', $btn.data('source'), 'error_message', {
        data: {
          subject_id : $btn.data('subjectId') || '',
          error: 'user_not_logged_in'
        }
      });
    });
  }

  SA.run(init, 'sa-message-btn');

}(window, window.SA, window.jQuery));
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/mute_user_button"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<a class="',  cssClass ,'"',  href ,'><i>',  name ,'</i></a>\n');}return __p.join('');};
}).call(this);
(function (SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Models.MuteUser'),
    muteUserLink = '/muted_users/ajax_mute_user',
    unMuteUserLink = '/muted_users/ajax_unmute_user',
    mutedUsers = SA.Data.User.mutedUsers(),
    biDefaults = {type: 'user_mute', src: '', data: {}};

  // Public functions

  scope.isMuted = isMuted;

  scope.removeFromMuted = function (id) {
    var index = mutedUsers.indexOf(id);
    if (index > -1) mutedUsers.splice(index, 1);
  };

  scope.mute = function (opt) {
    post(opt || {}, true);
  };

  scope.unMute = function (opt) {
    post(opt || {}, false);
  };

  // Public functions


  // Private functions

  function isMuted(id) {
    return $.inArray(id, mutedUsers) !== -1;
  }

  function removeMutedUser(userId) {
    if (isMuted(userId)) {
      mutedUsers.splice($.inArray(userId, mutedUsers), 1);
    }
  }

  function addMutedUser(userId) {
    if (!isMuted(userId)) {
      mutedUsers.push(userId);
    }
  }

  function firePaywallPopup() {
    var popup = SA.Widgets.Popup.build({
      showHeader: true,
      showCloseBtn: true,
      bodyContent: 'To mute more people, become a subscriber.',
      headerContent: "<h4>You have already muted 3 people</h4>",
      footerContent: '<a class="btn learn-more-mute-link" href="/checkout?service_id=pro" sasource="mute_popup">Learn More</a>',
      keyboard: true,
      backdrop: true,
      removeAfterClose: true,
      className: 'mute-popup'
    });
    popup.show();

    SA.Logger.Mone.event('PRO_required_to_mute', '', 'shown', {data: {user_id: SA.Data.User.id()}});
  }

  function onFailure(res, opt, bi, clb) {
    if ($.isFunction(opt.onFailure)) {
      opt.onFailure(opt.user, res);
    }

    if (res.code === 'pro_paywall') {
      bi.data.PRO_prompt = 'shown';

      if ($.isFunction(clb)) {
        clb()
      }
    }

    bi.data.success = false;
    SA.Logger.Mone.event(bi.type, bi.src, bi.action, {data: bi.data});
  }

  function post(opt, mute) {
    if (opt.user && $.isNumeric(opt.user.id)) {
      var postUrl, onDone, bi = $.extend({}, biDefaults, opt.bi);

      if (mute) {
        postUrl = muteUserLink;
        onDone = addMutedUser;
        bi.action = 'mute';
      } else {
        postUrl = unMuteUserLink;
        onDone = removeMutedUser;
        bi.action = 'unmute';
      }

      $.post(postUrl, {id: opt.user.id}).done(function (res) {
        if (res.status === 'failure') {
          onFailure(res, opt, bi, firePaywallPopup);
        } else {
          onDone(opt.user.id);

          if ($.isFunction(opt.onSuccess)) {
            opt.onSuccess(opt.user, res);
          }

          bi.data.success = true;
          SA.Logger.Mone.event(bi.type, bi.src, bi.action, {data: bi.data});
        }
      }).fail(function (res) {
        onFailure(res, opt, bi);
      }).always(function (user, res) {
        if ($.isFunction(opt.onAlways)) {
          opt.onAlways(opt.user, res);
        }
      });
    }
  }

  // Private functions

}(window.SA, window.jQuery));




(function (SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Widgets.MuteUser');
  scope.Button = function (opt) {
    var options,
      $container = null,
      muteUserModel = SA.Models.MuteUser,
      saUser = SA.Data.User,
      o = SA.Utils.Observer;

    var widgetClass = {
      base: 'mute-btn',
      mute: 'mute-user',
      muting: 'muting-user',
      mutingDone: 'done',
      muted: 'muted-user'
    };

    function defaultOptions() {
      return {
        me: {
          id: saUser.id()
        },
        user: null,
        container: '.mute-user',
        button: {
          selector: null,
          label: ''
        },
        showTour: false,
        bi: {type: '', source: '', action: ''},
        onRenderFinish: null,
        onMuteBefore: null,
        onMuteSuccess: null,
        onMuteFailure: onMuteFailure,
        onUnmuteBefore: null,
        onUnmuteSuccess: null,
        onUnmuteFailure: null,
        onAlways: null,
        widgetClass: null
      }
    }

    function initButton() {
      options.button.selector = ['', widgetClass.base, 'user-' + options.user.id].join('.');
    }

    function render() {
      var href = ' href="#"',
        cssClass = [widgetClass.base, 'user-' + options.user.id, options.extraCssClass || ''];

      if (options.isButton) {
        href = '';
        cssClass = ['btn btn-default'].concat(cssClass);
      }

      if (isMutedUser()) {
        cssClass.push(widgetClass.muted);
      } else {
        cssClass.push(widgetClass.mute);
      }

      getContainer().each(function () {
        $(this).append(JST['jst/widgets/mute_user_button']({
          name: options.showName ? options.user.name : '',
          cssClass: cssClass.join(' '),
          href: href
        }));
      });
    }

    function getContainer() {
      if (!$container) {
        $container = $(options.container);
      }
      return $container;
    }

    function isMutedUser() {
      return options.user.id && muteUserModel.isMuted(options.user.id);
    }

    function initEvents() {
      $(options.container + ' .' + widgetClass.base).on('click', handleMuteClick);
    }

    function onUpdateHtml(from, to) {
      $(options.button.selector).removeClass(from).addClass(to).removeAttr('disabled');
    }

    function muteUpdateHtml() {
      onUpdateHtml(widgetClass.mute, widgetClass.muted);
    }

    function unmuteUpdateHtml() {
      onUpdateHtml(widgetClass.muted, widgetClass.mute);
    }

    // Start Mute

    function handleMuteClick(e) {
      var elem = this,
        $elem = $(elem),
        user = options.user;

      e.preventDefault();
      e.stopPropagation();
      if($elem.hasClass('mute-user')){
        muteUser(user, $elem);
      } else {
        unmuteUser(user, $elem);
      }
    }

    function muteUser(user, $elem){
      muteUpdateHtml();
      execFunction(options.onMuteBefore, [$elem, user]);
      muteUserModel.mute({
        user: user,
        bi: options.bi,
        onSuccess: function (user, res) {
          $elem.addClass(widgetClass.mutingDone);
          execFunction(options.onMuteSuccess, [$elem, user]);
          unfollowUser(user.id);
          hideComments(user.id);
        },
        onFailure: function (user, res) {
          unmuteUpdateHtml();
          execFunction(options.onMuteFailure, [$elem, user]);
        },
        onAlways: function (user, res) {
          execFunction(options.onAlways, [$elem, user]);
        }
      });
    }

    function onMuteFailure($elem, user) {
      showComments(user.id);
    }

    function hideComments(userId) {
      $('.media.c-body[data-userid="' + userId + '"]').hide();
    }

    function unfollowUser(userId) {
      $('.btn.follow-btn.following-user.author-' + userId).each(function () {
        $(this).removeClass('following-user').addClass('follow-user');
      });
      $('.get-email-alerts-section').hide();
    }

    // End Mute


    // Start Unmute

    function unmuteUser(user, $elem) {
      execFunction(options.onUnmuteBefore, [$elem, user]);
      unmuteUpdateHtml();

      muteUserModel.unMute({
        user: user,
        bi: options.bi,
        onSuccess: function (user, res) {
          execFunction(options.onUnmuteSuccess, [$elem, user]);
          showComments(user.id);
        },
        onFailure: function (user, res) {
          muteUpdateHtml();
          execFunction(options.onUnmuteFailure, [$elem, user]);
        },
        onAlways: function (user, res) {
          execFunction(options.onAlways, [$elem, user]);
        }
      });
    }

    function showComments(id) {
      $('.media.c-body[data-userid="' + id + '"]').show();
    }

    // End Unmute

    function execFunction(method, params) {
      if ($.isFunction(method)) method.apply(undefined, params)
    }

    function finishRender() {
      getContainer().removeClass('hidden');

      execFunction(options.onRenderFinish);
    }

    function initMuteCallback() {
      o.subscribe('user/follow', function (e, data) {
        unmuteUpdateHtml();
        showComments(data.id);
      });
    }

    function init() {
      options = $.extend({}, defaultOptions(), opt || {});
      $.extend(widgetClass, opt.widgetClass || {});
      if (getContainer().length) {
        initButton();
        render();
        initEvents();
        initMuteCallback();

        execFunction(options.onReady);

        finishRender();
      }
    }

    if (saUser.loggedIn() && saUser.id() !== opt.user.id ) {
      init();
    } else {
      $(opt.container).remove();
    }

  };

}(window.SA, window.jQuery));
/**
 * Created by Yair Nitzan on 11/11/15.
 */


(function(SA, $) {

  "use strict";

  var scope = SA.UsingNamespace('SA.Widgets.Social');
  var postButtons = [];
  var postTo = {};
  var userConnected = {};
  var networks = ['twitter','facebook','linkedin'];
  var postMethods = {
    'twitter': post,
    'facebook': postToFacebook,
    'linkedin': post
  };
  var initialized = false;

  var initDefaultValues = function() {

    postButtons.each(function(ix,btn) {
      var network = btn.value;
      userConnected[network] = SA.Data.Cookies.get(network + '_auth')==='1' ? true : false;
      if(userConnected[network]) {
        scope.check(network, true);
        postTo[network] = true;
      }
    });

  };

  var initEvents = function() {

    postButtons.click(function(event){
      addPostNetwork(event);
    });

  };

  var addPostNetwork = function(event) {
    var btn = event.currentTarget;
    var network = btn.value;
    var checked = btn.checked;

    if (checked) {
      if (checkConnect(network)) {
        postTo[network] = true;
      } else {
        // Sets as unchecked until returns from auth popup
        scope.check(network, false);
      }
    } else {
      postTo[network] = false;
      SA.Data.Cookies.set(network + '_auth', false);
    }

  };

  var checkConnect = function(network) {

    if (userConnected[network]) return true;

    socialPopup(network);

    return false;
  };

  var socialPopup = function(network) {

    var url = '/social/authenticate_' + network;
    var popup = window.open(url, network + '_auth', 'width=500,height=300,resizable=yes');

    if (window.focus) popup.focus();

    return popup;
  };

  // Post response message to all available social networks.
  //   IN: shareContent  - text to share
  //       opt.opener    - text before shareContent
  //       opt.commentId - comment id
  //
  scope.postToAll = function(shareContent, opt) {
    if (!initialized) return;
    var totalNetworks = networks.length;
    for(var i=0; i < totalNetworks; i++) {
      var network = networks[i];
      if (postTo[network]) {
        postMethods[network](network, shareContent, opt);
      }
    }
  };

  function postToFacebook (network, shareContent, opt) {
    FB.ui({
      method: 'share',
      display: 'popup',
      quote: shareContent,
      href: SA.Widgets.Sharing.getUrlWithSourceQueryParam('facebook', false)
    }, function (response) {
    });
  }

  function post(network, message, opt) {
    if (opt === undefined) { opt = {} }
    var url = '/social/post_to_' + network;
    var msg = adjustMessage(network, message);
    var data = {
      msg: msg
    };
    if (opt.commentId) {
      data.comment_id = opt.commentId;
    }
    $.ajax({
      method: 'POST',
      url: url,
      dataType: 'json',
      data: data
    });
  }

  var adjustMessage = function(network, message) {

    var retMsg = message;

    if(network !== 'twitter') retMsg = retMsg.replace('?source=tweet', '?source=' + network);
    retMsg = retMsg.replace('dev.', '');
    retMsg = retMsg.replace('staging.', '');

    return retMsg;

  };

  scope.check = function(network, status, popup_login) {

    var $elm = $('#social-comments-' + network + ', .social-comments-' + network);

    if($elm.length) $elm.prop('checked',status);

    if(popup_login) {
      userConnected[network] = status;
      postTo[network] = status;
    }

  };

  scope.init = function () {

    postButtons = $('.pre-comment-share').find('input[type="checkbox"]');

    initDefaultValues();

    initEvents();

    $('.pre-comment-share').show();

    initialized = true;

  };

}(SA, $));
/*!
 * Cropper v2.0.1
 * https://github.com/fengyuanchen/cropper
 *
 * Copyright (c) 2014-2015 Fengyuan Chen and contributors
 * Released under the MIT license
 *
 * Date: 2015-11-18T03:13:47.241Z
 */

!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t("object"==typeof exports?require("jquery"):jQuery)}(function(t){"use strict";function i(t){return"number"==typeof t&&!isNaN(t)}function e(t){return"undefined"==typeof t}function s(t,e){var s=[];return i(e)&&s.push(e),s.slice.apply(t,s)}function h(t,i){var e=s(arguments,2);return function(){return t.apply(i,e.concat(s(arguments)))}}function o(t){var i=t.match(/^(https?:)\/\/([^\:\/\?#]+):?(\d*)/i);return i&&(i[1]!==f.protocol||i[2]!==f.hostname||i[3]!==f.port)}function a(t){var i="timestamp="+(new Date).getTime();return t+(-1===t.indexOf("?")?"?":"&")+i}function n(t){return t?' crossOrigin="'+t+'"':""}function r(t,i){var e;return t.naturalWidth?i(t.naturalWidth,t.naturalHeight):(e=document.createElement("img"),e.onload=function(){i(this.width,this.height)},void(e.src=t.src))}function p(t){var e=[],s=t.rotate,h=t.scaleX,o=t.scaleY;return i(s)&&e.push("rotate("+s+"deg)"),i(h)&&i(o)&&e.push("scale("+h+","+o+")"),e.length?e.join(" "):"none"}function l(t,i){var e,s,h=at(t.degree)%180,o=(h>90?180-h:h)*Math.PI/180,a=nt(o),n=rt(o),r=t.width,p=t.height,l=t.aspectRatio;return i?(e=r/(n+a/l),s=e/l):(e=r*n+p*a,s=r*a+p*n),{width:e,height:s}}function d(e,s){var h,o,a,n=t("<canvas>")[0],r=n.getContext("2d"),p=0,d=0,c=s.naturalWidth,g=s.naturalHeight,u=s.rotate,f=s.scaleX,m=s.scaleY,v=i(f)&&i(m)&&(1!==f||1!==m),w=i(u)&&0!==u,x=w||v,C=c,b=g;return v&&(h=c/2,o=g/2),w&&(a=l({width:c,height:g,degree:u}),C=a.width,b=a.height,h=a.width/2,o=a.height/2),n.width=C,n.height=b,x&&(p=-c/2,d=-g/2,r.save(),r.translate(h,o)),w&&r.rotate(u*Math.PI/180),v&&r.scale(f,m),r.drawImage(e,p,d,c,g),x&&r.restore(),n}function c(i,e){this.$element=t(i),this.options=t.extend({},c.DEFAULTS,t.isPlainObject(e)&&e),this.isLoaded=!1,this.isBuilt=!1,this.isCompleted=!1,this.isRotated=!1,this.isCropped=!1,this.isDisabled=!1,this.isReplaced=!1,this.isLimited=!1,this.isImg=!1,this.originalUrl="",this.crossOrigin="",this.canvas=null,this.cropBox=null,this.init()}var g=t(window),u=t(document),f=window.location,m="cropper",v="cropper-modal",w="cropper-hide",x="cropper-hidden",C="cropper-invisible",b="cropper-move",B="cropper-crop",D="cropper-disabled",y="cropper-bg",$="mousedown touchstart pointerdown MSPointerDown",L="mousemove touchmove pointermove MSPointerMove",T="mouseup touchend touchcancel pointerup pointercancel MSPointerUp MSPointerCancel",M="wheel mousewheel DOMMouseScroll",W="dblclick",Y="load."+m,X="error."+m,R="resize."+m,k="build."+m,z="built."+m,H="cropstart."+m,O="cropmove."+m,P="cropend."+m,E="crop."+m,I="zoom."+m,F=/^(e|w|s|n|se|sw|ne|nw|all|crop|move|zoom)$/,S="preview",j="action",A="e",N="w",U="s",_="n",q="se",Z="sw",K="ne",Q="nw",G="all",J="crop",V="move",tt="zoom",it="none",et=t.isFunction(t("<canvas>")[0].getContext),st=Number,ht=Math.min,ot=Math.max,at=Math.abs,nt=Math.sin,rt=Math.cos,pt=Math.sqrt,lt=Math.round,dt={version:"2.0.1"};t.extend(dt,{init:function(){var t,i=this.$element;if(i.is("img")){if(this.isImg=!0,this.originalUrl=t=i.attr("src"),!t)return;t=i.prop("src")}else i.is("canvas")&&et&&(t=i[0].toDataURL());this.load(t)},trigger:function(i,e){var s=t.Event(i,e);return this.$element.trigger(s),s},load:function(i){var e,s,h=this.options,r=this.$element,p="";i&&(this.url=i,r.one(k,h.build),this.trigger(k).isDefaultPrevented()||(h.checkCrossOrigin&&o(i)&&(p=r.prop("crossOrigin"),p||(p="anonymous",e=a(i))),this.crossOrigin=p,this.$clone=s=t("<img"+n(p)+' src="'+(e||i)+'">'),this.isImg?r[0].complete?this.start():r.one(Y,t.proxy(this.start,this)):s.one(Y,t.proxy(this.start,this)).one(X,t.proxy(this.stop,this)).addClass(w).insertAfter(r)))},start:function(){var i=this.$element,e=this.$clone;this.isImg||(e.off(X,this.stop),i=e),r(i[0],t.proxy(function(t,i){this.image={naturalWidth:t,naturalHeight:i,aspectRatio:t/i},this.isLoaded=!0,this.build()},this))},stop:function(){this.$clone.remove(),this.$clone=null}}),t.extend(dt,{build:function(){var i,e,s,h=this.options,o=this.$element,a=this.$clone;this.isLoaded&&(this.isBuilt&&this.unbuild(),this.$container=o.parent(),this.$cropper=i=t(c.TEMPLATE),this.$canvas=i.find(".cropper-canvas").append(a),this.$dragBox=i.find(".cropper-drag-box"),this.$cropBox=e=i.find(".cropper-crop-box"),this.$viewBox=i.find(".cropper-view-box"),this.$face=s=e.find(".cropper-face"),o.addClass(x).after(i),this.isImg||a.removeClass(w),this.initPreview(),this.bind(),h.aspectRatio=ot(0,h.aspectRatio)||NaN,h.viewMode=ot(0,ht(3,lt(h.viewMode)))||0,h.autoCrop?(this.isCropped=!0,h.modal&&this.$dragBox.addClass(v)):e.addClass(x),h.guides||e.find(".cropper-dashed").addClass(x),h.center||e.find(".cropper-center").addClass(x),h.cropBoxMovable&&s.addClass(b).data(j,G),h.highlight||s.addClass(C),h.background&&i.addClass(y),h.cropBoxResizable||e.find(".cropper-line, .cropper-point").addClass(x),this.setDragMode(h.dragMode),this.render(),this.isBuilt=!0,this.setData(h.data),o.one(z,h.built),setTimeout(t.proxy(function(){this.trigger(z),this.isCompleted=!0},this),0))},unbuild:function(){this.isBuilt&&(this.isBuilt=!1,this.initialImage=null,this.initialCanvas=null,this.initialCropBox=null,this.container=null,this.canvas=null,this.cropBox=null,this.unbind(),this.resetPreview(),this.$preview=null,this.$viewBox=null,this.$cropBox=null,this.$dragBox=null,this.$canvas=null,this.$container=null,this.$cropper.remove(),this.$cropper=null)}}),t.extend(dt,{render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.isCropped&&this.renderCropBox()},initContainer:function(){var t=this.options,i=this.$element,e=this.$container,s=this.$cropper;s.addClass(x),i.removeClass(x),s.css(this.container={width:ot(e.width(),st(t.minContainerWidth)||200),height:ot(e.height(),st(t.minContainerHeight)||100)}),i.addClass(x),s.removeClass(x)},initCanvas:function(){var i=this.options.viewMode,e=this.container,s=e.width,h=e.height,o=this.image,a=o.aspectRatio,n={naturalWidth:o.naturalWidth,naturalHeight:o.naturalHeight,aspectRatio:a,width:s,height:h};h*a>s?3===i?n.width=h*a:n.height=s/a:3===i?n.height=s/a:n.width=h*a,n.oldLeft=n.left=(s-n.width)/2,n.oldTop=n.top=(h-n.height)/2,this.canvas=n,this.isLimited=1===i||2===i,this.limitCanvas(!0,!0),this.initialImage=t.extend({},o),this.initialCanvas=t.extend({},n)},limitCanvas:function(t,i){var e,s,h,o,a=this.options,n=a.viewMode,r=this.container,p=r.width,l=r.height,d=this.canvas,c=d.aspectRatio,g=this.cropBox,u=this.isCropped&&g;t&&(e=st(a.minCanvasWidth)||0,s=st(a.minCanvasHeight)||0,n&&(n>1?(e=ot(e,p),s=ot(s,l),3===n&&(s*c>e?e=s*c:s=e/c)):e?e=ot(e,u?g.width:0):s?s=ot(s,u?g.height:0):u&&(e=g.width,s=g.height,s*c>e?e=s*c:s=e/c)),e&&s?s*c>e?s=e/c:e=s*c:e?s=e/c:s&&(e=s*c),d.minWidth=e,d.minHeight=s,d.maxWidth=1/0,d.maxHeight=1/0),i&&(n?(h=p-d.width,o=l-d.height,d.minLeft=ht(0,h),d.minTop=ht(0,o),d.maxLeft=ot(0,h),d.maxTop=ot(0,o),u&&this.isLimited&&(d.minLeft=ht(g.left,g.left+g.width-d.width),d.minTop=ht(g.top,g.top+g.height-d.height),d.maxLeft=g.left,d.maxTop=g.top,2===n&&(d.width>=p&&(d.minLeft=ht(0,h),d.maxLeft=ot(0,h)),d.height>=l&&(d.minTop=ht(0,o),d.maxTop=ot(0,o))))):(d.minLeft=-d.width,d.minTop=-d.height,d.maxLeft=p,d.maxTop=l))},renderCanvas:function(t){var i,e,s=this.canvas,h=this.image,o=h.rotate,a=h.naturalWidth,n=h.naturalHeight;this.isRotated&&(this.isRotated=!1,e=l({width:h.width,height:h.height,degree:o}),i=e.width/e.height,i!==s.aspectRatio&&(s.left-=(e.width-s.width)/2,s.top-=(e.height-s.height)/2,s.width=e.width,s.height=e.height,s.aspectRatio=i,s.naturalWidth=a,s.naturalHeight=n,o%180&&(e=l({width:a,height:n,degree:o}),s.naturalWidth=e.width,s.naturalHeight=e.height),this.limitCanvas(!0,!1))),(s.width>s.maxWidth||s.width<s.minWidth)&&(s.left=s.oldLeft),(s.height>s.maxHeight||s.height<s.minHeight)&&(s.top=s.oldTop),s.width=ht(ot(s.width,s.minWidth),s.maxWidth),s.height=ht(ot(s.height,s.minHeight),s.maxHeight),this.limitCanvas(!1,!0),s.oldLeft=s.left=ht(ot(s.left,s.minLeft),s.maxLeft),s.oldTop=s.top=ht(ot(s.top,s.minTop),s.maxTop),this.$canvas.css({width:s.width,height:s.height,left:s.left,top:s.top}),this.renderImage(),this.isCropped&&this.isLimited&&this.limitCropBox(!0,!0),t&&this.output()},renderImage:function(i){var e,s=this.canvas,h=this.image;h.rotate&&(e=l({width:s.width,height:s.height,degree:h.rotate,aspectRatio:h.aspectRatio},!0)),t.extend(h,e?{width:e.width,height:e.height,left:(s.width-e.width)/2,top:(s.height-e.height)/2}:{width:s.width,height:s.height,left:0,top:0}),this.$clone.css({width:h.width,height:h.height,marginLeft:h.left,marginTop:h.top,transform:p(h)}),i&&this.output()},initCropBox:function(){var i=this.options,e=this.canvas,s=i.aspectRatio,h=st(i.autoCropArea)||.8,o={width:e.width,height:e.height};s&&(e.height*s>e.width?o.height=o.width/s:o.width=o.height*s),this.cropBox=o,this.limitCropBox(!0,!0),o.width=ht(ot(o.width,o.minWidth),o.maxWidth),o.height=ht(ot(o.height,o.minHeight),o.maxHeight),o.width=ot(o.minWidth,o.width*h),o.height=ot(o.minHeight,o.height*h),o.oldLeft=o.left=e.left+(e.width-o.width)/2,o.oldTop=o.top=e.top+(e.height-o.height)/2,this.initialCropBox=t.extend({},o)},limitCropBox:function(t,i){var e,s,h,o,a=this.options,n=a.aspectRatio,r=this.container,p=r.width,l=r.height,d=this.canvas,c=this.cropBox,g=this.isLimited;t&&(e=st(a.minCropBoxWidth)||0,s=st(a.minCropBoxHeight)||0,e=ht(e,p),s=ht(s,l),h=ht(p,g?d.width:p),o=ht(l,g?d.height:l),n&&(e&&s?s*n>e?s=e/n:e=s*n:e?s=e/n:s&&(e=s*n),o*n>h?o=h/n:h=o*n),c.minWidth=ht(e,h),c.minHeight=ht(s,o),c.maxWidth=h,c.maxHeight=o),i&&(g?(c.minLeft=ot(0,d.left),c.minTop=ot(0,d.top),c.maxLeft=ht(p,d.left+d.width)-c.width,c.maxTop=ht(l,d.top+d.height)-c.height):(c.minLeft=0,c.minTop=0,c.maxLeft=p-c.width,c.maxTop=l-c.height))},renderCropBox:function(){var t=this.options,i=this.container,e=i.width,s=i.height,h=this.cropBox;(h.width>h.maxWidth||h.width<h.minWidth)&&(h.left=h.oldLeft),(h.height>h.maxHeight||h.height<h.minHeight)&&(h.top=h.oldTop),h.width=ht(ot(h.width,h.minWidth),h.maxWidth),h.height=ht(ot(h.height,h.minHeight),h.maxHeight),this.limitCropBox(!1,!0),h.oldLeft=h.left=ht(ot(h.left,h.minLeft),h.maxLeft),h.oldTop=h.top=ht(ot(h.top,h.minTop),h.maxTop),t.movable&&t.cropBoxMovable&&this.$face.data(j,h.width===e&&h.height===s?V:G),this.$cropBox.css({width:h.width,height:h.height,left:h.left,top:h.top}),this.isCropped&&this.isLimited&&this.limitCanvas(!0,!0),this.isDisabled||this.output()},output:function(){this.preview(),this.isCompleted?this.trigger(E,this.getData()):this.isBuilt||this.$element.one(z,t.proxy(function(){this.trigger(E,this.getData())},this))}}),t.extend(dt,{initPreview:function(){var i=n(this.crossOrigin),e=this.url;this.$preview=t(this.options.preview),this.$viewBox.html("<img"+i+' src="'+e+'">'),this.$preview.each(function(){var s=t(this);s.data(S,{width:s.width(),height:s.height(),html:s.html()}),s.html("<img"+i+' src="'+e+'" style="display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;">')})},resetPreview:function(){this.$preview.each(function(){var i=t(this),e=i.data(S);i.css({width:e.width,height:e.height}).html(e.html).removeData(S)})},preview:function(){var i=this.image,e=this.canvas,s=this.cropBox,h=s.width,o=s.height,a=i.width,n=i.height,r=s.left-e.left-i.left,l=s.top-e.top-i.top;this.isCropped&&!this.isDisabled&&(this.$viewBox.find("img").css({width:a,height:n,marginLeft:-r,marginTop:-l,transform:p(i)}),this.$preview.each(function(){var e=t(this),s=e.data(S),d=s.width,c=s.height,g=d,u=c,f=1;h&&(f=d/h,u=o*f),o&&u>c&&(f=c/o,g=h*f,u=c),e.css({width:g,height:u}).find("img").css({width:a*f,height:n*f,marginLeft:-r*f,marginTop:-l*f,transform:p(i)})}))}}),t.extend(dt,{bind:function(){var i=this.options,e=this.$element,s=this.$cropper;t.isFunction(i.cropstart)&&e.on(H,i.cropstart),t.isFunction(i.cropmove)&&e.on(O,i.cropmove),t.isFunction(i.cropend)&&e.on(P,i.cropend),t.isFunction(i.crop)&&e.on(E,i.crop),t.isFunction(i.zoom)&&e.on(I,i.zoom),s.on($,t.proxy(this.cropStart,this)),i.zoomable&&i.zoomOnWheel&&s.on(M,t.proxy(this.wheel,this)),i.toggleDragModeOnDblclick&&s.on(W,t.proxy(this.dblclick,this)),u.on(L,this._cropMove=h(this.cropMove,this)).on(T,this._cropEnd=h(this.cropEnd,this)),i.responsive&&g.on(R,this._resize=h(this.resize,this))},unbind:function(){var i=this.options,e=this.$element,s=this.$cropper;t.isFunction(i.cropstart)&&e.off(H,i.cropstart),t.isFunction(i.cropmove)&&e.off(O,i.cropmove),t.isFunction(i.cropend)&&e.off(P,i.cropend),t.isFunction(i.crop)&&e.off(E,i.crop),t.isFunction(i.zoom)&&e.off(I,i.zoom),s.off($,this.cropStart),i.zoomable&&i.zoomOnWheel&&s.off(M,this.wheel),i.toggleDragModeOnDblclick&&s.off(W,this.dblclick),u.off(L,this._cropMove).off(T,this._cropEnd),i.responsive&&g.off(R,this._resize)}}),t.extend(dt,{resize:function(){var i,e,s,h=this.$container,o=this.container;!this.isDisabled&&o&&(s=h.width()/o.width,(1!==s||h.height()!==o.height)&&(i=this.getCanvasData(),e=this.getCropBoxData(),this.render(),this.setCanvasData(t.each(i,function(t,e){i[t]=e*s})),this.setCropBoxData(t.each(e,function(t,i){e[t]=i*s}))))},dblclick:function(){this.isDisabled||(this.$dragBox.hasClass(B)?this.setDragMode(V):this.setDragMode(J))},wheel:function(t){var i=t.originalEvent,e=i||t,s=st(this.options.wheelZoomRatio)||.1,h=1;this.isDisabled||(t.preventDefault(),e.deltaY?h=e.deltaY>0?1:-1:e.wheelDelta?h=-e.wheelDelta/120:e.detail&&(h=e.detail>0?1:-1),this.zoom(-h*s,i))},cropStart:function(i){var e,s,h=this.options,o=i.originalEvent,a=o&&o.touches,n=i;if(!this.isDisabled){if(a){if(e=a.length,e>1){if(!h.zoomable||!h.zoomOnTouch||2!==e)return;n=a[1],this.startX2=n.pageX,this.startY2=n.pageY,s=tt}n=a[0]}if(s=s||t(n.target).data(j),F.test(s)){if(this.trigger(H,{originalEvent:o,action:s}).isDefaultPrevented())return;i.preventDefault(),this.action=s,this.cropping=!1,this.startX=n.pageX||o&&o.pageX,this.startY=n.pageY||o&&o.pageY,s===J&&(this.cropping=!0,this.$dragBox.addClass(v))}}},cropMove:function(t){var i,e=this.options,s=t.originalEvent,h=s&&s.touches,o=t,a=this.action;if(!this.isDisabled){if(h){if(i=h.length,i>1){if(!e.zoomable||!e.zoomOnTouch||2!==i)return;o=h[1],this.endX2=o.pageX,this.endY2=o.pageY}o=h[0]}if(a){if(this.trigger(O,{originalEvent:s,action:a}).isDefaultPrevented())return;t.preventDefault(),this.endX=o.pageX||s&&s.pageX,this.endY=o.pageY||s&&s.pageY,this.change(o.shiftKey,a===tt?s:null)}}},cropEnd:function(t){var i=t.originalEvent,e=this.action;this.isDisabled||e&&(t.preventDefault(),this.cropping&&(this.cropping=!1,this.$dragBox.toggleClass(v,this.isCropped&&this.options.modal)),this.action="",this.trigger(P,{originalEvent:i,action:e}))}}),t.extend(dt,{change:function(t,i){var e,s,h=this.options,o=h.aspectRatio,a=this.action,n=this.container,r=this.canvas,p=this.cropBox,l=p.width,d=p.height,c=p.left,g=p.top,u=c+l,f=g+d,m=0,v=0,w=n.width,C=n.height,b=!0;switch(!o&&t&&(o=l&&d?l/d:1),this.limited&&(m=p.minLeft,v=p.minTop,w=m+ht(n.width,r.width),C=v+ht(n.height,r.height)),s={x:this.endX-this.startX,y:this.endY-this.startY},o&&(s.X=s.y*o,s.Y=s.x/o),a){case G:c+=s.x,g+=s.y;break;case A:if(s.x>=0&&(u>=w||o&&(v>=g||f>=C))){b=!1;break}l+=s.x,o&&(d=l/o,g-=s.Y/2),0>l&&(a=N,l=0);break;case _:if(s.y<=0&&(v>=g||o&&(m>=c||u>=w))){b=!1;break}d-=s.y,g+=s.y,o&&(l=d*o,c+=s.X/2),0>d&&(a=U,d=0);break;case N:if(s.x<=0&&(m>=c||o&&(v>=g||f>=C))){b=!1;break}l-=s.x,c+=s.x,o&&(d=l/o,g+=s.Y/2),0>l&&(a=A,l=0);break;case U:if(s.y>=0&&(f>=C||o&&(m>=c||u>=w))){b=!1;break}d+=s.y,o&&(l=d*o,c-=s.X/2),0>d&&(a=_,d=0);break;case K:if(o){if(s.y<=0&&(v>=g||u>=w)){b=!1;break}d-=s.y,g+=s.y,l=d*o}else s.x>=0?w>u?l+=s.x:s.y<=0&&v>=g&&(b=!1):l+=s.x,s.y<=0?g>v&&(d-=s.y,g+=s.y):(d-=s.y,g+=s.y);0>l&&0>d?(a=Z,d=0,l=0):0>l?(a=Q,l=0):0>d&&(a=q,d=0);break;case Q:if(o){if(s.y<=0&&(v>=g||m>=c)){b=!1;break}d-=s.y,g+=s.y,l=d*o,c+=s.X}else s.x<=0?c>m?(l-=s.x,c+=s.x):s.y<=0&&v>=g&&(b=!1):(l-=s.x,c+=s.x),s.y<=0?g>v&&(d-=s.y,g+=s.y):(d-=s.y,g+=s.y);0>l&&0>d?(a=q,d=0,l=0):0>l?(a=K,l=0):0>d&&(a=Z,d=0);break;case Z:if(o){if(s.x<=0&&(m>=c||f>=C)){b=!1;break}l-=s.x,c+=s.x,d=l/o}else s.x<=0?c>m?(l-=s.x,c+=s.x):s.y>=0&&f>=C&&(b=!1):(l-=s.x,c+=s.x),s.y>=0?C>f&&(d+=s.y):d+=s.y;0>l&&0>d?(a=K,d=0,l=0):0>l?(a=q,l=0):0>d&&(a=Q,d=0);break;case q:if(o){if(s.x>=0&&(u>=w||f>=C)){b=!1;break}l+=s.x,d=l/o}else s.x>=0?w>u?l+=s.x:s.y>=0&&f>=C&&(b=!1):l+=s.x,s.y>=0?C>f&&(d+=s.y):d+=s.y;0>l&&0>d?(a=Q,d=0,l=0):0>l?(a=Z,l=0):0>d&&(a=K,d=0);break;case V:this.move(s.x,s.y),b=!1;break;case tt:this.zoom(function(t,i,e,s){var h=pt(t*t+i*i),o=pt(e*e+s*s);return(o-h)/h}(at(this.startX-this.startX2),at(this.startY-this.startY2),at(this.endX-this.endX2),at(this.endY-this.endY2)),i),this.startX2=this.endX2,this.startY2=this.endY2,b=!1;break;case J:if(!s.x||!s.y){b=!1;break}e=this.$cropper.offset(),c=this.startX-e.left,g=this.startY-e.top,l=p.minWidth,d=p.minHeight,s.x>0?a=s.y>0?q:K:s.x<0&&(c-=l,a=s.y>0?Z:Q),s.y<0&&(g-=d),this.isCropped||(this.$cropBox.removeClass(x),this.isCropped=!0,this.limited&&this.limitCropBox(!0,!0))}b&&(p.width=l,p.height=d,p.left=c,p.top=g,this.action=a,this.renderCropBox()),this.startX=this.endX,this.startY=this.endY}}),t.extend(dt,{crop:function(){this.isBuilt&&!this.isDisabled&&(this.isCropped||(this.isCropped=!0,this.limitCropBox(!0,!0),this.options.modal&&this.$dragBox.addClass(v),this.$cropBox.removeClass(x)),this.setCropBoxData(this.initialCropBox))},reset:function(){this.isBuilt&&!this.isDisabled&&(this.image=t.extend({},this.initialImage),this.canvas=t.extend({},this.initialCanvas),this.cropBox=t.extend({},this.initialCropBox),this.renderCanvas(),this.isCropped&&this.renderCropBox())},clear:function(){this.isCropped&&!this.isDisabled&&(t.extend(this.cropBox,{left:0,top:0,width:0,height:0}),this.isCropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),this.$dragBox.removeClass(v),this.$cropBox.addClass(x))},replace:function(t){!this.isDisabled&&t&&(this.isImg&&(this.isReplaced=!0,this.$element.attr("src",t)),this.options.data=null,this.load(t))},enable:function(){this.isBuilt&&(this.isDisabled=!1,this.$cropper.removeClass(D))},disable:function(){this.isBuilt&&(this.isDisabled=!0,this.$cropper.addClass(D))},destroy:function(){var t=this.$element;this.isLoaded?(this.isImg&&this.isReplaced&&t.attr("src",this.originalUrl),this.unbuild(),t.removeClass(x)):this.isImg?t.off(Y,this.start):this.$clone&&this.$clone.remove(),t.removeData(m)},move:function(t,i){var s=this.canvas;this.moveTo(e(t)?t:s.left+st(t),e(i)?i:s.top+st(i))},moveTo:function(t,s){var h=this.canvas,o=!1;e(s)&&(s=t),t=st(t),s=st(s),this.isBuilt&&!this.isDisabled&&this.options.movable&&(i(t)&&(h.left=t,o=!0),i(s)&&(h.top=s,o=!0),o&&this.renderCanvas(!0))},zoom:function(t,i){var e=this.canvas;t=st(t),t=0>t?1/(1-t):1+t,this.zoomTo(e.width*t/e.naturalWidth,i)},zoomTo:function(t,i){var e,s,h=this.options,o=this.canvas,a=o.width,n=o.height,r=o.naturalWidth,p=o.naturalHeight;if(t=st(t),t>=0&&this.isBuilt&&!this.isDisabled&&h.zoomable){if(e=r*t,s=p*t,this.trigger(I,{originalEvent:i,oldRatio:a/r,ratio:e/r}).isDefaultPrevented())return;o.left-=(e-a)/2,o.top-=(s-n)/2,o.width=e,o.height=s,this.renderCanvas(!0)}},rotate:function(t){this.rotateTo((this.image.rotate||0)+st(t))},rotateTo:function(t){t=st(t),i(t)&&this.isBuilt&&!this.isDisabled&&this.options.rotatable&&(this.image.rotate=t%360,this.isRotated=!0,this.renderCanvas(!0))},scale:function(t,s){var h=this.image,o=!1;e(s)&&(s=t),t=st(t),s=st(s),this.isBuilt&&!this.isDisabled&&this.options.scalable&&(i(t)&&(h.scaleX=t,o=!0),i(s)&&(h.scaleY=s,o=!0),o&&this.renderImage(!0))},scaleX:function(t){var e=this.image.scaleY;this.scale(t,i(e)?e:1)},scaleY:function(t){var e=this.image.scaleX;this.scale(i(e)?e:1,t)},getData:function(i){var e,s,h=this.options,o=this.image,a=this.canvas,n=this.cropBox;return this.isBuilt&&this.isCropped?(s={x:n.left-a.left,y:n.top-a.top,width:n.width,height:n.height},e=o.width/o.naturalWidth,t.each(s,function(t,h){h/=e,s[t]=i?lt(h):h})):s={x:0,y:0,width:0,height:0},h.rotatable&&(s.rotate=o.rotate||0),h.scalable&&(s.scaleX=o.scaleX||1,s.scaleY=o.scaleY||1),s},setData:function(e){var s,h,o,a=this.options,n=this.image,r=this.canvas,p={};t.isFunction(e)&&(e=e.call(this.element)),this.isBuilt&&!this.isDisabled&&t.isPlainObject(e)&&(a.rotatable&&i(e.rotate)&&e.rotate!==n.rotate&&(n.rotate=e.rotate,this.isRotated=s=!0),a.scalable&&(i(e.scaleX)&&e.scaleX!==n.scaleX&&(n.scaleX=e.scaleX,h=!0),i(e.scaleY)&&e.scaleY!==n.scaleY&&(n.scaleY=e.scaleY,h=!0)),s?this.renderCanvas():h&&this.renderImage(),o=n.width/n.naturalWidth,i(e.x)&&(p.left=e.x*o+r.left),i(e.y)&&(p.top=e.y*o+r.top),i(e.width)&&(p.width=e.width*o),i(e.height)&&(p.height=e.height*o),this.setCropBoxData(p))},getContainerData:function(){return this.isBuilt?this.container:{}},getImageData:function(){return this.isLoaded?this.image:{}},getCanvasData:function(){var i=this.canvas,e={};return this.isBuilt&&t.each(["left","top","width","height","naturalWidth","naturalHeight"],function(t,s){e[s]=i[s]}),e},setCanvasData:function(e){var s=this.canvas,h=s.aspectRatio;t.isFunction(e)&&(e=e.call(this.$element)),this.isBuilt&&!this.isDisabled&&t.isPlainObject(e)&&(i(e.left)&&(s.left=e.left),i(e.top)&&(s.top=e.top),i(e.width)?(s.width=e.width,s.height=e.width/h):i(e.height)&&(s.height=e.height,s.width=e.height*h),this.renderCanvas(!0))},getCropBoxData:function(){var t,i=this.cropBox;return this.isBuilt&&this.isCropped&&(t={left:i.left,top:i.top,width:i.width,height:i.height}),t||{}},setCropBoxData:function(e){var s,h,o=this.cropBox,a=this.options.aspectRatio;t.isFunction(e)&&(e=e.call(this.$element)),this.isBuilt&&this.isCropped&&!this.isDisabled&&t.isPlainObject(e)&&(i(e.left)&&(o.left=e.left),i(e.top)&&(o.top=e.top),i(e.width)&&e.width!==o.width&&(s=!0,o.width=e.width),i(e.height)&&e.height!==o.height&&(h=!0,o.height=e.height),a&&(s?o.height=o.width/a:h&&(o.width=o.height*a)),this.renderCropBox())},getCroppedCanvas:function(i){var e,s,h,o,a,n,r,p,l,c,g;return this.isBuilt&&this.isCropped&&et?(t.isPlainObject(i)||(i={}),g=this.getData(),e=g.width,s=g.height,p=e/s,t.isPlainObject(i)&&(a=i.width,n=i.height,a?(n=a/p,r=a/e):n&&(a=n*p,r=n/s)),h=lt(a||e),o=lt(n||s),l=t("<canvas>")[0],l.width=h,l.height=o,c=l.getContext("2d"),i.fillColor&&(c.fillStyle=i.fillColor,c.fillRect(0,0,h,o)),c.drawImage.apply(c,function(){var t,i,h,o,a,n,p=d(this.$clone[0],this.image),l=p.width,c=p.height,u=[p],f=g.x,m=g.y;return-e>=f||f>l?f=t=h=a=0:0>=f?(h=-f,f=0,t=a=ht(l,e+f)):l>=f&&(h=0,t=a=ht(e,l-f)),0>=t||-s>=m||m>c?m=i=o=n=0:0>=m?(o=-m,m=0,i=n=ht(c,s+m)):c>=m&&(o=0,i=n=ht(s,c-m)),u.push(f,m,t,i),r&&(h*=r,o*=r,a*=r,n*=r),a>0&&n>0&&u.push(h,o,a,n),u}.call(this)),l):void 0},setAspectRatio:function(t){var i=this.options;this.isDisabled||e(t)||(i.aspectRatio=ot(0,t)||NaN,this.isBuilt&&(this.initCropBox(),this.isCropped&&this.renderCropBox()))},setDragMode:function(t){var i,e,s=this.options;this.isLoaded&&!this.isDisabled&&(i=t===J,e=s.movable&&t===V,t=i||e?t:it,this.$dragBox.data(j,t).toggleClass(B,i).toggleClass(b,e),s.cropBoxMovable||this.$face.data(j,t).toggleClass(B,i).toggleClass(b,e))}}),t.extend(c.prototype,dt),c.DEFAULTS={viewMode:0,dragMode:"crop",aspectRatio:NaN,data:null,preview:"",responsive:!0,checkCrossOrigin:0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,build:null,built:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},c.setDefaults=function(i){t.extend(c.DEFAULTS,i)},c.TEMPLATE='<div class="cropper-container"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-action="e"></span><span class="cropper-line line-n" data-action="n"></span><span class="cropper-line line-w" data-action="w"></span><span class="cropper-line line-s" data-action="s"></span><span class="cropper-point point-e" data-action="e"></span><span class="cropper-point point-n" data-action="n"></span><span class="cropper-point point-w" data-action="w"></span><span class="cropper-point point-s" data-action="s"></span><span class="cropper-point point-ne" data-action="ne"></span><span class="cropper-point point-nw" data-action="nw"></span><span class="cropper-point point-sw" data-action="sw"></span><span class="cropper-point point-se" data-action="se"></span></div></div>',c.other=t.fn.cropper,t.fn.cropper=function(i){var h,o=s(arguments,1);return this.each(function(){var e,s=t(this),a=s.data(m);if(!a){if(/destroy/.test(i))return;s.data(m,a=new c(this,i))}"string"==typeof i&&t.isFunction(e=a[i])&&(h=e.apply(a,o))}),e(h)?this:h},t.fn.cropper.Constructor=c,t.fn.cropper.setDefaults=c.setDefaults,t.fn.cropper.noConflict=function(){return t.fn.cropper=c.other,this}});
(function(SA, $){

  'use strict';

  var scope = SA.UsingNamespace('SA.Models.UploadUserImagePopUp');

  var ajaxCreateProfilePictures = function(opt) {
    $.ajax({
      method: 'get',
      url: '/account/ajax_create_profile_pictures',
      data: {
        id: opt.userId,
        width: opt.width,
        height: opt.height,
        x1: opt.x1,
        y1: opt.y1,
        x2: opt.x2,
        y2: opt.y2
      },
      dataType: 'json'
    }).done(function(response) {
      if($.isFunction(opt.onSuccess)) {
        opt.onSuccess(response, opt);
      }
    }).fail(function(response) {
      if($.isFunction(opt.onFailure)) {
        opt.functionName = 'ajaxCreateProfilePictures';
        opt.onFailure(response, opt);
      }
    });
  };

  var ajaxRemoveProfilePictures = function(opt) {
    $.ajax({
      method: 'get',
      url: '/account/ajax_remove_profile_pictures',
      data: {
        id: opt.userId
      },
      dataType: 'json'
    }).done(function(response) {
      if($.isFunction(opt.onSuccess)) {
        opt.onSuccess(response, opt);
      }
    }).fail(function(response) {
      if($.isFunction(opt.onFailure)) {
        opt.msg = 'Remove picture failed!';
        opt.functionName = 'ajaxCreateProfilePictures';
        opt.onFailure(response, opt);
      }
    });
  };

  scope.ajaxCreateProfilePictures= function(data){
    data = data || {};
    if(data.userId) {
      return ajaxCreateProfilePictures(data);
    }
  };

  scope.ajaxRemoveProfilePictures= function(data){
    data = data || {};
    if(data.userId) {
      return ajaxRemoveProfilePictures(data);
    }
  };

}(window.SA, window.jQuery));
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/upload_user_image/body"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div class="modal-upload-dialog" id="sa-upload-user-image-modal" >\n  <div class="modal-content">\n    <div class="modal-header">\n      <button type="button" class="close"><span></span></button>\n      <h4 id="upload_user_image_header"><strong>',  header ,'</strong></h4>\n    </div>\n    <div class="modal-upload-picture-body">\n      <div class="upload-picture-sa-loader hidden"></div>\n      <span id="popup_note_message" class="note error"></span>\n      <div id ="step1">\n        <div class="current-profile-image">\n          <div id="current_profile_image_cont"  >\n            <img  id="current_profile_image" src="',  picture_url ,'" />\n          </div>\n        </div>\n        <div class="upload-file-wrapper">\n          <form id="image_profile_form" class="image-profile-form" method="post" action="/account/preview_for_profile_picture" enctype="multipart/form-data" target="iframe_for_image">\n            <label for="upload_file">Browse...</label>\n            <input type="file" class="text" name="upload[file]" id="upload_file" accept=".jpg, .jpeg, .bmp, .png, .gif">\n          </form>\n          <iframe class="hidden" src="about:blank" name="iframe_for_image" ></iframe>\n        </div>\n      </div>\n      <div id="step2" class="hidden" >\n        <div class="crop-container">\n          <img  id="cropper">\n        </div>\n        <div class="preview-wrapper-container">\n          <div class="preview-wrapper">\n            <span class="preview-header">Preview</span>\n            <div class="preview-profile-div hidden"></div>\n          </div>\n        </div>\n        <div>\n          <input type="button" value="Remove" id="remove_picture" />\n          <span id="new_picture_name"></span>\n        </div>\n      </div>\n    </div>\n    <div class="modal-footer">\n      <div class="image-guide-line" >\n        <label>Maximum size of <strong>10MB.</strong> Image-file formats: JPG, BMP or PNG.<br/>Do not upload images containing celebrities, nudity or copyrighted images.</label>\n      </div>\n      <div class="pull-right">\n        <button type="button" id="save_image" class="btn orange-btn send-btn">Save</button>\n      </div>\n      <div class="clearfix"></div>\n    </div>\n  </div>\n</div>\n');}return __p.join('');};
}).call(this);





(function(SA, $){

  "use strict";
  var scope = SA.UsingNamespace('SA.Widgets.UploadUserImagePopUp'),$uploadUserImageModal;

  var header,
    pictureUrl = '/images/user/commenter_gray_115x115.png',
    isUserhHasPicture = false,
    container = $('body'),
    note,
    latestCropData = {},
    nextCallback,
    forceCallback = false;

  scope.show = function(opt) {
    opt = opt || {};
    if(SA.Data.User.loggedIn()) {
      if(opt.container && opt.container.length > 0)
        container = opt.container;
      if(opt.callback)
        nextCallback = opt.callback;
      if (opt.force_callback)
        forceCallback = true;
      return initModal();
    }
    return SA.Widgets.AuthenticationPopup.show();
  };

  scope.showError = function(errMsg) {
    showError(errMsg);
  };

  scope.FinishUpload = function(uploadedImagePath) {
    $uploadUserImageModal.find('.upload-picture-sa-loader').addClass("hidden");
    showMsg("Adjust your picture ");
    $uploadUserImageModal.find('#step2').removeClass("hidden");
    $uploadUserImageModal.find('#new_picture_name').text($uploadUserImageModal.find('#upload_file').val().split('\\').pop());
    $uploadUserImageModal.find('.preview-profile-div').removeClass("hidden");
    $uploadUserImageModal.find('#step1').addClass("hidden");
    $uploadUserImageModal.find('#cropper').attr('src',uploadedImagePath);
    $uploadUserImageModal.find('#save_image').prop('disabled', false);
    showCropPreview()
  };

  var showError = function(errMsg) {
    if($uploadUserImageModal && errMsg){
      note.addClass("error");
      $uploadUserImageModal.find('.upload-picture-sa-loader').addClass("hidden");
      //note.text(errMsg).delay(3000).fadeOut().css("display", "block");
      note.text(errMsg).delay(3000).animate({opacity: 0});
    }
  };

  var showMsg = function(msg) {
    note.removeClass("error");
    note.text(msg).removeClass("hidden");
  };

  var initModal = function () {
    isUserhHasPicture = SA.Data.MonsterCookie.get('has_picture');
    pictureUrl = SA.Data.User.pictureUrl('big');
    header  = (isUserhHasPicture ? "Update " : "Upload ")  + "your image";
    return buildUploadImageModal();
  };

  var handleAjaxFailure = function(response,opt) {
    var friendly_msg =  opt.msg || header + ' failed!';
    showError(friendly_msg);
    $uploadUserImageModal.find('#save_image').prop('disabled', false);
  };

  function buildUploadImageModal() {
    if ($uploadUserImageModal) return $uploadUserImageModal;

    $uploadUserImageModal = $(JST["jst/widgets/upload_user_image/body"]({
      header:header,
      picture_url:pictureUrl
    }));
    $uploadUserImageModal.find('#save_image').prop('disabled', true);
    setEvents();
    container.first().append($uploadUserImageModal);
    $uploadUserImageModal.fadeIn();
    note = $uploadUserImageModal.find('#popup_note_message');
  }

  var setEvents = function() {
    setUploadEvent();
    setCloseEvent();
    setRemoveEvent();
    setSaveEvent();
  };

  var setUploadEvent = function() {
    $uploadUserImageModal.find('#upload_file').on('change', function(){
      upload($uploadUserImageModal.find('#upload_file'));
    });
  };

  var setCloseEvent = function() {
    $uploadUserImageModal.find('.close').on('click', function(){
      closeModal(false);
      if (forceCallback && nextCallback) {
        nextCallback();
      }
    });
  };

  var setSaveEvent = function() {
    $uploadUserImageModal.find('#save_image').on('click', function(){
      $(this).prop('disabled', true);
      showMsg("Saving...");
      $uploadUserImageModal.find('.upload-picture-sa-loader').removeClass("hidden");
      var cropBoxData = getCropData();
      SA.Logger.Mone.event('bio_change', 'profile_page_header', 'picture_saved', {data: {profile_type: (SA.Pages && SA.Pages.Profile && SA.Pages.Profile.getProfileType())}});
      SA.Models.UploadUserImagePopUp.ajaxCreateProfilePictures({
        userId:SA.Data.User.id(),
        width: cropBoxData.width,
        height: cropBoxData.height,
        x1: cropBoxData.x1,
        y1: cropBoxData.y1,
        x2: cropBoxData.x2,
        y2: cropBoxData.y2,
        onSuccess: handleSaveSuccess,
        onFailure: handleAjaxFailure
      });
    });
  };

  var handleSaveSuccess = function(response, opt) {
    var smallImgSrc = SA.Data.User.pictureUrl("small").replace(/\d+$/,new Date().getTime()); // get not cached img
    var xlImageSrc = SA.Data.User.pictureUrl("extra_large").replace(/\d+$/,new Date().getTime());

    var userImg = $('#user_dropdown');
    if (userImg)
      userImg.attr("src",smallImgSrc); // Refresh profile img in header new time stamp

    // replace image in author profile page if exists
    var authorImage = $('.about-author-image .author-avatar');
    if (authorImage)
      authorImage.attr("src",xlImageSrc); // Refresh profile img in header new time stamp

    SA.Data.Cache.set('user_image_timestamp',new Date().getTime() + 600000); //use this value for override the current TTL;

    closeModal(true);
  };

  var setRemoveEvent = function() {
    $uploadUserImageModal.find('#remove_picture').on('click', function(){
      showMsg("Removing...");
      $uploadUserImageModal.find('.upload-picture-sa-loader').removeClass("hidden");;
      SA.Models.UploadUserImagePopUp.ajaxRemoveProfilePictures({
        userId:SA.Data.User.id(),
        onSuccess: handleRemoveSuccess,
        onFailure: handleAjaxFailure
      });
    });
  };

  var handleRemoveSuccess = function(response, opt) {
    var imgSrc = SA.Data.User.pictureUrl("small").replace(/\d+$/,new Date().getTime()); // get not cached img
    var $userDrop = $('#user_dropdown');
    if ($userDrop)
      $userDrop.attr("src",imgSrc); // Refresh profile img in header new time stamp
    container.find($uploadUserImageModal).remove();
    $uploadUserImageModal = null;
    SA.Data.Cache.del('user_image_timestamp');
    initModal();
  };

  var closeModal = function(handleCallbackAfterSuccess) {
    $uploadUserImageModal.fadeOut(200, function() {
      var $cropImg = $('.crop_container > img');
      container.find($uploadUserImageModal).remove();
      $uploadUserImageModal = null;
      $cropImg.cropper('destroy');
      container.find($cropImg).remove();
      //exec callback if set and after success only
      if(handleCallbackAfterSuccess && nextCallback  && $.isFunction(nextCallback)) {
        nextCallback();
      }
    });
  };

  var upload = function(inputFileObj) {
    showMsg("Loading...");
    $uploadUserImageModal.find('.upload-picture-sa-loader').removeClass("hidden");
    var path = inputFileObj.val();
    if(validImageExtantion(path)) {
      var form = $uploadUserImageModal.find('#image_profile_form');
      var isWidget = $("<input>")
        .attr("type", "hidden")
        .attr("name", "is_widget").val("true");
      $(form).append($(isWidget));
      $(form).submit();
    }
    else
      inputFileObj.val('');
  };

  var validImageExtantion = function (path){
    var rxValidExtention=/\.(?:bmp|jpg|jpeg|png|gif)$/i;
    if (path.trim().length===0) {
      showError('Please select a valid image path');
      return false;
    }

    if (!rxValidExtention.test(path)) {
      showError('The image you uploaded is not a valid image file. Please select another image.');
      return false;
    }
    return true;
  };

  var showCropPreview = function() {
    $('.crop-container > img').cropper({
      aspectRatio: 1 / 1,
      scalable: false,
      zoomable: false,
      preview: ".preview-profile-div",
      crop: function (e) {
        latestCropData = e;
      }
    });
  };

  var getCropData = function() {
    var cropBoxObj = {};
    cropBoxObj.width =  parseInt(latestCropData.width);
    cropBoxObj.height = parseInt(latestCropData.height);
    cropBoxObj.x1 = parseInt(latestCropData.x);
    cropBoxObj.y1 = parseInt(latestCropData.y);
    cropBoxObj.x2 = parseInt(latestCropData.x + cropBoxObj.width);
    cropBoxObj.y2 = parseInt(latestCropData.y + cropBoxObj.height);
    return cropBoxObj;
  };

}(SA, jQuery));
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/comments/comments_mute_notification"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div class="row">\n  <div class="col-xs-1 check-button">\n    ',  inlineSvg ,'\n  </div>\n  <div class="col-xs-9 message">\n    You have muted ',  user.name ,'.\n    <a href="/account/edit_muted_users" sasource="edit_mute">Manage muting</a>\n  </div>\n  <div class="col-xs-1 undo"><a href="#" class="mute-btn" data-user="',  user.id ,'">Undo</a></div>\n  <div class="col-xs-1 close"><a href="#"></a></div>\n</div>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/comments/muted_comments_noti"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div id="muted-comments-noti" class="hidden">You have muted comments. You can <a href="/account/edit_muted_users" sasource="edit_mute">manage people you have muted</a> in your Settings.</div>\n');}return __p.join('');};
}).call(this);



(function (SA, $) {

  var scope = SA.UsingNamespace('SA.Widgets.Comments');
  scope.MuteNotification = function () {

    var $topNotification,
      $commentsNotification,
      $undoElem;

    function render() {
      $topNotification = $('<div class="muted-comments-notification-top hidden"></div>');
      $('#main_content').append($topNotification);

      $commentsNotification = $(JST['jst/widgets/comments/muted_comments_noti']());
      $('.c-comment-box').prepend($commentsNotification);
    }

    function bindEvents() {
      $topNotification.on('click', '.undo a', function (e) {
        e.preventDefault();
        $undoElem.find('.mute-btn').click();
        hideTopNotification();
        SA.Logger.Mone.event('user_mute', 'comment', 'mute_undo', {data: {user_id: $(this).data('id')}});
      }).on('click', '.close a', function (e) {
        e.preventDefault();
        hideTopNotification();
      })
    }

    function hideTopNotification() {
      $undoElem = null;
      $topNotification.html('').addClass('hidden');
    }

    this.show = function ($elem, user) {
      $undoElem = $elem;

      $topNotification.html(JST['jst/widgets/comments/comments_mute_notification']({
        inlineSvg: JST['jst/navigation/green_circle_check']({size: 20}),
        user: user,
        muteClass: 'mute-user'
      })).removeClass('hidden');

      $commentsNotification.removeClass('hidden');
    };

    function init() {
      render();
      bindEvents();
    }

    init();

  }

}(window.SA, window.jQuery));
(function() { this.JST || (this.JST = {}); this.JST["jst/inline_svg/sa_loader"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<svg xmlns="http://www.w3.org/2000/svg" viewBox="636 55.20000076293945 79.70001220703125 68.80001831054688" width="',  width ,'" height="',  height ,'" class="svg-sa-loader"><path fill="#F37321" d="M649,88c0,15,7.5,27.4,17.5,27.1c14-0.4,18.1-12.2,18.1-27.2c0-15-8.1-27.3-18.1-27.2 C654.2,60.8,649,73,649,88z M638.1,88c2.1-32.1,27.3-32.8,27.3-32.8c18.3,0.1,23.5,19.6,23.5,19.6c0.3,1.1,10.9-18.2,10.9-18.2h6 C693.5,83.1,694,93.9,694,93.9c-1,14.3,7,19.2,7,19.2c7.5,4.8,8-9.2,8-9.2c1.7-0.6,2.7-1.2,2.7-1.2c4,19.4-8,18.1-8,18.1 c-9.3,1-13.3-14.2-13.3-14.2c-13.2,17.4-28.4,13.6-28.4,13.6C636,117,638.1,88,638.1,88z"></path></svg>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/likers_popup"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div class="likers-popup-container">\n  ');  jQuery.each(likers, function () { ; __p.push('\n  <div class="liker-row" id="',  this.id ,'">\n    <a target=\'_blank\' href="/user/',  this.id ,'?source=like_number_popup" sasource=\'like_number_popup\'>\n      <img class="liker-img pull-left" src="',  this.pic ,'">\n    </a>\n    <div class="liker-details">\n      <a class="name" href="/user/',  this.id ,'?source=like_number_popup" target=\'_blank\' sasource=\'like_number_popup\'>\n        ',  this.nick ,'\n      </a>\n      <div class="user-likes">\n        <a href="/user/',  this.id ,'/likes?source=like_number_popup">\n          ',  this.likes_count ,'',  this.likes_count === 1 ? ' like' : ' likes' ,'\n        </a>\n      </div>\n    </div>\n  </div>\n  ');  }); ; __p.push('\n</div>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/follow/single_button"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div class="follow-btn-section">\n  <button class="btn btn-default ',  button.class || '' ,'"> ',  button.label ,' </button>\n  ');  if (alerts.show) { ; __p.push('\n  <div class="',  alerts.class ,'" ',  (alerts.showGetAlerts) ? '' : 'style="display:none"' ,'>\n    <div class="check-box ',  alerts.subscribed ? '' : 'unclicked' ,'"></div>\n    Get email alerts\n  </div>\n  ');  } ; __p.push('\n  ');  if (followers.show) { ; __p.push('\n  <div class="',  followers.class ,'" ',  followers.showCounter ? '' : 'style="display:none"' ,'></div>\n  ');  } ; __p.push('\n</div>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/follow/followers_number"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('(<span>',  followers ,'</span> ',  followers === "1" ? "follower" : "followers" ,')\n');}return __p.join('');};
}).call(this);



(function (SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Widgets.Follow');
  scope.FollowersNumber = function (opt) {

    this.update = function (selector, byNumber) {
      $(selector).each(function () {
        var $this = $(this);
        update($this, (parseInt($this.data('count')) + byNumber));
      });
    };

    function render($element, userId) {
      SA.Models.AuthorModel.followersFollowings({
        userId: userId,
        onSuccess: function (userId, res) {
          if (res.status === 'success') {
            update($element, res.data.followers);
          }
        }
      });
    }

    function update($element, followersNumber) {
      var count = parseInt(followersNumber.toString().replace(/,/g, ''));

      if (isNaN(count)) return;

      if (count <= 0) {
        $element.data('count', 0).html('');
      } else {
        var followers = count.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ','), title = null;

        if (count > 1000000000) {
          title = followers;
          followers = (count / 1000000000).toFixed(2) + 'B';
        } else if (count > 1000000) {
          title = followers;
          followers = (count / 1000000).toFixed(2) + 'M';
        }

        $element.data('count', count).html(JST['jst/widgets/follow/followers_number']({followers: followers}));

        if (title) $element.attr('title', title);
      }
    }

    function init() {
      if (opt.container.length && opt.author.id) {
        render(opt.container, opt.author.id);
      }
    }

    init();

  };

}(window.SA, window.jQuery));
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/hover_popup/follow_card/content"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div class="title">',  title ,'</div>\n<div class="text">',  text ,'</div>\n<div class="sep"></div>\n<div class="action rta">\n  <input id="rta-',  type ,'" type="checkbox" ',  checked ? 'checked="checked" ' : '' ,'title="Get email alerts"/>\n  <label for="rta-',  type ,'"></label>\n</div>\n<div class="sep"></div>\n<div class="action remove">\n  <input type="button" value="',  removeBtnText ,'"/>\n</div>\n');}return __p.join('');};
}).call(this);






(function (w, SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Widgets.FollowCard');

  var $doc = $(document),
    $attachedToElement,
    config,
    $container,
    $rtaCbx,
    $removeBtn,
    baseClass = 'follow-card-container',
    baseClassSelector = '.' + baseClass,
    rtaCbxSelector = '.action.rta input:checkbox',
    removeBtnSelector = '.action.remove input',
    hideAutoTimeout = 1000;

  scope.Symbol = function (slugs, portfolio) {
    this.type = 'symbol';
    this.tags = slugs;
    this.slugs = slugs;
    this.portfolio = portfolio;
    this.rta = 'rta_articles,rta_market_currents,filings,trading_rta';
  };

  scope.Author = function (tagId, slug, name, userId) {
    this.type = 'author';
    this.tags = [tagId];
    this.slug = slug;
    this.name = name;
    this.userId = userId;
    this.rta = 'author_rta';
  };

  scope.show = function (opt) {
    opt = opt || {};
    if (!shown()) {
      prepare(opt);

      if (config) {
        $attachedToElement.popover(popoverConfig(opt)).popover('show');

        $container = $(baseClassSelector);
        $rtaCbx = $container.find(rtaCbxSelector);
        $removeBtn = $container.find(removeBtnSelector);

        initEvents();
      }
    }
  };

  scope.hide = hidePopover;

  function shown() {
    return exists($attachedToElement) && exists($container) && $container.is(':visible');
  }

  function exists($elem) {
    return $elem && $elem.length;
  }

  function prepare(opt) {
    $attachedToElement = null;
    config = null;
    $container = null;
    $rtaCbx = null;
    $removeBtn = null;

    if (exists(opt.$hoverElement) && (isSymbol(opt.object) || isAuthor(opt.object))) {
      $attachedToElement = opt.$hoverElement;
      config = {object: opt.object, onRemoveSuccess: opt.onRemoveSuccess};
      config.rtaChecked = opt.rtaChecked === undefined ? true : !!opt.rtaChecked;
      config.cssClasses = opt.cssClasses || [];
      config.onRtaCheck = opt.onRtaCheck;
      config.bi = opt.bi;

      if (SA.Utils.Env.isFirefox()) {
        config.cssClasses.push('firefox-adjustment');
      }
    }
  }

  function isSymbol(o) {
    return o instanceof scope.Symbol;
  }

  function isAuthor(o) {
    return o instanceof scope.Author;
  }

  function popoverConfig(opt) {
    return {
      placement: function () {
        return calculatePopoverPlacement.call(this, opt);
      },
      html: true,
      template: w.JST['jst/widgets/hover_popup/template']({cssClass: [baseClass, config.object.type].concat(config.cssClasses).join(' ')}),
      content: w.JST['jst/widgets/hover_popup/follow_card/content'](contentParams())
    };
  }

  function calculatePopoverPlacement(opt) {
    if (opt.placementPosition) {
      return opt.placementPosition;
    }
    return (this.$element.offset().top - $doc.scrollTop() + $('#main-nav-wrapper-row').height()) > 500 ? 'top' : 'bottom';
  }

  // @return Safe strings for JST
  function contentParams() {
    if (isSymbol(config.object)) {
      var title = 'Stocks',
        text = 'stocks',
        inPortfolio = config.object.portfolio && config.object.portfolio.title || 'your portfolio.';

      if (config.object.tags.length === 1) {
        title = config.object.tags[0].toUpperCase();
        text = title;
      }

      return {
        type: SA.Fn.escapeHtml(config.object.type),
        title: SA.Fn.escapeHtml(title) + ' added to portfolio',
        text: 'You will now see updates on ' + SA.Fn.escapeHtml(text) + ' in ' + SA.Fn.escapeHtml(inPortfolio),
        checked: config.rtaChecked,
        removeBtnText: 'Remove'
      };
    }

    if (isAuthor(config.object)) {
      var sObjectName = SA.Fn.escapeHtml(config.object.name);
      return {
        type: SA.Fn.escapeHtml(config.object.type),
        title: 'You are now following <strong>' + sObjectName + '</strong>',
        text: 'See updates in your <a href="/account/people">People feed</a>.',
        checked: config.rtaChecked,
        removeBtnText: 'Unfollow'
      };
    }
  }

  function initEvents() {
    $container
      .on('change', rtaCbxSelector, toggleRta)
      .on('click', removeBtnSelector, removeTags);

    $doc.bind('click keypress', hidePopoverOnClick);
  }

  function hidePopoverOnClick(e) {
    var $e = $(e.target);
    if (!$e.is(baseClassSelector) && !$e.closest(baseClassSelector).length) {
      destroy();
    }
  }

  function hidePopover() {
    if ($attachedToElement) {
      $attachedToElement.popover('hide').popover('destroy');
    }
  }

  function destroy() {
    hidePopover();

    $attachedToElement = null;
    config = null;
    $container = null;
    $rtaCbx = null;
    $removeBtn = null;

    $doc.off('click keypress', hidePopoverOnClick);
  }

  function toggleRta() {
    var checked = $rtaCbx.attr('checked') === 'checked';

    onBeforeAction();

    var method = checked ? SA.Models.SubscriptionModel.unsubscribe : SA.Models.SubscriptionModel.subscribe;

    method({
      tagIds: config.object.tags.join(','),
      modes: config.object.rta,
      onSuccess: function () {
        if (checked) {
          $rtaCbx.removeAttr('checked');
        } else {
          $rtaCbx.attr('checked', 'checked');
        }

        if ($.isFunction(config.onRtaCheck)) {
          config.onRtaCheck(!checked);
        }

        onDone();
      },
      onFailure: function () {
        if (checked) {
          $rtaCbx.removeAttr('checked');
        } else {
          $rtaCbx.attr('checked', 'checked');
        }

        onDone();
      }
    });
  }

  function removeTags() {
    onBeforeAction();

    if (isSymbol(config.object)) {
      SA.Models.PortfolioModel.removeSymbols({
        slugs: config.object.slugs,
        allPortfolios: true,
        onComplete: onRemoveDone,
        onFailure: onDone
      });
    } else if (isAuthor(config.object)) {
      SA.Models.AuthorModel.unFollowAuthor({
        slug: config.object.slug,
        onSuccess: onRemoveDone,
        onFailure: onDone
      });
      SA.Logger.Mone.event('unfollow_author', config.bi.source, 'click', {
        data: {
          author_slug: config.object.slug,
          author_id: config.object.userId
        }
      });
    }
  }

  function onBeforeAction() {
    $rtaCbx.prop('disabled', true);
    $removeBtn.prop('disabled', true);
  }

  function onRemoveDone(data) {
    if (SA.Utils.SidePortfolio) {
      SA.Utils.SidePortfolio.updatePortfolioElementsRemoved();
    }

    if ($.isFunction(config.onRemoveSuccess)) {
      config.onRemoveSuccess(data);
    }

    $rtaCbx.removeAttr('checked');
    $removeBtn.remove();
    $container.find('.action.remove').addClass('removed');
    setTimeout(hidePopover, hideAutoTimeout);
  }

  function onDone() {
    $rtaCbx.prop('disabled', false);
    $removeBtn.prop('disabled', false);
  }

}(window, window.SA, window.jQuery));





(function (w, SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Widgets.Follow');
  scope.SingleButton = function (opt) {
    var self = this,
      options,
      widgetFollowersNumber,
      $container = null,
      followCard = SA.Widgets.FollowCard;

    var widgetClass = {
      buttonBase: 'follow-btn',
      buttonFollow: 'follow-user',
      buttonFollowingTemp: 'following-user-temp',
      buttonFollowing: 'following-user',
      getAlertsBase: 'get-email-alerts-section',
      followersNumberBase: 'followers-number'
    };

    function defaultOptions() {
      return {
        me: {
          id: SA.Data.User.id(),
          loggedIn: SA.Data.User.loggedIn(),
          followedAuthors: SA.Data.User.followedAuthors(),
          followedUsers: SA.Data.User.followedUsers()
        },
        author: {
          id: null,
          tagId: null,
          slug: null
        },
        container: '.follow',
        button: {
          selector: null,
          label: ''
        },
        getAlerts: {
          show: false,
          selector: null,
          class: ''
        },
        showPopover: false,
        followersNumber: {
          show: true,
          selector: null,
          class: ''
        },
        articleId: null,
        bi: {sendDefault: true, source: ''},
        afterClb: null,
        onFollowAuthorBefore: null,
        onFollowAuthorSuccess: null,
        onFollowUserBefore: null,
        onFollowUserSuccess: null,
        onUnfollowAuthorBefore: null,
        onUnfollowAuthorSuccess: null,
        onUnfollowUserBefore: null,
        onUnfollowUserSuccess: null
      };
    }

    function render() {
      var userId = options.author.userId || '',
        followingAuthor = iFollowAuthor(),
        gettingAlerts = SA.Data.User.isGettingRtaFromAuthor(options.author.tagId),
        followClass = followingAuthor ? widgetClass.buttonFollowing : widgetClass.buttonFollow;

      getContainer().each(function () {
        $(this).append(w.JST['jst/widgets/follow/single_button']({
          button: {
            label: options.button.label,
            class: [widgetClass.buttonBase, 'author-' + userId, followClass].join(' ')
          },
          alerts: {
            show: options.getAlerts.show,
            class: [widgetClass.getAlertsBase, (options.getAlerts.class || ''), userId].join(' '),
            showGetAlerts: followingAuthor && !gettingAlerts
          },
          followers: {
            show: options.followersNumber.show,
            class: [widgetClass.followersNumberBase, options.followersNumber.class || '', userId].join(' '),
            showCounter: !followingAuthor || gettingAlerts || options.followersNumber.override
          }
        }));
      });
    }

    function getContainer() {
      if (!$container) {
        $container = $(options.container);
      }
      return $container;
    }

    function iFollowAuthor() {
      return options.me.loggedIn &&
        (options.author.tagId && options.me.followedAuthors.indexOf(options.author.slug) > -1) ||
        options.me.followedUsers.indexOf(options.author.userId) > -1;
    }

    function initEvents() {
      $(document)
        .on('click', options.container + " ." + widgetClass.buttonFollow, handleFollowUser)
        .on('click', options.container + " ." + widgetClass.buttonFollowing, handleUnfollowUser)
        .on('mouseout', options.container + " ." + widgetClass.buttonFollowingTemp, function () {
          $(this).removeClass(widgetClass.buttonFollowingTemp).addClass(widgetClass.buttonFollowing);
        });

      if (options.getAlerts.show) {
        getContainer().on('click', options.getAlerts.selector, handleGetAlerts);
      }
    }

    function isSticky($el) {
      return $el.closest('.sticky-follow-section').length;
    }

    // Start Follow
    function handleFollowUser(e) {
      if (options.me.loggedIn) {
        if (options.author.tagId) {
          sendBiEvent('get_author_email_alerts', options.bi.source, 'click');
          followAuthor(e.currentTarget);
        } else {
          followUser(e.currentTarget);
        }
      } else {
        authenticateAndFollow();
      }
    }

    function handleGetAlerts() {
      var $getAlertsCheckBox = $(options.getAlerts.selector + ' .check-box');

      if ($getAlertsCheckBox.length) {
        $getAlertsCheckBox.toggleClass('unclicked');

        var unClicked = $getAlertsCheckBox.first().hasClass('unclicked'),
          type = (unClicked ? 'remove' : 'get') + '_author_email_alerts';
        sendBiEvent(type, options.bi.source, 'click');

        var method = unClicked ? SA.Models.SubscriptionModel.unsubscribe : SA.Models.SubscriptionModel.subscribe;

        method({tagIds: options.author.tagId, modes: 'author_rta'});
      }
    }

    function followAuthor(btn) {
      var author = options.author,
        $btn = $(btn),
        bi = {
          type: $btn.closest('.follow-profile-tab-btn').length ? 'follow_another_author' : 'follow_author',
          src: isSticky($btn) ? 'profile_page_sticky_tab' : options.bi.source
        };

      sendBiEvent(bi.type, bi.src, 'click');
      execFunction(options.onFollowAuthorBefore, [$btn]);
      followUpdateHtml(btn);

      SA.Models.AuthorModel.followAuthorWithRta({
        slug: author.slug,
        id: author.userId,
        articleId: options.articleId,
        onSuccess: function (slug, res) {
          options.me.followedAuthors.push(author.slug);

          execFunction(options.onFollowAuthorSuccess, [$btn]);

          if (options.showPopover) {
            followCard.show({
              $hoverElement: getContainer().find('.' + widgetClass.buttonBase),
              object: new followCard.Author(options.author.tagId, options.author.slug, options.author.name, options.author.userId),
              rtaChecked: res.rta_checked,
              onRemoveSuccess: unfollowUpdateHtml,
              bi: {source: bi.src},
              placementPosition: options.popOverPlacementPosition
            });
          }
        }
      });
    }

    function followUser(btn) {
      var author = options.author,
        $btn = $(btn),
        src = isSticky($btn) ? 'profile_page_sticky_tab' : options.bi.source;

      sendBiEvent('follow_user', src, 'click');
      execFunction(options.onFollowUserBefore, [$btn]);
      followUpdateHtml(btn);

      SA.Models.AuthorModel.followUser({
        id: author.userId,
        onSuccess: function () {
          options.me.followedUsers.push(author.userId);

          execFunction(options.onFollowUserSuccess, [$btn]);
        }
      });
    }

    function followUpdateHtml(btn) {
      $(options.button.selector).each(function () {
        var followClass = (this === btn) ? widgetClass.buttonFollowingTemp : widgetClass.buttonFollowing;

        $(this).removeClass(widgetClass.buttonFollow).addClass(followClass).removeAttr('disabled');
      });

      updateFollowerNumber(1);

      toggleSections(true);
    }

    function authenticateAndFollow() {
      var kv = options.author.userId ? ('user_id|' + options.author.userId) : ('slug|' + options.author.slug);

      SA.Widgets.AuthenticationPopup.show({
        id: kv,
        activity: 'follow_me',
        loginSuccess: 'Follow.Login',
        signInSuccess: 'Follow.Register',
        resetSuccess: 'Follow.ForgotPassword'
      });
    }
    // End Follow

    // Start Unfollow
    function handleUnfollowUser(e) {
      var $btn = $(e.currentTarget),
        src = isSticky($btn) ? 'profile_page_sticky_tab' : options.bi.source;

      if (options.author.tagId) {
        sendBiEvent('unfollow_author', src, 'click');
        unfollowAuthor(options.author, $btn);
      } else {
        sendBiEvent('unfollow_user', src, 'click');
        unfollowUser(options.author, $btn);
      }
    }

    function unfollowAuthor(author, $btn) {
      execFunction(options.onUnfollowAuthorBefore, [$btn]);
      unfollowUpdateHtml();

      SA.Models.AuthorModel.unFollowAuthor({
        slug: author.slug,
        onSuccess: function () {
          var index = options.me.followedAuthors.indexOf(author.slug);
          if (index > -1) {
            options.me.followedAuthors.splice(index, 1);
          }

          execFunction(options.onUnfollowAuthorSuccess, [$btn]);
        }
      });
    }

    function unfollowUser(author, $btn) {
      execFunction(options.onUnfollowUserBefore, [$btn]);
      unfollowUpdateHtml();

      SA.Models.AuthorModel.unFollowUser({
        id: author.userId,
        onSuccess: function () {
          var index = options.me.followedUsers.indexOf(author.userId);
          if (index > -1) {
            options.me.followedUsers.splice(index, 1);
          }

          execFunction(options.onUnfollowUserSuccess, [$btn]);
        }
      });
    }

    function unfollowUpdateHtml() {
      $('#add-ticker-to-portfolio-unit').show();

      $(options.button.selector).each(function () {
        $(this).removeClass(widgetClass.buttonFollowing).addClass(widgetClass.buttonFollow).removeAttr('disabled');
      });

      updateFollowerNumber(-1);
      toggleSections(false);
    }

    // End Unfollow

    function updateFollowerNumber(count) {
      if (options.followersNumber.show) {
        widgetFollowersNumber.update(options.followersNumber.selector, count);
      }
    }

    function toggleSections(following) {
      if (options.followersNumber.show && options.getAlerts.show) {
        $(options.followersNumber.selector).toggle(!following);
      }
      $(options.getAlerts.selector).toggle(following);
      $(options.getAlerts.selector + ' .check-box').removeClass('unclicked');
    }

    function initFollowButton() {
      options.button.selector = ['', widgetClass.buttonBase, 'author-' + options.author.userId].join('.');
    }

    function initGetAlerts() {
      options.getAlerts.selector = ['', widgetClass.getAlertsBase, options.author.userId].join('.');
    }

    function initFollowersNumber() {
      options.followersNumber.selector = ['', widgetClass.followersNumberBase, options.author.userId].join('.');
      widgetFollowersNumber = new SA.Widgets.Follow.FollowersNumber({
        author: {id: options.author.userId},
        container: $(options.followersNumber.selector)
      });
    }

    function sendBiEvent(type, src, action) {
      if (options.bi.sendDefault) {
        SA.Logger.Mone.event(type, src, action, {
          data: {
            author_slug: options.author.slug,
            author_id: options.author.userId
          }
        });
      }
    }

    function isValid() {
      return getContainer().length && options.author && options.author.userId !== options.me.id && options.author.slug !== 'seeking-alpha';
    }

    function execFunction(method, params) {
      if ($.isFunction(method)) method.apply(undefined, params);
    }

    self.init = function () {
      options = $.extend({}, defaultOptions(), opt || {});
      if (isValid()) {
        initFollowButton();
        render();
        initFollowersNumber();
        initGetAlerts();
        initEvents();

        execFunction(options.afterClb);
      }
    };
  };

}(window, window.SA, window.jQuery));





(function (w, SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Widgets.LikersPopup');

  var bodyHtml = ['<div class="likers-popup-container">', w.JST['jst/inline_svg/sa_loader']({width: 128, height: 128}), '</div>'].join('');

  scope.show = function (opt) {
    SA.Logger.Mone.event(opt.type, opt.source, 'who_liked', {data: {likable_id: opt.id}});

    showPopup(opt);

    setTimeout(function () {
      SA.Models.Like.ajaxGetLikerData({id: opt.id, type: opt.type}, function (res, status) {
        if (status === 'success') {
          if (res.likers.length) {
            $('.modal-body').html(w.JST['jst/widgets/likers_popup'](res));

            if ($.isFunction(opt.clb)) {
              opt.clb(res.likers);
            }
          }
        }
      });
    }, 500);
  };

  scope.showAllLikers = function () {
    var $this = $(this), count, type;

    if ($this.context.className === 'show-all-likers') {
      count = $this.data('count');
      type = $this.data('comment') ? 'Comment' : 'Article';
    } else {
      count = parseInt($this.text());
      type = 'comment';
    }

    if (count) {
      var data = {
        type: type,
        source: type,
        count: count,
        id: $this.data(type.toLowerCase())
      };
      scope.show(data);
    }
  };

  function showPopup(opt) {
    var likable = opt.type.toLowerCase();
    if (likable === 'instablogpost') { likable = 'blog post'; }
    var popup = SA.Widgets.Popup.build({
      className: 'likers-popup',
      headerContent: '<h4 class="header-text">People who liked this ' + likable + '</h4>',
      backdrop: true,
      keyboard: true,
      showCloseBtn: true,
      showBody: true,
      bodyContent: bodyHtml,
      showFooter: false,
      removeAfterClose: true
    });
    popup.show();
  }

}(window, window.SA, window.jQuery));
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/content_popup"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push(''); 
    var currentUserId = SA.Data.User.id();
    var followButtonText = data.following ? 'Unfollow' : 'Follow';
  ; __p.push('\n\n<div class="c-content-popup c-content-popup--',  data.popupType ,' ', data.extraClasses,'">\n  ');  if (data.showViewComment){; __p.push('\n    <div class="c-content-popup__row js-view-comment" data-behavior=\'view-comment\' data-nick="',  data.nick ,'" data-url="',  data.uri ,'">View in Article</div>\n  '); }; __p.push('\n  <div class="c-content-popup__row js-send-message" data-behavior=\'send-message\' data-nick="',  data.nick ,'">Message User</div>\n  ');  if (data.mutable) { ; __p.push('\n    <div class="c-content-popup__row c-content__mute-btn js-mute" data-behavior=\'mute-user\' data-user-id="',  data.userId ,'"></div>\n  ');  } ; __p.push('\n  ');  if (data.userId != currentUserId) {; __p.push('\n  <div class="c-content-popup__row js-follow sa-follow-btn" data-behavior=\'follow-user\'\n       data-type="',  data.userType ,'" data-id="',  data.userId ,'" data-slug="',  data.authorSlug ,'" data-following="',  data.following ,'">\n    ',  followButtonText ,'\n  </div>\n  '); }; __p.push('\n  <div class=\'c-content-popup__top-arrow\'></div>  ');  /* here to allow the first popup child have rounded corners */ ; __p.push('\n  <div class="c-content-popup__row js-copy-link" data-behavior=\'copy-url\' data-url="',  data.uri ,'">Copy Link</div>\n  ');  if (data.userId != currentUserId) { ; __p.push('\n    <div class="c-content-popup__row js-report-abuse sa-report-abuse-btn" data-type="',  data.type,'" data-source="ContentPopup"\n         data-id="',  data.id ,'" data-behavior=\'report-abuse\'>Report Abuse</div>\n  ');  } ; __p.push('\n</div>\n');}return __p.join('');};
}).call(this);
(function(w, SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Utils.Clipboard');

  scope.copy = function(text) {
    var $temp = $("<input>");
    $("body").append($temp);
    $temp.val(text).select();
    document.execCommand("copy");
    $temp.remove();
  };

}(window, window.SA, window.jQuery));







(function(SA, $) {

  "use strict";

  var scope = SA.UsingNamespace('SA.Widgets.ContentPopup');
      scope.popupCounter = 0;   // Current popup id
      scope.popups = [];        // All popups where indexes are their ids

  var ContentPopupFactory = function () {
    var id = null,
        isPopupOpen = false,
        areEventsActive = false,
        muteBtn = null,
        $popupsWrapper = null,
        containerSelector = null,
        displaySelector = null,
        extraClasses = '',
        togglerSelector = '',
        showViewComment = false,
        followedAuthors = SA.Data.User.followedAuthors(),
        followedUsers = SA.Data.User.followedUsers();

    var sendMessage = function (el) {
      var messagePopupOffset = $(el).offset();
      SA.Widgets.Messaging.buildNewMessagePopup({
        recipient: el.data('nick'),
        subject: 'A message from ',
        eventSource: 'profile_page_header',
        top: messagePopupOffset.top + 10,
        left: messagePopupOffset.left - 1
      });
      SA.Logger.Mone.event('icons', 'profile_page_header', 'clicked_send_message');
    };

    var getContainer = function ($el) {
      return $el.closest(containerSelector);
    };

    var getDisplayContainer = function ($el){
      return $el.closest(displaySelector);
    };

    var handleSendMessage = function () {
      sendMessage($(this));
      closePopup(this);
    };

    var handleViewComment = function () {
      location.href = $(this).data('url');
      closePopup(this);
    };

    var handleCopyLink = function () {
      var $st = getContainer($(this));
      SA.Utils.Clipboard.copy($st.data('content-url'));
      closePopup(this);
    };

    var handlePopupAction = function () {
      var $st = getContainer($(this));
      SA.Logger.Mone.event('content', $(this).data('behavior'), 'click', {data: {content_id: $st.data('id')}});
    };

    var onFollow = function () {
      var $this = $(this);
      $this.data('following') ? unFollow($this) : follow($this);
      console.log($this.data('following'));
      closePopup(this);
    };

    var initPopupActions = function () {
      $popupsWrapper.on('click', '.js-send-message', handleSendMessage)
        .on('click', '.js-view-comment', handleViewComment)
        .on('click', '.js-copy-link', handleCopyLink)
        .on('click', '.c-content-popup__row', handlePopupAction)
        .on('click', '.js-follow', onFollow)
        .on('click', '.js-content-popup-toggle', handleTogglerClickEvents);
    };

    var closePopup = function () {
      var $popup = $('.c-content-popup');
      if (isPopupOpen) {
        $popup.fadeOut(333, function () {
          $popup.remove();
        });
        isPopupOpen = false;
      }
    };

    var handleBodyClosePopup = function (e) {
      var $container = $('.c-content-popup');
      if (!$container.is(e.target) && $container.has(e.target).length === 0 && $(e.target).is(togglerSelector) != true) {
        closePopup($container);
      }
    };

    // Click outside to close pupup
    var initCloseControlsPopup = function () {
      $('body').on('click', handleBodyClosePopup);
    };

    // Deactivate click outside to close pupup
    var deactivateCloseControlsPopup = function () {
      $('body').off('click', handleBodyClosePopup);
    };

    function getPopupData($content) {
      var data = {
        popupType: 'comment',
        uri: $content.data('content-url'),
        nick: $content.data('nick'),
        userId: $content.data('user-id'),
        userType: $content.data('user-type'),
        authorSlug: $content.data('author-slug'),
        following: false,
        id: $content.data('id'),
        type: 'Comment',
        showViewComment: showViewComment,
        extraClasses: extraClasses
      };
      if (data.authorSlug) {
        data.following = followedAuthors.indexOf(data.authorSlug) > -1;
      } else if (data.userId) {
        data.following = followedUsers.indexOf(data.userId) > -1;
      }
      data.mutable = (data.userId !== SA.Data.User.id());
      return data;
    }

    var initMuteBtn = function (opt) {
      if (!getContainer(opt.$el).data('following')) {
        muteBtn = new SA.Widgets.MuteUser.Button({
          user: { name: opt.user_name, id: opt.user_id },
          container: '.js-mute[data-user-id="' + opt.user_id + '"]',
          widgetClass: { base: 'mute-btn' },
          onMuteSuccess: onMute,
          bi: {
            src: 'content_popup_widget',
            data: {id: opt.user_id}
          }
        });
      } else {
        $('.js-mute').remove();
      }
    };

    var openPopup = function (el) {
      var $this = $(el);
      var $content = getContainer($this);
      var data = getPopupData($content);
      var controlsPopup = $(JST['jst/widgets/content_popup']({data: data}));
      getDisplayContainer($this).append(controlsPopup);
      SA.Logger.Mone.event('content', 'controls_popup', 'show', {data: {content_id: $content.data('id')}});
      initMuteBtn({$el: $this, user_id: data.userId, user_name: data.nick});
      isPopupOpen = true;
    };

    var onMute = function () {
      closePopup();
    };

    var filteredArray = function (arr, value) {
      return arr.filter(function (item) {
        return item !== value;
      })
    };

    var follow = function ($el) {
      if ($el.data('type') === 'author') {
        followedAuthors.push($el.data('slug'));
        SA.Models.AuthorModel.followAuthorWithRta({
          slug: $el.data('slug'),
          id: $el.data('id')
        });
      } else {
        followedUsers.push(parseInt($el.data('id')));
        SA.Models.AuthorModel.followUser({
          id: $el.data('id')
        });
      }
      getContainer($el).data('following', true);
    };

    var unFollow = function ($el) {
      if ($el.data('type') === 'author') {
        followedAuthors = filteredArray(followedAuthors, $el.data('slug'));
        SA.Models.AuthorModel.unFollowAuthor({
          slug: $el.data('slug')
        });
      } else {
        followedUsers = filteredArray(followedUsers, parseInt($el.data('id')));
        SA.Models.AuthorModel.unFollowUser({
          id: $el.data('id')
        });
      }
      getContainer($el).data('following', false);
    };


    var handleTogglerClickEvents = function () {
      if (isPopupOpen) {
        closePopup(this);
      } else {
        openPopup(this);
      }
    };

    var initTogglerClickEvents = function () {
      initPopupActions();
      initCloseControlsPopup();
    };

    this.id = function() {
      return id;
    };

    this.setId = function(inId) {
      id = inId;
    };

    /* IN:
        globalWrapper: wrapper selector under which all content units with popups exist
        containerSelector: wrapper selector for each content unit, e.g. a content can be
          a wrapping comment or a stocktalk etc.
    */
    this.init = function(opt) {
      opt = opt || {};
      $popupsWrapper = $(opt.globalWrapper);
      containerSelector = opt.containerSelector;
      displaySelector = opt.displaySelector || opt.containerSelector;
      togglerSelector = opt.togglerSelector;
      extraClasses = opt.extraClasses;
      showViewComment = opt.showViewComment;
      initTogglerClickEvents();
    };
  };

  // Create a new popup
  //
  scope.new = function (opt) {
    var popup = new ContentPopupFactory();
    popup.setId(++scope.popupCounter);
    scope.popups[popup.id()] = popup;
    popup.init(opt);
    return popup;
  };

}(SA, jQuery));


(function (root, factory) {
  if (typeof define === 'function' && define.amd) {
    // AMD. Register as an anonymous module.
    define(["jquery"], function ($) {
      return (root.returnExportsGlobal = factory($));
    });
  } else if (typeof exports === 'object') {
    // Node. Does not work with strict CommonJS, but
    // only CommonJS-like enviroments that support module.exports,
    // like Node.
    module.exports = factory(require("jquery"));
  } else {
    factory(jQuery);
  }
}(this, function ($) {

/*
  Implement Github like autocomplete mentions
  http://ichord.github.com/At.js

  Copyright (c) 2013 chord.luo@gmail.com
  Licensed under the MIT license.
*/

/*
 textarea  input 

.
*/

"use strict";
var EditableCaret, InputCaret, Mirror, Utils, discoveryIframeOf, methods, oDocument, oFrame, oWindow, pluginName, setContextBy;

pluginName = 'caret';

EditableCaret = (function() {
  function EditableCaret($inputor) {
    this.$inputor = $inputor;
    this.domInputor = this.$inputor[0];
  }

  EditableCaret.prototype.setPos = function(pos) {
    var fn, found, offset, sel;
    if (sel = oWindow.getSelection()) {
      offset = 0;
      found = false;
      (fn = function(pos, parent) {
        var node, range, _i, _len, _ref, _results;
        _ref = parent.childNodes;
        _results = [];
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          node = _ref[_i];
          if (found) {
            break;
          }
          if (node.nodeType === 3) {
            if (offset + node.length >= pos) {
              found = true;
              range = oDocument.createRange();
              range.setStart(node, pos - offset);
              sel.removeAllRanges();
              sel.addRange(range);
              break;
            } else {
              _results.push(offset += node.length);
            }
          } else {
            _results.push(fn(pos, node));
          }
        }
        return _results;
      })(pos, this.domInputor);
    }
    return this.domInputor;
  };

  EditableCaret.prototype.getIEPosition = function() {
    return this.getPosition();
  };

  EditableCaret.prototype.getPosition = function() {
    var inputor_offset, offset;
    offset = this.getOffset();
    inputor_offset = this.$inputor.offset();
    offset.left -= inputor_offset.left;
    offset.top -= inputor_offset.top;
    return offset;
  };

  EditableCaret.prototype.getOldIEPos = function() {
    var preCaretTextRange, textRange;
    textRange = oDocument.selection.createRange();
    preCaretTextRange = oDocument.body.createTextRange();
    preCaretTextRange.moveToElementText(this.domInputor);
    preCaretTextRange.setEndPoint("EndToEnd", textRange);
    return preCaretTextRange.text.length;
  };

  EditableCaret.prototype.getPos = function() {
    var clonedRange, pos, range;
    if (range = this.range()) {
      clonedRange = range.cloneRange();
      clonedRange.selectNodeContents(this.domInputor);
      clonedRange.setEnd(range.endContainer, range.endOffset);
      pos = clonedRange.toString().length;
      clonedRange.detach();
      return pos;
    } else if (oDocument.selection) {
      return this.getOldIEPos();
    }
  };

  EditableCaret.prototype.getOldIEOffset = function() {
    var range, rect;
    range = oDocument.selection.createRange().duplicate();
    range.moveStart("character", -1);
    rect = range.getBoundingClientRect();
    return {
      height: rect.bottom - rect.top,
      left: rect.left,
      top: rect.top
    };
  };

  EditableCaret.prototype.getOffset = function(pos) {
    var clonedRange, offset, range, rect, shadowCaret;
    if (oWindow.getSelection && (range = this.range())) {
      if (range.endOffset - 1 > 0 && range.endContainer !== this.domInputor) {
        clonedRange = range.cloneRange();
        clonedRange.setStart(range.endContainer, range.endOffset - 1);
        clonedRange.setEnd(range.endContainer, range.endOffset);
        rect = clonedRange.getBoundingClientRect();
        offset = {
          height: rect.height,
          left: rect.left + rect.width,
          top: rect.top
        };
        clonedRange.detach();
      }
      if (!offset || (offset != null ? offset.height : void 0) === 0) {
        clonedRange = range.cloneRange();
        shadowCaret = $(oDocument.createTextNode("|"));
        clonedRange.insertNode(shadowCaret[0]);
        clonedRange.selectNode(shadowCaret[0]);
        rect = clonedRange.getBoundingClientRect();
        offset = {
          height: rect.height,
          left: rect.left,
          top: rect.top
        };
        shadowCaret.remove();
        clonedRange.detach();
      }
    } else if (oDocument.selection) {
      offset = this.getOldIEOffset();
    }
    if (offset) {
      offset.top += $(oWindow).scrollTop();
      offset.left += $(oWindow).scrollLeft();
    }
    return offset;
  };

  EditableCaret.prototype.range = function() {
    var sel;
    if (!oWindow.getSelection) {
      return;
    }
    sel = oWindow.getSelection();
    if (sel.rangeCount > 0) {
      return sel.getRangeAt(0);
    } else {
      return null;
    }
  };

  return EditableCaret;

})();

InputCaret = (function() {
  function InputCaret($inputor) {
    this.$inputor = $inputor;
    this.domInputor = this.$inputor[0];
  }

  InputCaret.prototype.getIEPos = function() {
    var endRange, inputor, len, normalizedValue, pos, range, textInputRange;
    inputor = this.domInputor;
    range = oDocument.selection.createRange();
    pos = 0;
    if (range && range.parentElement() === inputor) {
      normalizedValue = inputor.value.replace(/\r\n/g, "\n");
      len = normalizedValue.length;
      textInputRange = inputor.createTextRange();
      textInputRange.moveToBookmark(range.getBookmark());
      endRange = inputor.createTextRange();
      endRange.collapse(false);
      if (textInputRange.compareEndPoints("StartToEnd", endRange) > -1) {
        pos = len;
      } else {
        pos = -textInputRange.moveStart("character", -len);
      }
    }
    return pos;
  };

  InputCaret.prototype.getPos = function() {
    if (oDocument.selection) {
      return this.getIEPos();
    } else {
      return this.domInputor.selectionStart;
    }
  };

  InputCaret.prototype.setPos = function(pos) {
    var inputor, range;
    inputor = this.domInputor;
    if (oDocument.selection) {
      range = inputor.createTextRange();
      range.move("character", pos);
      range.select();
    } else if (inputor.setSelectionRange) {
      inputor.setSelectionRange(pos, pos);
    }
    return inputor;
  };

  InputCaret.prototype.getIEOffset = function(pos) {
    var h, textRange, x, y;
    textRange = this.domInputor.createTextRange();
    pos || (pos = this.getPos());
    textRange.move('character', pos);
    x = textRange.boundingLeft;
    y = textRange.boundingTop;
    h = textRange.boundingHeight;
    return {
      left: x,
      top: y,
      height: h
    };
  };

  InputCaret.prototype.getOffset = function(pos) {
    var $inputor, offset, position;
    $inputor = this.$inputor;
    if (oDocument.selection) {
      offset = this.getIEOffset(pos);
      offset.top += $(oWindow).scrollTop() + $inputor.scrollTop();
      offset.left += $(oWindow).scrollLeft() + $inputor.scrollLeft();
      return offset;
    } else {
      offset = $inputor.offset();
      position = this.getPosition(pos);
      return offset = {
        left: offset.left + position.left - $inputor.scrollLeft(),
        top: offset.top + position.top - $inputor.scrollTop(),
        height: position.height
      };
    }
  };

  InputCaret.prototype.getPosition = function(pos) {
    var $inputor, at_rect, end_range, format, html, mirror, start_range;
    $inputor = this.$inputor;
    format = function(value) {
      value = value.replace(/<|>|`|"|&/g, '?').replace(/\r\n|\r|\n/g, "<br/>");
      if (/firefox/i.test(navigator.userAgent)) {
        value = value.replace(/\s/g, '&nbsp;');
      }
      return value;
    };
    if (pos === void 0) {
      pos = this.getPos();
    }
    start_range = $inputor.val().slice(0, pos);
    end_range = $inputor.val().slice(pos);
    html = "<span style='position: relative; display: inline;'>" + format(start_range) + "</span>";
    html += "<span id='caret' style='position: relative; display: inline;'>|</span>";
    html += "<span style='position: relative; display: inline;'>" + format(end_range) + "</span>";
    mirror = new Mirror($inputor);
    return at_rect = mirror.create(html).rect();
  };

  InputCaret.prototype.getIEPosition = function(pos) {
    var h, inputorOffset, offset, x, y;
    offset = this.getIEOffset(pos);
    inputorOffset = this.$inputor.offset();
    x = offset.left - inputorOffset.left;
    y = offset.top - inputorOffset.top;
    h = offset.height;
    return {
      left: x,
      top: y,
      height: h
    };
  };

  return InputCaret;

})();

Mirror = (function() {
  Mirror.prototype.css_attr = ["borderBottomWidth", "borderLeftWidth", "borderRightWidth", "borderTopStyle", "borderRightStyle", "borderBottomStyle", "borderLeftStyle", "borderTopWidth", "boxSizing", "fontFamily", "fontSize", "fontWeight", "height", "letterSpacing", "lineHeight", "marginBottom", "marginLeft", "marginRight", "marginTop", "outlineWidth", "overflow", "overflowX", "overflowY", "paddingBottom", "paddingLeft", "paddingRight", "paddingTop", "textAlign", "textOverflow", "textTransform", "whiteSpace", "wordBreak", "wordWrap"];

  function Mirror($inputor) {
    this.$inputor = $inputor;
  }

  Mirror.prototype.mirrorCss = function() {
    var css,
      _this = this;
    css = {
      position: 'absolute',
      left: -9999,
      top: 0,
      zIndex: -20000
    };
    if (this.$inputor.prop('tagName') === 'TEXTAREA') {
      this.css_attr.push('width');
    }
    $.each(this.css_attr, function(i, p) {
      return css[p] = _this.$inputor.css(p);
    });
    return css;
  };

  Mirror.prototype.create = function(html) {
    this.$mirror = $('<div></div>');
    this.$mirror.css(this.mirrorCss());
    this.$mirror.html(html);
    this.$inputor.after(this.$mirror);
    return this;
  };

  Mirror.prototype.rect = function() {
    var $flag, pos, rect;
    $flag = this.$mirror.find("#caret");
    pos = $flag.position();
    rect = {
      left: pos.left,
      top: pos.top,
      height: $flag.height()
    };
    this.$mirror.remove();
    return rect;
  };

  return Mirror;

})();

Utils = {
  contentEditable: function($inputor) {
    return !!($inputor[0].contentEditable && $inputor[0].contentEditable === 'true');
  }
};

methods = {
  pos: function(pos) {
    if (pos || pos === 0) {
      return this.setPos(pos);
    } else {
      return this.getPos();
    }
  },
  position: function(pos) {
    if (oDocument.selection) {
      return this.getIEPosition(pos);
    } else {
      return this.getPosition(pos);
    }
  },
  offset: function(pos) {
    var offset;
    offset = this.getOffset(pos);
    return offset;
  }
};

oDocument = null;

oWindow = null;

oFrame = null;

setContextBy = function(settings) {
  var iframe;
  if (iframe = settings != null ? settings.iframe : void 0) {
    oFrame = iframe;
    oWindow = iframe.contentWindow;
    return oDocument = iframe.contentDocument || oWindow.document;
  } else {
    oFrame = void 0;
    oWindow = window;
    return oDocument = document;
  }
};

discoveryIframeOf = function($dom) {
  var error;
  oDocument = $dom[0].ownerDocument;
  oWindow = oDocument.defaultView || oDocument.parentWindow;
  try {
    return oFrame = oWindow.frameElement;
  } catch (_error) {
    error = _error;
  }
};

$.fn.caret = function(method, value, settings) {
  var caret;
  if (methods[method]) {
    if ($.isPlainObject(value)) {
      setContextBy(value);
      value = void 0;
    } else {
      setContextBy(settings);
    }
    caret = Utils.contentEditable(this) ? new EditableCaret(this) : new InputCaret(this);
    return methods[method].apply(caret, [value]);
  } else {
    return $.error("Method " + method + " does not exist on jQuery.caret");
  }
};

$.fn.caret.EditableCaret = EditableCaret;

$.fn.caret.InputCaret = InputCaret;

$.fn.caret.Utils = Utils;

$.fn.caret.apis = methods;


}));
/**
 * at.js - 1.5.4
 * Copyright (c) 2018 chord.luo <chord.luo@gmail.com>;
 * Homepage: http://ichord.github.com/At.js
 * License: MIT
 */

(function (root, factory) {
  if (typeof define === 'function' && define.amd) {
    // AMD. Register as an anonymous module unless amdModuleId is set
    define(["jquery"], function (a0) {
      return (factory(a0));
    });
  } else if (typeof exports === 'object') {
    // Node. Does not work with strict CommonJS, but
    // only CommonJS-like environments that support module.exports,
    // like Node.
    module.exports = factory(require("jquery"));
  } else {
    factory(jQuery);
  }
}(this, function ($) {
var DEFAULT_CALLBACKS, KEY_CODE;

KEY_CODE = {
  ESC: 27,
  TAB: 9,
  ENTER: 13,
  CTRL: 17,
  A: 65,
  P: 80,
  N: 78,
  LEFT: 37,
  UP: 38,
  RIGHT: 39,
  DOWN: 40,
  BACKSPACE: 8,
  SPACE: 32
};

DEFAULT_CALLBACKS = {
  beforeSave: function(data) {
    return Controller.arrayToDefaultHash(data);
  },
  matcher: function(flag, subtext, should_startWithSpace, acceptSpaceBar) {
    var _a, _y, match, regexp, space;
    flag = flag.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g, "\\$&");
    if (should_startWithSpace) {
      flag = '(?:^|\\s)' + flag;
    }
    _a = decodeURI("%C3%80");
    _y = decodeURI("%C3%BF");
    space = acceptSpaceBar ? "\ " : "";
    regexp = new RegExp(flag + "([A-Za-z" + _a + "-" + _y + "0-9_" + space + "\'\.\+\-]*)$|" + flag + "([^\\x00-\\xff]*)$", 'gi');
    match = regexp.exec(subtext);
    if (match) {
      return match[2] || match[1];
    } else {
      return null;
    }
  },
  filter: function(query, data, searchKey) {
    var _results, i, item, len;
    _results = [];
    for (i = 0, len = data.length; i < len; i++) {
      item = data[i];
      if (~new String(item[searchKey]).toLowerCase().indexOf(query.toLowerCase())) {
        _results.push(item);
      }
    }
    return _results;
  },
  remoteFilter: null,
  sorter: function(query, items, searchKey) {
    var _results, i, item, len;
    if (!query) {
      return items;
    }
    _results = [];
    for (i = 0, len = items.length; i < len; i++) {
      item = items[i];
      item.atwho_order = new String(item[searchKey]).toLowerCase().indexOf(query.toLowerCase());
      if (item.atwho_order > -1) {
        _results.push(item);
      }
    }
    return _results.sort(function(a, b) {
      return a.atwho_order - b.atwho_order;
    });
  },
  tplEval: function(tpl, map) {
    var error, error1, template;
    template = tpl;
    try {
      if (typeof tpl !== 'string') {
        template = tpl(map);
      }
      return template.replace(/\$\{([^\}]*)\}/g, function(tag, key, pos) {
        return map[key];
      });
    } catch (error1) {
      error = error1;
      return "";
    }
  },
  highlighter: function(li, query) {
    var regexp;
    if (!query) {
      return li;
    }
    regexp = new RegExp(">\\s*([^\<]*?)(" + query.replace("+", "\\+") + ")([^\<]*)\\s*<", 'ig');
    return li.replace(regexp, function(str, $1, $2, $3) {
      return '> ' + $1 + '<strong>' + $2 + '</strong>' + $3 + ' <';
    });
  },
  beforeInsert: function(value, $li, e) {
    return value;
  },
  beforeReposition: function(offset) {
    return offset;
  },
  afterMatchFailed: function(at, el) {}
};

var App;

App = (function() {
  function App(inputor) {
    this.currentFlag = null;
    this.controllers = {};
    this.aliasMaps = {};
    this.$inputor = $(inputor);
    this.setupRootElement();
    this.listen();
  }

  App.prototype.createContainer = function(doc) {
    var ref;
    if ((ref = this.$el) != null) {
      ref.remove();
    }
    return $(doc.body).append(this.$el = $("<div class='atwho-container'></div>"));
  };

  App.prototype.setupRootElement = function(iframe, asRoot) {
    var error, error1;
    if (asRoot == null) {
      asRoot = false;
    }
    if (iframe) {
      this.window = iframe.contentWindow;
      this.document = iframe.contentDocument || this.window.document;
      this.iframe = iframe;
    } else {
      this.document = this.$inputor[0].ownerDocument;
      this.window = this.document.defaultView || this.document.parentWindow;
      try {
        this.iframe = this.window.frameElement;
      } catch (error1) {
        error = error1;
        this.iframe = null;
        if ($.fn.atwho.debug) {
          throw new Error("iframe auto-discovery is failed.\nPlease use `setIframe` to set the target iframe manually.\n" + error);
        }
      }
    }
    return this.createContainer((this.iframeAsRoot = asRoot) ? this.document : document);
  };

  App.prototype.controller = function(at) {
    var c, current, currentFlag, ref;
    if (this.aliasMaps[at]) {
      current = this.controllers[this.aliasMaps[at]];
    } else {
      ref = this.controllers;
      for (currentFlag in ref) {
        c = ref[currentFlag];
        if (currentFlag === at) {
          current = c;
          break;
        }
      }
    }
    if (current) {
      return current;
    } else {
      return this.controllers[this.currentFlag];
    }
  };

  App.prototype.setContextFor = function(at) {
    this.currentFlag = at;
    return this;
  };

  App.prototype.reg = function(flag, setting) {
    var base, controller;
    controller = (base = this.controllers)[flag] || (base[flag] = this.$inputor.is('[contentEditable]') ? new EditableController(this, flag) : new TextareaController(this, flag));
    if (setting.alias) {
      this.aliasMaps[setting.alias] = flag;
    }
    controller.init(setting);
    return this;
  };

  App.prototype.listen = function() {
    return this.$inputor.on('compositionstart', (function(_this) {
      return function(e) {
        var ref;
        if ((ref = _this.controller()) != null) {
          ref.view.hide();
        }
        _this.isComposing = true;
        return null;
      };
    })(this)).on('compositionend', (function(_this) {
      return function(e) {
        _this.isComposing = false;
        setTimeout(function(e) {
          return _this.dispatch(e);
        });
        return null;
      };
    })(this)).on('keyup.atwhoInner', (function(_this) {
      return function(e) {
        return _this.onKeyup(e);
      };
    })(this)).on('keydown.atwhoInner', (function(_this) {
      return function(e) {
        return _this.onKeydown(e);
      };
    })(this)).on('blur.atwhoInner', (function(_this) {
      return function(e) {
        var c;
        if (c = _this.controller()) {
          c.expectedQueryCBId = null;
          return c.view.hide(e, c.getOpt("displayTimeout"));
        }
      };
    })(this)).on('click.atwhoInner', (function(_this) {
      return function(e) {
        return _this.dispatch(e);
      };
    })(this)).on('scroll.atwhoInner', (function(_this) {
      return function() {
        var lastScrollTop;
        lastScrollTop = _this.$inputor.scrollTop();
        return function(e) {
          var currentScrollTop, ref;
          currentScrollTop = e.target.scrollTop;
          if (lastScrollTop !== currentScrollTop) {
            if ((ref = _this.controller()) != null) {
              ref.view.hide(e);
            }
          }
          lastScrollTop = currentScrollTop;
          return true;
        };
      };
    })(this)());
  };

  App.prototype.shutdown = function() {
    var _, c, ref;
    ref = this.controllers;
    for (_ in ref) {
      c = ref[_];
      c.destroy();
      delete this.controllers[_];
    }
    this.$inputor.off('.atwhoInner');
    return this.$el.remove();
  };

  App.prototype.dispatch = function(e) {
    var _, c, ref, results;
    if (void 0 === e) {
      return;
    }
    ref = this.controllers;
    results = [];
    for (_ in ref) {
      c = ref[_];
      results.push(c.lookUp(e));
    }
    return results;
  };

  App.prototype.onKeyup = function(e) {
    var ref;
    switch (e.keyCode) {
      case KEY_CODE.ESC:
        e.preventDefault();
        if ((ref = this.controller()) != null) {
          ref.view.hide();
        }
        break;
      case KEY_CODE.DOWN:
      case KEY_CODE.UP:
      case KEY_CODE.CTRL:
      case KEY_CODE.ENTER:
        $.noop();
        break;
      case KEY_CODE.P:
      case KEY_CODE.N:
        if (!e.ctrlKey) {
          this.dispatch(e);
        }
        break;
      default:
        this.dispatch(e);
    }
  };

  App.prototype.onKeydown = function(e) {
    var ref, view;
    view = (ref = this.controller()) != null ? ref.view : void 0;
    if (!(view && view.visible())) {
      return;
    }
    switch (e.keyCode) {
      case KEY_CODE.ESC:
        e.preventDefault();
        view.hide(e);
        break;
      case KEY_CODE.UP:
        e.preventDefault();
        view.prev();
        break;
      case KEY_CODE.DOWN:
        e.preventDefault();
        view.next();
        break;
      case KEY_CODE.P:
        if (!e.ctrlKey) {
          return;
        }
        e.preventDefault();
        view.prev();
        break;
      case KEY_CODE.N:
        if (!e.ctrlKey) {
          return;
        }
        e.preventDefault();
        view.next();
        break;
      case KEY_CODE.TAB:
      case KEY_CODE.ENTER:
      case KEY_CODE.SPACE:
        if (!view.visible()) {
          return;
        }
        if (!this.controller().getOpt('spaceSelectsMatch') && e.keyCode === KEY_CODE.SPACE) {
          return;
        }
        if (!this.controller().getOpt('tabSelectsMatch') && e.keyCode === KEY_CODE.TAB) {
          return;
        }
        if (view.highlighted()) {
          e.preventDefault();
          view.choose(e);
        } else {
          view.hide(e);
        }
        break;
      default:
        $.noop();
    }
  };

  return App;

})();

var Controller,
  slice = [].slice;

Controller = (function() {
  Controller.prototype.uid = function() {
    return (Math.random().toString(16) + "000000000").substr(2, 8) + (new Date().getTime());
  };

  function Controller(app, at1) {
    this.app = app;
    this.at = at1;
    this.$inputor = this.app.$inputor;
    this.id = this.$inputor[0].id || this.uid();
    this.expectedQueryCBId = null;
    this.setting = null;
    this.query = null;
    this.pos = 0;
    this.range = null;
    if ((this.$el = $("#atwho-ground-" + this.id, this.app.$el)).length === 0) {
      this.app.$el.append(this.$el = $("<div id='atwho-ground-" + this.id + "'></div>"));
    }
    this.model = new Model(this);
    this.view = new View(this);
  }

  Controller.prototype.init = function(setting) {
    this.setting = $.extend({}, this.setting || $.fn.atwho["default"], setting);
    this.view.init();
    return this.model.reload(this.setting.data);
  };

  Controller.prototype.destroy = function() {
    this.trigger('beforeDestroy');
    this.model.destroy();
    this.view.destroy();
    return this.$el.remove();
  };

  Controller.prototype.callDefault = function() {
    var args, error, error1, funcName;
    funcName = arguments[0], args = 2 <= arguments.length ? slice.call(arguments, 1) : [];
    try {
      return DEFAULT_CALLBACKS[funcName].apply(this, args);
    } catch (error1) {
      error = error1;
      return $.error(error + " Or maybe At.js doesn't have function " + funcName);
    }
  };

  Controller.prototype.trigger = function(name, data) {
    var alias, eventName;
    if (data == null) {
      data = [];
    }
    data.push(this);
    alias = this.getOpt('alias');
    eventName = alias ? name + "-" + alias + ".atwho" : name + ".atwho";
    return this.$inputor.trigger(eventName, data);
  };

  Controller.prototype.callbacks = function(funcName) {
    return this.getOpt("callbacks")[funcName] || DEFAULT_CALLBACKS[funcName];
  };

  Controller.prototype.getOpt = function(at, default_value) {
    var e, error1;
    try {
      return this.setting[at];
    } catch (error1) {
      e = error1;
      return null;
    }
  };

  Controller.prototype.insertContentFor = function($li) {
    var data, tpl;
    tpl = this.getOpt('insertTpl');
    data = $.extend({}, $li.data('item-data'), {
      'atwho-at': this.at
    });
    return this.callbacks("tplEval").call(this, tpl, data, "onInsert");
  };

  Controller.prototype.renderView = function(data) {
    var searchKey;
    searchKey = this.getOpt("searchKey");
    data = this.callbacks("sorter").call(this, this.query.text, data.slice(0, 1001), searchKey);
    return this.view.render(data.slice(0, this.getOpt('limit')));
  };

  Controller.arrayToDefaultHash = function(data) {
    var i, item, len, results;
    if (!$.isArray(data)) {
      return data;
    }
    results = [];
    for (i = 0, len = data.length; i < len; i++) {
      item = data[i];
      if ($.isPlainObject(item)) {
        results.push(item);
      } else {
        results.push({
          name: item
        });
      }
    }
    return results;
  };

  Controller.prototype.lookUp = function(e) {
    var query, wait;
    if (e && e.type === 'click' && !this.getOpt('lookUpOnClick')) {
      return;
    }
    if (this.getOpt('suspendOnComposing') && this.app.isComposing) {
      return;
    }
    query = this.catchQuery(e);
    if (!query) {
      this.expectedQueryCBId = null;
      return query;
    }
    this.app.setContextFor(this.at);
    if (wait = this.getOpt('delay')) {
      this._delayLookUp(query, wait);
    } else {
      this._lookUp(query);
    }
    return query;
  };

  Controller.prototype._delayLookUp = function(query, wait) {
    var now, remaining;
    now = Date.now ? Date.now() : new Date().getTime();
    this.previousCallTime || (this.previousCallTime = now);
    remaining = wait - (now - this.previousCallTime);
    if ((0 < remaining && remaining < wait)) {
      this.previousCallTime = now;
      this._stopDelayedCall();
      return this.delayedCallTimeout = setTimeout((function(_this) {
        return function() {
          _this.previousCallTime = 0;
          _this.delayedCallTimeout = null;
          return _this._lookUp(query);
        };
      })(this), wait);
    } else {
      this._stopDelayedCall();
      if (this.previousCallTime !== now) {
        this.previousCallTime = 0;
      }
      return this._lookUp(query);
    }
  };

  Controller.prototype._stopDelayedCall = function() {
    if (this.delayedCallTimeout) {
      clearTimeout(this.delayedCallTimeout);
      return this.delayedCallTimeout = null;
    }
  };

  Controller.prototype._generateQueryCBId = function() {
    return {};
  };

  Controller.prototype._lookUp = function(query) {
    var _callback;
    _callback = function(queryCBId, data) {
      if (queryCBId !== this.expectedQueryCBId) {
        return;
      }
      if (data && data.length > 0) {
        return this.renderView(this.constructor.arrayToDefaultHash(data));
      } else {
        return this.view.hide();
      }
    };
    this.expectedQueryCBId = this._generateQueryCBId();
    return this.model.query(query.text, $.proxy(_callback, this, this.expectedQueryCBId));
  };

  return Controller;

})();

var TextareaController,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

TextareaController = (function(superClass) {
  extend(TextareaController, superClass);

  function TextareaController() {
    return TextareaController.__super__.constructor.apply(this, arguments);
  }

  TextareaController.prototype.catchQuery = function() {
    var caretPos, content, end, isString, query, start, subtext;
    content = this.$inputor.val();
    caretPos = this.$inputor.caret('pos', {
      iframe: this.app.iframe
    });
    subtext = content.slice(0, caretPos);
    query = this.callbacks("matcher").call(this, this.at, subtext, this.getOpt('startWithSpace'), this.getOpt("acceptSpaceBar"));
    isString = typeof query === 'string';
    if (isString && query.length < this.getOpt('minLen', 0)) {
      return;
    }
    if (isString && query.length <= this.getOpt('maxLen', 20)) {
      start = caretPos - query.length;
      end = start + query.length;
      this.pos = start;
      query = {
        'text': query,
        'headPos': start,
        'endPos': end
      };
      this.trigger("matched", [this.at, query.text]);
    } else {
      query = null;
      this.view.hide();
    }
    return this.query = query;
  };

  TextareaController.prototype.rect = function() {
    var c, iframeOffset, scaleBottom;
    if (!(c = this.$inputor.caret('offset', this.pos - 1, {
      iframe: this.app.iframe
    }))) {
      return;
    }
    if (this.app.iframe && !this.app.iframeAsRoot) {
      iframeOffset = $(this.app.iframe).offset();
      c.left += iframeOffset.left;
      c.top += iframeOffset.top;
    }
    scaleBottom = this.app.document.selection ? 0 : 2;
    return {
      left: c.left,
      top: c.top,
      bottom: c.top + c.height + scaleBottom
    };
  };

  TextareaController.prototype.insert = function(content, $li) {
    var $inputor, source, startStr, suffix, text;
    $inputor = this.$inputor;
    source = $inputor.val();
    startStr = source.slice(0, Math.max(this.query.headPos - this.at.length, 0));
    suffix = (suffix = this.getOpt('suffix')) === "" ? suffix : suffix || " ";
    content += suffix;
    text = "" + startStr + content + (source.slice(this.query['endPos'] || 0));
    $inputor.val(text);
    $inputor.caret('pos', startStr.length + content.length, {
      iframe: this.app.iframe
    });
    if (!$inputor.is(':focus')) {
      $inputor.focus();
    }
    return $inputor.change();
  };

  return TextareaController;

})(Controller);

var EditableController,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

EditableController = (function(superClass) {
  extend(EditableController, superClass);

  function EditableController() {
    return EditableController.__super__.constructor.apply(this, arguments);
  }

  EditableController.prototype._getRange = function() {
    var sel;
    sel = this.app.window.getSelection();
    if (sel.rangeCount > 0) {
      return sel.getRangeAt(0);
    }
  };

  EditableController.prototype._setRange = function(position, node, range) {
    if (range == null) {
      range = this._getRange();
    }
    if (!(range && node)) {
      return;
    }
    node = $(node)[0];
    if (position === 'after') {
      range.setEndAfter(node);
      range.setStartAfter(node);
    } else {
      range.setEndBefore(node);
      range.setStartBefore(node);
    }
    range.collapse(false);
    return this._clearRange(range);
  };

  EditableController.prototype._clearRange = function(range) {
    var sel;
    if (range == null) {
      range = this._getRange();
    }
    sel = this.app.window.getSelection();
    if (this.ctrl_a_pressed == null) {
      sel.removeAllRanges();
      return sel.addRange(range);
    }
  };

  EditableController.prototype._movingEvent = function(e) {
    var ref;
    return e.type === 'click' || ((ref = e.which) === KEY_CODE.RIGHT || ref === KEY_CODE.LEFT || ref === KEY_CODE.UP || ref === KEY_CODE.DOWN);
  };

  EditableController.prototype._unwrap = function(node) {
    var next;
    node = $(node).unwrap().get(0);
    if ((next = node.nextSibling) && next.nodeValue) {
      node.nodeValue += next.nodeValue;
      $(next).remove();
    }
    return node;
  };

  EditableController.prototype.catchQuery = function(e) {
    var $inserted, $query, _range, index, inserted, isString, lastNode, matched, offset, query, query_content, range;
    if (!(range = this._getRange())) {
      return;
    }
    if (!range.collapsed) {
      return;
    }
    if (e.which === KEY_CODE.ENTER) {
      ($query = $(range.startContainer).closest('.atwho-query')).contents().unwrap();
      if ($query.is(':empty')) {
        $query.remove();
      }
      ($query = $(".atwho-query", this.app.document)).text($query.text()).contents().last().unwrap();
      this._clearRange();
      return;
    }
    if (/firefox/i.test(navigator.userAgent)) {
      if ($(range.startContainer).is(this.$inputor)) {
        this._clearRange();
        return;
      }
      if (e.which === KEY_CODE.BACKSPACE && range.startContainer.nodeType === document.ELEMENT_NODE && (offset = range.startOffset - 1) >= 0) {
        _range = range.cloneRange();
        _range.setStart(range.startContainer, offset);
        if ($(_range.cloneContents()).contents().last().is('.atwho-inserted')) {
          inserted = $(range.startContainer).contents().get(offset);
          this._setRange('after', $(inserted).contents().last());
        }
      } else if (e.which === KEY_CODE.LEFT && range.startContainer.nodeType === document.TEXT_NODE) {
        $inserted = $(range.startContainer.previousSibling);
        if ($inserted.is('.atwho-inserted') && range.startOffset === 0) {
          this._setRange('after', $inserted.contents().last());
        }
      }
    }
    $(range.startContainer).closest('.atwho-inserted').addClass('atwho-query').siblings().removeClass('atwho-query');
    if (($query = $(".atwho-query", this.app.document)).length > 0 && $query.is(':empty') && $query.text().length === 0) {
      $query.remove();
    }
    if (!this._movingEvent(e)) {
      $query.removeClass('atwho-inserted');
    }
    if ($query.length > 0) {
      switch (e.which) {
        case KEY_CODE.LEFT:
          this._setRange('before', $query.get(0), range);
          $query.removeClass('atwho-query');
          return;
        case KEY_CODE.RIGHT:
          this._setRange('after', $query.get(0).nextSibling, range);
          $query.removeClass('atwho-query');
          return;
      }
    }
    if ($query.length > 0 && (query_content = $query.attr('data-atwho-at-query'))) {
      $query.empty().html(query_content).attr('data-atwho-at-query', null);
      this._setRange('after', $query.get(0), range);
    }
    _range = range.cloneRange();
    _range.setStart(range.startContainer, 0);
    matched = this.callbacks("matcher").call(this, this.at, _range.toString(), this.getOpt('startWithSpace'), this.getOpt("acceptSpaceBar"));
    isString = typeof matched === 'string';
    if ($query.length === 0 && isString && (index = range.startOffset - this.at.length - matched.length) >= 0) {
      range.setStart(range.startContainer, index);
      $query = $('<span/>', this.app.document).attr(this.getOpt("editableAtwhoQueryAttrs")).addClass('atwho-query');
      range.surroundContents($query.get(0));
      lastNode = $query.contents().last().get(0);
      if (lastNode) {
        if (/firefox/i.test(navigator.userAgent)) {
          range.setStart(lastNode, lastNode.length);
          range.setEnd(lastNode, lastNode.length);
          this._clearRange(range);
        } else {
          this._setRange('after', lastNode, range);
        }
      }
    }
    if (isString && matched.length < this.getOpt('minLen', 0)) {
      return;
    }
    if (isString && matched.length <= this.getOpt('maxLen', 20)) {
      query = {
        text: matched,
        el: $query
      };
      this.trigger("matched", [this.at, query.text]);
      return this.query = query;
    } else {
      this.view.hide();
      this.query = {
        el: $query
      };
      if ($query.text().indexOf(this.at) >= 0) {
        if (this._movingEvent(e) && $query.hasClass('atwho-inserted')) {
          $query.removeClass('atwho-query');
        } else if (false !== this.callbacks('afterMatchFailed').call(this, this.at, $query)) {
          this._setRange("after", this._unwrap($query.text($query.text()).contents().first()));
        }
      }
      return null;
    }
  };

  EditableController.prototype.rect = function() {
    var $iframe, iframeOffset, rect;
    rect = this.query.el.offset();
    if (!(rect && this.query.el[0].getClientRects().length)) {
      return;
    }
    if (this.app.iframe && !this.app.iframeAsRoot) {
      iframeOffset = ($iframe = $(this.app.iframe)).offset();
      rect.left += iframeOffset.left - this.$inputor.scrollLeft();
      rect.top += iframeOffset.top - this.$inputor.scrollTop();
    }
    rect.bottom = rect.top + this.query.el.height();
    return rect;
  };

  EditableController.prototype.insert = function(content, $li) {
    var data, overrides, range, suffix, suffixNode;
    if (!this.$inputor.is(':focus')) {
      this.$inputor.focus();
    }
    overrides = this.getOpt('functionOverrides');
    if (overrides.insert) {
      return overrides.insert.call(this, content, $li);
    }
    suffix = (suffix = this.getOpt('suffix')) === "" ? suffix : suffix || "\u00A0";
    data = $li.data('item-data');
    this.query.el.removeClass('atwho-query').addClass('atwho-inserted').html(content).attr('data-atwho-at-query', "" + data['atwho-at'] + this.query.text).attr('contenteditable', "false");
    if (range = this._getRange()) {
      if (this.query.el.length) {
        range.setEndAfter(this.query.el[0]);
      }
      range.collapse(false);
      range.insertNode(suffixNode = this.app.document.createTextNode("" + suffix));
      this._setRange('after', suffixNode, range);
    }
    if (!this.$inputor.is(':focus')) {
      this.$inputor.focus();
    }
    return this.$inputor.change();
  };

  return EditableController;

})(Controller);

var Model;

Model = (function() {
  function Model(context) {
    this.context = context;
    this.at = this.context.at;
    this.storage = this.context.$inputor;
  }

  Model.prototype.destroy = function() {
    return this.storage.data(this.at, null);
  };

  Model.prototype.saved = function() {
    return this.fetch() > 0;
  };

  Model.prototype.query = function(query, callback) {
    var _remoteFilter, data, searchKey;
    data = this.fetch();
    searchKey = this.context.getOpt("searchKey");
    data = this.context.callbacks('filter').call(this.context, query, data, searchKey) || [];
    _remoteFilter = this.context.callbacks('remoteFilter');
    if (data.length > 0 || (!_remoteFilter && data.length === 0)) {
      return callback(data);
    } else {
      return _remoteFilter.call(this.context, query, callback);
    }
  };

  Model.prototype.fetch = function() {
    return this.storage.data(this.at) || [];
  };

  Model.prototype.save = function(data) {
    return this.storage.data(this.at, this.context.callbacks("beforeSave").call(this.context, data || []));
  };

  Model.prototype.load = function(data) {
    if (!(this.saved() || !data)) {
      return this._load(data);
    }
  };

  Model.prototype.reload = function(data) {
    return this._load(data);
  };

  Model.prototype._load = function(data) {
    if (typeof data === "string") {
      return $.ajax(data, {
        dataType: "json"
      }).done((function(_this) {
        return function(data) {
          return _this.save(data);
        };
      })(this));
    } else {
      return this.save(data);
    }
  };

  return Model;

})();

var View;

View = (function() {
  function View(context) {
    this.context = context;
    this.$el = $("<div class='atwho-view'><ul class='atwho-view-ul'></ul></div>");
    this.$elUl = this.$el.children();
    this.timeoutID = null;
    this.context.$el.append(this.$el);
    this.bindEvent();
  }

  View.prototype.init = function() {
    var header_tpl, id;
    id = this.context.getOpt("alias") || this.context.at.charCodeAt(0);
    header_tpl = this.context.getOpt("headerTpl");
    if (header_tpl && this.$el.children().length === 1) {
      this.$el.prepend(header_tpl);
    }
    return this.$el.attr({
      'id': "at-view-" + id
    });
  };

  View.prototype.destroy = function() {
    return this.$el.remove();
  };

  View.prototype.bindEvent = function() {
    var $menu, lastCoordX, lastCoordY;
    $menu = this.$el.find('ul');
    lastCoordX = 0;
    lastCoordY = 0;
    return $menu.on('mousemove.atwho-view', 'li', (function(_this) {
      return function(e) {
        var $cur;
        if (lastCoordX === e.clientX && lastCoordY === e.clientY) {
          return;
        }
        lastCoordX = e.clientX;
        lastCoordY = e.clientY;
        $cur = $(e.currentTarget);
        if ($cur.hasClass('cur')) {
          return;
        }
        $menu.find('.cur').removeClass('cur');
        return $cur.addClass('cur');
      };
    })(this)).on('click.atwho-view', 'li', (function(_this) {
      return function(e) {
        $menu.find('.cur').removeClass('cur');
        $(e.currentTarget).addClass('cur');
        _this.choose(e);
        return e.preventDefault();
      };
    })(this));
  };

  View.prototype.visible = function() {
    return $.expr.filters.visible(this.$el[0]);
  };

  View.prototype.highlighted = function() {
    return this.$el.find(".cur").length > 0;
  };

  View.prototype.choose = function(e) {
    var $li, content;
    if (($li = this.$el.find(".cur")).length) {
      content = this.context.insertContentFor($li);
      this.context._stopDelayedCall();
      this.context.insert(this.context.callbacks("beforeInsert").call(this.context, content, $li, e), $li);
      this.context.trigger("inserted", [$li, e]);
      this.hide(e);
    }
    if (this.context.getOpt("hideWithoutSuffix")) {
      return this.stopShowing = true;
    }
  };

  View.prototype.reposition = function(rect) {
    var _window, offset, overflowOffset, ref;
    _window = this.context.app.iframeAsRoot ? this.context.app.window : window;
    if (rect.bottom + this.$el.height() - $(_window).scrollTop() > $(_window).height()) {
      rect.bottom = rect.top - this.$el.height();
    }
    if (rect.left > (overflowOffset = $(_window).width() - this.$el.width() - 5)) {
      rect.left = overflowOffset;
    }
    offset = {
      left: rect.left,
      top: rect.bottom
    };
    if ((ref = this.context.callbacks("beforeReposition")) != null) {
      ref.call(this.context, offset);
    }
    this.$el.offset(offset);
    return this.context.trigger("reposition", [offset]);
  };

  View.prototype.next = function() {
    var cur, next, nextEl, offset;
    cur = this.$el.find('.cur').removeClass('cur');
    next = cur.next();
    if (!next.length) {
      next = this.$el.find('li:first');
    }
    next.addClass('cur');
    nextEl = next[0];
    offset = nextEl.offsetTop + nextEl.offsetHeight + (nextEl.nextSibling ? nextEl.nextSibling.offsetHeight : 0);
    return this.scrollTop(Math.max(0, offset - this.$el.height()));
  };

  View.prototype.prev = function() {
    var cur, offset, prev, prevEl;
    cur = this.$el.find('.cur').removeClass('cur');
    prev = cur.prev();
    if (!prev.length) {
      prev = this.$el.find('li:last');
    }
    prev.addClass('cur');
    prevEl = prev[0];
    offset = prevEl.offsetTop + prevEl.offsetHeight + (prevEl.nextSibling ? prevEl.nextSibling.offsetHeight : 0);
    return this.scrollTop(Math.max(0, offset - this.$el.height()));
  };

  View.prototype.scrollTop = function(scrollTop) {
    var scrollDuration;
    scrollDuration = this.context.getOpt('scrollDuration');
    if (scrollDuration) {
      return this.$elUl.animate({
        scrollTop: scrollTop
      }, scrollDuration);
    } else {
      return this.$elUl.scrollTop(scrollTop);
    }
  };

  View.prototype.show = function() {
    var rect;
    if (this.stopShowing) {
      this.stopShowing = false;
      return;
    }
    if (!this.visible()) {
      this.$el.show();
      this.$el.scrollTop(0);
      this.context.trigger('shown');
    }
    if (rect = this.context.rect()) {
      return this.reposition(rect);
    }
  };

  View.prototype.hide = function(e, time) {
    var callback;
    if (!this.visible()) {
      return;
    }
    if (isNaN(time)) {
      this.$el.hide();
      return this.context.trigger('hidden', [e]);
    } else {
      callback = (function(_this) {
        return function() {
          return _this.hide();
        };
      })(this);
      clearTimeout(this.timeoutID);
      return this.timeoutID = setTimeout(callback, time);
    }
  };

  View.prototype.render = function(list) {
    var $li, $ul, i, item, len, li, tpl;
    if (!($.isArray(list) && list.length > 0)) {
      this.hide();
      return;
    }
    this.$el.find('ul').empty();
    $ul = this.$el.find('ul');
    tpl = this.context.getOpt('displayTpl');
    for (i = 0, len = list.length; i < len; i++) {
      item = list[i];
      item = $.extend({}, item, {
        'atwho-at': this.context.at
      });
      li = this.context.callbacks("tplEval").call(this.context, tpl, item, "onDisplay");
      $li = $(this.context.callbacks("highlighter").call(this.context, li, this.context.query.text));
      $li.data("item-data", item);
      $ul.append($li);
    }
    this.show();
    if (this.context.getOpt('highlightFirst')) {
      return $ul.find("li:first").addClass("cur");
    }
  };

  return View;

})();

var Api;

Api = {
  load: function(at, data) {
    var c;
    if (c = this.controller(at)) {
      return c.model.load(data);
    }
  },
  isSelecting: function() {
    var ref;
    return !!((ref = this.controller()) != null ? ref.view.visible() : void 0);
  },
  hide: function() {
    var ref;
    return (ref = this.controller()) != null ? ref.view.hide() : void 0;
  },
  reposition: function() {
    var c;
    if (c = this.controller()) {
      return c.view.reposition(c.rect());
    }
  },
  setIframe: function(iframe, asRoot) {
    this.setupRootElement(iframe, asRoot);
    return null;
  },
  run: function() {
    return this.dispatch();
  },
  destroy: function() {
    this.shutdown();
    return this.$inputor.data('atwho', null);
  }
};

$.fn.atwho = function(method) {
  var _args, result;
  _args = arguments;
  result = null;
  this.filter('textarea, input, [contenteditable=""], [contenteditable=true]').each(function() {
    var $this, app;
    if (!(app = ($this = $(this)).data("atwho"))) {
      $this.data('atwho', (app = new App(this)));
    }
    if (typeof method === 'object' || !method) {
      return app.reg(method.at, method);
    } else if (Api[method] && app) {
      return result = Api[method].apply(app, Array.prototype.slice.call(_args, 1));
    } else {
      return $.error("Method " + method + " does not exist on jQuery.atwho");
    }
  });
  if (result != null) {
    return result;
  } else {
    return this;
  }
};

$.fn.atwho["default"] = {
  at: void 0,
  alias: void 0,
  data: null,
  displayTpl: "<li>${name}</li>",
  insertTpl: "${atwho-at}${name}",
  headerTpl: null,
  callbacks: DEFAULT_CALLBACKS,
  functionOverrides: {},
  searchKey: "name",
  suffix: void 0,
  hideWithoutSuffix: false,
  startWithSpace: true,
  acceptSpaceBar: false,
  highlightFirst: true,
  limit: 5,
  maxLen: 20,
  minLen: 0,
  displayTimeout: 300,
  delay: null,
  spaceSelectsMatch: false,
  tabSelectsMatch: true,
  editableAtwhoQueryAttrs: {},
  scrollDuration: 150,
  suspendOnComposing: true,
  lookUpOnClick: true
};

$.fn.atwho.debug = false;

}));



(function (SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Widgets.UserTagging'),
    $taggedUsers = [],
    $currentHighlight, $curInput,
    MAX_TO_SHOW = 6;

  scope.AddUserTagging = function ($input, getSuggestedNamesClb) {
    $input.atwho({
      at: "@",
      limit: MAX_TO_SHOW,
      acceptSpaceBar: true,
      callbacks: {
        remoteFilter: function (query, callback) {
          query = (query || '').toLowerCase();

          var names = [],
            list = [];

          if ($.isFunction(getSuggestedNamesClb)) {
            names = getSuggestedNamesClb(this.$inputor);
          }

          $.each(names, function (i, v) {
            if (list.length >= MAX_TO_SHOW) {
              return false;
            }

            if (v.toLowerCase().indexOf(query) > -1) {
              pushUnique(list, v);
            }
          });

          if (!query || list.length >= MAX_TO_SHOW) {
            callback(list);
          } else {
            $curInput = this.$inputor;

            $.getJSON('/api/common/ac/autocomplete_name_by_at', {name: query}, function (data) {
              if (data) {
                if (!$.isEmptyObject(data.hashtags)) {
                  var x = 0;
                  while (list.length <= MAX_TO_SHOW) {
                    pushUnique(list, data.hashtags[x++]);
                    if (x >= data.hashtags.length) {
                      break;
                    }
                  }
                }
                callback(list);
                $currentHighlight = list[0];
                if ($currentHighlight && (query.toLowerCase() === $currentHighlight.toLowerCase())) {
                  pushUnique($taggedUsers, $currentHighlight);
                  var txt = $curInput.val(),
                    re = new RegExp(query, 'gi');
                  $curInput.val(txt.replace(re, $currentHighlight));
                }
              }
            });
          }
        }
      }
    });

    $input.on('inserted.atwho', function (event, $li, browser_event) {
      if ($li.data('item-data')['atwho-at'] === '@') {
        pushUnique($taggedUsers, $li.data('item-data').name);
      }
    });
  };

  scope.GetTaggedUsers = function () {
    return $taggedUsers;
  };

  scope.ClearTaggedUsers = function () {
    $taggedUsers = [];
  };

  function pushUnique(array, item) {
    if (array.indexOf(item) === -1) {
      array.push(item);
    }
  }

}(window.SA, window.jQuery));












































(function (win, SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Widgets.CommentsTree'),
    pageConfig = SA.pageConfig ? SA.pageConfig.Data : {},
    saPopup = SA.Widgets.Popup,
    authenticationPopup = SA.Widgets.AuthenticationPopup,
    commentsModel = SA.Models.Comments,
    authorModel = SA.Models.AuthorModel,
    userTagging = SA.Widgets.UserTagging,
    saSocial = SA.Widgets.Social,
    // needed for scrolling in new comments
    lastVisitParam = SA.Fn.param('v') || null,
    lastVisitTimestamp = parseInt(lastVisitParam, 10) * 1000 || 0,
    highLightEnabled = !!lastVisitTimestamp,
    commentsTimestamps = [],
    $topHeader = $('#sa-hd'),
    SORT_TYPES = {
      newest: 'newest',
      oldest: 'oldest',
      mostLiked: 'mostLiked'
    },
    PAYWALLED_CONTENT_TYPES = ['Article', 'MarketCurrent', 'InstablogPost'],
    sortBy = SORT_TYPES.newest,

    // needed for precise scrolling to comment
    headerHeight = $topHeader.height(),
    scrollSpeed = 200,

    // Cache current user data
    saData = SA.Data,
    saUser = saData.User,
    userId = saUser.id(),
    userName = saUser.nick(),
    userSlug = saUser.authorSlug() || '',
    userProfileLink = saUser.profileLink(),
    userLoggedIn = saUser.loggedIn(),
    commentForm,
    // save comment likes lists
    usersLiked = {},

    userHasProfilePicture = false,

    // cache popups
    deleteCommentPopup = null,

    // wrapper inserted after init(stores ref)
    commentsWrapper,

    // one comment box, just replacing data after reply clicked
    $commentBox,

    // commentBox first initiated for commenting on tree
    mainBox = true,

    // blocks comment btn after first request for blocked user
    commenterBlocked = false,

    // disable post comment if post comment ajax request pending
    postCommentLock = false,

    // stack for saving users comments submitted on this page
    userCommentStack = {},

    // set edit and delete event listeners only if user submits comment
    editListenerActive = false,
    deleteListenerActive = false,
    updateListenerActive = false,

    // Time before delete edit/submit btn (user has only 20 mins. so let's give 15)
    DELETE_EDIT_BTS_TIME = 15 * 60 * 1000,

    // store timeout to reset if comment deleted
    deleteEditBtsTimOut = null,

    // supported types: in case article gonna have different structure
    typeList = ['InstablogPost', 'Article', 'Filing', 'InvestmentOpportunity', 'MarketCurrent', 'AcquireStory'],
    postTypeId = {
      InstablogPost: 4,
      Filing: 8,
      Article: 1,
      MarketCurrent: 3,
      AcquireStory: 5
    },

    DiscussionState = {
      allowed: 0,
      suppressed: 1,
      disabled: 2
    },

    // just in case

    initOpt = {
      type: 'Article',
      container: $('#sa-comments'),
      total: 0,
      id: 0,
      authorUserId: null,
      source: win.location.pathname,
      tracking: false,
      doneCallback: null,
      discussion_status: DiscussionState.allowed
    },
    o,
    muteNotification,
    authenticationPopupTitle = 'Join the conversation today by signing in or registering for a free Seeking Alpha account',

    commentersNames,
    showSpecific = win.location.hash.search(/comment-\d+/) !== -1;

  // private methods

  function showAuthenticationPopup(opt) {
    opt = $.extend({}, { headerTitle: authenticationPopupTitle }, opt);
    authenticationPopup.show(opt);
  }

  var isArticleModerator = function () {
    return SA.Data.User.MPModeratorForAuthorId() === initOpt.authorUserId;
  };

  var isArticleAuthor = function (userId) {
    return userId === initOpt.authorUserId;
  };

  var getPostTypeId = function () {
    return (initOpt.type && postTypeId[initOpt.type]) ? postTypeId[initOpt.type] : null;
  };

  var getCommentedElement = function () {
    var type = initOpt.type,
      id = parseInt(initOpt.id, 10);
    return (type && id) ? type + '_' + id : null;
  };

  var getCommentsCount = function () {
    return initOpt.total || 0;
  };

  var hideCommentsLoader = function () {
    commentsWrapper.find('.c-list').removeClass('sa-com-loading');
  };

  var getAuthorImage = function (id) {
    if (id === userId) {
      return saUser.pictureUrl('small');
    }
    return (initOpt.images && initOpt.images[id]) ? initOpt.images[id] : SA.App.assetHost + '/images/user/commenter_gray.png';
  };

  var getUserName = function (id) {
    if (id === userId) {
      return userName;
    }
    return (initOpt.names && initOpt.names[id]) ? initOpt.names[id] : id;
  };

  var getAuthorCommentsCount = function (id) {
    return (initOpt.comments_count && initOpt.comments_count[id]) ? parseInt(initOpt.comments_count[id], 10) : 0;
  };

  var getCommentById = function (id) {
    return commentsWrapper.find('#comment-' + id);
  };

  var getNewCommentByIndex = function (index) {
    return getNewComments().filter('[data-new-index=' + index + ']');
  };

  var getNewComments = function () {
    return commentsWrapper.find('.c-list .c-body.new-comment');
  };

  var addLoader = function (btn) {
    btn.addClass('sa-animated');
  };

  var removeLoader = function (btn) {
    btn.removeClass('sa-animated');
  };

  var removeAllLoaders = function () {
    $('.sa-animated').removeClass('sa-animated');
  };

  var setCommentBoxVal = function (val) {
    $commentBox.find('textarea').val(val);
  };

  var getCommentBoxVal = function () {
    return $commentBox.find('textarea').val();
  };

  var resetCommentBox = function () {
    setCommentBoxVal('');
    toggleDisableButtons('');
  };

  var updateCommentsCounter = function (counter) {
    commentsWrapper.find('.c-total').text(counter);
    $('#a-comments').find('a').text(counter === 1 ? '1 comment' : counter + ' comments');
    scope.commentsCount = counter;
  };

  var buildAnchor = function (id) {
    return 'comment-' + id;
  };

  var replaceDoubleLines = function (content) {
    return content.replace(/(<br\/>\s*<br\/>|<br>\s*<br>)/g, '<p class="txt-sep"></p>');
  };

  var renderCommentContent = function (content, commenterId) {
    content = '<div class="b-c-content">' + replaceDoubleLines(content) + '</div>';
    if (isArticleAuthor(commenterId)) {
      content = win.JST['jst/widgets/comments/author_reply']() + content;
    }
    return content;
  };

  var justCreatedComment = function (commentId) {
    return !!userCommentStack[commentId];
  };

  var hasChildren = function (commentId) {
    var comment = getCommentById(commentId);
    return !!(comment.length && comment.find('.c-body').length);
  };

  var highlightComment = function (comment) {
    comment.addClass('highlight');
    setTimeout(function () {
      comment.removeClass('highlight');
    }, 1000);
  };

  // remove element and clean stack
  // just in case clean the stuck if there were any comments from this user
  function deleteCommentAndReplies(commentId) {
    var $comment = getCommentById(commentId),
      children = $comment.find('.c-body'), replyId;

    // just in case clean the stuck if there were any comments from this user
    if (children.length && !$.isEmptyObject(userCommentStack)) {
      $.each(children, function (id) {
        replyId = $(children[id]).data('commentid');
        if (userCommentStack[replyId]) {
          delete userCommentStack[replyId];
        }
      });
    }
    delete userCommentStack[commentId];

    // remove comment from main comments list
    var parentComment = findTopParentComment(commentId);
    if (parentComment) { // new reply to comment
      delete parentComment.children[commentId];
    } else { // new comment
      delete initOpt.comments[commentId];
    }

    $comment.remove();
  }

  // MODERATION POPUP

  var showModerationPopup = function (response) {
    saPopup.build({
      className: 'sa-moderation-popup',
      backdrop: true,
      keyboard: true,
      headerContent: win.JST['jst/widgets/comments/moderation_popup/header'](),
      bodyContent: (response === 'moderated item') ? win.JST['jst/widgets/comments/moderation_popup/item_body']() : win.JST['jst/widgets/comments/moderation_popup/user_body'](),
      footerContent: win.JST['jst/widgets/comments/moderation_popup/footer'](),
      removeAfterClose: true
    }).show();
  };

  // DELETE COMMENT POPUP

  var buildDeletePopup = function () {
    deleteCommentPopup = saPopup.build({
      className: 'sa-com-del-popup',
      backdrop: true,
      keyboard: true,
      showCloseBtn: false,
      headerContent: win.JST['jst/widgets/comments/delete_popup/header'](),
      footerContent: win.JST['jst/widgets/comments/delete_popup/footer'](),
      removeAfterClose: false
    });
    // TODO: add sizing options to popups
    deleteCommentPopup.getModalObject().find('.modal-dialog').addClass('modal-sm');
    return deleteCommentPopup;
  };

  var getDeletePopup = function () {
    if (deleteCommentPopup) {
      return deleteCommentPopup;
    }
    return buildDeletePopup();
  };

  // users liked tooltips

  var buildUserList = function (ids) {
    var userNames = $.map(ids, function (id) {
        return getUserName(id);
      }),
      list = $.map(userNames.splice(0, 5), function (name) {
        return '<li>' + name + '</li>';
      });

    if (userNames.length) {
      list.push('<li>' + (userNames.length) + ' more</li>');
    }

    return '<ul>' + list.join('') + '</ul>';
  };

  var buildUsersLikedTooltip = function ($el, ids) {
    ids = ids || [];
    if (ids.length) {
      $el.popover({
        html: true,
        trigger: 'manual',
        placement: 'bottom',
        content: buildUserList(ids)
      });

      $el.on('mouseenter', function () {
        $el.popover('show');
        $el.siblings('.popover').on('mouseleave', function () {
          $el.popover('hide');
        });
      });

      $el.on('mouseleave', function () {
        setTimeout(function () {
          if (!$('.popover:hover').length) {
            $el.popover('hide');
          }
        }, 100);
      });
    }
  };

  var initCommentsPopup = function () {
    $('.ct-likes-count').on('click', SA.Widgets.LikersPopup.showAllLikers);
  };

  // user likes popup

  var buildUserUri = function (userId) {
    return isArticleAuthor(userId) ? '/author/' + initOpt.authorSlug : '/user/' + userId + '?source=comment_likes_popup';
  };

  var buildUserLink = function (userId) {
    return win.JST['jst/widgets/comments/likes_popup/user_link']({
      userName: getUserName(userId),
      userLink: buildUserUri(userId),
      userImgSrc: saUser.pictureUrlFor(userId)
    });
  };

  var buildLikesPopupBody = function (list) {
    if (list.length) {
      var links = $.map(list, function (id) {
        return buildUserLink(id);
      });
      return '<ul>' + links.join('') + '</ul>';
    }
  };

  var buildLikesPopup = function (ids) {
    var bodyContent = buildLikesPopupBody(ids);
    if (bodyContent) {
      return saPopup.build({
        className: 'sa-com-likes-pop',
        backdrop: true,
        keyboard: true,
        headerContent: 'People Who Like This',
        bodyContent: bodyContent,
        showFooter: false,
        removeAfterClose: true
      });
    }
    return SA.exceptions.push(['CommentTree: failed to build like popup body']);
  };

  var initAllLikesPopup = function (el, commentId) {
    el.on('click', function () {
      var ids = usersLiked[commentId].allIds;
      if (ids.length) {
        var popup = buildLikesPopup(ids);
        popup.show();
      }
    });
  };

  var initOtherLikesPopup = function (el, commentId) {
    el.on('click', function () {
      var ids = usersLiked[commentId].otherIds;
      if (ids.length) {
        var popup = buildLikesPopup(ids);
        popup.show();
      }
    });
  };

  // TREE BUILDERS
  // Comments Tracker

  var subscribeCommentsTrack = function (subscribe, onSuccess, onFailure) {
    if (userLoggedIn) {
      initOpt.tracking = subscribe;

      commentsModel.trackComments({
        postId: initOpt.id,
        postType: getPostTypeId(),
        trackerId: userId,
        commentsCount: getCommentsCount(),
        status: subscribe,
        onSuccess: onSuccess,
        onFailure: onFailure
      });
    } else {
      SA.Logger.Mone.event('popup_registration', 'track_comments', 'shown');
      showAuthenticationPopup({
        id: getPostTypeId() + '|' + initOpt.id,
        activity: 'discussion_track',
        urlHash: '#comments'
      });
    }
  };

  var insertActions = function () {
    commentsWrapper.find('.c-h-actions').html(win.JST['jst/widgets/comments/actions']({
      tracking: initOpt.tracking,
      disabled: inDiscussionState([DiscussionState.suppressed, DiscussionState.disabled]),
      sortBy: sortBy
    }));
    commentsWrapper.find('.c-sort-btn').select2({
      width: '100px',
      minimumResultsForSearch: -1
    }).val(SA.Data.Cache.get('comments_sort') || 'newest')
      .change(function () {
      sortBy = $(this).val();
      SA.Data.Cache.set('comments_sort', sortBy);
      buildCommentTree();
      SA.Logger.Mone.event('sort', 'comments', 'clicked', {
        data: {
          sort_selection: sortBy + '_first'
        }
      });
    });

    if (commentsAllowed()) {
      initTrackingEvents();
    }
  };

  var initTrackingEvents = function () {
    commentsWrapper.find('.c-h-actions').on('click', '.track', function () {
      subscribeCommentsTrack(true, trackComments, unTrackComments);
      SA.Logger.Mone.event(null, 'track_comments', 'click');
    }).on('click', '.tracking', function () {
      subscribeCommentsTrack(false, unTrackComments, trackComments);
      SA.Logger.Mone.event(null, 'untrack_comments', 'click');
    }).on('mouseout', '.tracking-started', function () {
      $(this).removeClass('tracking-started').addClass('tracking');
    });
  };

  var trackComments = function () {
    initOpt.container.find('.c-h-actions .track').removeClass('track').addClass('tracking-started');
  };

  var unTrackComments = function () {
    initOpt.container.find('.c-h-actions .tracking').removeClass('tracking').addClass('track');
  };

  var onTrackStatusFail = function () {
    initOpt.tracking = false;
    insertActions();
  };

  var onTrackStatusSuccess = function (res) {
    res = res || {};
    initOpt.tracking = res.tracking || false;
    insertActions();
  };

  var buildCommentTracker = function () {
    commentsModel.getTrackingStatus({
      typeId: getPostTypeId(),
      id: initOpt.id,
      onSuccess: onTrackStatusSuccess,
      onFailure: onTrackStatusFail
    });
  };

  // Comment Tree

  var buildAuthorStatus = function (slug, isPremiumAuthor, serviceId) {
    return slug ? win.JST['jst/widgets/comments/contributor_status']({
      slug: slug,
      isMarketplaceAuthor: isPremiumAuthor,
      serviceId: serviceId
    }) : '';
  };

  var buildFollowBtn = function (authorSlug, userId, commentId) {
    var jst, following;
    if (authorSlug) {
      jst = 'jst/widgets/comments/follow_btn/follow_author_btn';
      following = authorModel.isFollowingAuthor(authorSlug);
    } else {
      jst = 'jst/widgets/comments/follow_btn/follow_user_btn';
      following = authorModel.isFollowingUser(userId);
    }

    return win.JST[jst]({
      following: following,
      commentId: commentId,
      id: userId,
      slug: authorSlug,
      source: initOpt.source
    });
  };

  var buildMessageBtn = function (commenterId, commenterNick, commentId) {
    return '<span class="sep">|</span><a href="#" class="sa-send-message-btn" sasource="article_comments" sa-source="article_comments" data-source="article_comments" data-nick="' + commenterNick + '" data-id="' + commenterId + '" data-subject-id="' + commentId + '" >Send Message</a>';
  };

  var buildMuteBtn = function (commenterId, commenterNick, commentId) {
    return '<span class="sep">|</span><span class="sa-mute-btn" data-nick="' + commenterNick + '" data-commenter-id="' + commenterId + '" data-subject-id="' + commentId + '" ></span>';
  };

  var isCurrentPageType = function (pageType) {
    return pageConfig.pageType === pageType;
  };

  var buildEditDeleteBtn = function (commentId, isCommentByThisUser, isCommentInEditMode) {
    if (!isCurrentPageType('research') && isCommentByThisUser && !isCommentInEditMode) {
      return '<a href="#" class="sa-report-abuse-btn hidden-print" data-source="article_comments" data-type="Comment" data-id="' + commentId + '" data-is-author="' + isCommentByThisUser + '">Edit/Delete</a>';
    }
    return '';
  };

  var buildAbuseBtn = function (commentId, isCommentByThisUser, isCommentInEditMode) {
    if (!isCommentInEditMode && !isCommentByThisUser) {
      return '<a href="#" class="sa-report-abuse-btn hidden-print" data-source="article_comments" data-type="Comment" data-id="' + commentId + '" data-is-author="' + isCommentByThisUser + '">Report Abuse</a>';
    }
    return '';
  };

  var buildLikeData = function (comment) {
    var data = {
      allCount: 0,
      othersCount: 0,
      userLiked: false,
      authorLiked: false
    };

    if (comment.likes) {
      data.allCount = comment.likes;
      if (userId && initOpt.user_likes[comment.id]) {
        data.userLiked = $.inArray(userId.toString(), initOpt.user_likes[comment.id].split(',')) > -1;
      }
    }

    return data;
  };

  var buildLikeBtn = function (commentId, commenterId, liked) {
    var cls = liked ? ' liked' : '', href = ' href="#"';
    if (commenterId === userId) {
      cls += ' disabled';
      href = '';
    }
    return '<a' + href + ' class="pull-right ct-like hidden-print' + cls + '" data-comment="' + commentId + '" data-user="' + commenterId + '">Like</a>';
  };

  var buildLikesCount = function (number, commentId) {
    return '<span class="pull-right ct-likes-count hidden-print" data-comment="' + commentId + '">' + number + '</span>';
  };

  var buildLikesTop = function (data) {
    data = data || {};
    if (data.userLiked) {
      return win.JST['jst/widgets/comments/comment_likes_top']({
        authorLiked: data.authorLiked,
        authorName: '<span class="auth">' + getUserName(initOpt.authorUserId) + '</span>',
        count: data.othersCount
      });
    }
    return '';
  };

  var buildLikes = function (comment) {
    var likeData = buildLikeData(comment);
    return {
      count: buildLikesCount(likeData.allCount, comment.id),
      btn: buildLikeBtn(comment.id, comment.user_id, likeData.userLiked),
      top: buildLikesTop(likeData)
    };
  };

  var deleteBtnRule = function (comment) {
    return (isArticleAuthor(userId) || isArticleModerator() || comment.deleteBtn) && (isCurrentPageType('single_blog') || isCurrentPageType('research'));
  };

  var buildComments = function (comments, isParent) {
    var tree = [];
    if (SA.Data.Cache.get('comments_sort')) {
      sortBy = SA.Data.Cache.get('comments_sort');
    }

    if (!isParent || sortBy === SORT_TYPES.oldest) {
      $.each(comments, function () {
        tree.push(renderCommentNode(this, isParent));
      });
    } else if (sortBy === SORT_TYPES.mostLiked) {
      $.each(sortCommetsByMostLiked(comments), function (key, value) {
        tree.push(renderCommentNode(value, isParent));
      });
    }
    else {
      $.each(comments, function () {
        tree.unshift(renderCommentNode(this, isParent));
      });
    }
    return tree.join('');
  };


  var sortCommetsByMostLiked = function (comments) {
    var sortedComments = [], keys = Object.keys(comments);
    var sortedKeys = keys.sort(function(firstId, secondId){
      return parseInt(comments[firstId].likes) - parseInt(comments[secondId].likes);}).reverse();
    $.each(sortedKeys, function (index, value) {
      sortedComments.push(comments[value]);
    });
    return sortedComments;
  };

  var renderCommentNode = function (comment, isParent) {
    // If the comment is by a muted user, don't display it.
    var isMuted = SA.Models.MuteUser.isMuted(comment.user_id),
      children = '', timestamp, position;

    if (!$.isEmptyObject(comment.children)) {
      children = buildComments(comment.children, false);
    }

    timestamp = new Date(comment.created_on).getTime();

    if (highLightEnabled) {
      position = $.inArray(timestamp, commentsTimestamps);
    }

    var myComment = userId === comment.user_id;

    var nick = SA.Fn.escapeHtml(comment.user_nick);

    if (myComment) {
      userCommentStack[comment.id] = comment.content;
    }
    return win.JST['jst/widgets/comments/comment']({
      isParent: isParent,
      commentId: comment.id,
      topParentId: comment.top_parent_id,
      userId: comment.user_id,
      anchor: buildAnchor(comment.id),
      userLoggedIn: userLoggedIn,
      userImageLink: getAuthorImage(comment.user_id),
      nick: nick,
      authorStatus: buildAuthorStatus(comment.author_slug, comment.is_premium_author, comment.service_id),
      authorSlug: comment.author_slug,
      userType: comment.author_slug ? 'author' : 'user',
      commentsCount: comment.userComCount || getAuthorCommentsCount(comment.user_id),
      followBtn: myComment ? 'Following' : buildFollowBtn(comment.author_slug, comment.user_id, comment.id),
      sendMessageBtn: myComment ? '' : buildMessageBtn(comment.user_id, nick, comment.id),
      muteBtn: myComment ? '' : buildMuteBtn(comment.user_id, nick, comment.id),
      reportAbuseBtn: buildAbuseBtn(comment.id, myComment, !!comment.editBtn),
      editDeleteBtn: buildEditDeleteBtn(comment.id, myComment, !!comment.editBtn),
      timestamp: timestamp,
      publishDate: $.format.date(comment.created_on, 'dd MMM yyyy, hh:mm a'),
      authorLink: comment.commenter_url,
      commentLink: SA.App.host + comment.uri,
      content: renderCommentContent(comment.content, comment.user_id), //workaround double <br> coming from server
      newComment: highLightEnabled && position > -1,
      editBtn: comment.editBtn || (myComment && isCurrentPageType('research')),
      deleteBtn: deleteBtnRule(comment),
      authorReply: isArticleAuthor(comment.user_id),
      likes: buildLikes(comment),
      children: children,
      muted: isMuted,
      disabled: !commentsAllowed(),
      editedByOwner: comment.edited_by_owner
    });
  };

  var instaBuildNoComment = function () {
    commentsWrapper.find('.c-list').html($(win.JST['jst/widgets/comments/no_comments']()));
  };

  function initMuteBtns() {
    $('.sa-mute-btn').each(function () {
      var $this = $(this),
        user = {
          id: $this.data('commenter-id'),
          name: $this.data('nick')
        },
        commentId = $this.data('subject-id');

      new SA.Widgets.MuteUser.Button({
        user: user,
        container: '.sa-mute-btn[data-subject-id="' + commentId + '"]',
        bi: {
          src: 'comment',
          data: { comment_id: commentId }
        },
        onMuteSuccess: function () {
          muteNotification.show($this, user);
        }
      });
    });
  }

  function initUserTagging($input) {
    commentersNames = $.unique($.map(commentsWrapper.find('.c-nick'), function (a) {
      return a.innerHTML;
    })).sort(typeof Intl !== 'undefined' ? Intl.Collator().compare : undefined);

    userTagging.AddUserTagging($input, getSuggestedNamesClb);
  }

  function getSuggestedNamesClb($input) {
    var commentOwnerName = $input.closest('.media-body').data('nick');

    if (commentOwnerName) {
      var commentOwnerNameSpecialChar = commentOwnerName.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;"),
        indexOwner = $.inArray(commentOwnerNameSpecialChar, commentersNames),
        list = commentersNames.slice(0);

      if (indexOwner > 0) {
        list.unshift(commentOwnerName);
        list.splice(indexOwner + 1, 1);
      }
      return list;
    } else {
      return commentersNames;
    }
  }

  var handleCommentsList = function () {
    var commentList = document.getElementsByClassName('c-list');

    if(commentList.length) {
      commentList[0].innerHTML = buildComments(initOpt.comments, true);
    }
    var $newComments = getNewComments(),
      newCommentsCount = $newComments.length;

    if (newCommentsCount) {
      $newComments.each(function (i, el) {
        var $el = $(el);
        if (i === 0) {
          $el.find('.new-nav .up').first().addClass('stop');
        }
        if (i === newCommentsCount - 1) {
          $el.find('.new-nav .down').first().addClass('stop');
        }
        $el.attr('data-new-index', i);
      });
    }
  };

  var buildCommentTree = function () {
    if (initOpt.total === 0) {
      instaBuildNoComment();
    } else {
      handleCommentsList();

      if (showSpecific) {
        scope.scrollToSpecific();
      }
      initMuteBtns();
    }
  };

  // Main Comment Form

  var rebuildFormForComment = function () {
    if (!mainBox) {
      $commentBox.find('.reply-btn').removeClass('hidden').text('Publish');
      $commentBox.find('.update-btn').addClass('hidden').data('commentId', null);
      $commentBox.find('.cb-txt').text('Add Your Comment: (NEW! Use @ to tag a user)');
      $commentBox.find('.box-close').addClass('hidden');
      resetCommentBox();
      mainBox = true;
    }
  };

  var relocateFormForComment = function () {
    rebuildFormForComment();
    initOpt.container.find('.c-comment-box').append($commentBox.detach().data('parentId', null));
  };

  var setBoxCloseEvent = function () {
    $commentBox.find('.box-close').on('click', function (event) {
      event.preventDefault();
      if (userLoggedIn) {
        $('.c-body.hidden').removeClass('hidden');
        relocateFormForComment();
      } else {
        showAuthenticationPopup();
      }
      commentsWrapper.find('.c-list').before(commentForm);
    });
  };

  var tryToSubmitComment = function () {
    var $textInput = $commentBox.find('textarea'),
      commentedElement = getCommentedElement();

    if ($textInput.length && commentedElement) {
      var $userNick = $commentBox.find('input[name="user[userNick]"]');
      if (!$userNick.val().trim()) {
        $userNick.val(rtUserNick());
      }

      promptUpdateUsername('Without a username, we cannot post your comment', function (data) {
        var commentText = $textInput.val().trim();
        if (commentText) {
          addLoader($commentBox.find('.reply-btn'));
          postCommentLock = true;

          commentsModel.submit({
            commentedElement: commentedElement,
            content: commentText,
            tagged: userTagging.GetTaggedUsers(),
            parentId: $commentBox.data('parentId') || '',
            userNick: data.newUsername,
            onSuccess: commentSubmitSuccess,
            onFailure: commentSubmitFailure
          });
          userTagging.ClearTaggedUsers();
        }
      });
    }
  };

  var getAuthPopupMoneData = function () {
    var moneData = {};
    if (isCurrentPageType('article')) {
      moneData.article_id = pageConfig.article.id;
    } else if (isCurrentPageType('single_news')) {
      moneData.mcid = pageConfig.mc.id;
    } else if (isCurrentPageType('single_blog')) {
      moneData.instablog_post_id = pageConfig.instablog.id;
    } else if (isCurrentPageType('research')) {
      moneData.article_id = pageConfig.article_id;
    }
    return moneData;
  };

  var setFormSubmitEvent = function () {
    $commentBox.find('.c-box-form').on('submit', function (event) {
      event.preventDefault();

      if (SA.Data.User.isLimited()) {
        SA.Widgets.LimitedUserAuth.show({
          moneSource: 'publish_comment',
          moneData: getAuthPopupMoneData(),
          onLoginSuccess: tryToSubmitComment
        });
      } else if (!commenterBlocked && !postCommentLock) {
        tryToSubmitComment();
      }
    });
  };

  var setCommentBoxEvent = function () {
    $commentBox.find('textarea').on('keyup input', function (event) {
      var el = event.target;
      toggleDisableButtons(el.value);
      autoExpand(el);
    });
  };

  var autoExpand = function (field) {
    // Reset field height
    field.style.height = 'inherit';

    // Get the computed styles for the element
    var computed = window.getComputedStyle(field);

    // Calculate the height
    var height = parseInt(computed.getPropertyValue('border-top-width'), 10)
      + parseInt(computed.getPropertyValue('padding-top'), 10)
      + field.scrollHeight
      + parseInt(computed.getPropertyValue('padding-bottom'), 10)
      + parseInt(computed.getPropertyValue('border-bottom-width'), 10);

    field.style.height = height + 'px';
  };

  var setFormLoggedOutEvent = function () {
    var $commentBoxForm = $commentBox.find('.c-box-form');

    $commentBoxForm.find('textarea').on('keypress', function () {
      SA.Logger.Mone.event('popup_registration', 'comment_box', 'shown');
      showAuthenticationPopup({ urlHash: '#comments' });
    });

    $commentBoxForm.on('click', function (e) {
      e.preventDefault();
      SA.Logger.Mone.event('popup_registration', 'comment_box', 'shown');
      showAuthenticationPopup({ urlHash: '#comments' });
    });
  };

  var buildCommentBox = function () {
    return $(win.JST['jst/widgets/comments/comment_box']({
      pic: saUser.pictureUrl('small'),
      name: userName,
      link: userProfileLink,
      userLoggedIn: userLoggedIn,
      articleModeratedMsg: pageConfig.articleModeratedMsg
    }));
  };

  var rebuildFormForReply = function () {
    resetCommentBox();
    if (mainBox) {
      $commentBox.find('.reply-btn').text('Reply');
      $commentBox.find('.cb-txt').text('Reply To Comment: (NEW! Use @ to tag a user)');
      $commentBox.find('.box-close').removeClass('hidden');
      mainBox = false;
    }
  };

  var initReplyBtn = function () {
    initOpt.container.on('click', '.ct-reply', function (event) {

      var btn = $(this);

      event.preventDefault();
      if (!commenterBlocked) {
        if (userLoggedIn) {
          if ($commentBox.data('parentId') !== btn.data('comment')) {
            rebuildFormForReply();
            btn.closest('.b-ft').after($commentBox.detach().data('parentId', btn.data('comment')));
            $commentBox.find('textarea').focus();
          }
        } else {
          SA.Logger.Mone.event('popup_registration', 'reply_to_comment', 'shown');
          showAuthenticationPopup({ urlHash: '#comment-' + btn.data('comment') });
        }
      }
    });
  };

  var addYouLike = function (comment, commentId, addPopover) {
    var likeData = usersLiked[commentId],
      othersList = likeData.otherIds;

    comment.prepend(win.JST['jst/widgets/comments/comment_likes_top']({
      authorLiked: likeData.authorLiked,
      count: othersList.length,
      authorName: '<span class="auth">' + getUserName(initOpt.authorUserId) + '</span>'
    }));
    if (addPopover) {
      buildUsersLikedTooltip(comment.find('span.n-others:first'), othersList);
    }
  };

  var updateLikersCount = function ($comment, opts) {
    var $likesCount = $comment.find('.ct-likes-count:first'),
      likesCount = opts.isSuccess && !isNaN(opts.ratings) ? opts.ratings : parseInt($likesCount.text()) + (opts.liked ? 1 : -1);
    changeLikesCount(opts.commentId, $comment, likesCount);
    $likesCount.text(likesCount);
  };

  var changeLikesCount = function (commentId, $comment, likesCount) {
    var topParentId = $comment.data('top-parent-id'),
      topParentComment = initOpt.comments[topParentId];
    if (topParentId === commentId) {
      topParentComment.likes = likesCount;
    } else {
      topParentComment.children[commentId].likes = likesCount;
    }
  };

  var onLikeDone = function (response) {
    response = response || {};
    if (response.success) {
      updateLikersCount(getCommentById(response.id),
                       {liked: true, isSuccess: true, ratings: response.ratings, commentId: response.id});
      SA.Logger.Mone.event('comment_rated');
    }
  };

  var tryToLikeComment = function ($btn) {
    var commentId = $btn.data('comment');
    if (commentId && userId !== $btn.data('user')) {
      $btn.addClass('liked');
      updateLikersCount(getCommentById(commentId),
                        {liked: true, isSuccess: false, ratings: null, commentId: commentId});
      SA.Models.Rating.likeComment(commentId, onLikeDone);
    }
  };

  var rmvYouLike = function (comment) {
    var $likeTop = comment.find('.ct-likes-top:first');
    if ($likeTop.length) {
      $likeTop.remove();
    }
  };

  var onUnlikeDone = function (response) {
    response = response || {};
    if (response.success) {
      updateLikersCount(getCommentById(response.id),
                       {liked: false, isSuccess: true, ratings: response.ratings, commentId: response.id});
      SA.Logger.Mone.event('comment_unrated');
    }
  };

  var tryToUnlikeComment = function ($btn) {
    var commentId = $btn.data('comment');
    if (commentId) {
      $btn.removeClass('liked');
      updateLikersCount(getCommentById(commentId),
                        {liked: false, isSuccess: false, ratings: null, commentId: commentId});
      SA.Models.Rating.unlikeComment(commentId, onUnlikeDone);
    }
  };

  var promptUpdateUsername = function (footerContent, clb) {
    if (!saUser.hasNick()) {
      SA.Widgets.EnterUsername.show({
        footerContent: footerContent,
        onDone: function (data) {
          toggleUsernameUpdated(data.newUsername);

          if ($.isFunction(clb)) {
            clb(data);
          }
        },
        type: 'article'
      });
    } else if ($.isFunction(clb)) {
      clb({ newUsername: rtUserNick() });
    }
  };

  var initLikeBtn = function () {
    initOpt.container.on('click', '.ct-like', function (e) {
      e.preventDefault();

      var $btn = $(e.currentTarget);
      if (userLoggedIn) {
        if ($btn.data('user') !== userId) {
          promptUpdateUsername('Username will be displayed next to your likes', function (data) {
            likeBtnClicked(commenterBlocked, $btn);
          });
        }
      } else {
        SA.Logger.Mone.event('popup_registration', 'like_comment', 'shown');
        showAuthenticationPopup({
          id: 'Comment|' + $btn.data('comment'),
          activity: 'like',
          urlHash: '#comment-' + $btn.data('comment')
        });
      }
    });
  };

  var toggleUsernameUpdated = function (newUsername) {
    userName = newUsername;
    toggleRequiredUserNick();
    $('section#comments').find('a.c-nick[href$="/' + userId + '"], a.c-nick[href*="' + userId + '/"]').text(userName);
    $commentBox.find('input[name="user[userNick]"]').val(userName);
  };

  var likeBtnClicked = function (commenterBlocked, $btn) {
    if (!commenterBlocked) {
      if (userLoggedIn) {
        if ($btn.hasClass('liked')) {
          tryToUnlikeComment($btn);
        } else {
          tryToLikeComment($btn);
        }
      } else {
        showAuthenticationPopup();
      }
    }
  };

  // will implement popups next sprint
  var initLikeCount = function () {
    $.each($('.c-body'), function () {
      var $comment = $(this),
        commentId = $comment.data('commentid');

      if (usersLiked[commentId]) {
        var $likesCount = $comment.find('.ct-likes-count:first'),
          $likesTop = $comment.find('.ct-likes-top:first');
        buildUsersLikedTooltip($likesCount, usersLiked[commentId].allIds);
        //initAllLikesPopup($likesCount, commentId);
        if ($likesTop.length) {
          buildUsersLikedTooltip($likesTop.find('span.n-others:first'), usersLiked[commentId].otherIds);
          //initOtherLikesPopup($likesTop.find('span.n-others:first'), commentId);
        }
      }
    });
  };

  var initializeTree = function () {
    initReplyBtn();
    initLikeBtn();
    initLikeCount();
  };

  var rtUserNick = function () {
    return saData.Cookies.get('user_nick');
  };

  var buildMainCommentForm = function () {
    $commentBox = buildCommentBox();
    $commentBox.data('parentId', null);
    commentForm = commentsWrapper.find('.c-comment-box');
    commentForm.html($commentBox);

    if (userLoggedIn) {
      setBoxCloseEvent();
      setFormSubmitEvent();
      setCommentBoxEvent();

      if (!saUser.hasNick()) {
        toggleRequiredUserNick();
      }

      if (saSocial && initOpt.twitterContent) {
        saSocial.init();
      }

      userHasProfilePicture = saData.MonsterCookie.get('has_picture');
      if (!userHasProfilePicture) {
        showUploadPopUp();
      }

      if (!saUser.hasNick()) {
        setCreateUsernameEvent();
      }
    } else {
      setFormLoggedOutEvent();
    }
  };

  var toggleRequiredUserNick = function () {
    $commentBox.find('#temp_nick_placeholder, .c-nick').toggleClass('hidden');
  };

  // UPDATE BTN

  var rebuildFormUpdate = function (id) {
    $commentBox.find('.reply-btn').addClass('hidden');
    $commentBox.find('.update-btn').removeClass('hidden').data('commentId', id);
    $commentBox.find('.cb-txt').text('Update Comment:');
    $commentBox.find('.box-close').removeClass('hidden');
  };

  var onUpdateFailure = function (response, opt) {
    var comment = getCommentById(opt.id);
    comment.removeClass('hidden');
    removeAllLoaders();
    relocateFormForComment();
    rebuildFormForComment();
    commentsWrapper.find('.c-list').before(commentForm);
  };

  var onUpdateSuccess = function (response, opt) {
    if (response.success) {
      relocateFormForComment();
      rebuildFormForComment();
      removeAllLoaders();
      var $comment = getCommentById(opt.id);
      $comment.find('.b-c-content').html(renderCommentContent(replaceDoubleLines(response.rendered_content), userId));
      highlightComment($comment);
      $comment.removeClass('hidden');
      commentsWrapper.find('.c-list').before(commentForm);

      //Update submitted comment to stack
      userCommentStack[opt.id] = opt.content;

      SA.Logger.Mone.event('comment_updated');
    } else {
      onUpdateFailure(response, opt);
    }
  };

  var tryToUpdateComment = function (id) {
    var content = getCommentBoxVal();
    if (content) {
      commentsModel.update({
        id: id,
        content: content,
        commentedElement: getCommentedElement(),
        tagged: userTagging.GetTaggedUsers(),
        onSuccess: onUpdateSuccess,
        onFailure: onUpdateFailure
      });
      userTagging.ClearTaggedUsers();
    }
  };

  var initUpdateEvent = function () {
    if (!updateListenerActive) {
      updateListenerActive = true;
      commentsWrapper.on('click', '.update-btn', function (event) {
        event.preventDefault();
        var $btn = $(this), commentId = $btn.data('commentId');
        if (commentId && $.isNumeric(commentId)) {
          addLoader($btn);
          tryToUpdateComment(commentId);
        }
      });
    }
  };

  function stripHtml(content) {
    var $d = $($.parseHTML(content)), $a;
    //Put actual url in comment edit box instead of truncated
    $d.find('a').each(function () {
      $a = $(this);
      if ($a.is('[data-type="short_url"][href]')) {
        $a.replaceWith($a.attr('href'));
      } else {
        $a.replaceWith($a.text());
      }
    });
    return $d.text();
  }

  // EDIT BTN

  function handleCommentEdit($comment) {
    var commentId = $comment.data('commentid');

    mainBox = false;
    rebuildFormUpdate(commentId);
    $comment.addClass('hidden');
    setCommentBoxVal(stripHtml(userCommentStack[commentId]));

    if ($comment.data('parentId')) {
      getCommentById($comment.data('parentId')).find('.b-ft:first').after($commentBox.detach());
    }

    initUpdateEvent();
  }

  function appendCommentFormToComment($comment) {
    commentForm = commentsWrapper.find('.c-comment-box');
    $comment.after(commentForm);
  }

  function handleEditClick(e) {
    e.preventDefault();

    if (userLoggedIn && !commenterBlocked) {
      //check if user has this comment in his comments stack on this page
      var $comment = $('#comment-' + $(e.target).data('comment'));
      appendCommentFormToComment($comment);

      if ($comment.length) {
        handleCommentEdit($comment);
      } else {
        SA.exceptions.push(['CommentTree: try to edit not own comment']);
      }
    }
  }

  function initEditBtn() {
    if (!editListenerActive) {
      editListenerActive = true;
      commentsWrapper.on('click', '.c-edit', handleEditClick);
    }
  }

  function disableReplyBtn() {
    initOpt.container.find('.ct-reply').addClass('disabled');
  }

  // DELETE BTN

  var onDeleteFailure = function () {
    deleteCommentPopup.hide();
  };

  var onDeleteSuccess = function (response, opt) {
    if (response === 'delete') {
      var counter, $userComments;

      deleteCommentAndReplies(opt.id);

      deleteCommentPopup.hide();

      // stop tracking edit/delete btns if comment deleted
      win.clearTimeout(deleteEditBtsTimOut);

      // update comments count
      initOpt.total = initOpt.container.find('.c-body').length;
      updateCommentsCounter(initOpt.total);
      $userComments = initOpt.container.find('.u-com-c[data-id="' + userId + '"]');

      // update user comments counters
      if ($userComments.length) {
        counter = parseInt($userComments.text(), 10);
        if (counter && counter > 0) {
          counter -= 1;
          $userComments.text(counter);
        }
      }

      SA.Logger.Mone.event('comment_deleted');
    } else {
      onDeleteFailure();
    }
  };

  var onModerationSuccess = function (response, opt) {
    if (response === 'success') {
      deleteCommentAndReplies(opt.id);

      // update counters
      initOpt.total = initOpt.container.find('.c-body').length;
      updateCommentsCounter(initOpt.total);

      deleteCommentPopup.hide();
    } else {
      onDeleteFailure();
    }
  };

  var onModerationFailure = function () {
    onDeleteFailure();
  };

  var deleteNewComment = function (id) {
    commentsModel.deleteComment({
      id: id,
      onSuccess: onDeleteSuccess,
      onFailure: onDeleteFailure
    });
  };

  var deleteWithModeration = function (id) {
    commentsModel.moderationDelete({
      id: id,
      onSuccess: onModerationSuccess,
      onFailure: onModerationFailure
    });
  };

  var deleteComment = function (id) {
    id = id || 0;
    if (id) {
      if (justCreatedComment(id)) {
        return deleteNewComment(id);
      }
      if (isArticleAuthor(userId) || isArticleModerator()) {
        return deleteWithModeration(id);
      }
      deleteCommentPopup.hide();
    }
  };

  var initDeleteEvent = function ($comment) {
    var btn = deleteCommentPopup.getModalObject().find('.conf-com-delete');
    removeLoader(btn);
    deleteCommentPopup.getModalObject().find('.conf-com-delete').unbind('click').on('click', function (e) {
      e.preventDefault();
      addLoader($(e.currentTarget));
      deleteComment($comment.data('commentid'));
    });
  };

  var handleCommentDelete = function ($comment) {
    var popup = getDeletePopup();
    popup.getModalObject().find('.conf-com-delete').data('comment', '').data('comment', $comment.data('commentid'));
    popup.innerBody(hasChildren($comment.data('commentid')) ? win.JST['jst/widgets/comments/delete_popup/moderation_body']() : win.JST['jst/widgets/comments/delete_popup/body']());
    initDeleteEvent($comment);
    popup.show();
  };

  var handleDeleteClick = function (btn) {
    if (isArticleAuthor(userId) || isArticleModerator() || userCommentStack[btn.data('comment')]) {
      var $comment = getCommentById(btn.data('comment'));
      if ($comment.length) {
        handleCommentDelete($comment);
      } else {
        SA.exceptions.push(['CommentTree: try to delete not own comment']);
      }
    }
  };

  var initDeleteBtn = function () {
    if (!deleteListenerActive) {
      deleteListenerActive = true;
      commentsWrapper.on('click', '.c-delete', function (e) {
        if (userLoggedIn && !commenterBlocked) {
          e.preventDefault();
          e.stopPropagation();
          handleDeleteClick($(e.currentTarget));
        }
      });
    }
  };


  // POST COMMENT CALLBACKS

  var commentSubmitFailure = function (response) {
    postCommentLock = false;
    removeAllLoaders();
  };

  var handleModerated = function (opt, response) {
    showModerationPopup(response);
    removeAllLoaders();
    resetCommentBox();

    //put form back to bottom if submitted from child
    if (opt.parentId) {
      relocateFormForComment();
    }
  };

  var handleCommentsLimit = function (opt) {
    saPopup.build({
      className: 'sa-moderation-popup',
      backdrop: true,
      keyboard: true,
      headerContent: win.JST['jst/widgets/comments/limit_popup/header'](),
      footerContent: win.JST['jst/widgets/comments/limit_popup/footer'](),
      bodyContent: win.JST['jst/widgets/comments/limit_popup/item_body'](),
      removeAfterClose: true
    }).show();
    handleBlockedUser(opt);
  };

  var handleBlockedUser = function (opt) {
    commenterBlocked = true;
    removeAllLoaders();
    resetCommentBox();

    //put form back to bottom if submitted from child
    if (opt.parentId) {
      relocateFormForComment();
    }
  };

  var handleLimitedUser = function () {
    SA.Widgets.LimitedUserAuth.show({
      moneSource: 'publish_comment',
      moneData: getAuthPopupMoneData(),
      onLoginSuccess: function () {
        $commentBox.find('.c-box-form').submit();
      }
    });
  };

  var handleDuplicateComment = function () {
    saPopup.build({
      className: 'sa-moderation-popup',
      backdrop: true,
      keyboard: true,
      headerContent: win.JST['jst/widgets/comments/duplicate_popup/header'](),
      footerContent: win.JST['jst/widgets/comments/duplicate_popup/footer'](),
      bodyContent: win.JST['jst/widgets/comments/duplicate_popup/item_body'](),
      removeAfterClose: true
    }).show();
  };

  var handleFailedNick = function () {
    saPopup.build({
      className: 'sa-moderation-popup',
      backdrop: true,
      keyboard: true,
      headerContent: win.JST['jst/widgets/comments/failed_nick_popup/header'](),
      footerContent: win.JST['jst/widgets/comments/failed_nick_popup/footer'](),
      bodyContent: win.JST['jst/widgets/comments/failed_nick_popup/item_body'](),
      removeAfterClose: true
    }).show();
  };

  var insertTreeComment = function (comment) {
    if (initOpt.total === 0) {
      commentsWrapper.find('.no-c').remove();
    }

    var wrapper = commentsWrapper.find('.c-list')[0];

    if(wrapper) {
      wrapper.insertBefore(comment, wrapper.firstChild);
    }
  };

  var insertNodeComment = function (comment, parentId) {
    var replyComment = getCommentById(parentId), replyNode = replyComment[0], replyParent;
    if (replyComment.data('parent')) {
      replyParent = replyComment.find('.b-ft')[0];
      replyParent.parentNode.insertBefore(comment, replyParent.nextSibling);
    } else {
      replyNode.parentNode.insertBefore(comment, replyNode.nextSibling);
    }
  };

  var insertComment = function (comment, opt) {
    removeAllLoaders();
    resetCommentBox();

    if (opt.parentId) {
      relocateFormForComment();
      insertNodeComment(comment[0], opt.parentId);
    } else {
      insertTreeComment(comment[0]);
    }

    updateCommentsCounter(++initOpt.total);
    initEditBtn();
    initDeleteBtn();
  };

  var toggleDisableButtons = function (text) {
    $commentBox.find('.reply-btn, .update-btn').prop('disabled', !text.trim().length);
  };

  var deleteEditButtons = function (comment) {
    deleteEditBtsTimOut = setTimeout(function () {
      comment.find('.c-edit').remove();
      if (!isArticleAuthor(userId)) {
        comment.find('.c-delete').remove();
      }
    }, DELETE_EDIT_BTS_TIME);
  };

  var setCommentTimeouts = function (comment) {
    highlightComment(comment);
    deleteEditButtons(comment);
  };

  var subscribeToTrack = function () {
    if (!initOpt.tracking) {
      subscribeCommentsTrack(true, trackComments);
    }
  };

  var commentSubmitted = function (response, opt) {
    var counter = response.comments_count ? parseInt(response.comments_count, 10) : 0,
      comment = $(renderCommentNode({
        id: response.id,
        user_id: userId,
        html_anchor: buildAnchor(response.id),
        user_nick: userName,
        author_slug: userSlug,
        created_on: response.created_on,
        commenter_url: userProfileLink,
        content: replaceDoubleLines(response.rendered_content),
        editBtn: true,
        deleteBtn: true,
        children: {},
        userComCount: counter
      }, !opt.parentId));

    // stop tracking prev comment timeout
    win.clearTimeout(deleteEditBtsTimOut);

    setCommentTimeouts(comment);

    insertComment(comment, opt);

    // update comments counters
    initOpt.container.find('.u-com-c[data-id="' + userId + '"]').text(counter);

    // save parent in case of update
    comment.data('parentId', opt.parentId);
    comment.data('content-url', comment[0].baseURI + '#comment-' + response.id);

    // Push submitted comment to stack
    userCommentStack[response.id] = opt.content;

    // Add submitted comment to comments list
    initOpt.comments = initOpt.comments || {};
    if (!opt.parentId) {
      $.extend(true, initOpt.comments, response.comment);
    } else {
      var topParentComment = findTopParentComment(opt.parentId);
      $.extend(true, topParentComment.children, response.comment);
    }

    // Subscribe user to tracking
    subscribeToTrack();

    SA.Logger.Mone.event('comment_submitted', '', '', {
      data: {
        comment_id: response.id
      }
    });
  };

  function findParentComment(comments, commentId) {
    var parentComment;
    if ($.isEmptyObject(comments)) return null;
    if (commentId in comments) return comments[commentId];

    for (var cId in comments) {
      var comment = comments[cId];
      parentComment = findParentComment(comment.children, commentId);
      if (parentComment) {
        return parentComment;
      }
    }
  }

  function findTopParentComment(commentId) {
    var topParentComment;
    while (commentId) {
      topParentComment = findParentComment(initOpt.comments, commentId);
      if (!topParentComment) return null;
      if (!topParentComment.parent_id) return topParentComment;
      commentId = topParentComment.parent_id;
    }
  }

  var commentSubmitSuccess = function (response, opt) {
    postCommentLock = false;
    var commentOpt = {};
    if (response) {
      commentOpt = { commentId: response.id };
    } else {
      response = '';
    }
    opt = opt || {};
    removeAllLoaders();

    var social_content = 'Commented on ' + initOpt.twitterContent;
    if (response.success) {
      if (saSocial) {
        saSocial.postToAll(social_content, commentOpt);
      }
      return commentSubmitted(response, opt);
    }

    switch (response.message) {
      case 'blocked_user':
        return handleBlockedUser(opt);

      case 'limited_user':
        return handleLimitedUser();

      case 'passed_submit_limit':
        return handleCommentsLimit(opt);

      case 'moderated_user':
      case 'moderated_item':
        if (saSocial) {
          saSocial.postToAll(social_content, commentOpt);
        }
        return handleModerated(opt, response);

      case 'login_failed':
        return showAuthenticationPopup();

      case 'duplicate_comment':
        return handleDuplicateComment();

      case 'no_user_nick':
        return handleFailedNick();
    }
  };

  // COMMENTS TRACKING SHOW

  var initScrollToComments = function () {
    initOpt.container.on('click', '.down, .up', function () {
      var $this = $(this);
      if (!$this.hasClass('stop')) {
        var isNext = $this.hasClass('down'),
          index = $this.closest('.c-body').data('new-index'),
          targetIndex = index + (isNext ? 1 : -1),
          $target = getNewCommentByIndex(targetIndex);
        if ($target.length) {
          scrollTo($target);
        }
      }
    });
  };

  var initNewCommentShow = function () {
    if (commentsTimestamps.length) {
      var $comment = getNewCommentByIndex(0);
      if ($comment.length) {
        scrollTo($comment);
      } else {
        SA.exceptions.push(['CommentTree: scroll to new comment failed in url: ' + win.document.location.pathname]);
      }
      initScrollToComments();
    }
  };

  var initNewCommentsLink = function () {
    if (commentsTimestamps.length) {
      var newCommentsCount = getNewComments().length;
      if (newCommentsCount) {
        commentsWrapper.find('.new-comments-link').text(newCommentsCount + ' new').removeClass('hidden').click(function () {
          var $comment = getNewCommentByIndex(0);
          if ($comment.length) {
            scrollTo($comment);
          }
        });
      }
    }
  };

  function scrollTo(element) {
    $(win).scrollTo(element, scrollSpeed, {
      offset: {
        top: -Math.abs(headerHeight)
      }
    });
  }

  // parse timestamps if new comments show

  var getCommentsTimestamp = function (comments) {
    var ts, isMuted;
    $.map(comments, function (comment) {
      ts = new Date(comment.created_on).getTime();
      isMuted = SA.Models.MuteUser.isMuted(comment.user_id);
      if (ts >= lastVisitTimestamp && userName !== comment.user_nick && !isMuted) {
        commentsTimestamps.push(ts);
      }
      if (!$.isEmptyObject(comment.children)) {
        getCommentsTimestamp(comment.children);
      }
    });
  };

  // comments anchors

  var initAnchors = function () {
    initOpt.container.on('click', '.ar', function () {
      scrollTo($(this).closest('.c-body'));
    });
  };

  // CALLBACKS ON SERVER RESPONSE
  // InstablogPost \ Article type supported

  var modelCommentsGetSuccess = function (response) {
    initOpt = $.extend({}, initOpt, response);
    var shouldRender = $.isFunction(initOpt.shouldRender) ? initOpt.shouldRender(response) : true;

    if (commentsDisabled()) {
      insertCommentsWrapper();
      insertActions();
      insertCommentsDisableMsg();
      hideCommentsLoader();
    } else if (shouldRender) { // Extend initOpt with response
      // Four lines were moved here from init() because of shouldRender refactor
      // In some cases init() could be called more then one time(pro paywall page), if you take it out comments header may be broken
      insertCommentsWrapper();
      initEditBtn();

      SA.Widgets.ContentPopup.new({
        globalWrapper: '.c-wrap',
        containerSelector: '.c-body .media-body',
        togglerSelector: '.c-content-popup-toggler'
      });
      muteNotification = new SA.Widgets.Comments.MuteNotification();
      if (showSpecific) {
        buildCommentTree();
      }

      // delivery callback before rendering comment tree
      if ($.isFunction(initOpt.afterDeliver)) {
        initOpt.afterDeliver(response);
      }

      // clean response
      response = null;

      if (highLightEnabled && !$.isEmptyObject(initOpt.comments)) {
        getCommentsTimestamp(initOpt.comments);
      }

      buildCommentTracker();

      if (!showSpecific) {
        buildCommentTree();
      }

      updateCommentsCounter(initOpt.total);

      if (!initOpt.hideResponseForm && commentsAllowed()) {
        buildMainCommentForm();
      } else {
        disableReplyBtn();
        insertCommentsDisableMsg();
      }

      initializeTree();

      hideCommentsLoader();

      if (isArticleAuthor(userId) || isArticleModerator()) {
        initDeleteBtn();
      }

      if (highLightEnabled && !$.isEmptyObject(initOpt.comments)) {
        initNewCommentShow();
        initNewCommentsLink();
      }

      initCommentsPopup();

      initAnchors();

      initMarketplaceFocus();

      initUserTagging(initOpt.container.find('.c-comment-box .c-box-form textarea'));

      afterRender();

      if ($.isFunction(initOpt.doneCallback)) {
        initOpt.doneCallback();
      }
    } else {
      $('.sa-comment-block h3.pull-left span').remove();
      $('.sa-comment-block h3.pull-left').text(response.message);
      $('section#comments .c-list').removeClass('sa-com-loading');
    }
  };

  function initMarketplaceFocus() {
    if (saUser.adblockScore() < 4) {
      if (userLoggedIn && !saUser.isProPlus() && pageConfig.firstResearchAuthor && !showSpecific && scope.commentsCount > 0) {
        $('#a-comments').click(function () {
          SA.Logger.Mone.event('view_comments', null, 'click');
        });
      }
    }
  }

  var renderDeliverFail = function () {
    commentsWrapper.find('.c-list').append($(win.JST['jst/widgets/comments/delivery_failure']()));
  };

  var modelCommentsGetFailure = function () {
    insertCommentsWrapper();
    renderDeliverFail();
    hideCommentsLoader();
  };

  // INIT TREE BUILDER WITH LOADER
  var insertCommentsWrapper = function () {
    // Cache comment wrapper ref
    commentsWrapper = $(win.JST['jst/widgets/comments/wrapper']()).find('.c-list').addClass('sa-com-loading').end();
    initOpt.container.append(commentsWrapper);
  };

  // Upload picture popup
  var showUploadPopUp = function () {
    $commentBox.find('.upload-link').removeClass('hidden').find('a').on('click', function (e) {
      e.preventDefault();
      SA.Widgets.UploadUserImagePopUp.show({
        container: initOpt.container,
        callback: setPictureAfterUpload
      });
    });
  };

  //Callback after user upload picture
  var setPictureAfterUpload = function () {
    var imgSrc = saUser.pictureUrl('small').replace(/\d+$/, new Date().getTime()), // get not cached img
      arrOfUserImages = $('[data-userid="' + userId + '"]').find('img'); //all pictures of previos comments fot he user
    arrOfUserImages = arrOfUserImages.add($('#com-box .media-left').find('img')); //current form picture
    arrOfUserImages.each(function () {
      $(this).attr('src', imgSrc);
    });
    $commentBox.find('.upload-link').addClass('hidden');
  };

  // Create username click
  var setCreateUsernameEvent = function () {
    $commentBox.find('.create-username').on('click', function (e) {
      e.preventDefault();
      promptUpdateUsername();
    });
  };

  // TREE INITIALIZER AND STRATEGY

  function init() {
    // set container type in case multiple types on page
    initOpt.container.data('type', initOpt.type);

    o = SA.Utils.Observer;
    commentsModel.getModelComments({
      id: initOpt.id,
      type: initOpt.type,
      commentType: initOpt.commentType,
      onSuccess: modelCommentsGetSuccess,
      onFailure: modelCommentsGetFailure
    });
  }

  function afterRender() {
    if (showComments() && !showSpecific && !scope.showTimestamped) {
      initOpt.container.removeClass('hide');
      setTimeout(function () {
        $('html, body').scrollTop(initOpt.container.offset().top);
      }, 500);
    } else if (initOpt.replaceWithButton) {
      initOpt.container.before('<a href="#" class="btn btn-default btn-comments-all" data-id="' + initOpt.id + '">View Comments</a>');
    } else {
      initOpt.container.removeClass('hide');
    }
  }

  function showComments() {
    var params = win.location.href.split('#');
    return SA.Fn.param('comments') === 'show' || (params.length === 2 && /comment/i.test(params));
  }

  function inDiscussionState(states) {
    return $.inArray(initOpt.discussion_status, states) > -1;
  }

  function commentsAllowed() {
    return inDiscussionState([DiscussionState.allowed]);
  }

  function commentsDisabled() {
    return inDiscussionState([DiscussionState.disabled]);
  }

  function insertCommentsDisableMsg() {
    var $cCommentBox = initOpt.container.find('.c-comment-box');
    $cCommentBox
      .html(initOpt.discussion_message)
      .removeClass('sa-com-loading');

    if (SA.Data.User.loggedIn()) {
      $cCommentBox.addClass('add-com-discussion-message');
    }
  }

  // public methods

  scope.init = function (opt) {
    initOpt = $.extend({}, initOpt, opt);
    // defaultCommentsOrder();
    if (initOpt.id && ($.inArray(initOpt.type, typeList) !== -1)) {
      initOpt.container.addClass('sa-comment-block');
      SA.run(init, 'comment-tree');
    } else {
      SA.exceptions.push(['CT: no id']);}

  };

  function defaultCommentsOrder(){
    if ($.inArray(initOpt.type, PAYWALLED_CONTENT_TYPES) > -1  && daysAfterContentPublished() >= 10){
     sortBy = SORT_TYPES.mostLiked;
    }
    else {
      sortBy = SORT_TYPES.newest;
    }
  }

  function daysAfterContentPublished(){
    var publishDate = Date.parse(initOpt.publishDate);
    if (publishDate){
      var diff = Date.now() - publishDate;
      return Math.floor(diff / (1000 * 60 * 60 * 24));
    }
    else
      return 1;
  }

  scope.scrollToSpecific = function () {
    var offset = $('#main-nav-wrapper-row').height();

    if ($(win.location.hash).length) {
      $(win.location.hash)[0].scrollIntoView();
    } else {
      var commentSection = $('section#comments');
      if (commentSection.hasClass('hide')) {
        commentSection.removeClass('hide');
      }
      commentSection[0].scrollIntoView();
    }
    win.scrollBy(0, -offset);
  };

  scope.showTimestamped = highLightEnabled;
  scope.showSpecific = showSpecific;

  scope.getMostRecentCommentTime = function (comments) {
    var mostRecentTs = 0,
      mostRecentCommentTime = '',
      children,
      commentCreated;

    for (var key in comments) {
      commentCreated = comments[key].created_on;
      if (mostRecentTs < Date.parse(commentCreated)) {
        mostRecentTs = Date.parse(commentCreated);
        mostRecentCommentTime = commentCreated;
      }

      if (comments[key].children) {
        children = comments[key].children;

        for (var cKey in children) {
          commentCreated = children[cKey].created_on;
          if (mostRecentTs < Date.parse(commentCreated)) {
            mostRecentTs = Date.parse(commentCreated);
            mostRecentCommentTime = commentCreated;
          }
        }
      }
    }
    return mostRecentCommentTime ? $.format.date(mostRecentCommentTime, 'dd MMM yyyy, hh:mm a') : '';
  };

}(window, window.SA, window.jQuery));

(function(w, SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Widgets.Presentation'),
    mone = SA.Logger.Mone,
    pClass = '.sa-presentation-carousel', $presentation = $(pClass), options,
    preload = 3, initial = 0, lastRefreshTs = 0, refreshInterval = 10 * 1000;

  var pageIsArticle = function () {
    return SA.pageConfig.Data && SA.pageConfig.Data.article && !SA.pageConfig.Data.article.isTranscript;
  };

  var pageType = function () {
    return pageIsArticle() ? "article" : "earnings_slides";
  };

  var getPreloadNum = function($pr) {
    return parseInt($pr.data('preload'), 10) || preload;
  };

  var getSlidesCount = function($pr) {
    return parseInt($pr.data('slides-count'), 10) || 1;
  };

  var activeSlideNum = function($pr) {
    return parseInt($pr.find('.item.active').data('index'), 10) || 1;
  };

  var updateCurrentNum = function($pr, num) {
    $pr.find('.current-slide').html(num);
  };

  var getNotes = function($pr, num) {
    return $pr.find('.item').eq(num-1).find('img').data('notes') || '';
  };

  var refreshAds = function() {
    var now = new Date().getTime();
    if (now - lastRefreshTs >= refreshInterval) {
      SA.execIfResolved(['SA.Ads.Initializer'], function(i) {
        i.redefine([], {r: 'f'}, {r: 't'});
        lastRefreshTs = now;
      });
    }
  };

  var preloadSlide = function($pr, num) {
    var pload = getPreloadNum($pr),
      start = num - pload,
      finish = num + pload,
      count = getSlidesCount($pr),
      items = $pr.find('.item'), i, $slide, $img;

    i = start < 0 ? 0 : start;
    finish = finish > count ? count : finish;
    for (i; i <= finish; i++) {
      $slide = items.eq(i);
      $img = $slide.find('img');
      if(!$img.attr('src')) {
        $img.attr('src', $img.data('src'));
      }
    }
  };

  var updateNotes = function ($pr, num) {
    var notes = getNotes($pr, num), $wrapper = $pr.find('.notes');
    if (notes) {
      $wrapper.find('.note-ctn').text(notes);
      $wrapper.find('.ttl').removeClass('hidden');
    } else {
      $wrapper.find('.note-ctn').text('');
      $wrapper.find('.ttl').addClass('hidden');
    }
  };

  var moveToSlide = function($pr, num){
    preloadSlide($pr, num - 1);
    updateCurrentNum($pr, num);
    $pr.carousel(num - 1);
  };

  var initState = function() {
    var $pr, slide;
    $.each($presentation, function(i){
      $pr = $presentation.eq(i);
      slide = parseInt(SA.Fn.param($pr.attr('id')), 10) || 1;
      if(slide !== initial && slide > 0 && slide <= getSlidesCount($pr)) {
        moveToSlide($pr, slide);
      }
    });
  };

  var initCarousel = function() {
    $presentation.carousel({
      interval:false,
      wrap: false,
      keyboard: false
    });
    initState();
  };

  var slide = function($pr, next) {
    var dir = next ? 'next' : 'prev';
    $pr.carousel(dir);
  };

  var initNext = function () {
    $presentation.on('click', '.pres-n-s', function (e) {
      e.preventDefault();
      var $btn = $(this),
        $pr = $btn.closest(pClass),
        num = activeSlideNum($pr);

      if (num < getSlidesCount($pr)) {
        slide($pr, true);
        updateCurrentNum($pr, num + 1);
        preloadSlide($pr, num);
        if(options.refreshAds !== false) {
          refreshAds();
        }
        updateNotes($pr, num + 1);

        if (pageIsArticle()) {
          mone.event("embedded_slideshow", pageType(), "next_slide", {
            data: {
              "slideshow_id": getPresentationId($pr.attr('id')),
              "upcoming_slide": num + 1,
              "slideshow_length": $pr.data('slides-count')
            }
          });
        } else {
          mone.pv({saSource: 'next_slide_' + (num + 1)});
        }
      }
    });
  };

  var initPrev = function () {
    $presentation.on('click', '.pres-p-s', function (e) {
      e.preventDefault();
      var $btn = $(this),
        $pr = $btn.closest(pClass),
        num = activeSlideNum($pr);

      if (num > 1) {
        slide($pr, false);
        updateCurrentNum($pr, num - 1);
        preloadSlide($pr, num);
        if (options.refreshAds !== false) {
          refreshAds();
        }
        updateNotes($pr, num - 1);

        if (pageIsArticle()) {
          mone.event("embedded_slideshow", pageType(), "prev_slide", {
            data: {
              "slideshow_id": getPresentationId($pr.attr('id')),
              "upcoming_slide": num - 1,
              "slideshow_length": $pr.data('slides-count')
            }
          });
        } else {
          mone.pv({saSource: 'prev_slide_' + (num - 1)});
        }
      }
    });
  };

  function toTop() {
    $('.table-popup').animate({scrollTop: '0px'}, 1);
  }

  var initEnlarge = function() {
    $presentation.on('click', '.press-overlay', function(e) {
      e.preventDefault();
      var $pres = $(this).closest(pClass),
        data = getImagesData($pres),
        id = $pres.attr('id'),
        count = $pres.data('slides-count'),
        presentationId = getPresentationId(id);

      $.magnificPopup.open({
        key: id,
        items: data.images,
        gallery: {
          enabled: true
        },
        callbacks: {
          open: function() {
            var mfp = $.magnificPopup.instance,
              proto = $.magnificPopup.proto;

            mone.event("enlarge_slideshow", pageType(), "click", {
              data: {
                "slideshow_id": presentationId,
                "slide": this.index + 1,
                "slideshow_length": count
              }
            });

            // extend function that moves to next item
            mfp.next = function() {
              toTop();
              var next = this.index + 2;
              next = next > count ? 1 : next;

              if (options.onEnlargeSlideSwitch) options.onEnlargeSlideSwitch('next', next, count);
              proto.next.call(mfp);

              mone.event("enlarge_slideshow", pageType(), "next_slide", {
                data: {
                  "slideshow_id": presentationId,
                  "upcoming_slide": next,
                  "slideshow_length": count
                }
              });
            };

            // same with prev method
            mfp.prev = function() {
              toTop();
              var prev = this.index;
              prev = prev === 0 ? count : prev;

              if (options.onEnlargeSlideSwitch) options.onEnlargeSlideSwitch('prev', prev, count);
              proto.prev.call(mfp);

              mone.event("enlarge_slideshow", pageType(), "prev_slide", {
                data: {
                  "slideshow_id": presentationId,
                  "upcoming_slide": prev,
                  "slideshow_length": count
                }
              });
            };

            if (options.onSlideEnlarge) options.onSlideEnlarge(this.index + 1, count);
          }
        },
        type: 'image',
        mainClass: 'table-popup'
        // You may add options here, they're exactly the same as for $.fn.magnificPopup call
        // Note that some settings that rely on click event (like disableOn or midClick) will not work here
      }, data.index);
    });
  };

  var getPresentationId = function (id) {
    return id.replace("sa-carousel-", "");
  };

  var getImagesData = function (elem) {
    var images = [], index = 0;
    $(elem).find('.item img').each(function (i, img) {
      images.push({src: $(img).data('src')});

      if ($(img).closest('.item').is('.active')) index = i;
    });

    return {
      images: images,
      index: index
    };
  };

  var initBtn = function() {
    initNext();
    initPrev();
    initEnlarge();
  };

  var init = function() {
    initCarousel();
    initBtn();
  };

  scope.downloadPdf = function(){
    var url = $presentation.data('src');
    url = element.data('src');
    top.location.href = url;
  };

  scope.init = function(opt) {
    options = opt || {};
    init();
  };

  scope.updateFields = function() {
    $presentation = $(pClass);
  };

}(window, SA || {}, jQuery));
/*!
 * @copyright &copy; Kartik Visweswaran, Krajee.com, 2013 - 2015
 * @version 3.5.2
 *
 * A simple yet powerful JQuery star rating plugin that allows rendering
 * fractional star ratings and supports Right to Left (RTL) input.
 *
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */

(function ($) {
    "use strict";
    String.prototype.replaceAll = function (from, to) {
        return this.split(from).join(to);
    };
    var DEFAULT_MIN = 0, DEFAULT_MAX = 5, DEFAULT_STEP = 0.5,
        isEmpty = function (value, trim) {
            return value === null || value === undefined || value.length === 0 || (trim && $.trim(value) === '');
        },
        addCss = function ($el, css) {
            $el.removeClass(css).addClass(css);
        },
        validateAttr = function ($input, vattr, options) {
            var chk = isEmpty($input.data(vattr)) ? $input.attr(vattr) : $input.data(vattr);
            return chk ? chk : options[vattr];
        },
        getDecimalPlaces = function (num) {
            var match = ('' + num).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);
            return !match ? 0 : Math.max(0, (match[1] ? match[1].length : 0) - (match[2] ? +match[2] : 0));
        },
        applyPrecision = function (val, precision) {
            return parseFloat(val.toFixed(precision));
        },
        Rating = function (element, options) {
            this.$element = $(element);
            this.init(options);
        };

    Rating.prototype = {
        constructor: Rating,
        _parseAttr: function (vattr, options) {
            var self = this, $el = self.$element;
            if ($el.attr('type') === 'range' || $el.attr('type') === 'number') {
                var val = validateAttr($el, vattr, options), chk, final;
                switch (vattr) {
                    case 'min':
                        chk = DEFAULT_MIN;
                        break;
                    case 'max':
                        chk = DEFAULT_MAX;
                        break;
                    default:
                        chk = DEFAULT_STEP;
                }
                final = isEmpty(val) ? chk : val;
                return parseFloat(final);
            }
            return parseFloat(options[vattr]);
        },
        listenClick: function($el, callback) {
            $el.on('click touchstart', function(e) {
                e.stopPropagation();
                e.preventDefault();
                if (e.handled !== true) {
                    callback(e);
                    e.handled = true;
                } else {
                    return false;
                }
            });
        },
        setDefault: function (key, val) {
            var self = this;
            if (isEmpty(self[key])) {
                self[key] = val;
            }
        },
        getPosition: function (e) {
            var pageX = e.pageX || e.originalEvent.touches[0].pageX;
            return pageX - this.$rating.offset().left;
        },
        listen: function () {
            var self = this, pos, out;
            self.initTouch();
            self.listenClick(self.$rating, function(e) {
                if (self.inactive) {
                    return false;
                }
                pos = self.getPosition(e);
                self.setStars(pos);
                self.$element.trigger('change').trigger('rating.change', [self.$element.val(), self.$caption.html()]);
                self.starClicked = true;
            });
            self.$rating.on("mousemove", function (e) {
                if (!self.hoverEnabled || self.inactive) {
                    return;
                }
                self.starClicked = false;
                pos = self.getPosition(e);
                out = self.calculate(pos);
                self.toggleHover(out);
                self.$element.trigger('rating.hover', [out.val, out.caption, 'stars']);
            });
            self.$rating.on("mouseleave", function () {
                if (!self.hoverEnabled || self.inactive || self.starClicked) {
                    return;
                }
                out = self.cache;
                self.toggleHover(out);
                self.$element.trigger('rating.hoverleave', ['stars']);
            });
            self.$clear.on("mousemove", function () {
                if (!self.hoverEnabled || self.inactive || !self.hoverOnClear) {
                    return;
                }
                self.clearClicked = false;
                var caption = '<span class="' + self.clearCaptionClass + '">' + self.clearCaption + '</span>',
                    val = self.clearValue, width = self.getWidthFromValue(val);
                out = {caption: caption, width: width, val: val};
                self.toggleHover(out);
                self.$element.trigger('rating.hover', [val, caption, 'clear']);
            });
            self.$clear.on("mouseleave", function () {
                if (!self.hoverEnabled || self.inactive || self.clearClicked || !self.hoverOnClear) {
                    return;
                }
                out = self.cache;
                self.toggleHover(out);
                self.$element.trigger('rating.hoverleave', ['clear']);
            });
            self.listenClick(self.$clear, function () {
                if (!self.inactive) {
                    self.clear();
                    self.clearClicked = true;
                }
            });
            $(self.$element[0].form).on("reset", function () {
                if (!self.inactive) {
                    self.reset();
                }
            });
        },
        destroy: function () {
            var self = this, $el = self.$element;
            if (!isEmpty(self.$container)) {
                self.$container.before($el).remove();
            }
            $.removeData($el.get(0));
            $el.off('rating').removeClass('hide');
        },
        create: function (options) {
            var self = this, $el = self.$element;
            options = options || self.options || {};
            self.destroy();
            $el.rating(options);
        },
        setTouch: function (e, flag) {
            var self = this, isTouchCapable = 'ontouchstart' in window ||
                (window.DocumentTouch && document instanceof window.DocumentTouch);
            if (!isTouchCapable || self.inactive) {
                return;
            }
            var ev = e.originalEvent, touches = ev.touches || ev.changedTouches, pos = self.getPosition(touches[0]);
            if (flag) {
                self.setStars(pos);
                self.$element.trigger('change').trigger('rating.change', [self.$element.val(), self.$caption.html()]);
                self.starClicked = true;
            } else {
                var out = self.calculate(pos), caption = out.val <= self.clearValue ? self.fetchCaption(self.clearValue) : out.caption,
                    w = self.getWidthFromValue(self.clearValue),
                    width = out.val <= self.clearValue ? (self.rtl ? (100 - w) + '%' : w + '%') : out.width;
                self.$caption.html(caption);
                self.$stars.css('width', width);
            }
        },
        initTouch: function () {
            var self = this;
            self.$rating.on("touchstart touchmove touchend", function (e) {
                var flag = (e.type === "touchend");
                self.setTouch(e, flag);
            });
        },
        initSlider: function (options) {
            var self = this;
            if (isEmpty(self.$element.val())) {
                self.$element.val(0);
            }
            self.initialValue = self.$element.val();
            self.setDefault('min', self._parseAttr('min', options));
            self.setDefault('max', self._parseAttr('max', options));
            self.setDefault('step', self._parseAttr('step', options));
            if (isNaN(self.min) || isEmpty(self.min)) {
                self.min = DEFAULT_MIN;
            }
            if (isNaN(self.max) || isEmpty(self.max)) {
                self.max = DEFAULT_MAX;
            }
            if (isNaN(self.step) || isEmpty(self.step) || self.step === 0) {
                self.step = DEFAULT_STEP;
            }
            self.diff = self.max - self.min;
        },
        init: function (options) {
            var self = this, $el = self.$element, defaultStar, starVal, starWidth;
            self.options = options;
            $.each(options, function (key, value) {
                self[key] = value;
            });
            self.starClicked = false;
            self.clearClicked = false;
            self.initSlider(options);
            self.checkDisabled();
            self.setDefault('rtl', $el.attr('dir'));
            if (self.rtl) {
                $el.attr('dir', 'rtl');
            }
            defaultStar = (self.glyphicon) ? '\ue006' : '\u2605';
            self.setDefault('symbol', defaultStar);
            self.setDefault('clearButtonBaseClass', 'clear-rating');
            self.setDefault('clearButtonActiveClass', 'clear-rating-active');
            self.setDefault('clearValue', self.min);
            addCss($el, 'form-control hide');
            self.$clearElement = isEmpty(options.clearElement) ? null : $(options.clearElement);
            self.$captionElement = isEmpty(options.captionElement) ? null : $(options.captionElement);
            if (self.$rating === undefined && self.$container === undefined) {
                self.$rating = $(document.createElement("div")).html('<div class="rating-stars"></div>');
                self.$container = $(document.createElement("div"));
                self.$container.before(self.$rating).append(self.$rating);
                $el.before(self.$container).appendTo(self.$rating);
            }
            self.$stars = self.$rating.find('.rating-stars');
            self.generateRating();
            self.$clear = !isEmpty(self.$clearElement) ? self.$clearElement : self.$container.find('.' + self.clearButtonBaseClass);
            self.$caption = !isEmpty(self.$captionElement) ? self.$captionElement : self.$container.find(".caption");
            self.setStars();
            self.listen();
            if (self.showClear) {
                self.$clear.attr({"class": self.getClearClass()});
            }
            starVal = $el.val();
            starWidth = self.getWidthFromValue(starVal);
            self.cache = {
                caption: self.$caption.html(),
                width: (self.rtl ? (100 - starWidth) : starWidth) + '%',
                val: starVal
            };
            $el.removeClass('rating-loading');
        },
        checkDisabled: function () {
            var self = this;
            self.disabled = validateAttr(self.$element, 'disabled', self.options);
            self.readonly = validateAttr(self.$element, 'readonly', self.options);
            self.inactive = (self.disabled || self.readonly);
        },
        getClearClass: function () {
            return this.clearButtonBaseClass + ' ' + ((this.inactive) ? '' : this.clearButtonActiveClass);
        },
        generateRating: function () {
            var self = this, clear = self.renderClear(), caption = self.renderCaption(),
                css = (self.rtl) ? 'rating-container-rtl' : 'rating-container',
                stars = self.getStars();
            if (self.glyphicon) {
                css += (self.symbol === '\ue006' ? ' rating-gly-star' : ' rating-gly') + self.ratingClass;
            } else {
                css += isEmpty(self.ratingClass) ? ' rating-uni' : ' ' + self.ratingClass;
            }
            self.$rating.attr('class', css);
            self.$rating.attr('data-content', stars);
            self.$stars.attr('data-content', stars);
            css = self.rtl ? 'star-rating-rtl' : 'star-rating';
            self.$container.attr('class', css + ' rating-' + self.size);
            self.$container.removeClass('rating-active rating-disabled');
            if (self.inactive) {
                self.$container.addClass('rating-disabled');
            }
            else {
                self.$container.addClass('rating-active');
            }
            if (isEmpty(self.$caption)) {
                if (self.rtl) {
                    self.$container.prepend(caption);
                } else {
                    self.$container.append(caption);
                }
            }
            if (isEmpty(self.$clear)) {
                if (self.rtl) {
                    self.$container.append(clear);
                }
                else {
                    self.$container.prepend(clear);
                }
            }
            if (!isEmpty(self.containerClass)) {
                addCss(self.$container, self.containerClass);
            }
        },
        getStars: function () {
            var self = this, numStars = self.stars, stars = '', i;
            for (i = 1; i <= numStars; i++) {
                stars += self.symbol;
            }
            return stars;
        },
        renderClear: function () {
            var self = this, css;
            if (!self.showClear) {
                return '';
            }
            css = self.getClearClass();
            if (!isEmpty(self.$clearElement)) {
                addCss(self.$clearElement, css);
                self.$clearElement.attr({"title": self.clearButtonTitle}).html(self.clearButton);
                return '';
            }
            return '<div class="' + css + '" title="' + self.clearButtonTitle + '">' + self.clearButton + '</div>';
        },
        renderCaption: function () {
            var self = this, val = self.$element.val(), html;
            if (!self.showCaption) {
                return '';
            }
            html = self.fetchCaption(val);
            if (!isEmpty(self.$captionElement)) {
                addCss(self.$captionElement, 'caption');
                self.$captionElement.html(html);
                return '';
            }
            return '<div class="caption">' + html + '</div>';
        },
        fetchCaption: function (rating) {
            var self = this, val = parseFloat(rating), css, cap, capVal, cssVal,
                vCap = self.starCaptions, vCss = self.starCaptionClasses, caption;
            cssVal = typeof vCss === "function" ? vCss(val) : vCss[val];
            capVal = typeof vCap === "function" ? vCap(val) : vCap[val];
            cap = isEmpty(capVal) ? self.defaultCaption.replaceAll('{rating}', val) : capVal;
            css = isEmpty(cssVal) ? self.clearCaptionClass : cssVal;
            caption = (val === self.clearValue) ? self.clearCaption : cap;
            return '<span class="' + css + '">' + caption + '</span>';
        },
        getWidthFromValue: function (val) {
            var self = this, min = self.min, max = self.max;
            if (val <= min || min === max) {
                return 0;
            }
            if (val >= max) {
                return 100;
            }
            return (val - min) * 100 / (max - min);
        },
        getValueFromPosition: function (pos) {
            var self = this, precision = getDecimalPlaces(self.step),
                val, factor, maxWidth = self.$rating.width();
            factor = (self.diff * pos) / (maxWidth * self.step);
            factor = self.rtl ? Math.floor(factor) : Math.ceil(factor);
            val = applyPrecision(parseFloat(self.min + factor * self.step), precision);
            val = Math.max(Math.min(val, self.max), self.min);
            return self.rtl ? (self.max - val) : val;
        },
        toggleHover: function (out) {
            var self = this, w, width, caption;
            if (self.hoverChangeCaption) {
                caption = out.val <= self.clearValue ? self.fetchCaption(self.clearValue) : out.caption;
                self.$caption.html(caption);
            }
            if (self.hoverChangeStars) {
                w = self.getWidthFromValue(self.clearValue);
                width = out.val <= self.clearValue ? (self.rtl ? (100 - w) + '%' : w + '%') : out.width;
                self.$stars.css('width', width);
            }
        },
        calculate: function (pos) {
            var self = this, defaultVal = isEmpty(self.$element.val()) ? 0 : self.$element.val(),
                val = arguments.length ? self.getValueFromPosition(pos) : defaultVal,
                caption = self.fetchCaption(val), width = self.getWidthFromValue(val);
            if (self.rtl) {
                width = 100 - width;
            }
            width += '%';
            return {caption: caption, width: width, val: val};
        },
        setStars: function (pos) {
            var self = this, out = arguments.length ? self.calculate(pos) : self.calculate();
            self.$element.val(out.val);
            self.$stars.css('width', out.width);
            self.$caption.html(out.caption);
            self.cache = out;
        },
        clear: function () {
            var self = this,
                title = '<span class="' + self.clearCaptionClass + '">' + self.clearCaption + '</span>';
            self.$stars.removeClass('rated');
            if (!self.inactive) {
                self.$caption.html(title);
            }
            self.$element.val(self.clearValue);
            self.setStars();
            self.$element.trigger('rating.clear');
        },
        reset: function () {
            var self = this;
            self.$element.val(self.initialValue);
            self.setStars();
            self.$element.trigger('rating.reset');
        },
        update: function (val) {
            var self = this;
            if (!arguments.length) {
                return;
            }
            self.$element.val(val);
            self.setStars();
        },
        refresh: function (options) {
            var self = this;
            if (!arguments.length) {
                return;
            }
            self.$rating.off('rating');
            if (self.$clear !== undefined) {
                self.$clear.off();
            }
            self.init($.extend(self.options, options));
            if (self.showClear) {
                self.$clear.show();
            } else {
                self.$clear.hide();
            }
            if (self.showCaption) {
                self.$caption.show();
            } else {
                self.$caption.hide();
            }
            self.$element.trigger('rating.refresh');
        }
    };

    $.fn.rating = function (option) {
        var args = Array.apply(null, arguments);
        args.shift();
        return this.each(function () {
            var $this = $(this),
                data = $this.data('rating'),
                options = typeof option === 'object' && option;

            if (!data) {
                $this.data('rating',
                    (data = new Rating(this, $.extend({}, $.fn.rating.defaults, options, $(this).data()))));
            }

            if (typeof option === 'string') {
                data[option].apply(data, args);
            }
        });
    };

    $.fn.rating.defaults = {
        stars: 5,
        glyphicon: true,
        symbol: null,
        ratingClass: '',
        disabled: false,
        readonly: false,
        rtl: false,
        size: 'md',
        showClear: true,
        showCaption: true,
        defaultCaption: '{rating} Stars',
        starCaptions: {
            0.5: 'Half Star',
            1: 'One Star',
            1.5: 'One & Half Star',
            2: 'Two Stars',
            2.5: 'Two & Half Stars',
            3: 'Three Stars',
            3.5: 'Three & Half Stars',
            4: 'Four Stars',
            4.5: 'Four & Half Stars',
            5: 'Five Stars'
        },
        starCaptionClasses: {
            0.5: 'label label-danger',
            1: 'label label-danger',
            1.5: 'label label-warning',
            2: 'label label-warning',
            2.5: 'label label-info',
            3: 'label label-info',
            3.5: 'label label-primary',
            4: 'label label-primary',
            4.5: 'label label-success',
            5: 'label label-success'
        },
        clearButton: '<i class="glyphicon glyphicon-minus-sign"></i>',
        clearButtonTitle: 'Clear',
        clearButtonBaseClass: 'clear-rating',
        clearButtonActiveClass: 'clear-rating-active',
        clearCaption: 'Not Rated',
        clearCaptionClass: 'label label-default',
        clearValue: null,
        captionElement: null,
        clearElement: null,
        containerClass: null,
        hoverEnabled: true,
        hoverChangeCaption: true,
        hoverChangeStars: true,
        hoverOnClear: true
    };

    $.fn.rating.Constructor = Rating;

    /**
     * Convert automatically inputs with class 'rating'
     * into the star rating control.
     */

    $('input.rating').addClass('rating-loading');

    $(document).ready(function () {
        var $input = $('input.rating'), count = Object.keys($input).length;
        if (count > 0) {
            $input.rating();
        }
    });
}(window.jQuery));
(function($) {
  $.fn.shorten = function (settings) {

    var config = {
      showChars: 100,
      ellipsesText: "...",
      moreText: "More",
      lessText: "Less"
    };

    if (settings) {
      $.extend(config, settings);
    }

    $(document).off("click", '.morelink');

    $(document).on({click: function () {

      var $this = $(this);
      if ($this.hasClass('disable-event')) {
        return;
      }
      if ($this.hasClass('icon_less')) {
        $this.removeClass('icon_less');
        $this.html(config.moreText);
      } else {
        $this.addClass('icon_less');
        $this.html(config.lessText);
      }

      $(this.parentElement).find('.shortcontent').toggle();
      $(this.parentElement).find('.fullcontent').toggle();
      return false;
    }}, '.morelink');

    return this.each(function () {
      var $this = $(this);
      if($this.hasClass("shortened")) return;

      $this.addClass("shortened");
      var htmlContent = $this.html();
      var textContent = $this.text();
      if (textContent.length > config.showChars) {
        var shortContent = htmlSubstring(htmlContent, config.showChars);
        $this.html(wrapShortContent(shortContent, config) + wrapFullContent(htmlContent) + moreLinkHtml(config));
        $(".fullcontent").hide();
      }
    });
  };

  var wrapShortContent = function(shortContent, config) {
    return '<span class="shortcontent">' + shortContent + '<span class="moreellipses">' + config.ellipsesText + ' </span></span>';
  }

  var wrapFullContent = function(content) {
    return '<span class="fullcontent">' + content + '</span>';
  }

  var moreLinkHtml = function(config) {
    return '</br><a href="#" class="morelink" data-behavior="toggle-shorten">' + config.moreText + '</a>';
  }

  var htmlSubstring = function(content, limit){
    var regex = /<([^>\s]*)[^>]*>/g, index = 0, stack = [];

    while ((tag = regex.exec(content)) && limit){
      var temp = content.substring(index, tag.index);
      var limitedTemp = temp.substr(0, limit);
      limit -= limitedTemp.length;
      index = regex.lastIndex - (temp.length - limitedTemp.length);
      if(limit > 0) {
        if (tag[1].indexOf('/') === 0) {
          //if this is a closing tag, then pop the stack (does not account for bad html)
          stack.pop();
        } else if (tag[1].lastIndexOf('/') !== tag[1].length - 1) {
          //if this is not a self closing tag then push it in the stack
          stack.push(tag[1]);
        }
      } else {
        index = tag.index - (temp.length - limitedTemp.length);
      }
    }
    return content.substring(0,index + limit) + getUnclosedTags(stack);
  }

  var getUnclosedTags = function(stack){
    var leftover = "";
    while (stack.length) {
      var tag = stack.pop();
      if (tag !== "br") {
        leftover += '</' + tag + '>';
      }
    }
    return leftover;
  }
})(jQuery);
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/dropdown/container"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div class="sa-dropdown-container">\n  <div class="sa-dropdown-select-box">\n    <div class="sa-dropdown-option" ',  options[0].attributes ,' >',  options[0].html ,'</div>\n  </div>\n  <div class="sa-dropdown-expanded">\n  ');  for (var i=0;i<options.length;i++) { ; __p.push('\n    <div class="sa-dropdown-option" ',  options[i].attributes ,' >',  options[i].html ,'</div>\n  '); }; __p.push('\n  </div>\n</div>\n\n');}return __p.join('');};
}).call(this);

(function(SA, $){

  'use strict';

  var scope = SA.UsingNamespace('SA.Widgets');

  scope.Dropdown = function(opt){
    opt = opt || {};
    var selected,
      $originalSelect,
      afterSelection,
      $selectBox,
      $expanded,
      $options;

    function convertOptionsToElements(){
      var $options = $originalSelect.find('.sa-option');
      var optionElements = [];
      $options.each(function(){
        optionElements.push({
          attributes: $(this.attributes).map(function() { return this.name+'='+this.value }).get().join(" "),
          html: this.innerHTML
        });
      });
      return optionElements;
    }

    function setSelection(el){
      $selectBox.html($(el).clone());
      $(el).addClass('hidden');
    }

    function setEvents(){
      $selectBox.on('click', function(){
        $expanded.toggle();
        $(this).toggleClass('open');
      });
      $('.sa-dropdown-expanded .sa-dropdown-option').on('click',function(){
        $options.removeClass('selected hidden');
        setSelection(this);
        $selectBox.removeClass('open');
        $expanded.hide();
        afterSelection(this);
      });
    }

    function initButtons(){
      $selectBox= $('.sa-dropdown-select-box');
      $expanded = $('.sa-dropdown-expanded');
      $options = $('.sa-dropdown-option');
    }

    function initOptions(){
      var elements = convertOptionsToElements();
      var jst = JST['jst/widgets/dropdown/container']({
        options: elements
      });
      $originalSelect.replaceWith(jst);
      initButtons();
    }

    function init(){
      $originalSelect = $('#reviews-selector');
      initOptions();
      setEvents();
      afterSelection = opt.afterSelection;
      setSelection($('.sa-dropdown-expanded .sa-dropdown-option')[0]);
    }

    SA.run(init, 'init SA Dropdown');
  };



}(window.SA, window.jQuery));






(function (SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Pages');

  scope.ReviewMultiple = function (opt) {
    var maxReviewChars, authorSlug,
      $userReviewRating, $authorAverageStars, $filterButtons, $reviewsContainer, $subscribeBtn, $loadMoreReviewsBtn, page=1, rating='all';

    function initParams() {
      opt = $.extend({}, {max_chars: 300, research_data: {}}, opt);
      maxReviewChars = opt.max_chars;
      authorSlug = opt.research_data.author_slug || '';
      $userReviewRating = opt.container || $('[id^="user-review-ratings"]');
      $authorAverageStars = $('.avg-stars');
      $filterButtons = $('.rating-filter button');
      $reviewsContainer = $('#all-users-reviews');
      $subscribeBtn = $('.subscribe-btn');
      $loadMoreReviewsBtn = $('#load-more-reviews-button');
    }

    function setLayout() {
      var reviewStarsDefault = {
        starCaptions: {1: 'I hate it', 2: 'I dont like it', 3: 'Its okay', 4: 'I like it', 5: 'I love it'},
        starCaptionClasses: {1: 'text-danger', 2: 'text-warning', 3: 'text-info', 4: 'text-primary', 5: 'text-success'},
        glyphicon: false,
        size: 's'
      };

      $userReviewRating.rating('refresh', reviewStarsDefault);
      $authorAverageStars.rating('refresh', reviewStarsDefault);

      var $allReviewStars = $('.star-rating');
      $allReviewStars.find('.text-danger, .text-warning, .text-info, .text-primary, .text-success').addClass('starCaptionsTextSize');

      if (!SA.Data.User.shouldSeeAuthorResearch(authorSlug)) {
        $subscribeBtn.removeClass('hidden');
      }

      updateReviewContentSize();
      $('.stars-container').removeClass('hidden');
    }

    function updateReviewContentSize() {
      $('.user-review-content.hidden').shorten({"showChars": maxReviewChars}).removeClass('hidden');
    }

    function loadMoreReviewsEvent() {
      $loadMoreReviewsBtn.on('click', function () {
        page += 1;
        renderReviews(rating);
        showHideLoadMoreReviews(rating);
      });
    }

    function setEvents() {
      $filterButtons.on('click', function (e) {
        if ($(this).hasClass('disabled')) return;
        var rating = e.target.getAttribute('rating');
        $filterButtons.removeClass('btn-clicked');
        $(e.target).addClass('btn-clicked');
        $reviewsContainer[0].className = 'all-users-reviews show-rating-' + rating;
      });

      $('#reviews-selector').on('change', function (e) {
        var rating = $(this).find(':selected').data('rating');
        $reviewsContainer[0].className = 'all-users-reviews show-rating-' + rating;
      });

      $subscribeBtn.on('click', function () {
        $subscribeBtn.addClass('sa-animated');
        $(window.location).attr('href', '/account/research/redirect?slug=' + authorSlug);
      });
      loadMoreReviewsEvent();
    }

    function initializeDropdown() {
      var opt = {
        afterSelection: function (el) {
          rating = $(el).data('rating');
          if (SA.pageConfig.Data.allowLoadMoreReviews) {
            page = 1;
            renderReviews(rating);
            showHideLoadMoreReviews(rating);
          } else {
            $('#all-users-reviews')[0].className = 'all-users-reviews show-rating-' + rating;
          }
        }
      };
      SA.Widgets.Dropdown(opt);
    }

    function showHideLoadMoreReviews(rating) {
      var selector = rating === 'all' ? ".research-user-review" : ".research-user-review.rating" + rating;
      var reviewsCount = $(selector).length;
      var visibleReviewsCount = $(selector + ':visible').length;
      if (reviewsCount > visibleReviewsCount) {
        $loadMoreReviewsBtn.show();
      } else {
        $loadMoreReviewsBtn.hide();
      }
    }

    function renderReviews(rating) {
      var selector = rating === 'all' ? ".research-user-review" : ".research-user-review.rating" + rating;
      var count = SA.pageConfig.Data.reviewsPerPage * page;

      $(".research-user-review").each(function( index ) {
        $(this).hide();
      });

      $(selector).each(function( index ) {
        if (index < count) {
          $(this).show();
        }
      });
    }

    function init() {
      initParams();
      setLayout();
      setEvents();

      if ($('.sa-dropdown-container').length) initializeDropdown();
    }

    init();
  };
}(window.SA, window.jQuery));



(function (w, SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Widgets');

  scope.ExclusiveResearchUnit = function (opt) {

    opt = opt || {};
    var firedMobileEvent = false;

    var config = SA.pageConfig || {},
      appType = {
        isMobile: SA.App.type === 'mobile',
        isRegular: SA.App.type === 'regular'
      };

    function buildContent(authorResearchContent, customFollowUnit, bullet) {
      opt.container.replaceWith(authorResearchContent);
      opt.summary.append("<p class=summary-bullet style='font-style:italic'>" + bullet + "</p>")
      opt.container = $('#fcu-pitch');
      customFollowUnit ? initFollowEvents() : initSubscribeEvents();
    }

    function initFollowEvents() {
      setBiOptions();
      scrolledTo();

      new SA.Widgets.Follow.SingleButton({
        author: opt.author,
        container: '.fcu-follow-btn',
        showPopover: true,
        articleId: opt.articleId,
        bi: {sendDefault: true, source: 'exclusive_research_unit'}
      }).init();

      clickEvent(opt.container.find('.a-media-image a.author-link'), {
        source: 'author_picture',
        action: 'clicked'
      });

      clickEvent(opt.container.find('.a-media-info a.author-link'), {
        source: 'author_name',
        action: 'clicked'
      });

      clickEvent(opt.container.find('.a-media-info a.premium'), {
        source: 'premium_button',
        action: 'clicked'
      });

      var $followBtn = opt.container.find('.fcu-follow button');

      clickEvent($followBtn, {
        source: $followBtn.hasClass('btn-follow') ? 'follow_button' : 'unfollow_button',
        action: 'clicked'
      });

      linksClicks(opt.container.find('.sa-art.body a'));
      pushEvent({source: 'article_bottom', action: 'loaded'});
    }

    function initSubscribeEvents() {
      setBiOptions();
      scrolledTo();

      if (opt.container.find('.review-container').length) {
        SA.Pages.ReviewMultiple({container: $('#user-review-ratings')});
        var $averageReviews = $('.average-reviews');
        $averageReviews.removeClass('hidden');
        clickEvent($averageReviews, {
          source: 'service_reviews',
          action: 'clicked'
        });
      }

      headerEvents();

      var $btn = opt.container.find('.btn-learn-more, .btn-free-trial');

      if ($btn.length) {
        clickEvent($btn, {
          source: 'article_bottom',
          action: 'clicked',
          data: {plan_type: $btn.hasClass('btn-free-trial') ? 'free_trial' : 'learn_more'}
        });
      }

      linksClicks(opt.container.find('.sa-art.body a'));
      pushEvent({source: 'article_bottom', action: 'loaded'});
    }

    function setBiOptions(type) {
      opt.biOptions = {
        type: opt.container.data('mone-type'),
        data: {'author': config.Data.author.slug, 'author_id': config.Data.author.id}
      };
    }

    function pushEvent(eventOpt) {
      var obj = $.extend(true, opt.biOptions, eventOpt);
      SA.Logger.Mone.event(obj.type, obj.source, obj.action, {data: obj.data});
    }

    function scrolledTo() {
      if (appType.isRegular) {
        setTimeout(function () {
          SA.Utils.Scroll.add(scrollToEvent);
        }, 1000);
      }
    }

    function scrollToEvent() {
      if (SA.Utils.Scroll.isCloseToElement(opt.container, 0)) {
        pushEvent({
          source: 'article_bottom',
          action: 'displayed'
        });

        SA.Utils.Scroll.remove(scrollToEvent);
      }
    }

    function clickEvent($elem, biOpt) {
      $elem.click(function () {
        pushEvent(biOpt);
      });
    }

    function headerEvents() {
      opt.container.find('.a-media h4').click(function () {
        pushEvent({type: opt.eventType, source: 'service_title', action: 'clicked'});
      });
    }

    function linksClicks($links) {
      $links.each(function () {
        clickEvent($(this), {
          source: 'other',
          action: 'clicked'
        });
      });
    }

    function runOnFail() {
      if ($.isFunction(opt.onFail)) {
        opt.onFail();
      }
    }

    function initUnit() {
      var previewCustomUnit = SA.Fn.param('preview_custom_unit'),
        previewResearchAuthorId = SA.Fn.param('preview_research_author'),
        data = {
          preview_custom_unit: previewCustomUnit,
          author_id: previewCustomUnit && previewResearchAuthorId ? previewResearchAuthorId : opt.author.researchAuthorId,
          is_mobile: appType.isMobile,
          user_id: SA.Data.User.id(),
          article_id: opt.articleId
        };

      if (SA.Fn.param('preview') || (SA.Data.User.authorSlug() !== opt.author.slug && SA.Data.User.followedAuthors().indexOf(opt.author.slug) === -1)) {
        data['not_following_author'] = true;
      }

      $.get('/account/ajax_get_author_research', data).done(function (res) {
        res = res || {};

        if (res.result && res.result.author_research_content) {
          buildContent(res.result.author_research_content, res.result.custom_follow_unit, res.result.mkt_bullet);
          if (appType.isMobile) initShowMoneEvent();
        } else {
          runOnFail();
        }
      });
    }

    function initShowMoneEvent() {
      var $fcuPitch = $('#fcu-pitch'),
        elPosition = $fcuPitch.offset().top,
        elHeight = $fcuPitch.outerHeight(),
        windowHeight = $(w).height();

      $(w).on('scroll', function() {
        if (firedMobileEvent) { return; }
        var yScrollPos = w.pageYOffset;
        if (yScrollPos > (elHeight + elPosition - windowHeight)) {
          SA.Logger.Mone.event('mobile_web', 'mp_author_article', 'short_pitch_shown',
            {data: {author_id: opt.author.researchAuthorId}}
            );
          firedMobileEvent = true;
        }
      });
    }

    function init() {
      if (opt.container.length && opt.author && opt.author.researchAuthorId) {
        initUnit();
      } else {
        runOnFail();
      }
    }

    SA.run(init, 'exclusive-research-unit');
  };

}(window, window.SA, window.jQuery));
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/author_newsletter_signup"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<aside id=\'author-newsletter\' class=\'hidden-print\'>\n  <div class="main-display">\n    <div class=\'title\'>Get ',  author_name ,'\'s free newsletter directly to your inbox</div>\n    <div class=\'subscribe\'><button class=\'subscribe-btn orange-btn\'>Subscribe</button></div>\n    <div class="subscribe-loader hidden"></div>\n    <div id=\'message-display\'></div>\n  </div>\n  <div class="clearfix"></div>\n</aside>\n');}return __p.join('');};
}).call(this);

(function (SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Widgets');
  scope.AuthorNewsletterSignup = function (opt) {

    function listEvents($wrapper) {
      $wrapper.on('click', '.subscribe-btn', function (e) {
        e.preventDefault();
        var $messageDisplay = $('#message-display');

        $('.subscribe-loader').removeClass('hidden');

        $.get('/account/subscribe_to_author_newsletter', {author_tag_id: opt.authorTagId}).done(function (res) {
          res = res || {};
          if (res.result) {
            $('.subscribe-loader').addClass('hidden');
            $messageDisplay.text('Thank you for subscribing.').fadeIn('slow');
            SA.Logger.Mone.event('autho_newsletter_promo', opt.authorName, 'clicked_subscribe', {data: {user_id: opt.userId}});

            setTimeout(function () {
              $('#author-newsletter').fadeOut('slow');
            }, 2000);
          }
        });
      });
    }

    function buildSignupForm() {
      var $wrapper = $(JST['jst/widgets/author_newsletter_signup']({author_name: opt.authorName}));
      listEvents($wrapper);
      opt.container.replaceWith($wrapper);
      SA.Logger.Mone.event('autho_newsletter_promo', opt.authorName, 'shown', {data: {user_id: opt.userId}});
    }

    function getUnit() {
      if (SA.Data.User.loggedIn()) {
        $.get('/account/is_subscribed_to_author_newsletter', {author_tag_id: opt.authorTagId}).done(function (res) {
          res = res || {};
          if (!res.subscribed) {
            return buildSignupForm();
          } else if ($.isFunction(opt.insteadClb)) {
            opt.insteadClb();
          }
        });
      }
    }

    function init() {
      opt = opt || {};
      var callbackOpts = opt.callbackOptions;

      if (opt.container.length && opt.isAuthorNewsletter) {
        getUnit();
      } else if ($.isFunction(opt.insteadClb)) {
        if(callbackOpts)
          opt.insteadClb(callbackOpts);
        else
          opt.insteadClb;
      }
    }

    init();
  };

}(window.SA, window.jQuery));
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/add_ticker_to_portfolio/add_ticker_register_unit"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div class="t_to_p a_c add-ticker-bottom-unit hidden-print">\n  <div class="t_add_to_p"> ',  rtaCount ,' people get ',  tickerSlug.toUpperCase() ,' breaking news and analysis by email alert</div>\n  <div class="b_add_to_p">Get email alerts on ',  tickerSlug.toUpperCase() ,'</div>\n  <form class="form-inline hidden" id="get-alerts-reg">\n    <input class="email" type="email" placeholder="Enter your email address" required="true">\n    <input class="b_add_reg" type="submit" value="Get free alerts">\n    <div class="error"></div>\n  </form>\n</div>\n');}return __p.join('');};
}).call(this);





(function (SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Widgets');
  scope.AddTickerRtaRegister = function (opt) {

    var helpers = SA.Utils.AuthenticationHelpers;
    var $topContainer, $bottomContainer, ticker, pageType, regLock = false;

    function getError(error) {
      var errors = {
        defaultMessage: 'There was an error. Please try again later',
        already_registered: 'You are already registered, please sign in.',
        not_activated_not_bounced_user: 'There is already a registration in progress for this email, if you did not receive the confirmation email, please ask your IT department or email provider to place seekingalpha.com in the whitelist and try to register again',
        not_activated_bounced_user: function (d) {
          return 'There is already a registration in progress for this email, but our confirmation email was blocked by your email provider as of ' + d + ', we have attempted to remove the block and sent a password reset email to your inbox.';
        },
        activated_bounced_user: function (d) {
          return 'This email already exists in our system, but was blocked by your email provider as of ' + d + ', we have attempted to remove the block and sent a password reset email to your inbox.';
        }
      };

      return errors[error] || errors.defaultMessage;
    }

    function handleError(opt, message) {
      if (opt.showErrorinPopup) {
        helpers.errorPopup(message);
      } else {
        var $error = opt.rtaForm.find('.error');
        helpers.showError($error, message);
      }
    }

    function onAfterCheckEmail($form) {
      regLock = false;
      helpers.removeLoader($form.find('.b_add_reg'));
    }

    function handleRegisterFailure(opt) {
      onAfterCheckEmail(opt.rtaForm);

      helpers.errorPopup(getError('defaultMessage'));
    }

    function handleRegisterSuccess(opt) {
      onAfterCheckEmail(opt.rtaForm);

      SA.Utils.Observer.publish('registration/success-popup', {
        email: opt.email,
        showCloseBtn: true,
        fromRoadblock: false,
        headerContent: '<h4>Thanks for registering to Seeking Alpha real-time email alerts.</h4>'
      });

      opt.rtaUnit.hide();
    }

    function onRegisterSuccess(response, opt) {
      return (response || {}).registration ? handleRegisterSuccess(opt) : handleRegisterFailure(opt);
    }

    function onRegisterFailure(response, opt) {
      onAfterCheckEmail(opt.rtaForm);

      SA.exceptions.push(['Rta registation error', {}, {response: response, opt: opt}]);
    }

    function registerWithRta(opt) {
      SA.Models.Authentication.registerNoPw({
        id: 'login',
        activity: 'rta',
        'function': null,
        email: opt.email,
        rtaAddAlerts: 1,
        rtaSource: 'bottom_rta_unit',
        rtaSlugs: ticker,
        onSuccess: onRegisterSuccess,
        onFailure: onRegisterFailure,
        rtaForm: opt.rtaForm,
        rtaUnit: opt.rtaUnit
      });
    }

    function onCheckEmailFailure(request, opt) {
      SA.exceptions.push(['Bottom Rta Unit, logged out user, check_email failed', {}, {
        status: request.status,
        statusText: request.statusText
      }]);

      onAfterCheckEmail(opt.rtaForm);

      handleError(opt, getError('defaultMessage'));
    }

    function handleActivatedEmail(response, opt) {
      onAfterCheckEmail(opt.rtaForm);

      if (response.user_exists) {
        handleError(opt, getError('already_registered'));
      }
    }

    function handleNonActivatedEmail(response, opt) {
      onAfterCheckEmail(opt.rtaForm);

      switch (response.message) {
        case 'not_activated_not_bounced_user':
        case 'activated_bounced_user':
        case 'not_activated_bounced_user':
          return handleError(opt, getError(response.message)(response.date));
        default:
          return registerWithRta(opt);
      }
    }

    function onCheckEmailSuccess(response, opt) {
      regLock = false;
      response = response || {};
      var handleMethod = response.user_exists ? handleActivatedEmail : handleNonActivatedEmail;

      return handleMethod(response, opt);
    }

    function onBeforeCheckEmail($form) {
      regLock = true;
      helpers.hideErrors($form.find('.error'));
      helpers.addLoader($form.find('.b_add_reg'));
    }

    function  checkEmail($unit, $form) {
      if (regLock) return;

      onBeforeCheckEmail($form);

      SA.Models.Authentication.checkEmail({
        email: $form.find('input.email').val().trim(),
        onSuccess: onCheckEmailSuccess,
        onFailure: onCheckEmailFailure,
        rtaForm: $form,
        rtaUnit: $unit
      });
    }

    function initTopUnit(opts) {
      $topContainer = opts.$container;
      if ($topContainer && $topContainer.length) {
        var $rtaForm = $topContainer.find('form');
        if (opts.hide) {
          $rtaForm.remove();
        } else {
          $rtaForm.removeClass('hidden').one('click', '.b_add_reg', function (e) {
            e.preventDefault();

            var formWidth = $topContainer.outerWidth() - $topContainer.children('span').outerWidth() - $rtaForm.outerWidth() - 3;
            $rtaForm.find('input.email').removeClass('hidden').animate({width: formWidth}, 'fast');

            $(this).addClass('expanded');

            $rtaForm.on('submit', function (e) {
              e.preventDefault();

              checkEmail($(this), $(this));
              SA.Logger.Mone.event('RTA Register', pageType + '_rta_top_btn', 'clicked', {data: {ticker: ticker}});
            }).one('keypress', 'input.email', function () {
              SA.Widgets.PageRoadblock.resetTimeout();
            });
          });
        }
      }
    }

    function initBottomUnit(opts) {
      $bottomContainer = opts.$container;
      if ($bottomContainer && $bottomContainer.length) {
        SA.Models.PortfolioModel.getSubscribeData(ticker, initRTABottomUnit);
      }
    }

    function initRTABottomUnit(subscribeData) {
      var $wrapper = $(JST['jst/widgets/add_ticker_to_portfolio/add_ticker_register_unit']({
        rtaCount: subscribeData.symbol_rta_count,
        tickerSlug: ticker
      }));
      $bottomContainer.addClass('initialized').append($wrapper);
      setBottomUnitEventListeners($wrapper);
    }

    function setBottomUnitEventListeners($unit) {
      var $registerForm = $unit.find('#get-alerts-reg');
      $unit.on('click', '.b_add_to_p', function () {
        $(this).remove();
        SA.Logger.Mone.event('RTA Logged OUt', pageType + '_rta_button', 'clicked', {data: {ticker: ticker}});
        $registerForm.removeClass('hidden');
      }).one('keyup', 'input.email', function () {
        SA.Widgets.PageRoadblock.resetTimeout();
      });

      $registerForm.on('submit', function (e) {
        e.preventDefault();
        checkEmail($unit, $(this));
        SA.Logger.Mone.event('RTA Register', pageType + '_rta_button', 'clicked', {data: {ticker: ticker}});
      });
    }

    function init() {
      opt = opt || {};
      pageType = opt.page;
      ticker = opt.ticker || '';

      if (ticker.length) {
        initTopUnit(opt.top);
        initBottomUnit(opt.bottom);
      }
    }

    init();
  }

}(window.SA, window.jQuery));
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/add_ticker_to_portfolio/add_ticker_base"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div class="t_to_p a_c ',  cssClass.unitContainer ,' hidden-print hidden">\n  <div class="',  cssClass.title ,'"></div>\n  <div class="',  cssClass.followButtonWrapper ,'"></div>\n</div>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/button/follow_base"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div id="',  id ,'" class="',  cssClass.hide ,' ',  cssClass.base ,' ',  entityType ,' ',  initialCssClass ,' ',  subscribedToRta ? '' : cssClass.showGetEmailAlerts ,'">\n  <div class="',  cssClass.message ,' ',  cssClass.hide ,'">\n  </div>\n  ');  if (showGetAlertsInLine) { ; __p.push('\n    <input title="" class="',  cssClass.emailAlertsInput ,'">\n  ');  } ; __p.push('\n  <button class="btn btn-default ',  cssClass.button ,'" disabled="disabled">',  buttonText ,'</button>\n  ');  if (showGetAlertsCheckBox) { ; __p.push('\n  <div class="',  cssClass.getEmailAlerts ,'">\n    <div class="check-box ',  subscribedToRta ? '' : cssClass.unchecked ,'"></div>\n    Get email alerts\n  </div>\n  ');  } ; __p.push('\n  ');  if (showFollowersCount) { ; __p.push('\n  <div class="',  cssClass.followersCount ,'"></div>\n  ');  } ; __p.push('\n</div>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/button/follow_ticker_portfolios_list"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('');  if (portfolios.length > 1) { ; __p.push('\n<div class="',  portfolioSelectorClass ,'">\n  <ul>\n    ');  jQuery.each(portfolios, function () { ; __p.push('\n    <li class="',  portfolioItemClass ,'" data-portfolio-id="',  this.portfolio_id ,'" title="',  this.portfolio_name ,'">',  this.portfolio_name ,'</li>\n    ');  }); ; __p.push('\n    <li class="',  portfolioItemClass ,' create" data-portfolio-id="-1" title="Create portfolio">+ Create portfolio</li>\n  </ul>\n</div>\n');  } ; __p.push('\n');}return __p.join('');};
}).call(this);



(function (SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Widgets.Button');
  scope.FollowersCount = function (opt) {
    var render = {
      user: function (userId, callback) {
        SA.Models.AuthorModel.followersFollowings({
          userId: userId,
          onSuccess: function (userId, res) {
            if (res.status === 'success' && $.isFunction(callback)) {
              callback(parseInt(res.data.followers.replace(/,/g, '')));
            }
          }
        });
      },
      ticker: function (ticker, callback) {
        SA.Models.PortfolioModel.getSubscribeData(ticker, function (res) {
          if ($.isFunction(callback)) {
            callback(parseInt(res.portfolio_count.split(',').join('').replace(/,/g, '')));
          }
        });
      }
    };

    function updateHtml($elem, followersNumber) {
      if (isNaN(followersNumber)) return;

      if (followersNumber <= 0) {
        $elem.data('count', 0).html('');
      } else {
        var followers = followersNumber.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ','), title = null;

        if (followersNumber > 1000000000) {
          title = followers;
          followers = (followersNumber / 1000000000).toFixed(2) + 'B';
        } else if (followersNumber > 1000000) {
          title = followers;
          followers = (followersNumber / 1000000).toFixed(2) + 'M';
        }

        $elem.data('count', followersNumber).html('(<span>' + followers + '</span> ' + (followers === '1' ? 'follower' : 'followers') + ')');

        if (title) $elem.attr('title', title);
      }
    }

    this.update = function (units, followersNumber) {
      followersNumber = followersNumber || 0;
      $(units).each(function () {
        var $this = $(this);
        updateHtml($this, followersNumber);
      });
    };

    function init() {
      if (opt.entity) {
        if (render[opt.entity.type]) {
          render[opt.entity.type](opt.entity.id, opt.onSuccess)
        }
      }
    }

    init();

  };

}(window.SA, window.jQuery));
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/add_ticker_to_portfolio/logged_out_get_alerts"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div class="t_to_p ch_p_cont logged-out-get-alerts-container hidden-print">\n  <div class="add_title">To get email alerts on <strong>',  symbol.toUpperCase() ,'</strong>, simply fill in your email:</div>\n  <input id="promotion_box_email" emailautofill="on" class="promotion_box_email" spellcheck="false" autocomplete="on" style="color: rgb(0, 0, 0);">\n  <div class="login-and-register hidden">\n    <div class="green">You\'ve already registered with this email. Please enter your password to continue:</div>\n    <input type="password" id="promotion_box_password" class="promotion_box_password default_text" autocomplete="off" style="color: rgb(141, 141, 141);">\n  </div>\n  <div class="m_pop_error hidden" id="get_alerts_error"></div>\n  <div class="btn-container">\n    <div class="get-alerts-btn">\n      Get Alerts\n    </div>\n  </div>\n</div>\n');}return __p.join('');};
}).call(this);



(function (w, SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Widgets');
  scope.LoggedOutGetAlerts = new function () {

    var symbol, popup;

    var getError = function (error) {
      var errors = {
        defaultMessage: 'There was an error. Please try again later',
        already_registered: 'You are already registered, please sign in.',
        not_activated_not_bounced_user: 'There is already a registration in progress for this email, if you did not receive the confirmation email, please ask your IT department or email provider to place seekingalpha.com in the whitelist and try to register again',
        not_activated_bounced_user: function (date) {
          return 'There is already a registration in progress for this email, but our confirmation email was blocked by your email provider as of ' + date + ', we have attempted to remove the block and sent a password reset email to your inbox.';
        },
        activated_bounced_user: function (date) {
          return 'This email already exists in our system, but was blocked by your email provider as of ' + date + ', we have attempted to remove the block and sent a password reset email to your inbox.';
        }
      };

      return errors[error] || errors.defaultMessage;
    };

    var getPopup = function () {
      return SA.Widgets.Popup.build({
        className: 'add_to_portfolio_modal',
        backdrop: true,
        keyboard: true,
        showHeader: false,
        showCloseBtn: true,
        showBody: true,
        bodyContent: JST['jst/widgets/add_ticker_to_portfolio/logged_out_get_alerts']({symbol: symbol}),
        showFooter: false
      });
    };

    var register = function () {
      var params = {
        'user[email]': getEmail(),
        rta_slugs: symbol,
        activity: 'rta',
        'function': '',
        id: 'login',
        referrer: SA.pageConfig.referrer,
        url_source: location.href.replace(/\?.*$/, '')
      };

      $.post('/authentication/registration', params).complete(function (res) {
        res = JSON.parse(res.responseText);
        if (res.registration) {
          registrationSuccess();
        } else {
          displayError(getError(res.message));
        }
      });

      SA.Logger.Mone.event('RTA', 'symbol_page', 'Registered', {data: {value: 1, email: getEmail()}});
    };

    var registrationSuccess = function () {
      popup.hide();

      SA.Utils.Observer.publish('registration/success-popup', {
        email: getEmail(),
        showCloseBtn: true,
        fromRoadblock: false,
        headerContent: '<h4>Thanks for registering to Seeking Alpha real-time email alerts.</h4>',
      });

      SA.Logger.Mone.event('RTA', 'symbol_rta_button_thank_you_reg', 'popup_shown');
      SA.Logger.Mone.event('RTA', 'symbol_page', 'registered', {
        date: {
          email: getEmail(),
          number_of_tickers: 1,
          tickers: symbol,
          alerts: true,
          login: false
        }
      });
      SA.Vendor.Gtm.event('registration', {
        category: 'Registration',
        action: 'Signup',
        label: w.location.href
      });
    };

    var verifyEmail = function () {
      SA.Models.Authentication.checkEmail({
        email: getEmail(),
        onSuccess: onCheckEmailSuccess,
        onFailure: onCheckEmailFailure
      });
    };

    var onCheckEmailSuccess = function (res) {
      res.user_exists ? displayLogin() : register();
    };

    var onCheckEmailFailure = function () {
      displayError('Use a valid email');
    };

    var loginFailed = function () {
      displayError('Login failed');

      SA.Logger.Mone.event('RTA', 'symbol_page', 'Login err: login_failed');
    };

    var loginSuccess = function () {
      SA.Logger.Mone.event('RTA', 'symbol_page', 'Login success');

      location.reload();
    };

    var displayError = function (msg) {
      $('#get_alerts_error').html(msg).removeClass('hidden');

      SA.Logger.Mone.event('RTA', 'symbol_page', 'error_message', {data: {email: getEmail(), error_message: msg}});
    };

    var displayLogin = function () {
      $('.get-alerts-btn').addClass('login-register-btn');
      $('.login-register-btn').removeClass('get-alerts-btn');
      $('.login-and-register').removeClass('hidden');

      SA.Logger.Mone.event('RTA', 'symbol_page', 'login_shown', {data: {email: getEmail()}});
    };

    var loginRegister = function () {
      SA.Logger.Mone.event('RTA', 'symbol_page', 'Login try');
      SA.Models.Authentication.logIn({
        id: 'symbol',
        activity: 'roadblock',
        'function': 'onSigninSuccess',
        email: getEmail(),
        password: $('#promotion_box_password').val(),
        rtaAddAlerts: 1,
        rtaSource: 'symbol',
        author_tag_id_to_follow: '',
        primaryTicker: symbol,
        rtaSlugs: symbol,
        onSuccess: function (res) {
          res.login ? loginSuccess() : loginFailed();
        },
        onFailure: loginFailed,
        backdrop: false
      });
    };

    var getEmail = function () {
      return $('#promotion_box_email').val().trim();
    };

    var initEvents = function () {
      $('body').on('click', '.get-alerts-btn', function () {
        var validation = verifyEmail();
        if (validation === 'success') {
          register();
        } else if (validation === 'already-exists') {
          SA.Logger.Mone.event('RTA', 'symbol_page', 'Reg err: already_registered');
          SA.Logger.Mone.event('RTA', 'symbol_page', 'existing_user', {
            data: {
              email: getEmail()
            }
          });
          displayLogin();
        }
      }).on('click', '.login-register-btn', loginRegister);
    };

    this.init = function (opt) {
      symbol = opt.symbol;
      popup = getPopup();
      initEvents();
    };

    this.show = function () {
      popup.show();

      SA.Logger.Mone.event('RTA', 'symbol_page', 'popup_shown', {data: {slug: symbol}});
    }
  };

}(window, window.SA, window.jQuery));

(function (SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Widgets');

  scope.EnterPortfolioName = (function () {
    var bi = {type: 'portfolio_create', action: 'portfolio_created'};
    var onDone;
    var enterNamePopup = SA.Widgets.EnterNamePopup, model = SA.Models.PortfolioModel, biEvent = SA.Logger.Mone.event;

    function show(opt) {
      bi.source = opt.source;

      onDone = opt.onDone;

      var currentName = opt.currentName || '';

      return enterNamePopup.show({
        currentName: currentName,
        content: {
          placeholder: 'Portfolio 1',
          header: (currentName ? 'Update Portfolio Name' : 'Enter Portfolio Name'),
          footer: 'Please type-in a Portfolio name'
        },
        clb: {
          beforeOpen: opt.beforeOpen,
          onSubmit: function (name) {
            model.createPortfolio({name: name, stocks: opt.slugs || [], callback: {done: doneClb, fail: failClb}});
          },
          afterClose: opt.afterClose
        },
        bi: bi
      });
    }

    function doneClb(res) {
      if (!res.errors) {
        biEvent(bi.type, bi.source, bi.action, {data: {'portfolio_name': res.title}});

        var newPortfolio = {
          existing_portfolio: true,
          id: res.portfolio_uri.split('-')[0],
          title: res.title,
          rtaChecked: res.rta_checked
        };

        enterNamePopup.hide();

        if ($.isFunction(onDone)) {
          onDone(newPortfolio);
        }
      } else {
        onFail('Error while creating portfolio: ' + res.errors, res.errors);
      }
    }

    function failClb(res, errorType) {
      onFail('Error ' + errorType + ' while creating portfolio: ' + res.errors, res.errors);
    }

    function onFail(error, errors) {
      Rollbar.error(error);
      enterNamePopup.setUnavailable(errors);
    }

    return {
      show: show,
      showing: enterNamePopup.showing,
      hide: enterNamePopup.hide
    };

  })();

}(window.SA, window.jQuery));
(function (w, SA) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Utils.Url');

  scope.param = function (name) {
    name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
    var regex = new RegExp('[\\?&]' + name + '=([^&#]*)'),
      results = regex.exec(w.location.search);
    return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
  };

  scope.hash = function (name) {
    name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
    var regex = new RegExp('[\\#&]' + name + '=([^&#]*)'),
      results = regex.exec(w.location.hash);
    return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
  };

  scope.removeURLParam = function (url, parameter) {
    var urlparts = url.split('?');
    if (urlparts.length >= 2) {
      var prefix = encodeURIComponent(parameter) + '=';
      var pars = urlparts[1].split(/[&;]/g);
      //reverse iteration as may be destructive
      for (var i = pars.length; i-- > 0;) {
        //idiom for string.startsWith
        if (pars[i].lastIndexOf(prefix, 0) !== -1) {
          pars.splice(i, 1);
        }
      }
      return urlparts[0] + (pars.length > 0 ? '?' + pars.join('&') : '');
    }
    return url;
  };

}(window, window.SA));












// *************************************************************************************
// options:
// ticker: slug/symbol identifier
// container: '' by default, needs to be specified to apply html for this widget
// getAlerts:
//  - 'hidden': won't render get alerts checkbox
//  - 'show': show subscribe/unsubscribe checkbox for email alerts (default)
//  - 'in-line': text-box for email address will be displayed for logged-out users with get alerts button
// followersCount:
//  - 'get-only: gets number of following users for ticker ONLY!!! (default)
//  - 'show': gets and displays number of following users for ticker
// enablePortfolioSelect: false by default, in case enabled: user portfolios > 2, clicking on follow button will display portfolios list to select from to add the ticker to, otherwise it will be added to default
// requireRegistration: false
// showFollowCard: false
// bi: {source: '', triggerShowEvent: true} (by default)
// callbacks:
//  - onRenderFinish
//  - onFollowersRenderFinish
//  - onFollowSuccess
//  - onUnfollowSuccess
//  - onGetEmailAlertsSubscribe
//  - onGetEmailAlertsUnsubscribe
// *************************************************************************************

(function (w, doc, SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Widgets.Button');
  scope.FollowTicker = scope.FollowTicker || new function () {

    this.add = function (opt) {
      if (EntityHelper.valid(opt)) {
        opt.ticker = opt.ticker.toLowerCase();
        var entity = EntityHelper.find({container: opt.container, ticker: opt.ticker});

        if (!entity.length) {
          entity = EntityHelper.generate(opt);
        } else {
          entity = entity[0];
        }

        render(entity);
        renderFollowers(entity);
        finishRender(entity);
      }
    };

    this.follow = function (portfolio, tickers) {
      $.each(tickers, function () {
        onFollowSuccess(null, {ticker: this.slug}, portfolio);
      });
    };

    this.unfollow = function (res, tickers) {
      $.each(tickers, function () {
        if (SA.Data.User.portfolioTickers().indexOf(this.slug) === -1) {
          onUnfollowSuccess(null, {ticker: this.slug});
        }
      });
    };

    var loggedIn = SA.Data.User.loggedIn(),
      widgetFollowersCount,
      widgetLoggedOutGetAlerts,
      portfolioModel,
      rtaTypes = 'rta_articles,rta_market_currents,filings,trading_rta',
      followCard = SA.Widgets.FollowCard,
      enterPortfolioName = SA.Widgets.EnterPortfolioName,
      modelPortfolioName,
      modelPortfolioID;

    var TYPE = 'ticker';

    var action = {
      disable: 'disable',
      enable: 'enable',
      follow: 'follow',
      followTmp: 'follow-tmp',
      unfollow: 'unfollow',
      unfollowTmp: 'unfollow-tmp',
      hide: 'hide',
      display: 'display',
      hidePortfoliosList: 'hide-portfolios-list',
      showPortfoliosList: 'show-portfolios-list'
    };

    var cssClass = {
      base: 'follow-button-section',
      follow: 'follow',
      followingTemp: 'following-temp',
      following: 'following',
      message: 'follow-section-message',
      emailAlertsInput: 'email-alerts-input',
      showGetEmailAlerts: 'show-get-email-alerts',
      selectPortfolio: 'select-portfolio',
      button: 'follow-btn',
      getEmailAlerts: 'get-email-alerts',
      followersCount: 'followers-number',
      portfoliosList: 'follow-ticker-portfolios-list',
      portfoliosListItem: 'follow-ticker-portfolios-list-item',
      getAlerts: 'get-alerts',
      unchecked: 'unchecked',
      hide: 'hidden',
      wordingAbTest: 'wording-ab-test'
    };

    var selectors = {
      base: '.' + cssClass.base + '.' + TYPE,
      portfoliosList: '.' + cssClass.selectPortfolio,
      message: ' .' + cssClass.message,
      emailAlertsInput: ' .' + cssClass.emailAlertsInput,
      followButton: ' .' + cssClass.button,
      followTmp: '.' + cssClass.followingTemp,
      getAlertsCheckBox: ' .' + cssClass.getEmailAlerts + ' .check-box',
      followersCount: ' .' + cssClass.followersCount
    };

    var Entities = {};
    var TickersFollowers = {};

    var EntityHelper = {
      valid: function (opt) {
        return opt.ticker && opt.container.length;
      },
      guid: function () {
        function s4() {
          return Math.floor((1 + Math.random()) * 0x10000).toString(16).substring(1);
        }

        return s4() + s4() + '-' + s4() + '-' + s4() + '-' + s4() + '-' + s4() + s4() + s4();
      },
      defaults: function (id) {
        return {
          id: id,
          ticker: null,
          container: '',
          getAlerts: 'hidden',
          showPortfoliosList: null,
          followersCount: 'get-only',
          enablePortfolioSelect: false,
          requireRegistration: false,
          showFollowCard: false,
          bi: {source: '', triggerShowEvent: true},
          onRenderFinish: null,
          onFollowersRenderFinish: null,
          onFollowSuccess: null,
          onUnfollowSuccess: null
        };
      },
      generate: function (opt) {
        var id = this.guid();
        Entities[id] = $.extend(true, this.defaults(id), opt);
        TickersFollowers[opt.ticker] = 0;
        return Entities[id];
      },
      find: function (criteria) {
        var elements = [], entityKey, foundCriteria;
        for (var i = 0, keys = Object.keys(Entities), len = keys.length; i < len; i++) {
          entityKey = keys[i];
          foundCriteria = 0;

          $.each(Object.keys(criteria), function () {
            foundCriteria += Entities[entityKey][this] === criteria[this];
          });

          if (foundCriteria === Object.keys(criteria).length) {
            elements.push(Entities[keys[i]]);
          }
        }

        return $.unique(elements);
      },
      findByTicker: function (ticker) {
        return this.find({ticker: ticker});
      },
      select: function (ticker, suffix) {
        suffix = suffix || '';
        var selectors = $.map(this.findByTicker(ticker), function (entity) {
          return '#' + entity.id + suffix;
        });
        return selectors.join(',');
      }
    };

    function keepModelPortfolioParams() {
      modelPortfolioID = SA.Utils.Url.param('referrer_id');
      modelPortfolioName = SA.Utils.Url.param('referrer_name');
      if (modelPortfolioID && modelPortfolioName) {
        modelPortfolioID = parseInt(modelPortfolioID);
        history.pushState({}, null, SA.Utils.Url.removeURLParam(window.location.href, 'referrer_name'));
        history.pushState({}, null, SA.Utils.Url.removeURLParam(window.location.href, 'referrer_id'));
      }
    }

    function onStart() {
      if (loggedIn) {
        portfolioModel = SA.Models.PortfolioModel;
      } else {
        widgetLoggedOutGetAlerts = SA.Widgets.LoggedOutGetAlerts;
      }
      keepModelPortfolioParams();
    }

    function followingTicker(ticker) {
      return SA.Data.User.portfolioTickers().indexOf(ticker) > -1;
    }

    function initialCssClass(ticker) {
      if (loggedIn) {
        return followingTicker(ticker) ? cssClass.following : cssClass.follow;
      } else {
        return cssClass.getAlerts;
      }
    }

    function subscribedToRta(loggedIn, ticker) {
      return loggedIn && followingTicker(ticker) && SA.Data.User.getRTASymbols().indexOf(ticker) > -1;
    }

    function initEvents() {
      $(doc)
        .on('click', selectors.base + ' ' + selectors.followButton, handleButtonClick)
        .on('mouseout', selectors.base + selectors.followTmp, function () {
          toggleElements($(this).closest(selectors.base), [action.unfollowTmp, action.enable]);
        })
        .on('click', selectors.base + ' ' + selectors.getAlertsCheckBox, handleGetAlertsClick);
    }

    function handleButtonClick(e) {
      var $elem = $(e.currentTarget).closest(selectors.base),
        entity = Entities[$elem.attr('id')];

      Entities.selected = entity;

      if (!loggedIn) {
        return SA.Widgets.AuthenticationPopup.show();
      }

      if ($elem.hasClass(cssClass.follow)) {
        fireBiEvent('add_to_portfolio', entity.bi.source, 'clicked', {ticker: entity.ticker} );
        handleFollowClick($elem, entity);
      }

      if ($elem.hasClass(cssClass.following)) {
        handleUnfollowClick($elem, entity);
      }

      if ($elem.hasClass(cssClass.getAlerts)) {
        if (entity.requireRegistration) {
          getAlertsWithRegistration($elem, entity);
        } else {
          getAlertsInPopup(entity);
        }
      }
    }

    function handleFollowClick($elem, entity) {
      toggleElements($elem, [action.disable]);

      var portfolios = SA.Data.User.getPortfolios();
      if (entity.enablePortfolioSelect && portfolios.length > 1) {
        if (!$elem.hasClass(cssClass.selectPortfolio)) {
          toggleElements($elem, [action.showPortfoliosList, action.disable]);
        }
      } else {
        addTickerToPortfolio($elem, entity, '');
      }
    }

    function getAlertsInPopup(entity) {
      widgetLoggedOutGetAlerts.init({symbol: entity.ticker});
      widgetLoggedOutGetAlerts.show();
    }

    function getAlertsWithRegistration($elem, entity) {
      var data = {
        user: {email: $elem.find(selectors.emailAlertsInput).val()},
        rta_slugs: entity.ticker,
        id: 'login',
        activity: 'rta',
        rta_source: (entity.bi && entity.bi.source === 'ticker_card') ? 'ticker_card' : '',
        function: '',
        referrer: '',
        url_source: location.href.replace(/\?.*$/, ''),
        rta_add_alerts: 1,
        force_params: ''
      };

      $.post('/authentication/registration', data, function (res) {
        setSubscribeResponse(res, $elem, entity, data.email);
      });

      SA.Logger.Mone.event('ticker_card', 'get_alerts', 'clicked', {data: {symbol: entity.ticker}});
    }

    function setSubscribeResponse(res, $elem, entity, email) {
      var $message = $elem.find(selectors.message),
        $other = $elem.find(selectors.emailAlertsInput + selectors.followButton + selectors.followersCount);

      var html;
      if (res.registration) {
        html = ['<div class="subscription-success">Thank you for registering to follow <b>', entity.ticker.toUpperCase(), '</b></div>',
          w.JST['jst/profile/logged_out_subscription_success']({email: email})];
        SA.Vendor.Gtm.event('registration', {
          category: 'Registration',
          action: 'Signup',
          label: w.location.href
        });
      } else {
        var msg = res.message === 'already_registered' ? 'This email has already been registered' : 'This email could not be registered';
        html = ['<div class="subscription-failure">Registration failed</div>',
          w.JST['jst/profile/logged_out_subscription_failure']({
            email: email,
            error_message: msg
          })];

        setTimeout(function () {
          $message.html('').addClass(cssClass.hide);
          $other.removeClass(cssClass.hide);
        }, 10000);
      }

      $message.html(html.join('')).removeClass(cssClass.hide);
      $other.addClass(cssClass.hide);
    }

    function addTickerToPortfolio($elem, entity, portfolioId) {
      var alerts = (entity.bi && entity.bi.source === 'ticker_card') ? 'rta_articles,rta_market_currents,filings' : rtaTypes;
      portfolioModel.addSymbols({
        symbols: entity.ticker,
        pu: portfolioId,
        alerts: alerts,
        onComplete: function (options, res) {
          var portfolio = res.portfolio;

          onFollowSuccess($elem, entity, portfolio, res.rta_checked, true);

          if (SA.Utils.SidePortfolio) {
            SA.Utils.SidePortfolio.updatePortfolioElementsAdded(res);
          }

          var opts = {ticker: entity.ticker, portfolio_id: portfolio.id};
          if (modelPortfolioName && modelPortfolioID) {
            opts.model_portfolio_name = modelPortfolioName;
            opts.model_portfolio_id = modelPortfolioID;
          }
          fireBiEvent('add_to_portfolio', entity.bi.source, 'ticker_added_to_portfolio', opts);
        }
      });
    }

    function onFollowSuccess($elem, entity, portfolio, rtaChecked, showFollowCardOnDone) {
      updateFollowerNumber(entity, 1);

      var act = [action.follow, action.enable];
      if (entity.enablePortfolioSelect && portfolio.id) {
        $elem = $(selectors.portfoliosList);
        act.push(action.hidePortfoliosList);
      }

      toggleElements($elem, act, entity);

      $.each(EntityHelper.find({ticker: entity.ticker}), function () {
        if ($.isFunction(this.onFollowSuccess)) {
          this.onFollowSuccess(portfolio, rtaChecked);
        }
      });

      if (showFollowCardOnDone) {
        if (entity.showFollowCard) {
          followCard.show({
            $hoverElement: $(entity.container).find('.' + cssClass.button),
            object: new followCard.Symbol([entity.ticker], portfolio),
            rtaChecked: rtaChecked,
            onRemoveSuccess: function () {
              handleUnfollowClick($elem, entity);
            }
          });
        }
      }
    }

    function handleUnfollowClick($elem, entity) {
      portfolioModel.removeSymbols({
        slugs: [entity.ticker],
        allPortfolios: true,
        onComplete: function (portfolios) {
          onUnfollowSuccess($elem, entity);

          if (SA.Utils.SidePortfolio) {
            SA.Utils.SidePortfolio.updatePortfolioElementsRemoved();
          }

          var portfoliosIds = $.map(portfolios || [], function (obj) {
            return obj.id;
          });
          fireBiEvent('remove_from_portfolio', entity.bi.source, 'clicked', {ticker: entity.ticker, portfolio_id: portfoliosIds.join(',')} );
        }
      });
    }

    function onUnfollowSuccess($elem, entity) {
      updateFollowerNumber(entity, -1);

      toggleElements($elem, [action.unfollow, action.enable], entity);

      $.each(EntityHelper.find({ticker: entity.ticker}), function () {
        if ($.isFunction(this.onUnfollowSuccess)) {
          this.onUnfollowSuccess();
        }
      });
    }

    function selectPortfolio(e) {
      var $this = $(e.target),
        $container = $this.closest(selectors.base),
        $portfolioPicker = $this.closest(selectors.portfoliosList); // if the target of the click isn't the container nor a descendant of the container

      if ($container.hasClass(cssClass.selectPortfolio) && $portfolioPicker.has($this) && $this.hasClass(cssClass.portfoliosListItem)) {
        var entity = Entities[$container.attr('id')];
        if ($this.hasClass('create')) {
          enterPortfolioName.show({
            slugs: [entity.ticker],
            source: entity.bi.source,
            beforeOpen: function () {
              $(selectors.portfoliosList).addClass('lower-z-index');
            },
            afterClose: function () {
              $(selectors.portfoliosList).removeClass('lower-z-index');
            },
            onDone: function (newPortfolio) {
              onFollowSuccess($this, entity, newPortfolio, newPortfolio.rtaChecked, true);
            }
          });
        } else {
          addTickerToPortfolio($this, entity, $this.data('portfolio-id'));
        }
      } else {
        toggleElements($(selectors.portfoliosList), [action.hidePortfoliosList, action.enable]);
      }
    }

    function renderPortfoliosList($elem) {
      $elem.append(w.JST['jst/widgets/button/follow_ticker_portfolios_list']({
        portfolioSelectorClass: cssClass.portfoliosList,
        portfolioItemClass: cssClass.portfoliosListItem,
        portfolios: SA.Data.User.getPortfolios()
      })).addClass(cssClass.selectPortfolio);
    }

    function handleGetAlertsClick(e) {
      var $elem = $(e.currentTarget).closest(selectors.base),
        $getAlertsCheckBox = $elem.find(selectors.getAlertsCheckBox),
        entity = Entities[$elem.attr('id')];

      if ($getAlertsCheckBox.length) {
        $getAlertsCheckBox.toggleClass(cssClass.unchecked);

        var unchecked = $getAlertsCheckBox.hasClass(cssClass.unchecked),
          biAction = unchecked ? 'clicked_no_alerts' : 'clicked_yes_alerts';

        var method, callback;
        if (unchecked) {
          method = SA.Models.SubscriptionModel.unsubscribe;
          callback = entity.onGetEmailAlertsUnsubscribe;
        } else {
          method = SA.Models.SubscriptionModel.subscribe;
          callback = entity.onGetEmailAlertsSubscribe;
        }

        method({
          tagIds: entity.ticker,
          modes: rtaTypes,
          onSuccess: callback,
          onFailure: function (res) {
            $getAlertsCheckBox.toggleClass(cssClass.unchecked);
          }
        });

        fireBiEvent('add_to_portfolio', entity.bi.source, biAction, {ticker: entity.ticker});
      }
    }

    function render(entity) {
      $(entity.container).html(w.JST['jst/widgets/button/follow_base']({
        id: entity.id.toLowerCase(),
        cssClass: cssClass,
        entityId: entity.ticker,
        entityType: TYPE,
        initialCssClass: initialCssClass(entity.ticker),
        buttonText: '',
        subscribedToRta: entity.getAlerts === 'hidden' || subscribedToRta(loggedIn, entity.ticker),
        showGetAlertsInLine: !loggedIn && entity.getAlerts === 'in-line',
        showGetAlertsCheckBox: loggedIn && entity.getAlerts === 'show',
        showFollowersCount: entity.followersCount === 'show'
      }));
    }

    function renderFollowers(entity) {
      if (entity.followersCount === 'get-only' || entity.followersCount === 'show') {
        if (!TickersFollowers[entity.ticker]) {
          widgetFollowersCount = new scope.FollowersCount({
            entity: {id: entity.ticker, type: TYPE},
            onSuccess: function (followers) {
              TickersFollowers[entity.ticker] = followers;
              updateFollowerNumber(entity, 0);

              if ($.isFunction(entity.onFollowersRenderFinish)) {
                entity.onFollowersRenderFinish(followers);
              }
            }
          });
        } else {
          updateFollowerNumber(entity, 0);
        }
      }
    }

    function updateFollowerNumber(entity, byNumber) {
      if (entity.followersCount === 'show') {
        if (byNumber) {
          TickersFollowers[entity.ticker] += byNumber;
        }
        byNumber = TickersFollowers[entity.ticker];

        if (widgetFollowersCount) {
          widgetFollowersCount.update(EntityHelper.select(entity.ticker, selectors.followersCount), byNumber);
        }
      }
    }

    function finishRender(entity) {
      var $elem = $('#' + entity.id);
      if ($elem.length) {
        toggleElements($elem, [action.enable, action.display]);

        if ($.isFunction(entity.onRenderFinish)) {
          entity.onRenderFinish();
        }

        if (entity.bi.triggerShowEvent) {
          $(doc).ready(function () {
            if (!shownBiEventSent(entity)) {
              scrollToShowEvent(entity);
            }
          });
        }
      }
    }

    function toggleElements($elem, actions, entity) {
      entity = entity || Entities[$elem.attr('id')];

      if (entity) {
        if (actions.indexOf(action.follow) > -1) {
          var singlePortfolio = SA.Data.User.portfolioCount() < 2,
            followClass;

          $(EntityHelper.select(entity.ticker)).each(function () {
            if (singlePortfolio || (!entity.enablePortfolioSelect && $elem && this === $elem[0])) {
              followClass = [cssClass.followingTemp];
            } else {
              followClass = [cssClass.following];
            }

            if (entity.getAlerts !== 'hidden') {
              followClass.push(cssClass.showGetEmailAlerts);
            }

            $(this).removeClass(cssClass.follow).addClass(followClass.join(' '));
          });
        }

        if (actions.indexOf(action.unfollow) > -1) {
          $(EntityHelper.select(entity.ticker)).each(function () {
            $(this).removeClass(cssClass.following + ' ' + cssClass.showGetEmailAlerts).addClass(cssClass.follow);
          });
        }

        if (actions.indexOf(action.hidePortfoliosList) > -1 && !enterPortfolioName.showing()) {
          $elem.removeClass(cssClass.selectPortfolio);
          $elem.find('.' + cssClass.portfoliosList).remove();
          $(doc).unbind('mouseup', selectPortfolio);
        }

        if (actions.indexOf(action.showPortfoliosList) > -1) {
          renderPortfoliosList($elem);

          $(doc).bind('mouseup', selectPortfolio);
        }

        if (actions.indexOf(action.unfollowTmp) > -1) {
          $elem.removeClass(cssClass.followingTemp).addClass(cssClass.following);
        }

        if (actions.indexOf(action.disable) > -1) {
          $(EntityHelper.select(entity.ticker, selectors.followButton)).attr('disabled', 'disabled');
        }

        if (actions.indexOf(action.enable) > -1) {
          $(EntityHelper.select(entity.ticker, selectors.followButton)).removeAttr('disabled');
        }

        if (actions.indexOf(action.hide) > -1) {
          $(EntityHelper.select(entity.ticker)).addClass(cssClass.hide);
        }

        if (actions.indexOf(action.display) > -1) {
          $(EntityHelper.select(entity.ticker)).removeClass(cssClass.hide);
        }
      }
    }

    function scrollToShowEvent(entity) {
      var keyMethod = 'scroll-to-display-' + entity.id;
      w[keyMethod] = function () {
        if (shownBiEventSent(entity)) {
          SA.Utils.Scroll.remove(w[keyMethod]);
        }
      };

      SA.Utils.Scroll.add(w[keyMethod]);
    }

    function shownBiEventSent(entity) {
      var isCloseToElement = SA.Utils.Scroll.isCloseToElement('#' + entity.id, 0);
      if (isCloseToElement && SA.Data.User.loggedIn() && !SA.Data.User.hasTicker(entity.ticker)) {
        fireBiEvent('add_to_portfolio', entity.bi.source, 'shown', {ticker: entity.ticker});
      }
      return isCloseToElement;
    }

    function fireBiEvent(type, source, action, data) {
      SA.Logger.Mone.event(type, source, action, {data: data || {}});
    }

    function init() {
      onStart();
      initEvents();
    }

    init();

  };

}(window, document, window.SA, window.jQuery));




(function (SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Widgets');

  scope.AddTickerBottomUnit = function (opt) {
    opt = opt || {};

    var user = SA.Data.User,
      $container,
      ticker,
      following,
      hasRta,
      bi,
      $unitContainer,
      followersCount;

    var CssClass = {
      unitContainer: 'add-ticker-bottom-unit',
      title: 't_add_to_p',
      followButtonWrapper: 'follow-button-wrapper'
    };

    function prepare() {
      $container = opt.$container;
      ticker = (opt.ticker || '').split(',')[0];
      following = $.inArray(ticker, user.getPortfolioTickers().split(',')) > -1;
      hasRta = $.inArray(ticker, user.getRTASymbols()) > -1;
      bi = opt.bi;
    }

    function getFollowers(suffix) {
      return SA.Utils.Formatter.number(followersCount, {withCommas: true, suffix: suffix, decimals: 0});
    }

    function getFollowTitle() {
      var suffix = followersCount && followersCount === 1 ? ' person has ' : ' people have ';
      return getFollowers(suffix) + ticker.toUpperCase() + ' in their portfolio and get alerts';
    }

    function getTickerAddedTitle(portfolioName) {
      return ticker.toUpperCase() + ' has been added to ' + (portfolioName || 'portfolio');
    }

    function getGetAlertsTitle(subscribedToRta) {
      if (subscribedToRta) {
        return 'You have successfully subscribed to real-time alerts on ' + ticker.toUpperCase();
      } else {
        var suffix = (followersCount && followersCount === 1) ? ' person' : ' people';
        return getFollowers(suffix) + ' get ' + ticker.toUpperCase() + ' breaking news and analysis by email alert';
      }
    }

    function updateTitle(title) {
      $container.find('.' + CssClass.title).html(title);
    }

    function toggleDisplay(showButton) {
      var $followBtn = $unitContainer.find('.follow-button-section');
      if (showButton) {
        $followBtn.removeClass('show-get-email-alerts');
      } else {
        $followBtn.addClass('show-get-email-alerts');
      }
    }

    function onRenderFinish() {
      toggleDisplay(hasRta);

      $container.removeClass('hidden');
    }

    function onFollowersRender(followers) {
      followersCount = followers || 0;

      var title = following ? getGetAlertsTitle(hasRta) : getFollowTitle();
      updateTitle(title);

      $unitContainer.removeClass('hidden');
    }

    function onFollowSuccess(portfolio, rtaChecked) {
      var selectedPortfolio = portfolio && portfolio.title || '';
      if (!selectedPortfolio) {
        selectedPortfolio = $.grep(user.getPortfolios(), function (p) {
          return p.portfolio_id === portfolio.id;
        })[0];
      }

      updateTitle(getTickerAddedTitle(selectedPortfolio));

      toggleDisplay(true);
    }

    function onUnfollowSuccess() {
      updateTitle(getFollowTitle(false));

      toggleDisplay(true);
    }

    function onGetEmailAlertsSubscribe() {
      updateTitle(getGetAlertsTitle(true));
    }

    function onGetEmailAlertsUnsubscribe() {
      updateTitle(getGetAlertsTitle(false));
    }

    function render() {
      $container.html(JST['jst/widgets/add_ticker_to_portfolio/add_ticker_base']({cssClass: CssClass}));

      $unitContainer = $('.' + CssClass.unitContainer);

      SA.Widgets.Button.FollowTicker.add({
        ticker: ticker,
        container: $unitContainer.selector + ' .' + CssClass.followButtonWrapper,
        enablePortfolioSelect: true,
        getAlerts: 'show',
        showFollowCard: true,
        bi: bi,
        onRenderFinish: onRenderFinish,
        onFollowersRenderFinish: onFollowersRender,
        onFollowSuccess: onFollowSuccess,
        onUnfollowSuccess: onUnfollowSuccess,
        onGetEmailAlertsSubscribe: onGetEmailAlertsSubscribe,
        onGetEmailAlertsUnsubscribe: onGetEmailAlertsUnsubscribe
      });
    }

    function init() {
      prepare();

      if ($container.length && ticker && (!following || !hasRta)) {
        render();
      } else if ($.isFunction(opt.renderInstead)) {
        opt.renderInstead();
      }
    }

    init();

  };

}(window.SA, window.jQuery));
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/article_sales_survey/survey_template"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div id="sales-survey">\n  <div class="mini-category">\n    <header>\n      <h2>SURVEY</h2>\n    </header>\n    <div class="question">',  surveyQuestion ,'</div>\n      <form id="survey-form" data-survey-id="', surveyId ,'">\n        '); for(var i=0, len=surveyOptions.length; i < len; i++) {; __p.push('\n         <div>\n           <label class="radio-inline"><input type="radio" value=', surveyOptions[i][0],' name="optionNumber" ><span>',  surveyOptions[i][1] ,'</span></label>\n         </div>\n        '); }; __p.push('\n        <div class="btn-wrapper">\n            <button type="submit" class="btn orange-btn" disabled >Submit</button>\n        </div>\n      </form>\n      <div class="submit-error"></div>\n  </div>\n</div>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/article_sales_survey/survey_results"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div class="survey-results">\n');  for(var i=0,  l = results.length ; i<l ; i++) {; __p.push('\n  <div class="media">\n    <div class="media-left">',  results[i].text ,'</div>\n    <div class="media-body">\n      <div class="progress">\n        <div class="',  results[i].className,'" role="progressbar" style="width:', results[i].width,'" ></div>\n        <span class="pct">', results[i].percentage,'</span>\n      </div>\n    </div>\n  </div>\n');  }; __p.push('\n</div>\n');}return __p.join('');};
}).call(this);



(function(SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Widgets.ArticleSalesSurvey');
  var surveyUserData;
  var articlePrimaryTicker;
  var selectedOption;
  var $container;

  //user survey participation data

  var getUserDefaultData = function(){
    return {
      surveyShownCount: 0,
      isSurveyDone: false,
      lastShown: 0
     };
  };

  var getUserCachedData = function(name){
    var data = SA.Data.Cache.get(name);
    return data ? JSON.parse(data) : {};
  };

  var initUserSurveyData = function(name){
    surveyUserData = {
      key: name,
      data: $.extend({}, getUserDefaultData(), getUserCachedData(name))
    };
  };

  var updateUserSurveyData = function(event){
    if(event === 'shown') {
      surveyUserData.data.surveyShownCount += 1;
      surveyUserData.data.lastShown = Date.now();
    }else if(event === 'voted') {
      surveyUserData.data.isSurveyDone = true;
    }
    SA.Data.Cache.set(surveyUserData.key, JSON.stringify(surveyUserData.data));
  };

  //survey display conditions

  var surveyShownToday = function() {
    var DAY_IN_MS = 60 * 60 * 24 * 1000;
    return (Date.now() - surveyUserData.data.lastShown) <= DAY_IN_MS;
  };

  var surveyShownMaxTimes = function(){
    return surveyUserData.data.surveyShownCount >= 10;
  };

  var userShouldSeeSurvey = function(){
    return !surveyUserData.data.isSurveyDone && !surveyShownToday() && !surveyShownMaxTimes();
  };

  var checkLoggedInCondition = function(loggedInOnly) {
    return SA.Data.User.loggedIn() || !loggedInOnly;
  };

  var checkPrimaryTickerCondition = function(primaryTickerOnly) {
    if(primaryTickerOnly){
      if(articlePrimaryTicker){
        var portfolioTickers = SA.Data.User.portfolioTickers();
        return (portfolioTickers.length && $.inArray(articlePrimaryTicker, portfolioTickers) !== -1);
      }
      return false;
    }
    return true;
  };

  var displayConditionsHold = function(survey) {
    return checkLoggedInCondition(survey.logged_in_only) && checkPrimaryTickerCondition(survey.primary_ticker_only);
  };

  var sendMoneEvent = function(action, opt){
    opt = opt || {};
    var data = $.extend({}, {survey_name: surveyUserData.key}, opt);
    SA.Logger.Mone.event('sales_survey', 'article', action, {data:data} );
  };

  // build survey results template

  var getRatio = function(number, total){
    return parseInt(number,10)/total;
  };

  var getPercentage = function(ratio) {
    return (ratio*100.0).toFixed(1) + '%';
  };

  var getProgBarWidth = function(ratio) {
    return (75*ratio).toFixed(1) + 'px';
  };

  var parseSurveyResults = function(data){
    var perAnswerCount = data.options;
    var totalCount = data.total_votes ? parseInt(data.total_votes, 10) : null;
    if(perAnswerCount && totalCount) {
     return $.map(perAnswerCount, function(optionData,optionNumber){
       var ratio = getRatio(optionData.votes, totalCount);
       return [{
         className: optionNumber === selectedOption.toString() ? "progress-bar orange" : "progress-bar",
         text: optionData.results_text,
         width: getProgBarWidth(ratio),
         percentage: getPercentage(ratio)
       }];
     });
    }
  };

  var handleSubmitVoteFailure =  function(response) {
    $('.submit-error').html('We are sorry, an unexpected server error has occurred.');
  };

  var handleSubmitVoteSuccess = function(response) {
    if(response && response.data) {
      var results = parseSurveyResults(response.data);
      if(results) {
        var resultsHtml = JST['jst/widgets/article_sales_survey/survey_results']({results: results, selectedOption: selectedOption});
        $('#survey-form').replaceWith($(resultsHtml));
        updateUserSurveyData('voted');
        sendMoneEvent('click', {select_options: [selectedOption]});
      } else {
        handleSubmitVoteFailure(response);
      }
    } else {
      handleSubmitVoteFailure(response);
    }
  };

  var submitUserVote = function(form) {
    selectedOption = form.find('input:checked').attr('value');
    var surveyId = form.data('survey-id');
    $.ajax({
      method: 'POST',
      url: '/sales_surveys/submit_vote',
      dataType: 'json',
      data: {
        'selected_option': selectedOption,
        'survey_id': surveyId
      }
    }).done( function(response) {
      handleSubmitVoteSuccess(response);
    });
  };

  var setEventListeners = function() {
    var $form = $('#survey-form');
    $form.find('input[type=radio]').one('change', function(){
      $form.find('button').prop('disabled', false);
    });
    $form.on('submit', function(event){
      event.preventDefault();
      $('.submit-error').html('');
      submitUserVote($form);
    });
  };

  // build survey template

  var getSurveyOptions = function(options, tickerPlaceholder) {
    return tickerPlaceholder ? $.map(options, function(o){ return [[o[0], o[1].replace('[TICKER]', articlePrimaryTicker.toUpperCase())]];}) : options;
  };

  var getSurveyQuestion = function(question, tickerPlaceholder ){
    return tickerPlaceholder ? question.replace('[TICKER]', articlePrimaryTicker.toUpperCase()) : question;
  };

  var buildSurvey = function(survey){
    return JST['jst/widgets/article_sales_survey/survey_template'](
      {
        surveyQuestion: getSurveyQuestion(survey.question, survey.primary_ticker_only),
        surveyOptions: getSurveyOptions(survey.options, survey.primary_ticker_only),
        surveyId: survey.survey_id
      }
    );
  };

  var initSurveys = function(survey){
    initUserSurveyData(survey.survey_name);
    if(userShouldSeeSurvey()){
      updateUserSurveyData('shown');
      var surveyHtml = buildSurvey(survey);
      if(surveyHtml){
        $container.replaceWith($(surveyHtml));
        setEventListeners();
        sendMoneEvent('shown');
      }
    }
  };

  var getSurveyForAbId = function(surveys) {
    var survey = surveys[ABTest.tenth];
    if(survey && survey.options.length && survey.survey_name.length && survey.question.length && displayConditionsHold(survey)){
      return survey;
    }
    return false;
  };

  var onGetSurveysSuccess = function(response) {
    var survey = getSurveyForAbId(response);
    if(survey){
      initSurveys(survey);
    }
  };

  var getActiveSurveys = function(){
    $.ajax({
      url: '/articles/sales_surveys',
      method: 'get',
      dataType: 'json'
    }).done(function(response) {
      if(response){
        onGetSurveysSuccess(response);
      }
    });
  };

  scope.init = function(opt){
    articlePrimaryTicker = opt.ticker;
    $container = $('#sales-survey-wrapper');
    if($container.length) {
      getActiveSurveys();
    }
  };



}(SA, jQuery));



(function (w, $, SA) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Widgets.Liftigniter');

  scope.init = function (opt) {
    if (!this.initialized) {
      SA.Utils.Liftigniter.init();
      this.initialized = true;
    }

    if (w.$p) {
      // remove link params for loggedOut users
      if (!SA.Data.User.loggedIn()) {
        $p('setNoTag', true);
      }

      opt.callbacks = opt.callbacks || $.Callbacks();

      $p('setRequestFields', opt.setRequestFields || ['id', 'title', 'url', 'rank', 'author_name', 'author_image', 'publish_time', 'image', 'primary_ticker']);
      $p('register', {
        max: opt.maxItems || 4,
        widget: SA.pageConfig.Data.pageType + '-widget',
        callback: function (resp) {
          opt.callbacks.fire(resp);

          return resp.items;
        },
        opts: {
          channel: 'article',
          boostSponsored: 'false'
        }
      });
      $p('fetch');
    }

  };
}(window, window.jQuery, window.SA));
(function() { this.JST || (this.JST = {}); this.JST["jst/inline_svg/earnings/pr"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 -16 32 32">\n    <path fill="#111" d="M27.5-8.5v17h-23v-17h23m1-1h-25v19h25v-19z"/>\n    <path d="M6.52-3.41h8.98v6.936H6.52zM16.5-3.41h8.98v.946H16.5zM16.5-.416h8.98V.53H16.5zM16.5 2.58h8.98v.945H16.5zM6.52 5.537h18.96v.946H6.52zM6.52-6.483h18.96v.946H6.52z"/>\n</svg>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/inline_svg/earnings/news"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 -16 32 32">\n    <g fill="none" stroke="#000" stroke-miterlimit="10">\n        <path d="M25.396-8.502L21.5-8.5v-3.52"/>\n        <path d="M20.937-12.5H6.5v25h19V-8.02"/>\n        <path stroke-linejoin="round" d="M20.447-12.5h1.055l3.998 4v.696"/>\n    </g>\n    <path d="M11.043-.006c0 2.83 1.414 5.166 3.3 5.11 2.638-.075 3.413-2.297 3.413-5.128 0-2.827-1.527-5.146-3.413-5.126-2.317.02-3.3 2.32-3.3 5.144zm-2.053 0c.395-6.05 5.145-6.18 5.145-6.18 3.452.02 4.43 3.695 4.43 3.695.058.205 2.055-3.434 2.055-3.434h1.13c-2.317 4.997-2.224 7.032-2.224 7.032-.188 2.695 1.32 3.618 1.32 3.618 1.413.906 1.51-1.735 1.51-1.735.318-.113.508-.223.508-.223.752 3.657-1.51 3.41-1.51 3.41-1.75.19-2.506-2.677-2.506-2.677-2.486 3.282-5.354 2.563-5.354 2.563-4.9-.6-4.504-6.07-4.504-6.07z"/>\n</svg>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/inline_svg/earnings/filing"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 -16 32 32">\n    <path fill="#111" d="M27.5-8.5v17h-23v-17h23m1-1h-25v19h25v-19z"/>\n    <path d="M6.08 1.196l1.407-.136c.084.472.256.818.515 1.04s.607.332 1.047.332c.465 0 .816-.1 1.052-.295s.354-.427.354-.69c0-.17-.05-.314-.15-.433s-.27-.222-.52-.31C9.616.644 9.23.54 8.63.39 7.854.2 7.31-.036 7-.316c-.44-.394-.66-.874-.66-1.44 0-.365.104-.706.31-1.023s.504-.56.893-.726.858-.25 1.408-.25c.9 0 1.576.198 2.03.592s.692.92.716 1.577l-1.445.063c-.06-.368-.194-.632-.397-.793s-.51-.242-.915-.242c-.42 0-.75.087-.987.26-.152.11-.23.26-.23.445 0 .17.073.314.216.435.182.153.625.312 1.33.48.702.165 1.222.337 1.56.514s.6.42.79.728.286.688.286 1.14c0 .41-.114.794-.342 1.152-.23.358-.55.624-.967.798-.417.174-.937.26-1.558.26-.905 0-1.6-.208-2.085-.626s-.775-1.03-.87-1.83zM13.116 3.525v-7.158h5.31v1.21H14.56v1.588h3.594V.37h-3.594v1.95h4v1.205h-5.446zM24.366.894l1.402.444c-.215.78-.572 1.36-1.072 1.74s-1.134.57-1.902.57c-.95 0-1.73-.325-2.344-.974-.61-.65-.918-1.537-.918-2.664 0-1.19.31-2.117.924-2.776s1.424-.99 2.426-.99c.876 0 1.588.26 2.135.777.325.307.57.747.732 1.32l-1.433.34c-.084-.37-.26-.663-.53-.878s-.594-.322-.977-.322c-.53 0-.96.19-1.292.57s-.495 1-.495 1.852c0 .905.162 1.55.488 1.934.326.384.75.576 1.27.576.385 0 .715-.122.99-.366.278-.244.476-.63.596-1.152z"/>\n</svg>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/inline_svg/earnings/slides"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 -16 32 32">\n    <path fill="none" stroke="#000" stroke-miterlimit="10" d="M25.5 6.5h3v-16h-25v2.66"/>\n    <path fill="none" stroke="#000" stroke-miterlimit="10" d="M28.5 3.5h3v-16h-25v2.66"/>\n    <path fill="none" stroke="#000" stroke-miterlimit="10" d="M.5-6.5h25v19H.5z"/>\n    <path d="M16.682 3.435L13 5.56 9.318 7.686V-.816L13 1.31"/>\n</svg>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/inline_svg/earnings/transcript"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 -16 32 32">\n    <path d="M22.52 3.716c-2.047 2.047-2.047 4.093-4.094 4.093-2.048 0-4.096-2.047-6.144-4.094C10.236 1.67 8.188-.38 8.188-2.427c0-2.047 2.048-2.047 4.094-4.094 2.048-2.05-4.094-8.19-6.142-8.19C4.095-14.71 0-8.568 0-8.568 0-4.473 4.208 3.828 8.19 7.81 12.17 11.793 20.473 16 24.566 16c0 0 6.143-4.095 6.143-6.143s-6.143-8.188-8.19-6.14zM17.67-11.164s3.357 1.313 5.71 3.668l.048.048c2.376 2.375 3.732 5.774 3.732 5.774L25.867-.38s-1.378-3.423-3.764-5.81c-2.357-2.36-5.725-3.684-5.725-3.684l1.293-1.29z"/>\n    <path d="M18.816-15.56s4.58 1.794 7.792 5.006c.02.023.042.043.065.066 3.238 3.24 5.092 7.876 5.092 7.876L30-.85s-1.88-4.665-5.134-7.92c-3.217-3.218-7.812-5.027-7.812-5.027l1.762-1.762z"/>\n</svg>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/inline_svg/earnings/analysis"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 -16 32 32">\n    <g fill="none" stroke="#000" stroke-miterlimit="10">\n        <path d="M22.5-9.5v-3h-16v25h2.66"/>\n        <path d="M19.5-12.5v-3h-16v25h2.66"/>\n        <path d="M9.5-9.5h19v25h-19z"/>\n    </g>\n    <path d="M11.5-6.94h14.98V-3H11.5zM11.5-1h14.98V.004H11.5zM11.5 2h14.98v1.004H11.5zM11.5 5h14.98v1.004H11.5zM11.5 8h14.98v1.004H11.5zM11.5 11h14.98v1.004H11.5z"/>\n</svg>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/earnings/widget"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div class="title">',  title ,'</div>\n<ul>\n  ');  for (var key in hash) { ; __p.push('\n  ');  if (hash[key]) { ; __p.push('\n  <li id="',  key ,'">\n    <a target="_blank" href=\'',  hash[key].link ,'\'>\n      ',  icons[hash[key].icon] ,'\n      <em>',  hash[key].name ,'</em>\n    </a>\n  </li>\n  ');  } ; __p.push('\n  ');  } ; __p.push('\n</ul>\n<div class="cleaner clearfix"></div>\n');  if (data_line && data_line.eps && data_line.revenue) { ; __p.push('\n  <div class="data-line">\n    ');  if (data_line.eps.actual) { ; __p.push('\n      <div>EPS of $',  data_line.eps.actual ,' <span class="',  data_line.eps.beatMiss.class ,'">',  data_line.eps.beatMiss.preffix ,' ',  data_line.eps.beatMiss.text ,'</span></div>\n    ');  } ; __p.push('\n    ');  if (data_line.bigDollarValue) { ; __p.push('\n      <div>Revenue of ',  data_line.bigDollarValue ,' (',  data_line.percent ,'% Y/Y) <span class="',  data_line.revenue.class ,'"> ',  data_line.revenue.preffix ,' ',  data_line.revenue.text ,'</span></div>\n    ');  } ; __p.push('\n  </div>\n');  } ; __p.push('\n<div class="cleaner clearfix"></div>\n');}return __p.join('');};
}).call(this);
(function (SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Widgets');
  scope.ExpandOnVisible = (function () {
    var $w = $(window), $elem, $container;

    function isVisible() {
      return $container.offset().top > $w.scrollTop();
    }

    function slideOpen() {
      $elem.slideDown('slow');
    }

    function slideOpenOnScroll() {
      if (isVisible()) {
        slideOpen();
        $w.unbind('scroll', slideOpenOnScroll);
      }
    }

    return {
      expand: function ($el) {
        $elem = $el;
        $container = $elem.wrap('<div class="expanding-container"></div>').parent();

        if (isVisible($container)) {
          slideOpen();
        } else {
          $w.bind('scroll', slideOpenOnScroll);
        }
      }
    };
  })();

}(window.SA, window.jQuery));









(function (SA, $) {

  "use strict";

  var scope = SA.UsingNamespace('SA.Widgets.Earnings');
  var initOpt = {
      type: null,
      id: null,
      url: '/earnings_widget/data'
    },
    container = $('#earnings-widget');

  var renderPreview = function (data) {
    sendMoneEvent(data.links);

    container.html(JST['jst/widgets/earnings/widget']({
      hash: data.links,
      data_line: dataLine(data.earning),
      title: data.title,
      icons: {
        slides: JST['jst/inline_svg/earnings/slides'](),
        filing: JST['jst/inline_svg/earnings/filing'](),
        press_release: JST['jst/inline_svg/earnings/pr'](),
        analysis: JST['jst/inline_svg/earnings/analysis'](),
        news: JST['jst/inline_svg/earnings/news'](),
        transcript: JST['jst/inline_svg/earnings/transcript']()
      }
    }));

    SA.Widgets.ExpandOnVisible.expand(container);
  };

  var sendMoneEvent = function (links) {
    var names = [];
    for (var link in links) {
      names.push(links[link].name);
    }
    var data = {'#': names.length, 'names': names.join(',')};
    SA.Logger.Mone.event('shown', 'earnings_widget', 'header', {data: data});
  };

  var dataLine = function (earning) {
    if (earning) {
      var eps_bm = calcBeatMiss(earning.eps_estimate, earning.eps_actual),
        revenue_bm = calcBeatMiss(earning.revenue_estimate, earning.revenue_actual);
      return {
        eps: {
          actual: earning.eps_actual,
          beatMiss: generateBeatMiss(eps_bm, false)
        },
        bigDollarValue: earning.revenue_actual ? '$' + showBigDollarValue(earning.revenue_actual) : null,
        percent: SA.Utils.Formatter.number(earning.revenue_yoy, {decimals: 2}),
        revenue: generateBeatMiss(revenue_bm, true)
      };
    } else {
      return null;
    }
  };

  var generateBeatMiss = function (val, transform) {
    if (!val) {
      return {text: ''};
    }
    if (val > 0) {
      return {
        class: 'green',
        preffix: 'beats by',
        text: '$' + (transform ? showBigDollarValue(val) : val.toFixed(2))
      }
    } else {
      return {
        class: 'red',
        preffix: 'misses by',
        text: '$' + (transform ? showBigDollarValue(val) : val.toFixed(2))
      }
    }
  };

  function showBigDollarValue(value) {
    if (isNaN(parseFloat(value))) return '';
    value = 1 * value / 1000000;
    return (value < 0 ? '-' : '') + (Math.abs(value) >= 1000 ? fixFloat(Math.abs(value) / 1000, 2) + 'B' : fixFloat(Math.abs(value), 2) + 'M');
  }

  var calcBeatMiss = function (estimate, actual) {
    if (!estimate) {
      return null;
    }
    return (estimate !== '' && actual !== '') ? (Math.round(actual * 1000) - Math.round(estimate * 1000)) / 1000 : '';
  };

  function fixFloat(value, decimals) {
    value = value.toFixed(decimals);
    value = value.toString().replace(/\.?0+$/, '');
    return value;
  }

  var linkSlides = function (links) {
    if (initOpt.type === 'Transcript' && links && links['slides']) {
      var slides = links['slides'];
      var p;
      $("#a-body > p").each(function () {
        p = $(this);
        p.html(p.html().replace(/slides/gi, function (x) {
          return '<strong><a href="' + slides.link + '" target="_blank" sasource="linked_slides_word">' + x + '</a></strong>'
        }))
      })
    }
  };

  scope.init = function (opt) {
    initOpt = $.extend({}, initOpt, opt);

    var data = {slug: initOpt.slug, epoch: initOpt.epoch, type: initOpt.type};
    $.get(initOpt.url, data).done(function (res) {
      if (res) {
        renderPreview(res);
        linkSlides(res.links);
      } else {
        container.remove();
      }
    }).fail(function () {
      container.remove();
    });
  };

}(window.SA, window.jQuery));
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/hover_popup/ticker_hover_card/content"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push(''); 
    var pricePrefix = index_symbol ? '' : '$',
      title = symbol.length > 5 ? symbol : '';
  ; __p.push('\n\n<div class="ticker-container">\n  <div class="symbol" title=',  title ,'><a href="/symbol/',  symbol ,'?sasource=ticker_card_symbol">',  symbol ,'</a></div>\n  ');  if (obj.price){ ; __p.push('\n  <div class="price-data">\n    <div class="price">',  pricePrefix ,'',  formatter.number(price, {withCommas: true, allowZero: true}) ,'</div>\n    <div class="change ',  direction ,'">\n      <span class="value">',  formatter.number(value, {withCommas: true, minDecimals: 2, allowZero: true}) ,'</span>\n      <span class="percent">',  formatter.number(percent, {allowZero: true}) ,'%</span>\n    </div>\n  </div>\n  ');  } ; __p.push('\n</div>\n');  if (obj['company_name']){ ; __p.push('\n<div class="name"><a href="/symbol/',  symbol ,'?sasource=ticker_card_description">',  company_name ,'</a></div>\n');  } ; __p.push('\n');  if (obj['bus_desc'] && bus_desc !== "") { ; __p.push('\n<div class="bus-desc">',  bus_desc ,'</div>\n');  } ; __p.push('\n');  if (logged_in && obj['low52']){ ; __p.push('\n<div class="key-data ',  index_symbol ? 'index-symbol' : '' ,'">\n  <div class="range">\n    <div class="range-title">52 Week Range</div>\n    <div class="range-values">\n      <span class="low">',  formatter.number(low52, {withCommas: true}) ,'</span> - <span\n              class="high">',  formatter.number(high52, {withCommas: true}) ,'</span>\n    </div>\n  </div>\n  <div class="cap">\n    ');  if (obj['fund_type']){ ; __p.push('\n    <div class="cap-title">',  fund_type ,'</div>\n    ');  } ; __p.push('\n    ');  if (obj['market_cap']){ ; __p.push('\n    <div class="cap-value">',  formatter.number(market_cap) ,'</div>\n    ');  } ; __p.push('\n  </div>\n</div>\n');  } ; __p.push('\n<div class="more-link"><a href="/symbol/',  symbol ,'/',  index_symbol ? 'historical-price-quotes' : 'overview' ,'?sasource=ticker_card_more" target="_blank">More </a>\n</div>\n<div class="hover-card-add-to-portfolio ',  symbol ,'">\n</div>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/hover_popup/ticker_hover_card/no_content"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div class="ticker-container">\n  <div class="symbol"><a href="/symbol/',  symbol ,'">',  symbol ,'</a></div>\n</div>\n<div class="name"><a href="/symbol/',  symbol ,'">',  ticker_name ,'</a></div>\n');  if(defunct !== "") { ; __p.push('\n<div class="no-data">',  defunct ,'</div>\n');  } else if (exchange == "Private") { ; __p.push('\n<div class="no-data">',  symbol ,' is currently a private company.</div>\n');  } else { ; __p.push('\n<div class="no-data">We could not find data about ',  symbol ,'.</div>\n');  } ; __p.push('\n<div class="more-link"><a href="/symbol/',  symbol ,'/key-data" target="_blank">More </a></div>\n');}return __p.join('');};
}).call(this);









(function (w, SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Widgets');
  scope.TickerHoverCard = function (opt) {
    var contentType = 'application/x-www-form-urlencoded',
      formatter = SA.Utils.Formatter,
      symbols = [],
      $contentContainer,
      $currHovEl,
      followCard = SA.Widgets.FollowCard,
      cssClasses = ['ticker-hover-container', 'hover-card'],
      cssSelector = '.' + cssClasses.join('.'),
      symbolScope = SA.Utils.SymbolData,
      indexTickers = SA.pageConfig.Data.indexTickers || {};

    function popoverConfig(content) {
      return {
        placement: calculatePopoverPlacement,
        trigger: 'manual',
        html: true,
        template: w.JST['jst/widgets/hover_popup/template']({cssClass: cssClasses.join(' ')}),
        content: content
      };
    }

    function calculatePopoverPlacement() {
      var currTop = $(document).scrollTop() + $('#main-nav-wrapper-row').height();
      return (this.$element.offset().top - currTop) > 370 ? 'top' : 'bottom';
    }

    function dataPromise(slug, dataScope) {
      var dfd = $.Deferred();
      dataScope(slug, dfd.resolve);
      return dfd;
    }

    function updateIndexPopupClb(hash) {
      var symbol = hash.symbol,
        indexSymbol = hash.indexSymbol,
        rtData = $.map(hash.rtData,function(sym) {if (sym.Identifier === indexSymbol) {return sym;}})[0],
        dailyData = hash.dailyData[0][symbol];

      if (!rtData || !dailyData) {return gatherNoData;}
      var change = rtData.Value.ChangeFromPreviousClose;
      saveDataToElement(symbol, {
        symbol: symbol,
        index_symbol: indexSymbol,
        price: rtData.Value.Last,
        value: change,
        percent: rtData.Value.PercentChangeFromPreviousClose,
        direction: change > 0 ? 'up' : change < 0 ? 'down' : '',
        company_name: dailyData.company_name || rtData.Index.IndexName,
        high52: dailyData.high52,
        low52: dailyData.low52
      });
      generatePopover(symbol);
    }

    function updatePopupClb(hash) {
      var symbol = hash.symbol,
        sqData = $.map(hash.sqData,function(sym) {if (sym.Identifier === symbol) {return sym;}})[0],
        dailyData = hash.dailyData[symbol];

      if (!sqData || !dailyData) {return gatherNoData;}
      var change = sqData.Change;

      saveDataToElement(symbol, {
        symbol: symbol,
        index_symbol: '',
        price: sqData.Last,
        value: change,
        percent: sqData.PercentChange,
        direction: change > 0 ? 'up' : change < 0 ? 'down' : '',
        fund_type: getFundType(dailyData),
        company_name: dailyData.company_name,
        bus_desc: dailyData.bus_desc,
        high52: dailyData.high52,
        low52: dailyData.low52,
        market_cap: dailyData.market_cap
      });
      generatePopover(symbol);
    }

    function indexTickerPopover(symbol, indexSymbol) {
      $.when(dataPromise(indexSymbol, symbolScope.getCachedRealTimeIndices), dataPromise(symbol, symbolScope.getCacheDailyData))
        .done(function (rtData, dailyData) {
          updateIndexPopupClb({rtData: rtData[0], dailyData: dailyData, indexSymbol: indexSymbol, symbol: symbol});
        }).fail(function (res) {
        SA.Rollbar.error('Ticker hover error: ' + res);
      });
    }

    function onPopoverHover(e) {
      $currHovEl = $(e.currentTarget);

      var symbol = $currHovEl.attr('symbol'),
        indexSymbol = $currHovEl.attr('index_symbol');

      if (indexSymbol) {
        return indexTickerPopover(symbol, indexSymbol);
      }

      $.when(dataPromise(symbol, symbolScope.getCachedSuperQuotes), dataPromise(symbol, symbolScope.getCacheDailyData))
        .done(function (sqData, dailyData) {
          updatePopupClb({sqData: sqData[0], dailyData: dailyData[0], symbol: symbol});
        }).fail(function (res) {
          SA.Rollbar.error('Ticker hover error: ' + res);
      }).always(function() {});
    }

    function getFundType(data) {
      if (data.index_fund) {
        return 'AUM:';
      } else if (data.mf) {
        return 'Net Assets:';
      }
      return 'Market Cap.';
    }

    function getSymbolLinkElements(symbol) {
      return $('.ticker-link[symbol="' + symbol.toUpperCase() + '"]');
    }

    function saveDataToElement(symbol, data) {
      var $link = getSymbolLinkElements(symbol);
      $.each(data, function (k, v) {
        $link.attr(k, v);
      });
    }

    function currentlyHovering() {
      return $currHovEl.is(':hover') || $(cssSelector + ':hover').length;
    }

    function generatePopover(symbol) {
      if (currentlyHovering() && $currHovEl.attr('symbol') === symbol) {
        followCard.hide();

        var data = initPopoverContentData(),
          jst = data.no_data ? 'no_content' : 'content';

        $currHovEl.popover(popoverConfig(w.JST['jst/widgets/hover_popup/ticker_hover_card/' + jst](data)));
        $currHovEl.popover('show');

        SA.Widgets.Button.FollowTicker.add({
          ticker: symbol,
          container: '.hover-card-add-to-portfolio.' + symbol.replace('.','\\.'), //good for tickers with dots
          showOnLoad: true,
          getAlerts: 'hidden',
          followersCount: 'show',
          enablePortfolioSelect: true,
          requireRegistration: true,
          onFollowSuccess: function (portfolio, rtaChecked) {
            showFollowCard($currHovEl, symbol, portfolio, rtaChecked);
          },
          bi: {source: 'ticker_card', triggerShowEvent: false}
        });

        SA.Logger.Mone.event('', 'ticker_card', 'shown', {data: {symbol: symbol}});
      }
    }

    function initPopoverContentData() {
      var data = {
        formatter: formatter,
        logged_in: SA.Data.User.id()
      };
      $.each($currHovEl[0].attributes, function () {
        data[this.name] = this.value;
      });
      return data;
    }

    function showFollowCard($hoveredElem, symbol, portfolio, rtaChecked) {
      $hoveredElem.popover('hide').popover('destroy');
      setTimeout(function () {
        followCard.show({
          $hoverElement: $hoveredElem,
          object: new followCard.Symbol([symbol], portfolio),
          rtaChecked: rtaChecked
        });
      }, 300);
    }

    function onShownPopover(e) {
      var curr = e.currentTarget;
      $('.ticker-link').each(function (i, elem) {
        if (curr !== elem) {
          $(this).popover('hide').popover('destroy');
        }
      });
    }

    function hidePopover(e) {
      var $el = $(e.currentTarget);
      setTimeout(function () {
        if (!$(cssSelector + ':hover').length) {
          $el.popover('hide').popover('destroy');
        }
      }, 300);
    }

    function gatherNoData(symbol) {
      $.get('/tags/ticker_card_data', {symbol: symbol}, function (res) {
        symbol = symbol.toUpperCase();
        saveDataToElement(symbol, $.extend({}, res.data[symbol]));
        generatePopover(symbol);
      });
    }

    function gatherAndTagSymbolLinks() {
      $contentContainer.find('a').each(function () {
        var $el = $(this),
          href = $el.attr('href');

        if (href && href.match('/symbol/') && !href.match('/symbol/.*/')) {
          var symbol = href.replace(/.*\/symbol\/|(\/.*)/g, '').toUpperCase();
          symbols.push(symbol);
          $el.attr({'symbol': symbol, 'data_retrieved': 0, 'title': null, index_symbol: indexTickers[symbol]}).addClass('ticker-link');
        }
      });

      $.unique(symbols);
    }

    function initEvents() {
      $contentContainer
        .on('mouseenter', '.ticker-link', onPopoverHover)
        .on('shown.bs.popover', '.ticker-link', onShownPopover)
        .on('mouseleave', cssSelector + '.in', hidePopover)
        .on('mouseleave', '.ticker-link', hidePopover);
    }

    function init() {
      opt = opt || {container: '#main_content'};

      $contentContainer = $(opt.container);

      gatherAndTagSymbolLinks();
      initEvents();
    }

    init();
  };

}(window, window.SA, window.jQuery));
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/like"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('');  if (thumbSvg) { ; __p.push('\n<div class="like-btn">\n  ',  thumbSvg ,'\n  <span class="like-text">',  text ,'</span>\n</div>\n');  } ; __p.push('\n<div class="likers" data-count="0"',  separator ? ' data-separator="' + separator + '"' : '' ,'></div>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/inline_svg/like"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<svg class="thumb" version="1.1" x="0px" y="0px" width="18.01px" height="14.062px" viewBox="0 0 18.01 14.062"\n     enable-background="new 0 0 18.01 14.062" xml:space="preserve">\n  <path fill="#555655" d="M6.471,1.653c0.011,0.241,0.032,0.542,0.068,0.908c0.045,0.448,0.41,1.252,0.654,1.679l1.165,2.026 L5.737,6.281L1.636,6.303l0.002,1.412l2.453,4.943h7.364l0.012-7.013c-0.516-0.296-1.681-0.993-2.619-1.757 C7.959,3.163,7.37,2.289,7.002,1.597 M15.545,7.009v5.648h0.818V7.009H15.545 M8.08,0.058c0,0,0.511,1.677,1.892,2.802 c1.117,0.911,2.637,1.741,2.637,1.741c0.303,0.254,0.482,0.607,0.482,0.996v7.061c0,0.777-0.736,1.412-1.636,1.412H4.091 c-0.679,0-1.26-0.353-1.505-0.861L0.114,8.23C0.041,8.068,0,7.899,0,7.715V6.303c0-0.777,0.736-1.412,1.636-1.412l4.091-0.022 c0,0-0.725-1.261-0.818-2.185C4.807,1.669,4.695,0.253,4.917,0.062L8.08,0.058L8.08,0.058z M13.909,5.597H18v8.473h-4.091V5.597 L13.909,5.597z"/>\n</svg>\n');}return __p.join('');};
}).call(this);




(function (w, SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Widgets');

  scope.Like = function (opt) {
    var identifier, text, likers, $selector, afterDataLoad;
    var saUser = SA.Data.User, likeModel = SA.Models.Like;

    function iLiked() {
      return $.inArray(saUser.id(), likers) > -1;
    }

    function isValid() {
      opt.identifier = opt.identifier || {};
      return !!opt.identifier.id && !!opt.identifier.type;
    }

    function setVars() {
      identifier = opt.identifier;
      $selector = $(opt.selector || ('.like.' + identifier.id + '-' + identifier.type));
      likers = opt.likers || [];
      text = opt.text || 'Like';
      afterDataLoad = opt.afterDataLoad;
    }

    function setElements() {
      var $elem;
      $.each($selector, function () {
        $elem = $(this);
        // for rating model popup - on hover over likers count
        $elem.data({id: identifier.id, type: identifier.type});
        $elem.append(w.JST['jst/widgets/like']({
          thumbSvg: !!$elem.data('show-thumb') ? w.JST['jst/inline_svg/like']() : '',
          text: text,
          separator: $elem.data('separator')
        }));
      });
    }

    function setEvents() {
      $selector.on('click', '.like-btn', doLike).on('click', '.likers', triggerLikerPopup);
    }

    function doLike(e) {
      if (!requireLogin() && !promptForUsername(e)) {
        toggleLike();
      }
    }

    function requireLogin() {
      if (!saUser.loggedIn()) {
        SA.Widgets.AuthenticationPopup.show({
          header: true,
          headerContent: 'You must be logged in to perform this action. Please log in or sign up.'
        });
        SA.Logger.Mone.event('popup', 'registration', 'shown');
        return true;
      }
      return false;
    }

    function promptForUsername(e) {
      if (!saUser.hasNick()) {
        var enterNickPopup = SA.Widgets.EnterUsername.show({
          callback: promptForPicture,
          source: $(e.currentTarget).data('source') + '_like',
          footerContent: 'Username will be displayed next to your likes, comments and StockTalk',
          buttonContent: 'Save'
        });
        enterNickPopup.show();
        return true;
      }
      return false;
    }

    function promptForPicture() {
      if (!saUser.hasProfilePicture()) {
        SA.Widgets.UploadUserImagePopUp.show({
          container: $('body'),
          force_callback: true
        });
      }
      toggleLike();
    }

    function toggleLike() {
      if (iLiked()) {
        likeModel.ajaxRemoveLike(identifier, onUnLikeDone, null, updateGui);
      } else {
        likeModel.ajaxAddLike(identifier, onLikeDone, null, updateGui);
      }
    }

    function onUnLikeDone(res) {
      res = res || {};
      if (res.success) {
        var i = $.inArray(saUser.id(), likers);
        if (i > -1) {
          likers.splice(i, 1);
        }
      }
    }

    function onLikeDone(res) {
      res = res || {};
      if (res.success) {
        if ($.inArray(saUser.id(), likers) === -1) {
          likers.push(saUser.id());
        }
      }
    }

    function triggerLikerPopup(e) {
      if (likers.length && (!e.detail || e.detail === 1)) {
        var opt = $.extend({}, identifier, {
          source: $(e.currentTarget).parent().data('source'),
          clb: function (likersData) {
            likers = likersData.map(function (i) {
              return i.id;
            });
            updateGui();
          }
        });
        SA.Widgets.LikersPopup.show(opt);
      }
    }

    function updateGui() {
      updateElements();
      toggleLikeBtn();
    }

    function updateElements() {
      var $likers = $selector.find('.likers'),
        count = likers.length;

      if (count) {
        $likers.attr('data-count', count).addClass('show-likers');

        if (count === 1) {
          $likers.addClass('only-one');
        } else {
          $likers.removeClass('only-one');
        }
      } else {
        $likers.removeClass('show-likers');
      }
    }

    function toggleLikeBtn() {
      if (iLiked()) {
        $selector.addClass('liked');
      } else {
        $selector.removeClass('liked');
      }
    }

    function getLikers() {
      likeModel.ajaxGetLikers(identifier, function (res) {
        res = res || {};

        if (res.success) {
          likers = res.user_ids || [];
          finishInit();

          if ($.isFunction(afterDataLoad)) {
            afterDataLoad(res);
          }
        }
      });
    }

    function finishInit() {
      updateGui();
      $selector.addClass('rendered');
    }

    function init() {
      if (isValid()) {
        setVars();
        setElements();
        setEvents();

        if (likers && likers.length) {
          finishInit();
        } else {
          getLikers();
        }
      }
    }

    init();

  };

}(window, window.SA, window.jQuery));
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/liftiginiter_recommendations/unit"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<section id="article_recommendations" class="hidden-print">\n  <header><h2>Recommended for you:</h2></header>\n  <ul id="recommendations-list">\n    ');  recommendations.forEach(function(r) { ; __p.push('\n      ');  if (!!r.instream_recommendation_ad) { ; __p.push('\n        <li id="',  r.instream_recommendation_ad ,'"></li>\n      ');  } else { ; __p.push('\n        <li',  r.hide ? ' class="hidden"' : '' ,' data-id="',  r.id ,'">\n          <a class="recommended_article" sasource="article_bottom_lift" href="',  r.url ,'">\n            <div class="pic">\n              <img src="',  r.author.image ,'" width="50" height="50" class="img-circle" alt="',  r.author.name ,'">\n            </div>\n            <div class="main">\n              <div class="article_title">',  r.title ,'</div>\n              <div class="article_info">\n                ',  r.author.name ,'\n                ');  if (r.author.name){ ; __p.push('\n                  <span class="bullet">&bull;</span>\n                ');  } ; __p.push('\n                ',  r.publishDate ,'\n              </div>\n            </div>\n          </a>\n        </li>\n      ');  } ; __p.push('\n    ');  }) ; __p.push('\n  </ul>\n</section>\n');}return __p.join('');};
}).call(this);

(function (w, SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Widgets');
  scope.LiftigniterUnit = function (suggested, track) {

    var $unit, unitSelector = '#recommendations-list', saScroll = SA.Utils.Scroll;

    var MONTH = ['Jan.', 'Feb.', 'Mar.', 'Apr.', 'May', 'Jun.', 'Jul.', 'Aug.', 'Sep.', 'Oct.', 'Nov.', 'Dec.'];

    var AMPM = {am: 'AM ET', pm: 'PM ET'};

    function render(items) {
      var recommendations = $.map(items, function (item) {
        return {
          hide: item.hide,
          id: item.id,
          url: item.url,
          title: item.title,
          publishDate: item.publish_time ? parseDate(item.publish_time) : '',
          author: {
            image: item.author_image || SA.App.assetHost + '/images/user/commenter_gray.png',
            name: item.author_name
          }
        };
      });

      recommendations.splice(getAdPosition(), 0, {instream_recommendation_ad: 'instream_recommendation_ad'});

      $('#recommendations-wrapper').replaceWith(w.JST['jst/widgets/liftiginiter_recommendations/unit']({
        recommendations: recommendations
      }));

      $unit = $(unitSelector);

      renderAd();
    }

    function parseDate(datetime) {
      var d = new Date(datetime),
        hour = d.getHours(),
        minutes = d.getMinutes(),
        ampm = hour < 12 ? AMPM.am : AMPM.pm;

      hour = hour % 12;
      if (hour === 0) {
        hour += 12;
      }

      if (minutes < 10) {
        minutes = '0' + minutes;
      }

      return [MONTH[d.getMonth()], d.getDate() + ',', d.getFullYear(), hour + ':' + minutes, ampm].join(' ');
    }

    function getAdPosition() {
      return 1;
    }

    function renderAd() {
      //trigger delayed ads
      SA.execIfResolved(['SA.Ads.Initializer'], function (i) {
        i.renderDelayed();
      });
    }

    function scrollToSpecificComment() {
      if (SA.Widgets.CommentsTree.showSpecific) {
        SA.Widgets.CommentsTree.scrollToSpecific();
      }
    }

    function events(items, track) {
      saScroll.add(unitShown);

      if (track) {
        trackUnit();
      }
    }

    function unitShown() {
      if (saScroll.isCloseToElement($unit, -$unit.height())) {
        var items = {};
        $unit.find('li[data-id]').map(function (index, item) {
          items[index + 1] = item.getAttribute('data-id');
        });
        SA.Logger.Mone.event('', '', 'liftignitor_impression', {data: items});

        saScroll.remove(unitShown);
      }
    }

    function trackUnit() {
      w.$p('track', {
        elements: document.querySelectorAll(unitSelector),
        name: 'liftigniter-widget',
        source: 'LI',
        opts: {channel: 'article'}
      });
    }

    function init() {
      var items = (suggested || {}).items || [];
      if (items.length) {
        render(items);
        scrollToSpecificComment();
        events(items, (track === undefined || !!track));
        unitShown();
      }
    }

    init();

  };

}(window, window.SA, window.jQuery));
(function(SA, $){

  "use strict";

  var scope = SA.UsingNamespace('SA.Widgets.ReportProblemPopup'),
    popup = null,
    isTranscript = false;

  var setPopupEvents = function(id) {
    var $modal = popup.getModalObject(),
      $btn = $modal.find('.orange-btn:first'),
      $error = $modal.find('.error'),
      $textArea = $modal.find('textarea:first'), reportText,
      ajaxUrl = isTranscript ? '/articles/ajax_report_transcript' : '/articles/ajax_report_article';

    $btn.on('click', function () {
      reportText = $textArea.val().trim();
      if (reportText) {
        $btn.addClass('sa-animated');
        $.ajax(ajaxUrl, {
          data: {
            article_id: id,
            problem_text: reportText
          },
          dataType: 'text',
          method: 'post'
        }).done(function () {
          $btn.removeClass('sa-animated');
          popup.hide();
        }).fail(function () {
          $btn.removeClass('sa-animated');
        });
      } else {
        $error.text('Please enter your report');
      }
    });
  };

  var buildReportProblemPopup = function(id, title){
    popup = SA.Widgets.Popup.build({
      headerContent: '<h4>Report a Problem</h4>' + (isTranscript ? '' : '<div class="t">Article: ' + title + '</div>'),
      bodyContent: '<textarea placeholder="Please provide details of any errors you\'ve identified in this transcript, and how they should be corrected. We appreciate your help, thank you!"></textarea>',
      footerContent: '<div class="error"></div><button class="btn btn-primary orange-btn">Send</button>',
      showFooter: true,
      className: 'r-p-m'
    });

    setPopupEvents(id);
  };

  scope.init = function(articleId, articleTitle){
    var $link = $('#report-problems-sidebar');
    isTranscript = $link.hasClass('transcript');
    if(articleId && articleTitle){
      $link.click(function(event){
        event.preventDefault();
        SA.Logger.Mone.event("report_problem", "article", "shown", {data: {article_id: articleId}});
        if(SA.Data.User.loggedIn()) {
          if(!popup){
            buildReportProblemPopup(articleId, articleTitle);
          }
          return popup.show();
        }
        return SA.Widgets.AuthenticationPopup.show();
      });
    }
  };

}(SA, jQuery));

(function(SA, $) {

  "use strict";

  var scope = SA.UsingNamespace('SA.Widgets.ArticleAbout'), $container = $('#a-about');

  var initCollapse = function(){
    var up = 'Collapse<span class="caret up"></span>',
        down = 'Expand<span class="caret"></span>',
        $collapsable = $('#about-c'),
        $btn = $container.find('.exp:first');

    $btn.on('click', function() {
      $collapsable.collapse('toggle');
      $btn.html(function() {
        return $collapsable.attr('aria-expanded') === 'true' ? up : down;
      });
    });
  };

  var initBecomeContributorURL = function(){
    if($('#author-payment').length){
      var url = SA.Data.User.isAuthor() ? '/page/become-a-seeking-alpha-pro-contributor' : '/page/become-a-seeking-alpha-contributor';
      $('.become-a-contributor').attr('href', url);
    }
  };

  var initSubmitArticleURL = function(){
    var url = SA.Data.User.hasContributorDetails() ? '/submission' : '/page/become-a-seeking-alpha-contributor';
    $('.submit-article-sidebar').attr('href', url);
  };

  var initReportProblem = function(articleId, articleTitle){
    if($('#report-problems-sidebar').length){
      SA.Widgets.ReportProblemPopup.init(articleId, articleTitle);
    }
  };

  function initAddComment() {
    if (SA.Data.User.loggedIn()) {
      $('.about-add-comment-link').on('click', function (e) {
        e.preventDefault();
        $('.c-comment-box .c-box-form textarea').focus();
      });
    } else {
      $('.title-add-comment, .about-add-comment-link, #about-c .media-left').remove();
    }
  }

  var initUnitLinks = function(articleId, articleTitle){
    initBecomeContributorURL();
    initSubmitArticleURL();
    initReportProblem(articleId, articleTitle);
    initAddComment();
  };

  scope.init = function(opt) {
    opt = opt || {};
    if(opt.articleId && opt.articleTitle){
      initCollapse();
      initUnitLinks(opt.articleId, opt.articleTitle);
    }
  };

}(SA, jQuery));


(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/pagination/body"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div id="a-pagination" class="hidden-print">\n  <div class="pull-left">\n    ');  if(singlePageBtn) { ; __p.push('\n    <a href="#" id="single-view">Single page view</a>\n    ');  } ; __p.push('\n  </div>\n  <div class="pull-right">\n    ');  if(showPrevBtn) { ; __p.push('\n      <a href="#" id="page-prev"> Previous</a>\n      <span class="sep">|</span>\n    ');  } ; __p.push('\n      <span class="pages">page ',  page ,' / ',  pages ,'</span>\n    ');  if(showNextBtn) { ; __p.push('\n      <span class="sep">|</span>\n      <a href="#" id="page-next">Next </a>\n    ');  } ; __p.push('\n  </div>\n<div class="clearfix"></div>\n</div>\n');}return __p.join('');};
}).call(this);

(function(w, SA, $){

  "use strict";

  var scope = SA.UsingNamespace('SA.Widgets.Pagination'),
      tRB = SA.Widgets.TranscriptRoadblock,
      aRB = SA.Widgets.PageRoadblock,
      aPath = window.location.pathname,
      options, isTranscript;


  var getSourceParam = function() {
    var source = SA.Utils.SASource.get(), s = '';
    if(source){
      s = '&source=' + source;
    }
    return s;
  };


  // TRANSCRIPTS PAGINATION
  var singlePageLogin = function() {
    w.location.href = aPath + '?part=single' + getSourceParam();
  };

  var nextPageLogin = function() {
    var next = options.config.page + 1;
    if(next >= options.config.pages) {
      return location.reload();
    }
    w.location.href = aPath  + '?page=' + next + getSourceParam();
  };

  var setSingleView = function($pagination) {
    $pagination.on('click', '#single-view', function(e) {
      SA.Data.Cache.set('transcripts_single_page_view','true');
      e.preventDefault();
      if(!tRB.active()) {
        w.location.href = aPath + '?part=single' + getSourceParam();
      } else {
        tRB.show({
          onLoginSuccess: singlePageLogin
        });
      }
    });
  };

  var setTranscriptNext = function($pagination, opt) {
    $pagination.on('click', '#page-next', function(e) {
      e.preventDefault();
      var next = options.config.page + 1;
      if(next > options.config.pages) {
        return false;
      }
      if(!tRB.active()) {
        w.location.href = aPath + '?page=' + next + getSourceParam();
      } else {
        if(next > options.config.limit) {
          tRB.show({
            onLoginSuccess: nextPageLogin
          });
        } else {
          w.location.href = aPath + '?page=' + next + getSourceParam();
        }
      }

    });
  };

  var setTranscriptPrev = function($pagination) {
    $pagination.on('click', '#page-prev', function(e) {
      e.preventDefault();
      var prev = options.config.page - 1;
      if(prev <= 0) {
        return false;
      }
      w.location.href = aPath + '?page=' + prev + getSourceParam();
    });
  };

  var setTranscriptEvents = function($pagination) {
    setSingleView($pagination);
    setTranscriptNext($pagination);
    setTranscriptPrev($pagination);
  };

  var buildForTranscript = function() {
    var conf = options.config,
    $pagination = $(JST['jst/widgets/pagination/body']({
      page: conf.page,
      pages: conf.pages,
      singlePageBtn: conf.singlePageBtn,
      showPrevBtn: conf.page > 1,
      showNextBtn: conf.page < conf.pages
    }));

    setTranscriptEvents($pagination);

    return $pagination;
  };

  var initTranscript = function() {
    if(!options.config.singlePage) {
      $('#a-pagination-wrapper').replaceWith(buildForTranscript());
    }
  };

  //Article Pagination
  var setArticleNext = function($pagination, opt) {
    $pagination.on('click', '#page-next', function(e) {
      e.preventDefault();
      var next = options.config.page + 1;
      if(next > options.config.pages) {
        return false;
      }
      if(!aRB.active()) {
        w.location.href = aPath + '?page=' + next + getSourceParam();
      } else {
        if(next > options.config.limit) {
          aRB.show({
            onLoginSuccess: nextPageLogin
          });
        } else {
          w.location.href = aPath + '?page=' + next + getSourceParam();
        }
      }
    });
  };

  var setArticleEvents = function($pagination, opt) {
    setArticleNext($pagination, opt);
  };

  var sendMoneEvent = function(conf){
    var data = {
      article_length: conf.pages,
      page: conf.page
    };
    SA.Logger.Mone.event('roadblock', 'article', 'pagination_shown', {data: data});
  };

  var buildForArticle = function() {
    var conf = options.config,
    $pagination = $(JST['jst/widgets/pagination/body']({
      page: conf.page,
      pages: conf.pages,
      singlePageBtn: false,
      showPrevBtn: false,
      showNextBtn: conf.page < conf.pages
    }));
    setArticleEvents($pagination);
    sendMoneEvent(conf);
    return $pagination;
  };

  var initArticle = function() {
    if(!options.config.singlePage) {
      $('#a-pagination-wrapper').replaceWith(buildForArticle());
    }
  };

  scope.active = function() {
    return !options.config.singlePage;
  };

  scope.init = function(opt) {
    options = opt || {};
    isTranscript = options.isTranscript;
    if(isTranscript && options.active) {
      return initTranscript();
    }
    return initArticle();
  };

}(window, window.SA, window.jQuery));





jQuery.extend({
  highlight: function (node, re, nodeName, className) {
    if (node.nodeType === 3) {
      var match = node.data.match(re);
      if (match) {
        var highlight = document.createElement(nodeName || 'span');
        highlight.className = className || 'highlight';
        var wordNode = node.splitText(match.index);
        wordNode.splitText(match[0].length);
        var wordClone = wordNode.cloneNode(true);
        highlight.appendChild(wordClone);
        wordNode.parentNode.replaceChild(highlight, wordNode);
        return 1; //skip added node in parent
      }
    } else if ((node.nodeType === 1 && node.childNodes) && // only element nodes that have children
      !/(script|style)/i.test(node.tagName) && // ignore script and style nodes
      !(node.tagName === nodeName.toUpperCase() && node.className === className)) { // skip if already highlighted
      for (var i = 0; i < node.childNodes.length; i++) {
        i += jQuery.highlight(node.childNodes[i], re, nodeName, className);
      }
    }
    return 0;
  }
});

jQuery.fn.unhighlight = function (options) {
  var settings = { className: 'highlight', element: 'span' };
  jQuery.extend(settings, options);

  return this.find(settings.element + "." + settings.className).each(function () {
    var parent = this.parentNode;
    parent.replaceChild(this.firstChild, this);
    parent.normalize();
  }).end();
};

jQuery.fn.highlight = function (words, options) {
  var settings = { className: 'highlight', element: 'span', caseSensitive: false, wordsOnly: false };
  jQuery.extend(settings, options);

  if (words.constructor === String) {
    words = [words];
  }
  words = jQuery.grep(words, function(word, i){
    return word != '';
  });
  words = jQuery.map(words, function(word, i) {
    return word.replace(/[-[\]{}()*+?.,\\^$|#\s]/g, "\\$&");
  });
  if (words.length == 0) { return this; };

  var flag = settings.caseSensitive ? "" : "i";
  var pattern = "(" + words.join("|") + ")";
  if (settings.wordsOnly) {
    pattern = "\\b" + pattern + "\\b";
  }
  var re = new RegExp(pattern, flag);

  return this.each(function () {
    jQuery.highlight(this, re, settings.element, settings.className);
  });
};



(function(w, $, SA) {

  "use strict";

  var user = SA.Data.User, article = SA.pageConfig.Data.article;
  var $w = $(w), $container = $('#a-body'), fullView = SA.Fn.param('part') === 'single';
  var scrollSpeed = 200, headerHeight = $('#sa-hd').height(), tempVal;
  var $audioSection, $audio;

  function showFullView() {
    $container.find('.p').show();
    fullView = true;
  }

  function scrollToFirst() {
    var $res = $container.find('.highlight');
    if($res.length) {
      $w.scrollTo($res.first(), scrollSpeed, {
        offset: {
          top: -Math.abs(headerHeight) - 100
        }
      });
    }
  }

  var highlightNext = function() {
    w.location.href = window.location.pathname + '?part=single&term=' + tempVal;
  };

  var highlightContent = function(val) {
    if(!fullView) {
      showFullView();
    }
    $container.unhighlight();
    $container.highlight(val);
    scrollToFirst();
  };

  var initSearch = function() {
    var val = SA.Fn.param('term');
    if(user.loggedIn() && val) {
      $container.highlight(val);
      scrollToFirst();
    }
  };

  function getTimeFormat () {
    var time = $audio[0].currentTime;
    return parseInt(time / 60).toString() + ':' + parseInt(time % 60);
  }

  function bi(action) {
    SA.Logger.Mone.event('media_player', 'transcripts', action, {data: {time_played: getTimeFormat()}});
  }

  function initAudio() {
    // file exists
    $audioSection.show();

    $audio
      .on('play', function () {
        bi('play');
      })
      .on('pause', function () {
        if (!$audio[0].ended) {
          bi('stop');
        }
      })
      .on('ended', function () {
        bi('end');
      });

    if (user.isCommonPro()){
      SA.Logger.Mone.event('media_player', 'transcripts', 'load', {data: {status: 'unlocked', user_id: user.id()}});
    } else {
      SA.Logger.Mone.event('media_player', 'transcripts', 'load', {data: {status: 'locked', user_id: user.id()}});

      $audio.find('.mask').click(function(){
        SA.Logger.Mone.event('media_player', 'transcripts', 'click', {data: {status: 'invitation_to_subscribe'}});
      });

      var action = {
        text: 'Learn More',
        sasource: 'learn_more_mplayer_tr_' + article.id
      };

      if (user.isPremiumFreeTrialEligible()){
        action.text = 'Start Your Free Trial';
        action.sasource = 'start_freetrial_mplayer_tr_' + article.id;
      }

      var popup = SA.Widgets.Popup.build({
        className: 'subscriber-only-feature',
        headerContent: '<div class="popup-header">This is a subscriber-only feature.</div>',
        bodyContent: '<div class="popup-body"><a sasource="' + action.sasource + '" href="' + SA.App.host + '/premium" class="action">' + action.text + '</a></div>',
        keyboard: true,
        showCloseBtn: false,
        backdrop: true
      });

      $('.mask, .lock').click(function(){
        popup.show();
      });
    }
  }

  var init = function() {
    if (article.isTranscript) {
      $audioSection = $('section.audio');
      $audio = $audioSection.find('audio');

      if ($audioSection.length && $audio.length) {
        initAudio();
      }

      initSearch();

      $('#tr-search').on('click', '#global-s-submit', function () {
        var val = $('#global-s').val().trim();
        if (val) {
          w.location.href = '/search/?q=' + encodeURIComponent(val) + "&type=keyword&tab=transcripts";
        }
      }).on('click', '#local-s-submit', function () {
        var val = $('#local-s').val().trim();
        if (val) {
          if (SA.Widgets.TranscriptRoadblock.active()) {
            tempVal = val;

            return SA.Widgets.TranscriptRoadblock.show({
              onLoginSuccess: highlightNext
            });
          }
          highlightContent(val);
        } else {
          SA.Widgets.TranscriptRoadblock.show();
        }
      });
    }
  };

  SA.run(init, 'transcript-search');

}(window, jQuery, SA));
(function() { this.JST || (this.JST = {}); this.JST["jst/widgets/mobile_web_app_banner/mobile_web_app_banner"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div id="ipad_beta_promo_container" class="hidden-print">\n  <div id="close_promo_ipad"></div>\n  <div class="ipad_beta_promo_banners_container clearfix ',  retina ? 'retina' : '' ,' ',  androidTab ? 'android' : 'ipad' ,'">\n    <a href="',  downloadLink ,'">\n      <div class="ipad_beta_promo_banner_img_container left">\n        <img src="',  leftImgPath ,'"/>\n      </div>\n    </a>\n    <a onclick="Mone.event(\'app_promo\', \'ipad_promo_article_page\', \'clicked_open_app\')" href="sa://',  location.hostname + location.pathname ,'">\n      <div class="ipad_beta_promo_banner_img_container right">\n        <img src="',  rightImgPath ,'"/>\n      </div>\n    </a>\n  </div>\n</div>\n');}return __p.join('');};
}).call(this);

(function (SA, $) {
  "use strict";

  var scope = SA.UsingNamespace('SA.Widgets.MobileAppBanner'),
      env = SA.Utils.Env,
      androidTab,
      retina,
      basePath,
      imgExtension,
      ipadRightPath,
      ipadLeftPath,
      androidTabletRightPath,
      androidTabletLeftPath,
      pType,
      downloadLink,
      $closeBtn,
      $cont,
      animateObj;

  function getImagePath(urlPart) {
    return SA.App.assetHost + basePath + urlPart + (retina ? '@2x' : "") + imgExtension;
  }

  var init = function (articleId) {
    androidTab=env.isAndroidTablet();
    if (!SA.Data.Cookies.get('hide_ipad_promo') && (env.isAppleIpad() || androidTab)) {
      retina = 'devicePixelRatio' in window && window.devicePixelRatio > 1;
      basePath = '/images/mobile/';
      imgExtension = '.png';
      ipadRightPath = getImagePath('custom_ipad_ios7_banner_right');
      ipadLeftPath = getImagePath('custom_ipad_ios7_banner_left');
      androidTabletRightPath = getImagePath('android_tablet_app_banner/banner_part_right');
      androidTabletLeftPath = getImagePath('android_tablet_app_banner/banner_part_left');
      try{
        pType = location.pathname.substr(1).split('/')[0];
      }
      catch(e){
        pType = "unknown";
      }

      downloadLink = articleId ? "/download-app?source=smart_banner&pageType=" + pType + "&artId=" + articleId : "/download-app?source=smart_banner";
      animateObj = {duration: 500};

      $(JST['jst/widgets/mobile_web_app_banner/mobile_web_app_banner']({
        rightImgPath: androidTab ? androidTabletRightPath : ipadRightPath,
        leftImgPath: androidTab ? androidTabletLeftPath : ipadLeftPath,
        androidTab: androidTab,
        retina: retina,
        downloadLink: downloadLink
      })).insertBefore($('#sa-hd'));
      $cont = $('#ipad_beta_promo_container').first();
      $closeBtn = $('#ipad_beta_promo_container #close_promo_ipad');
      $cont.slideDown(animateObj);
      $closeBtn.on('click', function () {
        SA.Data.Cookies.set('hide_ipad_promo', 1, { expires: 60 * 60 * 24 });
        $cont.slideUp(animateObj);
        $('#close_promo_ipad').first().slideUp(animateObj);
      });
    }
  };

  scope.init = init;

}(SA, jQuery));





(function (w, SA, $, hc) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Modules.Symbols');

  scope.SentimentsChart = function (opt) {

    opt = opt || {};

    var ticker, $container, sentiments, requestStartDate, requestEndDate,
      startDate, endTime, chartWidth,
      chart, lastPricePoint, chartSlug;

    var defaultContainer = '.ticker-sentiment-chart-container',
      DATE_FORMAT = 'MM/DD/YYYY',
      PERIOD = {
        start: '1Y',
        end: 'END_TIME'
      },
      bi = {
        source: opt.source,
        data: {
          data: {
            author: opt.authorSlug,
            slug: opt.ticker,
            period: PERIOD
          }
        }
      };

    this.promise = function () {
      if (!valid()) return;
      if ($container.is('[data-is-crypto]')) {
        return cryptoPromise();
      } else if ($container.is('[data-index-group]')) {
        return indiciesPromise();
      } else {
        return otherPromise();
      }
    };

    this.show = function (obj) {
      if (!valid()) return;
      if (!obj.errorMessage && obj.data) {
        $container.removeClass('error').addClass('loader');
        logBi('render');
        draw(prepareData(obj.data));
      } else {
        handleBadOutcome(obj.errorMessage);
      }
    };

    function prepareData(data) {
      if ($container.is('[data-is-crypto]')) {
        return mapCrypto(data);
      } else if ($container.is('[data-index-group]')) {
        return mapIndicies(data);
      } else {
        return mapOther(data);
      }
    }

    function valid() {
      chartSlug = (opt.slug || opt.ticker.toUpperCase());
      chartSlug = chartSlug ? chartSlug.split('.')[0] : '';
      ticker = opt.ticker;
      $container = $(opt.container || (defaultContainer + '[data-slug="' + chartSlug + '"]'));
      sentiments = $container.data('sentiments');
      return !$container.hasClass('locked') && ticker && $container.length && sentiments.length;
    }

    function cryptoPromise() {
      var t = ticker.split('-');
      return SA.Utils.cryptoAPI.historical('day', t[0].toUpperCase(), t[1].toUpperCase(), 356, 4).then(function (res) {
        return {data: (res.Data || []), errorMessage: res.Response === 'Success' ? '' : res.Message};
      }).fail(function () {
        handleBadOutcome('cryptocompare fail');
      });
    }

    function indiciesPromise() {
      var index_group = ticker.split('.').length < 2 ? '.' + $container.data('index-group').toLowerCase() : '';
      var url = SA.Utils.SymbolData.getCachedGlobalIndicesUrl({
        slug: ticker + index_group,
        startDate: requestStartDate,
        endDate: requestEndDate
      });
      return $.get(url).then(function (res) {
        return {data: (res.Values || []), errorMessage: res.Outcome === 'Success' ? '' : res.Message};
      }).fail(function (res) {
        handleBadOutcome(res.Outcome === 'Success' ? '' : res.Message);
      }).promise();
    }

    function otherPromise() {
      var url = SA.Utils.SymbolData.getGlobalHistoricalQuotesRangeCdnUrl({
        slug: ticker,
        startDate: requestStartDate,
        endDate: requestEndDate,
        adjustmentMethod: 'PriceReturn'
      });
      return $.get(url).then(function (res) {
        return {data: (res.HistoricalQuotes || []), errorMessage: res.Outcome === 'Success' ? '' : res.Message};
      }).fail(function (res) {
        handleBadOutcome(res.Outcome === 'Success' ? '' : res.Message);
      }).promise();
    }

    function parseDate(date) {
      return Date.parse(date.replace(/-/g, '/') + ' 16:00');
    }

    function draw(data) {
        drawDo(data);
    }

    function extendToolTips(data, slug, callback) {
      var promises = [];
      $.each(data.tooltips, function (k) {
        var v = data.tooltips[k];
        var currentPromise = $.Deferred();

        promises.push(currentPromise);
        new SA.Widgets.Pro.InvestmentSnapshot({
            ticker: slug,
            closest_trading_day: v.article.published,
            article_datetime: v.article.startdate,
            isArticlePage: opt.isArticlePage,
            clb: function (data) {
              $.extend(v.article, {
                tickerLastPrice: data.tickerLastPrice,
                tickerChangeClass: data.tickerChangeClass,
                spyPriceChange: data.spyPriceChange,
                spyChangeClass: data.spyChangeClass
              });
              currentPromise.resolve();
            }
          }
        );
      });

      $.when.apply($, promises).always(function () {
        if (callback) {
          callback();
        }
      });
    }

    function drawDo(data) {
      $container.removeClass('loader hidden no-data');

      extendToolTips(data, ticker, function () {
        // draw chart from here. Add option to use the same set of price data
        var displayTicker = ticker.split('.')[0].toUpperCase()
        drawChart({
          containerId: 'ticker-sentiment-chart-' + chartSlug,
          name: displayTicker === 'SP500' ? 'S&P 500' : displayTicker,
          startDate: startDate,
          data: data,
          width: chartWidth,
          source: opt.source
        });
        logBi('render-success');
      });
    }

    function logBi(action) {
      SA.Logger.Mone.event('ticker_sentiments_chart', bi.source, action, bi.data);
    }

    function mapCrypto(data) {
      var xMapped = [], nowYearAgo = new Date(), d;
      nowYearAgo.setMonth(nowYearAgo.getMonth() - 12);
      nowYearAgo = nowYearAgo.getTime();
      $.each(data, function (i, v) {
        d = v.time * 1000;
        if (d >= nowYearAgo) {
          xMapped[w.moment(d).format('YYYY-MM-DD')] = {date: d, close: v.close};
        }
      });

      attachSentiments(xMapped);

      return prepare(xMapped);
    }

    function mapIndicies(data) {
      var xMapped = [];
      $.each(data, function (i, v) {
        xMapped[w.moment(v.Date).format('YYYY-MM-DD')] = {date: parseDate(v.Date), close: v.Close};
      });

      attachSentiments(xMapped);

      return prepare(xMapped);
    }

    function mapOther(data) {
      var xMapped = [];
      $.each(data, function (i, v) {
        xMapped[v.Date] = {date: parseDate(v.Date), close: v.Close};
      });

      attachSentiments(xMapped);

      return prepare(xMapped);
    }

    function attachSentiments(xMapped) {
      var d, pd;

      $.each(sentiments, function (i, sentiment) {
        d = parseDate(sentiment.date);
        pd = parseDate(sentiment.article.published);
        xMapped[sentiment.date] = $.extend({date: d}, xMapped[sentiment.date], marker(d, pd, sentiment));
      });
    }

    function marker(date, publishDate, sentiment) {
      return {
        spot: {
          x: date,
          pd: publishDate,
          marker: {symbol: 'circle', radius: 5, fillColor: sentiment.type.color, lineColor: '#FFFFFF', lineWidth: 2}
        },
        tooltip: {article: sentiment.article}
      };
    }

    function prepare(mappedData) {
      var data = {series: [], markers: [], markerIndexes: [], tooltips: {}}, x, prevClose;
      $.each(Object.keys(mappedData).sort(), function (i, key) {
        x = mappedData[key];
        if (!x.close) {
          x.close = prevClose;
        }

        data.series.push([x.date, x.close]);

        if (x.spot) {
          data.markers.push($.extend(x.spot, {y: x.close}));
          data.markerIndexes.push(i);
          data.tooltips[x.date] = x.tooltip;
        } else {
          data.markers.push([x.date, x.close]);
        }

        prevClose = x.close;
      });

      return data;
    }

    function drawChart(chartOpt) {
      chartOpt.width = chartOpt.width || 720;
      var tooltipPadding = 8;

      if (lastPricePoint) {
        chartOpt.data.series.push(lastPricePoint);
      }

      var minMax = pricesMinMax(chartOpt.data.series);

      if (chart) {
        chart.destroy();
      }

      var firstTS = chartOpt.data.series[0][0],
        startTS = Date.parse(chartOpt.startDate),
        startGap;

      if (firstTS > startTS) {
        startGap = [[startTS, chartOpt.data.series[0][1]]];
      }
      //only draw the chart if container exist - avoid HC error #13
      //escape dot characters in containerId
      if ($('#' + chartOpt.containerId.replace(/\./g, '\\.')).length) {
        chart = hc.stockChart(chartOpt.containerId, {
          chart: {
            type: 'area',
            width: chartOpt.width,
            height: 192
          },

          navigator: {enabled: false},

          exporting: {enabled: false},

          scrollbar: {enabled: false},

          rangeSelector: {enabled: false},

          yAxis: {
            floor: minMax[0] = minMax[0] - minMax[0] * 0.1,
            ceiling: minMax[1],
            tickPixelInterval: 40,
            labels: {align: 'left', x: 5, y: 5}
          },

          xAxis: {
            ordinal: false,
            gridLineWidth: 1,
            // minorGridLineWidth: 1,

            tickPositioner: chartOpt.tickPositioner, // For 5D and 1M only
            tickPixelInterval: 120,

            dateTimeLabelFormats: {
              minute: '%l %p',
              // HighStock might select 'hour' or 'minute' unit for label format
              hour: '%b %e',
              day: '%b %e'
            },

            breaks: chartOpt.breaks,
            crosshair: false
          },

          credits: {
            enabled: false,
            style: 'display: none'
          },

          plotOptions: {
          series: {
            stickyTracking: false,
            events: {
              mouseOut: function () {
                this.chart.update({
                  tooltip: {
                    enabled: false
                  }
                });
          },
              mouseOver: function () {
                this.chart.update({
                  tooltip: {
                    enabled: true
                  }
                });
              }
            }
          }
        },
          tooltip: {
            useHTML: true,
            split: false,
          hideDelay: 10000,
          padding: tooltipPadding,
            borderWidth: 1,
            borderRadius: 0,
            shadow: false,
            borderColor: '#EDEDED',
            animation: true,
            style: {pointerEvents: 'auto'},
          positioner: function (labelWidth, labelHeight, point) {
            labelWidth = labelWidth + tooltipPadding * 2;
            var x = point.plotX - labelWidth / 2;
            var y = point.plotY + 20;
            if ((y + labelHeight) > this.chart.chartHeight) y = y - labelHeight - 20;
            if ((x + labelWidth) > this.chart.chartWidth) x = this.chart.chartWidth - labelWidth;
            if (x < 0) x = tooltipPadding;

            this.chart.tooltipX = x;
            this.chart.tooltipY = y;
            return {x: x, y: y};
          },
            formatter: function () {
              var obj = chartOpt.data.tooltips[this.x], a, res = false;
              if (obj && (a = obj.article)) {
                var comments = '';
                if (a.comments) {
                  comments = ' &bull; ' + a.comments + ' Comment' + (a.comments > 1 ? 's' : '');
                }

              var show_title = a.title.slice(0, 50);
              if (a.title.length > 50) show_title += "...";

                res = [
                '<div><a href="', a.uri, '" target="_blank">', show_title, '</a>',
                '<small>', w.moment(this.point.pd).format('MMM. DD, YYYY'), comments, '</small>',
                '<div class=' + "line" + '></div>',
                '<table><tbody>',
                '<tr><td>' + chartOpt.name + ' change to date: </td><td><span class="' + a.tickerChangeClass + '">' + (a.tickerLastPrice == null ? '-' : a.tickerLastPrice) + '</span></td></tr>'];
                if (chartOpt.name !== 'S&P 500') res = res.concat(['<tr><td> S&P 500 change to date: </td><td><span class="' + a.spyChangeClass + '">' + (a.spyPriceChange == null ? '-' : a.spyPriceChange) + '</span></td></tr>']);
                res = res.concat(['</tbody></table></div>']);
                res = res.join('');
              }

              return res;
            }
          },

          series: [
            {
              gapSize: 0,
              name: chartOpt.name,
              data: chartOpt.data.markers,
              id: 'dataseries',
              dataGrouping: {enabled: false},
              marker: {enabled: true, radius: 1, width: 4, height: 4},

              // color: '#FE9948',
              // If fillColor ever changes to gradient, test on Edge,
              // currently it shows black instead of the gradient.
              // Also, Edge only accepts rgba with rgba(...) syntax and not #rgba
              fillColor: 'rgba(254,180,121,0.8)'
            },
            {
              data: startGap,
              enableMouseTracking: false
            },
            {
              data: chartOpt.endGap,
              enableMouseTracking: false,
              fillOpacity: 0,
              color: '#FE0000'
            }
          ]
        });

        chartOpt.data.markerIndexes.forEach(function (m) {
          try {
            chart.series[0].data[m].graphic.toFront();
          } catch (e) {
            console.log('drawChart Issue: no such date in the chart data. Error: ' + e);
          }
        });
      }
      return chart;
    }

    function pricesMinMax(data) {
      var minPrice = NaN;
      for (var i = 0; i < data.length && isNaN(minPrice); i++) minPrice = data[i][1];
      var maxPrice = minPrice;

      data.forEach(function (d) {
        minPrice = isNaN(d[1]) ? minPrice : Math.min(d[1], minPrice);
        maxPrice = isNaN(d[1]) ? maxPrice : Math.max(d[1], maxPrice);
      });

      return [minPrice, maxPrice];
    }

    function handleBadOutcome(message) {
      w.console.error('Xignite invalid response: ' + message);
      logBi('render-fail');
      remove();
    }

    function remove() {
      if ($container.length) {
        $container.remove();
      }
    }

    function init(opt) {
        chartWidth = opt.width || 670;
        if (opt.startDate) startDate = new Date(opt.startDate);
        else {
          startDate = new Date();
          startDate.setFullYear(startDate.getFullYear() - 1);
        }
        requestStartDate = w.moment(startDate).format(DATE_FORMAT);
        requestEndDate = w.moment(new Date()).format(DATE_FORMAT);
        startDate = requestStartDate + ' 16:00';
        endTime = requestEndDate + ' 16:00';
    }

    init(opt);
  };

}(window, window.SA, window.jQuery, window.Highcharts));

(function (w, SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Widgets.ArticleRatingsChart'),
    pageData = {},
    primaryTicker, indexGroup,
    config,
    $container;

  function updateChart() {
    var chartObj = new SA.Modules.Symbols.SentimentsChart({
      width: 640,
      authorSlug: pageData.author.slug,
      ticker: primaryTicker + indexGroup,
      source: 'article-page',
      articleSource: 'coverage',
      isArticlePage: true
    });
    $.when(chartObj.promise()).then(function (res) {
      chartObj.show(res);
    });
  }

  function render(res) {
    if (res.html) {
      $container.append(res.html);
      updateChart();
    } else {
      renderInstead();
    }
  }

  function renderInstead(response) {
    var error = response ? response.responseText : '';
    SA.Rollbar.error('Failed to get article bottom ratings data. ' + error);
  }

  function initialize() {
    if (pageData.author && primaryTicker) {
      var paramsData = {
        author_id: pageData.author.id,
        slugs: primaryTicker,
      };
      $.get('/articles/article_ratings_chart', paramsData)
        .done(render)
        .fail(renderInstead);
    }
  }

  scope.init = function(){
    config = SA.pageConfig.Data;
    pageData.article = config.article;
    indexGroup = pageData.article.indexGroup ? '.' + pageData.article.indexGroup : '';
    primaryTicker = pageData.article.primaryTicker;
    pageData.author = config.author;
    $container = $('.article-ratings-chart');

    initialize();
  }
}(window, window.SA, window.jQuery));

(function(SA, $) {

  "use strict";

  var scope = SA.UsingNamespace('SA.Widgets.ProBottomUnits');

  var insertUnits = function(units){
    var html = '';
    $.each(units, function(key, value){
      html += value;
    });
    $('#a-about').after(html);
  };

  var getArticleLists = function(articleId){
    $.ajax({
      dataType: 'json',
      method: 'GET',
      url: '/articles/ajax_get_pro_bottom/' + articleId
    }).done(function(response){
      if(response.units){
        insertUnits(response.units);
      }
    });
  };

  scope.init = function(articleId){
    if(articleId){
      getArticleLists(articleId);
    }
  };



}(SA, jQuery));


/**
 * Created by Yair on 12/15/15.
 */


(function(SA, $) {

  "use strict";

  var scope = SA.UsingNamespace('SA.Pages.Article.HitTitleTest');

  var hitTitleUrl = '/articles/ajax_hit_article_test';

  scope.init = function (pageData) {

    var regMatch = /alt(\d)/.exec(window.location.hash);
    var altSelected = regMatch ? parseInt(regMatch[1], 10) : null;
    var $articleTitle = $('h1[itemprop="headline"]');
    var titleTest = pageData.article.titleTest;
    var titlesArray = [$articleTitle.text().trim(), titleTest.originalTitle, titleTest.altTitle, titleTest.editorTitle];
    var titleSelected;

    if(altSelected) {

      titleSelected = titlesArray[altSelected] || titlesArray[0];
      $articleTitle.text(titleSelected);
      $articleTitle.show();

      if (!titleTest.finished) {
        $.ajax({
          method: 'GET',
          url: hitTitleUrl,
          dataType: 'json',
          data: {
            articleId: pageData.article.id,
            altSelected: altSelected
          }
        });
      }
    } else {
      // Showing twice, so it won't wait to ajax even to be called
      $articleTitle.show();
    }

  };

}(SA, jQuery));
(function(SA, $) {

  "use strict";

  var fromSANav = function(referrer){
    var navRegex = /(?:https?:\/\/)(dev\.|staging\.)*seekingalpha\.com\/(stock-ideas|dividends|market-outlook|investing-strategy|etfs-and-funds)\//;
    return navRegex.test(referrer);
  };

  var setEditorsPicksActive = function(referrer){
    var matches = referrer.match(/(stock-ideas|dividends|market-outlook|investing-strategy|etfs-and-funds)+(\/editors-picks)+/);
    if(matches) {
      var referrerMainNav = matches[1];
      var $mainNav = $('#sa-nav');
      if($mainNav && SA.headerConfig.activeTab === referrerMainNav){
        var $subNav = $('#nav-sec nav>ul');
        if($subNav.length ){
          $subNav.find('li.active').removeClass('active');
          $subNav.find('a[data-tab="editors-picks"]').parent().addClass('active');
        }
      }
    }
  };

  var initMainNav = function(){
    var referrer = document.referrer;
    if(referrer && fromSANav(referrer)){
      setEditorsPicksActive(referrer);
    }
  };

  initMainNav();

}(SA, jQuery));
!(function (window, SA, $) {
  "use strict";

  /*** ############################################################### ***/
  /*** Block copied as-is from xss_filter.js in old javascripts folder ***/
  /*** ############################################################### ***/

  // Yehuda: this code should be synchronized to xss_filter.rb. AND article_edit.js (this.FilterAttributes function) Pay attention.

  function FilterAttributes(a,e,d){switch(e){case "br":case "span":case "i":case "b":case "u":case "strong":case "em":case "big":case "small":case "sup":case "sub":case "strike":case "hr":case "li":case "tr":case "caption":case "colgroup":case "blockquote":case "p":var b=/ c\lass\=(?:\'|\")?(yc_font|question|answer)(?:\'|\"| |>)/i;return(a=b.test(a)?RegExp.$1:null)?"<"+d+e+' class="'+a+'" >':"<"+d+e+">";case "div":return b=/ c\lass\=(?:\'|\")?(instablog_spacer|big_table|zoom_table)(?:\'|\"| |>)/i,(a=
      b.test(a)?RegExp.$1:null)?"<div "+(a?'class="'+a+'"':"")+">":"<"+d+"div>";case "ol":return b=/ start\=(?:\'|\")?(\d{1,10})(?:\'|\"| |>)/i.test(a)?RegExp.$1:null,a=/ type\=(?:\'|\")?(i|1|a)(?:\'|\"| |>)/i.test(a)?RegExp.$1:null,b||a?"<ol "+(b?'start="'+b+'"':"")+(b?" ":"")+(a?'type="'+a+'"':"")+">":"<"+d+"ol>";case "ul":return/ type\=(?:\'|\")?(disc|square|circle)(?:\'|\"| |>)/i.test(a)?'<ul type="'+RegExp.$1+'">':"<"+d+"ul>";case "table":e=/ border\=(?:\'|\")?(0|1)(?:\'|\"| |>)/i.test(a)?RegExp.$1:
      null;var c=/ cellpadding\=(?:\'|\")?(0|1|2|3|4|5|6)(?:\'|\"| |>)/i.test(a)?RegExp.$1:null,f=/ cellspacing\=(?:\'|\")?(0|1|2|3|4|5|6)(?:\'|\"| |>)/i.test(a)?RegExp.$1:null,b=/ height\=(?:\'|\")?(\d{1,3}\%?)(?:\'|\"| |>)/i.test(a)?RegExp.$1:null,g=/ width\=(?:\'|\")?(\d{1,3}\%?)(?:\'|\"| |>)/i.test(a)?Math.min(RegExp.$1,480):null,h=/ align\=(?:\'|\")?(left|center|justify)(?:\'|\"| |>)/i.test(a)?RegExp.$1:null;a=/ class\=(?:\'|\")?(designed_table)(?:\'|\"| |>)/i.test(a)?RegExp.$1:null;return e||c||f||
  b||g||h?"<table "+(e?'border="'+e+'"':"")+(e?" ":"")+(c?'cellpadding="'+c+'"':"")+(c?" ":"")+(f?'cellspacing="'+f+'"':"")+(c?" ":"")+(g?'width="'+g+'"':"")+(g?" ":"")+(b?'height="'+b+'"':"")+(b?" ":"")+(h?'align="'+h+'"':"")+(a?' class="'+a+'"':"")+">":"<"+d+"table>";case "th":case "td":case "col":var b=/ height\=(?:\'|\")?(\d{1,3}\%?)(?:\'|\"| |>)/i.test(a)?RegExp.$1:null,g=/ width\=(?:\'|\")?(\d{1,3}\%?)(?:\'|\"| |>)/i.test(a)?RegExp.$1:null,c=/ colspan\=(?:\'|\")?(\d{1,2})(?:\'|\"| |>)/i.test(a)?
      RegExp.$1:null,f=/ rowspan\=(?:\'|\")?(\d{1,2})(?:\'|\"| |>)/i.test(a)?RegExp.$1:null,k=/ span\=(?:\'|\")?(\d{1,2})(?:\'|\"| |>)/i.test(a)?RegExp.$1:null,h=/ align\=(?:\'|\")?(left|right|center|justify)(?:\'|\"| |>)/i.test(a)?RegExp.$1:null;a=/ valign\=(?:\'|\")?(top|middle|bottom)(?:\'|\"| |>)/i.test(a)?RegExp.$1:null;return b||g||h||a||c||f||k?"<"+e+" "+(g?'width="'+g+'"':"")+(g?" ":"")+(b?'height="'+b+'"':"")+(b?" ":"")+(h?'align="'+h+'"':"")+(h?" ":"")+(a?'valign="'+a+'"':"")+(a?" ":"")+(c?'colspan="'+
  c+'"':"")+(c?" ":"")+(f?'rowspan="'+f+'"':"")+(f?" ":"")+(k?'span="'+k+'"':"")+">":"<"+d+e+">";case "a":return b=/ href\=(?:\'|\")?(.*?)(?:\'|\"| |>)/i.test(a)?RegExp.$1:null,g=/ dofollow\=(?:\'|\")?(true)(?:\'|\"| |>)/i.test(a)?RegExp.$1:null,a=/ sasource\=(?:\'|\")?(.*?)(?:\'|\"| |>)/i.test(a)?RegExp.$1:null,b&&(ValidSrc(b)||ValidHref(b))?"<a "+(b?'href="'+b+'"':"")+(b?" ":"")+(g?'dofollow="true" ':"")+(a?'sasource="'+a+'"':"")+(ValidSrc(b)?'rel="lightbox"':'target="_blank"')+">":"<"+d+"a>";case "img":return d=
      / src\=(?:\'|\")?(.*?)(?:\'|\"| |>)/i.test(a)?RegExp.$1:null,h=/ align\=(?:\'|\")?(left|right|center|middle|justify)(?:\'|\"| |>)/i.test(a)?RegExp.$1:null,e=/ alt\=(?:\'|\")?(.*?)(?:\'|\"|>)/i.test(a)?RegExp.$1:null,c=/ hspace\=(?:\'|\")?(0|1|2|3|4|5|6)(?:\'|\"| |>)/i.test(a)?RegExp.$1:null,f=/ vspace\=(?:\'|\")?(0|1|2|3|4|5|6)(?:\'|\"| |>)/i.test(a)?RegExp.$1:null,g=/ width\=(?:\'|\")?(\d{1,3}\%?)(?:\'|\"| |>)/i.test(a)?RegExp.$1:null,b=/ height\=(?:\'|\")?(\d{1,3}\%?)(?:\'|\"| |>)/i.test(a)?RegExp.$1:
      null,a=/ noupload\=(?:\'|\")?(true)(?:\'|\"| |>)/i.test(a)?RegExp.$1:null,d&&(ValidHref(d)||ValidSrc(d))?"<img "+(d?'src="'+d+'"':"")+(d?" ":"")+(h?'align="'+h+'"':"")+(h?" ":"")+(e?'alt="'+e+'"':"")+(e?" ":"")+(c?'hspace="'+c+'"':"")+(c?" ":"")+(f?'vspace="'+f+'"':"")+(f?" ":"")+(g?'width="'+g+'"':"")+(g?" ":"")+(b?'height="'+b+'"':"")+(a?' noupload="true"':"")+" />":"";case "iframe":return a;default:return""}}function FilterGarbage(a){return a.replace(/<a><\/a>/gi,"").replace(/<a>/gi,"")}
  function ValidSrc(a){"undefined"==typeof IMG_PREFIX&&(window.IMG_PREFIX=".*?seekingalpha.com");return(new RegExp("^"+IMG_PREFIX+"(.+?)\\.(?:png|jpg|jpeg|gif|bmp)$","i")).test(a)}function ValidHref(a){return/^(https?:\/\/)?[a-z0-9_]+([-.]{1}[a-z0-9_]+)*\.[a-z]{2,5}(([0-9]{1,5})?\/.*)?$/i.test(a)}
  function FilterXSS(a){var e=/<(\/)?(.*?)(?: |>)/,d=/^(IFRAME|P|BR|DIV|SPAN|I|B|U|STRONG|EM|BIG|SMALL|SUP|SUB|STRIKE|BLOCKQUOTE|HR|OL|UL|LI|TABLE|CAPTION|COLGROUP|COL|TR|TH|TD|A|IMG)$/i;a=a.replace(/(\t|\n|\r|\f)/gi,"");a=a.replace(/(\%3E|\%3C|\&\#0{0,5}60\;?|\&\#x0{0,5}3c\;?|\\x3c|\\u003c)/gi,"");a=a.replace(/\<\!\-\-(?:.*?)\-\-\>/gi,"");a=a.replace(/<(script|style)(.|\n)*?<\/(script|style)>/gi,"");a=a.replace(/<(script|style)/gi,"");a=a.replace(/<span style\=(?:\"|\')font\-weight\: ?bold\;?(?:\"|\')>([^<>]+?)<\/span>/gi,
      "<strong>$1</strong>");a=a.replace(/<span style\=(?:\"|\')font\-style\: ?italic\;?(?:\"|\')>([^<>]+?)<\/span>/gi,"<i>$1</i>");a=a.replace(/<(?:(?:.|\n)*?)>/gi,function(a){var c,f;e.test(a);f=RegExp.$1;c=RegExp.$2.toLowerCase();return d.test(c)?FilterAttributes(a,c,f):""});return a=FilterGarbage(a)};

  /*** ############################################################### ***/
  /*** Block end                                                       ***/
  /*** ############################################################### ***/

  var scope = SA.UsingNamespace('SA.Pages.Article.Preview');
  var init = function () {
    function getNewJqDiv(cls, txt, cb) {
      return $(document.createElement("div"))
          .addClass(cls)
          .text(txt)
          .click(cb);
    }

    function toggleFilters() {
      var $t = $(this);
      if ($t.attr("selected")) {
        return;
      }

      $t.attr("selected", true);
      if ($t.attr("id") === "Filtered") {
        oNonFilterTab.removeAttr("selected");
        oArticleFilter.attr("selected", true);
        oArticleNonFilter.removeAttr("selected");
      }
      else {
        oFilterTab.removeAttr("selected");
        oArticleNonFilter.attr("selected", true);
        oArticleFilter.removeAttr("selected");
      }
    }

    var oArticle = $("#a-cont"),
        oArticleFilter = $("#article_filtered").attr({"selected": true}),
        oArticleNonFilter = $("#article_non_filtered"),
        oContainer = getNewJqDiv("preview-container clearfix"),
        oFilterTab = getNewJqDiv("preview-tab", "Filtered", toggleFilters).attr({"id": "Filtered", "selected": true}),
        oNonFilterTab = getNewJqDiv("preview-tab", "Non-Filtered", toggleFilters).attr({"id": "NonFiltered"});

    if (oArticleFilter.first()) {
      oContainer.insertBefore(oArticle).append(oFilterTab).append(oNonFilterTab);
      try {
        oArticleFilter.html(FilterXSS(oArticleNonFilter.html()));
      } catch (ignore) {
        console.error(ignore);
      }
    } else {
      oArticleNonFilter.css("display", "block");
    }
  };

  scope.init = init;

}(window, SA, jQuery));

(function (SA, $) {

  var scope = SA.UsingNamespace('SA.Pages.Article');
  scope.BrandAuthorUnit = function (opt) {

    function exec(method) {
      if ($.isFunction(method)) {
        method();
      }
    }

    function init() {
      var unitOpt = opt || {$container: null, data: {}};

      if (unitOpt.$container.length && unitOpt.data.brand_primary_author_id) {
        $.get('/articles/ajax_get_brand_articles', unitOpt.data, function (res) {
          if (res && res.html) {
            unitOpt.$container.replaceWith(res.html);

            new SA.Widgets.Follow.SingleButton({
              author: {
                userId: unitOpt.data.brand_primary_author_id,
                tagId: unitOpt.data.brand_primary_author_tag,
                name: unitOpt.data.brand_primary_author_name,
                slug: unitOpt.data.brand_primary_author_slug
              },
              container: '.follow-brand-bottom',
              showPopover: true,
              followersNumber: {show: false},
              articleId: unitOpt.current_article_id,
              bi: {sendDefault: true, source: 'article_page_brand_bottom'}
            }).init();

            SA.Logger.Mone.event('article-page', 'article_bottom', 'brand-articles-list-unit');
          }
        }).always(function (res) {
          if (!res || !res.html) {
            SA.exceptions.push(['brand-articles-list-unit: SA fail, no data from server']);
            exec(unitOpt.onFail);
          }
        });
      } else {
        exec(unitOpt.onFail);
      }
    }

    init();

  }

}(window.SA, window.jQuery));
(function (w, doc, $) {

  var $footer = $('#sa-ft');

  var defaults = {
      topSpacing: $('#main-nav-wrapper-row').outerHeight() + 10,
      bottomSpacing: $footer.length ? 190 : 10,
      className: 'is-sticky'
    },

    $window = $(w),
    $document = $(doc),

    sticked = [],
    windowHeight = $window.height(),

    scroller = function() {
      var scrollTop = $window.scrollTop(),
        documentHeight = $document.height(),
        dwh = documentHeight - windowHeight,
        extra = (scrollTop > dwh) ? dwh - scrollTop : 0,
        leftScroll = $document.scrollLeft(),
        s, elementTop, etse, bottomSpacing;

      for (var i = 0; i < sticked.length; i++) {
        s = sticked[i];
        bottomSpacing = ($.isFunction(s.bottomSpacing)) ? s.bottomSpacing() : s.bottomSpacing || 0;


        elementTop = s.stickyWrapper.offset().top;
        etse = elementTop - s.topSpacing - extra;

        if (scrollTop <= etse) {
          if (s.currentTop !== null) {
            s.stickyElement.parent().removeClass(s.className);
            s.stickyElement.css({'width': '', 'position': '', 'top': '', 'margin-left': ''});
            s.currentTop = null;
          }
        } else {
          var newTop = documentHeight - s.stickyElement.outerHeight() - s.topSpacing - bottomSpacing - scrollTop - extra;
          s.stickyElement.css('margin-left', -leftScroll);

          if (newTop < 0) {
            newTop = newTop + s.topSpacing;
            s.stickyElement.parent().addClass('release');
          } else {
            newTop = s.topSpacing;
            s.stickyElement.parent().removeClass('release');
          }

          if (s.currentTop !== newTop) {
            var newWidth = s.stickyWrapper.width();


            s.stickyElement
            .css({
              'width': newWidth ? newWidth : s.stickyElement.width(),
              'position': 'fixed',
              'top': newTop,
              'margin-left': -leftScroll
            });


            s.stickyElement.parent().addClass(s.className);



            s.currentTop = newTop;
          }
        }
      }
    },

    resizer = function () {
      var newWidth;

      windowHeight = $window.height();

      sticked.forEach(function(
        s ) {
        newWidth = s.stickyWrapper.width();


        if (newWidth !== null) {
          s.stickyElement.css('width', newWidth);
        }
      });
    },

    init = function() {
      window.addEventListener('scroll', scroller);
      window.addEventListener('resize', resizer);
      scroller();
    },

    methods = {
      init: function (options) {
        var o = $.extend({}, defaults, options);
        return this.each(function () {
          var $elem = $(this),
            stickyHeight = $elem.outerHeight(),
            $elemWrapper;

          if (!!options.findClosestStickyWrapper) {
            $elemWrapper = $elem.closest('.sticky-wrapper');
          } else {
            var $wrapper = $('<div></div>', {'class': 'sticky-wrapper'});
            $elem.wrapAll($wrapper);
            $elemWrapper = $elem.parent();
          }

          if ($elem.css('float') === 'right') {
            $elem.css({'float': 'none'}).parent().css({'float': 'right'});
          }

          $elemWrapper.css('min-height', stickyHeight);

          o.stickyElement = $elem;
          o.stickyWrapper = $elemWrapper;
          o.currentTop = null;

          sticked.push(o);

          scroller();
        });
      },

      update: scroller,

      unstick: function() {
        return this.each(function () {
          var that = this, $elem = $(that), removeIdx = -1, i = sticked.length;

          while (i-- > 0) {
            if (sticked[i].stickyElement.get(0) === that) {
              Array.prototype.splice.call(sticked, i, 1);
              removeIdx = i;
            }
          }

          if (removeIdx !== -1) {
            $elem.unwrap().css({'width': '', 'position': '', 'top': '', 'float': ''});
          }
        });
      }
    };



  $.fn.sticky = function (opt) {
    return methods.init.apply(this, [opt || {
    }]);
  };

  $.fn.unstick = function(opt) {
    return methods.unstick.apply(this, [opt || {}]);
  };

  init();
}(window, document, window.jQuery));
(function() { this.JST || (this.JST = {}); this.JST["jst/portfolio/side_slug"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<li data-name="',  slug ,'" id="sp_slug_', slug.replace(/\./gi,'_'),'">\n  <div class="del-btn" data-id="',  tag_id ,'"></div>\n  <div class="slug-info">\n    <a class="slug" sasource="side_portfolios" href="/symbol/',  slug.toUpperCase() ,'" title="', title,'">',  name ,'</a>\n    <div class="title-ticker">',  title ,'</div>\n  </div>\n  <div class=\'drag-element\'>',  dragEl ,'</div>\n  <div class="alerts">\n    <input data-id="',  slug ,'" type="checkbox" aria-label="Alerts for ',  slug ,'" ',  slug_alerts ,' />\n  </div>\n  <div class="price-changes">\n    <div class="price">-</div>\n    <div class="change">-</div>\n    <div class="percentage">-</div>\n  </div>\n  <div class="separator"></div>\n</li>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/portfolio/side_slug_header"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div class="side-portfolio-header">\n  <div class="slug-info">Ticker</div>\n  <div class="alerts">Alerts</div>\n  <div class="price-changes">\n    <div class="price">Price</div>\n    <div class="price-chg">Chg</div>\n    <div class="percentage">Chg%</div>\n  </div>\n</div>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/portfolio/rename_popup"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<span class="add-alerts-popup edit">\n  <div class="add-alerts-inside">\n    <div class="title">Rename your portfolio</div>\n    <div class="description">\n      <input value="',  p_name ,'" id="p_name_pop" maxlength="50" type="text"/>\n      <div id="p_name_error" class="p_name_error">&nbsp;</div>\n      <div class="get-alerts">Save</div>\n      <div class="no-thanks">No thanks</div>\n      <div class="loader"></div>\n    </div>\n</span>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/portfolio/delete_popup"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<span class="add-alerts-popup edit">\n  <div class="add-alerts-inside">\n    <div class="title">Are you sure you want to delete portfolio: \'',  p_name ,'\'?</div>\n    <div class="description">\n      <div id="p_name_error" class="p_name_error">&nbsp;</div>\n      <div id="delete-portfolio" class="get-alerts">Delete</div>\n      <div id="delete-no-thanks" class="no-thanks">No thanks</div>\n      <div class="loader"></div>\n    </div>\n</span>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/portfolio/delete_btn"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n     width="20px" height="20px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve">\n<g>\n  <path d="M13,4V2H8v2H4v2h13V4H13z M9,3h3v1H9V3z"/>\n  <g>\n    <path d="M5,7v1.028L6,19h9l1-10.99V7H5z M8,18H6.922L6.078,9H8V18z M10,18H9V9h1V18z M12,18h-1V9h1V18z M14,18h-1V9h1.969L14,18z"\n    />\n  </g>\n</g>\n</svg>\n');}return __p.join('');};
}).call(this);
(function (w, SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Pages.Account.Portfolio');
  scope.Resizer = function (opt) {
    var selectors,
      $wrapper,
      $header,
      $headerMainNav,
      $portfolioMain,
      $innerUnit,
      coordinates;

    function initVariables() {
      selectors = opt.selectors;
      $wrapper = opt.$wrapper;
      $header = $('#sa-hd');
      $headerMainNav = $('#main-nav-wrapper-row');
      $portfolioMain = $(selectors.portfolioMain);
      $innerUnit = {
        get: function () {
          if (!this._$innerUnit) {
            this._$innerUnit = $(selectors.innerUnit);
          }
          return this._$innerUnit;
        }
      };
    }

    function initCoordinates() {
      var headerHeight = 0;
      $.each($header.find('.container-fluid'), function () {
        headerHeight += $(this).outerHeight(true);
      });

      coordinates = {
        height: {
          min: $headerMainNav.outerHeight(true),
          max: headerHeight
        },
        width: {
          min: $wrapper.width,
          current: $wrapper.width
        }
      };
    }

    this.resize = function () {
      var currentTop = coordinates.height.max - $(w).scrollTop();
      if (currentTop < coordinates.height.min) {
        currentTop = coordinates.height.min;
      }

      var height = $(w).height() - currentTop;

      $wrapper.css({
        top: currentTop,
        left: 0,
        height: height
      });

      if (!$('#portfolio-rail').length) {
        $wrapper.css({
          width: $portfolioMain.offset().left - 6
        });
      }

      adjustInnerScroll(height);
    };

    function adjustInnerScroll(wrapperHeight) {
      var innerUnitPositionTop = $innerUnit.get().position().top;
      if (!coordinates.innerUnitPositionTop || innerUnitPositionTop < coordinates.innerUnitPositionTop) {
        coordinates.innerUnitPositionTop = $innerUnit.get().position().top;
      }

      var unitHeight = wrapperHeight - coordinates.innerUnitPositionTop;
      var innerHeight = 0;
      $innerUnit.get().children().each(function () {
        innerHeight += $(this).outerHeight(true);
      });

      if ($innerUnit.get().hasClass('scrollable')) {
        if (innerHeight <= unitHeight) {
          $innerUnit.get().removeClass('scrollable').removeAttr('style');
        } else {
          $innerUnit.get().css({'height': unitHeight});
        }
      } else if(innerHeight > unitHeight) {
        $innerUnit.get().addClass('scrollable').css({'height': unitHeight});
      }
    }

    function init() {
      if (opt.selectors && opt.$wrapper) {
        initVariables();
        initCoordinates();
      }
    }

    init();

  };

}(window, window.SA, window.jQuery));
(function() { this.JST || (this.JST = {}); this.JST["jst/portfolio/popover_sort_content"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div class="portfolio-sort-container">\n  <div class="title">Sort By</div>\n  <div id=\'gainers_losers\' class="option-container">\n    <div class="option-icon">',  JST['jst/portfolio/sort_gainers_losers']() ,'</div> <span>Gainers & Losers</span>\n  </div>\n  <div id=\'gainers\' class="option-container">\n    <div class="option-icon">',  JST['jst/portfolio/sort_gainers']() ,'</div> <span>Gainers</span>\n  </div>\n  <div id=\'losers\' class="option-container">\n    <div class="option-icon">',  JST['jst/portfolio/sort_losers']() ,'</div> <span>Losers</span>\n  </div>\n  <div id=\'volume\' class="option-container">\n    <div class="option-icon">',  JST['jst/portfolio/sort_volume']() ,'</div> <span>Volume</span>\n  </div>\n  <div id=\'a_z\' class="option-container">\n    <div class="option-icon">',  JST['jst/portfolio/sort_a_z']() ,'</div> <span>A - Z</span>\n  </div>\n  <div id=\'z_a\' class="option-container">\n    <div class="option-icon">',  JST['jst/portfolio/sort_z_a']() ,'</div> <span>Z - A</span>\n  </div>\n  <div id=\'custom\' class="option-container">\n    <div class="option-icon">',  JST['jst/portfolio/sort_custom']() ,'</div> <span>Custom</span>\n  </div>\n</div>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/portfolio/popover_sort_template"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div class="popover portfolio-sort-popover">\n  <div class="arrow"></div>\n  <h3 class="popover-title"></h3>\n  <div class="popover-content"></div>\n</div>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/portfolio/sort_gainers_losers"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n     width="20px" height="20px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve">\n  <g>\n    <polyline fill="" stroke="#020202" stroke-width="2.9394" stroke-miterlimit="10" points="6,3 6,12"></polyline>\n    <g>\n      <polygon points="2,12 10,12 6,19"></polygon>\n    </g>\n  </g>\n  <g>\n    <polyline fill="" stroke="#020202" stroke-width="2.9394" stroke-miterlimit="10" points="14,9 14,18"></polyline>\n    <g>\n      <polygon points="14,2 10,10 18,10"></polygon>\n    </g>\n  </g>\n</svg>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/portfolio/sort_gainers"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<svg version="1.1" id="Layer_8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px"\n     y="0px"\n     width="20px" height="20px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve">\n<g>\n  <polyline fill="none" stroke="#020202" stroke-width="2.9394" stroke-miterlimit="10"\n            points="3.037,14.974 7.796,10.214 10.02,12.438 12.94,9.517"/>\n  <g>\n    <polygon points="13.444,10.697 15.401,12.956 18,4.801 9.558,6.213 11.515,8.472"/>\n  </g>\n</g>\n</svg>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/portfolio/sort_losers"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<svg version="1.1" id="Layer_3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n     width="20px" height="20px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve">\n<g>\n  <polyline fill="none" stroke="#020202" stroke-width="3.0443" stroke-miterlimit="10" points="3.037,4.452 7.815,9.538\n\t\t10.047,7.163 12.979,10.284 \t"/>\n  <g>\n    <polygon points="13.484,9.024 15.449,6.609 18.058,15.323 9.583,13.815 11.547,11.4 \t\t"/>\n  </g>\n</g>\n</svg>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/portfolio/sort_volume"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n     width="20px" height="20px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve">\n<g>\n  <rect x="10" y="5" fill="#020202" width="3" height="13"/>\n  <rect x="14" y="2" fill="#020202" width="3" height="16"/>\n  <rect x="2" y="12" fill="#020202" width="3" height="6"/>\n  <rect x="6" y="8" fill="#020202" width="3" height="10"/>\n</g>\n</svg>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/portfolio/sort_a_z"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="20px"\n     height="20px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve">\n<symbol  id="Arrow_26" viewBox="-33.36 -13.047 55.72 26.28">\n  <g>\n    <polygon points="-33.359,-4.246 -0.431,-4.246 -0.431,-13.047 22.36,0.094 -0.431,13.232 -0.431,4.432 -33.359,4.432 \t\t"/>\n  </g>\n</symbol>\n  <g id="Layer_7" display="none">\n  </g>\n  <g id="Layer_5">\n    <g>\n\n      <g>\n        <polyline fill="" stroke="#020202" stroke-width="2.9394" stroke-miterlimit="10" points="15,3 15,12"></polyline>\n        <g>\n          <polygon points="11,12 19,12 15,19"></polygon>\n        </g>\n      </g>\n      <g>\n        <path d="M9.433,9.357H7.929L7.331,7.801H4.592L4.027,9.357H2.56l2.668-6.85h1.463L9.433,9.357z M6.887,6.647L5.943,4.105\n\t\t\t\tL5.018,6.647H6.887z"/>\n        <path d="M3.214,17.97v-1.248l3.597-4.442H3.621V11.12h5.014v1.074l-3.752,4.62h3.896v1.155H3.214z"/>\n      </g>\n    </g>\n  </g>\n</svg>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/portfolio/sort_z_a"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<svg version="1.1" id="Layer_6" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n     width="20px" height="20px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve">\n<symbol  id="Arrow_26" viewBox="-33.36 -13.047 55.72 26.28">\n  <g>\n    <polygon points="-33.359,-4.246 -0.431,-4.246 -0.431,-13.047 22.36,0.094 -0.431,13.232 -0.431,4.432 -33.359,4.432 \t\t"/>\n  </g>\n</symbol>\n  <g>\n\n    <g>\n      <polyline fill="" stroke="#020202" stroke-width="2.9394" stroke-miterlimit="10" points="15,9 15,18"></polyline>\n      <g>\n        <polygon points="15,2 11,10 19,10"></polygon>\n      </g>\n    </g>    <g>\n      <path d="M9.795,17.971H8.29l-0.599-1.557H4.954l-0.565,1.557H2.921l2.668-6.85h1.463L9.795,17.971z M7.248,15.26l-0.943-2.541\n\t\t\tL5.379,15.26H7.248z"/>\n      <path d="M3.576,9.357V8.109l3.597-4.442H3.982V2.507h5.014v1.074l-3.752,4.62h3.897v1.155H3.576z"/>\n    </g>\n  </g>\n</svg>\n');}return __p.join('');};
}).call(this);
(function() { this.JST || (this.JST = {}); this.JST["jst/portfolio/sort_custom"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n   viewBox="0 0 20 20" xml:space="preserve">\n<g>\n  <rect x="2.4" y="3" width="11.6" height="3"/>\n  <rect x="2.4" y="13.5" width="15.1" height="3"/>\n  <rect x="2.4" y="8.2" width="8.9" height="3"/>\n</g>\n</svg>\n');}return __p.join('');};
}).call(this);










(function (w, SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Utils.Portfolio');
  scope.Sort = function (opt) {
    var $container,
      popoverConfig = {
        placement: 'right',
        trigger: 'click',
        html: true,
        content: w.JST['jst/portfolio/popover_sort_content'](),
        template: w.JST['jst/portfolio/popover_sort_template'](),
        animation: true
      },
      sortedOnce,
      sidePortfolio = SA.Utils.SidePortfolio,
      mone_params = opt.mone;

    var sortMappings = {
      'a_z': {
        title: 'A-Z',
        method: function () {
          sortElements(getSlugs().sort());
        }
      },
      'z_a': {
        title: 'Z-A',
        method: function () {
          sortElements(getSlugs().sort().reverse());
        }
      },
      'gainers_losers': {
        title: 'Gainers & Losers',
        method: function () {
          sortElements(sortData('change', true, true));
        }
      },
      'gainers': {
        title: 'Gainers',
        method: function () {
          sortElements(sortData('change', true));
        }
      },
      'losers': {
        title: 'Losers',
        method: function () {
          sortElements(sortData('change'));
        }
      },
      'volume': {
        title: 'Volume',
        method: function () {
          sortElements(sortData('volume', true));
        }
      },
      'custom': {
        title: 'Custom',
        method: function () {
          var sort = sidePortfolio.customSorts,
            portfolioId = sidePortfolio.portfolio.id;

          if (!$.isEmptyObject(sort) && sort[portfolioId]) {
            sortElements(sort[portfolioId].split(','));
          }
        }
      }
    };

    var initEvents = function () {
      $container.on('click', openSortMenu);
      $('body').on('click', '.portfolio-sort-container .option-container', selectSortOption);
    };

    var selectSortOption = function () {
      var sortOption = $(this).attr('id'),
        customSort = sidePortfolio.customSorts,
        portfolioSort = customSort[sidePortfolio.portfolio.id];

      setSortOption(sortOption);
      sortPortfolio();

      SA.Logger.Mone.event(mone_params.type, mone_params.source, {
        data: {
          sort_type: getSortOption(),
          custom_order: customSort && portfolioSort && portfolioSort.length > 0
        }
      });
    };

    function setSortButton() {
      $('#portfolio_sort').html(
        w.JST['jst/portfolio/sort_' + getSortOption().replace('-', '_')]()
      ).attr('title', 'Sorted by: ' + sortMappings[getSortOption()].title);
    }

    function sortPortfolio() {
      setSortButton();
      sortMappings[getSortOption()].method();
      $('.inner-unit .portfolio-loader').addClass('hidden');
      $sidePortfolio().removeClass('hidden');
      $('.inner-unit').scrollTop(0);
    }

    function setSortOption(sortOption, callback) {
      sidePortfolio.userSort = sortOption;
      $.post('/api/v1/portfolio/save_sort_order',
        {
          portfolio_id: sidePortfolio.portfolio.id,
          type: sortOption
        }, callback);
    }

    function getSortOption() {
      return sidePortfolio.userSort || 'a_z';
    }

    function hideSortMenu() {
      $container.popover('hide').data('bs.popover').inState.click = false;
      $container.removeClass('open');
    }

    function openSortMenu() {
      $container.addClass('open');
      SA.Logger.Mone.event(mone_params.type, mone_params.source, 'clicked_sort_button');
    }

    function sortElements(slugs) {
      var html = [], $elem;
      $.each(slugs, function () {
        $elem = $sidePortfolio().find('li[data-name="' + this + '"]');
        if ($elem.length) {
          html.push($elem[0].outerHTML);
        }
      });
      $sidePortfolio().html(html.join(''));
      if (!sortedOnce) {
        sortedOnce = true;
      }
    }

    function getSlugs() {
      var slugs = [];
      $sidePortfolio().find('li[data-name]').each(function () {
        slugs.push($(this).data('name'));
      });
      return slugs;
    }

    function sortData(key, descending, abs) {
      var unsorted = gatherData(key);
      var sortMethod = abs ? sortByAbsValue : sortByRegularValue;
      var sorted = unsorted.sort(sortMethod);
      if (descending) {
        sorted = sorted.reverse();
      }

      return $.map(sorted, function(el){ return el[0]; });
    }

    function sortByAbsValue(a, b) {
      return Math.abs(a[1]) - Math.abs(b[1]);
    }

    function sortByRegularValue(a, b) {
      return a[1] - b[1];
    }

    function gatherData(key) {
      var data = [];
      $sidePortfolio().find('li').each(function () {
        var $this = $(this), value = $this.attr(key);
        data.push([$this.data('name'), parseFloat(value) || 0]);
      });

      return data;
    }

    function initializeTooltip() {
      var $portfolioEditLargeBtn = $('#portfolio_edit_large_btn');
      if ($.isEmptyObject(sidePortfolio.customSorts) && !sidePortfolio.isPortfolioPage()) {
        $portfolioEditLargeBtn.tooltipster({
          theme: 'tooltipster-light',
          trigger: 'custom',
          position: 'bottom'
        });

        $('body').on('click', '#custom', function () {
          if ($('.tooltipstered').length) {
            $portfolioEditLargeBtn.tooltipster('show');
          }
        });

        $portfolioEditLargeBtn.click(function () {
          if ($('.tooltipstered').length) {
            $portfolioEditLargeBtn.tooltipster('hide');
          }
        });
      } else {
        $portfolioEditLargeBtn.attr('title', '');
      }
    }

    function addCustomSort() {
      initializeTooltip();
    }

    function $sidePortfolio() {
      return $('#side_portfolio');
    }

    this.updateCustomSort = function (stocks, callback) {
      stocks = stocks || getSlugs().join(',');

      sidePortfolio.customSorts[sidePortfolio.portfolio.id] = stocks;

      $.post('/api/v1/portfolio/save_sort_order',
        {
          portfolio_id: sidePortfolio.portfolio.id,
          custom_sort: stocks,
          type: getSortOption()
        }, callback);
    };

    this.isAlphabeticalSort = function () {
      return ['a_z', 'z_a'].indexOf(getSortOption()) > -1;
    };

    this.getSortOption = getSortOption;

    this.setSortOption = setSortOption;

    this.sort = sortPortfolio;

    this.sortElements = sortElements;

    function init() {
      $container = $('#portfolio_sort');

      $container.popover(popoverConfig).on('shown.bs.popover', function () {
        $('#' + getSortOption()).addClass('selected');
        $('body').one('click', hideSortMenu);
      });

      addCustomSort();
      setSortButton();
      initEvents();
    }

    init();

  };

}(window, window.SA, window.jQuery));
/*! jQuery UI - v1.12.1 - 2018-03-20
* http://jqueryui.com
* Includes: widget.js, data.js, scroll-parent.js, widgets/sortable.js, widgets/mouse.js
* Copyright jQuery Foundation and other contributors; Licensed MIT */


(function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)})(function(t){t.ui=t.ui||{},t.ui.version="1.12.1";var e=0,i=Array.prototype.slice;t.cleanData=function(e){return function(i){var s,n,o;for(o=0;null!=(n=i[o]);o++)try{s=t._data(n,"events"),s&&s.remove&&t(n).triggerHandler("remove")}catch(a){}e(i)}}(t.cleanData),t.widget=function(e,i,s){var n,o,a,r={},l=e.split(".")[0];e=e.split(".")[1];var h=l+"-"+e;return s||(s=i,i=t.Widget),t.isArray(s)&&(s=t.extend.apply(null,[{}].concat(s))),t.expr[":"][h.toLowerCase()]=function(e){return!!t.data(e,h)},t[l]=t[l]||{},n=t[l][e],o=t[l][e]=function(t,e){return this._createWidget?(arguments.length&&this._createWidget(t,e),void 0):new o(t,e)},t.extend(o,n,{version:s.version,_proto:t.extend({},s),_childConstructors:[]}),a=new i,a.options=t.widget.extend({},a.options),t.each(s,function(e,s){return t.isFunction(s)?(r[e]=function(){function t(){return i.prototype[e].apply(this,arguments)}function n(t){return i.prototype[e].apply(this,t)}return function(){var e,i=this._super,o=this._superApply;return this._super=t,this._superApply=n,e=s.apply(this,arguments),this._super=i,this._superApply=o,e}}(),void 0):(r[e]=s,void 0)}),o.prototype=t.widget.extend(a,{widgetEventPrefix:n?a.widgetEventPrefix||e:e},r,{constructor:o,namespace:l,widgetName:e,widgetFullName:h}),n?(t.each(n._childConstructors,function(e,i){var s=i.prototype;t.widget(s.namespace+"."+s.widgetName,o,i._proto)}),delete n._childConstructors):i._childConstructors.push(o),t.widget.bridge(e,o),o},t.widget.extend=function(e){for(var s,n,o=i.call(arguments,1),a=0,r=o.length;r>a;a++)for(s in o[a])n=o[a][s],o[a].hasOwnProperty(s)&&void 0!==n&&(e[s]=t.isPlainObject(n)?t.isPlainObject(e[s])?t.widget.extend({},e[s],n):t.widget.extend({},n):n);return e},t.widget.bridge=function(e,s){var n=s.prototype.widgetFullName||e;t.fn[e]=function(o){var a="string"==typeof o,r=i.call(arguments,1),l=this;return a?this.length||"instance"!==o?this.each(function(){var i,s=t.data(this,n);return"instance"===o?(l=s,!1):s?t.isFunction(s[o])&&"_"!==o.charAt(0)?(i=s[o].apply(s,r),i!==s&&void 0!==i?(l=i&&i.jquery?l.pushStack(i.get()):i,!1):void 0):t.error("no such method '"+o+"' for "+e+" widget instance"):t.error("cannot call methods on "+e+" prior to initialization; "+"attempted to call method '"+o+"'")}):l=void 0:(r.length&&(o=t.widget.extend.apply(null,[o].concat(r))),this.each(function(){var e=t.data(this,n);e?(e.option(o||{}),e._init&&e._init()):t.data(this,n,new s(o,this))})),l}},t.Widget=function(){},t.Widget._childConstructors=[],t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{classes:{},disabled:!1,create:null},_createWidget:function(i,s){s=t(s||this.defaultElement||this)[0],this.element=t(s),this.uuid=e++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=t(),this.hoverable=t(),this.focusable=t(),this.classesElementLookup={},s!==this&&(t.data(s,this.widgetFullName,this),this._on(!0,this.element,{remove:function(t){t.target===s&&this.destroy()}}),this.document=t(s.style?s.ownerDocument:s.document||s),this.window=t(this.document[0].defaultView||this.document[0].parentWindow)),this.options=t.widget.extend({},this.options,this._getCreateOptions(),i),this._create(),this.options.disabled&&this._setOptionDisabled(this.options.disabled),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:function(){return{}},_getCreateEventData:t.noop,_create:t.noop,_init:t.noop,destroy:function(){var e=this;this._destroy(),t.each(this.classesElementLookup,function(t,i){e._removeClass(i,t)}),this.element.off(this.eventNamespace).removeData(this.widgetFullName),this.widget().off(this.eventNamespace).removeAttr("aria-disabled"),this.bindings.off(this.eventNamespace)},_destroy:t.noop,widget:function(){return this.element},option:function(e,i){var s,n,o,a=e;if(0===arguments.length)return t.widget.extend({},this.options);if("string"==typeof e)if(a={},s=e.split("."),e=s.shift(),s.length){for(n=a[e]=t.widget.extend({},this.options[e]),o=0;s.length-1>o;o++)n[s[o]]=n[s[o]]||{},n=n[s[o]];if(e=s.pop(),1===arguments.length)return void 0===n[e]?null:n[e];n[e]=i}else{if(1===arguments.length)return void 0===this.options[e]?null:this.options[e];a[e]=i}return this._setOptions(a),this},_setOptions:function(t){var e;for(e in t)this._setOption(e,t[e]);return this},_setOption:function(t,e){return"classes"===t&&this._setOptionClasses(e),this.options[t]=e,"disabled"===t&&this._setOptionDisabled(e),this},_setOptionClasses:function(e){var i,s,n;for(i in e)n=this.classesElementLookup[i],e[i]!==this.options.classes[i]&&n&&n.length&&(s=t(n.get()),this._removeClass(n,i),s.addClass(this._classes({element:s,keys:i,classes:e,add:!0})))},_setOptionDisabled:function(t){this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!!t),t&&(this._removeClass(this.hoverable,null,"ui-state-hover"),this._removeClass(this.focusable,null,"ui-state-focus"))},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_classes:function(e){function i(i,o){var a,r;for(r=0;i.length>r;r++)a=n.classesElementLookup[i[r]]||t(),a=e.add?t(t.unique(a.get().concat(e.element.get()))):t(a.not(e.element).get()),n.classesElementLookup[i[r]]=a,s.push(i[r]),o&&e.classes[i[r]]&&s.push(e.classes[i[r]])}var s=[],n=this;return e=t.extend({element:this.element,classes:this.options.classes||{}},e),this._on(e.element,{remove:"_untrackClassesElement"}),e.keys&&i(e.keys.match(/\S+/g)||[],!0),e.extra&&i(e.extra.match(/\S+/g)||[]),s.join(" ")},_untrackClassesElement:function(e){var i=this;t.each(i.classesElementLookup,function(s,n){-1!==t.inArray(e.target,n)&&(i.classesElementLookup[s]=t(n.not(e.target).get()))})},_removeClass:function(t,e,i){return this._toggleClass(t,e,i,!1)},_addClass:function(t,e,i){return this._toggleClass(t,e,i,!0)},_toggleClass:function(t,e,i,s){s="boolean"==typeof s?s:i;var n="string"==typeof t||null===t,o={extra:n?e:i,keys:n?t:e,element:n?this.element:t,add:s};return o.element.toggleClass(this._classes(o),s),this},_on:function(e,i,s){var n,o=this;"boolean"!=typeof e&&(s=i,i=e,e=!1),s?(i=n=t(i),this.bindings=this.bindings.add(i)):(s=i,i=this.element,n=this.widget()),t.each(s,function(s,a){function r(){return e||o.options.disabled!==!0&&!t(this).hasClass("ui-state-disabled")?("string"==typeof a?o[a]:a).apply(o,arguments):void 0}"string"!=typeof a&&(r.guid=a.guid=a.guid||r.guid||t.guid++);var l=s.match(/^([\w:-]*)\s*(.*)$/),h=l[1]+o.eventNamespace,c=l[2];c?n.on(h,c,r):i.on(h,r)})},_off:function(e,i){i=(i||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.off(i).off(i),this.bindings=t(this.bindings.not(e).get()),this.focusable=t(this.focusable.not(e).get()),this.hoverable=t(this.hoverable.not(e).get())},_delay:function(t,e){function i(){return("string"==typeof t?s[t]:t).apply(s,arguments)}var s=this;return setTimeout(i,e||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){this._addClass(t(e.currentTarget),null,"ui-state-hover")},mouseleave:function(e){this._removeClass(t(e.currentTarget),null,"ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){this._addClass(t(e.currentTarget),null,"ui-state-focus")},focusout:function(e){this._removeClass(t(e.currentTarget),null,"ui-state-focus")}})},_trigger:function(e,i,s){var n,o,a=this.options[e];if(s=s||{},i=t.Event(i),i.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),i.target=this.element[0],o=i.originalEvent)for(n in o)n in i||(i[n]=o[n]);return this.element.trigger(i,s),!(t.isFunction(a)&&a.apply(this.element[0],[i].concat(s))===!1||i.isDefaultPrevented())}},t.each({show:"fadeIn",hide:"fadeOut"},function(e,i){t.Widget.prototype["_"+e]=function(s,n,o){"string"==typeof n&&(n={effect:n});var a,r=n?n===!0||"number"==typeof n?i:n.effect||i:e;n=n||{},"number"==typeof n&&(n={duration:n}),a=!t.isEmptyObject(n),n.complete=o,n.delay&&s.delay(n.delay),a&&t.effects&&t.effects.effect[r]?s[e](n):r!==e&&s[r]?s[r](n.duration,n.easing,o):s.queue(function(i){t(this)[e](),o&&o.call(s[0]),i()})}}),t.widget,t.extend(t.expr[":"],{data:t.expr.createPseudo?t.expr.createPseudo(function(e){return function(i){return!!t.data(i,e)}}):function(e,i,s){return!!t.data(e,s[3])}}),t.fn.scrollParent=function(e){var i=this.css("position"),s="absolute"===i,n=e?/(auto|scroll|hidden)/:/(auto|scroll)/,o=this.parents().filter(function(){var e=t(this);return s&&"static"===e.css("position")?!1:n.test(e.css("overflow")+e.css("overflow-y")+e.css("overflow-x"))}).eq(0);return"fixed"!==i&&o.length?o:t(this[0].ownerDocument||document)},t.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());var s=!1;t(document).on("mouseup",function(){s=!1}),t.widget("ui.mouse",{version:"1.12.1",options:{cancel:"input, textarea, button, select, option",distance:1,delay:0},_mouseInit:function(){var e=this;this.element.on("mousedown."+this.widgetName,function(t){return e._mouseDown(t)}).on("click."+this.widgetName,function(i){return!0===t.data(i.target,e.widgetName+".preventClickEvent")?(t.removeData(i.target,e.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.off("."+this.widgetName),this._mouseMoveDelegate&&this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(e){if(!s){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(e),this._mouseDownEvent=e;var i=this,n=1===e.which,o="string"==typeof this.options.cancel&&e.target.nodeName?t(e.target).closest(this.options.cancel).length:!1;return n&&!o&&this._mouseCapture(e)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(e)!==!1,!this._mouseStarted)?(e.preventDefault(),!0):(!0===t.data(e.target,this.widgetName+".preventClickEvent")&&t.removeData(e.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(t){return i._mouseMove(t)},this._mouseUpDelegate=function(t){return i._mouseUp(t)},this.document.on("mousemove."+this.widgetName,this._mouseMoveDelegate).on("mouseup."+this.widgetName,this._mouseUpDelegate),e.preventDefault(),s=!0,!0)):!0}},_mouseMove:function(e){if(this._mouseMoved){if(t.ui.ie&&(!document.documentMode||9>document.documentMode)&&!e.button)return this._mouseUp(e);if(!e.which)if(e.originalEvent.altKey||e.originalEvent.ctrlKey||e.originalEvent.metaKey||e.originalEvent.shiftKey)this.ignoreMissingWhich=!0;else if(!this.ignoreMissingWhich)return this._mouseUp(e)}return(e.which||e.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(e),e.preventDefault()):(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,e)!==!1,this._mouseStarted?this._mouseDrag(e):this._mouseUp(e)),!this._mouseStarted)},_mouseUp:function(e){this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,e.target===this._mouseDownEvent.target&&t.data(e.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(e)),this._mouseDelayTimer&&(clearTimeout(this._mouseDelayTimer),delete this._mouseDelayTimer),this.ignoreMissingWhich=!1,s=!1,e.preventDefault()},_mouseDistanceMet:function(t){return Math.max(Math.abs(this._mouseDownEvent.pageX-t.pageX),Math.abs(this._mouseDownEvent.pageY-t.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}}),t.widget("ui.sortable",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(t,e,i){return t>=e&&e+i>t},_isFloating:function(t){return/left|right/.test(t.css("float"))||/inline|table-cell/.test(t.css("display"))},_create:function(){this.containerCache={},this._addClass("ui-sortable"),this.refresh(),this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0},_setOption:function(t,e){this._super(t,e),"handle"===t&&this._setHandleClassName()},_setHandleClassName:function(){var e=this;this._removeClass(this.element.find(".ui-sortable-handle"),"ui-sortable-handle"),t.each(this.items,function(){e._addClass(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item,"ui-sortable-handle")})},_destroy:function(){this._mouseDestroy();for(var t=this.items.length-1;t>=0;t--)this.items[t].item.removeData(this.widgetName+"-item");return this},_mouseCapture:function(e,i){var s=null,n=!1,o=this;return this.reverting?!1:this.options.disabled||"static"===this.options.type?!1:(this._refreshItems(e),t(e.target).parents().each(function(){return t.data(this,o.widgetName+"-item")===o?(s=t(this),!1):void 0}),t.data(e.target,o.widgetName+"-item")===o&&(s=t(e.target)),s?!this.options.handle||i||(t(this.options.handle,s).find("*").addBack().each(function(){this===e.target&&(n=!0)}),n)?(this.currentItem=s,this._removeCurrentsFromItems(),!0):!1:!1)},_mouseStart:function(e,i,s){var n,o,a=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(e),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,a.cursorAt&&this._adjustOffsetFromHelper(a.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),a.containment&&this._setContainment(),a.cursor&&"auto"!==a.cursor&&(o=this.document.find("body"),this.storedCursor=o.css("cursor"),o.css("cursor",a.cursor),this.storedStylesheet=t("<style>*{ cursor: "+a.cursor+" !important; }</style>").appendTo(o)),a.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",a.opacity)),a.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",a.zIndex)),this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",e,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!s)for(n=this.containers.length-1;n>=0;n--)this.containers[n]._trigger("activate",e,this._uiHash(this));return t.ui.ddmanager&&(t.ui.ddmanager.current=this),t.ui.ddmanager&&!a.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this.dragging=!0,this._addClass(this.helper,"ui-sortable-helper"),this._mouseDrag(e),!0},_mouseDrag:function(e){var i,s,n,o,a=this.options,r=!1;for(this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-e.pageY<a.scrollSensitivity?this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop+a.scrollSpeed:e.pageY-this.overflowOffset.top<a.scrollSensitivity&&(this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop-a.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-e.pageX<a.scrollSensitivity?this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft+a.scrollSpeed:e.pageX-this.overflowOffset.left<a.scrollSensitivity&&(this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft-a.scrollSpeed)):(e.pageY-this.document.scrollTop()<a.scrollSensitivity?r=this.document.scrollTop(this.document.scrollTop()-a.scrollSpeed):this.window.height()-(e.pageY-this.document.scrollTop())<a.scrollSensitivity&&(r=this.document.scrollTop(this.document.scrollTop()+a.scrollSpeed)),e.pageX-this.document.scrollLeft()<a.scrollSensitivity?r=this.document.scrollLeft(this.document.scrollLeft()-a.scrollSpeed):this.window.width()-(e.pageX-this.document.scrollLeft())<a.scrollSensitivity&&(r=this.document.scrollLeft(this.document.scrollLeft()+a.scrollSpeed))),r!==!1&&t.ui.ddmanager&&!a.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--)if(s=this.items[i],n=s.item[0],o=this._intersectsWithPointer(s),o&&s.instance===this.currentContainer&&n!==this.currentItem[0]&&this.placeholder[1===o?"next":"prev"]()[0]!==n&&!t.contains(this.placeholder[0],n)&&("semi-dynamic"===this.options.type?!t.contains(this.element[0],n):!0)){if(this.direction=1===o?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(s))break;this._rearrange(e,s),this._trigger("change",e,this._uiHash());break}return this._contactContainers(e),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),this._trigger("sort",e,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(e,i){if(e){if(t.ui.ddmanager&&!this.options.dropBehaviour&&t.ui.ddmanager.drop(this,e),this.options.revert){var s=this,n=this.placeholder.offset(),o=this.options.axis,a={};o&&"x"!==o||(a.left=n.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft)),o&&"y"!==o||(a.top=n.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,t(this.helper).animate(a,parseInt(this.options.revert,10)||500,function(){s._clear(e)})}else this._clear(e,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp(new t.Event("mouseup",{target:null})),"original"===this.options.helper?(this.currentItem.css(this._storedCSS),this._removeClass(this.currentItem,"ui-sortable-helper")):this.currentItem.show();for(var e=this.containers.length-1;e>=0;e--)this.containers[e]._trigger("deactivate",null,this._uiHash(this)),this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",null,this._uiHash(this)),this.containers[e].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),t.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?t(this.domPosition.prev).after(this.currentItem):t(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(e){var i=this._getItemsAsjQuery(e&&e.connected),s=[];return e=e||{},t(i).each(function(){var i=(t(e.item||this).attr(e.attribute||"id")||"").match(e.expression||/(.+)[\-=_](.+)/);i&&s.push((e.key||i[1]+"[]")+"="+(e.key&&e.expression?i[1]:i[2]))}),!s.length&&e.key&&s.push(e.key+"="),s.join("&")},toArray:function(e){var i=this._getItemsAsjQuery(e&&e.connected),s=[];return e=e||{},i.each(function(){s.push(t(e.item||this).attr(e.attribute||"id")||"")}),s},_intersectsWith:function(t){var e=this.positionAbs.left,i=e+this.helperProportions.width,s=this.positionAbs.top,n=s+this.helperProportions.height,o=t.left,a=o+t.width,r=t.top,l=r+t.height,h=this.offset.click.top,c=this.offset.click.left,u="x"===this.options.axis||s+h>r&&l>s+h,d="y"===this.options.axis||e+c>o&&a>e+c,p=u&&d;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>t[this.floating?"width":"height"]?p:e+this.helperProportions.width/2>o&&a>i-this.helperProportions.width/2&&s+this.helperProportions.height/2>r&&l>n-this.helperProportions.height/2},_intersectsWithPointer:function(t){var e,i,s="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,t.top,t.height),n="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,t.left,t.width),o=s&&n;return o?(e=this._getDragVerticalDirection(),i=this._getDragHorizontalDirection(),this.floating?"right"===i||"down"===e?2:1:e&&("down"===e?2:1)):!1},_intersectsWithSides:function(t){var e=this._isOverAxis(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height),i=this._isOverAxis(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),s=this._getDragVerticalDirection(),n=this._getDragHorizontalDirection();return this.floating&&n?"right"===n&&i||"left"===n&&!i:s&&("down"===s&&e||"up"===s&&!e)},_getDragVerticalDirection:function(){var t=this.positionAbs.top-this.lastPositionAbs.top;return 0!==t&&(t>0?"down":"up")},_getDragHorizontalDirection:function(){var t=this.positionAbs.left-this.lastPositionAbs.left;return 0!==t&&(t>0?"right":"left")},refresh:function(t){return this._refreshItems(t),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function(){var t=this.options;return t.connectWith.constructor===String?[t.connectWith]:t.connectWith},_getItemsAsjQuery:function(e){function i(){r.push(this)}var s,n,o,a,r=[],l=[],h=this._connectWith();if(h&&e)for(s=h.length-1;s>=0;s--)for(o=t(h[s],this.document[0]),n=o.length-1;n>=0;n--)a=t.data(o[n],this.widgetFullName),a&&a!==this&&!a.options.disabled&&l.push([t.isFunction(a.options.items)?a.options.items.call(a.element):t(a.options.items,a.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),a]);for(l.push([t.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):t(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),s=l.length-1;s>=0;s--)l[s][0].each(i);return t(r)},_removeCurrentsFromItems:function(){var e=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=t.grep(this.items,function(t){for(var i=0;e.length>i;i++)if(e[i]===t.item[0])return!1;return!0})},_refreshItems:function(e){this.items=[],this.containers=[this];var i,s,n,o,a,r,l,h,c=this.items,u=[[t.isFunction(this.options.items)?this.options.items.call(this.element[0],e,{item:this.currentItem}):t(this.options.items,this.element),this]],d=this._connectWith();if(d&&this.ready)for(i=d.length-1;i>=0;i--)for(n=t(d[i],this.document[0]),s=n.length-1;s>=0;s--)o=t.data(n[s],this.widgetFullName),o&&o!==this&&!o.options.disabled&&(u.push([t.isFunction(o.options.items)?o.options.items.call(o.element[0],e,{item:this.currentItem}):t(o.options.items,o.element),o]),this.containers.push(o));for(i=u.length-1;i>=0;i--)for(a=u[i][1],r=u[i][0],s=0,h=r.length;h>s;s++)l=t(r[s]),l.data(this.widgetName+"-item",a),c.push({item:l,instance:a,width:0,height:0,left:0,top:0})},refreshPositions:function(e){this.floating=this.items.length?"x"===this.options.axis||this._isFloating(this.items[0].item):!1,this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var i,s,n,o;for(i=this.items.length-1;i>=0;i--)s=this.items[i],s.instance!==this.currentContainer&&this.currentContainer&&s.item[0]!==this.currentItem[0]||(n=this.options.toleranceElement?t(this.options.toleranceElement,s.item):s.item,e||(s.width=n.outerWidth(),s.height=n.outerHeight()),o=n.offset(),s.left=o.left,s.top=o.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)o=this.containers[i].element.offset(),this.containers[i].containerCache.left=o.left,this.containers[i].containerCache.top=o.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(e){e=e||this;var i,s=e.options;s.placeholder&&s.placeholder.constructor!==String||(i=s.placeholder,s.placeholder={element:function(){var s=e.currentItem[0].nodeName.toLowerCase(),n=t("<"+s+">",e.document[0]);return e._addClass(n,"ui-sortable-placeholder",i||e.currentItem[0].className)._removeClass(n,"ui-sortable-helper"),"tbody"===s?e._createTrPlaceholder(e.currentItem.find("tr").eq(0),t("<tr>",e.document[0]).appendTo(n)):"tr"===s?e._createTrPlaceholder(e.currentItem,n):"img"===s&&n.attr("src",e.currentItem.attr("src")),i||n.css("visibility","hidden"),n},update:function(t,n){(!i||s.forcePlaceholderSize)&&(n.height()||n.height(e.currentItem.innerHeight()-parseInt(e.currentItem.css("paddingTop")||0,10)-parseInt(e.currentItem.css("paddingBottom")||0,10)),n.width()||n.width(e.currentItem.innerWidth()-parseInt(e.currentItem.css("paddingLeft")||0,10)-parseInt(e.currentItem.css("paddingRight")||0,10)))}}),e.placeholder=t(s.placeholder.element.call(e.element,e.currentItem)),e.currentItem.after(e.placeholder),s.placeholder.update(e,e.placeholder)},_createTrPlaceholder:function(e,i){var s=this;e.children().each(function(){t("<td>&#160;</td>",s.document[0]).attr("colspan",t(this).attr("colspan")||1).appendTo(i)})},_contactContainers:function(e){var i,s,n,o,a,r,l,h,c,u,d=null,p=null;for(i=this.containers.length-1;i>=0;i--)if(!t.contains(this.currentItem[0],this.containers[i].element[0]))if(this._intersectsWith(this.containers[i].containerCache)){if(d&&t.contains(this.containers[i].element[0],d.element[0]))continue;d=this.containers[i],p=i}else this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",e,this._uiHash(this)),this.containers[i].containerCache.over=0);if(d)if(1===this.containers.length)this.containers[p].containerCache.over||(this.containers[p]._trigger("over",e,this._uiHash(this)),this.containers[p].containerCache.over=1);else{for(n=1e4,o=null,c=d.floating||this._isFloating(this.currentItem),a=c?"left":"top",r=c?"width":"height",u=c?"pageX":"pageY",s=this.items.length-1;s>=0;s--)t.contains(this.containers[p].element[0],this.items[s].item[0])&&this.items[s].item[0]!==this.currentItem[0]&&(l=this.items[s].item.offset()[a],h=!1,e[u]-l>this.items[s][r]/2&&(h=!0),n>Math.abs(e[u]-l)&&(n=Math.abs(e[u]-l),o=this.items[s],this.direction=h?"up":"down"));if(!o&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[p])return this.currentContainer.containerCache.over||(this.containers[p]._trigger("over",e,this._uiHash()),this.currentContainer.containerCache.over=1),void 0;o?this._rearrange(e,o,null,!0):this._rearrange(e,null,this.containers[p].element,!0),this._trigger("change",e,this._uiHash()),this.containers[p]._trigger("change",e,this._uiHash(this)),this.currentContainer=this.containers[p],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[p]._trigger("over",e,this._uiHash(this)),this.containers[p].containerCache.over=1}},_createHelper:function(e){var i=this.options,s=t.isFunction(i.helper)?t(i.helper.apply(this.element[0],[e,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return s.parents("body").length||t("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(s[0]),s[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!s[0].style.width||i.forceHelperSize)&&s.width(this.currentItem.width()),(!s[0].style.height||i.forceHelperSize)&&s.height(this.currentItem.height()),s},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===this.document[0].body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&t.ui.ie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var t=this.currentItem.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,i,s,n=this.options;"parent"===n.containment&&(n.containment=this.helper[0].parentNode),("document"===n.containment||"window"===n.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,"document"===n.containment?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,("document"===n.containment?this.document.height()||document.body.parentNode.scrollHeight:this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(n.containment)||(e=t(n.containment)[0],i=t(n.containment).offset(),s="hidden"!==t(e).css("overflow"),this.containment=[i.left+(parseInt(t(e).css("borderLeftWidth"),10)||0)+(parseInt(t(e).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(t(e).css("borderTopWidth"),10)||0)+(parseInt(t(e).css("paddingTop"),10)||0)-this.margins.top,i.left+(s?Math.max(e.scrollWidth,e.offsetWidth):e.offsetWidth)-(parseInt(t(e).css("borderLeftWidth"),10)||0)-(parseInt(t(e).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(s?Math.max(e.scrollHeight,e.offsetHeight):e.offsetHeight)-(parseInt(t(e).css("borderTopWidth"),10)||0)-(parseInt(t(e).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(e,i){i||(i=this.position);var s="absolute"===e?1:-1,n="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(n[0].tagName);return{top:i.top+this.offset.relative.top*s+this.offset.parent.top*s-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():o?0:n.scrollTop())*s,left:i.left+this.offset.relative.left*s+this.offset.parent.left*s-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():o?0:n.scrollLeft())*s}
  },_generatePosition:function(e){var i,s,n=this.options,o=e.pageX,a=e.pageY,r="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,l=/(html|body)/i.test(r[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(e.pageX-this.offset.click.left<this.containment[0]&&(o=this.containment[0]+this.offset.click.left),e.pageY-this.offset.click.top<this.containment[1]&&(a=this.containment[1]+this.offset.click.top),e.pageX-this.offset.click.left>this.containment[2]&&(o=this.containment[2]+this.offset.click.left),e.pageY-this.offset.click.top>this.containment[3]&&(a=this.containment[3]+this.offset.click.top)),n.grid&&(i=this.originalPageY+Math.round((a-this.originalPageY)/n.grid[1])*n.grid[1],a=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-n.grid[1]:i+n.grid[1]:i,s=this.originalPageX+Math.round((o-this.originalPageX)/n.grid[0])*n.grid[0],o=this.containment?s-this.offset.click.left>=this.containment[0]&&s-this.offset.click.left<=this.containment[2]?s:s-this.offset.click.left>=this.containment[0]?s-n.grid[0]:s+n.grid[0]:s)),{top:a-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():l?0:r.scrollTop()),left:o-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():l?0:r.scrollLeft())}},_rearrange:function(t,e,i,s){i?i[0].appendChild(this.placeholder[0]):e.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?e.item[0]:e.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var n=this.counter;this._delay(function(){n===this.counter&&this.refreshPositions(!s)})},_clear:function(t,e){function i(t,e,i){return function(s){i._trigger(t,s,e._uiHash(e))}}this.reverting=!1;var s,n=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(s in this._storedCSS)("auto"===this._storedCSS[s]||"static"===this._storedCSS[s])&&(this._storedCSS[s]="");this.currentItem.css(this._storedCSS),this._removeClass(this.currentItem,"ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!e&&n.push(function(t){this._trigger("receive",t,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||e||n.push(function(t){this._trigger("update",t,this._uiHash())}),this!==this.currentContainer&&(e||(n.push(function(t){this._trigger("remove",t,this._uiHash())}),n.push(function(t){return function(e){t._trigger("receive",e,this._uiHash(this))}}.call(this,this.currentContainer)),n.push(function(t){return function(e){t._trigger("update",e,this._uiHash(this))}}.call(this,this.currentContainer)))),s=this.containers.length-1;s>=0;s--)e||n.push(i("deactivate",this,this.containers[s])),this.containers[s].containerCache.over&&(n.push(i("out",this,this.containers[s])),this.containers[s].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,e||this._trigger("beforeStop",t,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.cancelHelperRemoval||(this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null),!e){for(s=0;n.length>s;s++)n[s].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!this.cancelHelperRemoval},_trigger:function(){t.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(e){var i=e||this;return{helper:i.helper,placeholder:i.placeholder||t([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:e?e.element:null}}})});
(function() { this.JST || (this.JST = {}); this.JST["jst/portfolio/drag"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n  <rect x="15" y="6" class="st0" width="2" height="2"/>\n  <rect x="11" y="6" class="st0" width="2" height="2"/>\n  <rect x="7" y="6" class="st0" width="2" height="2"/>\n  <rect x="3" y="6" class="st0" width="2" height="2"/>\n  <rect x="15" y="10" class="st0" width="2" height="2"/>\n  <rect x="11" y="10" class="st0" width="2" height="2"/>\n  <rect x="7" y="10" class="st0" width="2" height="2"/>\n  <rect x="3" y="10" class="st0" width="2" height="2"/>\n</svg>\n');}return __p.join('');};
}).call(this);
/*! tooltipster v4.1.8 */
!function(a,b){"function"==typeof define&&define.amd?define(["jquery"],function(a){return b(a)}):"object"==typeof exports?module.exports=b(require("jquery")):b(jQuery)}(this,function(a){function b(a){this.$container,this.constraints=null,this.__$tooltip,this.__init(a)}function c(b,c){var d=!0;return a.each(b,function(a,e){return void 0===c[a]||b[a]!==c[a]?(d=!1,!1):void 0}),d}function d(b){var c=b.attr("id"),d=c?h.window.document.getElementById(c):null;return d?d===b[0]:a.contains(h.window.document.body,b[0])}function e(){if(!g)return!1;var a=g.document.body||g.document.documentElement,b=a.style,c="transition",d=["Moz","Webkit","Khtml","O","ms"];if("string"==typeof b[c])return!0;c=c.charAt(0).toUpperCase()+c.substr(1);for(var e=0;e<d.length;e++)if("string"==typeof b[d[e]+c])return!0;return!1}var f={animation:"fade",animationDuration:350,content:null,contentAsHTML:!1,contentCloning:!1,debug:!0,delay:300,delayTouch:[300,500],functionInit:null,functionBefore:null,functionReady:null,functionAfter:null,functionFormat:null,IEmin:6,interactive:!1,multiple:!1,parent:null,plugins:["sideTip"],repositionOnScroll:!1,restoration:"none",selfDestruction:!0,theme:[],timer:0,trackerInterval:500,trackOrigin:!1,trackTooltip:!1,trigger:"hover",triggerClose:{click:!1,mouseleave:!1,originClick:!1,scroll:!1,tap:!1,touchleave:!1},triggerOpen:{click:!1,mouseenter:!1,tap:!1,touchstart:!1},updateAnimation:"rotate",zIndex:9999999},g="undefined"!=typeof window?window:null,h={hasTouchCapability:!(!g||!("ontouchstart"in g||g.DocumentTouch&&g.document instanceof g.DocumentTouch||g.navigator.maxTouchPoints)),hasTransitions:e(),IE:!1,semVer:"4.1.8",window:g},i=function(){this.__$emitterPrivate=a({}),this.__$emitterPublic=a({}),this.__instancesLatestArr=[],this.__plugins={},this._env=h};i.prototype={__bridge:function(b,c,d){if(!c[d]){var e=function(){};e.prototype=b;var g=new e;g.__init&&g.__init(c),a.each(b,function(a,b){0!=a.indexOf("__")&&(c[a]?f.debug&&console.log("The "+a+" method of the "+d+" plugin conflicts with another plugin or native methods"):(c[a]=function(){return g[a].apply(g,Array.prototype.slice.apply(arguments))},c[a].bridged=g))}),c[d]=g}return this},__setWindow:function(a){return h.window=a,this},_getRuler:function(a){return new b(a)},_off:function(){return this.__$emitterPrivate.off.apply(this.__$emitterPrivate,Array.prototype.slice.apply(arguments)),this},_on:function(){return this.__$emitterPrivate.on.apply(this.__$emitterPrivate,Array.prototype.slice.apply(arguments)),this},_one:function(){return this.__$emitterPrivate.one.apply(this.__$emitterPrivate,Array.prototype.slice.apply(arguments)),this},_plugin:function(b){var c=this;if("string"==typeof b){var d=b,e=null;return d.indexOf(".")>0?e=c.__plugins[d]:a.each(c.__plugins,function(a,b){return b.name.substring(b.name.length-d.length-1)=="."+d?(e=b,!1):void 0}),e}if(b.name.indexOf(".")<0)throw new Error("Plugins must be namespaced");return c.__plugins[b.name]=b,b.core&&c.__bridge(b.core,c,b.name),this},_trigger:function(){var a=Array.prototype.slice.apply(arguments);return"string"==typeof a[0]&&(a[0]={type:a[0]}),this.__$emitterPrivate.trigger.apply(this.__$emitterPrivate,a),this.__$emitterPublic.trigger.apply(this.__$emitterPublic,a),this},instances:function(b){var c=[],d=b||".tooltipstered";return a(d).each(function(){var b=a(this),d=b.data("tooltipster-ns");d&&a.each(d,function(a,d){c.push(b.data(d))})}),c},instancesLatest:function(){return this.__instancesLatestArr},off:function(){return this.__$emitterPublic.off.apply(this.__$emitterPublic,Array.prototype.slice.apply(arguments)),this},on:function(){return this.__$emitterPublic.on.apply(this.__$emitterPublic,Array.prototype.slice.apply(arguments)),this},one:function(){return this.__$emitterPublic.one.apply(this.__$emitterPublic,Array.prototype.slice.apply(arguments)),this},origins:function(b){var c=b?b+" ":"";return a(c+".tooltipstered").toArray()},setDefaults:function(b){return a.extend(f,b),this},triggerHandler:function(){return this.__$emitterPublic.triggerHandler.apply(this.__$emitterPublic,Array.prototype.slice.apply(arguments)),this}},a.tooltipster=new i,a.Tooltipster=function(b,c){this.__callbacks={close:[],open:[]},this.__closingTime,this.__Content,this.__contentBcr,this.__destroyed=!1,this.__destroying=!1,this.__$emitterPrivate=a({}),this.__$emitterPublic=a({}),this.__enabled=!0,this.__garbageCollector,this.__Geometry,this.__lastPosition,this.__namespace="tooltipster-"+Math.round(1e6*Math.random()),this.__options,this.__$originParents,this.__pointerIsOverOrigin=!1,this.__previousThemes=[],this.__state="closed",this.__timeouts={close:[],open:null},this.__touchEvents=[],this.__tracker=null,this._$origin,this._$tooltip,this.__init(b,c)},a.Tooltipster.prototype={__init:function(b,c){var d=this;if(d._$origin=a(b),d.__options=a.extend(!0,{},f,c),d.__optionsFormat(),!h.IE||h.IE>=d.__options.IEmin){var e=null;if(void 0===d._$origin.data("tooltipster-initialTitle")&&(e=d._$origin.attr("title"),void 0===e&&(e=null),d._$origin.data("tooltipster-initialTitle",e)),null!==d.__options.content)d.__contentSet(d.__options.content);else{var g,i=d._$origin.attr("data-tooltip-content");i&&(g=a(i)),g&&g[0]?d.__contentSet(g.first()):d.__contentSet(e)}d._$origin.removeAttr("title").addClass("tooltipstered"),d.__prepareOrigin(),d.__prepareGC(),a.each(d.__options.plugins,function(a,b){d._plug(b)}),h.hasTouchCapability&&a(h.window.document.body).on("touchmove."+d.__namespace+"-triggerOpen",function(a){d._touchRecordEvent(a)}),d._on("created",function(){d.__prepareTooltip()})._on("repositioned",function(a){d.__lastPosition=a.position})}else d.__options.disabled=!0},__contentInsert:function(){var a=this,b=a._$tooltip.find(".tooltipster-content"),c=a.__Content,d=function(a){c=a};return a._trigger({type:"format",content:a.__Content,format:d}),a.__options.functionFormat&&(c=a.__options.functionFormat.call(a,a,{origin:a._$origin[0]},a.__Content)),"string"!=typeof c||a.__options.contentAsHTML?b.empty().append(c):b.text(c),a},__contentSet:function(b){return b instanceof a&&this.__options.contentCloning&&(b=b.clone(!0)),this.__Content=b,this._trigger({type:"updated",content:b}),this},__destroyError:function(){throw new Error("This tooltip has been destroyed and cannot execute your method call.")},__geometry:function(){var b=this,c=b._$origin,d=b._$origin.is("area");if(d){var e=b._$origin.parent().attr("name");c=a('img[usemap="#'+e+'"]')}var f=c[0].getBoundingClientRect(),g=a(h.window.document),i=a(h.window),j=c,k={available:{document:null,window:null},document:{size:{height:g.height(),width:g.width()}},window:{scroll:{left:h.window.scrollX||h.window.document.documentElement.scrollLeft,top:h.window.scrollY||h.window.document.documentElement.scrollTop},size:{height:i.height(),width:i.width()}},origin:{fixedLineage:!1,offset:{},size:{height:f.bottom-f.top,width:f.right-f.left},usemapImage:d?c[0]:null,windowOffset:{bottom:f.bottom,left:f.left,right:f.right,top:f.top}}};if(d){var l=b._$origin.attr("shape"),m=b._$origin.attr("coords");if(m&&(m=m.split(","),a.map(m,function(a,b){m[b]=parseInt(a)})),"default"!=l)switch(l){case"circle":var n=m[0],o=m[1],p=m[2],q=o-p,r=n-p;k.origin.size.height=2*p,k.origin.size.width=k.origin.size.height,k.origin.windowOffset.left+=r,k.origin.windowOffset.top+=q;break;case"rect":var s=m[0],t=m[1],u=m[2],v=m[3];k.origin.size.height=v-t,k.origin.size.width=u-s,k.origin.windowOffset.left+=s,k.origin.windowOffset.top+=t;break;case"poly":for(var w=0,x=0,y=0,z=0,A="even",B=0;B<m.length;B++){var C=m[B];"even"==A?(C>y&&(y=C,0===B&&(w=y)),w>C&&(w=C),A="odd"):(C>z&&(z=C,1==B&&(x=z)),x>C&&(x=C),A="even")}k.origin.size.height=z-x,k.origin.size.width=y-w,k.origin.windowOffset.left+=w,k.origin.windowOffset.top+=x}}var D=function(a){k.origin.size.height=a.height,k.origin.windowOffset.left=a.left,k.origin.windowOffset.top=a.top,k.origin.size.width=a.width};for(b._trigger({type:"geometry",edit:D,geometry:{height:k.origin.size.height,left:k.origin.windowOffset.left,top:k.origin.windowOffset.top,width:k.origin.size.width}}),k.origin.windowOffset.right=k.origin.windowOffset.left+k.origin.size.width,k.origin.windowOffset.bottom=k.origin.windowOffset.top+k.origin.size.height,k.origin.offset.left=k.origin.windowOffset.left+k.window.scroll.left,k.origin.offset.top=k.origin.windowOffset.top+k.window.scroll.top,k.origin.offset.bottom=k.origin.offset.top+k.origin.size.height,k.origin.offset.right=k.origin.offset.left+k.origin.size.width,k.available.document={bottom:{height:k.document.size.height-k.origin.offset.bottom,width:k.document.size.width},left:{height:k.document.size.height,width:k.origin.offset.left},right:{height:k.document.size.height,width:k.document.size.width-k.origin.offset.right},top:{height:k.origin.offset.top,width:k.document.size.width}},k.available.window={bottom:{height:Math.max(k.window.size.height-Math.max(k.origin.windowOffset.bottom,0),0),width:k.window.size.width},left:{height:k.window.size.height,width:Math.max(k.origin.windowOffset.left,0)},right:{height:k.window.size.height,width:Math.max(k.window.size.width-Math.max(k.origin.windowOffset.right,0),0)},top:{height:Math.max(k.origin.windowOffset.top,0),width:k.window.size.width}};"html"!=j[0].tagName.toLowerCase();){if("fixed"==j.css("position")){k.origin.fixedLineage=!0;break}j=j.parent()}return k},__optionsFormat:function(){return"number"==typeof this.__options.animationDuration&&(this.__options.animationDuration=[this.__options.animationDuration,this.__options.animationDuration]),"number"==typeof this.__options.delay&&(this.__options.delay=[this.__options.delay,this.__options.delay]),"number"==typeof this.__options.delayTouch&&(this.__options.delayTouch=[this.__options.delayTouch,this.__options.delayTouch]),"string"==typeof this.__options.theme&&(this.__options.theme=[this.__options.theme]),null===this.__options.parent?this.__options.parent=a(h.window.document.body):"string"==typeof this.__options.parent&&(this.__options.parent=a(this.__options.parent)),"hover"==this.__options.trigger?(this.__options.triggerOpen={mouseenter:!0,touchstart:!0},this.__options.triggerClose={mouseleave:!0,originClick:!0,touchleave:!0}):"click"==this.__options.trigger&&(this.__options.triggerOpen={click:!0,tap:!0},this.__options.triggerClose={click:!0,tap:!0}),this._trigger("options"),this},__prepareGC:function(){var b=this;return b.__options.selfDestruction?b.__garbageCollector=setInterval(function(){var c=(new Date).getTime();b.__touchEvents=a.grep(b.__touchEvents,function(a,b){return c-a.time>6e4}),d(b._$origin)||b.destroy()},2e4):clearInterval(b.__garbageCollector),b},__prepareOrigin:function(){var a=this;if(a._$origin.off("."+a.__namespace+"-triggerOpen"),h.hasTouchCapability&&a._$origin.on("touchstart."+a.__namespace+"-triggerOpen touchend."+a.__namespace+"-triggerOpen touchcancel."+a.__namespace+"-triggerOpen",function(b){a._touchRecordEvent(b)}),a.__options.triggerOpen.click||a.__options.triggerOpen.tap&&h.hasTouchCapability){var b="";a.__options.triggerOpen.click&&(b+="click."+a.__namespace+"-triggerOpen "),a.__options.triggerOpen.tap&&h.hasTouchCapability&&(b+="touchend."+a.__namespace+"-triggerOpen"),a._$origin.on(b,function(b){a._touchIsMeaningfulEvent(b)&&a._open(b)})}if(a.__options.triggerOpen.mouseenter||a.__options.triggerOpen.touchstart&&h.hasTouchCapability){var b="";a.__options.triggerOpen.mouseenter&&(b+="mouseenter."+a.__namespace+"-triggerOpen "),a.__options.triggerOpen.touchstart&&h.hasTouchCapability&&(b+="touchstart."+a.__namespace+"-triggerOpen"),a._$origin.on(b,function(b){!a._touchIsTouchEvent(b)&&a._touchIsEmulatedEvent(b)||(a.__pointerIsOverOrigin=!0,a._openShortly(b))})}if(a.__options.triggerClose.mouseleave||a.__options.triggerClose.touchleave&&h.hasTouchCapability){var b="";a.__options.triggerClose.mouseleave&&(b+="mouseleave."+a.__namespace+"-triggerOpen "),a.__options.triggerClose.touchleave&&h.hasTouchCapability&&(b+="touchend."+a.__namespace+"-triggerOpen touchcancel."+a.__namespace+"-triggerOpen"),a._$origin.on(b,function(b){a._touchIsMeaningfulEvent(b)&&(a.__pointerIsOverOrigin=!1)})}return a},__prepareTooltip:function(){var b=this,c=b.__options.interactive?"auto":"";return b._$tooltip.attr("id",b.__namespace).css({"pointer-events":c,zIndex:b.__options.zIndex}),a.each(b.__previousThemes,function(a,c){b._$tooltip.removeClass(c)}),a.each(b.__options.theme,function(a,c){b._$tooltip.addClass(c)}),b.__previousThemes=a.merge([],b.__options.theme),b},__scrollHandler:function(b){var c=this;if(c.__options.triggerClose.scroll)c._close(b);else if(d(c._$origin)&&d(c._$tooltip)){if(b.target===h.window.document)c.__Geometry.origin.fixedLineage||c.__options.repositionOnScroll&&c.reposition(b);else{var e=c.__geometry(),f=!1;if("fixed"!=c._$origin.css("position")&&c.__$originParents.each(function(b,c){var d=a(c),g=d.css("overflow-x"),h=d.css("overflow-y");if("visible"!=g||"visible"!=h){var i=c.getBoundingClientRect();if("visible"!=g&&(e.origin.windowOffset.left<i.left||e.origin.windowOffset.right>i.right))return f=!0,!1;if("visible"!=h&&(e.origin.windowOffset.top<i.top||e.origin.windowOffset.bottom>i.bottom))return f=!0,!1}return"fixed"==d.css("position")?!1:void 0}),f)c._$tooltip.css("visibility","hidden");else if(c._$tooltip.css("visibility","visible"),c.__options.repositionOnScroll)c.reposition(b);else{var g=e.origin.offset.left-c.__Geometry.origin.offset.left,i=e.origin.offset.top-c.__Geometry.origin.offset.top;c._$tooltip.css({left:c.__lastPosition.coord.left+g,top:c.__lastPosition.coord.top+i})}}c._trigger({type:"scroll",event:b})}return c},__stateSet:function(a){return this.__state=a,this._trigger({type:"state",state:a}),this},__timeoutsClear:function(){return clearTimeout(this.__timeouts.open),this.__timeouts.open=null,a.each(this.__timeouts.close,function(a,b){clearTimeout(b)}),this.__timeouts.close=[],this},__trackerStart:function(){var a=this,b=a._$tooltip.find(".tooltipster-content");return a.__options.trackTooltip&&(a.__contentBcr=b[0].getBoundingClientRect()),a.__tracker=setInterval(function(){if(d(a._$origin)&&d(a._$tooltip)){if(a.__options.trackOrigin){var e=a.__geometry(),f=!1;c(e.origin.size,a.__Geometry.origin.size)&&(a.__Geometry.origin.fixedLineage?c(e.origin.windowOffset,a.__Geometry.origin.windowOffset)&&(f=!0):c(e.origin.offset,a.__Geometry.origin.offset)&&(f=!0)),f||(a.__options.triggerClose.mouseleave?a._close():a.reposition())}if(a.__options.trackTooltip){var g=b[0].getBoundingClientRect();g.height===a.__contentBcr.height&&g.width===a.__contentBcr.width||(a.reposition(),a.__contentBcr=g)}}else a._close()},a.__options.trackerInterval),a},_close:function(b,c){var d=this,e=!0;if(d._trigger({type:"close",event:b,stop:function(){e=!1}}),e||d.__destroying){c&&d.__callbacks.close.push(c),d.__callbacks.open=[],d.__timeoutsClear();var f=function(){a.each(d.__callbacks.close,function(a,c){c.call(d,d,{event:b,origin:d._$origin[0]})}),d.__callbacks.close=[]};if("closed"!=d.__state){var g=!0,i=new Date,j=i.getTime(),k=j+d.__options.animationDuration[1];if("disappearing"==d.__state&&k>d.__closingTime&&(g=!1),g){d.__closingTime=k,"disappearing"!=d.__state&&d.__stateSet("disappearing");var l=function(){clearInterval(d.__tracker),d._trigger({type:"closing",event:b}),d._$tooltip.off("."+d.__namespace+"-triggerClose").removeClass("tooltipster-dying"),a(h.window).off("."+d.__namespace+"-triggerClose"),d.__$originParents.each(function(b,c){a(c).off("scroll."+d.__namespace+"-triggerClose")}),d.__$originParents=null,a(h.window.document.body).off("."+d.__namespace+"-triggerClose"),d._$origin.off("."+d.__namespace+"-triggerClose"),d._off("dismissable"),d.__stateSet("closed"),d._trigger({type:"after",event:b}),d.__options.functionAfter&&d.__options.functionAfter.call(d,d,{event:b,origin:d._$origin[0]}),f()};h.hasTransitions?(d._$tooltip.css({"-moz-animation-duration":d.__options.animationDuration[1]+"ms","-ms-animation-duration":d.__options.animationDuration[1]+"ms","-o-animation-duration":d.__options.animationDuration[1]+"ms","-webkit-animation-duration":d.__options.animationDuration[1]+"ms","animation-duration":d.__options.animationDuration[1]+"ms","transition-duration":d.__options.animationDuration[1]+"ms"}),d._$tooltip.clearQueue().removeClass("tooltipster-show").addClass("tooltipster-dying"),d.__options.animationDuration[1]>0&&d._$tooltip.delay(d.__options.animationDuration[1]),d._$tooltip.queue(l)):d._$tooltip.stop().fadeOut(d.__options.animationDuration[1],l)}}else f()}return d},_off:function(){return this.__$emitterPrivate.off.apply(this.__$emitterPrivate,Array.prototype.slice.apply(arguments)),this},_on:function(){return this.__$emitterPrivate.on.apply(this.__$emitterPrivate,Array.prototype.slice.apply(arguments)),this},_one:function(){return this.__$emitterPrivate.one.apply(this.__$emitterPrivate,Array.prototype.slice.apply(arguments)),this},_open:function(b,c){var e=this;if(!e.__destroying&&d(e._$origin)&&e.__enabled){var f=!0;if("closed"==e.__state&&(e._trigger({type:"before",event:b,stop:function(){f=!1}}),f&&e.__options.functionBefore&&(f=e.__options.functionBefore.call(e,e,{event:b,origin:e._$origin[0]}))),f!==!1&&null!==e.__Content){c&&e.__callbacks.open.push(c),e.__callbacks.close=[],e.__timeoutsClear();var g,i=function(){"stable"!=e.__state&&e.__stateSet("stable"),a.each(e.__callbacks.open,function(a,b){b.call(e,e,{origin:e._$origin[0],tooltip:e._$tooltip[0]})}),e.__callbacks.open=[]};if("closed"!==e.__state)g=0,"disappearing"===e.__state?(e.__stateSet("appearing"),h.hasTransitions?(e._$tooltip.clearQueue().removeClass("tooltipster-dying").addClass("tooltipster-show"),e.__options.animationDuration[0]>0&&e._$tooltip.delay(e.__options.animationDuration[0]),e._$tooltip.queue(i)):e._$tooltip.stop().fadeIn(i)):"stable"==e.__state&&i();else{if(e.__stateSet("appearing"),g=e.__options.animationDuration[0],e.__contentInsert(),e.reposition(b,!0),h.hasTransitions?(e._$tooltip.addClass("tooltipster-"+e.__options.animation).addClass("tooltipster-initial").css({"-moz-animation-duration":e.__options.animationDuration[0]+"ms","-ms-animation-duration":e.__options.animationDuration[0]+"ms","-o-animation-duration":e.__options.animationDuration[0]+"ms","-webkit-animation-duration":e.__options.animationDuration[0]+"ms","animation-duration":e.__options.animationDuration[0]+"ms","transition-duration":e.__options.animationDuration[0]+"ms"}),setTimeout(function(){"closed"!=e.__state&&(e._$tooltip.addClass("tooltipster-show").removeClass("tooltipster-initial"),e.__options.animationDuration[0]>0&&e._$tooltip.delay(e.__options.animationDuration[0]),e._$tooltip.queue(i))},0)):e._$tooltip.css("display","none").fadeIn(e.__options.animationDuration[0],i),e.__trackerStart(),a(h.window).on("resize."+e.__namespace+"-triggerClose",function(b){var c=a(document.activeElement);(c.is("input")||c.is("textarea"))&&a.contains(e._$tooltip[0],c[0])||e.reposition(b)}).on("scroll."+e.__namespace+"-triggerClose",function(a){e.__scrollHandler(a)}),e.__$originParents=e._$origin.parents(),e.__$originParents.each(function(b,c){a(c).on("scroll."+e.__namespace+"-triggerClose",function(a){e.__scrollHandler(a)})}),e.__options.triggerClose.mouseleave||e.__options.triggerClose.touchleave&&h.hasTouchCapability){e._on("dismissable",function(a){a.dismissable?a.delay?(m=setTimeout(function(){e._close(a.event)},a.delay),e.__timeouts.close.push(m)):e._close(a):clearTimeout(m)});var j=e._$origin,k="",l="",m=null;e.__options.interactive&&(j=j.add(e._$tooltip)),e.__options.triggerClose.mouseleave&&(k+="mouseenter."+e.__namespace+"-triggerClose ",l+="mouseleave."+e.__namespace+"-triggerClose "),e.__options.triggerClose.touchleave&&h.hasTouchCapability&&(k+="touchstart."+e.__namespace+"-triggerClose",l+="touchend."+e.__namespace+"-triggerClose touchcancel."+e.__namespace+"-triggerClose"),j.on(l,function(a){if(e._touchIsTouchEvent(a)||!e._touchIsEmulatedEvent(a)){var b="mouseleave"==a.type?e.__options.delay:e.__options.delayTouch;e._trigger({delay:b[1],dismissable:!0,event:a,type:"dismissable"})}}).on(k,function(a){!e._touchIsTouchEvent(a)&&e._touchIsEmulatedEvent(a)||e._trigger({dismissable:!1,event:a,type:"dismissable"})})}e.__options.triggerClose.originClick&&e._$origin.on("click."+e.__namespace+"-triggerClose",function(a){e._touchIsTouchEvent(a)||e._touchIsEmulatedEvent(a)||e._close(a)}),(e.__options.triggerClose.click||e.__options.triggerClose.tap&&h.hasTouchCapability)&&setTimeout(function(){if("closed"!=e.__state){var b="",c=a(h.window.document.body);e.__options.triggerClose.click&&(b+="click."+e.__namespace+"-triggerClose "),e.__options.triggerClose.tap&&h.hasTouchCapability&&(b+="touchend."+e.__namespace+"-triggerClose"),c.on(b,function(b){e._touchIsMeaningfulEvent(b)&&(e._touchRecordEvent(b),e.__options.interactive&&a.contains(e._$tooltip[0],b.target)||e._close(b))}),e.__options.triggerClose.tap&&h.hasTouchCapability&&c.on("touchstart."+e.__namespace+"-triggerClose",function(a){e._touchRecordEvent(a)})}},0),e._trigger("ready"),e.__options.functionReady&&e.__options.functionReady.call(e,e,{origin:e._$origin[0],tooltip:e._$tooltip[0]})}if(e.__options.timer>0){var m=setTimeout(function(){e._close()},e.__options.timer+g);e.__timeouts.close.push(m)}}}return e},_openShortly:function(a){var b=this,c=!0;if("stable"!=b.__state&&"appearing"!=b.__state&&!b.__timeouts.open&&(b._trigger({type:"start",event:a,stop:function(){c=!1}}),c)){var d=0==a.type.indexOf("touch")?b.__options.delayTouch:b.__options.delay;d[0]?b.__timeouts.open=setTimeout(function(){b.__timeouts.open=null,b.__pointerIsOverOrigin&&b._touchIsMeaningfulEvent(a)?(b._trigger("startend"),b._open(a)):b._trigger("startcancel")},d[0]):(b._trigger("startend"),b._open(a))}return b},_optionsExtract:function(b,c){var d=this,e=a.extend(!0,{},c),f=d.__options[b];return f||(f={},a.each(c,function(a,b){var c=d.__options[a];void 0!==c&&(f[a]=c)})),a.each(e,function(b,c){void 0!==f[b]&&("object"!=typeof c||c instanceof Array||null==c||"object"!=typeof f[b]||f[b]instanceof Array||null==f[b]?e[b]=f[b]:a.extend(e[b],f[b]))}),e},_plug:function(b){var c=a.tooltipster._plugin(b);if(!c)throw new Error('The "'+b+'" plugin is not defined');return c.instance&&a.tooltipster.__bridge(c.instance,this,c.name),this},_touchIsEmulatedEvent:function(a){for(var b=!1,c=(new Date).getTime(),d=this.__touchEvents.length-1;d>=0;d--){var e=this.__touchEvents[d];if(!(c-e.time<500))break;e.target===a.target&&(b=!0)}return b},_touchIsMeaningfulEvent:function(a){return this._touchIsTouchEvent(a)&&!this._touchSwiped(a.target)||!this._touchIsTouchEvent(a)&&!this._touchIsEmulatedEvent(a)},_touchIsTouchEvent:function(a){return 0==a.type.indexOf("touch")},_touchRecordEvent:function(a){return this._touchIsTouchEvent(a)&&(a.time=(new Date).getTime(),this.__touchEvents.push(a)),this},_touchSwiped:function(a){for(var b=!1,c=this.__touchEvents.length-1;c>=0;c--){var d=this.__touchEvents[c];if("touchmove"==d.type){b=!0;break}if("touchstart"==d.type&&a===d.target)break}return b},_trigger:function(){var b=Array.prototype.slice.apply(arguments);return"string"==typeof b[0]&&(b[0]={type:b[0]}),b[0].instance=this,b[0].origin=this._$origin?this._$origin[0]:null,b[0].tooltip=this._$tooltip?this._$tooltip[0]:null,this.__$emitterPrivate.trigger.apply(this.__$emitterPrivate,b),a.tooltipster._trigger.apply(a.tooltipster,b),this.__$emitterPublic.trigger.apply(this.__$emitterPublic,b),this},_unplug:function(b){var c=this;if(c[b]){var d=a.tooltipster._plugin(b);d.instance&&a.each(d.instance,function(a,d){c[a]&&c[a].bridged===c[b]&&delete c[a]}),c[b].__destroy&&c[b].__destroy(),delete c[b]}return c},close:function(a){return this.__destroyed?this.__destroyError():this._close(null,a),this},content:function(a){var b=this;if(void 0===a)return b.__Content;if(b.__destroyed)b.__destroyError();else if(b.__contentSet(a),null!==b.__Content){if("closed"!==b.__state&&(b.__contentInsert(),b.reposition(),b.__options.updateAnimation))if(h.hasTransitions){var c=b.__options.updateAnimation;b._$tooltip.addClass("tooltipster-update-"+c),setTimeout(function(){"closed"!=b.__state&&b._$tooltip.removeClass("tooltipster-update-"+c)},1e3)}else b._$tooltip.fadeTo(200,.5,function(){"closed"!=b.__state&&b._$tooltip.fadeTo(200,1)})}else b._close();return b},destroy:function(){var b=this;return b.__destroyed?b.__destroyError():b.__destroying||(b.__destroying=!0,b._close(null,function(){b._trigger("destroy"),b.__destroying=!1,b.__destroyed=!0,b._$origin.removeData(b.__namespace).off("."+b.__namespace+"-triggerOpen"),a(h.window.document.body).off("."+b.__namespace+"-triggerOpen");var c=b._$origin.data("tooltipster-ns");if(c)if(1===c.length){var d=null;"previous"==b.__options.restoration?d=b._$origin.data("tooltipster-initialTitle"):"current"==b.__options.restoration&&(d="string"==typeof b.__Content?b.__Content:a("<div></div>").append(b.__Content).html()),d&&b._$origin.attr("title",d),b._$origin.removeClass("tooltipstered"),b._$origin.removeData("tooltipster-ns").removeData("tooltipster-initialTitle")}else c=a.grep(c,function(a,c){return a!==b.__namespace}),b._$origin.data("tooltipster-ns",c);b._trigger("destroyed"),b._off(),b.off(),b.__Content=null,b.__$emitterPrivate=null,b.__$emitterPublic=null,b.__options.parent=null,b._$origin=null,b._$tooltip=null,a.tooltipster.__instancesLatestArr=a.grep(a.tooltipster.__instancesLatestArr,function(a,c){return b!==a}),clearInterval(b.__garbageCollector)})),b},disable:function(){return this.__destroyed?(this.__destroyError(),this):(this._close(),this.__enabled=!1,this)},elementOrigin:function(){return this.__destroyed?void this.__destroyError():this._$origin[0]},elementTooltip:function(){return this._$tooltip?this._$tooltip[0]:null},enable:function(){return this.__enabled=!0,this},hide:function(a){return this.close(a)},instance:function(){return this},off:function(){return this.__destroyed||this.__$emitterPublic.off.apply(this.__$emitterPublic,Array.prototype.slice.apply(arguments)),this},on:function(){return this.__destroyed?this.__destroyError():this.__$emitterPublic.on.apply(this.__$emitterPublic,Array.prototype.slice.apply(arguments)),this},one:function(){return this.__destroyed?this.__destroyError():this.__$emitterPublic.one.apply(this.__$emitterPublic,Array.prototype.slice.apply(arguments)),this},open:function(a){return this.__destroyed||this.__destroying?this.__destroyError():this._open(null,a),this},option:function(b,c){return void 0===c?this.__options[b]:(this.__destroyed?this.__destroyError():(this.__options[b]=c,this.__optionsFormat(),a.inArray(b,["trigger","triggerClose","triggerOpen"])>=0&&this.__prepareOrigin(),"selfDestruction"===b&&this.__prepareGC()),this)},reposition:function(a,b){var c=this;return c.__destroyed?c.__destroyError():"closed"!=c.__state&&d(c._$origin)&&(b||d(c._$tooltip))&&(b||c._$tooltip.detach(),c.__Geometry=c.__geometry(),c._trigger({type:"reposition",event:a,helper:{geo:c.__Geometry}})),c},show:function(a){return this.open(a)},status:function(){return{destroyed:this.__destroyed,destroying:this.__destroying,enabled:this.__enabled,open:"closed"!==this.__state,state:this.__state}},triggerHandler:function(){return this.__destroyed?this.__destroyError():this.__$emitterPublic.triggerHandler.apply(this.__$emitterPublic,Array.prototype.slice.apply(arguments)),this}},a.fn.tooltipster=function(){var b=Array.prototype.slice.apply(arguments),c="You are using a single HTML element as content for several tooltips. You probably want to set the contentCloning option to TRUE.";if(0===this.length)return this;if("string"==typeof b[0]){var d="#*$~&";return this.each(function(){var e=a(this).data("tooltipster-ns"),f=e?a(this).data(e[0]):null;if(!f)throw new Error("You called Tooltipster's \""+b[0]+'" method on an uninitialized element');if("function"!=typeof f[b[0]])throw new Error('Unknown method "'+b[0]+'"');this.length>1&&"content"==b[0]&&(b[1]instanceof a||"object"==typeof b[1]&&null!=b[1]&&b[1].tagName)&&!f.__options.contentCloning&&f.__options.debug&&console.log(c);var g=f[b[0]](b[1],b[2]);return g!==f||"instance"===b[0]?(d=g,!1):void 0}),"#*$~&"!==d?d:this}a.tooltipster.__instancesLatestArr=[];var e=b[0]&&void 0!==b[0].multiple,g=e&&b[0].multiple||!e&&f.multiple,h=b[0]&&void 0!==b[0].content,i=h&&b[0].content||!h&&f.content,j=b[0]&&void 0!==b[0].contentCloning,k=j&&b[0].contentCloning||!j&&f.contentCloning,l=b[0]&&void 0!==b[0].debug,m=l&&b[0].debug||!l&&f.debug;return this.length>1&&(i instanceof a||"object"==typeof i&&null!=i&&i.tagName)&&!k&&m&&console.log(c),this.each(function(){var c=!1,d=a(this),e=d.data("tooltipster-ns"),f=null;e?g?c=!0:m&&(console.log("Tooltipster: one or more tooltips are already attached to the element below. Ignoring."),console.log(this)):c=!0,c&&(f=new a.Tooltipster(this,b[0]),e||(e=[]),e.push(f.__namespace),d.data("tooltipster-ns",e),d.data(f.__namespace,f),f.__options.functionInit&&f.__options.functionInit.call(f,f,{origin:this}),f._trigger("init")),a.tooltipster.__instancesLatestArr.push(f)}),this},b.prototype={__init:function(b){this.__$tooltip=b,this.__$tooltip.css({left:0,overflow:"hidden",position:"absolute",top:0}).find(".tooltipster-content").css("overflow","auto"),this.$container=a('<div class="tooltipster-ruler"></div>').append(this.__$tooltip).appendTo(h.window.document.body)},__forceRedraw:function(){var a=this.__$tooltip.parent();this.__$tooltip.detach(),this.__$tooltip.appendTo(a)},constrain:function(a,b){return this.constraints={width:a,height:b},this.__$tooltip.css({display:"block",height:"",overflow:"auto",width:a}),this},destroy:function(){this.__$tooltip.detach().find(".tooltipster-content").css({display:"",overflow:""}),this.$container.remove()},free:function(){return this.constraints=null,this.__$tooltip.css({display:"",height:"",overflow:"visible",width:""}),this},measure:function(){this.__forceRedraw();var a=this.__$tooltip[0].getBoundingClientRect(),b={size:{height:a.height||a.bottom,width:a.width||a.right}};if(this.constraints){var c=this.__$tooltip.find(".tooltipster-content"),d=this.__$tooltip.outerHeight(),e=c[0].getBoundingClientRect(),f={height:d<=this.constraints.height,width:a.width<=this.constraints.width&&e.width>=c[0].scrollWidth-1};b.fits=f.height&&f.width}return h.IE&&h.IE<=11&&b.size.width!==h.window.document.documentElement.clientWidth&&(b.size.width=Math.ceil(b.size.width)+1),b}};var j=navigator.userAgent.toLowerCase();-1!=j.indexOf("msie")?h.IE=parseInt(j.split("msie")[1]):-1!==j.toLowerCase().indexOf("trident")&&-1!==j.indexOf(" rv:11")?h.IE=11:-1!=j.toLowerCase().indexOf("edge/")&&(h.IE=parseInt(j.toLowerCase().split("edge/")[1]));var k="tooltipster.sideTip";return a.tooltipster._plugin({name:k,instance:{__defaults:function(){return{arrow:!0,distance:6,functionPosition:null,maxWidth:null,minIntersection:16,minWidth:0,position:null,side:"top",viewportAware:!0}},__init:function(a){var b=this;b.__instance=a,b.__namespace="tooltipster-sideTip-"+Math.round(1e6*Math.random()),b.__previousState="closed",b.__options,b.__optionsFormat(),b.__instance._on("state."+b.__namespace,function(a){"closed"==a.state?b.__close():"appearing"==a.state&&"closed"==b.__previousState&&b.__create(),b.__previousState=a.state}),b.__instance._on("options."+b.__namespace,function(){b.__optionsFormat()}),b.__instance._on("reposition."+b.__namespace,function(a){b.__reposition(a.event,a.helper)})},__close:function(){this.__instance.content()instanceof a&&this.__instance.content().detach(),this.__instance._$tooltip.remove(),this.__instance._$tooltip=null},__create:function(){var b=a('<div class="tooltipster-base tooltipster-sidetip"><div class="tooltipster-box"><div class="tooltipster-content"></div></div><div class="tooltipster-arrow"><div class="tooltipster-arrow-uncropped"><div class="tooltipster-arrow-border"></div><div class="tooltipster-arrow-background"></div></div></div></div>');this.__options.arrow||b.find(".tooltipster-box").css("margin",0).end().find(".tooltipster-arrow").hide(),this.__options.minWidth&&b.css("min-width",this.__options.minWidth+"px"),this.__options.maxWidth&&b.css("max-width",this.__options.maxWidth+"px"),
this.__instance._$tooltip=b,this.__instance._trigger("created")},__destroy:function(){this.__instance._off("."+self.__namespace)},__optionsFormat:function(){var b=this;if(b.__options=b.__instance._optionsExtract(k,b.__defaults()),b.__options.position&&(b.__options.side=b.__options.position),"object"!=typeof b.__options.distance&&(b.__options.distance=[b.__options.distance]),b.__options.distance.length<4&&(void 0===b.__options.distance[1]&&(b.__options.distance[1]=b.__options.distance[0]),void 0===b.__options.distance[2]&&(b.__options.distance[2]=b.__options.distance[0]),void 0===b.__options.distance[3]&&(b.__options.distance[3]=b.__options.distance[1]),b.__options.distance={top:b.__options.distance[0],right:b.__options.distance[1],bottom:b.__options.distance[2],left:b.__options.distance[3]}),"string"==typeof b.__options.side){var c={top:"bottom",right:"left",bottom:"top",left:"right"};b.__options.side=[b.__options.side,c[b.__options.side]],"left"==b.__options.side[0]||"right"==b.__options.side[0]?b.__options.side.push("top","bottom"):b.__options.side.push("right","left")}6===a.tooltipster._env.IE&&b.__options.arrow!==!0&&(b.__options.arrow=!1)},__reposition:function(b,c){var d,e=this,f=e.__targetFind(c),g=[];e.__instance._$tooltip.detach();var h=e.__instance._$tooltip.clone(),i=a.tooltipster._getRuler(h),j=!1,k=e.__instance.option("animation");switch(k&&h.removeClass("tooltipster-"+k),a.each(["window","document"],function(d,k){var l=null;if(e.__instance._trigger({container:k,helper:c,satisfied:j,takeTest:function(a){l=a},results:g,type:"positionTest"}),1==l||0!=l&&0==j&&("window"!=k||e.__options.viewportAware))for(var d=0;d<e.__options.side.length;d++){var m={horizontal:0,vertical:0},n=e.__options.side[d];"top"==n||"bottom"==n?m.vertical=e.__options.distance[n]:m.horizontal=e.__options.distance[n],e.__sideChange(h,n),a.each(["natural","constrained"],function(a,d){if(l=null,e.__instance._trigger({container:k,event:b,helper:c,mode:d,results:g,satisfied:j,side:n,takeTest:function(a){l=a},type:"positionTest"}),1==l||0!=l&&0==j){var h={container:k,distance:m,fits:null,mode:d,outerSize:null,side:n,size:null,target:f[n],whole:null},o="natural"==d?i.free():i.constrain(c.geo.available[k][n].width-m.horizontal,c.geo.available[k][n].height-m.vertical),p=o.measure();if(h.size=p.size,h.outerSize={height:p.size.height+m.vertical,width:p.size.width+m.horizontal},"natural"==d?c.geo.available[k][n].width>=h.outerSize.width&&c.geo.available[k][n].height>=h.outerSize.height?h.fits=!0:h.fits=!1:h.fits=p.fits,"window"==k&&(h.fits?"top"==n||"bottom"==n?h.whole=c.geo.origin.windowOffset.right>=e.__options.minIntersection&&c.geo.window.size.width-c.geo.origin.windowOffset.left>=e.__options.minIntersection:h.whole=c.geo.origin.windowOffset.bottom>=e.__options.minIntersection&&c.geo.window.size.height-c.geo.origin.windowOffset.top>=e.__options.minIntersection:h.whole=!1),g.push(h),h.whole)j=!0;else if("natural"==h.mode&&(h.fits||h.size.width<=c.geo.available[k][n].width))return!1}})}}),e.__instance._trigger({edit:function(a){g=a},event:b,helper:c,results:g,type:"positionTested"}),g.sort(function(a,b){if(a.whole&&!b.whole)return-1;if(!a.whole&&b.whole)return 1;if(a.whole&&b.whole){var c=e.__options.side.indexOf(a.side),d=e.__options.side.indexOf(b.side);return d>c?-1:c>d?1:"natural"==a.mode?-1:1}if(a.fits&&!b.fits)return-1;if(!a.fits&&b.fits)return 1;if(a.fits&&b.fits){var c=e.__options.side.indexOf(a.side),d=e.__options.side.indexOf(b.side);return d>c?-1:c>d?1:"natural"==a.mode?-1:1}return"document"==a.container&&"bottom"==a.side&&"natural"==a.mode?-1:1}),d=g[0],d.coord={},d.side){case"left":case"right":d.coord.top=Math.floor(d.target-d.size.height/2);break;case"bottom":case"top":d.coord.left=Math.floor(d.target-d.size.width/2)}switch(d.side){case"left":d.coord.left=c.geo.origin.windowOffset.left-d.outerSize.width;break;case"right":d.coord.left=c.geo.origin.windowOffset.right+d.distance.horizontal;break;case"top":d.coord.top=c.geo.origin.windowOffset.top-d.outerSize.height;break;case"bottom":d.coord.top=c.geo.origin.windowOffset.bottom+d.distance.vertical}"window"==d.container?"top"==d.side||"bottom"==d.side?d.coord.left<0?c.geo.origin.windowOffset.right-this.__options.minIntersection>=0?d.coord.left=0:d.coord.left=c.geo.origin.windowOffset.right-this.__options.minIntersection-1:d.coord.left>c.geo.window.size.width-d.size.width&&(c.geo.origin.windowOffset.left+this.__options.minIntersection<=c.geo.window.size.width?d.coord.left=c.geo.window.size.width-d.size.width:d.coord.left=c.geo.origin.windowOffset.left+this.__options.minIntersection+1-d.size.width):d.coord.top<0?c.geo.origin.windowOffset.bottom-this.__options.minIntersection>=0?d.coord.top=0:d.coord.top=c.geo.origin.windowOffset.bottom-this.__options.minIntersection-1:d.coord.top>c.geo.window.size.height-d.size.height&&(c.geo.origin.windowOffset.top+this.__options.minIntersection<=c.geo.window.size.height?d.coord.top=c.geo.window.size.height-d.size.height:d.coord.top=c.geo.origin.windowOffset.top+this.__options.minIntersection+1-d.size.height):(d.coord.left>c.geo.window.size.width-d.size.width&&(d.coord.left=c.geo.window.size.width-d.size.width),d.coord.left<0&&(d.coord.left=0)),e.__sideChange(h,d.side),c.tooltipClone=h[0],c.tooltipParent=e.__instance.option("parent").parent[0],c.mode=d.mode,c.whole=d.whole,c.origin=e.__instance._$origin[0],c.tooltip=e.__instance._$tooltip[0],delete d.container,delete d.fits,delete d.mode,delete d.outerSize,delete d.whole,d.distance=d.distance.horizontal||d.distance.vertical;var l=a.extend(!0,{},d);if(e.__instance._trigger({edit:function(a){d=a},event:b,helper:c,position:l,type:"position"}),e.__options.functionPosition){var m=e.__options.functionPosition.call(e,e.__instance,c,l);m&&(d=m)}i.destroy();var n,o;"top"==d.side||"bottom"==d.side?(n={prop:"left",val:d.target-d.coord.left},o=d.size.width-this.__options.minIntersection):(n={prop:"top",val:d.target-d.coord.top},o=d.size.height-this.__options.minIntersection),n.val<this.__options.minIntersection?n.val=this.__options.minIntersection:n.val>o&&(n.val=o);var p;p=c.geo.origin.fixedLineage?c.geo.origin.windowOffset:{left:c.geo.origin.windowOffset.left+c.geo.window.scroll.left,top:c.geo.origin.windowOffset.top+c.geo.window.scroll.top},d.coord={left:p.left+(d.coord.left-c.geo.origin.windowOffset.left),top:p.top+(d.coord.top-c.geo.origin.windowOffset.top)},e.__sideChange(e.__instance._$tooltip,d.side),c.geo.origin.fixedLineage?e.__instance._$tooltip.css("position","fixed"):e.__instance._$tooltip.css("position",""),e.__instance._$tooltip.css({left:d.coord.left,top:d.coord.top,height:d.size.height,width:d.size.width}).find(".tooltipster-arrow").css({left:"",top:""}).css(n.prop,n.val),e.__instance._$tooltip.appendTo(e.__instance.option("parent")),e.__instance._trigger({type:"repositioned",event:b,position:d})},__sideChange:function(a,b){a.removeClass("tooltipster-bottom").removeClass("tooltipster-left").removeClass("tooltipster-right").removeClass("tooltipster-top").addClass("tooltipster-"+b)},__targetFind:function(a){var b={},c=this.__instance._$origin[0].getClientRects();if(c.length>1){var d=this.__instance._$origin.css("opacity");1==d&&(this.__instance._$origin.css("opacity",.99),c=this.__instance._$origin[0].getClientRects(),this.__instance._$origin.css("opacity",1))}if(c.length<2)b.top=Math.floor(a.geo.origin.windowOffset.left+a.geo.origin.size.width/2),b.bottom=b.top,b.left=Math.floor(a.geo.origin.windowOffset.top+a.geo.origin.size.height/2),b.right=b.left;else{var e=c[0];b.top=Math.floor(e.left+(e.right-e.left)/2),e=c.length>2?c[Math.ceil(c.length/2)-1]:c[0],b.right=Math.floor(e.top+(e.bottom-e.top)/2),e=c[c.length-1],b.bottom=Math.floor(e.left+(e.right-e.left)/2),e=c.length>2?c[Math.ceil((c.length+1)/2)-1]:c[c.length-1],b.left=Math.floor(e.top+(e.bottom-e.top)/2)}return b}}}),a});
/*!
 * jQuery UI Touch Punch 0.2.3
 *
 * Copyright 20112014, Dave Furfero
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Depends:
 *  jquery.ui.widget.js
 *  jquery.ui.mouse.js
 */

!function(a){function f(a,b){if(!(a.originalEvent.touches.length>1)){a.preventDefault();var c=a.originalEvent.changedTouches[0],d=document.createEvent("MouseEvents");d.initMouseEvent(b,!0,!0,window,1,c.screenX,c.screenY,c.clientX,c.clientY,!1,!1,!1,!1,0,null),a.target.dispatchEvent(d)}}if(a.support.touch="ontouchend"in document,a.support.touch){var e,b=a.ui.mouse.prototype,c=b._mouseInit,d=b._mouseDestroy;b._touchStart=function(a){var b=this;!e&&b._mouseCapture(a.originalEvent.changedTouches[0])&&(e=!0,b._touchMoved=!1,f(a,"mouseover"),f(a,"mousemove"),f(a,"mousedown"))},b._touchMove=function(a){e&&(this._touchMoved=!0,f(a,"mousemove"))},b._touchEnd=function(a){e&&(f(a,"mouseup"),f(a,"mouseout"),this._touchMoved||f(a,"click"),e=!1)},b._mouseInit=function(){var b=this;b.element.bind({touchstart:a.proxy(b,"_touchStart"),touchmove:a.proxy(b,"_touchMove"),touchend:a.proxy(b,"_touchEnd")}),c.call(b)},b._mouseDestroy=function(){var b=this;b.element.unbind({touchstart:a.proxy(b,"_touchStart"),touchmove:a.proxy(b,"_touchMove"),touchend:a.proxy(b,"_touchEnd")}),d.call(b)}}}(jQuery);
SA.require(['SA.loadJS', 'SA.Data.Cookies'], function (loadJS, cp) {

  'use strict';

  if (cp.get('user_limited') === '1') {
    loadJS([{ id: 'limited-user-auth-loader', src: 'https://static2.seekingalpha.com/assets/pkg/limited_user_auth-0ad03aa317fbfe65eea5ad3bae4fe8964c9d667ee23d4dbd989a59fe5f0d1b71.js' }]);
  }

}, 'limited-user-auth-loader');
(function(SA, $){

  var Time = SA.UsingNamespace("SA.Utils.Time");
  var TIME_ZONE = 'America/New_York',
    DATE_FORMAT = 'MM/DD/YYYY';

  //returns NewYork time, which is EST or EDT, depands on current date/time
  //Date object timeZone will be still local, so all the getUTC... won't make sense
  //if EST to EDT switching dates will change this should be updated

  Time.isMarketHours = function(){
    var newYorkTime = Time.getNewYorkTime();
    var newYorkHour = newYorkTime.getHours();
    var newYorkMinute = newYorkTime.getMinutes();
    if(newYorkHour < 17 && newYorkHour > 8){
      return true;
    } else if((newYorkHour == 8 && newYorkMinute >= 30) || (newYorkHour == 17 && newYorkMinute <= 30)) {
      return true;
    }
    return false;
  };

  Time.getNewYorkTime = function(){
    function moreEQ(ar, ar2){
      for (var i=0;i<ar.length;i++){
        if (ar[i]>ar2[i]) return true;
        if (ar[i]<ar2[i]) return false;
      }
      return true;
    }
    function between(ar, ar_min, ar_max){
      return moreEQ(ar, ar_min) && moreEQ(ar_max, ar);
    }
    var d = new Date();
    var offset = between([d.getUTCMonth()+1, d.getUTCDate(), d.getUTCHours()], [3,8,7], [11,2,5]) ? -4 : -5;
    d.setTime(d.getTime()+(offset+d.getTimezoneOffset()/60)*3600000);
    return d;
  };

  Time.getStringNiceTimeAgo = function(timestamp){
    var distance_in_minutes = parseInt(((new Date()).getTime()/1000 - timestamp)/60);
    if (distance_in_minutes == 0) return "Seconds ago";
    if (distance_in_minutes >= 1 && distance_in_minutes <= 59) return distance_in_minutes +" minute"+(distance_in_minutes > 1 ? "s" : "")+" ago";
    if (distance_in_minutes >= 60 &&  distance_in_minutes <= 1439) return parseInt(distance_in_minutes/60) +" hour"+(distance_in_minutes >= 120 ? "s" : "")+" ago";
    return Time.renderIncludeMonth(timestamp);
  };

  Time.renderIncludeMonth = function(timestamp){
    var month = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
    var publishTime = new Date(timestamp*1000);
    var theHour = publishTime.getHours();
    var ampm = 'am';
    if (theHour > 12) {
      theHour = theHour - 12;
      ampm = 'pm';
    } else if (theHour == 12){
      ampm = 'pm';
    } else if (theHour == 0){
      theHour = 12;
    }
    var theMinutes = publishTime.getMinutes();
    if (theMinutes < 10) {
      theMinutes = '0'+theMinutes;
    }
    var theTime = theHour+':'+theMinutes+ampm;
    return month[publishTime.getMonth()]+ " " +publishTime.getDate()+", "+publishTime.getFullYear();
  };
})(window.SA, window.jQuery);





















(function (w, doc, SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Utils');

  scope.SidePortfolio = new function () {

    var
      _this = this,
      elements = {
        $portfolioRail: $('#portfolio-rail'),
        $portfolioTitle: $('.portfolio-title')
      },
      doResize,
      isSaving = false,
      addSlugs,
      addedAlerts = 'rta_articles,rta_market_currents,filings,trading_rta',
      fullNames = {},
      tagAlerts = {},
      slugPrefix = 'sp_slug_',
      renamePopup,
      CURRENT_PORTFOLIO = 'current_selected_portfolio',
      useNewDesign,
      defaultPortfolioType = 'portfolio_page',
      portfolioType = elements.$portfolioRail.length ? elements.$portfolioRail.data('type') : defaultPortfolioType,
      portfolioSort,
      isMarketDay,
      slugs = [],
      cryptoSlugs,
      indicesSlugs,
      pendingSlugs,
      idle = false,
      showSortHeader,
      onChangePortfolioClb;

    var pageConfig = SA.pageConfig.Data,
      followCard = SA.Widgets.FollowCard,
      formatter = SA.Utils.Formatter,
      portfolioModel = SA.Models.PortfolioModel,
      symbolData = SA.Utils.SymbolData,
      o = SA.Utils.Observer,
      portfolioResizer,
      mone_params = {source: 'general', type: 'portfolio_unit'};

    this.isPortfolioPage = function () {
      return portfolioType === defaultPortfolioType;
    };

    this.widgetSelectors = {
      wrapper: '.side-portfolio-wrapper',
      innerUnit: '.inner-unit',
      sidePortfolio: '#side_portfolio',
      portfolioMain: '.portfolio-main',
      enableSlugSelectionClass: 'selectable'
    };

    this.init = function (opt) {
      // Chrome scroll bug, Jira 496. Remove this code once newer chrome version than 56 comes out
      if (navigator.userAgent.indexOf('Chrome/56') > -1) {
        $('.inner-unit').css('overflow-y', 'auto').css('overflow-x', 'hidden');
      }

      opt = opt || {};

      setSelectors(opt);

      useNewDesign = !!opt.useNewDesign;

      showSortHeader = !!opt.showSortHeader;

      mone_params = opt.mone;

      doResize = typeof (opt.doResize) === 'undefined' ? true : opt.doResize;

      _this.reInit(opt);
      cryptoSlugs = opt.cryptoSlugs || {};
      indicesSlugs = opt.indicesSlugs || {};
      pendingSlugs = opt.pendingSlugs || [];

      if ($.isFunction(opt.onChangePortfolioClb)) {
        onChangePortfolioClb = opt.onChangePortfolioClb;
      }

      $('#portfolio_delete_btn').html(w.JST['jst/portfolio/delete_btn']());

      initEvents();
      bindEditButtons();
    };

    this.reInit = function (opt) {
      setPortfolio(opt.portfolio_name);
      if (doResize && !portfolioResizer) {
        portfolioResizer = new SA.Pages.Account.Portfolio.Resizer({
          selectors: _this.widgetSelectors,
          $wrapper: _this.$containerWrapper
        });
      }

      _this.userSort = _this.userSort || opt.user_sort;
      _this.customSorts = $.type(opt.custom_sorts) === 'string' ? JSON.parse(_this.customSorts) : opt.custom_sorts;

      isMarketDay = opt.market_day.toString() === 'true';

      if (_this.portfolio.uriName) {

        // Creating the portfolio model (PortfolioModel.getPortfolio())
        var
          slugs = opt.slugs ? opt.slugs.split(',') : {},
          tags = opt.tag_ids ? opt.tag_ids.split(',') : {},
          iex_slugs = opt.iex_slugs ? opt.iex_slugs : {};

        portfolioModel.createPortfolioOfSlugsTags(opt.portfolio_name, slugs, tags, iex_slugs);
        fullNames = opt.tag_company_names || [];
        tagAlerts = opt.tag_alerts || [];
      }

      cryptoSlugs = opt.cryptoSlugs || {};
      indicesSlugs = opt.indicesSlugs || {};
      pendingSlugs = opt.pendingSlugs || [];

      portfolioSort = new SA.Utils.Portfolio.Sort({mone: mone_params});

      $('.side-portfolio').addClass('side-portfolio-style');

      var $addStock = $('#portfolio_news_unit');
      if (_this.portfolio.id === 'all_portfolios') {
        $addStock.hide();
      } else {
        $addStock.show();
      }

      initPortfolioSort();
    };

    function setSelectors(opt) {
      _this.$containerWrapper = $(opt.containerWrapper || _this.widgetSelectors.wrapper);
      _this.$sidePortfolio = $(opt.container || _this.widgetSelectors.sidePortfolio);

      elements.$portfolioSelectorContainer = $('.portfolio-selector-section');
      elements.$filters = $(opt.filtersContainer || '.portfolio-filters');
      elements.$addStockInput = $('#add_stock_inp');
      elements.$savePortfolioBtn = $('#save_portfolio_btn');
      elements.$showMoreLink = $('.show-more a');

      _this.$portfolioSelector = elements.$portfolioSelectorContainer.find('#portfolio_selector');
    }

    function setPortfolio(uriName) {
      var
        p = (uriName) ? uriName.split('-') : 'all_portfolios',
        id = (uriName) ? p[0] : 'all_portfolios',
        uuriName = uriName || 'all_portfolios',
        name = _this.$portfolioSelector.find('option[value="' + uuriName + '"]').html();

      _this.$portfolioSelector.closest('.portfolio_selector-dropdown').attr('title', name);

      _this.portfolio = {
        id: id,
        name: name,
        uriName: uriName
      };
    }

    function initPortfolioSort() {
      if (!SA.Data.Cookies.get('portfolio_sort_type')) {
        SA.Data.Cookies.set('portfolio_sort_type', 'a_z');
      }

      updateUserExtraData();

      elements.$portfolioRail.find('.svg-sa-loader').remove();
      _this.$containerWrapper.find('.svg-sa-loader').remove();
      $('#side_portfolio, #portfolio_unit').removeClass('hidden');

      fillStocks();

      if (!_this.isPortfolioPage()) {
        _this.$sidePortfolio.sortable({
          axis: 'y',
          containment: '.draggable-container',
          tolerance: "pointer",
          zIndex: 9999,
          update: updateCustomSort
        });
        _this.$sidePortfolio.sortable('disable');
      }
      // IMPORTANT: THIS EVENT MUST FIRE ONLY AFTER PORTFOLIO VISIBLE
      o.publish('portfolio_side/render');
    }

    function updateUserExtraData() {
      if (!_this.userSort) {
        portfolioSort.setSortOption(SA.Data.Cookies.get('portfolio_sort_type').replace('-', '_'));
      }
    }

    function updateCustomSort(event, ui) {
      _this.customSortUpdated = true;
      _this.currentSort = 'custom';
      portfolioSort.setSortOption(_this.currentSort);

      if ($('.tooltipstered').length) {
        $('#portfolio_edit_large_btn').tooltipster('destroy');
      }

      SA.Logger.Mone.event(mone_params.type, mone_params.source, 'sort', {
        data: {
          portfolio_id: _this.portfolio.id,
          sort_type: 'custom',
          custom_order: 'true'
        }
      });

      portfolioSort.updateCustomSort();
    }

    function initEvents() {
      SA.Utils.Autocomplete(elements.$addStockInput, {
        symbols: true,
        pages: false,
        resultsLimit: 5,
        multiple: true,
        symbolSelectCallback: _this.addSymbolToInput
      });

      _this.$portfolioSelector.on('focus', function () {
        _this.$portfolioSelector.data('previous', this.value);
      }).on('change', changePortfolio);

      _this.$containerWrapper.on('click', _this.widgetSelectors.sidePortfolio + '.selectable li .left a', function (e) {
        e.stopPropagation();
      }).on('click', _this.widgetSelectors.sidePortfolio + ' li:not(.selected)', function () {
        if (!_this.deletedSlug) {
          _this.filters.add($(this));
        }
      }).on('click', 'li.selected', function () {
        _this.filters.remove(_this.filters.actions.remove, [$(this).data('name')], true);
      }).on(_this.filters.actions.clearTickers.event, _this.filters.clearTickers);

      elements.$filters.on('click', '.ticker a', function (e) {
        e.preventDefault();
        _this.filters.remove(_this.filters.actions.removeTop, [$(this).parent().data('name')], true);
      });

      if (doResize) {
        $(w).bind('resize scroll', portfolioResizer.resize).ready(function () {
          _this.$containerWrapper.removeClass('hide');
          portfolioResizer.resize();
        });
      }

      $('#portfolio_unit').on('click', '.inner-unit .del-btn', function (event) {
        _this.deletedSlug = $(event.target).closest('li').find('a').text();

        var wasAlert = SA.Data.User.getRTASymbols().indexOf(_this.deletedSlug) !== -1;

        SA.Logger.Mone.event(mone_params.type, mone_params.source, 'ticker_removed', {
          data: {
            'symbol': _this.deletedSlug,
            'alerts': wasAlert,
            'portfolio_id': _this.portfolio.id
          }
        });

        portfolioModel.removeSymbols({
          slugs: [_this.deletedSlug],
          tagIds: [$(this).data('id')],
          onComplete: _this.stockRemoved
        });
      }).on('click', '.alerts input[type="checkbox"]', function (e) {
        var $elem = $(e.currentTarget),
          tag = $elem.data('id'),
          checked = $elem.is(':checked'),
          method,
          action;

        if (checked) {
          $elem.attr('checked', 'checked');
          method = SA.Models.SubscriptionModel.subscribe;
          action = 'subscribed';
        } else {
          $elem.removeAttr('checked');
          method = SA.Models.SubscriptionModel.unsubscribe;
          action = 'unsubscribed';
        }

        method({
          tagIds: tag,
          modes: "rta_articles,rta_market_currents,filings,trading_rta"
        });
        SA.Logger.Mone.event(mone_params.type, mone_params.source, action, {data: {symbol: tag}});

        tagAlerts[tag] = checked;
      });

      $('.add-stock form').on('submit', function () {
        SA.Utils.SidePortfolio.addStockToPortfolio();
        return false;
      });

      initDeletePopupEvents();
      initIdleTab();

      if (pageConfig.isModelPortfolio) {
        initModelFundPortfolioEvents();
      }
    }

    function initModelFundPortfolioEvents() {
      elements.$savePortfolioBtn.click(savePortfolioDo);
      elements.$showMoreLink.click(showMoreDo);

      SA.Logger.Mone.event(mone_params.type, mone_params.source, 'shown', {
        data: {
          portfolio_name: pageConfig.portfolio.portfolioName
        }
      });
    }

    function savePortfolioDo() {
      if (!isSaving) {
        var portfolio = pageConfig.portfolio,
          opt = {
            is_model_portfolio: true,
            portfolio_id: portfolio.portfolioId,
            name: portfolio.portfolioName,
            stocks: portfolio.slugs.toUpperCase().split(','),
            source: 'portfolio_unit',
            callback: {
              always: function () {
                isSaving = false;
              }
            }
          };

        isSaving = true;
        portfolioModel.createPortfolio($.extend(opt, {
          callback: {
            done: function (res) {
              if (res.errors) {
                w.alert(res.errors);
              } else {
                isSaving = true;
                SA.Logger.Mone.event(mone_params.type, mone_params.source, 'model_portfolio_added', {
                  data: {
                    symbols: opt.stocks,
                    portfolio_name: opt.name
                  }
                }).done(function () {
                  location.reload(res.redirect_to_uri);
                }).always(opt.callback.always);
              }
            }
          }
        }));
      }
    }

    function showMoreDo(e) {
      $('.model-portfolio-description').removeClass('short');
      $(e.currentTarget).remove();
    }

    function initIdleTab() {
      doc.addEventListener('visibilitychange', handleVisibilityChange, false);
    }

    function handleVisibilityChange() {
      idle = !!doc.hidden;
      if (!idle) {
        updateAllPrices();
      }
    }

    function updateAllPrices() {
      if (isMarketDay && SA.Utils.Time.isMarketHours() && !idle) {
        symbolData.removeAllScripts();

        addPrices(slugs);
      }
    }

    this.addStockToPortfolio = function () {
      addSlugs = elements.$addStockInput.val();

      if (addSlugs) {
        _this.hideAutoComplete();
        addStockDisable(true);
        slugs = slugs.concat(addSlugs.toLowerCase().split(','));
        portfolioModel.addSymbols({
          symbols: addSlugs,
          onComplete: _this.stocksAdded,
          onFailed: _this.problemsEvent,
          alerts: addedAlerts
        });
        clearStockInput();
        addStockCustomSort();
      }
    };

    function addStockCustomSort(slug) {
      if (portfolioSort) {
        var slugToAdd = slug || addSlugs.toLowerCase();
        var customSort = _this.customSorts[_this.portfolio.id];
        if (customSort) {
          customSort = customSort.split(',');
          slugToAdd = slugToAdd.replace(/ /g, '').split(',');
          var stocks = customSort.concat($(slugToAdd).not(customSort).get());

          portfolioSort.updateCustomSort(stocks.join(','), function (d) {
            if (_this.userSort === 'custom') {
              portfolioSort.sortElements(stocks);
            }
          });
        }
      }
    }

    var clearStockInput = function () {
      elements.$addStockInput.data('current', null);
    };

    this.hideAutoComplete = function () {
      $('#add_stock_inp_sa_autocomplete').hide();
    };

    this.stocksAdded = function (options, res) {
      options = options || {};

      var diff = _this.updatePortfolioElementsAdded(res),
        portfolio = res.portfolio;

      addStockDisable(false);

      if (diff.added.length) {
        $.each(diff.added, function (index, ticker) {
          SA.Logger.Mone.event(mone_params.type, mone_params.source, 'ticker_added', {
            data: {
              'symbol': ticker.slug,
              'alerts': res.rta_checked,
              'portfolio_id': _this.portfolio.id
            }
          });
        });

        if (!options.preventPopup) {
          _this.showAlertsPopup(diff.added, portfolio, res.rta_checked);
        }

        o.publish('user/portfolio/stocks/update', {
          diff: diff,
          slugs: portfolioModel.getSlugs()
        });

        if (SA.Pages && SA.Pages.PortfolioCalendar) {
          updatePortfolioCalendar(diff);
        }

        var $recUnit = $('.rec-unit');
        if ($recUnit.length) {
          $.each(diff.added, function () {
            $('#rec_slug_' + this.slug).remove();
          });

          if (!$('.rec-tickers>li').length) {
            $recUnit.remove();
          }
        }
      }

      elements.$addStockInput.val('').focus();

      if (_this.editMode) {
        $('.drag-element').addClass('shown');
      }

      SA.Widgets.Button.FollowTicker.follow(portfolio, diff.added);
    };

    this.updatePortfolioElementsAdded = function (res) {
      return updatePortfolioElements('added', res);
    };

    this.updatePortfolioElementsRemoved = function () {
      return updatePortfolioElements('removed');
    };

    function findCompName(res, slug) {
      var name = '';
      $.each(res.portfolio_stocks, function (id, stock) {
        if (stock.slug === slug) {
          name = stock.company_name;
          return false;
        }
      });
      return name;
    }

    function updatePortfolioElements(type, res) {
      res = res || {};

      var diff = portfolioModel.getDiff(),
        data = diff[type];

      if (_this.$sidePortfolio && data.length) {
        if (type === 'added') {
          if (res.cryptoSlugs) {
            cryptoSlugs = res.cryptoSlugs;
          }
          if (res.indicesSlugs) {
            indicesSlugs = res.indicesSlugs;
          }
          var priceSlugs = [];
          $.each(data, function (q, cq) {
            priceSlugs.push(cq.slug);
            insertElement($(buildStockElm(cq.slug, findCompName(res, cq.slug), cq.tag)));
          });
          addPrices(priceSlugs, true);
        }

        if (type === 'removed') {
          $.each(data, function (i, slug) {
            $('#' + slugPrefix + slug.replace(/\./gi, '_')).remove();
          });
        }
      }

      return diff;
    }

    function updatePortfolioCalendar(diff) {
      SA.Pages.PortfolioCalendar.addTicker(diff.added);
    }

    this.showAlertsPopup = function (tickers, portfolio, rtaChecked) {

      followCard.show({
        $hoverElement: elements.$addStockInput,
        object: new followCard.Symbol($.map(tickers, function (t) {
          return t.slug;
        }), portfolio),
        rtaChecked: rtaChecked,
        cssClasses: ['left-portfolio'],
        onRemoveSuccess: _this.stockRemoved,
        onRtaCheck: function (checked) {
          //update the alerts checkbox in the unit when the value is changed in the popup
          $.each(this.object.tags, function (k, v) {
            $('[data-id="' + v + '"]')[0].checked = checked;
          });
        }
      });

      $.each(tickers, function (k, v) {
        $('[data-id="' + v.slug + '"]').attr('checked', rtaChecked);
      });

      SA.Logger.Mone.event(mone_params.type, mone_params.source, 'get_alerts_tooltip_shown');
    };

    this.stockRemoved = function (portfolios) {
      var diff = _this.updatePortfolioElementsRemoved();

      o.publish('user/portfolio/stocks/update', {
        diff: diff,
        slugs: portfolioModel.getSlugs()
      });

      if (SA.Pages && SA.Pages.PortfolioCalendar) {
        SA.Pages.PortfolioCalendar.remTicker(diff.removed);
      }

      _this.deletedSlug = null;

      SA.Widgets.Button.FollowTicker.unfollow(portfolios, diff.removed);
    };

    this.problemsEvent = function () {
      addStockDisable(false);
    };

    function changePortfolio(e) {
      var $select = $(e.currentTarget),
        $option = $select.find('option[value="' + $select.val() + '"]'),
        selectedId = $option.val(),
        parsedSelectedId = selectedId;

      if (selectedId !== 'new' && selectedId !== 'all_portfolios') {
        parsedSelectedId = parseInt(selectedId);
      }

      if (selectedId === 'new') {
        $select.val($select.data('previous'));
        SA.Logger.Mone.event(mone_params.type, mone_params.source, 'portfolio_added');
        doc.location = '/account/create_portfolio';
      } else {
        if ($.isFunction(onChangePortfolioClb)) {
          _this.$sidePortfolio.find('li').remove();

          onChangePortfolioClb({
            id: parsedSelectedId,
            name: $option.html(),
            uriName: $option.val(),
            sort: portfolioSort
          });
        } else {
          SA.Data.Cache.set(CURRENT_PORTFOLIO, selectedId);
          doc.location = ('?pu=' + selectedId);
        }
      }
    }

    this.addSymbolToInput = function (slug) {
      var inputValues = elements.$addStockInput.val().split(',');
      if (inputValues.length > 1) {
        inputValues.pop();
        elements.$addStockInput.val(inputValues.join(',') + ',' + slug);
      } else {
        elements.$addStockInput.val(slug);
      }

      _this.addStockToPortfolio();
    };

    this.getModel = function () {
      return portfolioModel;
    };

    this.attachCurrentPrice = function (slug, quote, slugPrefix) {
      var slugElm = $('#' + slugPrefix + slug.replace(/\./gi, '_')),
        price = quote.Last;
      if (slugElm.length && price !== slugElm.find('.price').data('last-price')) {
        var $price = slugElm.find('.price');
        slugElm.attr({price: price, change: quote.PercentChange, volume: quote.Volume});
        if ($price.data('last-price') && _this.isPortfolioPage()) {
          var pClass = (parseFloat(price) > parseFloat(slugElm.find('.price').data('last-price'))) ? 'up' : 'down';
          slugElm.find('.price').addClass(pClass);
          setTimeout(function () {
            slugElm.find('.price').removeClass(pClass);
          }, 5000);
        }

        var priceOpt = {decimalPositions: {max: 4, min: 2}, forceK: $('#portfolio-rail').length},
          changeOpt = {decimalPositions: {max: 4, min: 2}}, percentageOpt,
          qClass = (quote.PercentChange > 0) ? 'up' : (quote.PercentChange < 0) ? 'down' : 'zero';

        if (useNewDesign) {
          if (price > 999.99 && price < 10000) {
            priceOpt.forceK = false;
          } else {
            priceOpt.limit = 6;
          }
          changeOpt.limit = 5;
          percentageOpt = {limit: 6, suffix: '%'};
        } else {
          percentageOpt = {prefix: '(', suffix: '%)'};
        }

        $price.html(formatter.number(price, priceOpt)).data('last-price', price);
        slugElm.find('.change').html(formatter.number(quote.Change, changeOpt));
        slugElm.find('.percentage').html(formatter.number(quote.PercentChange, percentageOpt));
        slugElm.find('.change, .percentage').removeClass('up down').addClass(qClass);
      }
    };

    function addStockDisable(disable) {
      if (elements.$addStockInput) {
        elements.$addStockInput.prop('disabled', disable);
      }
    }

    function fillStocks() {
      var portfolio = portfolioModel.getPortfolio();

      if (portfolio.stocksCount()) {
        var sa_slugs;

        sa_slugs = Object.keys(portfolio.stocks);

        if (showSortHeader && sa_slugs.length) {

          var
            $unit = $('#portfolio_news_unit'),
            header_exists = $unit.next('div.side-portfolio-header').length;

          if (!header_exists) {
            var unit_header = w.JST['jst/portfolio/side_slug_header'];

            if ($unit.length === 1) {
              $unit.after(unit_header);
            } else {
              $('.inner-unit').before(unit_header);
            }
          }
        }

        $.each(sa_slugs, function () {
          _this.$sidePortfolio.append(buildStockElm(this, fullNames[this], portfolio.stocks[this], tagAlerts[this]));
        });

        if (doResize) {
          portfolioResizer.resize();
        }

        addPrices(sa_slugs, true);
      } else {
        _this.$sidePortfolio.addClass('empty');
      }
    }

    function bindEditButtons() {
      var divButtons = $('#side_portfolio_edit_btn');

      if (divButtons.find('.rename, .delete, .edit, .done').length === 4) {
        divButtons.find('.rename').click(showRename);
        divButtons.find('.delete').click(showDelete);
        divButtons.find('.edit').click(showEdit);
        divButtons.find('.done').click(doneEdit);
      }

      if (useNewDesign) {
        $('#portfolio_edit_large_btn').click(showEdit);
        $('#portfolio_save_large_btn').click(doneEdit);
        $('#portfolio_delete_btn').click(showDelete);
      }
    }

    function insertElement($newElm) {

      var elms = _this.$sidePortfolio.children();
      var pos = 0;

      if (elms.length > 0) {
        while (elms[pos] && $newElm.attr('id') > $(elms[pos]).attr('id')) {
          pos++;
        }
      }

      if (pos === elms.length) {
        _this.$sidePortfolio.append($newElm);
      } else {
        $newElm.insertBefore(elms[pos]);
      }
    }

    function attachPrices(quotes, shouldSort) {
      $.map(quotes, function (cq, q) {
        _this.attachCurrentPrice(q, cq, slugPrefix);
      });

      if (shouldSort && portfolioSort) {
        portfolioSort.sort();
      }
    }

    function addSQPrices(slugs, shouldSort) {
      if (slugs.length) {
        symbolData.getFromSuperQuotes(slugs, function (quotes) {
          attachPrices(quotes, shouldSort);
        });
      }
    }

    function addIndicesPrices(slugs, shouldSort) {
      if (slugs.length) {
        symbolData.getCachedRealTimeIndices(slugs, function (res) {
          var quotes = {};
          $.each(res, function (_, item) {
            quotes[item.Index.Symbol.toLowerCase()] = {
              Last: item.Value.Last,
              Change: item.Value.ChangeFromPreviousClose,
              PercentChange: item.Value.PercentChangeFromPreviousClose,
              Volume: item.Value.Volume
            }
          });

          attachPrices(quotes, shouldSort);
        });
      }
    }

    function addCryptoPrices(slugs, shouldSort) {
      if (slugs.length) {
        var cryptoToSQFields = {
          PRICE: 'Last',
          CHANGE24HOUR: 'Change',
          CHANGEPCT24HOUR: 'PercentChange',
          TOTALVOLUME24H: 'Volume'
        };

        for (var i = 0; i < slugs.length; i++) {
          slugs[i] = slugs[i].split('-')[0].toUpperCase();
        }

        SA.Utils.cryptoAPI.priceMultiFull(slugs, ['USD']).then(function (res) {
          var quotes = {};
          $.each(res.RAW, function (q, data) {
            var quote = {};
            q = q.toLowerCase() + '-usd';
            $.each(cryptoToSQFields, function (src, dest) {
              quote[dest] = data.USD[src];
            });
            quotes[q] = quote;
          });

          attachPrices(quotes, shouldSort);
        });
      }
    }

    function addPrices(sa_slugs, shouldSort) {
      slugs = sa_slugs.filter(function(slug) {
        return !pendingSlugs.includes(slug);
      });
      if (slugs.length) {
        var normal = [], crypto = [], indices = [], i, slug;
        for (i = 0; i < slugs.length; i++) {
          slug = slugs[i];
           if (cryptoSlugs[slug]) {
            crypto.push(slug);
          } else if (indicesSlugs[slug]) {
            indices.push(indicesSlugs[slug]);
          } else {
            if (SA.pageConfig.useSQuoteSource === 'iex') {
              var iex_slugs = portfolioModel.getPortfolio().sa_iex;
              slug = iex_slugs[slug] || slug;
            }
            normal.push(slug);
          }
        }

        addSQPrices(normal, shouldSort);
        addCryptoPrices(crypto, shouldSort);
        addIndicesPrices(indices, shouldSort);
      }
    }

    function buildStockElm(slug, title, tagId, alerts) {
      var opt = {
        slug: slug,
        name: slug,
        title: title,
        slug_alerts: (alerts) ? 'checked' : '',
        tag_id: tagId,
        dragEl: w.JST['jst/portfolio/drag']()
      };
      return w.JST['jst/portfolio/side_slug'](opt);
    }

    // Rename portfolio
    function showRename() {
      if (!renamePopup) {
        renamePopup = $(getRenamePopUp(_this.portfolio.name));
        $('#side_portfolio_edit_btn').append(renamePopup);
        renamePopupEvents();
      }
      renamePopup.show();

      // Outside click
      $(doc).one('mouseup', function (e) {
        if (!renamePopup.is(e.target) && !renamePopup.has(e.target).length) {
          renamePopupHide();
        }
      });
    }

    function getRenamePopUp(p_name) {
      return w.JST['jst/portfolio/rename_popup']({p_name: p_name});
    }

    function renamePopupEvents() {
      renamePopup.find('#p_name_pop').load($('#p_name_pop').select());
      renamePopup.find('.get-alerts').click(function () {
        portfolioModel.renamePortfolio($('#p_name_pop').val(), _this.portfolio.uriName, _this.portfolioRenamed);
        //show loading img only if there is no error in error div
        if ($('#p_name_error').text() === ' ') {
          renamePopup.find('.loader').show();
        }
      });

      renamePopup.find('.no-thanks').click(renamePopupHide);
    }

    this.portfolioRenamed = function (res) {
      var title, name;

      if (useNewDesign) {
        title = $('#portfolio_name').val();
        name = title;
      } else {
        title = $('#p_name_pop').val();
        name = ellipsePortfolioName(title, 43);
        renamePopupHide();
      }

      var elem = getSelectedPortfolioByUid(_this.portfolio.id);
      elem.text(name).attr('title', title).attr('value', res.uri_name);
      $('.portfolio_selector-dropdown').attr('title', title);

      _this.portfolio.name = title;

      o.publish('user/portfolio/rename', {portfolio_id: _this.portfolio.id, to: title});
    };

    function renamePopupHide() {
      renamePopup.hide();
    }

    function ellipsePortfolioName(text, maxLength) {
      return (text && text.length > maxLength) ? text.substr(0, maxLength - 3) + '...' : text;
    }

    // Delete portfolio
    function showDeleteDo() {
      var popoverConfig = {
        placement: 'bottom',
        trigger: 'manual',
        html: true,
        template: '<div class="popover delete-portfolio-popover"><div class="arrow"></div><div class="popover-inner"><h3 class="popover-title"></h3><div class="popover-content"><p></p></div></div></div>',
        content: getDeletePopUp(_this.portfolio.name, _this.portfolio.uriName)
      };

      elements.$portfolioSelectorContainer.popover(popoverConfig);
      elements.$portfolioSelectorContainer.popover('show');
    }

    function showDelete() {
      if (SA.Data.User.isLimited()) {
        SA.Widgets.LimitedUserAuth.show({
          moneSource: 'delete_portfolio',
          moneData: {portfolio_id: pageConfig.portfolio.portfolioId},
          onLoginSuccess: showDeleteDo
        });
      } else {
        showDeleteDo();
      }
    }

    function showEditCustomSortAbTest() {
      _this.customSortUpdated = false;
      _this.currentSort = portfolioSort.getSortOption();

      if (_this.currentSort === 'custom') {
        var sort = _this.customSorts[_this.portfolio.id];
        if (sort) {
          portfolioSort.sortElements(sort.split(','));
        }
      }

      if (!_this.isPortfolioPage()) {
        $('.drag-element').addClass('shown');
        _this.$sidePortfolio.sortable('enable');
      }
    }

    // Edit portfolio
    function showEdit() {
      showEditCustomSortAbTest();

      _this.editMode = true;

      if (_this.$sidePortfolio.length) {
        if (_this.$sidePortfolio.hasClass('selectable')) {
          _this.$sidePortfolio.data('selectable', 'true').removeClass('selectable');
        }

        $('#portfolio_unit').addClass('editable');

        $('#side_portfolio_edit_btn').removeClass('off').addClass('on');

        if (useNewDesign) {
          toggleNewDesignElements(false);
        }
      }
    }

    function doneEdit() {
      doneEditCustomSortAbTest();

      _this.editMode = false;

      if (_this.$sidePortfolio.length) {
        if (_this.$sidePortfolio.data('selectable')) {
          _this.$sidePortfolio.addClass('selectable');
        }

        $('#portfolio_unit').removeClass('editable');

        $('#side_portfolio_edit_btn').removeClass('on').addClass('off');

        if (useNewDesign) {
          toggleNewDesignElements(true);
        }
      }
    }

    function doneEditCustomSortAbTest() {
      if (_this.currentSort === _this.userSort) {
        portfolioSort.sort();
      }

      if (!_this.isPortfolioPage()) {
        $('.drag-element').removeClass('shown');
        _this.$sidePortfolio.sortable('disable');
      }
    }

    function toggleNewDesignElements(doneEdit) {
      var $nonEditable = $('#portfolio_edit_large_btn, #portfolio_sort'),
        $editable = $('#portfolio_save_large_btn, #portfolio_delete_btn'),
        $selectedPortfolio = getSelectedPortfolioNew(),
        $portfolioName = $('#portfolio_name');

      if (doneEdit) {
        $nonEditable.removeClass('hidden');
        _this.$portfolioSelector.removeClass('hidden');
        $editable.addClass('hidden');
        $portfolioName.addClass('hidden');
        $('.portfolio-selector-section').removeClass('editable');

        if ($portfolioName.val() !== $selectedPortfolio.html()) {
          portfolioModel.renamePortfolio($portfolioName.val(), $selectedPortfolio.val(), _this.portfolioRenamed);
        }
      } else {
        $nonEditable.addClass('hidden');
        _this.$portfolioSelector.addClass('hidden');
        $editable.removeClass('hidden');
        $portfolioName.removeClass('hidden').val(getSelectedPortfolioNew().html());
      }
    }

    function getSelectedPortfolioNew() {
      var selected = portfolioModel.getPortfolio().name;
      return _this.$portfolioSelector.find('option[value="' + selected + '"]');
    }


    function getSelectedPortfolioByUid(id) {
      return _this.$portfolioSelector.find('option[uid="' + id + '"]');
    }

    // Delete portfolio by portfolio name
    function getDeletePopUp(p_name) {
      return w.JST['jst/portfolio/delete_popup']({p_name: p_name});
    }

    function initDeletePopupEvents() {
      var deleting = false;
      $(doc).on('click', '#delete-portfolio', function () {
        if (deleting) {
          return;
        }

        deleting = true; // only lock without unlock as reload comes after success
        var action = _this.isPortfolioPage() ? 'removed' : 'portfolio_removed';
        SA.Logger.Mone.event(mone_params.type, mone_params.source, action, {data: {'portfolio_id': _this.portfolio.id}});
        portfolioModel.deletePortfolio(_this.portfolio.uriName, _this.portfolioDeleted);
      });

      $(doc).on('click', '#delete-no-thanks', function () {
        SA.Logger.Mone.event(mone_params.type, mone_params.source, 'remove_cancel', {data: {'portfolio_id': _this.portfolio.id}});
        elements.$portfolioSelectorContainer.popover('hide');
      });
    }

    this.portfolioDeleted = function () {
      elements.$portfolioSelectorContainer.popover('hide');
      doc.location.reload();
    };

    this.filters = {
      actions: {
        add: {event: 'portfolioTickerAdd', bi: {source: 'my_feed_portfolio_unit', action: 'filter_on'}},
        replace: {event: 'portfolioTickerReplace', bi: {source: 'my_feed_portfolio_unit', action: 'filter_off'}},
        remove: {event: 'portfolioTickerRemove', bi: {source: 'my_feed_portfolio_unit', action: 'filter_off'}},
        removeTop: {event: 'portfolioTickerRemove', bi: {source: 'my_feed_top', action: 'filter_off'}},
        clearTickers: {event: 'clearPortfolioTickers'}
      },
      enableSlugsSelection: function () {
        $(_this.widgetSelectors.sidePortfolio).addClass(_this.widgetSelectors.enableSlugSelectionClass);
      },
      add: function ($ticker, allowMultipleSelection) {
        if ($(_this.widgetSelectors.sidePortfolio).hasClass(_this.widgetSelectors.enableSlugSelectionClass)) {
          var slug = $ticker.data('name');

          if (!allowMultipleSelection && elements.$filters.data('slugs')) {
            var slugToRemove;
            if (elements.$filters.data('slugs').indexOf(slug) > -1) {
              slugToRemove = slug;
            } else if (elements.$filters.data('slugs')) {
              slugToRemove = elements.$filters.data('slugs').split(';')[0];
            }

            if (slugToRemove) {
              this.remove(this.actions.remove, [slugToRemove], false);
            }
          }

          if (allowMultipleSelection || !elements.$filters.data('slugs')) {
            elements.$filters.data('slugs', slug + ';');
            $ticker.addClass('selected');
            elements.$portfolioTitle.addClass('hide');
            elements.$filters.append('<div class="ticker ' + slug + '" data-name="' + slug + '">' + slug + '<a href="#"></a></div>').removeClass('hide');

            _this.$sidePortfolio.find('.updates-notification').remove();

            this.trigger(this.actions.add);

            this.log(this.actions.add, [slug]);
          }
        }
      },
      remove: function (action, tickers, triggerEvent) {
        if ($(_this.widgetSelectors.sidePortfolio).hasClass(_this.widgetSelectors.enableSlugSelectionClass)) {
          if (tickers) {
            var index;
            for (index = 0; index < tickers.length; index++) {
              var ticker = tickers[index];
              if (elements.$filters.data('slugs').indexOf(ticker) > -1) {
                elements.$filters.data('slugs', elements.$filters.data('slugs').replace(ticker + ';', ''));
                _this.$sidePortfolio.find('#sp_slug_' + ticker).removeClass('selected');

                elements.$filters.find('.ticker.' + ticker).remove();
              }
            }

            if (index && triggerEvent) {
              this.trigger(action);
            }

            if (!elements.$filters.data('slugs')) {
              elements.$portfolioTitle.removeClass('hide');
              elements.$filters.addClass('hide');
            }

            this.log(action, tickers);
          }
        }
      },
      clearTickers: function () {
        if ($(_this.widgetSelectors.sidePortfolio).hasClass(_this.widgetSelectors.enableSlugSelectionClass)) {
          var tickers = [];
          _this.$containerWrapper.find(_this.widgetSelectors.sidePortfolio + ' li.selected').each(function () {
            tickers.push($(this).data('name'));
          });

          if (tickers.length) {
            _this.filters.remove(this.actions.remove, tickers, true);
          }
        }
      },
      trigger: function (action) {
        if ($(_this.widgetSelectors.sidePortfolio).hasClass(_this.widgetSelectors.enableSlugSelectionClass)) {
          if (action) {
            var slugs = elements.$filters.data('slugs').replace(/sp_slug_/i, '').split(';');
            slugs = slugs.filter(function (n) {
              return n !== '';
            });
            elements.$filters.trigger(action.event, [slugs]);
            $(w).scrollTop(0);
          }
        }
      },
      log: function (action, slugs) {
        SA.Logger.Mone.event(mone_params.type, mone_params.source, {
          data: {
            'filter': 'symbol',
            'symbol': slugs.join(','),
            biSource: action.bi.source,
            biAction: action.bi.action
          }
        });
      }
    };
  };

}(window, window.document, window.SA, window.jQuery));




(function (w, SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Utils.Portfolio');
  scope.External = function (opt) {

    var pageData = SA.pageConfig.Data || {},
      portfolio,
      portfolioSide = SA.Utils.SidePortfolio,
      portfolioSort,
      $win = $(w),
      $container,
      $sidePortfolioWrapper,
      mainNavWrapperRowHeight = $('header#sa-hd #main-nav-wrapper-row').outerHeight() + 10,
      portfolioSelectorSectionHeight,
      portfolioNewsUnitHeight,
      newsArticlesHeight,
      MONE_PARAMS = {source:'article_left_rail', type:'portfolio_unit'};

    function getUnit() {
      $.get('/account/ajax_get_sidebar_portfolio', {pu: portfolio.id}).done(createPortfolioUnit).fail(opt.onFailure);
    }

    function createPortfolioUnit(res) {
      if (res.status === 'success' && (!pageData.article || (!pageData.article.isInsight && !pageData.article.isFidelityEducationPage && !pageData.article.isSponsored))) {
        var data = formatData(res);
        portfolio.name = data.portfolio_name;

        unitCreate(data.html);
        portfolioSide.init(data);
        initVariables();
        bindEvents();
        onWindowResize();

        if (portfolio.id) {
          SA.Logger.Mone.event(MONE_PARAMS.type, MONE_PARAMS.source, 'switch_portfolio', {
            data: {
              'portfolio_id': portfolio.id,
              'portfolio_scroll': SA.Utils.Scroll.elementHasScroll($('.inner-unit'))
            }
          });
        } else if (!sendLeftPortfolioShowEvent()) {
          SA.Utils.Scroll.add(scrollToPortfolioLeft);
        }
      }
    }

    function formatData(res) {
      return {
        user_sort: res.extra_data.sort,
        custom_sorts: res.extra_data.custom_sorts,
        portfolioId: res.extra_data.portfolio_id,
        portfolio_name: res.extra_data.portfolio_name,
        slugs: res.extra_data.slugs,
        tag_ids: res.extra_data.tag_ids,
        cryptoSlugs: res.extra_data.cryptoSlugs,
        indicesSlugs: res.extra_data.indicesSlugs,
        pendingSlugs: res.extra_data.pendingSlugs,
        market_day: res.extra_data.market_day,
        tag_company_names: JSON.parse(res.extra_data.tag_company_names),
        doResize: false,
        useNewDesign: true,
        add_stock_btn: $('#search_btn'),
        html: res.html,
        mone: MONE_PARAMS,
        onChangePortfolioClb: function (portfolio) {
          var $portfolioElem = $('#portfolio-rail').find('.sticky-wrapper');

          $portfolioElem.remove();

          SA.Utils.Portfolio.External({
            portfolioSort: portfolio.sort,
            portfolio: {
              id: portfolio.id,
              name: portfolio.name,
              style: {
                wrapper: $portfolioElem.attr('style'),
                mainPortfolio: $portfolioElem.find('.side-portfolio-wrapper.portfolio-main').attr('style')
              }
            }
          });
        }
      };
    }

    function unitCreate(html) {
      var style = portfolio.style || {};

      $sidePortfolioWrapper = $('<div></div>', {
        'class': 'side-portfolio-wrapper portfolio-main',
        style: style.mainPortfolio,
        html: html
      });

      $container.append($sidePortfolioWrapper).addClass('portfolio-redesign').attr('style', style.wrapper);
      $container.find('#side_portfolio_edit_btn').remove();
      $container.find('#portfolio_edit_large_btn, .input-container .inline-svg').removeClass('hidden');

      $sidePortfolioWrapper.sticky({bottomSpacing: 400});
    }

    function initVariables() {
      portfolioSelectorSectionHeight = portfolioSide.$containerWrapper.find('.portfolio-selector-section').outerHeight(true);
      portfolioNewsUnitHeight = portfolioSide.$containerWrapper.find('#portfolio_news_unit').outerHeight();
      newsArticlesHeight = portfolioSide.$containerWrapper.find('.news-n-articles').outerHeight(true) + 10;
    }

    function bindEvents() {
      $container.find('.inner-unit').bindWithDelay('scroll', function () {
        var $this = $(this);
        SA.Logger.Mone.event(MONE_PARAMS.type, MONE_PARAMS.source, 'scroll', {
          data: {
            'portfolio_id': portfolio.id,
            'total_pixels': $this.innerHeight(),
            'pixes_scrolled': $this.scrollTop()
          }
        })
      }, 500, true);

      $container.on('click', 'a[sasource="side_portfolios"]', function () {
        SA.Logger.Mone.event(MONE_PARAMS.type, MONE_PARAMS.source, 'ticker_clicked', {
          data: {
            'portfolio_id': portfolio.name,
            'symbol': this.innerHTML
          }
        });
      }).on('click', '.news-n-articles', function () {
        var segs = window.location.pathname.split('/');
        SA.Logger.Mone.event(MONE_PARAMS.type, MONE_PARAMS.source, 'click', {
          data:{
            type: 'portfolio_headlines_button',
            seg: segs[0] || segs[1]
          }
        });
      });

      $win.on('resize', onWindowResize);
    }

    function onWindowResize() {
      var h = $win.height() - mainNavWrapperRowHeight - portfolioSelectorSectionHeight - portfolioNewsUnitHeight - newsArticlesHeight;
      $container.find('.inner-unit').css('max-height', h);
    }

    function sendLeftPortfolioShowEvent() {
      if (SA.Utils.Scroll.isCloseToElement($('#portfolio_unit'), 0)) {
        var customSorts = SA.Utils.SidePortfolio.customSorts,
          portfolioId = SA.Utils.SidePortfolio.portfolio.id,
          customOrdered = customSorts && customSorts[portfolioId] && customSorts[portfolioId].length > 0;

        SA.Logger.Mone.event(MONE_PARAMS.type, MONE_PARAMS.source, 'shown', {
          data: {
            'portfolio_id': portfolio.name,
            'portfolio_scroll': SA.Utils.Scroll.elementHasScroll($('.inner-unit')),
            'sort': portfolioSort.getSortOption(),
            'custom_order': customOrdered
          }
        });

        return true;
      }

      return false;
    }

    function scrollToPortfolioLeft() {
      if (sendLeftPortfolioShowEvent()) {
        SA.Utils.Scroll.remove(scrollToPortfolioLeft);
      }
    }

    function init() {
      $container = $('#portfolio-rail');
      if ($container.length && SA.Data.User.loggedIn()) {
        opt = opt || {};
        portfolio = opt.portfolio || {id: ''};
        portfolioSort = opt.portfolioSort || new SA.Utils.Portfolio.Sort({mone:MONE_PARAMS});

        getUnit();
      }
    }

    init();

  };

}(window, window.SA, window.jQuery));
(function() { this.JST || (this.JST = {}); this.JST["jst/pages/article/free_mp_summary_marketing/unit"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<p class="article-free-mp-link">\n    <i>\n      ',  content ,'\n    </i>\n</p>\n');}return __p.join('');};
}).call(this);
(function (w, SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Pages.Article');
  scope.DividendScores = function (opt) {

    var $container = $('#dividend-scores-unit'),
      saScroll;

    if ($container.length) {
      $.get('/articles/dividend_scores_unit', {id: SA.pageConfig.Data.article.id}).done(render).fail(renderInstead);
    } else {
      renderInstead();
    }

    function render(res) {
      var isOk = false;
      if (res.html) {
        saScroll = SA.Utils.Scroll;

        $container.html(res.html);
        var subscribeCta = SA.Data.User.isPremiumFreeTrialEligible() ? 'Start Your Free Trial' : 'Subscribe Now';
        $('.premium-subscribe').text(subscribeCta);
        var rowsCount = $container.find('table tbody tr').length;
        if (rowsCount > 3) {
          isOk = true;
          $container.removeClass('hidden');

          var $startFreeTrial = $container.find('.start-free-trial');
          if ($startFreeTrial.length) {
            if (rowsCount === 4) {
              $startFreeTrial.addClass('four');
            } else if (rowsCount === 5) {
              $startFreeTrial.addClass('five');
            }
          }

          initEvents();
        }
      }

      if (!isOk) {
        renderInstead();
      }
    }

    function initEvents() {
      saScroll.add(unitShown);

      var $showMore = $('.dividend-scores-show');
      if ($showMore.length) {
        $showMore.click(function () {
          if ($(this).hasClass('more')) {
            $container.find('table tbody tr.show-more').removeClass('hidden');
            $showMore.removeClass('more').addClass('less');
          } else if ($(this).hasClass('less')) {
            $container.find('table tbody tr.show-more').addClass('hidden');
            $showMore.removeClass('less').addClass('more');
          }
        });
      }
    }

    function unitShown() {
      if ($container.length) {
        var firstRow = $container.find('table tbody tr')[0];
        if (w.scrollY < saScroll.getOffsetTop($container) && saScroll.isCloseToElement(firstRow, 0)) {
          SA.Logger.Mone.event('', 'div_score_ar_btm', 'shown');
          saScroll.remove(unitShown);
        }
      }
    }

    function renderInstead() {
      if (opt.useNewPeersUnits) {
        $container.remove();

        if ($.isFunction(opt.renderInstead)) {
          opt.renderInstead();
        }
      }
    }
  };

}(window, window.SA, window.jQuery));
(function (w, SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Pages.Article');
  scope.Peers = function (opt) {
    var $container = $('#peers-unit'),
      peerInfo = {},
      saScroll;

    if ($container.length) {
      peerInfo = {
        item_id: opt.itemId,
        slug: $container.data('slug'),
        useNewPeersUnits: opt.useNewPeersUnits || false,
        type: opt.type,
        sasource: $container.data('sasource')
      };

      $.get('/articles/peers_unit', peerInfo).done(render).fail(renderInstead);
    } else {
      renderInstead();
    }

    function render(res) {
      if (!res.message && res.html) {
        $container.html(res.html).removeClass('hidden');

        var subscribeCta = SA.Data.User.isPremiumFreeTrialEligible() ? 'Start Your Free Trial' : 'Subscribe Now';
        $('.premium-subscribe').text(subscribeCta);

        initEvents();
      } else {
        renderInstead();
      }
    }

    function initEvents() {
      saScroll = SA.Utils.Scroll;

      saScroll.add(unitShown);

      showMore($('.peers-show.more'));
    }

    function unitShown() {
      if ($container.length) {
        var firstRow = $container.find('table tbody tr')[0];
        if (w.scrollY < saScroll.getOffsetTop($container) && saScroll.isCloseToElement(firstRow, 0)) {
          SA.Logger.Mone.event('', peerInfo.sasource, 'shown');
          saScroll.remove(unitShown);
        }
      }
    }

    function showMore($elem) {
      if ($elem.length) {
        $elem.click(function () {
          if (!SA.App.pro && peerInfo.useNewPeersUnits) {
            w.location.href = '/symbol/' + peerInfo.slug.toUpperCase() + '/peers/related-stocks';
          } else if ($(this).hasClass('more')) {
            $container.find('table tbody tr.show-more').removeClass('hidden');
            $elem.remove();
            $('.peers-show.all').removeClass('hidden');
          }
        });
      }
    }

    function renderInstead() {
      if (opt.useNewPeersUnits) {
        $container.remove();

        if ($.isFunction(opt.renderInstead)) {
          opt.renderInstead({type: opt.type, itemId: opt.itemId});
        }
      }
    }
  };

}(window, window.SA, window.jQuery));
(function (w, SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Pages.Article');
  scope.StocksMentioned = function (opt) {
    var $container = $('#stocks-mentioned-unit'),
      d = {},
      saScroll;

    if ($container.length) {
      d = {
        item_id: opt.itemId,
        slugs: $container.data('slugs'),
        type: opt.type,
        sasource: $container.data('sasource')
      };

      $.get('/articles/stocks_mentioned_unit', d).done(render).fail(renderInstead);
    } else {
      renderInstead();
    }

    function render(res) {
      if (!res.message && res.html) {
        $container.html(res.html).removeClass('hidden');

        initEvents();
      } else {
        renderInstead();
      }
    }

    function initEvents() {
      saScroll = SA.Utils.Scroll;

      saScroll.add(unitShown);

      showMore($('.stocks-mentioned-unit-show.more'));
    }

    function unitShown() {
      if ($container.length) {
        var firstRow = $container.find('table tbody tr')[0];
        if (w.scrollY < saScroll.getOffsetTop($container) && saScroll.isCloseToElement(firstRow, 0)) {
          SA.Logger.Mone.event('', d.sasource, 'shown');
          saScroll.remove(unitShown);
        }
      }
    }

    function showMore($elem) {
      if ($elem.length) {
        $elem.click(function () {
          $container.find('table tbody tr.show-more').removeClass('hidden');
          $elem.remove();
        });
      }
    }

    function renderInstead() {
      $container.remove();

      if ($.isFunction(opt.renderInstead)) {
        opt.renderInstead();
      }
    }
  };

}(window, window.SA, window.jQuery));
(function (SA, $) {

  'use strict';

  function initPodcastTracking() {
    $('.js-podcast-click').click(function () {
      var source = $(this).data('podcast-name');
      SA.Logger.Mone.event('podcast_sponsor_article', source, 'clicked');
    })
  }

  function initLatestPodcastUnitTracking() {
    $('.c-special').on('click', '.c-special__link', function () {
      var source = 'podcast_' + $(this).data('source');
      var dest = $(this).text().toLowerCase();
      if (dest.includes('podcasts')) {
        dest = dest.split(' ')[0];
      }
      SA.Logger.Mone.event('podcast_subscribe_link', source, 'clicked', {data: {dest: dest}});
    });
  }

  function init() {
    initPodcastTracking();
    initLatestPodcastUnitTracking();
  }

  init();

})(window.SA, window.jQuery);
(function (w, SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.iShare');

  function popuplate() {
    SA.Utils.SymbolData.getFromSuperQuotes(SA.pageConfig.Data.isharesData, function (res) {
      var date = Object.values(res)[0].DateTime;
      $('.timeAndDate').append(formatDate(new Date(Date.parse(date))));
      $('.loader-spinner').removeClass('loader-spinner');
      for (var key in res) {
        var value = res[key],
          lastPrice = '$' + value.Last.toFixed(2),
          changePrice = value.Change.toFixed(2),
          changePercentage = value.PercentChange.toFixed(2);
        $('[data-slug=' + key + '][data-type=' + 'price]').append(lastPrice);
        $('[data-slug=' + key + '][data-type=' + 'change]').append(changePrice).addClass(color(changePrice));
        $('[data-slug=' + key + '][data-type=' + 'changep]').append(changePercentage).addClass(color(changePercentage));
      }
    });
  }

  function formatDate(date) {
    var day = date.getDate();
    var month = date.getMonth() + 1;
    var year = date.getYear();
    var hours = date.getHours() % 12 || 12;
    var minutes = date.getMinutes();
    minutes = (minutes < 10) ? '0' + minutes : minutes;
    var amPm = (date.getHours() < 12 || date.getHours() === 24) ? "AM" : "PM";
    return hours + ':' + minutes + ' ' + amPm + ' ' + month + '/' + day + '/' + (year - 100) + " | Bats BZX Real-Time\n"+ "Price CHG and % CHG Since Market Open";
  }

  function events() {
    $(".collapse").on('show.bs.collapse', function () {
      SA.Logger.Mone.event("accordion_view", "insight_investing_strategy", "click", {
        data: {
          title: this.getAttribute("data-title")
        }
      });
      $(this).prev(".card-header").find(".chevron").hide();
      $('.collapse').collapse('hide')
    }).on('hide.bs.collapse', function () {
      $(this).prev(".card-header").find(".chevron").show();
    });


    $(".specialbutton").on('click', function () {
      $(".collapseData").toggle();
    });
  }

  function color(val) {
    if (val > 0) {
      return 'green';
    } else if (val < 0) {
      return 'red';
    }
  }

  scope.init = function () {
    if (!SA.pageConfig.Data.isIshares) {
      return;
    }
    events();
    popuplate();
  }

})(window, window.SA, window.jQuery);
(function() { this.JST || (this.JST = {}); this.JST["jst/popups/zuora/checkout_popup"] = function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div class="checkout-container">\n    <a class="x-close" data-dismiss="modal"></a>\n    <div id="sa-loader" class="my-loader">\n        <div class="loader-container">\n            <div class="loader">\n                <div class="loader-dot"></div>\n                <div class="loader-dot"></div>\n                <div class="loader-dot"></div>\n                <div class="loader-dot"></div>\n                <div class="loader-dot"></div>\n                <div class="loader-text"></div>\n            </div>\n        </div>\n    </div>\n    <iframe id="checkout_iframe" frameborder="0" onload="SA.Widgets.checkoutPopup.onIframeLoad();" src="/premium?popup=true&source=', source,'"></iframe>\n</div>\n');}return __p.join('');};
}).call(this);

(function (SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Widgets');

  scope.checkoutPopup = new function () {
    var show = function () {
      var opt = {
        className: SA.Data.User.loggedIn() ? 'checkout-popup' : 'checkout-popup-logged-out',
        headerContent: '',
        bodyContent: JST['jst/popups/zuora/checkout_popup']({source: (scope.checkoutPopup.opts.source || '')}),
        footerContent: '',
        backdrop: true,
        keyboard: true,
        removeAfterClose: true,
        afterOpen: function () {
        },
        afterClose: function () {
          if (sessionStorage.getItem('premium_subscription_from_popup') === 'completed'){
            window.location.reload();
          }
        }
      }, modal;

      modal = SA.Widgets.Popup.build(opt);
      if (!SA.Widgets.Popup.isRunning()) {
        modal.show();
      }
    };

    this.onIframeLoad = function () {
      $('.my-loader').hide();
      $('#checkout_iframe').show();
    };

    this.init = function(opts) {
      this.opts = opts || {};
      show();
    }
  };
})(window.SA, window.jQuery);







































(function (w, SA, $) {

  'use strict';

  var scope = SA.UsingNamespace('SA.Pages.Article'),
    pageData = {}, primaryTicker, config, user,
    $articleBody = $('#a-body'),
    $saComments = $('#comments'),
    $rightRail = $('#right-rail'),
    $header = $('#sa-hd'),
    $innerMarketing = $('#a-inner-marketing'),
    scrollSpeed = 200,
    sendCommentsSectionEvent = true,
    articleFollowBottomEvent = true,
    sendArticleEndEvent = true,
    lastCommentsReachedEvent = true,
    readingCommentDistanceEvent = null,
    readingCommentTriesEvent = 0,
    readingCommentStartedEvent = 0,
    inArticleMarketingReachedEvent = true,
    isPreview = (SA.App.isCms || SA.App.isSharkPreview),
    isResearchAuthor, idleNotifier,
    topLikedCommentsFlag = false;

  var getArticleOpt = function () {
    return {
      id: 0,
      primaryTicker: null,
      stub: false,
      isEarningCenter: (/\/earnings-center\//.test(w.location.href))
    };
  };

  var authorOpt = {exclusiveResearch: false};

  var initContribBtn = function () {
    if (isResearchAuthor) {
      var link = user.hasContributorDetails() ? '/submission' : '/page/become-a-seeking-alpha-contributor';
      $('<a href="' + link + '" class="be-contributor"></a>').insertAfter($saComments);
    }
  };

  var getYieldComparisonData = function () {
    $.get('/memcached2/article_bottom/' + pageData.article.id).done(function (res) {
      res = res || {};

      if (res.div_yield) {
        scope.yieldComparisonData = res.div_yield;
      }
    });
  };

  var setAdsVars = function () {
    //variables been used from inside of iframes
    scope.primaryTicker = primaryTicker;

    getYieldComparisonData();
  };

  var showCommentsCounter = function (count) {
    var $w = $('#a-comments-wrapper'), t = count === 1 ? '1 comment' : count + ' comments';
    $w.replaceWith('<span id="a-comments" itemprop="interactionCount" content="UserComments:' + count + '"><div class="sep hidden-print">|</div><a href="#comments">' + t + '</a></span>');
    $('#a-comments').find('a').on('click', function (e) {
      e.preventDefault();

      if(topLikedCommentsFlag){
        SA.Widgets.AuthenticationPopup.show({
          headerTitle: 'Join the conversation today by signing in or registering for a free Seeking Alpha account',
          urlHash: '#comments'
        });
      } else {
        $(w).scrollTo($saComments, scrollSpeed, {
          offset: {
            top: -Math.abs($header.height())
          }
        });
      }
    });
  };

  // needed for home page trending articles unit
  var sendArticleTracking = function (response) {
    if (!isPreview) {
      var notifier = location.href.match(/notified=([0-9]+)/),
        data = {
          post_id: pageData.article.id,
          total_comments: response.total || 0,
          is_author: user.authorSlug() === pageData.author.slug,
          title_test: pageData.article.titleTest ? !pageData.article.titleTest.finished : false
        };

      if (notifier) {
        data.notified = notifier[1];
      }

      $.ajax({
        dataType: 'text',
        method: 'GET',
        url: '/articles/enqueue_tracking?u=' + user.id(),
        data: data
      });
    }
  };

  var runCommentsUpdate = function (response) {
    response = response || {};
    if (response.total && response.total > 0) {
      showCommentsCounter(response.total);
    }
    sendArticleTracking(response);
  };


  var afterCommentsRendered = function () {
    if(topLikedCommentsFlag){
      var $commentsBlock = $('section#comments'),
        $parentComment = $('section#comments .c-body'),
        $childComment = $('section#comments .c-body .c-body');

      if($childComment.length) {
        $childComment.addClass('blured');
      } else if ($parentComment.length) {
        $parentComment.addClass('blured');
      }

      $commentsBlock.prepend('<div class="comments-cover"></div>');
      $('.comments-cover').css('height', $commentsBlock.css('height'));

      $('#about-c').prepend('<button class="btn btn-go-auth">JOIN THE CONVERSATION</button>');
      $('.btn-go-auth').on('click', function (e) {
        SA.Widgets.AuthenticationPopup.show({
          headerTitle: 'Join the conversation today by signing in or registering for a free Seeking Alpha account',
          urlHash: '#comments'
        });
      });
    }
  };

  var initAuthorTickerUnits = function (useNewPeersUnits) {
    initFollowAuthorTopUnit();
    SA.Widgets.TickerHoverCard();
    initAuthorNewsletterSignUp(useNewPeersUnits);
  };

  var initMuteAuthor = function () {
    SA.Widgets.MuteUser.Button({
      user: {
        id: pageData.author.userId,
        slug: pageData.author.slug,
        name: pageData.author.name
      },
      showName: false,
      isButton: true,
      container: '#author-hd .mute-author-top',
      bi: {
        src: 'article_top',
        data: {article_id: pageData.article.id}
      },
      onMuteFailure: function () {
        SA.Logger.Mone.event('user_mute', 'article_top', 'mute', {success: false, PRO_prompt: 'shown'});
      }
    });
  };

  var initFollowAuthorTopUnit = function () {
    new SA.Widgets.Follow.SingleButton({
      author: pageData.author,
      container: '#author-hd .follow-user-top',
      showPopover: true,
      articleId: pageData.article.id,
      bi: {sendDefault: true, source: 'article_page_author_header'}
    }).init();
  };

  var initAuthorNewsletterSignUp = function (useNewPeersUnits) {
    if (pageData.author.exclusiveResearch) {
      initFollowBottomUnits({useNewPeersUnits: useNewPeersUnits});
    } else {
      SA.Widgets.AuthorNewsletterSignup({
        container: $('#author-newsletter-signup'),
        isAuthorNewsletter: pageData.article.isAuthorNewsletter,
        authorName: pageData.author.name,
        authorTagId: pageData.author.tagId,
        userId: user.id(),
        callbackOptions: {useNewPeersUnits: useNewPeersUnits},
        insteadClb: initFollowBottomUnits
      });
    }
  };

  var initFollowBottomUnits = function (opts) {
    opts = opts || {};
    if (user.loggedIn()) {
      initLoggedIn();
      if (!config.article.primaryIsCrypto && (opts.useNewPeersUnits || user.isCommonPro())) {
        SA.Pages.Article.DividendScores({
          useNewPeersUnits : opts.useNewPeersUnits,
          renderInstead: function () {
            SA.Pages.Article.Peers({
              type: 'Article',
              itemId: config.article.id,
              useNewPeersUnits: opts.useNewPeersUnits,
              renderInstead: SA.Pages.Article.StocksMentioned
            });
          }
        });
      }
    } else {
      initLoggedOut();
    }
  };

  var initLoggedIn = function () {
    SA.Widgets.AddTickerBottomUnit({
      $container: $('#add-ticker-to-portfolio-unit'),
      ticker: primaryTicker,
      bi: {source: 'article_bottom'},
      renderInstead: initFollowAuthorBottomUnit
    });
  };

  var initFollowAuthorBottomUnit = function () {
    if (!pageData.roadblock.active && $.inArray(pageData.author.slug, user.followedAuthors()) === -1) {
      new SA.Widgets.Follow.SingleButton({
        author: pageData.author,
        container: '.bottom-article-follow',
        showPopover: true,
        followersNumber: {show: false},
        articleId: pageData.article.id,
        bi: {sendDefault: true, source: 'article_page_bottom'},
        afterClb: function () {
          $('#add-ticker-to-portfolio-unit').removeClass('hidden');
        }
      }).init();
    }
  };

  var initLoggedOut = function () {
    if (primaryTicker) {
      SA.Widgets.AddTickerRtaRegister({
        ticker: primaryTicker,
        top: {$container: $('.a-info.get-alerts'), hide: true},
        bottom: {$container: $('#add-ticker-to-portfolio-unit')},
        page: 'article'
      });
    }
  };

  var initSalesSurvey = function () {
    if (!pageData.article.isTranscript) {
      SA.Widgets.ArticleSalesSurvey.init({ticker: primaryTicker});
    }
  };

  var initNonProSideBar = function () {
    if (!user.isProPlus()) {
      initSalesSurvey();
    }
  };

  var initArticleAbout = function () {
    if (pageData.article.id && !pageData.article.stub) {
      SA.Widgets.ArticleAbout.init({
        articleId: pageData.article.id,
        articleTitle: pageData.article.title
      });
    }
  };

  var initProSideBar = function () {
    if (user.loggedIn() && user.isCommonPro() && !pageData.article.showPastPodcast) {
      SA.Widgets.Pro.ProSidebar.init({
        slug: primaryTicker,
        page:'article',
        sidebarItems: ['pro-ticker-snapshot', 'price-chart', 'ticker-key-data', 'sentiments', 'author-covers', 'viewed-stocks']
      });
    }
  };

  var initSideBar = function () {
    setAdsVars();
    initNonProSideBar();
    initProSideBar();
  };

  var initTranscriptRoadblock = function () {
    SA.Widgets.TranscriptRoadblock.init({
      articleId: pageData.article.id,
      authorTagId: pageData.author.tagId,
      primaryTicker: primaryTicker,
      config: pageData.roadblock,
      page: pageData.pagination.page
    });
  };

  var initAuthenticationPopup = function(options) {
    setTimeout(function(){SA.Widgets.AuthenticationPopup.show(options)}, 5000);
  };

  var initSharing = function () {
    SA.Widgets.Sharing.init({
      itemType: 'Article',
      itemId: pageData.article.id,
      twitterContent: pageData.article.twitContent,
      title: pageData.article.title
    });
  };

  var initAuthorHeader = function () {
    if (pageData.author) {
      SA.Widgets.ArticleAuthorHeader.init({
        tagId: pageData.author.tagId,
        slug: pageData.author.slug,
        research: pageData.author.exclusiveResearch,
        articleId: pageData.article.id,
        nick: pageData.author.name,
        isBrand: pageData.author.is_brand_author
      });
    }
  };

  var initArticleDetails = function () {
    SA.Widgets.ArticleDetails.init(pageData);
  };

  var initArticleRatingsChart = function() {
    SA.Widgets.ArticleRatingsChart.init();
  };

  var initMobileWebAppBanner = function () {
    SA.Widgets.MobileAppBanner.init(pageData.article.id);
  };

  var initPagination = function () {
    // active param for ability to disable pagination under some conditions
    SA.Widgets.Pagination.init({
      config: pageData.pagination,
      isTranscript: pageData.article.isTranscript,
      active: true
    });
  };

  var isArticleRoadblocked = function () {
    return (pageData.article.isTranscript) ? SA.Widgets.TranscriptRoadblock.isRoadblocked() : SA.Widgets.PageRoadblock.isRoadblocked();
  };

  var observeScroll = function () {
    SA.Utils.Scroll.add(function () {
      runArticleEnd();
      runCommentsSection();
      lastCommentReached();
      inArticleMarketingReached();
      runReadingCommentsSection();
      runArticleFollowBottom();
    });
  };

  var runArticleEnd = function () {
    if (endOfTheArticlePosition() && sendArticleEndEvent && !SA.Widgets.Pagination.active()) {
      SA.Logger.Mone.event('', '', 'article_end');
      sendArticleEndEvent = false;
    }
  };

  var endOfTheArticlePosition = function () {
    if ($articleBody) {
      return (!isArticleRoadblocked() && $articleBody.height() - ($(w).scrollTop() + $(w).height()) < -824);
    }
  };

  var runCommentsSection = function () {
    if (commentsSectionPosition() && sendCommentsSectionEvent) {
      SA.Logger.Mone.event('', '', 'comments_section');
      sendCommentsSectionEvent = false;
    }
  };

  var commentsSectionPosition = function () {
    if ($saComments && !$saComments.find('.media.c-body').length) {
      return false;
    }

    return !isArticleRoadblocked() && !$saComments.hasClass('hide') && (SA.Utils.Scroll.getOffsetTop($saComments.find('.media.c-body').first()) - ($(w).scrollTop() + $(w).height()) < 0);
  };

  var runArticleFollowBottom = function () {
    if (SA.Utils.Scroll.isCloseToElement($('#add-ticker-to-portfolio-unit').find('.follow-unit-container'), 50) && articleFollowBottomEvent) {
      SA.Logger.Mone.event('author_follow_unit', 'article_bottom', 'displayed', {
        data: {
          author: pageData.author.slug,
          author_id: pageData.author.id
        }
      });
      articleFollowBottomEvent = false;
    }
  };

  var lastCommentReached = function () {
    if (lastCommentsReachedEvent
      && $saComments
      && !$saComments.hasClass('hide')
      && $saComments.find('.media.c-body').length
      && SA.Utils.Scroll.isCloseToElement($saComments.find('.media.c-body').last(), 0)) {
      SA.Logger.Mone.event('comments', 'article', 'comments_end');
      lastCommentsReachedEvent = false;
    }
  };

  var inArticleMarketingReached = function () {
    if (inArticleMarketingReachedEvent && !$innerMarketing.hasClass('hidden')
      && SA.Utils.Scroll.isCloseToElement($innerMarketing, 0)) {
      SA.Logger.Mone.event('mp_marketing', 'in_article_marketing', 'shown', {data: {'article_id': SA.pageConfig.Data.article.id, 'service_id;': SA.pageConfig.Data.author.exclusiveResearch.id, 'unit_name' : $innerMarketing.attr('marketing_unit')}});
      inArticleMarketingReachedEvent = false;
    }
  };

  var runReadingCommentsSection = function () {
    if (readingCommentStartedEvent === 0 && $saComments && $saComments.find('.media.c-body').length > 0 && !isArticleRoadblocked()) {
      readingCommentsSection();
      readingCommentStartedEvent = 1;
    }
  };

  var readingCommentsSection = function () {
    var curr_offset;
    if (!$saComments.is('.hide') && (curr_offset = SA.Utils.Scroll.getOffsetTop($saComments.find('.media.c-body').first()) - ($(w).scrollTop())) < 80) {
      if (readingCommentTriesEvent > 0 && (curr_offset > (readingCommentDistanceEvent - 100) && curr_offset < (readingCommentDistanceEvent + 100))) {
        SA.Logger.Mone.event('', '', 'reading_comments');
      } else {
        readingCommentTriesEvent = (readingCommentTriesEvent > 0) ? 0 : readingCommentTriesEvent + 1;
        readingCommentDistanceEvent = curr_offset;
        setTimeout(readingCommentsSection, 5000);
      }
    } else {
      setTimeout(readingCommentsSection, 2000);
    }
  };

  var initTitleTest = function () {
    if (SA.Pages.Article.HitTitleTest && pageData.article.titleTest) {
      SA.Pages.Article.HitTitleTest.init(pageData);
    }
  };

  var initTrendingArticles = function () {
    // prevent showing article in hp_trending_articles which been already seen by user
    try {
      w.sessionStorage.setItem('/article/' + pageData.article.id, '1');
    } catch (ignore) {
    }
  };

  var initSharkPreview = function () {
    SA.Pages.Article.Preview.init();
  };

  var initPresentation = function () {
    SA.Widgets.Presentation.init();
  };

  var initIdleAction = function () {
    idleNotifier = new SA.Utils.IdleNotifier(
      {idleTime: 300000}
    );
    idleNotifier.addIdleCallback(function () {
      $('body').one('mousemove', function () {
        SA.Logger.Mone.event('time_tracking', 'article', 'returned_from_idle',
          {data: {seconds_idle: Math.round(idleNotifier.getIdleTime() / 1000)}});
      });
    });
  };

  var initEarnings = function () {
    var earningsType = null;
    if (pageData.article.isSlides) {
      earningsType = 'TranscriptPresentation';
    } else if (pageData.article.isTranscript) {
      earningsType = 'Transcript';
    }

    if (earningsType) {
      SA.Widgets.Earnings.init({slug: primaryTicker, epoch: pageData.article.date_epoch, type: earningsType});
    }
  };

  var showExclusiveNotice = function () {
    $('.exclusive-notice').animate({opacity: 1},  500);
  };

  var setArchiveLockIcons = function ($locks) {
    var keyIcon = w.JST['jst/inline_svg/key']({width: 24, color: '#757575'});
    $locks.append(keyIcon);
  }

  var initLocks = function () {
    var $locks = $('.archive_lock');
    if ($locks.length) {
      setArchiveLockIcons($locks);
    }
  };

  var initialize = function () {
    // initEarnings should be initialized first
    initEarnings();
    initMuteAuthor();
    showExclusiveNotice();
    initLocks();

    if (!SA.App.isSharkPreview) {
      var options = {
        id: pageData.article.id,
        authorUserId: pageData.author.userId,
        authorSlug: pageData.author.slug,
        type: 'Article',
        container: $('#comments'),
        source: 'article_comments',
        twitterContent: pageData.article.twitContent,
        afterDeliver: runCommentsUpdate,
        doneCallback: afterCommentsRendered,
        replaceWithButton: false,
        publishDate: pageData.article.publishDate
      };

      if (user.loggedIn()) {
        $.extend(options, {
          discussion_status: config.comments.discussion_status,
          discussion_message: config.comments.discussion_message
        });
      } else {
        topLikedCommentsFlag = true;
        $.extend(options, {
          commentType: 'topLiked',
          hideResponseForm: true
        });
      }
      SA.Widgets.CommentsTree.init(options);
    }

    initArticleLikes();
    initTitleTest();
    initPresentation();
    initIdleAction();

    if (!isPreview) {
      initSideBar();
      initMobileWebAppBanner();

      getExtendedCallbacks().fire(pageData.article.id);

      if(!user.loggedIn() && document.referrer.match(/^https:\/\/email(\.\w+)?\.seekingalpha\.com/)) {
        initAuthenticationPopup();
      }
      if (pageData.article.isTranscript) {
        initTranscriptRoadblock();
      }
      initPagination();
    }

    if (!user.isProPlus() && config.author && !user.isSubscribedToAuthorResearch(config.author.slug) &&
        !user.isInactivePartOfBundle(config.author.slug) && pageData.article.isFreeMpArticle && pageData.author.exclusiveResearch) {
      initMpFreeArticleSummaryMarketing();
    }

    initArticleAbout();

    if (!isPreview) {
      initTrendingArticles();
    }

    initAuthorHeader();

    initArticleDetails();

    initArticleRatingsChart();

    if (!isPreview) {
      SA.Utils.AbTests.init({
        'new article bottom units': function (variation) {
          var useNewPeersUnits;
          switch (variation){
            case 'new_peers_new_conditioned':
              useNewPeersUnits = !SA.Utils.AdBlockManager.blockDisplayBottomUnit();
              break;
            case 'new_peers':
            case 'new_peers_new':
              useNewPeersUnits = true;
              break;
            default:
              useNewPeersUnits = false;
          }
          initAuthorTickerUnits(useNewPeersUnits);
      }});
      observeScroll();
      SA.Utils.Portfolio.External();
    }

    if (SA.App.isSharkPreview) {
      initSharkPreview();
    }

    if (!user.loggedIn()) {
      visitedSymbol();
    }

    if (pageData.author.show_managed_account) {
      setManagedAccountUnitEvent();
    }

    if (isResearchAuthor) {
      $('body').addClass('marketplace-focus');
    }

    if (config.article.isEtf) {
      SA.Utils.PageTracker.recordVisitedItem('etf_articles_read', config.article.id);
    }

    if ($innerMarketing.length && (!user.loggedIn() || user.isMPAuthor() || (!user.isCommonPro() && !user.isSubscribedToAuthorResearch(config.author.slug) && !user.isInactivePartOfBundle(config.author.slug)))) {
      $innerMarketing.removeClass('hidden');
      var unitName = $innerMarketing.attr('marketing_unit');
      if (unitName) {
        var sourceName = 'inarticle_marketing_' + unitName;
        var links= $innerMarketing.find('a').not('[rel="lightbox"]');
        for (var i = 0, len = links.length; i < len; i++) {
          links[i].setAttribute('sasource', sourceName);
        }
      }
      inArticleMarketingReached();
    }
  };

  function initArticleLikes() {
    SA.Widgets.Like({
      identifier: {
        id: config.article.id,
        type: 'Article'
      },
      text: 'Like this article'
    });
  }

  var setManagedAccountUnitEvent = function () {
    var managedAccountUnitEvent = function () {
      if (SA.Utils.Scroll.isCloseToElement($('#managed-account-container'), 300)) {
        SA.Logger.Mone.event('managed_accounts_promo', 'article_bottom', 'shown', {
          data: {
            author_id: pageData.author.id,
            author_name: pageData.author.slug
          }
        });
        $(w).off('scroll', managedAccountUnitEvent);
      }
    };
    $(w).bindWithDelay('scroll', managedAccountUnitEvent, 500, true);
  };

  var visitedSymbol = function () {
    if (primaryTicker) {
      var visited = SA.Data.Cache.get('primary_tickers_visited'),
        visitedTickers = visited ? visited.split(',') : [],
        maxVisitedTickers = 10;

      if ($.inArray(primaryTicker, visitedTickers) < 0) {
        visitedTickers.unshift(primaryTicker);
        if (visitedTickers.length > maxVisitedTickers) {
          visitedTickers.pop();
        }
        SA.Data.Cache.set('primary_tickers_visited', visitedTickers);
      }
    }
  };

  var getExtendedCallbacks = function () {
    var callbacks = $.Callbacks();
    callbacks.add(initSharing);
    callbacks.add(initContribBtn);

    if (user.isProPlus()) {
      callbacks.add(SA.Widgets.ProBottomUnits.init);
    } else if (config.article.allowMpPromotion) {
      callbacks.add(initLiftigniterInitializer);
      callbacks.add(function () {
        if (!user.adblockScore() < 4 || !user.loggedIn() || !config.firstResearchAuthor || SA.Widgets.CommentsTree.showSpecific || !SA.Widgets.CommentsTree.commentsCount > 0) {
          $('#comments').css('cssText', 'padding-top: 50px !important;');
        }
      });
    } else {
      callbacks.add(initLiftigniterInitializer);
    }

    return callbacks;
  };

  var initMpFreeArticleSummaryMarketing = function () {
    var content;
    if (pageData.article.marketingBullet) {
      content = pageData.article.marketingBullet;
      SA.Logger.Mone.event("mp_marketing_text_top", null, "shown", {data: {marketing_bullet: content}});
    } else {
      content = ['This idea was discussed in more depth with members of my private investing community,',
        '<a href="/checkout?service_id=mp_', pageData.author.exclusiveResearch.id, '&sasource=mp_marketing_text_top" target="_blank">', pageData.author.exclusiveResearch.title, '</a>.'
      ].join('');
    }
    $('.article-summary').find('.a-sum').append(w.JST['jst/pages/article/free_mp_summary_marketing/unit']({content: content}));
  };

  var initLiftigniterInitializer = function () {
    if (!config.article.isFidelityEducationPage && !config.article.isSponsored) {
      var clb = $.Callbacks();
      clb.add(SA.Widgets.LiftigniterUnit);
      SA.Widgets.Liftigniter.init({
        maxItems: 4,
        callbacks: clb,
        setRequestFields: ['id', 'url', 'title', 'author_name', 'author_image', 'publish_time']
      });
    }
  };

  var init = function () {
    if (w.self === w.top) {
      config = SA.pageConfig.Data;
      pageData.article = $.extend({}, getArticleOpt(), config.article);
      primaryTicker = pageData.article.primaryTicker;
      pageData.author = $.extend({}, authorOpt, config.author);
      pageData.ads = config.ads || {};
      pageData.firstResearchAuthor = config.firstResearchAuthor || {};
      pageData.pagination = w.aConf.pagination || {};
      pageData.roadblock = w.aConf.roadblock || {};
      pageData.brand = config.brand || {};
      user = SA.Data.User;
      isResearchAuthor = SA.Data.User.loggedIn() && pageData.firstResearchAuthor.slug;
      SA.iShare.init();
      var indexPrimaryTicker = config.indexTickers[primaryTicker.toUpperCase()];
      if (indexPrimaryTicker) {
        primaryTicker = indexPrimaryTicker;
      }

      initialize();
    }
  };

  init();

} (window, window.SA, window.jQuery));








